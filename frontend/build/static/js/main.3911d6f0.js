/*! For license information please see main.3911d6f0.js.LICENSE.txt */
(()=>{var e={36:(e,t,n)=>{n(6491),n(2022),n(1698),n(8918),n(262),n(9117),n(8007)},39:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.createSvgIcon}});var i=n(6772)},172:e=>{const t={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function n(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}e.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(t)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",(e=>{this.load(e.detail.model)}))},load:function(e){const t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",(e=>{t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})})),this.mixer.addEventListener("finished",(e=>{t.emit("animation-finished",{action:e.action,direction:e.direction})})),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;const n=this.data,i=AFRAME.utils.diff(n,e);if("clip"in i)return this.stopAction(),void(n.clip&&this.playAction());this.activeActions.forEach((e=>{"duration"in i&&n.duration&&e.setDuration(n.duration),"clampWhenFinished"in i&&(e.clampWhenFinished=n.clampWhenFinished),("loop"in i||"repetitions"in i)&&e.setLoop(t[n.loop],n.repetitions),"timeScale"in i&&e.setEffectiveTimeScale(n.timeScale)}))},stopAction:function(){const e=this.data;for(let t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const e=this.model,i=this.data,r=e.animations||(e.geometry||{}).animations||[];if(!r.length)return;const o=i.useRegExp?i.clip:(s=i.clip,new RegExp("^"+s.split(/\*+/).map(n).join(".*")+"$"));var s;for(let n,a=0;n=r[a];a++)if(n.name.match(o)){const r=this.mixer.clipAction(n,e);r.enabled=!0,r.clampWhenFinished=i.clampWhenFinished,i.duration&&r.setDuration(i.duration),1!==i.timeScale&&r.setEffectiveTimeScale(i.timeScale),r.startAt(this.mixer.time-i.startAt/1e3),r.setLoop(t[i.loop],i.repetitions).fadeIn(i.crossFadeDuration).play(),this.activeActions.push(r)}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}})},219:(e,t,n)=>{"use strict";var i=n(3763),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return i.isMemo(e)?s:a[e.$$typeof]||r}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,i){if("string"!==typeof n){if(f){var r=p(n);r&&r!==f&&e(t,r,i)}var s=u(n);h&&(s=s.concat(h(n)));for(var a=l(t),m=l(n),g=0;g<s.length;++g){var v=s[g];if(!o[v]&&(!i||!i[v])&&(!m||!m[v])&&(!a||!a[v])){var y=d(n,v);try{c(t,v,y)}catch(A){}}}}return t}},224:e=>{var t=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var t,n,i;try{t=Map}catch(a){t=function(){}}try{n=Set}catch(a){n=function(){}}try{i=Promise}catch(a){i=function(){}}function r(o,a,l,c,u){"object"===typeof a&&(l=a.depth,c=a.prototype,u=a.includeNonEnumerable,a=a.circular);var h=[],d=[],p="undefined"!=typeof Buffer;return"undefined"==typeof a&&(a=!0),"undefined"==typeof l&&(l=1/0),function o(l,f){if(null===l)return null;if(0===f)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,i))m=new i((function(e,t){l.then((function(t){e(o(t,f-1))}),(function(e){t(o(e,f-1))}))}));else if(r.__isArray(l))m=[];else if(r.__isRegExp(l))m=new RegExp(l.source,s(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(r.__isDate(l))m=new Date(l.getTime());else{if(p&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):"undefined"==typeof c?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(c),g=c)}if(a){var v=h.indexOf(l);if(-1!=v)return d[v];h.push(l),d.push(m)}for(var y in e(l,t)&&l.forEach((function(e,t){var n=o(t,f-1),i=o(e,f-1);m.set(n,i)})),e(l,n)&&l.forEach((function(e){var t=o(e,f-1);m.add(t)})),l){var A;g&&(A=Object.getOwnPropertyDescriptor(g,y)),A&&null==A.set||(m[y]=o(l[y],f-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(y=0;y<x.length;y++){var b=x[y];(!(w=Object.getOwnPropertyDescriptor(l,b))||w.enumerable||u)&&(m[b]=o(l[b],f-1),w.enumerable||Object.defineProperty(m,b,{enumerable:!1}))}}if(u){var _=Object.getOwnPropertyNames(l);for(y=0;y<_.length;y++){var w,E=_[y];(w=Object.getOwnPropertyDescriptor(l,E))&&w.enumerable||(m[E]=o(l[E],f-1),Object.defineProperty(m,E,{enumerable:!1}))}}return m}(o,l)}function o(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return r.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},r.__objToStr=o,r.__isDate=function(e){return"object"===typeof e&&"[object Date]"===o(e)},r.__isArray=function(e){return"object"===typeof e&&"[object Array]"===o(e)},r.__isRegExp=function(e){return"object"===typeof e&&"[object RegExp]"===o(e)},r.__getRegExpFlags=s,r}();e.exports&&(e.exports=t)},262:e=>{const t="-controls";e.exports=AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const e=this.el;this.data.camera||(this.data.camera=e.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(e){const n=this.el,i=this.data,r=n.sceneEl.systems.nav;if(n.sceneEl.hasLoaded&&this.injectControls(),r&&i.constrainToNavMesh!==e.constrainToNavMesh&&(i.constrainToNavMesh?r.addAgent(this):r.removeAgent(this)),i.enabled!==e.enabled)for(let o=0;o<i.controls.length;o++){const e=i.controls[o]+t;this.el.setAttribute(e,{enabled:this.data.enabled})}},injectControls:function(){const e=this.data;for(let n=0;n<e.controls.length;n++){const i=e.controls[n]+t;this.el.setAttribute(i,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,r){if(!r)return;const o=this.el,s=this.data;if(!s.enabled)return;this.updateVelocityCtrl();const a=this.velocityCtrl,l=this.velocity;if(a)if(r/1e3>.2?l.set(0,0,0):this.updateVelocity(r),s.constrainToNavMesh&&!1!==a.isNavMeshConstrained){if(l.lengthSq()<1e-5)return;e.copy(o.object3D.position),t.copy(l).multiplyScalar(r/1e3).add(e);const i=o.sceneEl.systems.nav;this.navGroup=null===this.navGroup?i.getGroup(e):this.navGroup,this.navNode=this.navNode||i.getNode(e,this.navGroup),this.navNode=i.clampStep(e,t,this.navGroup,this.navNode,n),o.object3D.position.copy(n)}else o.hasAttribute("velocity")?o.setAttribute("velocity",l):(o.object3D.position.x+=l.x*r/1e3,o.object3D.position.y+=l.y*r/1e3,o.object3D.position.z+=l.z*r/1e3)}}(),updateVelocityCtrl:function(){const e=this.data;if(e.enabled){for(let n=0,i=e.controls.length;n<i;n++){const i=this.el.components[e.controls[n]+t];if(i&&i.isVelocityActive())return void(this.velocityCtrl=i)}this.velocityCtrl=null}},updateVelocity:function(){const e=new THREE.Vector2,t=new THREE.Quaternion;return function(n){let i;const r=this.el,o=this.velocityCtrl,s=this.velocity,a=this.data;if(o){if(!o.getVelocityDelta){if(o.getVelocity)return void s.copy(o.getVelocity());if(o.getPositionDelta)return void s.copy(o.getPositionDelta(n).multiplyScalar(1e3/n));throw new Error("Incompatible movement controls: ",o)}i=o.getVelocityDelta(n)}if(r.hasAttribute("velocity")&&!a.constrainToNavMesh&&s.copy(this.el.getAttribute("velocity")),i&&a.enabled){const n=a.camera;t.copy(n.object3D.quaternion),t.premultiply(r.object3D.quaternion),i.applyQuaternion(t);const o=i.length();a.fly?(s.copy(i),s.multiplyScalar(16.66667*this.data.speed)):(e.set(i.x,i.z),e.setLength(o*this.data.speed*16.66667),s.x=e.x,s.y=0,s.z=e.y),0===s.x&&0===s.y&&0===s.z||(this.eventDetail.velocity=s,this.el.emit("moved",this.eventDetail))}}}()})},344:e=>{"use strict";e.exports=function(){}},351:e=>{function t(e){return new n("number"===typeof e?e:+new Date)}function n(e){this.seed=e}function i(e){return Math.sqrt(2*Math.PI/e)*Math.pow(1/Math.E*(e+1/(12*e-1/(10*e))),e)}function r(){var e=this.seed;return e=4294967295&(3042594569^(e=(e=4294967295&((e=(e=4294967295&(3345072700^(e=e+2127912214+(e<<12)&4294967295)^e>>>19))+374761393+(e<<5)&4294967295)+3550635116^e<<9))+4251993797+(e<<3)&4294967295)^e>>>16),this.seed=e,(268435455&e)/268435456}e.exports=t,e.exports.random=t,e.exports.randomIterator=function(e,n){var i=n||t();if("function"!==typeof i.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(t){var n,r,o;for(n=e.length-1;n>0;--n)r=i.next(n+1),o=e[r],e[r]=e[n],e[n]=o,t(o);e.length&&t(e[0])},shuffle:function(){var t,n,r;for(t=e.length-1;t>0;--t)n=i.next(t+1),r=e[n],e[n]=e[t],e[t]=r;return e}}},n.prototype.next=function(e){return Math.floor(this.nextDouble()*e)},n.prototype.nextDouble=r,n.prototype.uniform=r,n.prototype.gaussian=function(){var e,t,n;do{e=(t=2*this.nextDouble()-1)*t+(n=2*this.nextDouble()-1)*n}while(e>=1||0===e);return t*Math.sqrt(-2*Math.log(e)/e)},n.prototype.levy=function(){var e=1.5,t=Math.pow(i(2.5)*Math.sin(Math.PI*e/2)/(i(1.25)*e*Math.pow(2,.25)),1/e);return this.gaussian()*t/Math.pow(Math.abs(this.gaussian()),1/e)}},414:e=>{e.exports=AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){const e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const e=this.data;let t;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Box3,o=[],s=new Map;return function(a){if(!this.data.enabled)return;const l=this.prevCheckTime;if(l&&a-l<this.data.interval)return;this.prevCheckTime=a;const c=this.el,u=this.data;let h;var d;c.getObject3D("mesh")&&(o.length=0,s.clear(),c.object3D.getWorldPosition(e),c.object3D.getWorldScale(n),h=u.radius*(d=n,Math.max(d.x,d.y,d.z)),this.els.forEach((function(n){let a,l,c,u;if(!n.isEntity)return;if(l=n.getObject3D("mesh"),!l)return;if(r.setFromObject(l).getSize(i),u=Math.max(i.x,i.y,i.z)/2,a=Math.sqrt(2*u*u),r.getCenter(t),!a)return;c=e.distanceTo(t),c<a+h&&(o.push(n),s.set(n,c))})),o.sort(((e,t)=>s.get(e)>s.get(t)?1:-1)).forEach(this.handleHit),this.collisions.filter((e=>!s.has(e))).forEach(this.handleHitEnd),function(e,t){e.length=0;for(let n=0;n<t.length;n++)e[n]=t[n]}(this.collisions,o))}}(),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.eventDetail.el=e,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.eventDetail.el=e,this.el.emit("hitend",this.eventDetail)}})},457:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A});var i=n(7868)},510:e=>{function t(e){const t=document.getElementById(e),n=t.parentNode;try{n&&n.removeChild(t)}catch(i){}}function n(e,n,i){return new i((function(i,r){const o=n.timeout||5e3,s="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),a=function(e,t){var n=document.createElement("script");return n.type="text/javascript",n.async=!0,n.id=t,n.src=e,n}(e,s),l=setTimeout((function(){r(new Error("Script request to "+e+" timed out")),t(s)}),o),c=function(e){clearTimeout(e)};a.addEventListener("load",(function(e){i({ok:!0}),c(l),t(s)})),a.addEventListener("error",(function(n){r(new Error("Script request to "+e+" failed "+n)),c(l),t(s)})),function(e){const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(a)}))}e.exports=function(e){return e=e||{},function(t,i){return n(t,i=i||{},e.Promise||Promise)}}},528:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler");Symbol.for("react.provider");var a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.for("react.offscreen"),m=Symbol.for("react.client.reference");function g(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case r:case s:case o:case u:case h:return e;default:switch(e=e&&e.$$typeof){case l:case c:case p:case d:case a:return e;default:return t}}case i:return t}}}t.vM=c,t.lD=d},579:(e,t,n)=>{"use strict";e.exports=n(1153)},597:(e,t,n)=>{e.exports=function(e,t){if(!e)throw new Error("Graph structure cannot be undefined");var o=(t&&t.createSimulator||n(648))(t);if(Array.isArray(t))throw new Error("Physics settings is expected to be an object");var s=e.version>19?function(t){var n=e.getLinks(t);return n?1+n.size/3:1}:function(t){var n=e.getLinks(t);return n?1+n.length/3:1};t&&"function"===typeof t.nodeMass&&(s=t.nodeMass);var a=new Map,l={},c=0,u=o.settings.springTransform||r;c=0,e.forEachNode((function(e){g(e.id),c+=1})),e.forEachLink(y),e.on("changed",m);var h=!1,d={step:function(){if(0===c)return p(!0),!0;var e=o.step();d.lastMove=e,d.fire("step");var t=e/c<=.01;return p(t),t},getNodePosition:function(e){return b(e).pos},setNodePosition:function(e){var t=b(e);t.setPosition.apply(t,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(e){var t=l[e];if(t)return{from:t.from.pos,to:t.to.pos}},getGraphRect:function(){return o.getBBox()},forEachBody:f,pinNode:function(e,t){b(e.id).isPinned=!!t},isNodePinned:function(e){return b(e.id).isPinned},dispose:function(){e.off("changed",m),d.fire("disposed")},getBody:function(e){return a.get(e)},getSpring:function(t,n){var i;if(void 0===n)i="object"!==typeof t?t:t.id;else{var r=e.hasLink(t,n);if(!r)return;i=r.id}return l[i]},getForceVectorLength:function(){var e=0,t=0;return f((function(n){e+=Math.abs(n.force.x),t+=Math.abs(n.force.y)})),Math.sqrt(e*e+t*t)},simulator:o,graph:e,lastMove:0};return i(d),d;function p(e){var t;h!==e&&(h=e,t=e,d.fire("stable",t))}function f(e){a.forEach(e)}function m(t){for(var n=0;n<t.length;++n){var i=t[n];"add"===i.changeType?(i.node&&g(i.node.id),i.link&&y(i.link)):"remove"===i.changeType&&(i.node&&v(i.node),i.link&&A(i.link))}c=e.getNodesCount()}function g(t){var n=a.get(t);if(!n){var i=e.getNode(t);if(!i)throw new Error("initBody() was called with unknown node id");var r=i.position;if(!r){var s=function(e){var t=[];if(!e.links)return t;for(var n=Math.min(e.links.length,2),i=0;i<n;++i){var r=e.links[i],o=r.fromId!==e.id?a.get(r.fromId):a.get(r.toId);o&&o.pos&&t.push(o)}return t}(i);r=o.getBestNewBodyPosition(s)}(n=o.addBodyAt(r)).id=t,a.set(t,n),x(t),function(e){return e&&(e.isPinned||e.data&&e.data.isPinned)}(i)&&(n.isPinned=!0)}}function v(e){var t=e.id,n=a.get(t);n&&(a.delete(t),o.removeBody(n))}function y(e){x(e.fromId),x(e.toId);var t=a.get(e.fromId),n=a.get(e.toId),i=o.addSpring(t,n,e.length);u(e,i),l[e.id]=i}function A(t){var n=l[t.id];if(n){var i=e.getNode(t.fromId),r=e.getNode(t.toId);i&&x(i.id),r&&x(r.id),delete l[t.id],o.removeSpring(n)}}function x(e){var t=a.get(e);if(t.mass=s(e),Number.isNaN(t.mass))throw new Error("Node mass should be a number")}function b(e){var t=a.get(e);return t||(g(e),t=a.get(e)),t}},e.exports.simulator=n(648);var i=n(8925);function r(){}},648:(e,t,n)=>{e.exports=function(e){var t=n(1768),h=n(8080),d=n(8925);if(e){if(void 0!==e.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==e.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}e=h(e,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var p=c[e.dimensions];if(!p){var f=e.dimensions;p={Body:i(f,e.debug),createQuadTree:r(f),createBounds:o(f),createDragForce:s(f),createSpringForce:a(f),integrate:l(f)},c[f]=p}var m=p.Body,g=p.createQuadTree,v=p.createBounds,y=p.createDragForce,A=p.createSpringForce,x=p.integrate,b=n(351).random(42),_=[],w=[],E=g(e,b),S=v(_,e,b),C=A(e,b),M=y(e),T=[],R=new Map,I=0;L("nbody",(function(){if(0===_.length)return;E.insertBodies(_);var e=_.length;for(;e--;){var t=_[e];t.isPinned||(t.reset(),E.updateBodyForce(t),M.update(t))}})),L("spring",(function(){var e=w.length;for(;e--;)C.update(w[e])}));var P={bodies:_,quadTree:E,springs:w,settings:e,addForce:L,removeForce:function(e){var t=T.indexOf(R.get(e));if(t<0)return;T.splice(t,1),R.delete(e)},getForces:function(){return R},step:function(){for(var t=0;t<T.length;++t)T[t](I);var n=x(_,e.timeStep,e.adaptiveTimeStepWeight);return I+=1,n},addBody:function(e){if(!e)throw new Error("Body is required");return _.push(e),e},addBodyAt:function(e){if(!e)throw new Error("Body position is required");var t=(e=>new m(e))(e);return _.push(t),t},removeBody:function(e){if(e){var t=_.indexOf(e);if(!(t<0))return _.splice(t,1),0===_.length&&S.reset(),!0}},addSpring:function(e,n,i,r){if(!e||!n)throw new Error("Cannot add null spring to force simulator");"number"!==typeof i&&(i=-1);var o=new t(e,n,i,r>=0?r:-1);return w.push(o),o},getTotalMovement:function(){return 0},removeSpring:function(e){if(e){var t=w.indexOf(e);return t>-1?(w.splice(t,1),!0):void 0}},getBestNewBodyPosition:function(e){return S.getBestNewPosition(e)},getBBox:B,getBoundingBox:B,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(t){return void 0!==t?(e.gravity=t,E.options({gravity:t}),this):e.gravity},theta:function(t){return void 0!==t?(e.theta=t,E.options({theta:t}),this):e.theta},random:b};return function(e,t){for(var n in e)u(e,t,n)}(e,P),d(P),P;function B(){return S.update(),S.box}function L(e,t){if(R.has(e))throw new Error("Force "+e+" is already added");R.set(e,t),T.push(t)}};var i=n(9230),r=n(7189),o=n(4095),s=n(3665),a=n(2010),l=n(8531),c={};function u(e,t,n){if(e.hasOwnProperty(n)&&"function"!==typeof t[n]){var i=Number.isFinite(e[n]);t[n]=i?function(i){if(void 0!==i){if(!Number.isFinite(i))throw new Error("Value of "+n+" should be a valid number.");return e[n]=i,t}return e[n]}:function(i){return void 0!==i?(e[n]=i,t):e[n]}}}},869:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});n(5043);var i=n(3290),r=n(579);function o(e){const{styles:t,defaultTheme:n={}}=e,o="function"===typeof t?e=>{return t(void 0===(i=e)||null===i||0===Object.keys(i).length?n:e);var i}:t;return(0,r.jsx)(i.mL,{styles:o})}},918:(e,t,n)=>{"use strict";function i(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}n.d(t,{A:()=>i})},950:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(3468).A},1153:(e,t,n)=>{"use strict";var i=n(5043),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,o={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,i)&&!l.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},1188:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MIN_SAFE_INTEGER,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Math.max(t,Math.min(e,n))}},1475:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(7123);const r=e=>(0,i.A)(e)&&"classes"!==e},1497:(e,t,n)=>{"use strict";var i=n(3218);function r(){}function o(){}o.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,o,s){if(s!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:r};return n.PropTypes=n,n}},1509:(e,t,n)=>{"use strict";var i=o(n(3662)),r=o(n(9019));function o(e){return e&&e.__esModule?e:{default:e}}e.exports={TransitionGroup:r.default,CSSTransitionGroup:i.default}},1587:e=>{e.exports=AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(i,r){const o=this.el,s=this.data,a=this.raycaster,l=s.speed*r/1e3;if(!s.active)return;if(!this.path.length){const t=this.el.object3D.position;this.group=this.group||this.system.getGroup(t),this.path=this.system.getPath(t,e.copy(s.destination),this.group)||[],o.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",s.destination),this.el.setAttribute("nav-agent",{active:!1}),void o.emit("navigation-end");const c=o.object3D.position,u=this.path[0];t.subVectors(u,c);let h;if(t.length()<l){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void o.emit("navigation-end");n.copy(c),h=this.path[0]}else n.copy(t.setLength(l)).add(c),h=u;h.y=c.y,o.object3D.lookAt(h),a.ray.origin.copy(n),a.ray.origin.y+=1.5,a.ray.direction={x:0,y:-1,z:0};const d=a.intersectObject(this.system.getNavMesh());d.length?(t.subVectors(d[0].point,c),c.add(t.setLength(l))):c.copy(n)}}()})},1668:(e,t,n)=>{"use strict";function i(e){return e&&e.ownerDocument||document}n.d(t,{A:()=>i})},1698:(e,t,n)=>{n(1742);const i=window.KeyboardEvent;e.exports=AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1),t.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(const e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(const e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new i(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}})},1722:(e,t,n)=>{"use strict";n.d(t,{Rk:()=>i,SF:()=>r,sk:()=>o});function i(e,t,n){var i="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):n&&(i+=n+" ")})),i}var r=function(e,t,n){var i=e.key+"-"+t.name;!1===n&&void 0===e.registered[i]&&(e.registered[i]=t.styles)},o=function(e,t,n){r(e,t,n);var i=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var o=t;do{e.insert(t===o?"."+i:"",o,e.sheet,!0),o=o.next}while(void 0!==o)}}},1742:()=>{!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var n=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,i=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,r=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,o=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function s(e,t){return-1!==String(e).indexOf(t)}var a=s(navigator.platform,"Win")?"win":s(navigator.platform,"Mac")?"mac":s(navigator.platform,"CrOS")?"cros":s(navigator.platform,"Linux")?"linux":s(navigator.userAgent,"iPad")||s(navigator.platform,"iPod")||s(navigator.platform,"iPhone")?"ios":"",l=s(navigator.userAgent,"Chrome/")?"chrome":s(navigator.vendor,"Apple")?"safari":s(navigator.userAgent,"MSIE")?"ie":s(navigator.userAgent,"Gecko/")?"moz":s(navigator.userAgent,"Opera/")?"opera":"",c=l+"-"+a;function u(e,t,n){c!==t&&l!==t&&a!==t||Object.keys(n).forEach((function(t){e[t]=n[t]}))}var h={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:i},92:{code:"OSRight",location:r},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:o},97:{code:"Numpad1",keyCap:"1",location:o},98:{code:"Numpad2",keyCap:"2",location:o},99:{code:"Numpad3",keyCap:"3",location:o},100:{code:"Numpad4",keyCap:"4",location:o},101:{code:"Numpad5",keyCap:"5",location:o},102:{code:"Numpad6",keyCap:"6",location:o},103:{code:"Numpad7",keyCap:"7",location:o},104:{code:"Numpad8",keyCap:"8",location:o},105:{code:"Numpad9",keyCap:"9",location:o},106:{code:"NumpadMultiply",keyCap:"*",location:o},107:{code:"NumpadAdd",keyCap:"+",location:o},108:{code:"NumpadComma",keyCap:",",location:o},109:{code:"NumpadSubtract",keyCap:"-",location:o},110:{code:"NumpadDecimal",keyCap:".",location:o},111:{code:"NumpadDivide",keyCap:"/",location:o},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:o},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:i},161:{code:"ShiftRight",location:r},162:{code:"ControlLeft",location:i},163:{code:"ControlRight",location:r},164:{code:"AltLeft",location:i},165:{code:"AltRight",location:r},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};u(h,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:o},189:{code:"NumpadSubtract",keyCap:"-",location:o}}),u(h,"moz-mac",{12:{code:"NumLock",location:o},173:{code:"Minus",keyCap:"-"}}),u(h,"moz-win",{173:{code:"Minus",keyCap:"-"}}),u(h,"chrome-mac",{93:{code:"OSRight",location:r}}),u(h,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),u(h,"ios",{10:{code:"Enter",location:n}}),u(h,"safari-mac",{91:{code:"OSLeft",location:i},93:{code:"OSRight",location:r},229:{code:"KeyQ",keyCap:"Q"}});var d={};"cros"===a&&(d["U+00A0"]={code:"ShiftLeft",location:i},d["U+00A1"]={code:"ShiftRight",location:r},d["U+00A2"]={code:"ControlLeft",location:i},d["U+00A3"]={code:"ControlRight",location:r},d["U+00A4"]={code:"AltLeft",location:i},d["U+00A5"]={code:"AltRight",location:r}),"chrome-mac"===c&&(d["U+0010"]={code:"ContextMenu"}),"safari-mac"===c&&(d["U+0010"]={code:"ContextMenu"}),"ios"===a&&(d["U+0010"]={code:"Function"},d["U+001C"]={code:"ArrowLeft"},d["U+001D"]={code:"ArrowRight"},d["U+001E"]={code:"ArrowUp"},d["U+001F"]={code:"ArrowDown"},d["U+0001"]={code:"Home"},d["U+0004"]={code:"End"},d["U+000B"]={code:"PageUp"},d["U+000C"]={code:"PageDown"});var p=[];p[i]={16:{code:"ShiftLeft",location:i},17:{code:"ControlLeft",location:i},18:{code:"AltLeft",location:i}},p[r]={16:{code:"ShiftRight",location:r},17:{code:"ControlRight",location:r},18:{code:"AltRight",location:r}},p[o]={13:{code:"NumpadEnter",location:o}},u(p[o],"moz",{109:{code:"NumpadSubtract",location:o},107:{code:"NumpadAdd",location:o}}),u(p[i],"moz-mac",{224:{code:"OSLeft",location:i}}),u(p[r],"moz-mac",{224:{code:"OSRight",location:r}}),u(p[r],"moz-win",{91:{code:"OSRight",location:r}}),u(p[r],"mac",{93:{code:"OSRight",location:r}}),u(p[o],"chrome-mac",{12:{code:"NumLock",location:o}}),u(p[o],"safari-mac",{12:{code:"NumLock",location:o},187:{code:"NumpadAdd",location:o},189:{code:"NumpadSubtract",location:o},190:{code:"NumpadDecimal",location:o},191:{code:"NumpadDivide",location:o}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};u(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},g=function(e,t){var n={};return Object.keys(e).forEach((function(i){var r=e[i];t in r&&(n[r[t]]=r)})),n}(h,"code");try{var v=t&&"location"in new KeyboardEvent("")}catch(A){}function y(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,n=function(){if(v||"keyLocation"in e){var n=v?e.location:e.keyLocation;if(n&&t in p[n])return p[n][t]}return"keyIdentifier"in e&&e.keyIdentifier in d?d[e.keyIdentifier]:t in h?h[t]:null}();if(!n)return null;var i=function(){var t=f[n.code];return t?e.shiftKey&&"shiftKey"in t?t.shiftKey:t.key:n.code}();return{code:n.code,key:i,location:n.location,keyCap:n.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,n){t in e||Object.defineProperty(e,t,n)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=y(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return m.hasOwnProperty(e)?m[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=y(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=y(this);return e&&"location"in e?e.location:n}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!g.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var n=g[e];return n.keyCap||n.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=y(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:n,e.locale=""}}}(window)},1750:e=>{e.exports.Primitive=AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),e.exports.Component=AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const e=this.el,t=this.data;let n=e.components.material;if(!t.path.length)return void console.error("[a-tube] `path` property expected but not found.");const i=new THREE.CatmullRomCurve3(t.path.map((function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))}))),r=new THREE.TubeGeometry(i,t.segments,t.radius,t.radialSegments,t.closed);n||(n={},n.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(r,n.material),this.el.setObject3D("mesh",this.mesh)},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},1768:e=>{e.exports=function(e,t,n,i){this.from=e,this.to=t,this.length=n,this.coefficient=i}},1782:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(5043),r=n(4440);const o=function(e){const t=i.useRef(e);return(0,r.A)((()=>{t.current=e})),i.useRef((function(){return(0,t.current)(...arguments)})).current}},1928:(e,t,n)=>{const i=n(3746);e.exports=function(e){return function(t,n){let r=n&&n.indent||0,o=n&&void 0!==n.join?n.join:"\n",s=Array(r+1).join(" "),a=[];for(let l=0;l<e;++l){let e=i(l),n=0===l?"":s;a.push(n+t.replace(/{var}/g,e))}return a.join(o)}}},1933:(e,t,n)=>{"use strict";var i=n(4994);t.__esModule=!0,t.default=t.animationEnd=t.animationDelay=t.animationTiming=t.animationDuration=t.animationName=t.transitionEnd=t.transitionDuration=t.transitionDelay=t.transitionTiming=t.transitionProperty=t.transform=void 0;var r,o,s,a,l,c,u,h,d,p,f,m=i(n(4428)),g="transform";if(t.transform=g,t.animationEnd=s,t.transitionEnd=o,t.transitionDelay=u,t.transitionTiming=c,t.transitionDuration=l,t.transitionProperty=a,t.animationDelay=f,t.animationTiming=p,t.animationDuration=d,t.animationName=h,m.default){var v=function(){for(var e,t,n=document.createElement("div").style,i={O:function(e){return"o"+e.toLowerCase()},Moz:function(e){return e.toLowerCase()},Webkit:function(e){return"webkit"+e},ms:function(e){return"MS"+e}},r=Object.keys(i),o="",s=0;s<r.length;s++){var a=r[s];if(a+"TransitionProperty"in n){o="-"+a.toLowerCase(),e=i[a]("TransitionEnd"),t=i[a]("AnimationEnd");break}}!e&&"transitionProperty"in n&&(e="transitionend");!t&&"animationName"in n&&(t="animationend");return n=null,{animationEnd:t,transitionEnd:e,prefix:o}}();r=v.prefix,t.transitionEnd=o=v.transitionEnd,t.animationEnd=s=v.animationEnd,t.transform=g=r+"-"+g,t.transitionProperty=a=r+"-transition-property",t.transitionDuration=l=r+"-transition-duration",t.transitionDelay=u=r+"-transition-delay",t.transitionTiming=c=r+"-transition-timing-function",t.animationName=h=r+"-animation-name",t.animationDuration=d=r+"-animation-duration",t.animationTiming=p=r+"-animation-delay",t.animationDelay=f=r+"-animation-timing-function"}var y={transform:g,end:o,property:a,timing:c,delay:u,duration:l};t.default=y},2010:(e,t,n)=>{const i=n(1928);function r(e){let t=i(e);return`\n  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');\n  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');\n\n  return {\n    /**\n     * Updates forces acting on a spring\n     */\n    update: function (spring) {\n      var body1 = spring.from;\n      var body2 = spring.to;\n      var length = spring.length < 0 ? options.springLength : spring.length;\n      ${t("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}\n      var r = Math.sqrt(${t("d{var} * d{var}",{join:" + "})});\n\n      if (r === 0) {\n        ${t("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}\n        r = Math.sqrt(${t("d{var} * d{var}",{join:" + "})});\n      }\n\n      var d = r - length;\n      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;\n\n      ${t("body1.force.{var} += coefficient * d{var}",{indent:6})};\n      body1.springCount += 1;\n      body1.springLength += r;\n\n      ${t("body2.force.{var} -= coefficient * d{var}",{indent:6})};\n      body2.springCount += 1;\n      body2.springLength += r;\n    }\n  };\n`}e.exports=function(e){let t=r(e);return new Function("options","random",t)},e.exports.generateCreateSpringForceFunctionBody=r},2022:(e,t,n)=>{const i=n(5591),r=n(9823),o=.2,s="left",a="right",l=1,c=2;e.exports=AFRAME.registerComponent("gamepad-controls",{GamepadButton:i,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){const e=this.el.sceneEl;this.system=e.systems["tracked-controls"]||e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=t.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=t.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(l,t);const n=e.x||t.x,i=e.y||t.y;return Math.abs(n)>o||Math.abs(i)>o},getVelocityDelta:function(){const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(l,t);const n=e.x||t.x,i=e.y||t.y,r=new THREE.Vector3;return Math.abs(n)>o&&(r.x+=n),Math.abs(i)>o&&(r.z+=i),r},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._lookVector;return this.getJoystick(c,e),Math.abs(e.x)>o||Math.abs(e.y)>o},updateRotation:function(e){if(!this.isRotationActive())return;const t=this.data,n=this.yaw,i=this.pitch;n.rotation.y=this.el.object3D.rotation.y,i.rotation.x=this.el.object3D.rotation.x;const r=this._lookVector;this.getJoystick(c,r),Math.abs(r.x)<=o&&(r.x=0),Math.abs(r.y)<=o&&(r.y=0),r.multiplyScalar(t.rotationSensitivity*e/1e3),n.rotation.y-=r.x,i.rotation.x-=r.y,i.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,i.rotation.x)),this.el.object3D.rotation.set(i.rotation.x,n.rotation.y,0)},updateButtonState:function(){const e=this.getGamepad(a);if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new r("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new r("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else for(const n in this.buttons)this.buttons[n]=!1},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new r(e.type,e.index,e))},getGamepad:function(){const e=[],t=[];return function(n){const i=this.el.sceneEl.components["proxy-controls"],r=i&&i.isConnected()&&i.getGamepad(0);if(r)return r;e.length=0;for(let t=0;t<this.system.controllers.length;t++){const i=this.system.controllers[t],r=i?i.gamepad:null;if(e.push(r),r&&i.handedness===n)return r}const o=navigator.getGamepads?navigator.getGamepads():t;for(let e=0;e<o.length;e++){const t=o[e];if(t&&t.hand===n)return t}return e[0]||o[0]}}(),getButton:function(e){return this.getGamepad(a).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?a:s).axes[e]},getJoystick:function(e,t){const n=this.getGamepad(e===l?s:a);if(!n)return t.set(0,0);if("xr-standard"===n.mapping)switch(e){case l:return t.set(n.axes[2],n.axes[3]);case c:return t.set(n.axes[2],0)}else switch(e){case l:return t.set(n.axes[0],n.axes[1]);case c:return t.set(n.axes[2],n.axes[3])}throw new Error('Unexpected joystick index "%d".',e)},getDpad:function(e){const t=this.getGamepad(s);return t&&t.buttons[i.DPAD_RIGHT]?e.set((t.buttons[i.DPAD_RIGHT].pressed?1:0)+(t.buttons[i.DPAD_LEFT].pressed?-1:0),(t.buttons[i.DPAD_UP].pressed?-1:0)+(t.buttons[i.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){const e=this.getGamepad(s);return!(!e||!e.connected)},getID:function(){return this.getGamepad(s).id}})},2206:(e,t,n)=>{n(3078),n(9760),n(3886),n(8649),n(414)},2372:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>o});var i=n(9386);const r={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const o=r[t];return o?`${n}-${o}`:`${i.A.generate(e)}-${t}`}},2427:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(1668).A},2456:(e,t,n)=>{"use strict";function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>null==t?e:function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];e.apply(this,i),t.apply(this,i)}),(()=>{}))}n.d(t,{A:()=>i})},2505:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},2532:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(2372);function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const r={};return t.forEach((t=>{r[t]=(0,i.Ay)(e,t,n)})),r}},2647:(e,t,n)=>{"use strict";var i=n(4994);t.__esModule=!0,t.default=void 0;var r,o=i(n(4428)),s="clearTimeout",a=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-c)),i=setTimeout(e,n);return c=t,i},l=function(e,t){return e+(e?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};o.default&&["","webkit","moz","o","ms"].some((function(e){var t=l(e,"request");if(t in window)return s=l(e,"cancel"),a=function(e){return window[t](e)}}));var c=(new Date).getTime();(r=function(e){return a(e)}).cancel=function(e){window[s]&&"function"===typeof window[s]&&window[s](e)};var u=r;t.default=u,e.exports=t.default},2730:(e,n,i)=>{"use strict";var r=i(5043),o=i(8853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(l[e]=t,e=0;e<t.length;e++)a.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},m={};function g(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function A(e){return e[1].toUpperCase()}function x(e,t,n,i){var r=v.hasOwnProperty(t)?v[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!d.call(m,e)||!d.call(f,e)&&(p.test(e)?m[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,A);v[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,A);v[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,A);v[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),w=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),T=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var D=Symbol.iterator;function k(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=D&&e[D]||e["@@iterator"])?e:null}var O,U=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var z=!1;function j(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),o=i.stack.split("\n"),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||r[s]!==o[a]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function V(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=j(e.type,!1);case 11:return e=j(e.type.render,!1);case 1:return e=j(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case E:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case B:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=Q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=Q(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function $(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function K(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function Z(e,t){J(e,t);var n=W(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?te(e,t.type,n):t.hasOwnProperty("defaultValue")&&te(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ee(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function te(e,t,n){"number"===t&&$(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ne=Array.isArray;function ie(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(ne(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function se(e,t){var n=W(t.value),i=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?le(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,he,de=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=ge(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fe).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ye=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ae(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Ee=null,Se=null;function Ce(e){if(e=xr(e)){if("function"!==typeof we)throw Error(s(280));var t=e.stateNode;t&&(t=_r(t),we(e.stateNode,e.type,t))}}function Me(e){Ee?Se?Se.push(e):Se=[e]:Ee=e}function Te(){if(Ee){var e=Ee,t=Se;if(Se=Ee=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Re(e,t){return e(t)}function Ie(){}var Pe=!1;function Be(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Re(e,t,n)}finally{Pe=!1,(null!==Ee||null!==Se)&&(Ie(),Te())}}function Le(e,t){var n=e.stateNode;if(null===n)return null;var i=_r(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Ne=!1;if(h)try{var De={};Object.defineProperty(De,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(he){Ne=!1}function ke(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Ue=null,Fe=!1,ze=null,je={onError:function(e){Oe=!0,Ue=e}};function Ve(e,t,n,i,r,o,s,a,l){Oe=!1,Ue=null,ke.apply(je,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ge(e)!==e)throw Error(s(188))}function Qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return We(r),e;if(o===i)return We(r),t;o=o.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=o;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=o;break}if(l===i){a=!0,i=r,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=r;break}if(l===i){a=!0,i=o,n=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Xe=o.unstable_scheduleCallback,$e=o.unstable_cancelCallback,Ye=o.unstable_shouldYield,Ke=o.unstable_requestPaint,Je=o.unstable_now,Ze=o.unstable_getCurrentPriorityLevel,et=o.unstable_ImmediatePriority,tt=o.unstable_UserBlockingPriority,nt=o.unstable_NormalPriority,it=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(lt(e)/ct|0)|0},lt=Math.log,ct=Math.LN2;var ut=64,ht=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function pt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~r;0!==a?i=dt(a):0!==(o&=s)&&(i=dt(o))}else 0!==(s=n&~r)?i=dt(s):0!==o&&(i=dt(o));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(o=t&-t)||16===r&&0!==(4194240&o)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-at(t)),i|=e[n],t&=~r;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function mt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function At(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-at(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,wt,Et,St,Ct,Mt=!1,Tt=[],Rt=null,It=null,Pt=null,Bt=new Map,Lt=new Map,Nt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Bt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lt.delete(t.pointerId)}}function Ot(e,t,n,i,r,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},null!==t&&(null!==(t=xr(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ut(e){var t=Ar(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void Ct(e.priority,(function(){Et(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xr(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);be=i,n.target.dispatchEvent(i),be=null,t.shift()}return!0}function zt(e,t,n){Ft(e)&&n.delete(t)}function jt(){Mt=!1,null!==Rt&&Ft(Rt)&&(Rt=null),null!==It&&Ft(It)&&(It=null),null!==Pt&&Ft(Pt)&&(Pt=null),Bt.forEach(zt),Lt.forEach(zt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Mt||(Mt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,jt)))}function Gt(e){function t(t){return Vt(t,e)}if(0<Tt.length){Vt(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Rt&&Vt(Rt,e),null!==It&&Vt(It,e),null!==Pt&&Vt(Pt,e),Bt.forEach(t),Lt.forEach(t),n=0;n<Nt.length;n++)(i=Nt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Nt.length&&null===(n=Nt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Nt.shift()}var Ht=b.ReactCurrentBatchConfig,Wt=!0;function Qt(e,t,n,i){var r=xt,o=Ht.transition;Ht.transition=null;try{xt=1,Xt(e,t,n,i)}finally{xt=r,Ht.transition=o}}function qt(e,t,n,i){var r=xt,o=Ht.transition;Ht.transition=null;try{xt=4,Xt(e,t,n,i)}finally{xt=r,Ht.transition=o}}function Xt(e,t,n,i){if(Wt){var r=Yt(e,t,n,i);if(null===r)Wi(e,t,i,$t,n),kt(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Rt=Ot(Rt,e,t,n,i,r),!0;case"dragenter":return It=Ot(It,e,t,n,i,r),!0;case"mouseover":return Pt=Ot(Pt,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return Bt.set(o,Ot(Bt.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,Lt.set(o,Ot(Lt.get(o)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(kt(e,i),4&t&&-1<Dt.indexOf(e)){for(;null!==r;){var o=xr(r);if(null!==o&&_t(o),null===(o=Yt(e,t,n,i))&&Wi(e,t,i,$t,n),o===r)break;r=o}null!==r&&i.stopPropagation()}else Wi(e,t,i,null,n)}}var $t=null;function Yt(e,t,n,i){if($t=null,null!==(e=Ar(e=_e(i))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return $t=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case et:return 1;case tt:return 4;case nt:case it:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,en=null;function tn(){if(en)return en;var e,t,n=Zt,i=n.length,r="value"in Jt?Jt.value:Jt.textContent,o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);return en=r.slice(e,1<t?1-t:void 0)}function nn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function on(){return!1}function sn(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?rn:on,this.isPropagationStopped=on,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var an,ln,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hn=sn(un),dn=U({},un,{view:0,detail:0}),pn=sn(dn),fn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(an=e.screenX-cn.screenX,ln=e.screenY-cn.screenY):ln=an=0,cn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),mn=sn(fn),gn=sn(U({},fn,{dataTransfer:0})),vn=sn(U({},dn,{relatedTarget:0})),yn=sn(U({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),An=U({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=sn(An),bn=sn(U({},un,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},En={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=En[e])&&!!t[e]}function Cn(){return Sn}var Mn=U({},dn,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?nn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=sn(Mn),Rn=sn(U({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=sn(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Pn=sn(U({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),Bn=U({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ln=sn(Bn),Nn=[9,13,27,32],Dn=h&&"CompositionEvent"in window,kn=null;h&&"documentMode"in document&&(kn=document.documentMode);var On=h&&"TextEvent"in window&&!kn,Un=h&&(!Dn||kn&&8<kn&&11>=kn),Fn=String.fromCharCode(32),zn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Qn(e,t,n,i){Me(i),0<(t=qi(t,"onChange")).length&&(n=new hn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var qn=null,Xn=null;function $n(e){Fi(e,0)}function Yn(e){if(X(br(e)))return e}function Kn(e,t){if("change"===e)return t}var Jn=!1;if(h){var Zn;if(h){var ei="oninput"in document;if(!ei){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),ei="function"===typeof ti.oninput}Zn=ei}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function ni(){qn&&(qn.detachEvent("onpropertychange",ii),Xn=qn=null)}function ii(e){if("value"===e.propertyName&&Yn(Xn)){var t=[];Qn(t,Xn,e,_e(e)),Be($n,t)}}function ri(e,t,n){"focusin"===e?(ni(),Xn=n,(qn=t).attachEvent("onpropertychange",ii)):"focusout"===e&&ni()}function oi(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Xn)}function si(e,t){if("click"===e)return Yn(t)}function ai(e,t){if("input"===e||"change"===e)return Yn(t)}var li="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ci(e,t){if(li(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!d.call(t,r)||!li(e[r],t[r]))return!1}return!0}function ui(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hi(e,t){var n,i=ui(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ui(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pi(){for(var e=window,t=$();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=$((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mi(e){var t=pi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=void 0===i.end?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=hi(n,o);var s=hi(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gi=h&&"documentMode"in document&&11>=document.documentMode,vi=null,yi=null,Ai=null,xi=!1;function bi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xi||null==vi||vi!==$(i)||("selectionStart"in(i=vi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},Ai&&ci(Ai,i)||(Ai=i,0<(i=qi(yi,"onSelect")).length&&(t=new hn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=vi)))}function _i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionend:_i("Transition","TransitionEnd")},Ei={},Si={};function Ci(e){if(Ei[e])return Ei[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Si)return Ei[e]=n[t];return e}h&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Mi=Ci("animationend"),Ti=Ci("animationiteration"),Ri=Ci("animationstart"),Ii=Ci("transitionend"),Pi=new Map,Bi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Li(e,t){Pi.set(e,t),c(t,[e])}for(var Ni=0;Ni<Bi.length;Ni++){var Di=Bi[Ni];Li(Di.toLowerCase(),"on"+(Di[0].toUpperCase()+Di.slice(1)))}Li(Mi,"onAnimationEnd"),Li(Ti,"onAnimationIteration"),Li(Ri,"onAnimationStart"),Li("dblclick","onDoubleClick"),Li("focusin","onFocus"),Li("focusout","onBlur"),Li(Ii,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ki="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(ki));function Ui(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,a,l,c){if(Ve.apply(this,arguments),Oe){if(!Oe)throw Error(s(198));var u=Ue;Oe=!1,Ue=null,Fe||(Fe=!0,ze=u)}}(i,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Ui(r,a,c),o=l}else for(s=0;s<i.length;s++){if(l=(a=i[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Ui(r,a,c),o=l}}}if(Fe)throw e=ze,Fe=!1,ze=null,e}function zi(e,t){var n=t[gr];void 0===n&&(n=t[gr]=new Set);var i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}function ji(e,t,n){var i=0;t&&(i|=4),Hi(n,e,i,t)}var Vi="_reactListening"+Math.random().toString(36).slice(2);function Gi(e){if(!e[Vi]){e[Vi]=!0,a.forEach((function(t){"selectionchange"!==t&&(Oi.has(t)||ji(t,!1,e),ji(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vi]||(t[Vi]=!0,ji("selectionchange",!1,t))}}function Hi(e,t,n,i){switch(Kt(t)){case 1:var r=Qt;break;case 4:r=qt;break;default:r=Xt}n=r.bind(null,t,n,e),r=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Wi(e,t,n,i,r){var o=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var a=i.stateNode.containerInfo;if(a===r||8===a.nodeType&&a.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==a;){if(null===(s=Ar(a)))return;if(5===(l=s.tag)||6===l){i=o=s;continue e}a=a.parentNode}}i=i.return}Be((function(){var i=o,r=_e(n),s=[];e:{var a=Pi.get(e);if(void 0!==a){var l=hn,c=e;switch(e){case"keypress":if(0===nn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=vn;break;case"focusout":c="blur",l=vn;break;case"beforeblur":case"afterblur":l=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Mi:case Ti:case Ri:l=yn;break;case Ii:l=Pn;break;case"scroll":l=pn;break;case"wheel":l=Ln;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Le(f,d))&&u.push(Qi(f,m,p)))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,r),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!Ar(c)&&!c[mr])&&(l||a)&&(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?Ar(c):null)&&(c!==(h=Ge(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=mn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:br(l),p=null==c?a:br(c),(a=new u(m,f+"leave",l,n,r)).target=h,a.relatedTarget=p,m=null,Ar(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Xi(p))f++;for(p=0,m=d;m;m=Xi(m))p++;for(;0<f-p;)u=Xi(u),f--;for(;0<p-f;)d=Xi(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Xi(u),d=Xi(d)}u=null}else u=null;null!==l&&$i(s,a,l,u,!1),null!==c&&null!==h&&$i(s,h,c,u,!0)}if("select"===(l=(a=i?br(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Kn;else if(Wn(a))if(Jn)g=ai;else{g=oi;var v=ri}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=si);switch(g&&(g=g(e,i))?Qn(s,g,n,r):(v&&v(e,a,i),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&te(a,"number",a.value)),v=i?br(i):window,e){case"focusin":(Wn(v)||"true"===v.contentEditable)&&(vi=v,yi=i,Ai=null);break;case"focusout":Ai=yi=vi=null;break;case"mousedown":xi=!0;break;case"contextmenu":case"mouseup":case"dragend":xi=!1,bi(s,n,r);break;case"selectionchange":if(gi)break;case"keydown":case"keyup":bi(s,n,r)}var y;if(Dn)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Gn?jn(e,n)&&(A="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(A="onCompositionStart");A&&(Un&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==A?"onCompositionEnd"===A&&Gn&&(y=tn()):(Zt="value"in(Jt=r)?Jt.value:Jt.textContent,Gn=!0)),0<(v=qi(i,A)).length&&(A=new bn(A,e,null,n,r),s.push({event:A,listeners:v}),y?A.data=y:null!==(y=Vn(n))&&(A.data=y))),(y=On?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(zn=!0,Fn);case"textInput":return(e=t.data)===Fn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Dn&&jn(e,t)?(e=tn(),en=Zt=Jt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=qi(i,"onBeforeInput")).length&&(r=new bn("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=y))}Fi(s,t)}))}function Qi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qi(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,o=r.stateNode;5===r.tag&&null!==o&&(r=o,null!=(o=Le(e,n))&&i.unshift(Qi(e,o,r)),null!=(o=Le(e,t))&&i.push(Qi(e,o,r))),e=e.return}return i}function Xi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $i(e,t,n,i,r){for(var o=t._reactName,s=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,r?null!=(l=Le(n,o))&&s.unshift(Qi(n,l,a)):r||null!=(l=Le(n,o))&&s.push(Qi(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Yi=/\r\n?/g,Ki=/\u0000|\uFFFD/g;function Ji(e){return("string"===typeof e?e:""+e).replace(Yi,"\n").replace(Ki,"")}function Zi(e,t,n){if(t=Ji(t),Ji(e)!==t&&n)throw Error(s(425))}function er(){}var tr=null,nr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rr="function"===typeof setTimeout?setTimeout:void 0,or="function"===typeof clearTimeout?clearTimeout:void 0,sr="function"===typeof Promise?Promise:void 0,ar="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sr?function(e){return sr.resolve(null).then(e).catch(lr)}:rr;function lr(e){setTimeout((function(){throw e}))}function cr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void Gt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Gt(t)}function ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),pr="__reactFiber$"+dr,fr="__reactProps$"+dr,mr="__reactContainer$"+dr,gr="__reactEvents$"+dr,vr="__reactListeners$"+dr,yr="__reactHandles$"+dr;function Ar(e){var t=e[pr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mr]||n[pr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=hr(e);null!==e;){if(n=e[pr])return n;e=hr(e)}return t}n=(e=n).parentNode}return null}function xr(e){return!(e=e[pr]||e[mr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function br(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function _r(e){return e[fr]||null}var wr=[],Er=-1;function Sr(e){return{current:e}}function Cr(e){0>Er||(e.current=wr[Er],wr[Er]=null,Er--)}function Mr(e,t){Er++,wr[Er]=e.current,e.current=t}var Tr={},Rr=Sr(Tr),Ir=Sr(!1),Pr=Tr;function Br(e,t){var n=e.type.contextTypes;if(!n)return Tr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in n)o[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Lr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Nr(){Cr(Ir),Cr(Rr)}function Dr(e,t,n){if(Rr.current!==Tr)throw Error(s(168));Mr(Rr,t),Mr(Ir,n)}function kr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(s(108,H(e)||"Unknown",r));return U({},n,i)}function Or(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Tr,Pr=Rr.current,Mr(Rr,e),Mr(Ir,Ir.current),!0}function Ur(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=kr(e,t,Pr),i.__reactInternalMemoizedMergedChildContext=e,Cr(Ir),Cr(Rr),Mr(Rr,e)):Cr(Ir),Mr(Ir,n)}var Fr=null,zr=!1,jr=!1;function Vr(e){null===Fr?Fr=[e]:Fr.push(e)}function Gr(){if(!jr&&null!==Fr){jr=!0;var e=0,t=xt;try{var n=Fr;for(xt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Fr=null,zr=!1}catch(r){throw null!==Fr&&(Fr=Fr.slice(e+1)),Xe(et,Gr),r}finally{xt=t,jr=!1}}return null}var Hr=[],Wr=0,Qr=null,qr=0,Xr=[],$r=0,Yr=null,Kr=1,Jr="";function Zr(e,t){Hr[Wr++]=qr,Hr[Wr++]=Qr,Qr=e,qr=t}function eo(e,t,n){Xr[$r++]=Kr,Xr[$r++]=Jr,Xr[$r++]=Yr,Yr=e;var i=Kr;e=Jr;var r=32-at(i)-1;i&=~(1<<r),n+=1;var o=32-at(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Kr=1<<32-at(t)+r|n<<r|i,Jr=o+e}else Kr=1<<o|n<<r|i,Jr=e}function to(e){null!==e.return&&(Zr(e,1),eo(e,1,0))}function no(e){for(;e===Qr;)Qr=Hr[--Wr],Hr[Wr]=null,qr=Hr[--Wr],Hr[Wr]=null;for(;e===Yr;)Yr=Xr[--$r],Xr[$r]=null,Jr=Xr[--$r],Xr[$r]=null,Kr=Xr[--$r],Xr[$r]=null}var io=null,ro=null,oo=!1,so=null;function ao(e,t){var n=Bc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function lo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,io=e,ro=ur(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,io=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yr?{id:Kr,overflow:Jr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Bc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,io=e,ro=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function uo(e){if(oo){var t=ro;if(t){var n=t;if(!lo(e,t)){if(co(e))throw Error(s(418));t=ur(n.nextSibling);var i=io;t&&lo(e,t)?ao(i,n):(e.flags=-4097&e.flags|2,oo=!1,io=e)}}else{if(co(e))throw Error(s(418));e.flags=-4097&e.flags|2,oo=!1,io=e}}}function ho(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;io=e}function po(e){if(e!==io)return!1;if(!oo)return ho(e),oo=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=ro)){if(co(e))throw fo(),Error(s(418));for(;t;)ao(e,t),t=ur(t.nextSibling)}if(ho(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ur(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=io?ur(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ur(e.nextSibling)}function mo(){ro=io=null,oo=!1}function go(e){null===so?so=[e]:so.push(e)}var vo=b.ReactCurrentBatchConfig;function yo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Ao(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function xo(e){return(0,e._init)(e._payload)}function bo(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Nc(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Uc(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,i){var o=n.type;return o===E?h(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===L&&xo(o)===t.type)?((i=r(t,n.props)).ref=yo(e,t,n),i.return=e,i):((i=Dc(n.type,n.key,n.props,null,e.mode,i)).ref=yo(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function h(e,t,n,i,o){return null===t||7!==t.tag?((t=kc(n,e.mode,i,o)).return=e,t):((t=r(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=Dc(t.type,t.key,t.props,null,e.mode,n)).ref=yo(e,null,t),n.return=e,n;case w:return(t=Fc(t,e.mode,n)).return=e,t;case L:return d(e,(0,t._init)(t._payload),n)}if(ne(t)||k(t))return(t=kc(t,e.mode,n,null)).return=e,t;Ao(e,t)}return null}function p(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===r?c(e,t,n,i):null;case w:return n.key===r?u(e,t,n,i):null;case L:return p(e,t,(r=n._init)(n._payload),i)}if(ne(n)||k(n))return null!==r?null:h(e,t,n,i,null);Ao(e,n)}return null}function f(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case L:return f(e,t,n,(0,i._init)(i._payload),r)}if(ne(i)||k(i))return h(t,e=e.get(n)||null,i,r,null);Ao(t,i)}return null}function m(r,s,a,l){for(var c=null,u=null,h=s,m=s=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=p(r,h,a[m],l);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(r,h),s=o(v,s,m),null===u?c=v:u.sibling=v,u=v,h=g}if(m===a.length)return n(r,h),oo&&Zr(r,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(r,a[m],l))&&(s=o(h,s,m),null===u?c=h:u.sibling=h,u=h);return oo&&Zr(r,m),c}for(h=i(r,h);m<a.length;m++)null!==(g=f(h,r,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(r,e)})),oo&&Zr(r,m),c}function g(r,a,l,c){var u=k(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,m=a,g=a=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var A=p(r,m,y.value,c);if(null===A){null===m&&(m=v);break}e&&m&&null===A.alternate&&t(r,m),a=o(A,a,g),null===h?u=A:h.sibling=A,h=A,m=v}if(y.done)return n(r,m),oo&&Zr(r,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(r,y.value,c))&&(a=o(y,a,g),null===h?u=y:h.sibling=y,h=y);return oo&&Zr(r,g),u}for(m=i(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),a=o(y,a,g),null===h?u=y:h.sibling=y,h=y);return e&&m.forEach((function(e){return t(r,e)})),oo&&Zr(r,g),u}return function e(i,o,s,l){if("object"===typeof s&&null!==s&&s.type===E&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case _:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===E){if(7===u.tag){n(i,u.sibling),(o=r(u,s.props.children)).return=i,i=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===L&&xo(c)===u.type){n(i,u.sibling),(o=r(u,s.props)).ref=yo(i,u,s),o.return=i,i=o;break e}n(i,u);break}t(i,u),u=u.sibling}s.type===E?((o=kc(s.props.children,i.mode,l,s.key)).return=i,i=o):((l=Dc(s.type,s.key,s.props,null,i.mode,l)).ref=yo(i,o,s),l.return=i,i=l)}return a(i);case w:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(i,o.sibling),(o=r(o,s.children||[])).return=i,i=o;break e}n(i,o);break}t(i,o),o=o.sibling}(o=Fc(s,i.mode,l)).return=i,i=o}return a(i);case L:return e(i,o,(u=s._init)(s._payload),l)}if(ne(s))return m(i,o,s,l);if(k(s))return g(i,o,s,l);Ao(i,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(i,o.sibling),(o=r(o,s)).return=i,i=o):(n(i,o),(o=Uc(s,i.mode,l)).return=i,i=o),a(i)):n(i,o)}}var _o=bo(!0),wo=bo(!1),Eo=Sr(null),So=null,Co=null,Mo=null;function To(){Mo=Co=So=null}function Ro(e){var t=Eo.current;Cr(Eo),e._currentValue=t}function Io(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Po(e,t){So=e,Mo=Co=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xa=!0),e.firstContext=null)}function Bo(e){var t=e._currentValue;if(Mo!==e)if(e={context:e,memoizedValue:t,next:null},null===Co){if(null===So)throw Error(s(308));Co=e,So.dependencies={lanes:0,firstContext:e}}else Co=Co.next=e;return t}var Lo=null;function No(e){null===Lo?Lo=[e]:Lo.push(e)}function Do(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,No(t)):(n.next=r.next,r.next=n),t.interleaved=n,ko(e,i)}function ko(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oo=!1;function Uo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function jo(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Rl)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,ko(e,n)}return null===(r=i.interleaved)?(t.next=t,No(i)):(t.next=r.next,r.next=t),i.interleaved=t,ko(e,n)}function Vo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,At(e,n)}}function Go(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?r=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?r=o=t:o=o.next=t}else r=o=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ho(e,t,n,i){var r=e.updateQueue;Oo=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=r.baseState;for(s=0,u=c=l=null,a=o;;){var d=a.lane,p=a.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(d=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,h,d):f)||void 0===d)break e;h=U({},h,d);break e;case 2:Oo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(a=a.next)){if(null===(a=r.shared.pending))break;a=(d=a).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);Ol|=s,e.lanes=s,e.memoizedState=h}}function Wo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(s(191,r));r.call(i)}}}var Qo={},qo=Sr(Qo),Xo=Sr(Qo),$o=Sr(Qo);function Yo(e){if(e===Qo)throw Error(s(174));return e}function Ko(e,t){switch(Mr($o,t),Mr(Xo,e),Mr(qo,Qo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Cr(qo),Mr(qo,t)}function Jo(){Cr(qo),Cr(Xo),Cr($o)}function Zo(e){Yo($o.current);var t=Yo(qo.current),n=ce(t,e.type);t!==n&&(Mr(Xo,e),Mr(qo,n))}function es(e){Xo.current===e&&(Cr(qo),Cr(Xo))}var ts=Sr(0);function ns(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var is=[];function rs(){for(var e=0;e<is.length;e++)is[e]._workInProgressVersionPrimary=null;is.length=0}var os=b.ReactCurrentDispatcher,ss=b.ReactCurrentBatchConfig,as=0,ls=null,cs=null,us=null,hs=!1,ds=!1,ps=0,fs=0;function ms(){throw Error(s(321))}function gs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!li(e[n],t[n]))return!1;return!0}function vs(e,t,n,i,r,o){if(as=o,ls=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,os.current=null===e||null===e.memoizedState?ea:ta,e=n(i,r),ds){o=0;do{if(ds=!1,ps=0,25<=o)throw Error(s(301));o+=1,us=cs=null,t.updateQueue=null,os.current=na,e=n(i,r)}while(ds)}if(os.current=Zs,t=null!==cs&&null!==cs.next,as=0,us=cs=ls=null,hs=!1,t)throw Error(s(300));return e}function ys(){var e=0!==ps;return ps=0,e}function As(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===us?ls.memoizedState=us=e:us=us.next=e,us}function xs(){if(null===cs){var e=ls.alternate;e=null!==e?e.memoizedState:null}else e=cs.next;var t=null===us?ls.memoizedState:us.next;if(null!==t)us=t,cs=e;else{if(null===e)throw Error(s(310));e={memoizedState:(cs=e).memoizedState,baseState:cs.baseState,baseQueue:cs.baseQueue,queue:cs.queue,next:null},null===us?ls.memoizedState=us=e:us=us.next=e}return us}function bs(e,t){return"function"===typeof t?t(e):t}function _s(e){var t=xs(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=cs,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var a=r.next;r.next=o.next,o.next=a}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var l=a=null,c=null,u=o;do{var h=u.lane;if((as&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=i):c=c.next=d,ls.lanes|=h,Ol|=h}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,li(i,t.memoizedState)||(xa=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,ls.lanes|=o,Ol|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function ws(e){var t=xs(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var a=r=r.next;do{o=e(o,a.action),a=a.next}while(a!==r);li(o,t.memoizedState)||(xa=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Es(){}function Ss(e,t){var n=ls,i=xs(),r=t(),o=!li(i.memoizedState,r);if(o&&(i.memoizedState=r,xa=!0),i=i.queue,Os(Ts.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==us&&1&us.memoizedState.tag){if(n.flags|=2048,Bs(9,Ms.bind(null,n,i,r,t),void 0,null),null===Il)throw Error(s(349));0!==(30&as)||Cs(n,t,r)}return r}function Cs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ls.updateQueue)?(t={lastEffect:null,stores:null},ls.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ms(e,t,n,i){t.value=n,t.getSnapshot=i,Rs(t)&&Is(e)}function Ts(e,t,n){return n((function(){Rs(t)&&Is(e)}))}function Rs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!li(e,n)}catch(i){return!0}}function Is(e){var t=ko(e,1);null!==t&&ic(t,e,1,-1)}function Ps(e){var t=As();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bs,lastRenderedState:e},t.queue=e,e=e.dispatch=$s.bind(null,ls,e),[t.memoizedState,e]}function Bs(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ls.updateQueue)?(t={lastEffect:null,stores:null},ls.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ls(){return xs().memoizedState}function Ns(e,t,n,i){var r=As();ls.flags|=e,r.memoizedState=Bs(1|t,n,void 0,void 0===i?null:i)}function Ds(e,t,n,i){var r=xs();i=void 0===i?null:i;var o=void 0;if(null!==cs){var s=cs.memoizedState;if(o=s.destroy,null!==i&&gs(i,s.deps))return void(r.memoizedState=Bs(t,n,o,i))}ls.flags|=e,r.memoizedState=Bs(1|t,n,o,i)}function ks(e,t){return Ns(8390656,8,e,t)}function Os(e,t){return Ds(2048,8,e,t)}function Us(e,t){return Ds(4,2,e,t)}function Fs(e,t){return Ds(4,4,e,t)}function zs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function js(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ds(4,4,zs.bind(null,t,e),n)}function Vs(){}function Gs(e,t){var n=xs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&gs(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Hs(e,t){var n=xs();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&gs(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ws(e,t,n){return 0===(21&as)?(e.baseState&&(e.baseState=!1,xa=!0),e.memoizedState=n):(li(n,t)||(n=gt(),ls.lanes|=n,Ol|=n,e.baseState=!0),t)}function Qs(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var i=ss.transition;ss.transition={};try{e(!1),t()}finally{xt=n,ss.transition=i}}function qs(){return xs().memoizedState}function Xs(e,t,n){var i=nc(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ys(e))Ks(t,n);else if(null!==(n=Do(e,t,n,i))){ic(n,e,i,tc()),Js(n,t,i)}}function $s(e,t,n){var i=nc(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ys(e))Ks(t,r);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,li(a,s)){var l=t.interleaved;return null===l?(r.next=r,No(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Do(e,t,r,i))&&(ic(n,e,i,r=tc()),Js(n,t,i))}}function Ys(e){var t=e.alternate;return e===ls||null!==t&&t===ls}function Ks(e,t){ds=hs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Js(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,At(e,n)}}var Zs={readContext:Bo,useCallback:ms,useContext:ms,useEffect:ms,useImperativeHandle:ms,useInsertionEffect:ms,useLayoutEffect:ms,useMemo:ms,useReducer:ms,useRef:ms,useState:ms,useDebugValue:ms,useDeferredValue:ms,useTransition:ms,useMutableSource:ms,useSyncExternalStore:ms,useId:ms,unstable_isNewReconciler:!1},ea={readContext:Bo,useCallback:function(e,t){return As().memoizedState=[e,void 0===t?null:t],e},useContext:Bo,useEffect:ks,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ns(4194308,4,zs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ns(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ns(4,2,e,t)},useMemo:function(e,t){var n=As();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=As();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Xs.bind(null,ls,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},As().memoizedState=e},useState:Ps,useDebugValue:Vs,useDeferredValue:function(e){return As().memoizedState=e},useTransition:function(){var e=Ps(!1),t=e[0];return e=Qs.bind(null,e[1]),As().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ls,r=As();if(oo){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Il)throw Error(s(349));0!==(30&as)||Cs(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,ks(Ts.bind(null,i,o,e),[e]),i.flags|=2048,Bs(9,Ms.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=As(),t=Il.identifierPrefix;if(oo){var n=Jr;t=":"+t+"R"+(n=(Kr&~(1<<32-at(Kr)-1)).toString(32)+n),0<(n=ps++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ta={readContext:Bo,useCallback:Gs,useContext:Bo,useEffect:Os,useImperativeHandle:js,useInsertionEffect:Us,useLayoutEffect:Fs,useMemo:Hs,useReducer:_s,useRef:Ls,useState:function(){return _s(bs)},useDebugValue:Vs,useDeferredValue:function(e){return Ws(xs(),cs.memoizedState,e)},useTransition:function(){return[_s(bs)[0],xs().memoizedState]},useMutableSource:Es,useSyncExternalStore:Ss,useId:qs,unstable_isNewReconciler:!1},na={readContext:Bo,useCallback:Gs,useContext:Bo,useEffect:Os,useImperativeHandle:js,useInsertionEffect:Us,useLayoutEffect:Fs,useMemo:Hs,useReducer:ws,useRef:Ls,useState:function(){return ws(bs)},useDebugValue:Vs,useDeferredValue:function(e){var t=xs();return null===cs?t.memoizedState=e:Ws(t,cs.memoizedState,e)},useTransition:function(){return[ws(bs)[0],xs().memoizedState]},useMutableSource:Es,useSyncExternalStore:Ss,useId:qs,unstable_isNewReconciler:!1};function ia(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ra(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var oa={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=zo(i,r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=jo(e,o,r))&&(ic(t,e,r,i),Vo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=tc(),r=nc(e),o=zo(i,r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=jo(e,o,r))&&(ic(t,e,r,i),Vo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),i=nc(e),r=zo(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=jo(e,r,i))&&(ic(t,e,i,n),Vo(t,e,i))}};function sa(e,t,n,i,r,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!ci(n,i)||!ci(r,o))}function aa(e,t,n){var i=!1,r=Tr,o=t.contextType;return"object"===typeof o&&null!==o?o=Bo(o):(r=Lr(t)?Pr:Rr.current,o=(i=null!==(i=t.contextTypes)&&void 0!==i)?Br(e,r):Tr),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=oa,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function la(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&oa.enqueueReplaceState(t,t.state,null)}function ca(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Uo(e);var o=t.contextType;"object"===typeof o&&null!==o?r.context=Bo(o):(o=Lr(t)?Pr:Rr.current,r.context=Br(e,o)),r.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ra(e,t,o,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&oa.enqueueReplaceState(r,r.state,null),Ho(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function ua(e,t){try{var n="",i=t;do{n+=V(i),i=i.return}while(i);var r=n}catch(o){r="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:r,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var pa="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=zo(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Wl||(Wl=!0,Ql=i),da(0,t)},n}function ma(e,t,n){(n=zo(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof i&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new pa;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=zo(-1,1)).tag=2,jo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var Aa=b.ReactCurrentOwner,xa=!1;function ba(e,t,n,i){t.child=null===e?wo(t,null,n,i):_o(t,e.child,n,i)}function _a(e,t,n,i,r){n=n.render;var o=t.ref;return Po(t,r),i=vs(e,t,n,i,o,r),n=ys(),null===e||xa?(oo&&n&&to(t),t.flags|=1,ba(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wa(e,t,r))}function wa(e,t,n,i,r){if(null===e){var o=n.type;return"function"!==typeof o||Lc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dc(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ea(e,t,o,i,r))}if(o=e.child,0===(e.lanes&r)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:ci)(s,i)&&e.ref===t.ref)return Wa(e,t,r)}return t.flags|=1,(e=Nc(o,i)).ref=t.ref,e.return=t,t.child=e}function Ea(e,t,n,i,r){if(null!==e){var o=e.memoizedProps;if(ci(o,i)&&e.ref===t.ref){if(xa=!1,t.pendingProps=i=o,0===(e.lanes&r))return t.lanes=e.lanes,Wa(e,t,r);0!==(131072&e.flags)&&(xa=!0)}}return Ma(e,t,n,i,r)}function Sa(e,t,n){var i=t.pendingProps,r=i.children,o=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mr(Nl,Ll),Ll|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Mr(Nl,Ll),Ll|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==o?o.baseLanes:n,Mr(Nl,Ll),Ll|=i}else null!==o?(i=o.baseLanes|n,t.memoizedState=null):i=n,Mr(Nl,Ll),Ll|=i;return ba(e,t,r,n),t.child}function Ca(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ma(e,t,n,i,r){var o=Lr(n)?Pr:Rr.current;return o=Br(t,o),Po(t,r),n=vs(e,t,n,i,o,r),i=ys(),null===e||xa?(oo&&i&&to(t),t.flags|=1,ba(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wa(e,t,r))}function Ta(e,t,n,i,r){if(Lr(n)){var o=!0;Or(t)}else o=!1;if(Po(t,r),null===t.stateNode)Ha(e,t),aa(t,n,i),ca(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Bo(c):c=Br(t,c=Lr(n)?Pr:Rr.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==i||l!==c)&&la(t,s,i,c),Oo=!1;var d=t.memoizedState;s.state=d,Ho(t,i,s,r),l=t.memoizedState,a!==i||d!==l||Ir.current||Oo?("function"===typeof u&&(ra(t,n,u,i),l=t.memoizedState),(a=Oo||sa(t,n,a,i,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Fo(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:ia(t.type,a),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Bo(l):l=Br(t,l=Lr(n)?Pr:Rr.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==h||d!==l)&&la(t,s,i,l),Oo=!1,d=t.memoizedState,s.state=d,Ho(t,i,s,r);var f=t.memoizedState;a!==h||d!==f||Ir.current||Oo?("function"===typeof p&&(ra(t,n,p,i),f=t.memoizedState),(c=Oo||sa(t,n,c,i,d,f,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Ra(e,t,n,i,o,r)}function Ra(e,t,n,i,r,o){Ca(e,t);var s=0!==(128&t.flags);if(!i&&!s)return r&&Ur(t,n,!1),Wa(e,t,o);i=t.stateNode,Aa.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=_o(t,e.child,null,o),t.child=_o(t,null,a,o)):ba(e,t,a,o),t.memoizedState=i.state,r&&Ur(t,n,!0),t.child}function Ia(e){var t=e.stateNode;t.pendingContext?Dr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Dr(0,t.context,!1),Ko(e,t.containerInfo)}function Pa(e,t,n,i,r){return mo(),go(r),t.flags|=256,ba(e,t,n,i),t.child}var Ba,La,Na,Da,ka={dehydrated:null,treeContext:null,retryLane:0};function Oa(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ua(e,t,n){var i,r=t.pendingProps,o=ts.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Mr(ts,1&o),null===e)return uo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,a?(r=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Oc(l,r,0,null),e=kc(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Oa(n),t.memoizedState=ka,e):Fa(t,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,a){if(n)return 256&t.flags?(t.flags&=-257,za(e,t,a,i=ha(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Oc({mode:"visible",children:i.children},r,0,null),(o=kc(o,r,a,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&_o(t,e.child,null,a),t.child.memoizedState=Oa(a),t.memoizedState=ka,o);if(0===(1&t.mode))return za(e,t,a,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,za(e,t,a,i=ha(o=Error(s(419)),i,void 0))}if(l=0!==(a&e.childLanes),xa||l){if(null!==(i=Il)){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|a))?0:r)&&r!==o.retryLane&&(o.retryLane=r,ko(e,r),ic(i,e,r,-1))}return gc(),za(e,t,a,i=ha(Error(s(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Tc.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ro=ur(r.nextSibling),io=t,oo=!0,so=null,null!==e&&(Xr[$r++]=Kr,Xr[$r++]=Jr,Xr[$r++]=Yr,Kr=e.id,Jr=e.overflow,Yr=t),t=Fa(t,i.children),t.flags|=4096,t)}(e,t,l,r,i,o,n);if(a){a=r.fallback,l=t.mode,i=(o=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Nc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?a=Nc(i,a):(a=kc(a,l,n,null)).flags|=2,a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,l=null===(l=e.child.memoizedState)?Oa(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=ka,r}return e=(a=e.child).sibling,r=Nc(a,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Fa(e,t){return(t=Oc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function za(e,t,n,i){return null!==i&&go(i),_o(t,e.child,null,n),(e=Fa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ja(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Io(e.return,t,n)}function Va(e,t,n,i,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function Ga(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(ba(e,t,i.children,n),0!==(2&(i=ts.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ja(e,n,t);else if(19===e.tag)ja(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Mr(ts,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===ns(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Va(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===ns(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Va(t,!0,n,null,o);break;case"together":Va(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ha(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ol|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Nc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Nc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Qa(e,t){if(!oo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function qa(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xa(e,t,n){var i=t.pendingProps;switch(no(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qa(t),null;case 1:case 17:return Lr(t.type)&&Nr(),qa(t),null;case 3:return i=t.stateNode,Jo(),Cr(Ir),Cr(Rr),rs(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(po(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==so&&(ac(so),so=null))),La(e,t),qa(t),null;case 5:es(t);var r=Yo($o.current);if(n=t.type,null!==e&&null!=t.stateNode)Na(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(s(166));return qa(t),null}if(e=Yo(qo.current),po(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[pr]=t,i[fr]=o,e=0!==(1&t.mode),n){case"dialog":zi("cancel",i),zi("close",i);break;case"iframe":case"object":case"embed":zi("load",i);break;case"video":case"audio":for(r=0;r<ki.length;r++)zi(ki[r],i);break;case"source":zi("error",i);break;case"img":case"image":case"link":zi("error",i),zi("load",i);break;case"details":zi("toggle",i);break;case"input":K(i,o),zi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},zi("invalid",i);break;case"textarea":oe(i,o),zi("invalid",i)}for(var a in Ae(n,o),r=null,o)if(o.hasOwnProperty(a)){var c=o[a];"children"===a?"string"===typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,e),r=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zi(i.textContent,c,e),r=["children",""+c]):l.hasOwnProperty(a)&&null!=c&&"onScroll"===a&&zi("scroll",i)}switch(n){case"input":q(i),ee(i,o,!0);break;case"textarea":q(i),ae(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=er)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{a=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=le(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=a.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=a.createElement(n,{is:i.is}):(e=a.createElement(n),"select"===n&&(a=e,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):e=a.createElementNS(e,n),e[pr]=t,e[fr]=i,Ba(e,t,!1,!1),t.stateNode=e;e:{switch(a=xe(n,i),n){case"dialog":zi("cancel",e),zi("close",e),r=i;break;case"iframe":case"object":case"embed":zi("load",e),r=i;break;case"video":case"audio":for(r=0;r<ki.length;r++)zi(ki[r],e);r=i;break;case"source":zi("error",e),r=i;break;case"img":case"image":case"link":zi("error",e),zi("load",e),r=i;break;case"details":zi("toggle",e),r=i;break;case"input":K(e,i),r=Y(e,i),zi("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=U({},i,{value:void 0}),zi("invalid",e);break;case"textarea":oe(e,i),r=re(e,i),zi("invalid",e)}for(o in Ae(n,r),c=r)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?ve(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&pe(e,u):"number"===typeof u&&pe(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(l.hasOwnProperty(o)?null!=u&&"onScroll"===o&&zi("scroll",e):null!=u&&x(e,o,u,a))}switch(n){case"input":q(e),ee(e,i,!1);break;case"textarea":q(e),ae(e);break;case"option":null!=i.value&&e.setAttribute("value",""+W(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ie(e,!!i.multiple,o,!1):null!=i.defaultValue&&ie(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=er)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qa(t),null;case 6:if(e&&null!=t.stateNode)Da(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(n=Yo($o.current),Yo(qo.current),po(t)){if(i=t.stateNode,n=t.memoizedProps,i[pr]=t,(o=i.nodeValue!==n)&&null!==(e=io))switch(e.tag){case 3:Zi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zi(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[pr]=t,t.stateNode=i}return qa(t),null;case 13:if(Cr(ts),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(oo&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))fo(),mo(),t.flags|=98560,o=!1;else if(o=po(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[pr]=t}else mo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qa(t),o=!1}else null!==so&&(ac(so),so=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ts.current)?0===Dl&&(Dl=3):gc())),null!==t.updateQueue&&(t.flags|=4),qa(t),null);case 4:return Jo(),La(e,t),null===e&&Gi(t.stateNode.containerInfo),qa(t),null;case 10:return Ro(t.type._context),qa(t),null;case 19:if(Cr(ts),null===(o=t.memoizedState))return qa(t),null;if(i=0!==(128&t.flags),null===(a=o.rendering))if(i)Qa(o,!1);else{if(0!==Dl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=ns(e))){for(t.flags|=128,Qa(o,!1),null!==(i=a.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(a=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,e=a.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Mr(ts,1&ts.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Gl&&(t.flags|=128,i=!0,Qa(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=ns(a))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Qa(o,!0),null===o.tail&&"hidden"===o.tailMode&&!a.alternate&&!oo)return qa(t),null}else 2*Je()-o.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,i=!0,Qa(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(null!==(n=o.last)?n.sibling=a:t.child=a,o.last=a)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=ts.current,Mr(ts,i?1&n|2:1&n),t):(qa(t),null);case 22:case 23:return dc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Ll)&&(qa(t),6&t.subtreeFlags&&(t.flags|=8192)):qa(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function $a(e,t){switch(no(t),t.tag){case 1:return Lr(t.type)&&Nr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Jo(),Cr(Ir),Cr(Rr),rs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return es(t),null;case 13:if(Cr(ts),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));mo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Cr(ts),null;case 4:return Jo(),null;case 10:return Ro(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ba=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},La=function(){},Na=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Yo(qo.current);var o,s=null;switch(n){case"input":r=Y(e,r),i=Y(e,i),s=[];break;case"select":r=U({},r,{value:void 0}),i=U({},i,{value:void 0}),s=[];break;case"textarea":r=re(e,r),i=re(e,i),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=er)}for(u in Ae(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var a=r[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(l.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in i){var c=i[u];if(a=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&c!==a&&(null!=c||null!=a))if("style"===u)if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,a=a?a.__html:void 0,null!=c&&a!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(l.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zi("scroll",e),s||a===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Da=function(e,t,n,i){n!==i&&(t.flags|=4)};var Ya=!1,Ka=!1,Ja="function"===typeof WeakSet?WeakSet:Set,Za=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Sc(e,t,i)}else n.current=null}function tl(e,t,n){try{n()}catch(i){Sc(e,t,i)}}var nl=!1;function il(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,void 0!==o&&tl(t,n,o)}r=r.next}while(r!==i)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pr],delete t[fr],delete t[gr],delete t[vr],delete t[yr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=er));else if(4!==i&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,dl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(ot,n)}catch(a){}switch(n.tag){case 5:Ka||el(n,t);case 6:var i=hl,r=dl;hl=null,pl(e,t,n),dl=r,null!==(hl=i)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?cr(e.parentNode,n):1===e.nodeType&&cr(e,n),Gt(e)):cr(hl,n.stateNode));break;case 4:i=hl,r=dl,hl=n.stateNode.containerInfo,dl=!0,pl(e,t,n),hl=i,dl=r;break;case 0:case 11:case 14:case 15:if(!Ka&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tl(n,t,s),r=r.next}while(r!==i)}pl(e,t,n);break;case 1:if(!Ka&&(el(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Sc(n,t,a)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Ka=(i=Ka)||null!==n.memoizedState,pl(e,t,n),Ka=i):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ja),t.forEach((function(t){var i=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(s(160));fl(o,a,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(u){Sc(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vl(t,e),t=t.sibling}function vl(e,n){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(n,e),yl(e),4&r){try{il(3,e,e.return),rl(3,e)}catch(t){Sc(e,e.return,t)}try{il(5,e,e.return)}catch(t){Sc(e,e.return,t)}}break;case 1:gl(n,e),yl(e),512&r&&null!==i&&el(i,i.return);break;case 5:if(gl(n,e),yl(e),512&r&&null!==i&&el(i,i.return),32&e.flags){var o=e.stateNode;try{pe(o,"")}catch(t){Sc(e,e.return,t)}}if(4&r&&null!=(o=e.stateNode)){var a=e.memoizedProps,l=null!==i?i.memoizedProps:a,c=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===c&&"radio"===a.type&&null!=a.name&&J(o,a),xe(c,l);var h=xe(c,a);for(l=0;l<u.length;l+=2){var d=u[l],p=u[l+1];"style"===d?ve(o,p):"dangerouslySetInnerHTML"===d?de(o,p):"children"===d?pe(o,p):x(o,d,p,h)}switch(c){case"input":Z(o,a);break;case"textarea":se(o,a);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!a.multiple;var m=a.value;null!=m?ie(o,!!a.multiple,m,!1):f!==!!a.multiple&&(null!=a.defaultValue?ie(o,!!a.multiple,a.defaultValue,!0):ie(o,!!a.multiple,a.multiple?[]:"",!1))}o[fr]=a}catch(t){Sc(e,e.return,t)}}break;case 6:if(gl(n,e),yl(e),4&r){if(null===e.stateNode)throw Error(s(162));o=e.stateNode,a=e.memoizedProps;try{o.nodeValue=a}catch(t){Sc(e,e.return,t)}}break;case 3:if(gl(n,e),yl(e),4&r&&null!==i&&i.memoizedState.isDehydrated)try{Gt(n.containerInfo)}catch(t){Sc(e,e.return,t)}break;case 4:default:gl(n,e),yl(e);break;case 13:gl(n,e),yl(e),8192&(o=e.child).flags&&(a=null!==o.memoizedState,o.stateNode.isHidden=a,!a||null!==o.alternate&&null!==o.alternate.memoizedState||(Vl=Je())),4&r&&ml(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?(Ka=(h=Ka)||d,gl(n,e),Ka=h):gl(n,e),yl(e),8192&r){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!d&&0!==(1&e.mode))for(Za=e,d=e.child;null!==d;){for(p=Za=d;null!==Za;){switch(m=(f=Za).child,f.tag){case 0:case 11:case 14:case 15:il(4,f,f.return);break;case 1:el(f,f.return);var g=f.stateNode;if("function"===typeof g.componentWillUnmount){r=f,i=f.return;try{n=r,g.props=n.memoizedProps,g.state=n.memoizedState,g.componentWillUnmount()}catch(t){Sc(r,i,t)}}break;case 5:el(f,f.return);break;case 22:if(null!==f.memoizedState){_l(p);continue}}null!==m?(m.return=f,Za=m):_l(p)}d=d.sibling}e:for(d=null,p=e;;){if(5===p.tag){if(null===d){d=p;try{o=p.stateNode,h?"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none":(c=p.stateNode,l=void 0!==(u=p.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,c.style.display=ge("display",l))}catch(t){Sc(e,e.return,t)}}}else if(6===p.tag){if(null===d)try{p.stateNode.nodeValue=h?"":p.memoizedProps}catch(t){Sc(e,e.return,t)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===e)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;null===p.sibling;){if(null===p.return||p.return===e)break e;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:gl(n,e),yl(e),4&r&&ml(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var i=n;break e}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(pe(r,""),i.flags&=-33),ul(e,ll(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;cl(e,ll(e),o);break;default:throw Error(s(161))}}catch(a){Sc(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Al(e,t,n){Za=e,xl(e,t,n)}function xl(e,t,n){for(var i=0!==(1&e.mode);null!==Za;){var r=Za,o=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||Ya;if(!s){var a=r.alternate,l=null!==a&&null!==a.memoizedState||Ka;a=Ya;var c=Ka;if(Ya=s,(Ka=l)&&!c)for(Za=r;null!==Za;)l=(s=Za).child,22===s.tag&&null!==s.memoizedState?wl(r):null!==l?(l.return=s,Za=l):wl(r);for(;null!==o;)Za=o,xl(o,t,n),o=o.sibling;Za=r,Ya=a,Ka=c}bl(e)}else 0!==(8772&r.subtreeFlags)&&null!==o?(o.return=r,Za=o):bl(e)}}function bl(e){for(;null!==Za;){var t=Za;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ka||rl(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Ka)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:ia(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Wo(t,o,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wo(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Gt(d)}}}break;default:throw Error(s(163))}Ka||512&t.flags&&ol(t)}catch(p){Sc(t,t.return,p)}}if(t===e){Za=null;break}if(null!==(n=t.sibling)){n.return=t.return,Za=n;break}Za=t.return}}function _l(e){for(;null!==Za;){var t=Za;if(t===e){Za=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Za=n;break}Za=t.return}}function wl(e){for(;null!==Za;){var t=Za;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Sc(t,n,l)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Sc(t,r,l)}}var o=t.return;try{ol(t)}catch(l){Sc(t,o,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){Sc(t,s,l)}}}catch(l){Sc(t,t.return,l)}if(t===e){Za=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Za=a;break}Za=t.return}}var El,Sl=Math.ceil,Cl=b.ReactCurrentDispatcher,Ml=b.ReactCurrentOwner,Tl=b.ReactCurrentBatchConfig,Rl=0,Il=null,Pl=null,Bl=0,Ll=0,Nl=Sr(0),Dl=0,kl=null,Ol=0,Ul=0,Fl=0,zl=null,jl=null,Vl=0,Gl=1/0,Hl=null,Wl=!1,Ql=null,ql=null,Xl=!1,$l=null,Yl=0,Kl=0,Jl=null,Zl=-1,ec=0;function tc(){return 0!==(6&Rl)?Je():-1!==Zl?Zl:Zl=Je()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Rl)&&0!==Bl?Bl&-Bl:null!==vo.transition?(0===ec&&(ec=gt()),ec):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function ic(e,t,n,i){if(50<Kl)throw Kl=0,Jl=null,Error(s(185));yt(e,n,i),0!==(2&Rl)&&e===Il||(e===Il&&(0===(2&Rl)&&(Ul|=n),4===Dl&&lc(e,Bl)),rc(e,i),1===n&&0===Rl&&0===(1&t.mode)&&(Gl=Je()+500,zr&&Gr()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-at(o),a=1<<s,l=r[s];-1===l?0!==(a&n)&&0===(a&i)||(r[s]=ft(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var i=pt(e,e===Il?Bl:0);if(0===i)null!==n&&$e(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&$e(n),1===t)0===e.tag?function(e){zr=!0,Vr(e)}(cc.bind(null,e)):Vr(cc.bind(null,e)),ar((function(){0===(6&Rl)&&Gr()})),n=null;else{switch(bt(i)){case 1:n=et;break;case 4:n=tt;break;case 16:default:n=nt;break;case 536870912:n=rt}n=Ic(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Zl=-1,ec=0,0!==(6&Rl))throw Error(s(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var i=pt(e,e===Il?Bl:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=vc(e,i);else{t=i;var r=Rl;Rl|=2;var o=mc();for(Il===e&&Bl===t||(Hl=null,Gl=Je()+500,pc(e,t));;)try{Ac();break}catch(l){fc(e,l)}To(),Cl.current=o,Rl=r,null!==Pl?t=0:(Il=null,Bl=0,t=Dl)}if(0!==t){if(2===t&&(0!==(r=mt(e))&&(i=r,t=sc(e,r))),1===t)throw n=kl,pc(e,0),lc(e,i),rc(e,Je()),n;if(6===t)lc(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!li(o(),r))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=vc(e,i))&&(0!==(o=mt(e))&&(i=o,t=sc(e,o))),1===t))throw n=kl,pc(e,0),lc(e,i),rc(e,Je()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(s(345));case 2:case 5:_c(e,jl,Hl);break;case 3:if(lc(e,i),(130023424&i)===i&&10<(t=Vl+500-Je())){if(0!==pt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){tc(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=rr(_c.bind(null,e,jl,Hl),t);break}_c(e,jl,Hl);break;case 4:if(lc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var a=31-at(i);o=1<<a,(a=t[a])>r&&(r=a),i&=~o}if(i=r,10<(i=(120>(i=Je()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Sl(i/1960))-i)){e.timeoutHandle=rr(_c.bind(null,e,jl,Hl),i);break}_c(e,jl,Hl);break;default:throw Error(s(329))}}}return rc(e,Je()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=zl;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=jl,jl=n,null!==t&&ac(t)),e}function ac(e){null===jl?jl=e:jl.push.apply(jl,e)}function lc(e,t){for(t&=~Fl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),i=1<<n;e[n]=-1,t&=~i}}function cc(e){if(0!==(6&Rl))throw Error(s(327));wc();var t=pt(e,0);if(0===(1&t))return rc(e,Je()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var i=mt(e);0!==i&&(t=i,n=sc(e,i))}if(1===n)throw n=kl,pc(e,0),lc(e,t),rc(e,Je()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,jl,Hl),rc(e,Je()),null}function uc(e,t){var n=Rl;Rl|=1;try{return e(t)}finally{0===(Rl=n)&&(Gl=Je()+500,zr&&Gr())}}function hc(e){null!==$l&&0===$l.tag&&0===(6&Rl)&&wc();var t=Rl;Rl|=1;var n=Tl.transition,i=xt;try{if(Tl.transition=null,xt=1,e)return e()}finally{xt=i,Tl.transition=n,0===(6&(Rl=t))&&Gr()}}function dc(){Ll=Nl.current,Cr(Nl)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,or(n)),null!==Pl)for(n=Pl.return;null!==n;){var i=n;switch(no(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Nr();break;case 3:Jo(),Cr(Ir),Cr(Rr),rs();break;case 5:es(i);break;case 4:Jo();break;case 13:case 19:Cr(ts);break;case 10:Ro(i.type._context);break;case 22:case 23:dc()}n=n.return}if(Il=e,Pl=e=Nc(e.current,null),Bl=Ll=t,Dl=0,kl=null,Fl=Ul=Ol=0,jl=zl=null,null!==Lo){for(t=0;t<Lo.length;t++)if(null!==(i=(n=Lo[t]).interleaved)){n.interleaved=null;var r=i.next,o=n.pending;if(null!==o){var s=o.next;o.next=r,i.next=s}n.pending=i}Lo=null}return e}function fc(e,t){for(;;){var n=Pl;try{if(To(),os.current=Zs,hs){for(var i=ls.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}hs=!1}if(as=0,us=cs=ls=null,ds=!1,ps=0,Ml.current=null,null===n||null===n.return){Dl=1,kl=t,Pl=null;break}e:{var o=e,a=n.return,l=n,c=t;if(t=Bl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=va(a);if(null!==f){f.flags&=-257,ya(f,a,l,0,t),1&f.mode&&ga(o,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ga(o,u,t),gc();break e}c=Error(s(426))}else if(oo&&1&l.mode){var v=va(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),ya(v,a,l,0,t),go(ua(c,l));break e}}o=c=ua(c,l),4!==Dl&&(Dl=2),null===zl?zl=[o]:zl.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Go(o,fa(0,c,t));break e;case 1:l=c;var y=o.type,A=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==A&&"function"===typeof A.componentDidCatch&&(null===ql||!ql.has(A)))){o.flags|=65536,t&=-t,o.lanes|=t,Go(o,ma(o,l,t));break e}}o=o.return}while(null!==o)}bc(n)}catch(x){t=x,Pl===n&&null!==n&&(Pl=n=n.return);continue}break}}function mc(){var e=Cl.current;return Cl.current=Zs,null===e?Zs:e}function gc(){0!==Dl&&3!==Dl&&2!==Dl||(Dl=4),null===Il||0===(268435455&Ol)&&0===(268435455&Ul)||lc(Il,Bl)}function vc(e,t){var n=Rl;Rl|=2;var i=mc();for(Il===e&&Bl===t||(Hl=null,pc(e,t));;)try{yc();break}catch(r){fc(e,r)}if(To(),Rl=n,Cl.current=i,null!==Pl)throw Error(s(261));return Il=null,Bl=0,Dl}function yc(){for(;null!==Pl;)xc(Pl)}function Ac(){for(;null!==Pl&&!Ye();)xc(Pl)}function xc(e){var t=El(e.alternate,e,Ll);e.memoizedProps=e.pendingProps,null===t?bc(e):Pl=t,Ml.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xa(n,t,Ll)))return void(Pl=n)}else{if(null!==(n=$a(n,t)))return n.flags&=32767,void(Pl=n);if(null===e)return Dl=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Dl&&(Dl=5)}function _c(e,t,n){var i=xt,r=Tl.transition;try{Tl.transition=null,xt=1,function(e,t,n,i){do{wc()}while(null!==$l);if(0!==(6&Rl))throw Error(s(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-at(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}(e,o),e===Il&&(Pl=Il=null,Bl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Ic(nt,(function(){return wc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Tl.transition,Tl.transition=null;var a=xt;xt=1;var l=Rl;Rl|=4,Ml.current=null,function(e,t){if(tr=Wt,fi(e=pi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(b){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==r&&3!==d.nodeType||(l=a+r),d!==o||0!==i&&3!==d.nodeType||(c=a+i),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===r&&(l=a),p===o&&++h===i&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nr={focusedElem:e,selectionRange:n},Wt=!1,Za=t;null!==Za;)if(e=(t=Za).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Za=e;else for(;null!==Za;){t=Za;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,A=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:ia(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=A}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(s(163))}}catch(b){Sc(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Za=e;break}Za=t.return}m=nl,nl=!1}(e,n),vl(n,e),mi(nr),Wt=!!tr,nr=tr=null,e.current=n,Al(n,e,r),Ke(),Rl=l,xt=a,Tl.transition=o}else e.current=n;if(Xl&&(Xl=!1,$l=e,Yl=r),o=e.pendingLanes,0===o&&(ql=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Je()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Wl)throw Wl=!1,e=Ql,Ql=null,e;0!==(1&Yl)&&0!==e.tag&&wc(),o=e.pendingLanes,0!==(1&o)?e===Jl?Kl++:(Kl=0,Jl=e):Kl=0,Gr()}(e,t,n,i)}finally{Tl.transition=r,xt=i}return null}function wc(){if(null!==$l){var e=bt(Yl),t=Tl.transition,n=xt;try{if(Tl.transition=null,xt=16>e?16:e,null===$l)var i=!1;else{if(e=$l,$l=null,Yl=0,0!==(6&Rl))throw Error(s(331));var r=Rl;for(Rl|=4,Za=e.current;null!==Za;){var o=Za,a=o.child;if(0!==(16&Za.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Za=u;null!==Za;){var h=Za;switch(h.tag){case 0:case 11:case 15:il(8,h,o)}var d=h.child;if(null!==d)d.return=h,Za=d;else for(;null!==Za;){var p=(h=Za).sibling,f=h.return;if(sl(h),h===u){Za=null;break}if(null!==p){p.return=f,Za=p;break}Za=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Za=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,Za=a;else e:for(;null!==Za;){if(0!==(2048&(o=Za).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Za=y;break e}Za=o.return}}var A=e.current;for(Za=A;null!==Za;){var x=(a=Za).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,Za=x;else e:for(a=A;null!==Za;){if(0!==(2048&(l=Za).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(_){Sc(l,l.return,_)}if(l===a){Za=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Za=b;break e}Za=l.return}}if(Rl=r,Gr(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(ot,e)}catch(_){}i=!0}return i}finally{xt=n,Tl.transition=t}}return!1}function Ec(e,t,n){e=jo(e,t=fa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===ql||!ql.has(i))){t=jo(t,e=ma(t,e=ua(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Il===e&&(Bl&n)===n&&(4===Dl||3===Dl&&(130023424&Bl)===Bl&&500>Je()-Vl?pc(e,0):Fl|=n),rc(e,t)}function Mc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var n=tc();null!==(e=ko(e,t))&&(yt(e,t,n),rc(e,n))}function Tc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Mc(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(t),Mc(e,n)}function Ic(e,t){return Xe(e,t)}function Pc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bc(e,t,n,i){return new Pc(e,t,n,i)}function Lc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Nc(e,t){var n=e.alternate;return null===n?((n=Bc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dc(e,t,n,i,r,o){var a=2;if(i=e,"function"===typeof e)Lc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case E:return kc(n.children,r,o,t);case S:a=8,r|=8;break;case C:return(e=Bc(12,n,t,2|r)).elementType=C,e.lanes=o,e;case I:return(e=Bc(13,n,t,r)).elementType=I,e.lanes=o,e;case P:return(e=Bc(19,n,t,r)).elementType=P,e.lanes=o,e;case N:return Oc(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case M:a=10;break e;case T:a=9;break e;case R:a=11;break e;case B:a=14;break e;case L:a=16,i=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Bc(a,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function kc(e,t,n,i){return(e=Bc(7,e,i,t)).lanes=n,e}function Oc(e,t,n,i){return(e=Bc(22,e,i,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function Uc(e,t,n){return(e=Bc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Bc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,i,r,o,s,a,l){return e=new zc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Bc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uo(o),e}function Vc(e){if(!e)return Tr;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Lr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Lr(n))return kr(e,n,t)}return t}function Gc(e,t,n,i,r,o,s,a,l){return(e=jc(n,i,!0,e,0,o,0,a,l)).context=Vc(null),n=e.current,(o=zo(i=tc(),r=nc(n))).callback=void 0!==t&&null!==t?t:null,jo(n,o,r),e.current.lanes=r,yt(e,r,i),rc(e,i),e}function Hc(e,t,n,i){var r=t.current,o=tc(),s=nc(r);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=zo(o,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=jo(r,t,s))&&(ic(e,r,s,o),Vo(e,r,s)),s}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Qc(e,t),(e=e.alternate)&&Qc(e,t)}El=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ir.current)xa=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xa=!1,function(e,t,n){switch(t.tag){case 3:Ia(t),mo();break;case 5:Zo(t);break;case 1:Lr(t.type)&&Or(t);break;case 4:Ko(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Mr(Eo,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Mr(ts,1&ts.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ua(e,t,n):(Mr(ts,1&ts.current),null!==(e=Wa(e,t,n))?e.sibling:null);Mr(ts,1&ts.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Ga(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Mr(ts,ts.current),i)break;return null;case 22:case 23:return t.lanes=0,Sa(e,t,n)}return Wa(e,t,n)}(e,t,n);xa=0!==(131072&e.flags)}else xa=!1,oo&&0!==(1048576&t.flags)&&eo(t,qr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ha(e,t),e=t.pendingProps;var r=Br(t,Rr.current);Po(t,n),r=vs(null,t,i,e,r,n);var o=ys();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Lr(i)?(o=!0,Or(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Uo(t),r.updater=oa,t.stateNode=r,r._reactInternals=t,ca(t,i,e,n),t=Ra(null,t,i,!0,o,n)):(t.tag=0,oo&&o&&to(t),ba(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return Lc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===B)return 14}return 2}(i),e=ia(i,e),r){case 0:t=Ma(null,t,i,e,n);break e;case 1:t=Ta(null,t,i,e,n);break e;case 11:t=_a(null,t,i,e,n);break e;case 14:t=wa(null,t,i,ia(i.type,e),n);break e}throw Error(s(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ma(e,t,i,r=t.elementType===i?r:ia(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ta(e,t,i,r=t.elementType===i?r:ia(i,r),n);case 3:e:{if(Ia(t),null===e)throw Error(s(387));i=t.pendingProps,r=(o=t.memoizedState).element,Fo(e,t),Ho(t,i,null,n);var a=t.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Pa(e,t,i,n,r=ua(Error(s(423)),t));break e}if(i!==r){t=Pa(e,t,i,n,r=ua(Error(s(424)),t));break e}for(ro=ur(t.stateNode.containerInfo.firstChild),io=t,oo=!0,so=null,n=wo(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(mo(),i===r){t=Wa(e,t,n);break e}ba(e,t,i,n)}t=t.child}return t;case 5:return Zo(t),null===e&&uo(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,ir(i,r)?a=null:null!==o&&ir(i,o)&&(t.flags|=32),Ca(e,t),ba(e,t,a,n),t.child;case 6:return null===e&&uo(t),null;case 13:return Ua(e,t,n);case 4:return Ko(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=_o(t,null,i,n):ba(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,_a(e,t,i,r=t.elementType===i?r:ia(i,r),n);case 7:return ba(e,t,t.pendingProps,n),t.child;case 8:case 12:return ba(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,a=r.value,Mr(Eo,i._currentValue),i._currentValue=a,null!==o)if(li(o.value,a)){if(o.children===r.children&&!Ir.current){t=Wa(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=zo(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Io(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(s(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Io(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}ba(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Po(t,n),i=i(r=Bo(r)),t.flags|=1,ba(e,t,i,n),t.child;case 14:return r=ia(i=t.type,t.pendingProps),wa(e,t,i,r=ia(i.type,r),n);case 15:return Ea(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:ia(i,r),Ha(e,t),t.tag=1,Lr(i)?(e=!0,Or(t)):e=!1,Po(t,n),aa(t,i,r),ca(t,i,r,n),Ra(null,t,i,!0,e,n);case 19:return Ga(e,t,n);case 22:return Sa(e,t,n)}throw Error(s(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function $c(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof r){var a=r;r=function(){var e=Wc(s);a.call(e)}}Hc(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"===typeof i){var o=i;i=function(){var e=Wc(s);o.call(e)}}var s=Gc(t,i,e,0,null,!1,0,"",Zc);return e._reactRootContainer=s,e[mr]=s.current,Gi(8===e.nodeType?e.parentNode:e),hc(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var a=i;i=function(){var e=Wc(l);a.call(e)}}var l=jc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[mr]=l.current,Gi(8===e.nodeType?e.parentNode:e),hc((function(){Hc(t,l,n,i)})),l}(n,t,e,r,i);return Wc(s)}Yc.prototype.render=$c.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Hc(e,t,null,null)},Yc.prototype.unmount=$c.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Hc(null,e,null,null)})),t[mr]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nt.length&&0!==t&&t<Nt[n].priority;n++);Nt.splice(n,0,e),0===n&&Ut(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(At(t,1|n),rc(t,Je()),0===(6&Rl)&&(Gl=Je()+500,Gr()))}break;case 13:hc((function(){var t=ko(e,1);if(null!==t){var n=tc();ic(t,e,1,n)}})),qc(e,1)}},wt=function(e){if(13===e.tag){var t=ko(e,134217728);if(null!==t)ic(t,e,134217728,tc());qc(e,134217728)}},Et=function(e){if(13===e.tag){var t=nc(e),n=ko(e,t);if(null!==n)ic(n,e,t,tc());qc(e,t)}},St=function(){return xt},Ct=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},we=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=_r(i);if(!r)throw Error(s(90));X(i),Z(i,r)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ie(e,!!n.multiple,t,!1)}},Re=uc,Ie=hc;var tu={usingClientEntryPoint:!1,Events:[xr,br,_r,Me,Te,uc]},nu={findFiberByHostInstance:Ar,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Qe(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{ot=ru.inject(iu),st=ru}catch(he){}}n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,n.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(s(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},n.createRoot=function(e,t){if(!Kc(e))throw Error(s(299));var n=!1,i="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,i,r),e[mr]=t.current,Gi(8===e.nodeType?e.parentNode:e),new $c(t)},n.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=Qe(t))?null:e.stateNode},n.flushSync=function(e){return hc(e)},n.hydrate=function(e,t,n){if(!Jc(t))throw Error(s(200));return eu(null,e,t,!0,n)},n.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",a=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,r,0,o,a),e[mr]=t.current,Gi(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Yc(t)},n.render=function(e,t,n){if(!Jc(t))throw Error(s(200));return eu(null,e,t,!1,n)},n.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(s(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[mr]=null}))})),!0)},n.unstable_batchedUpdates=uc,n.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Jc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return eu(e,t,n,!1,i)},n.version="18.3.1-next-f1338f8080-20240426"},3030:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(8168);function r(e,t){const n=(0,i.A)({},t);return Object.keys(e).forEach((o=>{if(o.toString().match(/^(components|slots)$/))n[o]=(0,i.A)({},e[o],n[o]);else if(o.toString().match(/^(componentsProps|slotProps)$/)){const s=e[o]||{},a=t[o];n[o]={},a&&Object.keys(a)?s&&Object.keys(s)?(n[o]=(0,i.A)({},a),Object.keys(s).forEach((e=>{n[o][e]=r(s[e],a[e])}))):n[o]=a:n[o]=s}else void 0===n[o]&&(n[o]=e[o])})),n}},3078:e=>{e.exports=AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},3174:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalStyles:()=>_.A,StyledEngineProvider:()=>b,ThemeContext:()=>r.T,css:()=>v.AH,default:()=>w,internal_processStyles:()=>E,keyframes:()=>v.i7});var i=n(8168),r=n(9369),o=n(6598),s=n(9436),a=n(1722),l=n(5043),c=n(918),u=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,h=(0,c.A)((function(e){return u.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),d=function(e){return"theme"!==e},p=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?h:d},f=function(e,t,n){var i;if(t){var r=t.shouldForwardProp;i=e.__emotion_forwardProp&&r?function(t){return e.__emotion_forwardProp(t)&&r(t)}:r}return"function"!==typeof i&&n&&(i=e.__emotion_forwardProp),i},m=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;return(0,a.SF)(t,n,i),(0,s.s)((function(){return(0,a.sk)(t,n,i)})),null},g=function e(t,n){var s,c,u=t.__emotion_real===t,h=u&&t.__emotion_base||t;void 0!==n&&(s=n.label,c=n.target);var d=f(t,n,u),g=d||p(h),v=!g("as");return function(){var y=arguments,A=u&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==s&&A.push("label:"+s+";"),null==y[0]||void 0===y[0].raw)A.push.apply(A,y);else{var x=y[0];A.push(x[0]);for(var b=y.length,_=1;_<b;_++)A.push(y[_],x[_])}var w=(0,r.w)((function(e,t,n){var i=v&&e.as||h,s="",u=[],f=e;if(null==e.theme){for(var y in f={},e)f[y]=e[y];f.theme=l.useContext(r.T)}"string"===typeof e.className?s=(0,a.Rk)(t.registered,u,e.className):null!=e.className&&(s=e.className+" ");var x=(0,o.J)(A.concat(u),t.registered,f);s+=t.key+"-"+x.name,void 0!==c&&(s+=" "+c);var b=v&&void 0===d?p(i):g,_={};for(var w in e)v&&"as"===w||b(w)&&(_[w]=e[w]);return _.className=s,n&&(_.ref=n),l.createElement(l.Fragment,null,l.createElement(m,{cache:t,serialized:x,isStringTag:"string"===typeof i}),l.createElement(i,_))}));return w.displayName=void 0!==s?s:"Styled("+("string"===typeof h?h:h.displayName||h.name||"Component")+")",w.defaultProps=t.defaultProps,w.__emotion_real=w,w.__emotion_base=h,w.__emotion_styles=A,w.__emotion_forwardProp=d,Object.defineProperty(w,"toString",{value:function(){return"."+c}}),w.withComponent=function(t,r){return e(t,(0,i.A)({},n,r,{shouldForwardProp:f(w,r,!0)})).apply(void 0,A)},w}}.bind(null);["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){g[e]=g(e)}));var v=n(3290),y=n(3803),A=n(579);let x;function b(e){const{injectFirst:t,children:n}=e;return t&&x?(0,A.jsx)(r.C,{value:x,children:n}):n}"object"===typeof document&&(x=(0,y.A)({key:"css",prepend:!0}));var _=n(869);function w(e,t){return g(e,t)}const E=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3234:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A,extendSxProp:()=>r.A,unstable_createStyleFunctionSx:()=>i.k,unstable_defaultSxConfig:()=>o.A});var i=n(8812),r=n(8698),o=n(7758)},3290:(e,t,n)=>{"use strict";n.d(t,{AH:()=>u,i7:()=>h,mL:()=>c});var i=n(9369),r=n(5043),o=n(1722),s=n(9436),a=n(6598),l=(n(3803),n(219),function(e,t){var n=arguments;if(null==t||!i.h.call(t,"css"))return r.createElement.apply(void 0,n);var o=n.length,s=new Array(o);s[0]=i.E,s[1]=(0,i.c)(e,t);for(var a=2;a<o;a++)s[a]=n[a];return r.createElement.apply(null,s)});!function(e){var t;t||(t=e.JSX||(e.JSX={}))}(l||(l={}));var c=(0,i.w)((function(e,t){var n=e.styles,l=(0,a.J)([n],void 0,r.useContext(i.T)),c=r.useRef();return(0,s.i)((function(){var e=t.key+"-global",n=new t.sheet.constructor({key:e,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),i=!1,r=document.querySelector('style[data-emotion="'+e+" "+l.name+'"]');return t.sheet.tags.length&&(n.before=t.sheet.tags[0]),null!==r&&(i=!0,r.setAttribute("data-emotion",e),n.hydrate([r])),c.current=[n,i],function(){n.flush()}}),[t]),(0,s.i)((function(){var e=c.current,n=e[0];if(e[1])e[1]=!1;else{if(void 0!==l.next&&(0,o.sk)(t,l.next,!0),n.tags.length){var i=n.tags[n.tags.length-1].nextElementSibling;n.before=i,n.flush()}t.insert("",l,n,!1)}}),[t,l.name]),null}));function u(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.J)(t)}function h(){var e=u.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}},3319:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(1782).A},3375:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i="$$material"},3382:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l,getFunctionName:()=>o});var i=n(528);const r=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function o(e){const t=`${e}`.match(r);return t&&t[1]||""}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.displayName||e.name||o(e)||t}function a(e,t,n){const i=s(t);return e.displayName||(""!==i?`${n}(${i})`:n)}function l(e){if(null!=e){if("string"===typeof e)return e;if("function"===typeof e)return s(e,"Component");if("object"===typeof e)switch(e.$$typeof){case i.vM:return a(e,e.render,"ForwardRef");case i.lD:return a(e,e.type,"memo");default:return}}}},3462:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(5043),r=n(6564);function o(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.useMemo((()=>t.every((e=>null==e))?null:e=>{t.forEach((t=>{(0,r.A)(t,e)}))}),t)}},3468:(e,t,n)=>{"use strict";function i(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function i(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];clearTimeout(t),t=setTimeout((()=>{e.apply(this,r)}),n)}return i.clear=()=>{clearTimeout(t)},i}n.d(t,{A:()=>i})},3471:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},3574:(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var i=n(5043),r=n(9303);let o=!0,s=!1;const a=new r.E,l={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function c(e){e.metaKey||e.altKey||e.ctrlKey||(o=!0)}function u(){o=!1}function h(){"hidden"===this.visibilityState&&s&&(o=!0)}function d(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(n){}return o||function(e){const{type:t,tagName:n}=e;return!("INPUT"!==n||!l[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}const p=function(){const e=i.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",c,!0),t.addEventListener("mousedown",u,!0),t.addEventListener("pointerdown",u,!0),t.addEventListener("touchstart",u,!0),t.addEventListener("visibilitychange",h,!0))}),[]),t=i.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!d(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(s=!0,a.start(100,(()=>{s=!1})),t.current=!1,!0)},ref:e}}},3654:(e,t,n)=>{"use strict";n.d(t,{A:()=>l,b:()=>a});var i=n(5043),r=n(3030),o=n(579);const s=i.createContext(void 0);function a(e){let{props:t,name:n}=e;return function(e){const{theme:t,name:n,props:i}=e;if(!t||!t.components||!t.components[n])return i;const o=t.components[n];return o.defaultProps?(0,r.A)(o.defaultProps,i):o.styleOverrides||o.variants?i:(0,r.A)(o,i)}({props:t,name:n,theme:{components:i.useContext(s)}})}const l=function(e){let{value:t,children:n}=e;return(0,o.jsx)(s.Provider,{value:t,children:n})}},3662:(e,t,n)=>{"use strict";t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=c(n(5043)),o=c(n(5173)),s=c(n(9019)),a=c(n(7998)),l=n(6493);function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}l.nameShape.isRequired,o.default.bool,o.default.bool,o.default.bool,(0,l.transitionTimeout)("Appear"),(0,l.transitionTimeout)("Enter"),(0,l.transitionTimeout)("Leave");var h=function(e){function t(){var n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return n=i=u(this,e.call.apply(e,[this].concat(s))),i._wrapChild=function(e){return r.default.createElement(a.default,{name:i.props.transitionName,appear:i.props.transitionAppear,enter:i.props.transitionEnter,leave:i.props.transitionLeave,appearTimeout:i.props.transitionAppearTimeout,enterTimeout:i.props.transitionEnterTimeout,leaveTimeout:i.props.transitionLeaveTimeout},e)},u(i,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.render=function(){return r.default.createElement(s.default,i({},this.props,{childFactory:this._wrapChild}))},t}(r.default.Component);h.displayName="CSSTransitionGroup",h.propTypes={},h.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},t.default=h,e.exports=t.default},3665:(e,t,n)=>{const i=n(1928);function r(e){return`\n  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');\n\n  return {\n    update: function(body) {\n      ${i(e)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}\n    }\n  };\n`}e.exports=function(e){let t=r(e);return new Function("options",t)},e.exports.generateCreateDragForceFunctionBody=r},3746:e=>{e.exports=function(e){return 0===e?"x":1===e?"y":2===e?"z":"c"+(e+1)}},3763:(e,t,n)=>{"use strict";e.exports=n(4983)},3803:(e,t,n)=>{"use strict";n.d(t,{A:()=>re});var i=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(i){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)})),this.tags=[],this.ctr=0},e}(),r=Math.abs,o=String.fromCharCode,s=Object.assign;function a(e){return e.trim()}function l(e,t,n){return e.replace(t,n)}function c(e,t){return e.indexOf(t)}function u(e,t){return 0|e.charCodeAt(t)}function h(e,t,n){return e.slice(t,n)}function d(e){return e.length}function p(e){return e.length}function f(e,t){return t.push(e),e}var m=1,g=1,v=0,y=0,A=0,x="";function b(e,t,n,i,r,o,s){return{value:e,root:t,parent:n,type:i,props:r,children:o,line:m,column:g,length:s,return:""}}function _(e,t){return s(b("",null,null,"",null,null,0),e,{length:-e.length},t)}function w(){return A=y>0?u(x,--y):0,g--,10===A&&(g=1,m--),A}function E(){return A=y<v?u(x,y++):0,g++,10===A&&(g=1,m++),A}function S(){return u(x,y)}function C(){return y}function M(e,t){return h(x,e,t)}function T(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function R(e){return m=g=1,v=d(x=e),y=0,[]}function I(e){return x="",e}function P(e){return a(M(y-1,N(91===e?e+2:40===e?e+1:e)))}function B(e){for(;(A=S())&&A<33;)E();return T(e)>2||T(A)>3?"":" "}function L(e,t){for(;--t&&E()&&!(A<48||A>102||A>57&&A<65||A>70&&A<97););return M(e,C()+(t<6&&32==S()&&32==E()))}function N(e){for(;E();)switch(A){case e:return y;case 34:case 39:34!==e&&39!==e&&N(A);break;case 40:41===e&&N(e);break;case 92:E()}return y}function D(e,t){for(;E()&&e+A!==57&&(e+A!==84||47!==S()););return"/*"+M(t,y-1)+"*"+o(47===e?e:E())}function k(e){for(;!T(S());)E();return M(e,y)}var O="-ms-",U="-moz-",F="-webkit-",z="comm",j="rule",V="decl",G="@keyframes";function H(e,t){for(var n="",i=p(e),r=0;r<i;r++)n+=t(e[r],r,e,t)||"";return n}function W(e,t,n,i){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case V:return e.return=e.return||e.value;case z:return"";case G:return e.return=e.value+"{"+H(e.children,i)+"}";case j:e.value=e.props.join(",")}return d(n=H(e.children,i))?e.return=e.value+"{"+n+"}":""}function Q(e){return I(q("",null,null,null,[""],e=R(e),0,[0],e))}function q(e,t,n,i,r,s,a,h,p){for(var m=0,g=0,v=a,y=0,A=0,x=0,b=1,_=1,M=1,T=0,R="",I=r,N=s,O=i,U=R;_;)switch(x=T,T=E()){case 40:if(108!=x&&58==u(U,v-1)){-1!=c(U+=l(P(T),"&","&\f"),"&\f")&&(M=-1);break}case 34:case 39:case 91:U+=P(T);break;case 9:case 10:case 13:case 32:U+=B(x);break;case 92:U+=L(C()-1,7);continue;case 47:switch(S()){case 42:case 47:f($(D(E(),C()),t,n),p);break;default:U+="/"}break;case 123*b:h[m++]=d(U)*M;case 125*b:case 59:case 0:switch(T){case 0:case 125:_=0;case 59+g:-1==M&&(U=l(U,/\f/g,"")),A>0&&d(U)-v&&f(A>32?Y(U+";",i,n,v-1):Y(l(U," ","")+";",i,n,v-2),p);break;case 59:U+=";";default:if(f(O=X(U,t,n,m,g,r,h,R,I=[],N=[],v),s),123===T)if(0===g)q(U,t,O,O,I,s,v,h,N);else switch(99===y&&110===u(U,3)?100:y){case 100:case 108:case 109:case 115:q(e,O,O,i&&f(X(e,O,O,0,0,r,h,R,r,I=[],v),N),r,N,v,h,i?I:N);break;default:q(U,O,O,O,[""],N,0,h,N)}}m=g=A=0,b=M=1,R=U="",v=a;break;case 58:v=1+d(U),A=x;default:if(b<1)if(123==T)--b;else if(125==T&&0==b++&&125==w())continue;switch(U+=o(T),T*b){case 38:M=g>0?1:(U+="\f",-1);break;case 44:h[m++]=(d(U)-1)*M,M=1;break;case 64:45===S()&&(U+=P(E())),y=S(),g=v=d(R=U+=k(C())),T++;break;case 45:45===x&&2==d(U)&&(b=0)}}return s}function X(e,t,n,i,o,s,c,u,d,f,m){for(var g=o-1,v=0===o?s:[""],y=p(v),A=0,x=0,_=0;A<i;++A)for(var w=0,E=h(e,g+1,g=r(x=c[A])),S=e;w<y;++w)(S=a(x>0?v[w]+" "+E:l(E,/&\f/g,v[w])))&&(d[_++]=S);return b(e,t,n,0===o?j:u,d,f,m)}function $(e,t,n){return b(e,t,n,z,o(A),h(e,2,-2),0)}function Y(e,t,n,i){return b(e,t,n,V,h(e,0,i),h(e,i+1,-1),i)}var K=function(e,t,n){for(var i=0,r=0;i=r,r=S(),38===i&&12===r&&(t[n]=1),!T(r);)E();return M(e,y)},J=function(e,t){return I(function(e,t){var n=-1,i=44;do{switch(T(i)){case 0:38===i&&12===S()&&(t[n]=1),e[n]+=K(y-1,t,n);break;case 2:e[n]+=P(i);break;case 4:if(44===i){e[++n]=58===S()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=o(i)}}while(i=E());return e}(R(e),t))},Z=new WeakMap,ee=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,i=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||Z.get(n))&&!i){Z.set(e,!0);for(var r=[],o=J(t,r),s=n.props,a=0,l=0;a<o.length;a++)for(var c=0;c<s.length;c++,l++)e.props[l]=r[a]?o[a].replace(/&\f/g,s[c]):s[c]+" "+o[a]}}},te=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function ne(e,t){switch(function(e,t){return 45^u(e,0)?(((t<<2^u(e,0))<<2^u(e,1))<<2^u(e,2))<<2^u(e,3):0}(e,t)){case 5103:return F+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return F+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return F+e+U+e+O+e+e;case 6828:case 4268:return F+e+O+e+e;case 6165:return F+e+O+"flex-"+e+e;case 5187:return F+e+l(e,/(\w+).+(:[^]+)/,F+"box-$1$2"+O+"flex-$1$2")+e;case 5443:return F+e+O+"flex-item-"+l(e,/flex-|-self/,"")+e;case 4675:return F+e+O+"flex-line-pack"+l(e,/align-content|flex-|-self/,"")+e;case 5548:return F+e+O+l(e,"shrink","negative")+e;case 5292:return F+e+O+l(e,"basis","preferred-size")+e;case 6060:return F+"box-"+l(e,"-grow","")+F+e+O+l(e,"grow","positive")+e;case 4554:return F+l(e,/([^-])(transform)/g,"$1"+F+"$2")+e;case 6187:return l(l(l(e,/(zoom-|grab)/,F+"$1"),/(image-set)/,F+"$1"),e,"")+e;case 5495:case 3959:return l(e,/(image-set\([^]*)/,F+"$1$`$1");case 4968:return l(l(e,/(.+:)(flex-)?(.*)/,F+"box-pack:$3"+O+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+F+e+e;case 4095:case 3583:case 4068:case 2532:return l(e,/(.+)-inline(.+)/,F+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(d(e)-1-t>6)switch(u(e,t+1)){case 109:if(45!==u(e,t+4))break;case 102:return l(e,/(.+:)(.+)-([^]+)/,"$1"+F+"$2-$3$1"+U+(108==u(e,t+3)?"$3":"$2-$3"))+e;case 115:return~c(e,"stretch")?ne(l(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==u(e,t+1))break;case 6444:switch(u(e,d(e)-3-(~c(e,"!important")&&10))){case 107:return l(e,":",":"+F)+e;case 101:return l(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+F+(45===u(e,14)?"inline-":"")+"box$3$1"+F+"$2$3$1"+O+"$2box$3")+e}break;case 5936:switch(u(e,t+11)){case 114:return F+e+O+l(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return F+e+O+l(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return F+e+O+l(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return F+e+O+e+e}return e}var ie=[function(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case V:e.return=ne(e.value,e.length);break;case G:return H([_(e,{value:l(e.value,"@","@"+F)})],i);case j:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return H([_(e,{props:[l(t,/:(read-\w+)/,":-moz-$1")]})],i);case"::placeholder":return H([_(e,{props:[l(t,/:(plac\w+)/,":"+F+"input-$1")]}),_(e,{props:[l(t,/:(plac\w+)/,":-moz-$1")]}),_(e,{props:[l(t,/:(plac\w+)/,O+"input-$1")]})],i)}return""}))}}],re=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r,o,s=e.stylisPlugins||ie,a={},l=[];r=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)a[t[n]]=!0;l.push(e)}));var c,u,h=[W,(u=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],d=function(e){var t=p(e);return function(n,i,r,o){for(var s="",a=0;a<t;a++)s+=e[a](n,i,r,o)||"";return s}}([ee,te].concat(s,h));o=function(e,t,n,i){c=n,H(Q(e?e+"{"+t.styles+"}":t.styles),d),i&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new i({key:t,container:r,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:a,registered:{},insert:o};return f.sheet.hydrate(l),f}},3815:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(9172);const r=function(e,t){return t?(0,i.A)(e,t,{clone:!1}):e}},3832:(e,t,n)=>{n(36),n(7486),n(2206),n(8166),n(8244)},3886:e=>{e.exports=AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){const e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){const t=e.detail.el;t.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},3900:e=>{e.exports=function(){for(var e=arguments.length,t=[],n=0;n<e;n++)t[n]=arguments[n];if(0!==(t=t.filter((function(e){return null!=e}))).length)return 1===t.length?t[0]:t.reduce((function(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}))}},3940:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(1668);function r(e){return(0,i.A)(e).defaultView||window}},4095:(e,t,n)=>{e.exports=function(e){let t=r(e);return new Function("bodies","settings","random",t)},e.exports.generateFunctionBody=r;const i=n(1928);function r(e){let t=i(e);return`\n  var boundingBox = {\n    ${t("min_{var}: 0, max_{var}: 0,",{indent:4})}\n  };\n\n  return {\n    box: boundingBox,\n\n    update: updateBoundingBox,\n\n    reset: resetBoundingBox,\n\n    getBestNewPosition: function (neighbors) {\n      var ${t("base_{var} = 0",{join:", "})};\n\n      if (neighbors.length) {\n        for (var i = 0; i < neighbors.length; ++i) {\n          let neighborPos = neighbors[i].pos;\n          ${t("base_{var} += neighborPos.{var};",{indent:10})}\n        }\n\n        ${t("base_{var} /= neighbors.length;",{indent:8})}\n      } else {\n        ${t("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}\n      }\n\n      var springLength = settings.springLength;\n      return {\n        ${t("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}\n      };\n    }\n  };\n\n  function updateBoundingBox() {\n    var i = bodies.length;\n    if (i === 0) return; // No bodies - no borders.\n\n    ${t("var max_{var} = -Infinity;",{indent:4})}\n    ${t("var min_{var} = Infinity;",{indent:4})}\n\n    while(i--) {\n      // this is O(n), it could be done faster with quadtree, if we check the root node bounds\n      var bodyPos = bodies[i].pos;\n      ${t("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}\n      ${t("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}\n    }\n\n    ${t("boundingBox.min_{var} = min_{var};",{indent:4})}\n    ${t("boundingBox.max_{var} = max_{var};",{indent:4})}\n  }\n\n  function resetBoundingBox() {\n    ${t("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}\n  }\n`}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function A(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=A.prototype=new y;x.constructor=A,m(x,v.prototype),x.isPureReactComponent=!0;var b=Array.isArray,_=Object.prototype.hasOwnProperty,w={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,i){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)_.call(t,r)&&!E.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:w.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var M=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function R(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return s=s(l=e),e=""===o?"."+T(l,0):o,b(s)?(r="",null!=e&&(r=e.replace(M,"$&/")+"/"),R(s,t,r,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(M,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",b(e))for(var c=0;c<e.length;c++){var u=o+T(a=e[c],c);l+=R(a,t,r,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=R(a=a.value,t,r,u=o+T(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,n){if(null==e)return e;var i=[],r=0;return R(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var B={current:null},L={transition:null},N={ReactCurrentDispatcher:B,ReactCurrentBatchConfig:L,ReactCurrentOwner:w};function D(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=s,t.PureComponent=A,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.act=D,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=w.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!E.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:r,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=D,t.useCallback=function(e,t){return B.current.useCallback(e,t)},t.useContext=function(e){return B.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return B.current.useDeferredValue(e)},t.useEffect=function(e,t){return B.current.useEffect(e,t)},t.useId=function(){return B.current.useId()},t.useImperativeHandle=function(e,t,n){return B.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return B.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return B.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return B.current.useMemo(e,t)},t.useReducer=function(e,t,n){return B.current.useReducer(e,t,n)},t.useRef=function(e){return B.current.useRef(e)},t.useState=function(e){return B.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return B.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return B.current.useTransition()},t.version="18.3.1"},4391:(e,t,n)=>{"use strict";var i=n(7950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},4428:(e,t)=>{"use strict";t.__esModule=!0,t.default=void 0;var n=!("undefined"===typeof window||!window.document||!window.document.createElement);t.default=n,e.exports=t.default},4440:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(5043);const r="undefined"!==typeof window?i.useLayoutEffect:i.useEffect},4483:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")},e.exports=t.default},4535:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>a});var i=n(8052),r=n(5170),o=n(3375),s=n(1475);const a=(0,i.Ay)({themeId:o.A,defaultTheme:r.A,rootShouldForwardProp:s.A})},4634:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4677:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Pathfinding:()=>a,PathfindingHelper:()=>l});var i=n(9435);class r{static roundNumber(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,t){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return n*n+i*i+r*r}static isPointInPoly(e,t){for(var n=!1,i=-1,r=e.length,o=r-1;++i<r;o=i)(e[i].z<=t.z&&t.z<e[o].z||e[o].z<=t.z&&t.z<e[i].z)&&t.x<(e[o].x-e[i].x)*(t.z-e[i].z)/(e[o].z-e[i].z)+e[i].x&&(n=!n);return n}static isVectorInPolygon(e,t,n){var i=1e5,r=-1e5,o=[];return t.vertexIds.forEach((e=>{i=Math.min(n[e].y,i),r=Math.max(n[e].y,r),o.push(n[e])})),!!(e.y<r+.5&&e.y>i-.5&&this.isPointInPoly(o,e))}static triarea2(e,t,n){return(n.x-e.x)*(t.z-e.z)-(t.x-e.x)*(n.z-e.z)}static vequal(e,t){return this.distanceToSquared(e,t)<1e-5}static mergeVertices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;t=Math.max(t,Number.EPSILON);for(var n={},r=e.getIndex(),o=e.getAttribute("position"),s=r?r.count:o.count,a=0,l=[],c=[],u=Math.log10(1/t),h=Math.pow(10,u),d=0;d<s;d++){var p=r?r.getX(d):d,f="";f+=~~(o.getX(p)*h)+",",f+=~~(o.getY(p)*h)+",",(f+=~~(o.getZ(p)*h)+",")in n?l.push(n[f]):(c.push(o.getX(p)),c.push(o.getY(p)),c.push(o.getZ(p)),n[f]=a,l.push(a),a++)}const m=new i.THS(new Float32Array(c),o.itemSize,o.normalized),g=new i.LoY;return g.setAttribute("position",m),g.setIndex(l),g}}class o{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e}remove(e){const t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const t=this.content[e];for(;e>0;){const n=(e+1>>1)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,e=n}}bubbleUp(e){const t=this.content.length,n=this.content[e],i=this.scoreFunction(n);for(;;){const r=e+1<<1,o=r-1;let s,a=null;if(o<t&&(s=this.scoreFunction(this.content[o]),s<i&&(a=o)),r<t&&this.scoreFunction(this.content[r])<(null===a?i:s)&&(a=r),null===a)break;this.content[e]=this.content[a],this.content[a]=n,e=a}}}class s{constructor(){this.portals=[]}push(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})}stringPull(){const e=this.portals,t=[];let n,i,o,s=0,a=0,l=0;n=e[0].left,i=e[0].left,o=e[0].right,t.push(n);for(let c=1;c<e.length;c++){const u=e[c].left,h=e[c].right;if(r.triarea2(n,o,h)<=0){if(!(r.vequal(n,o)||r.triarea2(n,i,h)>0)){t.push(i),n=i,s=a,i=n,o=n,a=s,l=s,c=s;continue}o=h,l=c}if(r.triarea2(n,i,u)>=0){if(!(r.vequal(n,i)||r.triarea2(n,o,u)<0)){t.push(o),n=o,s=l,i=n,o=n,a=s,l=s,c=s;continue}i=u,a=c}}return 0!==t.length&&r.vequal(t[t.length-1],e[e.length-1].left)||t.push(e[e.length-1].left),this.path=t,t}}class a{constructor(){this.zones={}}static createZone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;return class{static buildZone(e,t){const n=this._buildNavigationMesh(e,t),o={};n.vertices.forEach((e=>{e.x=r.roundNumber(e.x,2),e.y=r.roundNumber(e.y,2),e.z=r.roundNumber(e.z,2)})),o.vertices=n.vertices;const s=this._buildPolygonGroups(n);return o.groups=new Array(s.length),s.forEach(((e,t)=>{const n=new Map;e.forEach(((e,t)=>{n.set(e,t)}));const s=new Array(e.length);e.forEach(((e,t)=>{const a=[];e.neighbours.forEach((e=>a.push(n.get(e))));const l=[];e.neighbours.forEach((t=>l.push(this._getSharedVerticesInOrder(e,t))));const c=new i.Pq0(0,0,0);c.add(o.vertices[e.vertexIds[0]]),c.add(o.vertices[e.vertexIds[1]]),c.add(o.vertices[e.vertexIds[2]]),c.divideScalar(3),c.x=r.roundNumber(c.x,2),c.y=r.roundNumber(c.y,2),c.z=r.roundNumber(c.z,2),s[t]={id:t,neighbours:a,vertexIds:e.vertexIds,centroid:c,portals:l}})),o.groups[t]=s})),o}static _buildNavigationMesh(e,t){return e=r.mergeVertices(e,t),this._buildPolygonsFromGeometry(e)}static _spreadGroupId(e){let t=new Set([e]);for(;t.size>0;){const n=t;t=new Set,n.forEach((n=>{n.group=e.group,n.neighbours.forEach((e=>{void 0===e.group&&t.add(e)}))}))}}static _buildPolygonGroups(e){const t=[];return e.polygons.forEach((e=>{void 0!==e.group?t[e.group].push(e):(e.group=t.length,this._spreadGroupId(e),t.push([e]))})),t}static _buildPolygonNeighbours(e,t){const n=new Set,i=t[e.vertexIds[1]],r=t[e.vertexIds[2]];return t[e.vertexIds[0]].forEach((t=>{t!==e&&(i.includes(t)||r.includes(t))&&n.add(t)})),i.forEach((t=>{t!==e&&r.includes(t)&&n.add(t)})),n}static _buildPolygonsFromGeometry(e){const t=[],n=[],r=e.attributes.position,o=e.index,s=[];for(let a=0;a<r.count;a++)n.push((new i.Pq0).fromBufferAttribute(r,a)),s[a]=[];for(let i=0;i<e.index.count;i+=3){const e=o.getX(i),n=o.getX(i+1),r=o.getX(i+2),a={vertexIds:[e,n,r],neighbours:null};t.push(a),s[e].push(a),s[n].push(a),s[r].push(a)}return t.forEach((e=>{e.neighbours=this._buildPolygonNeighbours(e,s)})),{polygons:t,vertices:n}}static _getSharedVerticesInOrder(e,t){const n=e.vertexIds,i=n[0],r=n[1],o=n[2],s=t.vertexIds,a=s.includes(i),l=s.includes(r),c=s.includes(o);return a&&l&&c?Array.from(n):a&&l?[i,r]:l&&c?[r,o]:a&&c?[o,i]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}.buildZone(e,t)}setZoneData(e,t){this.zones[e]=t}getRandomNode(e,t,n,o){if(!this.zones[e])return new i.Pq0;n=n||null,o=o||0;const s=[];return this.zones[e].groups[t].forEach((e=>{n&&o?r.distanceToSquared(n,e.centroid)<o*o&&s.push(e.centroid):s.push(e.centroid)})),r.sample(s)||new i.Pq0}getClosestNode(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this.zones[t].vertices;let s=null,a=1/0;return this.zones[t].groups[n].forEach((t=>{const n=r.distanceToSquared(t.centroid,e);n<a&&(!i||r.isVectorInPolygon(e,t,o))&&(s=t,a=n)})),s}findPath(e,t,n,a){const l=this.zones[n].groups[a],c=this.zones[n].vertices,u=this.getClosestNode(e,n,a,!0),h=this.getClosestNode(t,n,a,!0);if(!u||!h)return null;const d=class{static init(e){for(let t=0;t<e.length;t++){const n=e[t];n.f=0,n.g=0,n.h=0,n.cost=1,n.visited=!1,n.closed=!1,n.parent=null}}static cleanUp(e){for(let t=0;t<e.length;t++){const n=e[t];delete n.f,delete n.g,delete n.h,delete n.cost,delete n.visited,delete n.closed,delete n.parent}}static heap(){return new o((function(e){return e.f}))}static search(e,t,n){this.init(e);const i=this.heap();for(i.push(t);i.size()>0;){const t=i.pop();if(t===n){let e=t;const n=[];for(;e.parent;)n.push(e),e=e.parent;return this.cleanUp(n),n.reverse()}t.closed=!0;const r=this.neighbours(e,t);for(let e=0,o=r.length;e<o;e++){const o=r[e];if(o.closed)continue;const s=t.g+o.cost,a=o.visited;if(!a||s<o.g){if(o.visited=!0,o.parent=t,!o.centroid||!n.centroid)throw new Error("Unexpected state");o.h=o.h||this.heuristic(o.centroid,n.centroid),o.g=s,o.f=o.g+o.h,a?i.rescoreElement(o):i.push(o)}}}return[]}static heuristic(e,t){return r.distanceToSquared(e,t)}static neighbours(e,t){const n=[];for(let i=0;i<t.neighbours.length;i++)n.push(e[t.neighbours[i]]);return n}}.search(l,u,h),p=function(e,t){for(var n=0;n<e.neighbours.length;n++)if(e.neighbours[n]===t.id)return e.portals[n]},f=new s;f.push(e);for(let i=0;i<d.length;i++){const e=d[i],t=d[i+1];if(t){const n=p(e,t);f.push(c[n[0]],c[n[1]])}}f.push(t),f.stringPull();const m=f.path.map((e=>new i.Pq0(e.x,e.y,e.z)));return m.shift(),m}}a.prototype.getGroup=function(){const e=new i.Zcv;return function(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.zones[t])return null;let o=null,s=Math.pow(50,2);const a=this.zones[t];for(let l=0;l<a.groups.length;l++){const t=a.groups[l];for(const c of t){if(i&&(e.setFromCoplanarPoints(a.vertices[c.vertexIds[0]],a.vertices[c.vertexIds[1]],a.vertices[c.vertexIds[2]]),Math.abs(e.distanceToPoint(n))<.01)&&r.isPointInPoly([a.vertices[c.vertexIds[0]],a.vertices[c.vertexIds[1]],a.vertices[c.vertexIds[2]]],n))return l;const t=r.distanceToSquared(c.centroid,n);t<s&&(o=l,s=t)}}return o}}(),a.prototype.clampStep=function(){const e=new i.Pq0,t=new i.Zcv,n=new i.lMl,r=new i.Pq0;let o,s,a=new i.Pq0;return function(i,l,c,u,h,d){const p=this.zones[u].vertices,f=this.zones[u].groups[h],m=[c],g={};g[c.id]=0,o=void 0,a.set(0,0,0),s=1/0,t.setFromCoplanarPoints(p[c.vertexIds[0]],p[c.vertexIds[1]],p[c.vertexIds[2]]),t.projectPoint(l,e),r.copy(e);for(let t=m.pop();t;t=m.pop()){n.set(p[t.vertexIds[0]],p[t.vertexIds[1]],p[t.vertexIds[2]]),n.closestPointToPoint(r,e),e.distanceToSquared(r)<s&&(o=t,a.copy(e),s=e.distanceToSquared(r));const i=g[t.id];if(!(i>2))for(let e=0;e<t.neighbours.length;e++){const n=f[t.neighbours[e]];n.id in g||(m.push(n),g[n.id]=i+1)}}return d.copy(a),o}}();class l extends i.B69{constructor(){super(),this._playerMarker=new i.eaF(new i.Gu$(.25,32,32),new i.V9B({color:15631215})),this._targetMarker=new i.eaF(new i.iNn(.3,.3,.3),new i.V9B({color:14469912})),this._nodeMarker=new i.eaF(new i.iNn(.1,.8,.1),new i.V9B({color:4417387})),this._stepMarker=new i.eaF(new i.iNn(.1,1,.1),new i.V9B({color:14472114})),this._pathMarker=new i.B69,this._pathLineMaterial=new i.mrM({color:41903,linewidth:2}),this._pathPointMaterial=new i.V9B({color:41903}),this._pathPointGeometry=new i.Gu$(.08),this._markers=[this._playerMarker,this._targetMarker,this._nodeMarker,this._stepMarker,this._pathMarker],this._markers.forEach((e=>{e.visible=!1,this.add(e)}))}setPath(e){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);e=[this._playerMarker.position].concat(e);const t=new i.LoY;t.setAttribute("position",new i.THS(new Float32Array(3*e.length),3));for(let n=0;n<e.length;n++)t.attributes.position.setXYZ(n,e[n].x,e[n].y+.2,e[n].z);this._pathMarker.add(new i.N1A(t,this._pathLineMaterial));for(let n=0;n<e.length-1;n++){const t=new i.eaF(this._pathPointGeometry,this._pathPointMaterial);t.position.copy(e[n]),t.position.y+=.2,this._pathMarker.add(t)}return this._pathMarker.visible=!0,this}setPlayerPosition(e){return this._playerMarker.position.copy(e),this._playerMarker.visible=!0,this}setTargetPosition(e){return this._targetMarker.position.copy(e),this._targetMarker.visible=!0,this}setNodePosition(e){return this._nodeMarker.position.copy(e),this._nodeMarker.visible=!0,this}setStepPosition(e){return this._stepMarker.position.copy(e),this._stepMarker.visible=!0,this}reset(){for(;this._pathMarker.children.length;)this._pathMarker.children[0].visible=!1,this._pathMarker.remove(this._pathMarker.children[0]);return this._markers.forEach((e=>{e.visible=!1})),this}}},4853:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(8587),r=n(8168);const o=["values","unit","step"],s=e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,r.A)({},e,{[t.key]:t.val})),{})};function a(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:a=5}=e,l=(0,i.A)(e,o),c=s(t),u=Object.keys(c);function h(e){return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${n})`}function d(e){return`@media (max-width:${("number"===typeof t[e]?t[e]:e)-a/100}${n})`}function p(e,i){const r=u.indexOf(i);return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${n}) and (max-width:${(-1!==r&&"number"===typeof t[u[r]]?t[u[r]]:i)-a/100}${n})`}return(0,r.A)({keys:u,values:c,up:h,down:d,between:p,only:function(e){return u.indexOf(e)+1<u.length?p(e,u[u.indexOf(e)+1]):h(e)},not:function(e){const t=u.indexOf(e);return 0===t?h(u[1]):t===u.length-1?d(u[t]):p(e,u[u.indexOf(e)+1]).replace("@media","@media not all and")},unit:n},l)}},4893:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},4983:(e,t)=>{"use strict";var n="function"===typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,d=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,A=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case h:case o:case a:case s:case p:return e;default:switch(e=e&&e.$$typeof){case c:case d:case g:case m:case l:return e;default:return t}}case r:return t}}}function _(e){return b(e)===h}t.AsyncMode=u,t.ConcurrentMode=h,t.ContextConsumer=c,t.ContextProvider=l,t.Element=i,t.ForwardRef=d,t.Fragment=o,t.Lazy=g,t.Memo=m,t.Portal=r,t.Profiler=a,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return _(e)||b(e)===u},t.isConcurrentMode=_,t.isContextConsumer=function(e){return b(e)===c},t.isContextProvider=function(e){return b(e)===l},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return b(e)===d},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===g},t.isMemo=function(e){return b(e)===m},t.isPortal=function(e){return b(e)===r},t.isProfiler=function(e){return b(e)===a},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===h||e===a||e===s||e===p||e===f||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===d||e.$$typeof===y||e.$$typeof===A||e.$$typeof===x||e.$$typeof===v)},t.typeOf=b},4989:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A,private_createBreakpoints:()=>r.A,unstable_applyStyles:()=>o.A});var i=n(8280),r=n(4853),o=n(9703)},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},5013:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(4440).A},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5051:(e,t,n)=>{"use strict";t.__esModule=!0,t.getChildMapping=function(e){if(!e)return e;var t={};return i.Children.map(e,(function(e){return e})).forEach((function(e){t[e.key]=e})),t},t.mergeChildMappings=function(e,t){function n(n){return t.hasOwnProperty(n)?t[n]:e[n]}e=e||{},t=t||{};var i={},r=[];for(var o in e)t.hasOwnProperty(o)?r.length&&(i[o]=r,r=[]):r.push(o);var s=void 0,a={};for(var l in t){if(i.hasOwnProperty(l))for(s=0;s<i[l].length;s++){var c=i[l][s];a[i[l][s]]=n(c)}a[l]=n(l)}for(s=0;s<r.length;s++)a[r[s]]=n(r[s]);return a};var i=n(5043)},5129:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-6 0h-4V4h4z"}),"Work")},5170:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=(0,n(8279).A)()},5173:(e,t,n)=>{e.exports=n(1497)()},5227:(e,t,n)=>{"use strict";var i=n(8634),r=Uint8Array,o=Uint16Array,s=Int32Array,a=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,t){for(var n=new o(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new s(n[30]);for(i=1;i<30;++i)for(var a=n[i];a<n[i+1];++a)r[a]=a-n[i]<<5|i;return{b:n,r:r}},h=u(a,2),d=h.b,p=h.r;d[28]=258,p[258]=28;for(var f=u(l,0),m=f.b,g=(f.r,new o(32768)),v=0;v<32768;++v){var y=(43690&v)>>1|(21845&v)<<1;y=(61680&(y=(52428&y)>>2|(13107&y)<<2))>>4|(3855&y)<<4,g[v]=((65280&y)>>8|(255&y)<<8)>>1}var A=function(e,t,n){for(var i=e.length,r=0,s=new o(t);r<i;++r)e[r]&&++s[e[r]-1];var a,l=new o(t);for(r=1;r<t;++r)l[r]=l[r-1]+s[r-1]<<1;if(n){a=new o(1<<t);var c=15-t;for(r=0;r<i;++r)if(e[r])for(var u=r<<4|e[r],h=t-e[r],d=l[e[r]-1]++<<h,p=d|(1<<h)-1;d<=p;++d)a[g[d]>>c]=u}else for(a=new o(i),r=0;r<i;++r)e[r]&&(a[r]=g[l[e[r]-1]++]>>15-e[r]);return a},x=new r(288);for(v=0;v<144;++v)x[v]=8;for(v=144;v<256;++v)x[v]=9;for(v=256;v<280;++v)x[v]=7;for(v=280;v<288;++v)x[v]=8;var b=new r(32);for(v=0;v<32;++v)b[v]=5;var _=A(x,9,1),w=A(b,5,1),E=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},C=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},M=function(e){return(e+7)/8|0},T=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new r(e.subarray(t,n))},R=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(e,t,n){var i=new Error(t||R[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,I),!n)throw i;return i},P=function(e,t,n,i){var o=e.length,s=i?i.length:0;if(!o||t.f&&!t.l)return n||new r(0);var u=!n,h=u||2!=t.i,p=t.i;u&&(n=new r(3*o));var f=function(e){var t=n.length;if(e>t){var i=new r(Math.max(2*t,e));i.set(n),n=i}},g=t.f||0,v=t.p||0,y=t.b||0,x=t.l,b=t.d,R=t.m,P=t.n,B=8*o;do{if(!x){g=S(e,v,1);var L=S(e,v+1,3);if(v+=3,!L){var N=e[(W=M(v)+4)-4]|e[W-3]<<8,D=W+N;if(D>o){p&&I(0);break}h&&f(y+N),n.set(e.subarray(W,D),y),t.b=y+=N,t.p=v=8*D,t.f=g;continue}if(1==L)x=_,b=w,R=9,P=5;else if(2==L){var k=S(e,v,31)+257,O=S(e,v+10,15)+4,U=k+S(e,v+5,31)+1;v+=14;for(var F=new r(U),z=new r(19),j=0;j<O;++j)z[c[j]]=S(e,v+3*j,7);v+=3*O;var V=E(z),G=(1<<V)-1,H=A(z,V,1);for(j=0;j<U;){var W,Q=H[S(e,v,G)];if(v+=15&Q,(W=Q>>4)<16)F[j++]=W;else{var q=0,X=0;for(16==W?(X=3+S(e,v,3),v+=2,q=F[j-1]):17==W?(X=3+S(e,v,7),v+=3):18==W&&(X=11+S(e,v,127),v+=7);X--;)F[j++]=q}}var $=F.subarray(0,k),Y=F.subarray(k);R=E($),P=E(Y),x=A($,R,1),b=A(Y,P,1)}else I(1);if(v>B){p&&I(0);break}}h&&f(y+131072);for(var K=(1<<R)-1,J=(1<<P)-1,Z=v;;Z=v){var ee=(q=x[C(e,v)&K])>>4;if((v+=15&q)>B){p&&I(0);break}if(q||I(2),ee<256)n[y++]=ee;else{if(256==ee){Z=v,x=null;break}var te=ee-254;if(ee>264){var ne=a[j=ee-257];te=S(e,v,(1<<ne)-1)+d[j],v+=ne}var ie=b[C(e,v)&J],re=ie>>4;ie||I(3),v+=15&ie;Y=m[re];if(re>3){ne=l[re];Y+=C(e,v)&(1<<ne)-1,v+=ne}if(v>B){p&&I(0);break}h&&f(y+131072);var oe=y+te;if(y<Y){var se=s-Y,ae=Math.min(Y,oe);for(se+y<0&&I(3);y<ae;++y)n[y]=i[se+y]}for(;y<oe;++y)n[y]=n[y-Y]}}t.l=x,t.p=Z,t.b=y,t.f=g,x&&(g=1,t.m=R,t.d=b,t.n=P)}while(!g);return y!=n.length&&u?T(n,0,y):n.subarray(0,y)},B=new r(0),L=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&I(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&I(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function N(e,t){return P(e.subarray(L(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}var D="undefined"!=typeof TextDecoder&&new TextDecoder;try{D.decode(B,{stream:!0})}catch(le){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function k(e,t,n){const i=n.length-e-1;if(t>=n[i])return i-1;if(t<=n[e])return e;let r=e,o=i,s=Math.floor((r+o)/2);for(;t<n[s]||t>=n[s+1];)t<n[s]?o=s:r=s,s=Math.floor((r+o)/2);return s}function O(e,t,n,i){const r=[],o=[],s=[];r[0]=1;for(let a=1;a<=n;++a){o[a]=t-i[e+1-a],s[a]=i[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=s[e+1],i=o[a-e],l=r[e]/(t+i);r[e]=n+t*l,n=i*l}r[a]=n}return r}function U(e,t){let n=1;for(let r=2;r<=e;++r)n*=r;let i=1;for(let r=2;r<=t;++r)i*=r;for(let r=2;r<=e-t;++r)i*=r;return n/i}function F(e,t,n,r,o){const s=function(e,t,n,r,o){const s=o<e?o:e,a=[],l=k(e,r,t),c=function(e,t,n,i,r){const o=[];for(let h=0;h<=n;++h)o[h]=0;const s=[];for(let h=0;h<=i;++h)s[h]=o.slice(0);const a=[];for(let h=0;h<=n;++h)a[h]=o.slice(0);a[0][0]=1;const l=o.slice(0),c=o.slice(0);for(let h=1;h<=n;++h){l[h]=t-r[e+1-h],c[h]=r[e+h]-t;let n=0;for(let e=0;e<h;++e){const t=c[e+1],i=l[h-e];a[h][e]=t+i;const r=a[e][h-1]/a[h][e];a[e][h]=n+t*r,n=i*r}a[h][h]=n}for(let h=0;h<=n;++h)s[0][h]=a[h][n];for(let h=0;h<=n;++h){let e=0,t=1;const r=[];for(let i=0;i<=n;++i)r[i]=o.slice(0);r[0][0]=1;for(let o=1;o<=i;++o){let i=0;const l=h-o,c=n-o;h>=o&&(r[t][0]=r[e][0]/a[c+1][l],i=r[t][0]*a[l][c]);const u=h-1<=c?o-1:n-h;for(let n=l>=-1?1:-l;n<=u;++n)r[t][n]=(r[e][n]-r[e][n-1])/a[c+1][l+n],i+=r[t][n]*a[l+n][c];h<=c&&(r[t][o]=-r[e][o-1]/a[c+1][h],i+=r[t][o]*a[h][c]),s[o][h]=i;const d=e;e=t,t=d}}let u=n;for(let h=1;h<=i;++h){for(let e=0;e<=n;++e)s[h][e]*=u;u*=n-h}return s}(l,r,e,s,t),u=[];for(let i=0;i<n.length;++i){const e=n[i].clone(),t=e.w;e.x*=t,e.y*=t,e.z*=t,u[i]=e}for(let i=0;i<=s;++i){const t=u[l-e].clone().multiplyScalar(c[i][0]);for(let n=1;n<=e;++n)t.add(u[l-e+n].clone().multiplyScalar(c[i][n]));a[i]=t}for(let h=s+1;h<=o+1;++h)a[h]=new i.IUQ(0,0,0);return a}(e,t,n,r,o);return function(e){const t=e.length,n=[],r=[];for(let s=0;s<t;++s){const t=e[s];n[s]=new i.Pq0(t.x,t.y,t.z),r[s]=t.w}const o=[];for(let i=0;i<t;++i){const e=n[i].clone();for(let t=1;t<=i;++t)e.sub(o[i-t].clone().multiplyScalar(U(i,t)*r[t]));o[i]=e.divideScalar(r[0])}return o}(s)}class z extends i.Ipv{constructor(e,t,n,r,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(let s=0;s<n.length;++s){const e=n[s];this.controlPoints[s]=new i.IUQ(e.x,e.y,e.z,e.w)}}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.Pq0,n=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=function(e,t,n,r){const o=k(e,r,t),s=O(o,r,e,t),a=new i.IUQ(0,0,0,0);for(let i=0;i<=e;++i){const t=n[o-e+i],r=s[i],l=t.w*r;a.x+=t.x*l,a.y+=t.y*l,a.z+=t.z*l,a.w+=t.w*r}return a}(this.degree,this.knots,this.controlPoints,n);return 1!==r.w&&r.divideScalar(r.w),t.set(r.x,r.y,r.z)}getTangent(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.Pq0,n=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=F(this.degree,this.knots,this.controlPoints,n,1);return t.copy(r[1]).normalize(),t}}let j,V,G;class H extends i.aHM{constructor(e){super(e)}load(e,t,n,r){const o=this,s=""===o.path?i.r6x.extractUrlBase(e):o.path,a=new i.Y9S(this.manager);a.setPath(o.path),a.setResponseType("arraybuffer"),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,(function(n){try{t(o.parse(n,s))}catch(le){r?r(le):console.error(le),o.manager.itemError(e)}}),n,r)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ae(e,0,t.length)}(e))j=(new $).parse(e);else{const t=ae(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function i(t){const i=e[t-1];return e=e.slice(n+t),n++,i}for(let r=0;r<t.length;++r){if(i(1)===t[r])return!1}return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(J(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+J(t));j=(new X).parse(t)}const n=new i.Tap(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new W(n,this.manager).parse(j)}}class W{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){V=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),r=(new Q).parse(i);return this.parseScene(i,r,n),G}parseConnections(){const e=new Map;if("Connections"in j){j.Connections.connections.forEach((function(t){const n=t[0],i=t[1],r=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:i,relationship:r};e.get(n).parents.push(o),e.has(i)||e.set(i,{parents:[],children:[]});const s={ID:n,relationship:r};e.get(i).children.push(s)}))}return e}parseImages(){const e={},t={};if("Video"in j.Objects){const n=j.Objects.Video;for(const i in n){const r=n[i];if(e[parseInt(i)]=r.RelativeFilename||r.Filename,"Content"in r){const e=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,o="string"===typeof r.Content&&""!==r.Content;if(e||o){const e=this.parseImage(n[i]);t[r.RelativeFilename||r.Filename]=e}}}}for(const n in e){const i=e[n];void 0!==t[i]?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"===typeof t)return"data:"+r+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in j.Objects){const n=j.Objects.Texture;for(const i in n){const r=this.parseTexture(n[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,o=e.WrapModeV,s=void 0!==r?r.value:0,a=void 0!==o?o.value:0;if(n.wrapS=0===s?i.GJx:i.ghU,n.wrapT=0===a?i.GJx:i.ghU,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,o=V.get(e.id).children;let s;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(n=t[o[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new i.gPd):(t.setPath(this.textureLoader.path),s=t.load(n))}else if("dds"===a){const t=this.manager.getHandler(".dds");null===t?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),s=new i.gPd):(t.setPath(this.textureLoader.path),s=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new i.gPd):s=this.textureLoader.load(n);return this.textureLoader.setPath(r),s}parseMaterials(e){const t=new Map;if("Material"in j.Objects){const n=j.Objects.Material;for(const i in n){const r=this.parseMaterial(n[i],e);null!==r&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let o=e.ShadingModel;if("object"===typeof o&&(o=o.value),!V.has(n))return null;const s=this.parseParameters(e,t,n);let a;switch(o.toLowerCase()){case"phong":a=new i.tXL;break;case"lambert":a=new i.G_z;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new i.tXL}return a.setValues(s),a.name=r,a}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new i.Q1f).fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new i.Q1f).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new i.Q1f).fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new i.Q1f).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new i.Q1f).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new i.Q1f).fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return V.get(n).children.forEach((function(e){const n=e.relationship;switch(n){case"Bump":r.bumpMap=o.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(t,e.ID),void 0!==r.map&&(r.map.colorSpace=i.er$);break;case"DisplacementColor":r.displacementMap=o.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(t,e.ID),void 0!==r.emissiveMap&&(r.emissiveMap.colorSpace=i.er$);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=o.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=i.wfO,r.envMap.colorSpace=i.er$);break;case"SpecularColor":r.specularMap=o.getTexture(t,e.ID),void 0!==r.specularMap&&(r.specularMap.colorSpace=i.er$);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(t,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),r}getTexture(e,t){return"LayeredTexture"in j.Objects&&t in j.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=V.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in j.Objects){const n=j.Objects.Deformer;for(const i in n){const r=n[i],o=V.get(parseInt(i));if("Skin"===r.attrType){const t=this.parseSkeleton(o,n);t.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[i]=t}else if("BlendShape"===r.attrType){const e={id:i};e.rawTargets=this.parseMorphTargets(o,n),e.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const r=t[e.ID];if("Cluster"!==r.attrType)return;const o={ID:e.ID,indices:[],weights:[],transformLink:(new i.kn4).fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),n.push(o)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],o=t[r.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=V.get(parseInt(r.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(s)}return n}parseScene(e,t,n){G=new i.YJl;const r=this.parseModels(e.skeletons,t,n),o=j.Objects.Model,s=this;r.forEach((function(e){const t=o[e.ID];s.setLookAtProperties(e,t);V.get(e.ID).parents.forEach((function(t){const n=r.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&G.add(e)})),this.bindSkeleton(e.skeletons,t,r),this.addGlobalSceneSettings(),G.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=re(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const a=(new q).parse();1===G.children.length&&G.children[0].isGroup&&(G.children[0].animations=a,G=G.children[0]),G.animations=a}parseModels(e,t,n){const r=new Map,o=j.Objects.Model;for(const s in o){const a=parseInt(s),l=o[s],c=V.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new i.$Kf;break;default:u=new i.YJl}u.name=l.attrName?i.Nwf.sanitizeNodeName(l.attrName):"",u.userData.originalName=l.attrName,u.ID=a}this.getTransformData(u,l),r.set(a,u)}return r}buildSkeleton(e,t,n,r){let o=null;return e.parents.forEach((function(e){for(const s in t){const a=t[s];a.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=o;o=new i.$Kf,o.matrixWorld.copy(t.transformLink),o.name=r?i.Nwf.sanitizeNodeName(r):"",o.userData.originalName=r,o.ID=n,a.bones[s]=o,null!==e&&o.add(e)}}))}})),o}createCamera(e){let t,n;if(e.children.forEach((function(e){const t=j.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new i.B69;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let r=1;void 0!==n.NearPlane&&(r=n.NearPlane.value/1e3);let o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,a=n.AspectHeight.value);const l=s/a;let c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new i.ubm(c,l,r,o),null!==u&&t.setFocalLength(u);break;case 1:t=new i.qUd(-s/2,s/2,a/2,-a/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new i.B69}}return t}createLight(e){let t,n;if(e.children.forEach((function(e){const t=j.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new i.B69;else{let e;e=void 0===n.LightType?0:n.LightType.value;let r=16777215;void 0!==n.Color&&(r=(new i.Q1f).fromArray(n.Color.value).convertSRGBToLinear());let o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);let s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new i.HiM(r,o,s,a);break;case 1:t=new i.ZyN(r,o);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=i.cj9.degToRad(n.InnerAngle.value));let l=0;void 0!==n.OuterAngle&&(l=i.cj9.degToRad(n.OuterAngle.value),l=Math.max(l,1)),t=new i.nCl(r,o,s,e,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new i.HiM(r,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,o=null,s=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(o=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?s=a:a.length>0?s=a[0]:(s=new i.tXL({name:i.aHM.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(s)),"color"in o.attributes&&a.forEach((function(e){e.vertexColors=!0})),o.FBX_Deformer?(r=new i.I46(o,s),r.normalizeSkinWeights()):r=new i.eaF(o,s),r}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new i.mrM({name:i.aHM.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new i.N1A(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?oe(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){if("LookAtProperty"in t){V.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const n=j.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),G.add(e.target)):e.lookAt((new i.Pq0).fromArray(t))}}}))}}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const o in e){const s=e[o];V.get(parseInt(s.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;V.get(t).parents.forEach((function(e){if(n.has(e.ID)){n.get(e.ID).bind(new i.EAD(s.bones),r[e.ID])}}))}}))}}parsePoseNodes(){const e={};if("Pose"in j.Objects){const t=j.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach((function(t){e[t.Node]=(new i.kn4).fromArray(t.Matrix.a)})):e[r.Node]=(new i.kn4).fromArray(r.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in j){if("AmbientColor"in j.GlobalSettings){const e=j.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){const e=new i.Q1f(t,n,r).convertSRGBToLinear();G.add(new i.$p8(e,1))}}"UnitScaleFactor"in j.GlobalSettings&&(G.userData.unitScaleFactor=j.GlobalSettings.UnitScaleFactor.value)}}}class Q{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in j.Objects){const n=j.Objects.Geometry;for(const i in n){const r=V.get(parseInt(i)),o=this.parseGeometry(r,n[i],e);t.set(parseInt(i),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,r=[],o=e.parents.map((function(e){return j.Objects.Model[e.ID]}));if(0===o.length)return;const s=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&r.push(n.morphTargets[e.ID])}));const a=o[0],l={};"RotationOrder"in a&&(l.eulerOrder=oe(a.RotationOrder.value)),"InheritType"in a&&(l.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(l.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(l.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(l.scale=a.GeometricScaling.value);const c=re(l);return this.genGeometry(t,s,r,c)}genGeometry(e,t,n,r){const o=new i.LoY;e.attrName&&(o.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),l=new i.qtW(a.vertex,3);if(l.applyMatrix4(r),o.setAttribute("position",l),a.colors.length>0&&o.setAttribute("color",new i.qtW(a.colors,3)),t&&(o.setAttribute("skinIndex",new i.A$4(a.weightsIndices,4)),o.setAttribute("skinWeight",new i.qtW(a.vertexWeights,4)),o.FBX_Deformer=t),a.normal.length>0){const e=(new i.dwI).getNormalMatrix(r),t=new i.qtW(a.normal,3);t.applyNormalMatrix(e),o.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){const n=0===t?"uv":`uv${t}`;o.setAttribute(n,new i.qtW(a.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,i){n!==e&&(o.addGroup(t,i-t,e),e=n,t=i)})),o.groups.length>0){const t=o.groups[o.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&o.addGroup(n,a.materialIndex.length-n,e)}0===o.groups.length&&o.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(o,e,n,r),o}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,r){void 0===n.weightTable[i]&&(n.weightTable[i]=[]),n.weightTable[i].push({id:t,weight:e.weights[r]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,r=!1,o=[],s=[],a=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d=~d,m=!0);let g=[],v=[];if(o.push(3*d,3*d+1,3*d+2),e.color){const t=te(p,n,d,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(n,i){let r=n,o=g[i];t.forEach((function(t,n,i){if(r>t){i[n]=r,r=t;const s=e[n];e[n]=o,o=s}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(g[e])}if(e.normal){const t=te(p,n,d,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=te(p,n,d,e.material)[0],f<0&&(h.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){const i=te(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(h.genFace(t,e,o,f,s,a,l,c,u,i),n++,i=0,o=[],s=[],a=[],l=[],c=[],u=[])})),t}getNormalNewell(e){const t=new i.Pq0(0,0,0);for(let n=0;n<e.length;n++){const i=e[n],r=e[(n+1)%e.length];t.x+=(i.y-r.y)*(i.z+r.z),t.y+=(i.z-r.z)*(i.x+r.x),t.z+=(i.x-r.x)*(i.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new i.Pq0(0,1,0):new i.Pq0(0,0,1)).cross(t).normalize(),r=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:r}}flattenVertex(e,t,n){return new i.I9Y(e.dot(t),e.dot(n))}genFace(e,t,n,r,o,s,a,l,c,u){let h;if(u>3){const e=[];for(let a=0;a<n.length;a+=3)e.push(new i.Pq0(t.vertexPositions[n[a]],t.vertexPositions[n[a+1]],t.vertexPositions[n[a+2]]));const{tangent:r,bitangent:o}=this.getNormalTangentAndBitangent(e),s=[];for(const t of e)s.push(this.flattenVertex(t,r,o));h=i.xJ6.triangulateShape(s,[])}else h=[[0,1,2]];for(const[i,d,p]of h)e.vertex.push(t.vertexPositions[n[3*i]]),e.vertex.push(t.vertexPositions[n[3*i+1]]),e.vertex.push(t.vertexPositions[n[3*i+2]]),e.vertex.push(t.vertexPositions[n[3*d]]),e.vertex.push(t.vertexPositions[n[3*d+1]]),e.vertex.push(t.vertexPositions[n[3*d+2]]),e.vertex.push(t.vertexPositions[n[3*p]]),e.vertex.push(t.vertexPositions[n[3*p+1]]),e.vertex.push(t.vertexPositions[n[3*p+2]]),t.skeleton&&(e.vertexWeights.push(l[4*i]),e.vertexWeights.push(l[4*i+1]),e.vertexWeights.push(l[4*i+2]),e.vertexWeights.push(l[4*i+3]),e.vertexWeights.push(l[4*d]),e.vertexWeights.push(l[4*d+1]),e.vertexWeights.push(l[4*d+2]),e.vertexWeights.push(l[4*d+3]),e.vertexWeights.push(l[4*p]),e.vertexWeights.push(l[4*p+1]),e.vertexWeights.push(l[4*p+2]),e.vertexWeights.push(l[4*p+3]),e.weightsIndices.push(c[4*i]),e.weightsIndices.push(c[4*i+1]),e.weightsIndices.push(c[4*i+2]),e.weightsIndices.push(c[4*i+3]),e.weightsIndices.push(c[4*d]),e.weightsIndices.push(c[4*d+1]),e.weightsIndices.push(c[4*d+2]),e.weightsIndices.push(c[4*d+3]),e.weightsIndices.push(c[4*p]),e.weightsIndices.push(c[4*p+1]),e.weightsIndices.push(c[4*p+2]),e.weightsIndices.push(c[4*p+3])),t.color&&(e.colors.push(s[3*i]),e.colors.push(s[3*i+1]),e.colors.push(s[3*i+2]),e.colors.push(s[3*d]),e.colors.push(s[3*d+1]),e.colors.push(s[3*d+2]),e.colors.push(s[3*p]),e.colors.push(s[3*p+1]),e.colors.push(s[3*p+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(o[3*i]),e.normal.push(o[3*i+1]),e.normal.push(o[3*i+2]),e.normal.push(o[3*d]),e.normal.push(o[3*d+1]),e.normal.push(o[3*d+2]),e.normal.push(o[3*p]),e.normal.push(o[3*p+1]),e.normal.push(o[3*p+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][2*i]),e.uvs[n].push(a[n][2*i+1]),e.uvs[n].push(a[n][2*d]),e.uvs[n].push(a[n][2*d+1]),e.uvs[n].push(a[n][2*p]),e.uvs[n].push(a[n][2*p+1])}))}addMorphTargets(e,t,n,i){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const o=j.Objects.Geometry[n.geoID];void 0!==o&&r.genMorphGeometry(e,t,o,i,n.name)}))}))}genMorphGeometry(e,t,n,r,o){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let i=0;i<l.length;i++){const e=3*l[i];u[e]=a[3*i],u[e+1]=a[3*i+1],u[e+2]=a[3*i+2]}const h={vertexIndices:s,vertexPositions:u},d=this.genBuffers(h),p=new i.qtW(d.vertex,3);p.name=o||n.attrName,p.applyMatrix4(r),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let r=[];return"IndexToDirect"===n&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let r=[];return"IndexToDirect"===n&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let o=[];"IndexToDirect"===n&&(o=e.ColorIndex.a);for(let s=0,a=new i.Q1f;s<r.length;s+=4)a.fromArray(r,s).convertSRGBToLinear().toArray(r,s);return{dataSize:4,buffer:r,indices:o,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,r=[];for(let o=0;o<i.length;++o)r.push(o);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new i.LoY;const n=t-1,r=e.KnotVector.a,o=[],s=e.Points.a;for(let u=0,h=s.length;u<h;u+=4)o.push((new i.IUQ).fromArray(s,u));let a,l;if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){a=n,l=r.length-1-a;for(let e=0;e<n;++e)o.push(o[e])}const c=new z(n,r,o,a,l).getPoints(12*o.length);return(new i.LoY).setFromPoints(c)}}class q{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const i=t[n],r=this.addClip(i);e.push(r)}return e}parseClips(){if(void 0===j.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=j.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){const e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=j.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(Z),values:t[n].KeyValueFloat.a},r=V.get(i.id);if(void 0!==r){const t=r.parents[0].ID,n=r.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=i:n.match(/Y/)?e.get(t).curves.y=i:n.match(/Z/)?e.get(t).curves.z=i:n.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){const t=j.Objects.AnimationLayer,n=new Map;for(const r in t){const t=[],o=V.get(parseInt(r));if(void 0!==o){o.children.forEach((function(n,r){if(e.has(n.ID)){const o=e.get(n.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===t[r]){const e=V.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const o=j.Objects.Model[e.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const s={modelName:o.attrName?i.Nwf.sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};G.traverse((function(e){e.ID===o.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new i.kn4),"PreRotation"in o&&(s.preRotation=o.PreRotation.value),"PostRotation"in o&&(s.postRotation=o.PostRotation.value),t[r]=s}}t[r]&&(t[r][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===t[r]){const e=V.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,o=V.get(e).parents[0].ID,s=V.get(o).parents[0].ID,a=V.get(s).parents[0].ID,l=j.Objects.Model[a],c={modelName:l.attrName?i.Nwf.sanitizeNodeName(l.attrName):"",morphName:j.Objects.Deformer[e].attrName};t[r]=c}t[r][o.attr]=o}}})),n.set(parseInt(r),t)}}return n}parseAnimStacks(e){const t=j.Objects.AnimationStack,n={};for(const i in t){const r=V.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);n[i]={name:t[i].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new i.tz3(e.name,-1,t)}generateTracks(e){const t=[];let n=new i.Pq0,r=new i.Pq0;if(e.transform&&e.transform.decompose(n,new i.PTz,r),n=n.toArray(),r=r.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,r){const o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,n);return new i.RiT(e+"."+r,o,s)}generateRotationTrack(e,t,n,r,o){let s,a;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){const e=this.interpolateRotations(t.x,t.y,t.z,o);s=e[0],a=e[1]}void 0!==n&&((n=n.map(i.cj9.degToRad)).push(o),n=(new i.O9p).fromArray(n),n=(new i.PTz).setFromEuler(n)),void 0!==r&&((r=r.map(i.cj9.degToRad)).push(o),r=(new i.O9p).fromArray(r),r=(new i.PTz).setFromEuler(r).invert());const l=new i.PTz,c=new i.O9p,u=[];if(!a||!s)return new i.MBL(e+".quaternion",[0],[0]);for(let h=0;h<a.length;h+=3){if(c.set(a[h],a[h+1],a[h+2],o),l.setFromEuler(c),void 0!==n&&l.premultiply(n),void 0!==r&&l.multiply(r),h>2){(new i.PTz).fromArray(u,(h-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w)}l.toArray(u,h/3*4)}return new i.MBL(e+".quaternion",s,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=G.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new i.Hit(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let i=1;i<t.length;i++){const r=t[i];r!==n&&(t[e]=r,n=r,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const i=n,r=[];let o=-1,s=-1,a=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];r.push(e),i[0]=e}else r.push(i[0]);if(-1!==s){const e=t.y.values[s];r.push(e),i[1]=e}else r.push(i[1]);if(-1!==a){const e=t.z.values[a];r.push(e),i[2]=e}else r.push(i[2])})),r}interpolateRotations(e,t,n,r){const o=[],s=[];o.push(e.times[0]),s.push(i.cj9.degToRad(e.values[0])),s.push(i.cj9.degToRad(t.values[0])),s.push(i.cj9.degToRad(n.values[0]));for(let a=1;a<e.values.length;a++){const l=[e.values[a-1],t.values[a-1],n.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(i.cj9.degToRad),u=[e.values[a],t.values[a],n.values[a]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const h=u.map(i.cj9.degToRad),d=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],p=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const t=Math.max(...p)/180,n=new i.O9p(...c,r),l=new i.O9p(...h,r),u=(new i.PTz).setFromEuler(n),d=(new i.PTz).setFromEuler(l);u.dot(d)&&d.set(-d.x,-d.y,-d.z,-d.w);const f=e.times[a-1],m=e.times[a]-f,g=new i.PTz,v=new i.O9p;for(let e=0;e<1;e+=1/t)g.copy(u.clone().slerp(d.clone(),e)),o.push(f+e*m),v.setFromQuaternion(g,r),s.push(v.x),s.push(v.y),s.push(v.z)}else o.push(e.times[a]),s.push(i.cj9.degToRad(e.values[a])),s.push(i.cj9.degToRad(t.values[a])),s.push(i.cj9.degToRad(n.values[a]))}return[o,s]}}class X{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new K,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,i){const r=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(r||o)return;const s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,n[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:n},o=this.parseNodeAttr(i),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,r):n in s?("PoseNode"===n?s.PoseNode.push(r):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==o.id&&(s[n][o.id]=r)):"number"===typeof o.id?(s[n]={},s[n][o.id]=r):"Properties70"!==n&&(s[n]="PoseNode"===n?[r]:r),"number"===typeof o.id&&(r.id=o.id),""!==o.name&&(r.attrName=o.name),""!==o.type&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===r&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===i){const e=r.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let s=r.split(",").slice(3);s=s.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",r=[t,n],function(e,t){for(let n=0,i=e.length,r=t.length;n<r;n++,i++)e[i]=t[n]}(r,s),void 0===o[i]&&(o[i]=[])}"Node"===i&&(o.id=r),i in o&&Array.isArray(o[i])?o[i].push(r):"a"!==i?o[i]=r:o.a=r,this.setCurrentProp(o,i),"a"===i&&","!==r.slice(-1)&&(o.a=se(r))}else this.parseNodeSpecialProperty(e,i,r)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=se(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),r=i[0],o=i[1],s=i[2],a=i[3];let l=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=se(l)}this.getPrevNode()[r]={type:o,type2:s,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class ${parse(e){const t=new Y(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new K;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),s=e.getString(o);if(0===i)return null;const a=[];for(let h=0;h<r;h++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===r&&e.getOffset()===i;i>e.getOffset();){const i=this.parseNode(e,t);null!==i&&this.parseSubNode(s,n,i)}return n.propertyList=a,"number"===typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==s&&(n.name=s),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],i=n.propertyList[1];const r=n.propertyList[2],o=n.propertyList[3];let s;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),s="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:i,type2:r,flag:o,value:s}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(0===r)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const s=N(new Uint8Array(e.getArrayBuffer(o))),a=new Y(s.buffer);switch(t){case"b":case"c":return a.getBooleanArray(i);case"d":return a.getFloat64Array(i);case"f":return a.getFloat32Array(i);case"i":return a.getInt32Array(i);case"l":return a.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Y{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class K{add(e,t){this[e]=t}}function J(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Z(e){return e/46186158e3}const ee=[];function te(e,t,n,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=e;break;case"ByPolygon":r=t;break;case"ByVertice":r=n;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const o=r*i.dataSize,s=o+i.dataSize;return function(e,t,n,i){for(let r=n,o=0;r<i;r++,o++)e[o]=t[r];return e}(ee,i.buffer,o,s)}const ne=new i.O9p,ie=new i.Pq0;function re(e){const t=new i.kn4,n=new i.kn4,r=new i.kn4,o=new i.kn4,s=new i.kn4,a=new i.kn4,l=new i.kn4,c=new i.kn4,u=new i.kn4,h=new i.kn4,d=new i.kn4,p=new i.kn4,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(ie.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(i.cj9.degToRad);t.push(e.eulerOrder||i.O9p.DEFAULT_ORDER),n.makeRotationFromEuler(ne.fromArray(t))}if(e.rotation){const t=e.rotation.map(i.cj9.degToRad);t.push(e.eulerOrder||i.O9p.DEFAULT_ORDER),r.makeRotationFromEuler(ne.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(i.cj9.degToRad);t.push(e.eulerOrder||i.O9p.DEFAULT_ORDER),o.makeRotationFromEuler(ne.fromArray(t)),o.invert()}e.scale&&s.scale(ie.fromArray(e.scale)),e.scalingOffset&&l.setPosition(ie.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(ie.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(ie.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(ie.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const m=n.clone().multiply(r).multiply(o),g=new i.kn4;g.extractRotation(h);const v=new i.kn4;v.copyPosition(h);const y=v.clone().invert().multiply(h),A=g.clone().invert().multiply(y),x=s,b=new i.kn4;if(0===f)b.copy(g).multiply(m).multiply(A).multiply(x);else if(1===f)b.copy(g).multiply(A).multiply(m).multiply(x);else{const e=(new i.kn4).scale((new i.Pq0).setFromMatrixScale(d)).clone().invert(),t=A.clone().multiply(e);b.copy(g).multiply(m).multiply(t).multiply(x)}const _=u.clone().invert(),w=a.clone().invert();let E=t.clone().multiply(c).multiply(u).multiply(n).multiply(r).multiply(o).multiply(_).multiply(l).multiply(a).multiply(s).multiply(w);const S=(new i.kn4).copyPosition(E),C=h.clone().multiply(S);return p.copyPosition(C),E=p.clone().multiply(b),E.premultiply(h.invert()),E}function oe(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function se(e){return e.split(",").map((function(e){return parseFloat(e)}))}function ae(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}THREE.FBXLoader=H,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const e=this.data;if(!e.src)return;this.remove();const t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},5310:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications")},5420:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(5043);const r=function(e){let{controlled:t,default:n,name:r,state:o="value"}=e;const{current:s}=i.useRef(void 0!==t),[a,l]=i.useState(n);return[s?t:a,i.useCallback((e=>{s||l(e)}),[])]}},5484:(e,t,n)=>{"use strict";function i(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==e&&void 0!==e&&this.setState(e)}function r(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!==n&&void 0!==n?n:null}.bind(this))}function o(e,t){try{var n=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,i)}finally{this.props=n,this.state=i}}function s(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!==typeof e.getDerivedStateFromProps&&"function"!==typeof t.getSnapshotBeforeUpdate)return e;var n=null,s=null,a=null;if("function"===typeof t.componentWillMount?n="componentWillMount":"function"===typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"===typeof t.componentWillReceiveProps?s="componentWillReceiveProps":"function"===typeof t.UNSAFE_componentWillReceiveProps&&(s="UNSAFE_componentWillReceiveProps"),"function"===typeof t.componentWillUpdate?a="componentWillUpdate":"function"===typeof t.UNSAFE_componentWillUpdate&&(a="UNSAFE_componentWillUpdate"),null!==n||null!==s||null!==a){var l=e.displayName||e.name,c="function"===typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+c+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==s?"\n  "+s:"")+(null!==a?"\n  "+a:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"===typeof e.getDerivedStateFromProps&&(t.componentWillMount=i,t.componentWillReceiveProps=r),"function"===typeof t.getSnapshotBeforeUpdate){if("function"!==typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var u=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var i=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;u.call(this,e,t,i)}}return e}n.r(t),n.d(t,{polyfill:()=>s}),i.__suppressDeprecationWarning=!0,r.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0},5502:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel")},5540:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")},5591:e=>{e.exports=Object.assign((function(){}),{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16})},5844:(e,t,n)=>{"use strict";var i;n.d(t,{A:()=>a});var r=n(5043);let o=0;const s=(i||(i=n.t(r,2)))["useId".toString()];function a(e){if(void 0!==s){const t=s();return null!=e?e:t}return function(e){const[t,n]=r.useState(e),i=e||t;return r.useEffect((()=>{null==t&&(o+=1,n(`mui-${o}`))}),[t]),i}(e)}},5849:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(3462).A},5879:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(5844).A},6078:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(3940).A},6360:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},6403:e=>{"use strict";function t(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}e.exports=function(e,n){e.classList?e.classList.remove(n):"string"===typeof e.className?e.className=t(e.className,n):e.setAttribute("class",t(e.className&&e.className.baseVal||"",n))}},6491:e=>{e.exports=AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){const t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(!this.active)return;const e=this.data,t=this.offset,n=this.position,i=this.targetPosition,r=this.checkpoint;return this.sync(),n.distanceTo(i)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:r}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)},sync:function(){const e=this.offset,t=this.position,n=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(n),n.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(n).sub(t)}})},6493:(e,t,n)=>{"use strict";t.__esModule=!0,t.nameShape=void 0,t.transitionTimeout=function(e){var t="transition"+e+"Timeout",n="transition"+e;return function(e){if(e[n]){if(null==e[t])return new Error(t+" wasn't supplied to CSSTransitionGroup: this can cause unreliable animations and won't be supported in a future version of React. See https://fb.me/react-animation-transition-group-timeout for more information.");if("number"!==typeof e[t])return new Error(t+" must be a number (in milliseconds)")}return null}};r(n(5043));var i=r(n(5173));function r(e){return e&&e.__esModule?e:{default:e}}t.nameShape=i.default.oneOfType([i.default.string,i.default.shape({enter:i.default.string,leave:i.default.string,active:i.default.string}),i.default.shape({enter:i.default.string,enterActive:i.default.string,leave:i.default.string,leaveActive:i.default.string,appear:i.default.string,appearActive:i.default.string})])},6531:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A});var i=n(1188)},6564:(e,t,n)=>{"use strict";function i(e,t){"function"===typeof e?e(t):e&&(e.current=t)}n.d(t,{A:()=>i})},6593:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(2456).A},6598:(e,t,n)=>{"use strict";n.d(t,{J:()=>g});var i={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},r=n(918),o=!1,s=/[A-Z]|^ms/g,a=/_EMO_([^_]+?)_([^]*?)_EMO_/g,l=function(e){return 45===e.charCodeAt(1)},c=function(e){return null!=e&&"boolean"!==typeof e},u=(0,r.A)((function(e){return l(e)?e:e.replace(s,"-$&").toLowerCase()})),h=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(a,(function(e,t,n){return f={name:t,styles:n,next:f},t}))}return 1===i[e]||l(e)||"number"!==typeof t||0===t?t:t+"px"},d="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function p(e,t,n){if(null==n)return"";var i=n;if(void 0!==i.__emotion_styles)return i;switch(typeof n){case"boolean":return"";case"object":var r=n;if(1===r.anim)return f={name:r.name,styles:r.styles,next:f},r.name;var s=n;if(void 0!==s.styles){var a=s.next;if(void 0!==a)for(;void 0!==a;)f={name:a.name,styles:a.styles,next:f},a=a.next;return s.styles+";"}return function(e,t,n){var i="";if(Array.isArray(n))for(var r=0;r<n.length;r++)i+=p(e,t,n[r])+";";else for(var s in n){var a=n[s];if("object"!==typeof a){var l=a;null!=t&&void 0!==t[l]?i+=s+"{"+t[l]+"}":c(l)&&(i+=u(s)+":"+h(s,l)+";")}else{if("NO_COMPONENT_SELECTOR"===s&&o)throw new Error(d);if(!Array.isArray(a)||"string"!==typeof a[0]||null!=t&&void 0!==t[a[0]]){var f=p(e,t,a);switch(s){case"animation":case"animationName":i+=u(s)+":"+f+";";break;default:i+=s+"{"+f+"}"}}else for(var m=0;m<a.length;m++)c(a[m])&&(i+=u(s)+":"+h(s,a[m])+";")}}return i}(e,t,n);case"function":if(void 0!==e){var l=f,m=n(e);return f=l,p(e,t,m)}}var g=n;if(null==t)return g;var v=t[g];return void 0!==v?v:g}var f,m=/label:\s*([^\s;{]+)\s*(;|$)/g;function g(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var i=!0,r="";f=void 0;var o=e[0];null==o||void 0===o.raw?(i=!1,r+=p(n,t,o)):r+=o[0];for(var s=1;s<e.length;s++){if(r+=p(n,t,e[s]),i)r+=o[s]}m.lastIndex=0;for(var a,l="";null!==(a=m.exec(r));)l+="-"+a[1];var c=function(e){for(var t,n=0,i=0,r=e.length;r>=4;++i,r-=4)t=1540483477*(65535&(t=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(r){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(r)+l;return{name:c,styles:r,next:f}}},6601:e=>{window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i,r=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},o=function(e){return e*(Math.PI/180)},s=function(e){return e*(180/Math.PI)},a=new Map,l=function(e){a.has(e)&&clearTimeout(a.get(e)),a.set(e,setTimeout(e,100))},c=function(e,t,n){for(var i,r=t.split(/[ ,]+/g),o=0;o<r.length;o+=1)i=r[o],e.addEventListener?e.addEventListener(i,n,!1):e.attachEvent&&e.attachEvent(i,n)},u=function(e,t,n){for(var i,r=t.split(/[ ,]+/g),o=0;o<r.length;o+=1)i=r[o],e.removeEventListener?e.removeEventListener(i,n):e.detachEvent&&e.detachEvent(i,n)},h=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},d=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},p=function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},f=function(e,t,n){var i=m(e);for(var r in i)if(i.hasOwnProperty(r))if("string"==typeof t)i[r]=t+" "+n;else{for(var o="",s=0,a=t.length;s<a;s+=1)o+=t[s]+" "+n+", ";i[r]=o.slice(0,-2)}return i},m=function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach((function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},g=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},v=function(e,t){if(e.length)for(var n=0,i=e.length;n<i;n+=1)t(e[n]);else t(e)},y=!!("ontouchstart"in window),A=!!window.PointerEvent,x=!!window.MSPointerEvent,b={start:"mousedown",move:"mousemove",end:"mouseup"},_={};function w(){}A?i={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?i={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:y?(i={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},_=b):i=b,w.prototype.on=function(e,t){var n,i=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var r=0;r<i.length;r+=1)n=i[r],this._handlers_[n]=this._handlers_[n]||[],this._handlers_[n].push(t);return this},w.prototype.off=function(e,t){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===t?this._handlers_[e]=null:this._handlers_[e]&&this._handlers_[e].indexOf(t)>=0&&this._handlers_[e].splice(this._handlers_[e].indexOf(t),1),this},w.prototype.trigger=function(e,t){var n,i=this,r=e.split(/[ ,]+/g);i._handlers_=i._handlers_||{};for(var o=0;o<r.length;o+=1)n=r[o],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach((function(e){e.call(i,{type:n,target:i},t)}))},w.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=function(e,t){var n={};for(var i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)?n[i]=t[i]:e.hasOwnProperty(i)&&(n[i]=e[i]);return n}(this.options,e))},w.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},c(e,i[t],n._domHandlers_[t]),_[t]&&c(e,_[t],n._domHandlers_[t]),n},w.prototype.unbindEvt=function(e,t){return this._domHandlers_=this._domHandlers_||{},u(e,i[t],this._domHandlers_[t]),_[t]&&u(e,_[t],this._domHandlers_[t]),delete this._domHandlers_[t],this};var E=w;function S(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=S.id,S.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}S.prototype=new E,S.constructor=S,S.id=0,S.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},S.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=function(e,t){var n=m("borderRadius");for(var i in n)n.hasOwnProperty(i)&&(n[i]=t);return n}(0,"50%"),n=f("transition","opacity",e),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},g(i.el,n),"circle"===this.options.shape&&g(i.back,t),g(i.front,t),this.applyStyles(i),this},S.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},S.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},S.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},S.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},S.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},S.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var n="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=n,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){var n=t.options.restJoystick,i={};i.x=!0===n||!1!==n.x?0:t.instance.frontPosition.x,i.y=!0===n||!1!==n.y?0:t.instance.frontPosition.y,t.setPosition(e,i)}return t},S.prototype.setPosition=function(e,t){var n=this;n.frontPosition={x:t.x,y:t.y};var i=n.options.fadeTime+"ms",r={};r.front=f("transition",["transform"],i);var o={front:{}};o.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(r),n.applyStyles(o),n.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(n),n.restCallback()}),n.options.fadeTime)},S.prototype.restCallback=function(){var e={};e.front=f("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},S.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},S.prototype.computeDirection=function(e){var t,n,i,r=e.angle.radian,o=Math.PI/4,s=Math.PI/2;if(r>o&&r<3*o&&!e.lockX?t="up":r>-o&&r<=o&&!e.lockY?t="left":r>3*-o&&r<=-o&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=r>-s&&r<s?"left":"right"),e.lockX||(i=r>0?"up":"down"),e.force>this.options.threshold){var a,l={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(l[a]=this.direction[a]);var c={};for(a in this.direction={x:n,y:i,angle:t},e.direction=this.direction,l)l[a]===this.direction[a]&&(c[a]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+i,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var C=S;function M(e,t){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=M.id,M.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(t),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var n=getComputedStyle(this.options.zone.parentElement);return n&&"flex"===n.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}M.prototype=new E,M.constructor=M,M.id=0,M.prototype.prepareNipples=function(){var e=this.nipples;e.on=this.on.bind(this),e.off=this.off.bind(this),e.options=this.options,e.destroy=this.destroy.bind(this),e.ids=this.ids,e.id=this.id,e.processOnMove=this.processOnMove.bind(this),e.processOnEnd=this.processOnEnd.bind(this),e.get=function(t){if(void 0===t)return e[0];for(var n=0,i=e.length;n<i;n+=1)if(e[n].identifier===t)return e[n];return!1}},M.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},M.prototype.begin=function(){var e=this.options;if("static"===e.mode){var t=this.createNipple(e.position,this.manager.getIdentifier());t.add(),this.idles.push(t)}},M.prototype.createNipple=function(e,t){var n=this.manager.scroll,i={},r=this.options,o=this.parentIsFlex?n.x:n.x+this.box.left,s=this.parentIsFlex?n.y:n.y+this.box.top;if(e.x&&e.y)i={x:e.x-o,y:e.y-s};else if(e.top||e.right||e.bottom||e.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=e.top,a.style.right=e.right,a.style.bottom=e.bottom,a.style.left=e.left,a.style.position="absolute",r.zone.appendChild(a);var l=a.getBoundingClientRect();r.zone.removeChild(a),i=e,e={x:l.left+n.x,y:l.top+n.y}}var c=new C(this,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:t,position:e,zone:r.zone,frontPosition:{x:0,y:0},shape:r.shape});return r.dataOnly||(p(c.ui.el,i),p(c.ui.front,c.frontPosition)),this.nipples.push(c),this.trigger("added "+c.identifier+":added",c),this.manager.trigger("added "+c.identifier+":added",c),this.bindNipple(c),c},M.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},M.prototype.bindNipple=function(e){var t,n=this,i=function(e,i){t=e.type+" "+i.id+":"+e.type,n.trigger(t,i)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)},M.prototype.pressureFn=function(e,t,n){var i=this,r=0;clearInterval(i.pressureIntervals[n]),i.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==r&&(t.trigger("pressure",n),i.trigger("pressure "+t.identifier+":pressure",n),r=n)}.bind(i),100)},M.prototype.onstart=function(e){var t=this,n=t.options,i=e;return e=h(e),t.updateBox(),v(e,(function(r){t.actives.length<n.maxNumberOfNipples?t.processOnStart(r):i.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(n){if(Object.values(i.touches).findIndex((function(e){return e.identifier===n}))<0){var r=[e[0]];r.identifier=n,t.processOnEnd(r)}})),t.actives.length<n.maxNumberOfNipples&&t.processOnStart(r))})),t.manager.bindDocument(),!1},M.prototype.processOnStart=function(e){var t,n=this,i=n.options,o=n.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},l=n.getOrCreate(o,a);l.identifier!==o&&n.manager.removeIdentifier(l.identifier),l.identifier=o;var c=function(t){t.trigger("start",t),n.trigger("start "+t.id+":start",t),t.show(),s>0&&n.pressureFn(e,t,t.identifier),n.processOnMove(e)};if((t=n.idles.indexOf(l))>=0&&n.idles.splice(t,1),n.actives.push(l),n.ids.push(l.identifier),"semi"!==i.mode)c(l);else{if(!(r(a,l.position)<=i.catchDistance))return l.destroy(),void n.processOnStart(e);c(l)}return l},M.prototype.getOrCreate=function(e,t){var n,i=this.options;return/(semi|static)/.test(i.mode)?(n=this.idles[0])?(this.idles.splice(0,1),n):"semi"===i.mode?this.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):n=this.createNipple(t,e)},M.prototype.processOnMove=function(e){var t=this.options,n=this.manager.getIdentifier(e),i=this.nipples.get(n),a=this.manager.scroll;if(function(e){return isNaN(e.buttons)?0!==e.pressure:0!==e.buttons}(e)){if(!i)return console.error("Found zombie joystick with ID "+n),void this.manager.removeIdentifier(n);if(t.dynamicPage){var l=i.el.getBoundingClientRect();i.position={x:a.x+l.left,y:a.y+l.top}}i.identifier=n;var c=i.options.size/2,u={x:e.pageX,y:e.pageY};t.lockX&&(u.y=i.position.y),t.lockY&&(u.x=i.position.x);var h,d,p,f,m,g,v,y,A,x,b=r(u,i.position),_=(h=u,p=(d=i.position).x-h.x,f=d.y-h.y,s(Math.atan2(f,p))),w=o(_),E=b/c,S={distance:b,position:u};if("circle"===i.options.shape?(m=Math.min(b,c),v=i.position,y=m,x={x:0,y:0},A=o(A=_),x.x=v.x-y*Math.cos(A),x.y=v.y-y*Math.sin(A),g=x):(g=function(e,t,n){return{x:Math.min(Math.max(e.x,t.x-n),t.x+n),y:Math.min(Math.max(e.y,t.y-n),t.y+n)}}(u,i.position,c),m=r(g,i.position)),t.follow){if(b>c){var C=u.x-g.x,M=u.y-g.y;i.position.x+=C,i.position.y+=M,i.el.style.top=i.position.y-(this.box.top+a.y)+"px",i.el.style.left=i.position.x-(this.box.left+a.x)+"px",b=r(u,i.position)}}else u=g,b=m;var T=u.x-i.position.x,R=u.y-i.position.y;i.frontPosition={x:T,y:R},t.dataOnly||(i.ui.front.style.transform="translate("+T+"px,"+R+"px)");var I={identifier:i.identifier,position:u,force:E,pressure:e.force||e.pressure||e.webkitForce||0,distance:b,angle:{radian:w,degree:_},vector:{x:T/c,y:-R/c},raw:S,instance:i,lockX:t.lockX,lockY:t.lockY};(I=i.computeDirection(I)).angle={radian:o(180-_),degree:180-_},i.trigger("move",I),this.trigger("move "+i.id+":move",I)}else this.processOnEnd(e)},M.prototype.processOnEnd=function(e){var t=this,n=t.options,i=t.manager.getIdentifier(e),r=t.nipples.get(i),o=t.manager.removeIdentifier(r.identifier);r&&(n.dataOnly||r.hide((function(){"dynamic"===n.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(n.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[o.id]=o.identifier))},M.prototype.onDestroyed=function(e,t){this.nipples.indexOf(t)>=0&&this.nipples.splice(this.nipples.indexOf(t),1),this.actives.indexOf(t)>=0&&this.actives.splice(this.actives.indexOf(t),1),this.idles.indexOf(t)>=0&&this.idles.splice(this.idles.indexOf(t),1),this.ids.indexOf(t.identifier)>=0&&this.ids.splice(this.ids.indexOf(t.identifier),1),this.manager.removeIdentifier(t.identifier),this.manager.unbindDocument()},M.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach((function(e){e.destroy()})),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var T=M;function R(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=d(),t.config(e),t.prepareCollections();var n=function(){var e;t.collections.forEach((function(n){n.forEach((function(n){e=n.el.getBoundingClientRect(),n.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};c(window,"resize",(function(){l(n)}));var i=function(){t.scroll=d()};return c(window,"scroll",(function(){l(i)})),t.collections}R.prototype=new E,R.constructor=R,R.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every((function(e){return!(n=e.get(t))})),n}},R.prototype.create=function(e){return this.createCollection(e)},R.prototype.createCollection=function(e){var t=new T(this,e);return this.bindCollection(t),this.collections.push(t),t},R.prototype.bindCollection=function(e){var t,n=this,i=function(e,i){t=e.type+" "+i.id+":"+e.type,n.trigger(t,i)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",i),e.on("dir:up dir:right dir:down dir:left",i),e.on("plain:up plain:right plain:down plain:left",i)},R.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},R.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},R.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},R.prototype.removeIdentifier=function(e){var t={};for(var n in this.ids)if(this.ids[n]===e){t.id=n,t.identifier=this.ids[n],delete this.ids[n];break}return t},R.prototype.onmove=function(e){return this.onAny("move",e),!1},R.prototype.onend=function(e){return this.onAny("end",e),!1},R.prototype.oncancel=function(e){return this.onAny("end",e),!1},R.prototype.onAny=function(e,t){var n,i=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);return t=h(t),v(t,(function(e){n=i.getIdentifier(e),v(i.collections,function(e,t,n){n.ids.indexOf(t)>=0&&(n[r](e),e._found_=!0)}.bind(null,e,n)),e._found_||i.removeIdentifier(n)})),!1},R.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach((function(e){e.destroy()})),this.off()},R.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)};var I=new R;t.default={create:function(e){return I.create(e)},factory:I}}]).default},6696:e=>{e.exports.Primitive=AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),e.exports.Component=AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const e=this.el,t=this.data;let n=e.components.material;const i=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);this.waves=[];const r=i.getAttribute("position");for(let o=0;o<r.count;o++)this.waves.push({z:r.getZ(o),ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});n||(n={},n.material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(i,n.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(!t)return;const n=this.mesh.geometry.getAttribute("position");for(let i=0;i<n.count;i++){const e=this.waves[i],r=e.z+Math.sin(e.ang)*e.amp;n.setZ(i,r),e.ang+=e.speed*t}n.needsUpdate=!0}})},6772:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalize:()=>r.A,createChainedFunction:()=>o.A,createSvgIcon:()=>s.A,debounce:()=>a.A,deprecatedPropType:()=>l,isMuiElement:()=>c.A,ownerDocument:()=>u.A,ownerWindow:()=>h.A,requirePropFactory:()=>d,setRef:()=>p,unstable_ClassNameGenerator:()=>b,unstable_useEnhancedEffect:()=>f.A,unstable_useId:()=>m.A,unsupportedProp:()=>g,useControlled:()=>v.A,useEventCallback:()=>y.A,useForkRef:()=>A.A,useIsFocusVisible:()=>x.A});var i=n(9386),r=n(6803),o=n(6593),s=n(9662),a=n(950);const l=function(e,t){return()=>null};var c=n(7328),u=n(2427),h=n(6078);n(8168);const d=function(e,t){return()=>null};const p=n(6564).A;var f=n(5013),m=n(5879);const g=function(e,t,n,i,r){return null};var v=n(5420),y=n(3319),A=n(5849),x=n(3574);const b={configure:e=>{i.A.configure(e)}}},6803:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=n(7598).A},6808:e=>{e.exports=AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},6817:(e,t,n)=>{const{Pathfinding:i}=n(4677),r=new i,o="level";e.exports=AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),r.setZoneData(o,i.createZone(e)),Array.from(this.agents).forEach((e=>e.updateNavLocation()))},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,n){return this.navMesh?r.findPath(e,t,o,n):null},getGroup:function(e){return this.navMesh?r.getGroup(o,e):null},getNode:function(e,t){return this.navMesh?r.getClosestNode(e,o,t,!0):null},clampStep:function(e,t,n,i,s){return this.navMesh?i?r.clampStep(e,t,i,o,n,s):(s.copy(t),this.getNode(t,n)):(s.copy(t),null)}})},7123:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});const i=function(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}},7162:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>a,BO:()=>s,Yn:()=>o});var i=n(7598),r=n(9751);function o(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){const n=`vars.${t}`.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=n)return n}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function s(e,t,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return i="function"===typeof e?e(n):Array.isArray(e)?e[n]||r:o(e,n)||r,t&&(i=t(i,r,e)),i}const a=function(e){const{prop:t,cssProperty:n=e.prop,themeKey:a,transform:l}=e,c=e=>{if(null==e[t])return null;const c=e[t],u=o(e.theme,a)||{};return(0,r.NI)(e,c,(e=>{let r=s(u,l,e);return e===r&&"string"===typeof e&&(r=s(u,l,`${t}${"default"===e?"":(0,i.A)(e)}`,e)),!1===n?r:{[n]:r}}))};return c.propTypes={},c.filterProps=[t],c}},7189:(e,t,n)=>{const i=n(1928),r=n(3746);function o(e){let t=i(e),n=Math.pow(2,e);return`\n${u()}\n${c(e)}\n${s(e)}\n${l(e)}\n${a(e)}\n\nfunction createQuadTree(options, random) {\n  options = options || {};\n  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;\n  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;\n\n  var gravity = options.gravity;\n  var updateQueue = [];\n  var insertStack = new InsertStack();\n  var theta = options.theta;\n\n  var nodesCache = [];\n  var currentInCache = 0;\n  var root = newNode();\n\n  return {\n    insertBodies: insertBodies,\n\n    /**\n     * Gets root node if it is present\n     */\n    getRoot: function() {\n      return root;\n    },\n\n    updateBodyForce: update,\n\n    options: function(newOptions) {\n      if (newOptions) {\n        if (typeof newOptions.gravity === 'number') {\n          gravity = newOptions.gravity;\n        }\n        if (typeof newOptions.theta === 'number') {\n          theta = newOptions.theta;\n        }\n\n        return this;\n      }\n\n      return {\n        gravity: gravity,\n        theta: theta\n      };\n    }\n  };\n\n  function newNode() {\n    // To avoid pressure on GC we reuse nodes.\n    var node = nodesCache[currentInCache];\n    if (node) {\n${function(e){let t=[];for(let i=0;i<n;++i)t.push(`${e}quad${i} = null;`);return t.join("\n")}("      node.")}\n      node.body = null;\n      node.mass = ${t("node.mass_{var} = ",{join:""})}0;\n      ${t("node.min_{var} = node.max_{var} = ",{join:""})}0;\n    } else {\n      node = new QuadNode();\n      nodesCache[currentInCache] = node;\n    }\n\n    ++currentInCache;\n    return node;\n  }\n\n  function update(sourceBody) {\n    var queue = updateQueue;\n    var v;\n    ${t("var d{var};",{indent:4})}\n    var r; \n    ${t("var f{var} = 0;",{indent:4})}\n    var queueLength = 1;\n    var shiftIdx = 0;\n    var pushIdx = 1;\n\n    queue[0] = root;\n\n    while (queueLength) {\n      var node = queue[shiftIdx];\n      var body = node.body;\n\n      queueLength -= 1;\n      shiftIdx += 1;\n      var differentBody = (body !== sourceBody);\n      if (body && differentBody) {\n        // If the current node is a leaf node (and it is not source body),\n        // calculate the force exerted by the current node on body, and add this\n        // amount to body's net force.\n        ${t("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${t("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Poor man's protection against zero distance.\n          ${t("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${t("d{var} * d{var}",{join:" + "})});\n        }\n\n        // This is standard gravitation force calculation but we divide\n        // by r^3 to save two operations when normalizing force vector.\n        v = gravity * body.mass * sourceBody.mass / (r * r * r);\n        ${t("f{var} += v * d{var};",{indent:8})}\n      } else if (differentBody) {\n        // Otherwise, calculate the ratio s / r,  where s is the width of the region\n        // represented by the internal node, and r is the distance between the body\n        // and the node's center-of-mass\n        ${t("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}\n        r = Math.sqrt(${t("d{var} * d{var}",{join:" + "})});\n\n        if (r === 0) {\n          // Sorry about code duplication. I don't want to create many functions\n          // right away. Just want to see performance first.\n          ${t("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}\n          r = Math.sqrt(${t("d{var} * d{var}",{join:" + "})});\n        }\n        // If s / r < \u03b8, treat this internal node as a single body, and calculate the\n        // force it exerts on sourceBody, and add this amount to sourceBody's net force.\n        if ((node.max_${r(0)} - node.min_${r(0)}) / r < theta) {\n          // in the if statement above we consider node's width only\n          // because the region was made into square during tree creation.\n          // Thus there is no difference between using width or height.\n          v = gravity * node.mass * sourceBody.mass / (r * r * r);\n          ${t("f{var} += v * d{var};",{indent:10})}\n        } else {\n          // Otherwise, run the procedure recursively on each of the current node's children.\n\n          // I intentionally unfolded this loop, to save several CPU cycles.\n${function(){let e=Array(11).join(" "),t=[];for(let i=0;i<n;++i)t.push(e+`if (node.quad${i}) {`),t.push(e+`  queue[pushIdx] = node.quad${i};`),t.push(e+"  queueLength += 1;"),t.push(e+"  pushIdx += 1;"),t.push(e+"}");return t.join("\n")}()}\n        }\n      }\n    }\n\n    ${t("sourceBody.force.{var} += f{var};",{indent:4})}\n  }\n\n  function insertBodies(bodies) {\n    ${t("var {var}min = Number.MAX_VALUE;",{indent:4})}\n    ${t("var {var}max = Number.MIN_VALUE;",{indent:4})}\n    var i = bodies.length;\n\n    // To reduce quad tree depth we are looking for exact bounding box of all particles.\n    while (i--) {\n      var pos = bodies[i].pos;\n      ${t("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}\n      ${t("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}\n    }\n\n    // Makes the bounds square.\n    var maxSideLength = -Infinity;\n    ${t("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}\n\n    currentInCache = 0;\n    root = newNode();\n    ${t("root.min_{var} = {var}min;",{indent:4})}\n    ${t("root.max_{var} = {var}min + maxSideLength;",{indent:4})}\n\n    i = bodies.length - 1;\n    if (i >= 0) {\n      root.body = bodies[i];\n    }\n    while (i--) {\n      insert(bodies[i], root);\n    }\n  }\n\n  function insert(newBody) {\n    insertStack.reset();\n    insertStack.push(root, newBody);\n\n    while (!insertStack.isEmpty()) {\n      var stackItem = insertStack.pop();\n      var node = stackItem.node;\n      var body = stackItem.body;\n\n      if (!node.body) {\n        // This is internal node. Update the total mass of the node and center-of-mass.\n        ${t("var {var} = body.pos.{var};",{indent:8})}\n        node.mass += body.mass;\n        ${t("node.mass_{var} += body.mass * {var};",{indent:8})}\n\n        // Recursively insert the body in the appropriate quadrant.\n        // But first find the appropriate quadrant.\n        var quadIdx = 0; // Assume we are in the 0's quad.\n        ${t("var min_{var} = node.min_{var};",{indent:8})}\n        ${t("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}\n\n${function(t){let n=[],i=Array(t+1).join(" ");for(let o=0;o<e;++o)n.push(i+`if (${r(o)} > max_${r(o)}) {`),n.push(i+`  quadIdx = quadIdx + ${Math.pow(2,o)};`),n.push(i+`  min_${r(o)} = max_${r(o)};`),n.push(i+`  max_${r(o)} = node.max_${r(o)};`),n.push(i+"}");return n.join("\n")}(8)}\n\n        var child = getChild(node, quadIdx);\n\n        if (!child) {\n          // The node is internal but this quadrant is not taken. Add\n          // subnode to it.\n          child = newNode();\n          ${t("child.min_{var} = min_{var};",{indent:10})}\n          ${t("child.max_{var} = max_{var};",{indent:10})}\n          child.body = body;\n\n          setChild(node, quadIdx, child);\n        } else {\n          // continue searching in this quadrant.\n          insertStack.push(child, body);\n        }\n      } else {\n        // We are trying to add to the leaf node.\n        // We have to convert current leaf into internal node\n        // and continue adding two nodes.\n        var oldBody = node.body;\n        node.body = null; // internal nodes do not cary bodies\n\n        if (isSamePosition(oldBody.pos, body.pos)) {\n          // Prevent infinite subdivision by bumping one node\n          // anywhere in this quadrant\n          var retriesCount = 3;\n          do {\n            var offset = random.nextDouble();\n            ${t("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}\n\n            ${t("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}\n            retriesCount -= 1;\n            // Make sure we don't bump it out of the box. If we do, next iteration should fix it\n          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));\n\n          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {\n            // This is very bad, we ran out of precision.\n            // if we do not return from the method we'll get into\n            // infinite loop here. So we sacrifice correctness of layout, and keep the app running\n            // Next layout iteration should get larger bounding box in the first step and fix this\n            return;\n          }\n        }\n        // Next iteration should subdivide node further.\n        insertStack.push(node, oldBody);\n        insertStack.push(node, body);\n      }\n    }\n  }\n}\nreturn createQuadTree;\n\n`}function s(e){let t=i(e);return`\n  function isSamePosition(point1, point2) {\n    ${t("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}\n  \n    return ${t("d{var} < 1e-8",{join:" && "})};\n  }  \n`}function a(e){var t=Math.pow(2,e);return`\nfunction setChild(node, idx, child) {\n  ${function(){let e=[];for(let n=0;n<t;++n){let t=0===n?"  ":"  else ";e.push(`${t}if (idx === ${n}) node.quad${n} = child;`)}return e.join("\n")}()}\n}`}function l(e){return`function getChild(node, idx) {\n${function(){let t=[],n=Math.pow(2,e);for(let e=0;e<n;++e)t.push(`  if (idx === ${e}) return node.quad${e};`);return t.join("\n")}()}\n  return null;\n}`}function c(e){let t=i(e),n=Math.pow(2,e);return`\nfunction QuadNode() {\n  // body stored inside this node. In quad tree only leaf nodes (by construction)\n  // contain bodies:\n  this.body = null;\n\n  // Child nodes are stored in quads. Each quad is presented by number:\n  // 0 | 1\n  // -----\n  // 2 | 3\n${function(e){let t=[];for(let i=0;i<n;++i)t.push(`${e}quad${i} = null;`);return t.join("\n")}("  this.")}\n\n  // Total mass of current node\n  this.mass = 0;\n\n  // Center of mass coordinates\n  ${t("this.mass_{var} = 0;",{indent:2})}\n\n  // bounding box coordinates\n  ${t("this.min_{var} = 0;",{indent:2})}\n  ${t("this.max_{var} = 0;",{indent:2})}\n}\n`}function u(){return"\n/**\n * Our implementation of QuadTree is non-recursive to avoid GC hit\n * This data structure represent stack of elements\n * which we are trying to insert into quad tree.\n */\nfunction InsertStack () {\n    this.stack = [];\n    this.popIdx = 0;\n}\n\nInsertStack.prototype = {\n    isEmpty: function() {\n        return this.popIdx === 0;\n    },\n    push: function (node, body) {\n        var item = this.stack[this.popIdx];\n        if (!item) {\n            // we are trying to avoid memory pressure: create new element\n            // only when absolutely necessary\n            this.stack[this.popIdx] = new InsertStackElement(node, body);\n        } else {\n            item.node = node;\n            item.body = body;\n        }\n        ++this.popIdx;\n    },\n    pop: function () {\n        if (this.popIdx > 0) {\n            return this.stack[--this.popIdx];\n        }\n    },\n    reset: function () {\n        this.popIdx = 0;\n    }\n};\n\nfunction InsertStackElement(node, body) {\n    this.node = node; // QuadTree node\n    this.body = body; // physical body which needs to be inserted to node\n}\n"}e.exports=function(e){let t=o(e);return new Function(t)()},e.exports.generateQuadTreeFunctionBody=o,e.exports.getInsertStackCode=u,e.exports.getQuadNodeCode=c,e.exports.isSamePosition=s,e.exports.getChildBodyCode=l,e.exports.setChildBodyCode=a},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<o(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,s=r>>>1;i<s;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<r&&0>o(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<r&&0>o(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,A="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function b(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,L(_);else{var t=i(u);null!==t&&N(b,t.startTime-e)}}function _(e,n){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var o=p;try{for(x(n),d=i(c);null!==d&&(!(d.expirationTime>n)||e&&!R());){var s=d.callback;if("function"===typeof s){d.callback=null,p=d.priorityLevel;var a=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?d.callback=a:d===i(c)&&r(c),x(n)}else r(c);d=i(c)}if(null!==d)var l=!0;else{var h=i(u);null!==h&&N(b,h.startTime-n),l=!1}return l}finally{d=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,E=!1,S=null,C=-1,M=5,T=-1;function R(){return!(t.unstable_now()-T<M)}function I(){if(null!==S){var e=t.unstable_now();T=e;var n=!0;try{n=S(!0,e)}finally{n?w():(E=!1,S=null)}}else E=!1}if("function"===typeof A)w=function(){A(I)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,B=P.port2;P.port1.onmessage=I,w=function(){B.postMessage(null)}}else w=function(){v(I,0)};function L(e){S=e,E||(E=!0,w())}function N(e,n){C=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,L(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,r,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:r,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===i(c)&&e===i(u)&&(g?(y(C),C=-1):g=!0,N(b,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,L(_))),e},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},7266:(e,t,n)=>{"use strict";var i=n(4994);t.X4=p,t.e$=f,t.eM=function(e,t){const n=d(e),i=d(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},t.a=m;var r=i(n(457)),o=i(n(6531));function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,o.default)(e,t,n)}function a(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?`rgb${4===n.length?"a":""}(${n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}function l(e){if(e.type)return e;if("#"===e.charAt(0))return l(a(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,r.default)(9,e));let i,o=e.substring(t+1,e.length-1);if("color"===n){if(o=o.split(" "),i=o.shift(),4===o.length&&"/"===o[3].charAt(0)&&(o[3]=o[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(i))throw new Error((0,r.default)(10,i))}else o=o.split(",");return o=o.map((e=>parseFloat(e))),{type:n,values:o,colorSpace:i}}const c=e=>{const t=l(e);return t.values.slice(0,3).map(((e,n)=>-1!==t.type.indexOf("hsl")&&0!==n?`${e}%`:e)).join(" ")};function u(e){const{type:t,colorSpace:n}=e;let{values:i}=e;return-1!==t.indexOf("rgb")?i=i.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(i[1]=`${i[1]}%`,i[2]=`${i[2]}%`),i=-1!==t.indexOf("color")?`${n} ${i.join(" ")}`:`${i.join(", ")}`,`${t}(${i})`}function h(e){e=l(e);const{values:t}=e,n=t[0],i=t[1]/100,r=t[2]/100,o=i*Math.min(r,1-r),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return r-o*Math.max(Math.min(t-3,9-t,1),-1)};let a="rgb";const c=[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4))];return"hsla"===e.type&&(a+="a",c.push(t[3])),u({type:a,values:c})}function d(e){let t="hsl"===(e=l(e)).type||"hsla"===e.type?l(h(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function p(e,t){return e=l(e),t=s(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,u(e)}function f(e,t){if(e=l(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]*=1-t;return u(e)}function m(e,t){if(e=l(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]+=(1-e.values[n])*t;return u(e)}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return d(e)>.5?f(e,t):m(e,t)}},7328:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(5043);const r=function(e,t){var n,r;return i.isValidElement(e)&&-1!==t.indexOf(null!=(n=e.type.muiName)?n:null==(r=e.type)||null==(r=r._payload)||null==(r=r.value)?void 0:r.muiName)}},7486:(e,t,n)=>{n(172),n(8726),n(5227),n(9081),n(7615)},7598:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(7868);function r(e){if("string"!==typeof e)throw new Error((0,i.A)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},7615:e=>{e.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;const t=this.data;t.src&&(this.remove(),e=new THREE.ObjectLoader,t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,(e=>{e.traverse((e=>{e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)})),this.load(e)})))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},7758:(e,t,n)=>{"use strict";n.d(t,{A:()=>N});var i=n(8604),r=n(7162),o=n(3815);const s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.reduce(((e,t)=>(t.filterProps.forEach((n=>{e[n]=t})),e)),{}),r=e=>Object.keys(e).reduce(((t,n)=>i[n]?(0,o.A)(t,i[n](e)):t),{});return r.propTypes={},r.filterProps=t.reduce(((e,t)=>e.concat(t.filterProps)),[]),r};var a=n(9751);function l(e){return"number"!==typeof e?e:`${e}px solid`}function c(e,t){return(0,r.Ay)({prop:e,themeKey:"borders",transform:t})}const u=c("border",l),h=c("borderTop",l),d=c("borderRight",l),p=c("borderBottom",l),f=c("borderLeft",l),m=c("borderColor"),g=c("borderTopColor"),v=c("borderRightColor"),y=c("borderBottomColor"),A=c("borderLeftColor"),x=c("outline",l),b=c("outlineColor"),_=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,i.MA)(e.theme,"shape.borderRadius",4,"borderRadius"),n=e=>({borderRadius:(0,i._W)(t,e)});return(0,a.NI)(e,e.borderRadius,n)}return null};_.propTypes={},_.filterProps=["borderRadius"];s(u,h,d,p,f,m,g,v,y,A,_,x,b);const w=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,i.MA)(e.theme,"spacing",8,"gap"),n=e=>({gap:(0,i._W)(t,e)});return(0,a.NI)(e,e.gap,n)}return null};w.propTypes={},w.filterProps=["gap"];const E=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,i.MA)(e.theme,"spacing",8,"columnGap"),n=e=>({columnGap:(0,i._W)(t,e)});return(0,a.NI)(e,e.columnGap,n)}return null};E.propTypes={},E.filterProps=["columnGap"];const S=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,i.MA)(e.theme,"spacing",8,"rowGap"),n=e=>({rowGap:(0,i._W)(t,e)});return(0,a.NI)(e,e.rowGap,n)}return null};S.propTypes={},S.filterProps=["rowGap"];s(w,E,S,(0,r.Ay)({prop:"gridColumn"}),(0,r.Ay)({prop:"gridRow"}),(0,r.Ay)({prop:"gridAutoFlow"}),(0,r.Ay)({prop:"gridAutoColumns"}),(0,r.Ay)({prop:"gridAutoRows"}),(0,r.Ay)({prop:"gridTemplateColumns"}),(0,r.Ay)({prop:"gridTemplateRows"}),(0,r.Ay)({prop:"gridTemplateAreas"}),(0,r.Ay)({prop:"gridArea"}));function C(e,t){return"grey"===t?t:e}s((0,r.Ay)({prop:"color",themeKey:"palette",transform:C}),(0,r.Ay)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:C}),(0,r.Ay)({prop:"backgroundColor",themeKey:"palette",transform:C}));function M(e){return e<=1&&0!==e?100*e+"%":e}const T=(0,r.Ay)({prop:"width",transform:M}),R=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var n,i;const r=(null==(n=e.theme)||null==(n=n.breakpoints)||null==(n=n.values)?void 0:n[t])||a.zu[t];return r?"px"!==(null==(i=e.theme)||null==(i=i.breakpoints)?void 0:i.unit)?{maxWidth:`${r}${e.theme.breakpoints.unit}`}:{maxWidth:r}:{maxWidth:M(t)}};return(0,a.NI)(e,e.maxWidth,t)}return null};R.filterProps=["maxWidth"];const I=(0,r.Ay)({prop:"minWidth",transform:M}),P=(0,r.Ay)({prop:"height",transform:M}),B=(0,r.Ay)({prop:"maxHeight",transform:M}),L=(0,r.Ay)({prop:"minHeight",transform:M}),N=((0,r.Ay)({prop:"size",cssProperty:"width",transform:M}),(0,r.Ay)({prop:"size",cssProperty:"height",transform:M}),s(T,R,I,P,B,L,(0,r.Ay)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:l},borderTop:{themeKey:"borders",transform:l},borderRight:{themeKey:"borders",transform:l},borderBottom:{themeKey:"borders",transform:l},borderLeft:{themeKey:"borders",transform:l},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:l},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:_},color:{themeKey:"palette",transform:C},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:C},backgroundColor:{themeKey:"palette",transform:C},p:{style:i.Ms},pt:{style:i.Ms},pr:{style:i.Ms},pb:{style:i.Ms},pl:{style:i.Ms},px:{style:i.Ms},py:{style:i.Ms},padding:{style:i.Ms},paddingTop:{style:i.Ms},paddingRight:{style:i.Ms},paddingBottom:{style:i.Ms},paddingLeft:{style:i.Ms},paddingX:{style:i.Ms},paddingY:{style:i.Ms},paddingInline:{style:i.Ms},paddingInlineStart:{style:i.Ms},paddingInlineEnd:{style:i.Ms},paddingBlock:{style:i.Ms},paddingBlockStart:{style:i.Ms},paddingBlockEnd:{style:i.Ms},m:{style:i.Lc},mt:{style:i.Lc},mr:{style:i.Lc},mb:{style:i.Lc},ml:{style:i.Lc},mx:{style:i.Lc},my:{style:i.Lc},margin:{style:i.Lc},marginTop:{style:i.Lc},marginRight:{style:i.Lc},marginBottom:{style:i.Lc},marginLeft:{style:i.Lc},marginX:{style:i.Lc},marginY:{style:i.Lc},marginInline:{style:i.Lc},marginInlineStart:{style:i.Lc},marginInlineEnd:{style:i.Lc},marginBlock:{style:i.Lc},marginBlockStart:{style:i.Lc},marginBlockEnd:{style:i.Lc},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:w},rowGap:{style:S},columnGap:{style:E},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:M},maxWidth:{style:R},minWidth:{transform:M},height:{transform:M},maxHeight:{transform:M},minHeight:{transform:M},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},7868:(e,t,n)=>{"use strict";function i(e){let t="https://mui.com/production-error/?code="+e;for(let n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}n.d(t,{A:()=>i})},7918:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A});var i=n(7598)},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},7998:(e,t,n)=>{"use strict";t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=d(n(9066)),o=d(n(6403)),s=d(n(2647)),a=n(1933),l=d(n(5043)),c=d(n(5173)),u=n(7950),h=n(6493);function d(e){return e&&e.__esModule?e:{default:e}}var p=[];a.transitionEnd&&p.push(a.transitionEnd),a.animationEnd&&p.push(a.animationEnd);c.default.node,h.nameShape.isRequired,c.default.bool,c.default.bool,c.default.bool,c.default.number,c.default.number,c.default.number;var f=function(e){function t(n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,n,i));return r.componentWillAppear=function(e){r.props.appear?r.transition("appear",e,r.props.appearTimeout):e()},r.componentWillEnter=function(e){r.props.enter?r.transition("enter",e,r.props.enterTimeout):e()},r.componentWillLeave=function(e){r.props.leave?r.transition("leave",e,r.props.leaveTimeout):e()},r.classNameAndNodeQueue=[],r.transitionTimeouts=[],r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.timeout&&clearTimeout(this.timeout),this.transitionTimeouts.forEach((function(e){clearTimeout(e)})),this.classNameAndNodeQueue.length=0},t.prototype.transition=function(e,t,n){var i=(0,u.findDOMNode)(this);if(i){var s=this.props.name[e]||this.props.name+"-"+e,l=this.props.name[e+"Active"]||s+"-active",c=null,h=void 0;(0,r.default)(i,s),this.queueClassAndNode(l,i);var d=function(e){e&&e.target!==i||(clearTimeout(c),h&&h(),(0,o.default)(i,s),(0,o.default)(i,l),h&&h(),t&&t())};n?(c=setTimeout(d,n),this.transitionTimeouts.push(c)):a.transitionEnd&&(h=function(e,t){return p.length?p.forEach((function(n){return e.addEventListener(n,t,!1)})):setTimeout(t,0),function(){p.length&&p.forEach((function(n){return e.removeEventListener(n,t,!1)}))}}(i,d))}else t&&t()},t.prototype.queueClassAndNode=function(e,t){var n=this;this.classNameAndNodeQueue.push({className:e,node:t}),this.rafHandle||(this.rafHandle=(0,s.default)((function(){return n.flushClassNameAndNodeQueue()})))},t.prototype.flushClassNameAndNodeQueue=function(){this.unmounted||this.classNameAndNodeQueue.forEach((function(e){e.node.scrollTop,(0,r.default)(e.node,e.className)})),this.classNameAndNodeQueue.length=0,this.rafHandle=null},t.prototype.render=function(){var e=i({},this.props);return delete e.name,delete e.appear,delete e.enter,delete e.leave,delete e.appearTimeout,delete e.enterTimeout,delete e.leaveTimeout,delete e.children,l.default.cloneElement(l.default.Children.only(this.props.children),e)},t}(l.default.Component);f.displayName="CSSTransitionGroupChild",f.propTypes={},t.default=f,e.exports=t.default},8007:(e,t,n)=>{"use strict";n.r(t);var i=n(6601),r=n.n(i);AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;const e=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=e.pitchObject,this.yawObject=e.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(e){this.data.moveJoystickPosition===e.moveJoystickPosition&&this.data.sideMargin===e.sideMargin&&this.data.bottomMargin===e.bottomMargin&&this.data.mode===e.mode||this.removeMoveJoystick(),this.data.lookJoystickPosition===e.lookJoystickPosition&&this.data.sideMargin===e.sideMargin&&this.data.bottomMargin===e.bottomMargin&&this.data.mode===e.mode||this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){const e=this.moveData.force<1?this.moveData.force:1,t=this.moveData.angle.radian,n=Math.cos(t)*e,i=-Math.sin(t)*e;this.dVelocity.set(n,0,i)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(e){if(!this.isRotationActive())return;const t=this.lookData.force<1?this.lookData.force:1,n=this.lookData.angle.radian,i=this.lookVector;i.x=Math.cos(n)*t,i.y=Math.sin(n)*t,i.multiplyScalar(this.data.rotationSensitivity*e/1e3),this.yawObject.rotation.y-=i.x;let r=this.pitchObject.rotation.x+i.y;r=Math.max(-Math.PI/2,Math.min(Math.PI/2,r)),this.pitchObject.rotation.x=r},tick:function(e,t){this.updateRotation(t)},initLeftZone(){const e=document.createElement("div");e.setAttribute("id","joystickLeftZone"),e.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.leftZone=e},initRightZone(){const e=document.createElement("div");e.setAttribute("id","joystickRightZone"),e.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.rightZone=e},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();const e={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=r().create(e),this.moveJoystick.on("move",((e,t)=>{this.moveData=t,this.moving=!0})),this.moveJoystick.on("end",((e,t)=>{this.moving=!1}))},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();const e={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=r().create(e),this.lookJoystick.on("move",((e,t)=>{this.lookData=t,this.rotating=!0})),this.lookJoystick.on("end",((e,t)=>{this.rotating=!1}))},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}})},8052:(e,t,n)=>{"use strict";var i=n(4994);t.Ay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=m,rootShouldForwardProp:i=f,slotShouldForwardProp:l=f}=e,u=e=>(0,c.default)((0,r.default)({},e,{theme:v((0,r.default)({},e,{defaultTheme:n,themeId:t}))}));return u.__mui_systemSx=!0,function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:h,slot:p,skipVariantsResolver:m,skipSx:x,overridesResolver:b=y(g(p))}=c,_=(0,o.default)(c,d),w=void 0!==m?m:p&&"Root"!==p&&"root"!==p||!1,E=x||!1;let S=f;"Root"===p||"root"===p?S=i:p?S=l:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(S=void 0);const C=(0,s.default)(e,(0,r.default)({shouldForwardProp:S,label:undefined},_)),M=e=>"function"===typeof e&&e.__emotion_real!==e||(0,a.isPlainObject)(e)?i=>A(e,(0,r.default)({},i,{theme:v({theme:i.theme,defaultTheme:n,themeId:t})})):e,T=function(i){let o=M(i);for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];const c=a?a.map(M):[];h&&b&&c.push((e=>{const i=v((0,r.default)({},e,{defaultTheme:n,themeId:t}));if(!i.components||!i.components[h]||!i.components[h].styleOverrides)return null;const o=i.components[h].styleOverrides,s={};return Object.entries(o).forEach((t=>{let[n,o]=t;s[n]=A(o,(0,r.default)({},e,{theme:i}))})),b(e,s)})),h&&!w&&c.push((e=>{var i;const o=v((0,r.default)({},e,{defaultTheme:n,themeId:t}));return A({variants:null==o||null==(i=o.components)||null==(i=i[h])?void 0:i.variants},(0,r.default)({},e,{theme:o}))})),E||c.push(u);const d=c.length-a.length;if(Array.isArray(i)&&d>0){const e=new Array(d).fill("");o=[...i,...e],o.raw=[...i.raw,...e]}const p=C(o,...c);return e.muiName&&(p.muiName=e.muiName),p};return C.withConfig&&(T.withConfig=C.withConfig),T}};var r=i(n(4634)),o=i(n(4893)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var i={__proto__:null},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=r?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,n&&n.set(e,i),i}(n(3174)),a=n(9482),l=(i(n(7918)),i(n(3382)),i(n(4989))),c=i(n(3234));const u=["ownerState"],h=["variants"],d=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function f(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const m=(0,l.default)(),g=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function v(e){let{defaultTheme:t,theme:n,themeId:i}=e;return r=n,0===Object.keys(r).length?t:n[i]||n;var r}function y(e){return e?(t,n)=>n[e]:null}function A(e,t){let{ownerState:n}=t,i=(0,o.default)(t,u);const s="function"===typeof e?e((0,r.default)({ownerState:n},i)):e;if(Array.isArray(s))return s.flatMap((e=>A(e,(0,r.default)({ownerState:n},i))));if(s&&"object"===typeof s&&Array.isArray(s.variants)){const{variants:e=[]}=s;let t=(0,o.default)(s,h);return e.forEach((e=>{let o=!0;"function"===typeof e.props?o=e.props((0,r.default)({ownerState:n},i,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&i[t]!==e.props[t]&&(o=!1)})),o&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,r.default)({ownerState:n},i,n)):e.style))})),t}return s}},8080:e=>{e.exports=function e(t,n){var i;t||(t={});if(n)for(i in n)if(n.hasOwnProperty(i)){var r=t.hasOwnProperty(i),o=typeof n[i];!r||typeof t[i]!==o?t[i]=n[i]:"object"===o&&(t[i]=e(t[i],n[i]))}return t}},8101:e=>{e.exports=AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this;const t=this.el.getObject3D("mesh");this.el.sceneEl.object3D;if(!t)return;let n;if(t.traverse((t=>{!t.isMesh||e.nodeName&&t.name!==e.nodeName||(n=t)})),!n)return;const i=n.geometry.clone();n.updateWorldMatrix(!0,!1),i.applyMatrix4(n.matrixWorld),this.system.setNavMeshGeometry(i),this.hasLoadedNavMesh=!0}})},8166:(e,t,n)=>{n(8101),n(1587),n(6817)},8168:(e,t,n)=>{"use strict";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i.apply(null,arguments)}n.d(t,{A:()=>i})},8206:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});n(5043);var i=n(3654);n(579);function r(e){return(0,i.b)(e)}},8244:(e,t,n)=>{n(6808),n(6696),n(1750)},8279:(e,t,n)=>{"use strict";n.d(t,{A:()=>F});var i=n(8168),r=n(8587),o=n(7868),s=n(9172),a=n(7758),l=n(8812),c=n(8280);var u=n(7266);const h={black:"#000",white:"#fff"},d={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},p={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},f={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},m={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},v={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},y={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},A=["mode","contrastThreshold","tonalOffset"],x={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:h.white,default:h.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},b={text:{primary:h.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:h.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function _(e,t,n,i){const r=i.light||i,o=i.dark||1.5*i;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=(0,u.a)(e.main,r):"dark"===t&&(e.dark=(0,u.e$)(e.main,o)))}function w(e){const{mode:t="light",contrastThreshold:n=3,tonalOffset:a=.2}=e,l=(0,r.A)(e,A),c=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:g[200],light:g[50],dark:g[400]}:{main:g[700],light:g[400],dark:g[800]}}(t),w=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:p[200],light:p[50],dark:p[400]}:{main:p[500],light:p[300],dark:p[700]}}(t),E=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:f[500],light:f[300],dark:f[700]}:{main:f[700],light:f[400],dark:f[800]}}(t),S=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:v[400],light:v[300],dark:v[700]}:{main:v[700],light:v[500],dark:v[900]}}(t),C=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:y[400],light:y[300],dark:y[700]}:{main:y[800],light:y[500],dark:y[900]}}(t),M=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:m[400],light:m[300],dark:m[700]}:{main:"#ed6c02",light:m[500],dark:m[900]}}(t);function T(e){return(0,u.eM)(e,b.text.primary)>=n?b.text.primary:x.text.primary}const R=e=>{let{color:t,name:n,mainShade:r=500,lightShade:s=300,darkShade:l=700}=e;if(t=(0,i.A)({},t),!t.main&&t[r]&&(t.main=t[r]),!t.hasOwnProperty("main"))throw new Error((0,o.A)(11,n?` (${n})`:"",r));if("string"!==typeof t.main)throw new Error((0,o.A)(12,n?` (${n})`:"",JSON.stringify(t.main)));return _(t,"light",s,a),_(t,"dark",l,a),t.contrastText||(t.contrastText=T(t.main)),t},I={dark:b,light:x};return(0,s.A)((0,i.A)({common:(0,i.A)({},h),mode:t,primary:R({color:c,name:"primary"}),secondary:R({color:w,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:R({color:E,name:"error"}),warning:R({color:M,name:"warning"}),info:R({color:S,name:"info"}),success:R({color:C,name:"success"}),grey:d,contrastThreshold:n,getContrastText:T,augmentColor:R,tonalOffset:a},I[t]),l)}const E=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];const S={textTransform:"uppercase"},C='"Roboto", "Helvetica", "Arial", sans-serif';function M(e,t){const n="function"===typeof t?t(e):t,{fontFamily:o=C,fontSize:a=14,fontWeightLight:l=300,fontWeightRegular:c=400,fontWeightMedium:u=500,fontWeightBold:h=700,htmlFontSize:d=16,allVariants:p,pxToRem:f}=n,m=(0,r.A)(n,E);const g=a/14,v=f||(e=>e/d*g+"rem"),y=(e,t,n,r,s)=>{return(0,i.A)({fontFamily:o,fontWeight:e,fontSize:v(t),lineHeight:n},o===C?{letterSpacing:(a=r/t,Math.round(1e5*a)/1e5)+"em"}:{},s,p);var a},A={h1:y(l,96,1.167,-1.5),h2:y(l,60,1.2,-.5),h3:y(c,48,1.167,0),h4:y(c,34,1.235,.25),h5:y(c,24,1.334,0),h6:y(u,20,1.6,.15),subtitle1:y(c,16,1.75,.15),subtitle2:y(u,14,1.57,.1),body1:y(c,16,1.5,.15),body2:y(c,14,1.43,.15),button:y(u,14,1.75,.4,S),caption:y(c,12,1.66,.4),overline:y(c,12,2.66,1,S),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,s.A)((0,i.A)({htmlFontSize:d,pxToRem:v,fontFamily:o,fontSize:a,fontWeightLight:l,fontWeightRegular:c,fontWeightMedium:u,fontWeightBold:h},A),m,{clone:!1})}function T(){return[`${arguments.length<=0?void 0:arguments[0]}px ${arguments.length<=1?void 0:arguments[1]}px ${arguments.length<=2?void 0:arguments[2]}px ${arguments.length<=3?void 0:arguments[3]}px rgba(0,0,0,0.2)`,`${arguments.length<=4?void 0:arguments[4]}px ${arguments.length<=5?void 0:arguments[5]}px ${arguments.length<=6?void 0:arguments[6]}px ${arguments.length<=7?void 0:arguments[7]}px rgba(0,0,0,0.14)`,`${arguments.length<=8?void 0:arguments[8]}px ${arguments.length<=9?void 0:arguments[9]}px ${arguments.length<=10?void 0:arguments[10]}px ${arguments.length<=11?void 0:arguments[11]}px rgba(0,0,0,0.12)`].join(",")}const R=["none",T(0,2,1,-1,0,1,1,0,0,1,3,0),T(0,3,1,-2,0,2,2,0,0,1,5,0),T(0,3,3,-2,0,3,4,0,0,1,8,0),T(0,2,4,-1,0,4,5,0,0,1,10,0),T(0,3,5,-1,0,5,8,0,0,1,14,0),T(0,3,5,-1,0,6,10,0,0,1,18,0),T(0,4,5,-2,0,7,10,1,0,2,16,1),T(0,5,5,-3,0,8,10,1,0,3,14,2),T(0,5,6,-3,0,9,12,1,0,3,16,2),T(0,6,6,-3,0,10,14,1,0,4,18,3),T(0,6,7,-4,0,11,15,1,0,4,20,3),T(0,7,8,-4,0,12,17,2,0,5,22,4),T(0,7,8,-4,0,13,19,2,0,5,24,4),T(0,7,9,-4,0,14,21,2,0,5,26,4),T(0,8,9,-5,0,15,22,2,0,6,28,5),T(0,8,10,-5,0,16,24,2,0,6,30,5),T(0,8,11,-5,0,17,26,2,0,6,32,5),T(0,9,11,-5,0,18,28,2,0,7,34,6),T(0,9,12,-6,0,19,29,2,0,7,36,6),T(0,10,13,-6,0,20,31,3,0,8,38,7),T(0,10,13,-6,0,21,33,3,0,8,40,7),T(0,10,14,-6,0,22,35,3,0,8,42,7),T(0,11,14,-7,0,23,36,3,0,9,44,8),T(0,11,15,-7,0,24,38,3,0,9,46,8)],I=["duration","easing","delay"],P={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},B={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function L(e){return`${Math.round(e)}ms`}function N(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function D(e){const t=(0,i.A)({},P,e.easing),n=(0,i.A)({},B,e.duration);return(0,i.A)({getAutoHeightDuration:N,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:o=n.standard,easing:s=t.easeInOut,delay:a=0}=i;(0,r.A)(i,I);return(Array.isArray(e)?e:[e]).map((e=>`${e} ${"string"===typeof o?o:L(o)} ${s} ${"string"===typeof a?a:L(a)}`)).join(",")}},e,{easing:t,duration:n})}const k={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},O=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mixins:t={},palette:n={},transitions:u={},typography:h={}}=e,d=(0,r.A)(e,O);if(e.vars&&void 0===e.generateCssVars)throw new Error((0,o.A)(18));const p=w(n),f=(0,c.A)(e);let m=(0,s.A)(f,{mixins:(g=f.breakpoints,v=t,(0,i.A)({toolbar:{minHeight:56,[g.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[g.up("sm")]:{minHeight:64}}},v)),palette:p,shadows:R.slice(),typography:M(p,h),transitions:D(u),zIndex:(0,i.A)({},k)});var g,v;m=(0,s.A)(m,d);for(var y=arguments.length,A=new Array(y>1?y-1:0),x=1;x<y;x++)A[x-1]=arguments[x];return m=A.reduce(((e,t)=>(0,s.A)(e,t)),m),m.unstable_sxConfig=(0,i.A)({},a.A,null==d?void 0:d.unstable_sxConfig),m.unstable_sx=function(e){return(0,l.A)({sx:e,theme:this})},m}const F=U},8280:(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var i=n(8168),r=n(8587),o=n(9172),s=n(4853);const a={borderRadius:4};var l=n(8604);var c=n(8812),u=n(7758),h=n(9703);const d=["breakpoints","palette","spacing","shape"];const p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:n={},spacing:p,shape:f={}}=e,m=(0,r.A)(e,d),g=(0,s.A)(t),v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;const t=(0,l.LX)({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0===n.length?[1]:n).map((e=>{const n=t(e);return"number"===typeof n?`${n}px`:n})).join(" ")};return n.mui=!0,n}(p);let y=(0,o.A)({breakpoints:g,direction:"ltr",components:{},palette:(0,i.A)({mode:"light"},n),spacing:v,shape:(0,i.A)({},a,f)},m);y.applyStyles=h.A;for(var A=arguments.length,x=new Array(A>1?A-1:0),b=1;b<A;b++)x[b-1]=arguments[b];return y=x.reduce(((e,t)=>(0,o.A)(e,t)),y),y.unstable_sxConfig=(0,i.A)({},u.A,null==m?void 0:m.unstable_sxConfig),y.unstable_sx=function(e){return(0,c.A)({sx:e,theme:this})},y}},8387:(e,t,n)=>{"use strict";function i(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=i(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}n.d(t,{A:()=>r});const r=function(){for(var e,t,n=0,r="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=i(e))&&(r&&(r+=" "),r+=t);return r}},8531:(e,t,n)=>{const i=n(1928);function r(e){let t=i(e);return`\n  var length = bodies.length;\n  if (length === 0) return 0;\n\n  ${t("var d{var} = 0, t{var} = 0;",{indent:2})}\n\n  for (var i = 0; i < length; ++i) {\n    var body = bodies[i];\n    if (body.isPinned) continue;\n\n    if (adaptiveTimeStepWeight && body.springCount) {\n      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);\n    }\n\n    var coeff = timeStep / body.mass;\n\n    ${t("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}\n    ${t("var v{var} = body.velocity.{var};",{indent:4})}\n    var v = Math.sqrt(${t("v{var} * v{var}",{join:" + "})});\n\n    if (v > 1) {\n      // We normalize it so that we move within timeStep range. \n      // for the case when v <= 1 - we let velocity to fade out.\n      ${t("body.velocity.{var} = v{var} / v;",{indent:6})}\n    }\n\n    ${t("d{var} = timeStep * body.velocity.{var};",{indent:4})}\n\n    ${t("body.pos.{var} += d{var};",{indent:4})}\n\n    ${t("t{var} += Math.abs(d{var});",{indent:4})}\n  }\n\n  return (${t("t{var} * t{var}",{join:" + "})})/length;\n`}e.exports=function(e){let t=r(e);return new Function("bodies","timeStep","adaptiveTimeStepWeight",t)},e.exports.generateIntegratorFunctionBody=r},8587:(e,t,n)=>{"use strict";function i(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}n.d(t,{A:()=>i})},8604:(e,t,n)=>{"use strict";n.d(t,{LX:()=>f,MA:()=>p,_W:()=>m,Lc:()=>y,Ms:()=>A});var i=n(9751),r=n(7162),o=n(3815);const s={m:"margin",p:"padding"},a={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},l={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},c=function(e){const t={};return n=>(void 0===t[n]&&(t[n]=e(n)),t[n])}((e=>{if(e.length>2){if(!l[e])return[e];e=l[e]}const[t,n]=e.split(""),i=s[t],r=a[n]||"";return Array.isArray(r)?r.map((e=>i+e)):[i+r]})),u=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],h=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],d=[...u,...h];function p(e,t,n,i){var o;const s=null!=(o=(0,r.Yn)(e,t,!1))?o:n;return"number"===typeof s?e=>"string"===typeof e?e:s*e:Array.isArray(s)?e=>"string"===typeof e?e:s[e]:"function"===typeof s?s:()=>{}}function f(e){return p(e,"spacing",8)}function m(e,t){if("string"===typeof t||null==t)return t;const n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:`-${n}`}function g(e,t,n,r){if(-1===t.indexOf(n))return null;const o=function(e,t){return n=>e.reduce(((e,i)=>(e[i]=m(t,n),e)),{})}(c(n),r),s=e[n];return(0,i.NI)(e,s,o)}function v(e,t){const n=f(e.theme);return Object.keys(e).map((i=>g(e,t,i,n))).reduce(o.A,{})}function y(e){return v(e,u)}function A(e){return v(e,h)}function x(e){return v(e,d)}y.propTypes={},y.filterProps=u,A.propTypes={},A.filterProps=h,x.propTypes={},x.filterProps=d},8610:(e,t,n)=>{"use strict";function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const i={};return Object.keys(e).forEach((r=>{i[r]=e[r].reduce(((e,i)=>{if(i){const r=t(i);""!==r&&e.push(r),n&&n[i]&&e.push(n[i])}return e}),[]).join(" ")})),i}n.d(t,{A:()=>i})},8634:(e,t,n)=>{"use strict";n.d(t,{$EB:()=>o,$Kf:()=>oi,$_I:()=>f,$p8:()=>Gr,A$4:()=>Yt,B69:()=>Ct,BRH:()=>Mr,DXC:()=>_i,EAD:()=>ci,GJx:()=>c,G_z:()=>Zi,HiM:()=>zr,Hit:()=>dr,I46:()=>ri,I9Y:()=>ee,IUQ:()=>be,Ipv:()=>wi,LoY:()=>an,MBL:()=>fr,N1A:()=>yi,Nwf:()=>Kr,O9p:()=>ct,PTz:()=>_e,Pq0:()=>we,Q1f:()=>Vt,RiT:()=>gr,Tap:()=>Tr,V9B:()=>Qt,Y9S:()=>Sr,YJl:()=>qn,Z58:()=>Xn,ZyN:()=>Vr,aHM:()=>_r,cj9:()=>Z,dwI:()=>te,eaF:()=>Sn,er$:()=>I,gPd:()=>xe,ghU:()=>u,hB5:()=>r,kn4:()=>Ze,mrM:()=>ui,nCl:()=>Dr,qUd:()=>Hn,qtW:()=>Jt,r6x:()=>Hr,tXL:()=>Ji,tz3:()=>vr,ubm:()=>Ln,wfO:()=>l,xJ6:()=>$i});const i="164",r=0,o=2,s=100,a="attached",l=303,c=1e3,u=1001,h=1002,d=1003,p=1006,f=1008,m=1009,g=1014,v=1015,y=1020,A=1023,x=1026,b=1027,_=2300,w=2301,E=2302,S=2400,C=2401,M=2402,T=2500,R="",I="srgb",P="srgb-linear",B="display-p3",L="display-p3-linear",N="linear",D="srgb",k="rec709",O="p3",U=7680,F=35044,z=2e3,j=2001;class V{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const G=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let H=1234567;const W=Math.PI/180,Q=180/Math.PI;function q(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(G[255&e]+G[e>>8&255]+G[e>>16&255]+G[e>>24&255]+"-"+G[255&t]+G[t>>8&255]+"-"+G[t>>16&15|64]+G[t>>24&255]+"-"+G[63&n|128]+G[n>>8&255]+"-"+G[n>>16&255]+G[n>>24&255]+G[255&i]+G[i>>8&255]+G[i>>16&255]+G[i>>24&255]).toLowerCase()}function X(e,t,n){return Math.max(t,Math.min(n,e))}function $(e,t){return(e%t+t)%t}function Y(e,t,n){return(1-n)*e+n*t}function K(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function J(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const Z={DEG2RAD:W,RAD2DEG:Q,generateUUID:q,clamp:X,euclideanModulo:$,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Y,damp:function(e,t,n,i){return Y(e,t,1-Math.exp(-n*i))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs($(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(H=e);let t=H+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*W},radToDeg:function(e){return e*Q},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+i)/2),u=s((t+i)/2),h=o((t-i)/2),d=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case"XYX":e.set(a*u,l*h,l*d,a*c);break;case"YZY":e.set(l*d,a*u,l*h,a*c);break;case"ZXZ":e.set(l*h,l*d,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:J,denormalize:K};class ee{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;ee.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(X(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class te{constructor(e,t,n,i,r,o,s,a,l){te.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l)}set(e,t,n,i,r,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],A=i[7],x=i[2],b=i[5],_=i[8];return r[0]=o*f+s*v+a*x,r[3]=o*m+s*y+a*b,r[6]=o*g+s*A+a*_,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*A+u*_,r[2]=h*f+d*v+p*x,r[5]=h*m+d*y+p*b,r[8]=h*g+d*A+p*_,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*r*c+n*s*a+i*r*l-i*o*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*r,d=l*r-o*a,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(s*n-i*o)*f,e[3]=h*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(ne.makeScale(e,t)),this}rotate(e){return this.premultiply(ne.makeRotation(-e)),this}translate(e,t){return this.premultiply(ne.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const ne=new te;function ie(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function re(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const oe={};function se(e){e in oe||(oe[e]=!0,console.warn(e))}const ae=(new te).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),le=(new te).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ce={[P]:{transfer:N,primaries:k,toReference:e=>e,fromReference:e=>e},[I]:{transfer:D,primaries:k,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[L]:{transfer:N,primaries:O,toReference:e=>e.applyMatrix3(le),fromReference:e=>e.applyMatrix3(ae)},[B]:{transfer:D,primaries:O,toReference:e=>e.convertSRGBToLinear().applyMatrix3(le),fromReference:e=>e.applyMatrix3(ae).convertLinearToSRGB()}},ue=new Set([P,L]),he={enabled:!0,_workingColorSpace:P,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!ue.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const i=ce[t].toReference;return(0,ce[n].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return ce[e].primaries},getTransfer:function(e){return e===R?N:ce[e].transfer}};function de(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function pe(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let fe;class me{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===fe&&(fe=re("canvas")),fe.width=e.width,fe.height=e.height;const n=fe.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=fe}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=re("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*de(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*de(t[e]/255)):t[e]=de(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ge=0;class ve{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:ge++}),this.uuid=q(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(ye(i[t].image)):e.push(ye(i[t]))}else e=ye(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function ye(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?me.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Ae=0;class xe extends V{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xe.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xe.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:p,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:f,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:A,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:m,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:xe.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:R;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Ae++}),this.uuid=q(),this.name="",this.source=new ve(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new ee(0,0),this.repeat=new ee(1,1),this.center=new ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new te,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case c:e.x=e.x-Math.floor(e.x);break;case u:e.x=e.x<0?0:1;break;case h:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case c:e.y=e.y-Math.floor(e.y);break;case u:e.y=e.y<0?0:1;break;case h:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}xe.DEFAULT_IMAGE=null,xe.DEFAULT_MAPPING=300,xe.DEFAULT_ANISOTROPY=1;class be{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;be.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+h)/4,A=(u+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=A/n):a>v?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=x/i):v<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=A/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class _e{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[o],h=r[o+1],d=r[o+2],p=r[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,i=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(X(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+i*l-r*a,this._y=i*c+o*a+r*s-n*l,this._z=r*c+o*l+n*a-i*s,this._w=o*c-n*s-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class we{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;we.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Se.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Se.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=2*(o*i-s*n),c=2*(s*t-r*i),u=2*(r*n-o*t);return this.x=t+a*l+o*u-s*c,this.y=n+a*c+s*l-r*u,this.z=i+a*u+r*c-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ee.copy(this).projectOnVector(e),this.sub(Ee)}reflect(e){return this.sub(Ee.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(X(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ee=new we,Se=new _e;class Ce{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new we(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new we(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Te.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Te.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Te.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Te):Te.fromBufferAttribute(i,t),Te.applyMatrix4(e.matrixWorld),this.expandByPoint(Te);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Re.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Re.copy(n.boundingBox)),Re.applyMatrix4(e.matrixWorld),this.union(Re)}const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Te),Te.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ke),Oe.subVectors(this.max,ke),Ie.subVectors(e.a,ke),Pe.subVectors(e.b,ke),Be.subVectors(e.c,ke),Le.subVectors(Pe,Ie),Ne.subVectors(Be,Pe),De.subVectors(Ie,Be);let t=[0,-Le.z,Le.y,0,-Ne.z,Ne.y,0,-De.z,De.y,Le.z,0,-Le.x,Ne.z,0,-Ne.x,De.z,0,-De.x,-Le.y,Le.x,0,-Ne.y,Ne.x,0,-De.y,De.x,0];return!!ze(t,Ie,Pe,Be,Oe)&&(t=[1,0,0,0,1,0,0,0,1],!!ze(t,Ie,Pe,Be,Oe)&&(Ue.crossVectors(Le,Ne),t=[Ue.x,Ue.y,Ue.z],ze(t,Ie,Pe,Be,Oe)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Te).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Te).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Me[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Me[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Me[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Me[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Me[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Me[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Me[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Me[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Me)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Me=[new we,new we,new we,new we,new we,new we,new we,new we],Te=new we,Re=new Ce,Ie=new we,Pe=new we,Be=new we,Le=new we,Ne=new we,De=new we,ke=new we,Oe=new we,Ue=new we,Fe=new we;function ze(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){Fe.fromArray(e,o);const s=r.x*Math.abs(Fe.x)+r.y*Math.abs(Fe.y)+r.z*Math.abs(Fe.z),a=t.dot(Fe),l=n.dot(Fe),c=i.dot(Fe);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const je=new Ce,Ve=new we,Ge=new we;class He{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new we,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):je.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ve.subVectors(e,this.center);const t=Ve.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Ve,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Ge.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ve.copy(e.center).add(Ge)),this.expandByPoint(Ve.copy(e.center).sub(Ge))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const We=new we,Qe=new we,qe=new we,Xe=new we,$e=new we,Ye=new we,Ke=new we;class Je{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new we,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new we(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,We)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=We.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(We.copy(this.origin).addScaledVector(this.direction,t),We.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Qe.copy(e).add(t).multiplyScalar(.5),qe.copy(t).sub(e).normalize(),Xe.copy(this.origin).sub(Qe);const r=.5*e.distanceTo(t),o=-this.direction.dot(qe),s=Xe.dot(this.direction),a=-Xe.dot(qe),l=Xe.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Qe).addScaledVector(qe,h),d}intersectSphere(e,t){We.subVectors(e.center,this.origin);const n=We.dot(this.direction),i=We.dot(We)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>i?null:((s>n||n!==n)&&(n=s),(a<i||i!==i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,We)}intersectTriangle(e,t,n,i,r){$e.subVectors(t,e),Ye.subVectors(n,e),Ke.crossVectors($e,Ye);let o,s=this.direction.dot(Ke);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}Xe.subVectors(this.origin,e);const a=o*this.direction.dot(Ye.crossVectors(Xe,Ye));if(a<0)return null;const l=o*this.direction.dot($e.cross(Xe));if(l<0)return null;if(a+l>s)return null;const c=-o*Xe.dot(Ke);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ze{constructor(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){Ze.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ze).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/et.setFromMatrixColumn(e,0).length(),r=1/et.setFromMatrixColumn(e,1).length(),o=1/et.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-o*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*c,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nt,e,it)}lookAt(e,t,n){const i=this.elements;return st.subVectors(e,t),0===st.lengthSq()&&(st.z=1),st.normalize(),rt.crossVectors(n,st),0===rt.lengthSq()&&(1===Math.abs(n.z)?st.x+=1e-4:st.z+=1e-4,st.normalize(),rt.crossVectors(n,st)),rt.normalize(),ot.crossVectors(st,rt),i[0]=rt.x,i[4]=ot.x,i[8]=st.x,i[1]=rt.y,i[5]=ot.y,i[9]=st.y,i[2]=rt.z,i[6]=ot.z,i[10]=st.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],A=n[11],x=n[15],b=i[0],_=i[4],w=i[8],E=i[12],S=i[1],C=i[5],M=i[9],T=i[13],R=i[2],I=i[6],P=i[10],B=i[14],L=i[3],N=i[7],D=i[11],k=i[15];return r[0]=o*b+s*S+a*R+l*L,r[4]=o*_+s*C+a*I+l*N,r[8]=o*w+s*M+a*P+l*D,r[12]=o*E+s*T+a*B+l*k,r[1]=c*b+u*S+h*R+d*L,r[5]=c*_+u*C+h*I+d*N,r[9]=c*w+u*M+h*P+d*D,r[13]=c*E+u*T+h*B+d*k,r[2]=p*b+f*S+m*R+g*L,r[6]=p*_+f*C+m*I+g*N,r[10]=p*w+f*M+m*P+g*D,r[14]=p*E+f*T+m*B+g*k,r[3]=v*b+y*S+A*R+x*L,r[7]=v*_+y*C+A*I+x*N,r[11]=v*w+y*M+A*P+x*D,r[15]=v*E+y*T+A*B+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*l*u-r*s*h+n*l*h+i*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-i*o*d+i*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+n*o*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*a*u+t*s*h+i*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,A=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*v+n*y+i*A+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/b;return e[0]=v*_,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*_,e[2]=(s*m*r-f*a*r+f*i*l-n*m*l-s*i*g+n*a*g)*_,e[3]=(u*a*r-s*h*r-u*i*l+n*h*l+s*i*d-n*a*d)*_,e[4]=y*_,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*_,e[6]=(p*a*r-o*m*r-p*i*l+t*m*l+o*i*g-t*a*g)*_,e[7]=(o*h*r-c*a*r+c*i*l-t*h*l-o*i*d+t*a*d)*_,e[8]=A*_,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*_,e[10]=(o*f*r-p*s*r+p*n*l-t*f*l-o*n*g+t*s*g)*_,e[11]=(c*s*r-o*u*r-c*n*l+t*u*l+o*n*d-t*s*d)*_,e[12]=x*_,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*_,e[14]=(p*s*i-o*f*i-p*n*a+t*f*a+o*n*m-t*s*m)*_,e[15]=(o*u*i-c*s*i+c*n*a-t*u*a-o*n*h+t*s*h)*_,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,c*s+n,c*a-i*o,0,l*a-i*s,c*a+i*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,v=a*l,y=a*c,A=a*u,x=n.x,b=n.y,_=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+A)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-A)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*_,i[9]=(m-v)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=et.set(i[0],i[1],i[2]).length();const o=et.set(i[4],i[5],i[6]).length(),s=et.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],tt.copy(this);const a=1/r,l=1/o,c=1/s;return tt.elements[0]*=a,tt.elements[1]*=a,tt.elements[2]*=a,tt.elements[4]*=l,tt.elements[5]*=l,tt.elements[6]*=l,tt.elements[8]*=c,tt.elements[9]*=c,tt.elements[10]*=c,t.setFromRotationMatrix(tt),n.x=r,n.y=o,n.z=s,this}makePerspective(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z;const a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(s===z)d=-(o+r)/(o-r),p=-2*o*r/(o-r);else{if(s!==j)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-o/(o-r),p=-o*r/(o-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z;const a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(o-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(s===z)p=(o+r)*u,f=-2*u;else{if(s!==j)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const et=new we,tt=new Ze,nt=new we(0,0,0),it=new we(1,1,1),rt=new we,ot=new we,st=new we,at=new Ze,lt=new _e;class ct{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ct.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=e.elements,r=i[0],o=i[4],s=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(X(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-X(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(X(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-X(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(X(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-X(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return at.makeRotationFromQuaternion(e),this.setFromRotationMatrix(at,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return lt.setFromEuler(this),this.setFromQuaternion(lt,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ct.DEFAULT_ORDER="XYZ";class ut{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let ht=0;const dt=new we,pt=new _e,ft=new Ze,mt=new we,gt=new we,vt=new we,yt=new _e,At=new we(1,0,0),xt=new we(0,1,0),bt=new we(0,0,1),_t={type:"added"},wt={type:"removed"},Et={type:"childadded",child:null},St={type:"childremoved",child:null};class Ct extends V{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ht++}),this.uuid=q(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ct.DEFAULT_UP.clone();const e=new we,t=new ct,n=new _e,i=new we(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ze},normalMatrix:{value:new te}}),this.matrix=new Ze,this.matrixWorld=new Ze,this.matrixAutoUpdate=Ct.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ct.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ut,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return pt.setFromAxisAngle(e,t),this.quaternion.multiply(pt),this}rotateOnWorldAxis(e,t){return pt.setFromAxisAngle(e,t),this.quaternion.premultiply(pt),this}rotateX(e){return this.rotateOnAxis(At,e)}rotateY(e){return this.rotateOnAxis(xt,e)}rotateZ(e){return this.rotateOnAxis(bt,e)}translateOnAxis(e,t){return dt.copy(e).applyQuaternion(this.quaternion),this.position.add(dt.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(At,e)}translateY(e){return this.translateOnAxis(xt,e)}translateZ(e){return this.translateOnAxis(bt,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ft.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?mt.copy(e):mt.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),gt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ft.lookAt(gt,mt,this.up):ft.lookAt(mt,gt,this.up),this.quaternion.setFromRotationMatrix(ft),i&&(ft.extractRotation(i.matrixWorld),pt.setFromRotationMatrix(ft),this.quaternion.premultiply(pt.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_t),Et.child=e,this.dispatchEvent(Et),Et.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(wt),St.child=e,this.dispatchEvent(St),St.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ft.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ft.multiply(e.parent.matrixWorld)),e.applyMatrix4(ft),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_t),Et.child=e,this.dispatchEvent(Et),Et.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gt,e,vt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gt,yt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Ct.DEFAULT_UP=new we(0,1,0),Ct.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ct.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Mt=new we,Tt=new we,Rt=new we,It=new we,Pt=new we,Bt=new we,Lt=new we,Nt=new we,Dt=new we,kt=new we;class Ot{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new we,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new we,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new we;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),Mt.subVectors(e,t),i.cross(Mt);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){Mt.subVectors(i,t),Tt.subVectors(n,t),Rt.subVectors(e,t);const o=Mt.dot(Mt),s=Mt.dot(Tt),a=Mt.dot(Rt),l=Tt.dot(Tt),c=Tt.dot(Rt),u=o*l-s*s;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,It)&&(It.x>=0&&It.y>=0&&It.x+It.y<=1)}static getInterpolation(e,t,n,i,r,o,s,a){return null===this.getBarycoord(e,t,n,i,It)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(r,It.x),a.addScaledVector(o,It.y),a.addScaledVector(s,It.z),a)}static isFrontFacing(e,t,n,i){return Mt.subVectors(n,t),Tt.subVectors(e,t),Mt.cross(Tt).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Mt.subVectors(this.c,this.b),Tt.subVectors(this.a,this.b),.5*Mt.cross(Tt).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ot.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ot.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return Ot.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Ot.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ot.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,s;Pt.subVectors(i,n),Bt.subVectors(r,n),Nt.subVectors(e,n);const a=Pt.dot(Nt),l=Bt.dot(Nt);if(a<=0&&l<=0)return t.copy(n);Dt.subVectors(e,i);const c=Pt.dot(Dt),u=Bt.dot(Dt);if(c>=0&&u<=c)return t.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(Pt,o);kt.subVectors(e,r);const d=Pt.dot(kt),p=Bt.dot(kt);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(Bt,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Lt.subVectors(r,i),s=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(Lt,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(Pt,o).addScaledVector(Bt,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ft={h:0,s:0,l:0},zt={h:0,s:0,l:0};function jt(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Vt{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,he.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:he.workingColorSpace;return this.r=e,this.g=t,this.b=n,he.toWorkingColorSpace(this,i),this}setHSL(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:he.workingColorSpace;if(e=$(e,1),t=X(t,0,1),n=X(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=jt(r,i,e+1/3),this.g=jt(r,i,e),this.b=jt(r,i,e-1/3)}return he.toWorkingColorSpace(this,i),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=t[1],s=t[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=t[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I;const n=Ut[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=de(e.r),this.g=de(e.g),this.b=de(e.b),this}copyLinearToSRGB(e){return this.r=pe(e.r),this.g=pe(e.g),this.b=pe(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return he.fromWorkingColorSpace(Gt.copy(this),e),65536*Math.round(X(255*Gt.r,0,255))+256*Math.round(X(255*Gt.g,0,255))+Math.round(X(255*Gt.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.workingColorSpace;he.fromWorkingColorSpace(Gt.copy(this),t);const n=Gt.r,i=Gt.g,r=Gt.b,o=Math.max(n,i,r),s=Math.min(n,i,r);let a,l;const c=(s+o)/2;if(s===o)a=0,l=0;else{const e=o-s;switch(l=c<=.5?e/(o+s):e/(2-o-s),o){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.workingColorSpace;return he.fromWorkingColorSpace(Gt.copy(this),t),e.r=Gt.r,e.g=Gt.g,e.b=Gt.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;he.fromWorkingColorSpace(Gt.copy(this),e);const t=Gt.r,n=Gt.g,i=Gt.b;return e!==I?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Ft),this.setHSL(Ft.h+e,Ft.s+t,Ft.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ft),e.getHSL(zt);const n=Y(Ft.h,zt.h,t),i=Y(Ft.s,zt.s,t),r=Y(Ft.l,zt.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Gt=new Vt;Vt.NAMES=Ut;let Ht=0;class Wt extends V{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Ht++}),this.uuid=q(),this.name="",this.type="Material",this.blending=1,this.side=r,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=s,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Vt(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=U,this.stencilZFail=U,this.stencilZPass=U,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),this.side!==r&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==s&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==U&&(n.stencilFail=this.stencilFail),this.stencilZFail!==U&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==U&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Qt extends Wt{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ct,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const qt=new we,Xt=new ee;class $t{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=F,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=v,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return se("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Xt.fromBufferAttribute(this,t),Xt.applyMatrix3(e),this.setXY(t,Xt.x,Xt.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)qt.fromBufferAttribute(this,t),qt.applyMatrix3(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)qt.fromBufferAttribute(this,t),qt.applyMatrix4(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)qt.fromBufferAttribute(this,t),qt.applyNormalMatrix(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)qt.fromBufferAttribute(this,t),qt.transformDirection(e),this.setXYZ(t,qt.x,qt.y,qt.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=K(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=J(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=K(t,this.array)),t}setX(e,t){return this.normalized&&(t=J(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=K(t,this.array)),t}setY(e,t){return this.normalized&&(t=J(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=K(t,this.array)),t}setZ(e,t){return this.normalized&&(t=J(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=K(t,this.array)),t}setW(e,t){return this.normalized&&(t=J(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=J(t,this.array),n=J(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=J(t,this.array),n=J(n,this.array),i=J(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=J(t,this.array),n=J(n,this.array),i=J(i,this.array),r=J(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==F&&(e.usage=this.usage),e}}class Yt extends $t{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Kt extends $t{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Jt extends $t{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Zt=0;const en=new Ze,tn=new Ct,nn=new we,rn=new Ce,on=new Ce,sn=new we;class an extends V{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Zt++}),this.uuid=q(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ie(e)?Kt:Yt)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new te).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return en.makeRotationFromQuaternion(e),this.applyMatrix4(en),this}rotateX(e){return en.makeRotationX(e),this.applyMatrix4(en),this}rotateY(e){return en.makeRotationY(e),this.applyMatrix4(en),this}rotateZ(e){return en.makeRotationZ(e),this.applyMatrix4(en),this}translate(e,t,n){return en.makeTranslation(e,t,n),this.applyMatrix4(en),this}scale(e,t,n){return en.makeScale(e,t,n),this.applyMatrix4(en),this}lookAt(e){return tn.lookAt(e),tn.updateMatrix(),this.applyMatrix4(tn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(nn).negate(),this.translate(nn.x,nn.y,nn.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Jt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ce);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new we(-1/0,-1/0,-1/0),new we(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];rn.setFromBufferAttribute(e),this.morphTargetsRelative?(sn.addVectors(this.boundingBox.min,rn.min),this.boundingBox.expandByPoint(sn),sn.addVectors(this.boundingBox.max,rn.max),this.boundingBox.expandByPoint(sn)):(this.boundingBox.expandByPoint(rn.min),this.boundingBox.expandByPoint(rn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new He);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new we,1/0);if(e){const n=this.boundingSphere.center;if(rn.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];on.setFromBufferAttribute(n),this.morphTargetsRelative?(sn.addVectors(rn.min,on.min),rn.expandByPoint(sn),sn.addVectors(rn.max,on.max),rn.expandByPoint(sn)):(rn.expandByPoint(on.min),rn.expandByPoint(on.max))}rn.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)sn.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(sn));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)sn.fromBufferAttribute(o,t),s&&(nn.fromBufferAttribute(e,t),sn.add(nn)),i=Math.max(i,n.distanceToSquared(sn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new $t(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),s=[],a=[];for(let w=0;w<n.count;w++)s[w]=new we,a[w]=new we;const l=new we,c=new we,u=new we,h=new ee,d=new ee,p=new ee,f=new we,m=new we;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const o=1/(d.x*p.y-p.x*d.y);isFinite(o)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(o),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(o),s[e].add(f),s[t].add(f),s[i].add(f),a[e].add(m),a[t].add(m),a[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let w=0,E=v.length;w<E;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const y=new we,A=new we,x=new we,b=new we;function _(e){x.fromBufferAttribute(i,e),b.copy(x);const t=s[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),A.crossVectors(b,t);const n=A.dot(a[e])<0?-1:1;o.setXYZW(e,y.x,y.y,y.z,n)}for(let w=0,E=v.length;w<E;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)_(e.getX(i+0)),_(e.getX(i+1)),_(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new $t(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new we,r=new we,o=new we,s=new we,a=new we,l=new we,c=new we,u=new we;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)sn.fromBufferAttribute(e,t),sn.normalize(),e.setXYZ(t,sn.x,sn.y,sn.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new $t(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new an,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const e=o[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,c=o.length;l<c;l++){const e=o[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ln=new Ze,cn=new Je,un=new He,hn=new we,dn=new we,pn=new we,fn=new we,mn=new we,gn=new we,vn=new ee,yn=new ee,An=new ee,xn=new we,bn=new we,_n=new we,wn=new we,En=new we;class Sn extends Ct{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new an,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qt;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){gn.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],a=r[n];0!==i&&(mn.fromBufferAttribute(a,e),o?gn.addScaledVector(mn,i):gn.addScaledVector(mn.sub(t),i))}t.add(gn)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),un.copy(n.boundingSphere),un.applyMatrix4(r),cn.copy(e.ray).recast(e.near),!1===un.containsPoint(cn.origin)){if(null===cn.intersectSphere(un,hn))return;if(cn.origin.distanceToSquared(hn)>(e.far-e.near)**2)return}ln.copy(r).invert(),cn.copy(e.ray).applyMatrix4(ln),null!==n.boundingBox&&!1===cn.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,cn)}}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,s=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==s)if(Array.isArray(o))for(let p=0,f=h.length;p<f;p++){const r=h[p],a=o[r.materialIndex];for(let o=Math.max(r.start,d.start),h=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));o<h;o+=3){i=Cn(this,a,e,n,l,c,u,s.getX(o),s.getX(o+1),s.getX(o+2)),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(s.count,d.start+d.count);r<a;r+=3){i=Cn(this,o,e,n,l,c,u,s.getX(r),s.getX(r+1),s.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==a)if(Array.isArray(o))for(let p=0,f=h.length;p<f;p++){const r=h[p],s=o[r.materialIndex];for(let o=Math.max(r.start,d.start),h=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));o<h;o+=3){i=Cn(this,s,e,n,l,c,u,o,o+1,o+2),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),s=Math.min(a.count,d.start+d.count);r<s;r+=3){i=Cn(this,o,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function Cn(e,t,n,i,o,s,a,l,c,u){e.getVertexPosition(l,dn),e.getVertexPosition(c,pn),e.getVertexPosition(u,fn);const h=function(e,t,n,i,o,s,a,l){let c;if(c=1===t.side?i.intersectTriangle(a,s,o,!0,l):i.intersectTriangle(o,s,a,t.side===r,l),null===c)return null;En.copy(l),En.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(En);return u<n.near||u>n.far?null:{distance:u,point:En.clone(),object:e}}(e,t,n,i,dn,pn,fn,wn);if(h){o&&(vn.fromBufferAttribute(o,l),yn.fromBufferAttribute(o,c),An.fromBufferAttribute(o,u),h.uv=Ot.getInterpolation(wn,dn,pn,fn,vn,yn,An,new ee)),s&&(vn.fromBufferAttribute(s,l),yn.fromBufferAttribute(s,c),An.fromBufferAttribute(s,u),h.uv1=Ot.getInterpolation(wn,dn,pn,fn,vn,yn,An,new ee)),a&&(xn.fromBufferAttribute(a,l),bn.fromBufferAttribute(a,c),_n.fromBufferAttribute(a,u),h.normal=Ot.getInterpolation(wn,dn,pn,fn,xn,bn,_n,new we),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const e={a:l,b:c,c:u,normal:new we,materialIndex:0};Ot.getNormal(dn,pn,fn,e.normal),h.face=e}return h}function Mn(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Tn(e){const t={};for(let n=0;n<e.length;n++){const i=Mn(e[n]);for(const e in i)t[e]=i[e]}return t}class Rn extends Ct{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ze,this.projectionMatrix=new Ze,this.projectionMatrixInverse=new Ze,this.coordinateSystem=z}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const In=new we,Pn=new ee,Bn=new ee;class Ln extends Rn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Q*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*W*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Q*Math.atan(Math.tan(.5*W*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){In.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(In.x,In.y).multiplyScalar(-e/In.z),In.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(In.x,In.y).multiplyScalar(-e/In.z)}getViewSize(e,t){return this.getViewBounds(e,Pn,Bn),t.subVectors(Bn,Pn)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*W*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Nn=new we,Dn=new we,kn=new te;class On{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new we(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Nn.subVectors(n,t).cross(Dn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Nn),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||kn.getNormalMatrix(e),i=this.coplanarPoint(Nn).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Un=new He,Fn=new we;class zn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new On,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new On,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new On,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new On,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new On,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new On;this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z;const n=this.planes,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],A=i[15];if(n[0].setComponents(a-r,h-l,m-d,A-g).normalize(),n[1].setComponents(a+r,h+l,m+d,A+g).normalize(),n[2].setComponents(a+o,h+c,m+p,A+v).normalize(),n[3].setComponents(a-o,h-c,m-p,A-v).normalize(),n[4].setComponents(a-s,h-u,m-f,A-y).normalize(),t===z)n[5].setComponents(a+s,h+u,m+f,A+y).normalize();else{if(t!==j)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Un.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Un.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Un)}intersectsSprite(e){return Un.center.set(0,0,0),Un.radius=.7071067811865476,Un.applyMatrix4(e.matrixWorld),this.intersectsSphere(Un)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Fn.x=i.normal.x>0?e.max.x:e.min.x,Fn.y=i.normal.y>0?e.max.y:e.min.y,Fn.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Fn)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const jn={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Vn={common:{diffuse:{value:new Vt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new te},alphaMap:{value:null},alphaMapTransform:{value:new te},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new te}},envmap:{envMap:{value:null},envMapRotation:{value:new te},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new te}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new te}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new te},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new te},normalScale:{value:new ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new te},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new te}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new te}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new te}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Vt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Vt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new te},alphaTest:{value:0},uvTransform:{value:new te}},sprite:{diffuse:{value:new Vt(16777215)},opacity:{value:1},center:{value:new ee(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new te},alphaMap:{value:null},alphaMapTransform:{value:new te},alphaTest:{value:0}}},Gn={basic:{uniforms:Tn([Vn.common,Vn.specularmap,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.fog]),vertexShader:jn.meshbasic_vert,fragmentShader:jn.meshbasic_frag},lambert:{uniforms:Tn([Vn.common,Vn.specularmap,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.fog,Vn.lights,{emissive:{value:new Vt(0)}}]),vertexShader:jn.meshlambert_vert,fragmentShader:jn.meshlambert_frag},phong:{uniforms:Tn([Vn.common,Vn.specularmap,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.fog,Vn.lights,{emissive:{value:new Vt(0)},specular:{value:new Vt(1118481)},shininess:{value:30}}]),vertexShader:jn.meshphong_vert,fragmentShader:jn.meshphong_frag},standard:{uniforms:Tn([Vn.common,Vn.envmap,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.roughnessmap,Vn.metalnessmap,Vn.fog,Vn.lights,{emissive:{value:new Vt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jn.meshphysical_vert,fragmentShader:jn.meshphysical_frag},toon:{uniforms:Tn([Vn.common,Vn.aomap,Vn.lightmap,Vn.emissivemap,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.gradientmap,Vn.fog,Vn.lights,{emissive:{value:new Vt(0)}}]),vertexShader:jn.meshtoon_vert,fragmentShader:jn.meshtoon_frag},matcap:{uniforms:Tn([Vn.common,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,Vn.fog,{matcap:{value:null}}]),vertexShader:jn.meshmatcap_vert,fragmentShader:jn.meshmatcap_frag},points:{uniforms:Tn([Vn.points,Vn.fog]),vertexShader:jn.points_vert,fragmentShader:jn.points_frag},dashed:{uniforms:Tn([Vn.common,Vn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jn.linedashed_vert,fragmentShader:jn.linedashed_frag},depth:{uniforms:Tn([Vn.common,Vn.displacementmap]),vertexShader:jn.depth_vert,fragmentShader:jn.depth_frag},normal:{uniforms:Tn([Vn.common,Vn.bumpmap,Vn.normalmap,Vn.displacementmap,{opacity:{value:1}}]),vertexShader:jn.meshnormal_vert,fragmentShader:jn.meshnormal_frag},sprite:{uniforms:Tn([Vn.sprite,Vn.fog]),vertexShader:jn.sprite_vert,fragmentShader:jn.sprite_frag},background:{uniforms:{uvTransform:{value:new te},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:jn.background_vert,fragmentShader:jn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new te}},vertexShader:jn.backgroundCube_vert,fragmentShader:jn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:jn.cube_vert,fragmentShader:jn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jn.equirect_vert,fragmentShader:jn.equirect_frag},distanceRGBA:{uniforms:Tn([Vn.common,Vn.displacementmap,{referencePosition:{value:new we},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jn.distanceRGBA_vert,fragmentShader:jn.distanceRGBA_frag},shadow:{uniforms:Tn([Vn.lights,Vn.fog,{color:{value:new Vt(0)},opacity:{value:1}}]),vertexShader:jn.shadow_vert,fragmentShader:jn.shadow_frag}};Gn.physical={uniforms:Tn([Gn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new te},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new te},clearcoatNormalScale:{value:new ee(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new te},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new te},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new te},sheen:{value:0},sheenColor:{value:new Vt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new te},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new te},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new te},transmissionSamplerSize:{value:new ee},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new te},attenuationDistance:{value:0},attenuationColor:{value:new Vt(0)},specularColor:{value:new Vt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new te},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new te},anisotropyVector:{value:new ee},anisotropyMap:{value:null},anisotropyMapTransform:{value:new te}}]),vertexShader:jn.meshphysical_vert,fragmentShader:jn.meshphysical_frag};class Hn extends Rn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Math.sqrt(5);class Wn extends xe{constructor(e,t,n,i,r,o,s,a,l,c){if((c=void 0!==c?c:x)!==x&&c!==b)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===x&&(n=g),void 0===n&&c===b&&(n=y),super(null,i,r,o,s,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:d,this.minFilter=void 0!==a?a:d,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const Qn=new Wn(1,1);Qn.compareFunction=515;new Float32Array(16),new Float32Array(9),new Float32Array(4);new Map;class qn extends Ct{constructor(){super(),this.isGroup=!0,this.type="Group"}}class Xn extends Ct{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ct,this.environmentIntensity=1,this.environmentRotation=new ct,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const $n=new we,Yn=new be,Kn=new be,Jn=new we,Zn=new Ze,ei=new we,ti=new He,ni=new Ze,ii=new Je;class ri extends Sn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=a,this.bindMatrix=new Ze,this.bindMatrixInverse=new Ze,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Ce),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,ei),this.boundingBox.expandByPoint(ei)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new He),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,ei),this.boundingSphere.expandByPoint(ei)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),ti.copy(this.boundingSphere),ti.applyMatrix4(i),!1!==e.ray.intersectsSphere(ti)&&(ni.copy(i).invert(),ii.copy(e.ray).applyMatrix4(ni),null!==this.boundingBox&&!1===ii.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,ii)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new be,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===a?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;Yn.fromBufferAttribute(i.attributes.skinIndex,e),Kn.fromBufferAttribute(i.attributes.skinWeight,e),$n.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=Kn.getComponent(r);if(0!==e){const i=Yn.getComponent(r);Zn.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Jn.copy($n).applyMatrix4(Zn),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class oi extends Ct{constructor(){super(),this.isBone=!0,this.type="Bone"}}class si extends xe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:d,arguments.length>9&&void 0!==arguments[9]?arguments[9]:d,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ai=new Ze,li=new Ze;class ci{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=q(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ze)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ze;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:li;ai.multiplyMatrices(i,t[r]),ai.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new ci(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new si(t,e,e,A,v);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new oi),this.bones.push(r),this.boneInverses.push((new Ze).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class ui extends Wt{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Vt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const hi=new we,di=new we,pi=new Ze,fi=new Je,mi=new He,gi=new we,vi=new we;class yi extends Ct{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new an,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ui;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)hi.fromBufferAttribute(t,e-1),di.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=hi.distanceTo(di);e.setAttribute("lineDistance",new Jt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),mi.copy(n.boundingSphere),mi.applyMatrix4(i),mi.radius+=r,!1===e.ray.intersectsSphere(mi))return;pi.copy(i).invert(),fi.copy(e.ray).applyMatrix4(pi);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,o.start),i=Math.min(c.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=c.getX(r),i=c.getX(r+1),o=Ai(this,e,fi,a,n,i);o&&t.push(o)}if(this.isLineLoop){const r=c.getX(i-1),o=c.getX(n),s=Ai(this,e,fi,a,r,o);s&&t.push(s)}}else{const n=Math.max(0,o.start),i=Math.min(u.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=Ai(this,e,fi,a,r,r+1);n&&t.push(n)}if(this.isLineLoop){const r=Ai(this,e,fi,a,i-1,n);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Ai(e,t,n,i,r,o){const s=e.geometry.attributes.position;hi.fromBufferAttribute(s,r),di.fromBufferAttribute(s,o);if(n.distanceSqToSegment(hi,di,gi,vi)>i)return;gi.applyMatrix4(e.matrixWorld);const a=t.ray.origin.distanceTo(gi);return a<t.near||a>t.far?void 0:{distance:a,point:vi.clone().applyMatrix4(e.matrixWorld),index:r,face:null,faceIndex:null,object:e}}const xi=new we,bi=new we;class _i extends yi{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)xi.fromBufferAttribute(t,e),bi.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+xi.distanceTo(bi);e.setAttribute("lineDistance",new Jt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class wi{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let s,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),s=n[i]-o,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const c=n[i];return(i+(o-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new ee:new we);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new we,i=[],r=[],o=[],s=new we,a=new Ze;for(let d=0;d<=e;d++){const t=d/e;i[d]=this.getTangentAt(t,new we)}r[0]=new we,o[0]=new we;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),s.crossVectors(i[d-1],i[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(X(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(s,e))}o[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(X(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}const Ei=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=Si(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(i&&(o=function(e,t,n,i){const r=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*i,l=o<s-1?t[o+1]*i:e.length,c=Si(e,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(ki(c));for(r.sort(Bi),o=0;o<r.length;o++)n=Li(r[o],n);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return Mi(o,s,n,a,l,p,0),s};function Si(e,t,n,i,r){let o,s;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)s=Qi(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=Qi(o,e[o],e[o+1],s);return s&&zi(s,s.next)&&(qi(s),s=s.next),s}function Ci(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!zi(i,i.next)&&0!==Fi(i.prev,i,i.next))i=i.next;else{if(qi(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function Mi(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Di(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Ri(e,i,r,o):Ti(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),qi(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Mi(e=Ii(Ci(e),t,n),t,n,i,r,o,2):2===s&&Pi(e,t,n,i,r,o):Mi(Ci(e),t,n,i,r,o,1);break}}function Ti(e){const t=e.prev,n=e,i=e.next;if(Fi(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Oi(r,a,o,l,s,c,f.x,f.y)&&Fi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ri(e,t,n,i){const r=e.prev,o=e,s=e.next;if(Fi(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=Di(p,f,t,n,i),y=Di(m,g,t,n,i);let A=e.prevZ,x=e.nextZ;for(;A&&A.z>=v&&x&&x.z<=y;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==s&&Oi(a,u,l,h,c,d,A.x,A.y)&&Fi(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Oi(a,u,l,h,c,d,x.x,x.y)&&Fi(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;A&&A.z>=v;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==s&&Oi(a,u,l,h,c,d,A.x,A.y)&&Fi(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Oi(a,u,l,h,c,d,x.x,x.y)&&Fi(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Ii(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!zi(r,o)&&ji(r,i,i.next,o)&&Hi(r,o)&&Hi(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),qi(i),qi(i.next),i=e=o),i=i.next}while(i!==e);return Ci(i)}function Pi(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Ui(s,e)){let a=Wi(s,e);return s=Ci(s,s.next),a=Ci(a,a.next),Mi(s,t,n,i,r,o,0),void Mi(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function Bi(e,t){return e.x-t.x}function Li(e,t){const n=function(e,t){let n,i=t,r=-1/0;const o=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=o&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===o))return n}i=i.next}while(i!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,h=1/0;i=n;do{o>=i.x&&i.x>=l&&o!==i.x&&Oi(s<c?o:r,s,l,c,s<c?r:o,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(o-i.x),Hi(i,e)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&Ni(n,i)))&&(n=i,h=u)),i=i.next}while(i!==a);return n}(e,t);if(!n)return t;const i=Wi(n,e);return Ci(i,i.next),Ci(n,n.next)}function Ni(e,t){return Fi(e.prev,e,t.prev)<0&&Fi(t.next,e,e.next)<0}function Di(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ki(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Oi(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Ui(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ji(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Hi(e,t)&&Hi(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Fi(e.prev,e,t.prev)||Fi(e,t.prev,t))||zi(e,t)&&Fi(e.prev,e,e.next)>0&&Fi(t.prev,t,t.next)>0)}function Fi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function zi(e,t){return e.x===t.x&&e.y===t.y}function ji(e,t,n,i){const r=Gi(Fi(e,t,n)),o=Gi(Fi(e,t,i)),s=Gi(Fi(n,i,e)),a=Gi(Fi(n,i,t));return r!==o&&s!==a||(!(0!==r||!Vi(e,n,t))||(!(0!==o||!Vi(e,i,t))||(!(0!==s||!Vi(n,e,i))||!(0!==a||!Vi(n,t,i)))))}function Vi(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Gi(e){return e>0?1:e<0?-1:0}function Hi(e,t){return Fi(e.prev,e,e.next)<0?Fi(e,t,e.next)>=0&&Fi(e,e.prev,t)>=0:Fi(e,t,e.prev)<0||Fi(e,e.next,t)<0}function Wi(e,t){const n=new Xi(e.i,e.x,e.y),i=new Xi(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Qi(e,t,n,i){const r=new Xi(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function qi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Xi(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class $i{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return $i.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Yi(e),Ki(n,e);let o=e.length;t.forEach(Yi);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,Ki(n,t[a]);const s=Ei(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}}function Yi(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ki(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Ji extends Wt{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Vt(16777215),this.specular=new Vt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ct,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Zi extends Wt{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ct,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function er(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function tr(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nr(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function ir(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r}function rr(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)}class or{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class sr extends or{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:S,endingEnd:S}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case C:r=e,s=2*t-n;break;case M:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case C:o=e,a=2*n-t;break;case M:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,A=d*m-d*f;for(let x=0;x!==s;++x)r[x]=g*o[c+x]+v*o[l+x]+y*o[a+x]+A*o[u+x];return r}}class ar extends or{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(i-t),u=1-c;for(let h=0;h!==s;++h)r[h]=o[l+h]*u+o[a+h]*c;return r}}class lr extends or{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class cr{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=er(t,this.TimeBufferType),this.values=er(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:er(e.times,Array),values:er(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new lr(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ar(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new sr(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case _:t=this.InterpolantFactoryMethodDiscrete;break;case w:t=this.InterpolantFactoryMethodLinear;break;case E:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return _;case this.InterpolantFactoryMethodLinear:return w;case this.InterpolantFactoryMethodSmooth:return E}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=n.slice(r,o),this.values=this.values.slice(r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==o&&o>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,o),e=!1;break}o=t}if(void 0!==i&&tr(i))for(let s=0,a=i.length;s!==a;++s){const t=i[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===E,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}cr.prototype.TimeBufferType=Float32Array,cr.prototype.ValueBufferType=Float32Array,cr.prototype.DefaultInterpolation=w;class ur extends cr{}ur.prototype.ValueTypeName="bool",ur.prototype.ValueBufferType=Array,ur.prototype.DefaultInterpolation=_,ur.prototype.InterpolantFactoryMethodLinear=void 0,ur.prototype.InterpolantFactoryMethodSmooth=void 0;class hr extends cr{}hr.prototype.ValueTypeName="color";class dr extends cr{}dr.prototype.ValueTypeName="number";class pr extends or{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let c=l+s;l!==c;l+=4)_e.slerpFlat(r,0,o,l-s,o,l,a);return r}}class fr extends cr{InterpolantFactoryMethodLinear(e){return new pr(this.times,this.values,this.getValueSize(),e)}}fr.prototype.ValueTypeName="quaternion",fr.prototype.DefaultInterpolation=w,fr.prototype.InterpolantFactoryMethodSmooth=void 0;class mr extends cr{}mr.prototype.ValueTypeName="string",mr.prototype.ValueBufferType=Array,mr.prototype.DefaultInterpolation=_,mr.prototype.InterpolantFactoryMethodLinear=void 0,mr.prototype.InterpolantFactoryMethodSmooth=void 0;class gr extends cr{}gr.prototype.ValueTypeName="vector";class vr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=q(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,s=n.length;o!==s;++o)t.push(yr(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(cr.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const l=nr(e);e=ir(e,1,l),a=ir(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new dr(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(this.CreateFromMorphTargetSequence(s,i[s],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];rr(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new dr(".morphTargetInfluence["+r+"]",t,o))}a=t.length*o}else{const r=".bones["+t[c].name+"]";n(gr,r+".position",e,"pos",i),n(fr,r+".quaternion",e,"rot",i),n(gr,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function yr(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dr;case"vector":case"vector2":case"vector3":case"vector4":return gr;case"color":return hr;case"quaternion":return fr;case"bool":case"boolean":return ur;case"string":return mr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];rr(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Ar={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class xr{constructor(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const br=new xr;class _r{constructor(e){this.manager=void 0!==e?e:br,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}_r.DEFAULT_MATERIAL_NAME="__DEFAULT";const wr={};class Er extends Error{constructor(e,t){super(e),this.response=t}}class Sr extends _r{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Ar.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==wr[e])return void wr[e].push({onLoad:t,onProgress:n,onError:i});wr[e]=[],wr[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=wr[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),o=r?parseInt(r):0,s=0!==o;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then((i=>{let{done:r,value:l}=i;if(r)e.close();else{a+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new Er(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{Ar.add(e,t);const n=wr[e];delete wr[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=wr[e];if(void 0===n)throw this.manager.itemError(e),t;delete wr[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Cr extends _r{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Ar.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const s=re("img");function a(){c(),Ar.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class Mr extends _r{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new si,s=new Sr(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(e,(function(e){let n;try{n=r.parse(e)}catch(s){if(void 0===i)return void console.error(s);i(s)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:u,o.wrapT=void 0!==n.wrapT?n.wrapT:u,o.magFilter=void 0!==n.magFilter?n.magFilter:p,o.minFilter=void 0!==n.minFilter?n.minFilter:p,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(o.colorSpace=n.colorSpace),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=f),1===n.mipmapCount&&(o.minFilter=p),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n)}),n,i),o}}class Tr extends _r{constructor(e){super(e)}load(e,t,n,i){const r=new xe,o=new Cr(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class Rr extends Ct{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Vt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const Ir=new Ze,Pr=new we,Br=new we;class Lr{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ee(512,512),this.map=null,this.mapPass=null,this.matrix=new Ze,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new zn,this._frameExtents=new ee(1,1),this._viewportCount=1,this._viewports=[new be(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Pr.setFromMatrixPosition(e.matrixWorld),t.position.copy(Pr),Br.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Br),t.updateMatrixWorld(),Ir.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ir),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Ir)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Nr extends Lr{constructor(){super(new Ln(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*Q*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Dr extends Rr{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ct.DEFAULT_UP),this.updateMatrix(),this.target=new Ct,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Nr}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const kr=new Ze,Or=new we,Ur=new we;class Fr extends Lr{constructor(){super(new Ln(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ee(4,2),this._viewportCount=6,this._viewports=[new be(2,1,1,1),new be(0,1,1,1),new be(3,1,1,1),new be(1,1,1,1),new be(3,0,1,1),new be(1,0,1,1)],this._cubeDirections=[new we(1,0,0),new we(-1,0,0),new we(0,0,1),new we(0,0,-1),new we(0,1,0),new we(0,-1,0)],this._cubeUps=[new we(0,1,0),new we(0,1,0),new we(0,1,0),new we(0,1,0),new we(0,0,1),new we(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Or.setFromMatrixPosition(e.matrixWorld),n.position.copy(Or),Ur.copy(n.position),Ur.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Ur),n.updateMatrixWorld(),i.makeTranslation(-Or.x,-Or.y,-Or.z),kr.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kr)}}class zr extends Rr{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Fr}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class jr extends Lr{constructor(){super(new Hn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Vr extends Rr{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ct.DEFAULT_UP),this.updateMatrix(),this.target=new Ct,this.shadow=new jr}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Gr extends Rr{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Hr{static decodeText(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}const Wr="\\[\\]\\.:\\/",Qr=new RegExp("["+Wr+"]","g"),qr="[^"+Wr+"]",Xr="[^"+Wr.replace("\\.","")+"]",$r=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",qr)+/(WCOD+)?/.source.replace("WCOD",Xr)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qr)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qr)+"$"),Yr=["material","materials","bones","map"];class Kr{constructor(e,t,n){this.path=t,this.parsedPath=n||Kr.parseTrackName(t),this.node=Kr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Kr.Composite(e,t,n):new Kr(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Qr,"")}static parseTrackName(e){const t=$r.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Yr.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Kr.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Kr.Composite=class{constructor(e,t,n){const i=n||Kr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Kr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Kr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Kr.prototype.GetterByBindingType=[Kr.prototype._getValue_direct,Kr.prototype._getValue_array,Kr.prototype._getValue_arrayElement,Kr.prototype._getValue_toArray],Kr.prototype.SetterByBindingTypeAndVersioning=[[Kr.prototype._setValue_direct,Kr.prototype._setValue_direct_setNeedsUpdate,Kr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kr.prototype._setValue_array,Kr.prototype._setValue_array_setNeedsUpdate,Kr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kr.prototype._setValue_arrayElement,Kr.prototype._setValue_arrayElement_setNeedsUpdate,Kr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kr.prototype._setValue_fromArray,Kr.prototype._setValue_fromArray_setNeedsUpdate,Kr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},8649:e=>{e.exports=AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse((e=>{e.isMesh&&(e.material=this.material)}))}})},8698:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var i=n(8168),r=n(8587),o=n(9172),s=n(7758);const a=["sx"],l=e=>{var t,n;const i={systemProps:{},otherProps:{}},r=null!=(t=null==e||null==(n=e.theme)?void 0:n.unstable_sxConfig)?t:s.A;return Object.keys(e).forEach((t=>{r[t]?i.systemProps[t]=e[t]:i.otherProps[t]=e[t]})),i};function c(e){const{sx:t}=e,n=(0,r.A)(e,a),{systemProps:s,otherProps:c}=l(n);let u;return u=Array.isArray(t)?[s,...t]:"function"===typeof t?function(){const e=t(...arguments);return(0,o.Q)(e)?(0,i.A)({},s,e):s}:(0,i.A)({},s,t),(0,i.A)({},c,{sx:u})}},8726:(e,t,n)=>{"use strict";var i=n(8634);class r extends i.BRH{constructor(e){super(e)}parse(e){const t=0,n=1,r=2,o=3,s=9,a=10,l=11,c=48,u=4,h=0,d=1,p=2,f=3;if(e.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let m=0;const g=new Uint8Array(e),v={id_length:g[m++],colormap_type:g[m++],image_type:g[m++],colormap_index:g[m++]|g[m++]<<8,colormap_length:g[m++]|g[m++]<<8,colormap_size:g[m++],origin:[g[m++]|g[m++]<<8,g[m++]|g[m++]<<8],width:g[m++]|g[m++]<<8,height:g[m++]|g[m++]<<8,pixel_size:g[m++],flags:g[m++]};if(function(e){switch(e.image_type){case n:case s:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case r:case o:case a:case l:if(e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(v),v.id_length+m>e.length)throw new Error("THREE.TGALoader: No data.");m+=v.id_length;let y=!1,A=!1,x=!1;switch(v.image_type){case s:y=!0,A=!0;break;case n:A=!0;break;case a:y=!0;break;case r:break;case l:y=!0,x=!0;break;case o:x=!0}const b=new Uint8Array(v.width*v.height*4),_=function(e,t,n,i,r){let o,s;const a=n.pixel_size>>3,l=n.width*n.height*a;if(t&&(s=r.subarray(i,i+=n.colormap_length*(n.colormap_size>>3))),e){let e,t,n;o=new Uint8Array(l);let s=0;const c=new Uint8Array(a);for(;s<l;)if(e=r[i++],t=1+(127&e),128&e){for(n=0;n<a;++n)c[n]=r[i++];for(n=0;n<t;++n)o.set(c,s+n*a);s+=a*t}else{for(t*=a,n=0;n<t;++n)o[s+n]=r[i++];s+=t}}else o=r.subarray(i,i+=t?n.width*n.height:l);return{pixel_data:o,palettes:s}}(y,A,v,m,g);return function(e,t,n,i,r){let o,s,a,l,m,g;switch((v.flags&c)>>u){default:case p:o=0,a=1,m=t,s=0,l=1,g=n;break;case h:o=0,a=1,m=t,s=n-1,l=-1,g=-1;break;case f:o=t-1,a=-1,m=-1,s=0,l=1,g=n;break;case d:o=t-1,a=-1,m=-1,s=n-1,l=-1,g=-1}if(x)switch(v.pixel_size){case 8:!function(e,t,n,i,r,o,s,a){let l,c,u,h=0;const d=v.width;for(u=t;u!==i;u+=n)for(c=r;c!==s;c+=o,h++)l=a[h],e[4*(c+d*u)+0]=l,e[4*(c+d*u)+1]=l,e[4*(c+d*u)+2]=l,e[4*(c+d*u)+3]=255}(e,s,l,g,o,a,m,i);break;case 16:!function(e,t,n,i,r,o,s,a){let l,c,u=0;const h=v.width;for(c=t;c!==i;c+=n)for(l=r;l!==s;l+=o,u+=2)e[4*(l+h*c)+0]=a[u+0],e[4*(l+h*c)+1]=a[u+0],e[4*(l+h*c)+2]=a[u+0],e[4*(l+h*c)+3]=a[u+1]}(e,s,l,g,o,a,m,i);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,n,i,r,o,s,a,l){const c=l;let u,h,d,p=0;const f=v.width;for(d=t;d!==i;d+=n)for(h=r;h!==s;h+=o,p++)u=a[p],e[4*(h+f*d)+3]=255,e[4*(h+f*d)+2]=c[3*u+0],e[4*(h+f*d)+1]=c[3*u+1],e[4*(h+f*d)+0]=c[3*u+2]}(e,s,l,g,o,a,m,i,r);break;case 16:!function(e,t,n,i,r,o,s,a){let l,c,u,h=0;const d=v.width;for(u=t;u!==i;u+=n)for(c=r;c!==s;c+=o,h+=2)l=a[h+0]+(a[h+1]<<8),e[4*(c+d*u)+0]=(31744&l)>>7,e[4*(c+d*u)+1]=(992&l)>>2,e[4*(c+d*u)+2]=(31&l)<<3,e[4*(c+d*u)+3]=32768&l?0:255}(e,s,l,g,o,a,m,i);break;case 24:!function(e,t,n,i,r,o,s,a){let l,c,u=0;const h=v.width;for(c=t;c!==i;c+=n)for(l=r;l!==s;l+=o,u+=3)e[4*(l+h*c)+3]=255,e[4*(l+h*c)+2]=a[u+0],e[4*(l+h*c)+1]=a[u+1],e[4*(l+h*c)+0]=a[u+2]}(e,s,l,g,o,a,m,i);break;case 32:!function(e,t,n,i,r,o,s,a){let l,c,u=0;const h=v.width;for(c=t;c!==i;c+=n)for(l=r;l!==s;l+=o,u+=4)e[4*(l+h*c)+2]=a[u+0],e[4*(l+h*c)+1]=a[u+1],e[4*(l+h*c)+0]=a[u+2],e[4*(l+h*c)+3]=a[u+3]}(e,s,l,g,o,a,m,i);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(b,v.width,v.height,_.pixel_data,_.palettes),{data:b,width:v.width,height:v.height,flipY:!0,generateMipmaps:!0,minFilter:i.$_I}}}class o extends i.aHM{load(e,t,n,r){const o=this,s=""===o.path?i.r6x.extractUrlBase(e):o.path,a=new i.Y9S(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,(function(n){try{t(o.parse(n,s))}catch(i){r?r(i):console.error(i),o.manager.itemError(e)}}),n,r)}parse(e,t){function n(e,t){const n=[],i=e.childNodes;for(let r=0,o=i.length;r<o;r++){const e=i[r];e.nodeName===t&&n.push(e)}return n}function o(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i];return n}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=parseFloat(t[i]);return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=parseInt(t[i]);return n}function l(e){return e.substring(1)}function c(e){return 0===Object.keys(e).length}function u(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function d(e,t,i,r){const o=n(e,t)[0];if(void 0!==o){const e=n(o,i);for(let t=0;t<e.length;t++)r(e[t])}}function p(e,t){for(const n in e){e[n].build=t(e[n])}}function f(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function m(e){const t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){const e=l(i.getAttribute("source")),n=i.getAttribute("semantic");t.inputs[n]=e}}return t}function g(e){const t={};let n=e.getAttribute("target").split("/");const i=n.shift();let r=n.shift();const o=-1!==r.indexOf("("),s=-1!==r.indexOf(".");if(s)n=r.split("."),r=n.shift(),t.member=n.shift();else if(o){const e=r.split("(");r=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=i,t.sid=r,t.arraySyntax=o,t.memberSyntax=s,t.sampler=l(e.getAttribute("source")),t}function v(e){const t=[],n=e.channels,i=e.samplers,r=e.sources;for(const o in n)if(n.hasOwnProperty(o)){const e=n[o],s=i[e.sampler],a=s.inputs.INPUT,l=s.inputs.OUTPUT;w(A(e,r[a],r[l]),t)}return t}function y(e){return f(Je.animations[e],v)}function A(e,t,n){const i=Je.nodes[e.id],r=Ue(i.id),o=i.transforms[e.sid],s=i.matrix.clone().transpose();let a,l,c,u,h,d;const p={};switch(o){case"matrix":for(c=0,u=t.array.length;c<u;c++)if(a=t.array[c],l=c*n.stride,void 0===p[a]&&(p[a]={}),!0===e.arraySyntax){const t=n.array[l],i=e.indices[0]+4*e.indices[1];p[a][i]=t}else for(h=0,d=n.stride;h<d;h++)p[a][h]=n.array[l+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',o)}const f=function(e,t){const n=[];for(const r in e)n.push({time:parseFloat(r),value:e[r]});n.sort(i);for(let r=0;r<16;r++)E(n,r,t.elements[r]);return n;function i(e,t){return e.time-t.time}}(p,s);return{name:r.uuid,keyframes:f}}const x=new i.Pq0,b=new i.Pq0,_=new i.PTz;function w(e,t){const n=e.keyframes,r=e.name,o=[],s=[],a=[],l=[];for(let i=0,c=n.length;i<c;i++){const e=n[i],t=e.time,r=e.value;Me.fromArray(r).transpose(),Me.decompose(x,_,b),o.push(t),s.push(x.x,x.y,x.z),a.push(_.x,_.y,_.z,_.w),l.push(b.x,b.y,b.z)}return s.length>0&&t.push(new i.RiT(r+".position",o,s)),a.length>0&&t.push(new i.MBL(r+".quaternion",o,a)),l.length>0&&t.push(new i.RiT(r+".scale",o,l)),t}function E(e,t,n){let i,r,o,s=!0;for(r=0,o=e.length;r<o;r++)i=e[r],void 0===i.value[t]?i.value[t]=null:s=!1;if(!0===s)for(r=0,o=e.length;r<o;r++)i=e[r],i.value[t]=n;else!function(e,t){let n,i;for(let r=0,o=e.length;r<o;r++){const o=e[r];if(null===o.value[t]){if(n=S(e,r,t),i=C(e,r,t),null===n){o.value[t]=i.value[t];continue}if(null===i){o.value[t]=n.value[t];continue}M(o,n,i,t)}}}(e,t)}function S(e,t,n){for(;t>=0;){const i=e[t];if(null!==i.value[n])return i;t--}return null}function C(e,t,n){for(;t<e.length;){const i=e[t];if(null!==i.value[n])return i;t++}return null}function M(e,t,n,i){n.time-t.time!==0?e.value[i]=(e.time-t.time)*(n.value[i]-t.value[i])/(n.time-t.time)+t.value[i]:e.value[i]=t.value[i]}function T(e){const t=[],n=e.name,r=e.end-e.start||-1,o=e.animations;for(let i=0,s=o.length;i<s;i++){const e=y(o[i]);for(let n=0,i=e.length;n<i;n++)t.push(e[n])}return new i.tz3(n,r,t)}function R(e){return f(Je.clips[e],T)}function I(e){const t={sources:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=s(i.textContent);break;case"source":const e=i.getAttribute("id");t.sources[e]=ae(i);break;case"joints":t.joints=P(i);break;case"vertex_weights":t.vertexWeights=B(i)}}return t}function P(e){const t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){const e=i.getAttribute("semantic"),n=l(i.getAttribute("source"));t.inputs[e]=n}}return t}function B(e){const t={inputs:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":const e=i.getAttribute("semantic"),n=l(i.getAttribute("source")),r=parseInt(i.getAttribute("offset"));t.inputs[e]={id:n,offset:r};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function L(e){const t={id:e.id},n=Je.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t=4,n={joints:[],indices:{array:[],stride:t},weights:{array:[],stride:t}},r=e.sources,o=e.vertexWeights,s=o.vcount,a=o.v,l=o.inputs.JOINT.offset,c=o.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],h=e.sources[e.joints.inputs.INV_BIND_MATRIX],d=r[o.inputs.WEIGHT.id].array;let p,f,m,g=0;for(p=0,m=s.length;p<m;p++){const e=s[p],i=[];for(f=0;f<e;f++){const e=a[g+l],t=d[a[g+c]];i.push({index:e,weight:t}),g+=2}for(i.sort(v),f=0;f<t;f++){const e=i[f];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}e.bindShapeMatrix?n.bindMatrix=(new i.kn4).fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=(new i.kn4).identity();for(p=0,m=u.array.length;p<m;p++){const e=u.array[p],t=(new i.kn4).fromArray(h.array,p*h.stride).transpose();n.joints.push({name:e,boneInverse:t})}return n;function v(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function N(e){return void 0!==e.build?e.build:e.init_from}function D(e){const t=Je.images[e];return void 0!==t?f(t,N):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function k(e){const t={surfaces:{},samplers:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":O(i,t);break;case"technique":t.technique=z(i);break;case"extra":t.extra=Q(i)}}return t}function O(e,t){const n=e.getAttribute("sid");for(let i=0,r=e.childNodes.length;i<r;i++){const r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"surface":t.surfaces[n]=U(r);break;case"sampler2D":t.samplers[n]=F(r)}}}function U(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"init_from"===i.nodeName)t.init_from=i.textContent}return t}function F(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"source"===i.nodeName)t.source=i.textContent}return t}function z(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=j(i);break;case"extra":t.extra=Q(i)}}return t}function j(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=V(i);break;case"transparent":t[i.nodeName]={opaque:i.hasAttribute("opaque")?i.getAttribute("opaque"):"A_ONE",data:V(i)}}}return t}function V(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=s(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:G(i)}}}return t}function G(e){const t={technique:{}};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"extra"===i.nodeName)H(i,t)}return t}function H(e,t){for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"technique"===i.nodeName)W(i,t)}}function W(e,t){for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=X(i)}}}function Q(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"technique"===i.nodeName)t.technique=q(i)}return t}function q(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=X(i)}}return t}function X(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"texture"===i.nodeName)t[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:G(i)}}return t}function $(e){return e}function Y(e){const t=(n=e.url,f(Je.effects[n],$));var n;const r=t.profile.technique;let o;switch(r.type){case"phong":case"blinn":o=new i.tXL;break;case"lambert":o=new i.G_z;break;default:o=new i.V9B}function s(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=t.profile.samplers[e.id];let o=null;if(void 0!==r){o=D(t.profile.surfaces[r.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),o=D(e.id);if(null!==o){const t=function(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));n=n.toLowerCase(),t="tga"===n?qe:Qe;return t}(o);if(void 0!==t){const r=t.load(o),s=e.extra;if(void 0!==s&&void 0!==s.technique&&!1===c(s.technique)){const e=s.technique;r.wrapS=e.wrapU?i.GJx:i.ghU,r.wrapT=e.wrapV?i.GJx:i.ghU,r.offset.set(e.offsetU||0,e.offsetV||0),r.repeat.set(e.repeatU||1,e.repeatV||1)}else r.wrapS=i.GJx,r.wrapT=i.GJx;return null!==n&&(r.colorSpace=n),r}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",o),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}o.name=e.name||"";const a=r.parameters;for(const c in a){const e=a[c];switch(c){case"diffuse":e.color&&o.color.fromArray(e.color),e.texture&&(o.map=s(e.texture,i.er$));break;case"specular":e.color&&o.specular&&o.specular.fromArray(e.color),e.texture&&(o.specularMap=s(e.texture));break;case"bump":e.texture&&(o.normalMap=s(e.texture));break;case"ambient":e.texture&&(o.lightMap=s(e.texture,i.er$));break;case"shininess":e.float&&o.shininess&&(o.shininess=e.float);break;case"emission":e.color&&o.emissive&&o.emissive.fromArray(e.color),e.texture&&(o.emissiveMap=s(e.texture,i.er$))}}o.color.convertSRGBToLinear(),o.specular&&o.specular.convertSRGBToLinear(),o.emissive&&o.emissive.convertSRGBToLinear();let l=a.transparent,u=a.transparency;if(void 0===u&&l&&(u={float:1}),void 0===l&&u&&(l={opaque:"A_ONE",data:{color:[1,1,1,1]}}),l&&u)if(l.data.texture)o.transparent=!0;else{const e=l.data.color;switch(l.opaque){case"A_ONE":o.opacity=e[3]*u.float;break;case"RGB_ZERO":o.opacity=1-e[0]*u.float;break;case"A_ZERO":o.opacity=1-e[3]*u.float;break;case"RGB_ONE":o.opacity=e[0]*u.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',l.opaque)}o.opacity<1&&(o.transparent=!0)}if(void 0!==r.extra&&void 0!==r.extra.technique){const e=r.extra.technique;for(const t in e){const n=e[t];switch(t){case"double_sided":o.side=1===n?i.$EB:i.hB5;break;case"bump":o.normalMap=s(n.texture),o.normalScale=new i.I9Y(1,1)}}}return o}function K(e){return f(Je.materials[e],Y)}function J(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return Z(n)}return{}}function Z(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];switch(i.nodeName){case"perspective":case"orthographic":t.technique=i.nodeName,t.parameters=ee(i)}}return t}function ee(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];switch(i.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[i.nodeName]=parseFloat(i.textContent)}}return t}function te(e){let t;switch(e.optics.technique){case"perspective":t=new i.ubm(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,r=e.optics.parameters.xmag;const o=e.optics.parameters.aspect_ratio;r=void 0===r?n*o:r,n=void 0===n?r/o:n,r*=.5,n*=.5,t=new i.qUd(-r,r,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new i.ubm}return t.name=e.name||"",t}function ne(e){const t=Je.cameras[e];return void 0!==t?f(t,te):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ie(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=re(i)}}return t}function re(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":const e=s(r.textContent);t.color=(new i.Q1f).fromArray(e).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(r.textContent);break;case"quadratic_attenuation":const n=parseFloat(r.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function oe(e){let t;switch(e.technique){case"directional":t=new i.ZyN;break;case"point":t=new i.HiM;break;case"spot":t=new i.nCl;break;case"ambient":t=new i.$p8}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function se(e){const t=Je.lights[e];return void 0!==t?f(t,oe):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){const t={array:[],stride:3};for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"float_array":t.array=s(r.textContent);break;case"Name_array":t.array=o(r.textContent);break;case"technique_common":const e=n(r,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function le(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];1===i.nodeType&&(t[i.getAttribute("semantic")]=l(i.getAttribute("source")))}return t}function ce(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":const e=l(i.getAttribute("source")),n=i.getAttribute("semantic"),r=parseInt(i.getAttribute("offset")),o=parseInt(i.getAttribute("set")),s=o>0?n+o:n;t.inputs[s]={id:e,offset:r},t.stride=Math.max(t.stride,r+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function ue(e){let t=0;for(let n=0,i=e.length;n<i;n++){!0===e[n].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function he(e){const t={},n=e.sources,i=e.vertices,r=e.primitives;if(0===r.length)return{};const o=function(e){const t={};for(let n=0;n<e.length;n++){const i=e[n];void 0===t[i.type]&&(t[i.type]=[]),t[i.type].push(i)}return t}(r);for(const s in o){const e=o[s];ue(e),t[s]=de(e,n,i)}return t}function de(e,t,n){const r={},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},u=[],h=4,d=[],p=4,f=new i.LoY,m=[];let g=0;for(let i=0;i<e.length;i++){const r=e[i],h=r.inputs;let p=0;switch(r.type){case"lines":case"linestrips":p=2*r.count;break;case"triangles":p=3*r.count;break;case"polylist":for(let e=0;e<r.count;e++){const t=r.vcount[e];switch(t){case 3:p+=3;break;case 4:p+=6;break;default:p+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",r.type)}f.addGroup(g,p,i),g+=p,r.material&&m.push(r.material);for(const i in h){const p=h[i];switch(i){case"VERTEX":for(const i in n){const h=n[i];switch(i){case"POSITION":const n=o.array.length;if(pe(r,t[h],p.offset,o.array),o.stride=t[h].stride,t.skinWeights&&t.skinIndices&&(pe(r,t.skinIndices,p.offset,u),pe(r,t.skinWeights,p.offset,d)),!1===r.hasUV&&!0===e.uvsNeedsFix){const e=(o.array.length-n)/o.stride;for(let t=0;t<e;t++)a.array.push(0,0)}break;case"NORMAL":pe(r,t[h],p.offset,s.array),s.stride=t[h].stride;break;case"COLOR":pe(r,t[h],p.offset,c.array),c.stride=t[h].stride;break;case"TEXCOORD":pe(r,t[h],p.offset,a.array),a.stride=t[h].stride;break;case"TEXCOORD1":pe(r,t[h],p.offset,l.array),a.stride=t[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',i)}}break;case"NORMAL":pe(r,t[p.id],p.offset,s.array),s.stride=t[p.id].stride;break;case"COLOR":pe(r,t[p.id],p.offset,c.array,!0),c.stride=t[p.id].stride;break;case"TEXCOORD":pe(r,t[p.id],p.offset,a.array),a.stride=t[p.id].stride;break;case"TEXCOORD1":pe(r,t[p.id],p.offset,l.array),l.stride=t[p.id].stride}}}return o.array.length>0&&f.setAttribute("position",new i.qtW(o.array,o.stride)),s.array.length>0&&f.setAttribute("normal",new i.qtW(s.array,s.stride)),c.array.length>0&&f.setAttribute("color",new i.qtW(c.array,c.stride)),a.array.length>0&&f.setAttribute("uv",new i.qtW(a.array,a.stride)),l.array.length>0&&f.setAttribute("uv1",new i.qtW(l.array,l.stride)),u.length>0&&f.setAttribute("skinIndex",new i.qtW(u,h)),d.length>0&&f.setAttribute("skinWeight",new i.qtW(d,p)),r.data=f,r.type=e[0].type,r.materialKeys=m,r}function pe(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=e.p,s=e.stride,a=e.vcount;function l(e){let t=o[e+n]*u;const s=t+u;for(;t<s;t++)i.push(c[t]);if(r){const e=i.length-u-1;Xe.setRGB(i[e+0],i[e+1],i[e+2]).convertSRGBToLinear(),i[e+0]=Xe.r,i[e+1]=Xe.g,i[e+2]=Xe.b}}const c=t.array,u=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=a.length;t<n;t++){const n=a[t];if(4===n){const t=e+1*s,n=e+2*s,i=e+3*s;l(e+0*s),l(t),l(i),l(t),l(n),l(i)}else if(3===n){const t=e+1*s,n=e+2*s;l(e+0*s),l(t),l(n)}else if(n>4)for(let t=1,i=n-2;t<=i;t++){const n=e+s*t,i=e+s*(t+1);l(e+0*s),l(n),l(i)}e+=s*n}}else for(let h=0,d=o.length;h<d;h+=s)l(h)}function fe(e){return f(Je.geometries[e],he)}function me(e){return void 0!==e.build?e.build:e}function ge(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"joint":t.joints[i.getAttribute("sid")]=ve(i);break;case"link":t.links.push(Ae(i))}}}function ve(e){let t;for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"prismatic":case"revolute":t=ye(i)}}return t}function ye(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new i.Pq0,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"axis":const e=s(i.textContent);t.axis.fromArray(e);break;case"limits":const n=i.getElementsByTagName("max")[0],r=i.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(r.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function Ae(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"attachment_full":t.attachments.push(xe(i));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(i))}}return t}function xe(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"link":t.links.push(Ae(i));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(i))}}return t}function be(e){const t={type:e.nodeName},n=s(e.textContent);switch(t.type){case"matrix":t.obj=new i.kn4,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new i.Pq0,t.obj.fromArray(n);break;case"rotate":t.obj=new i.Pq0,t.obj.fromArray(n),t.angle=i.cj9.degToRad(n[3])}return t}function _e(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType&&"technique_common"===i.nodeName)we(i,t)}}function we(e,t){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"inertia":t.inertia=s(i.textContent);break;case"mass":t.mass=s(i.textContent)[0]}}}function Ee(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType&&"axis"===i.nodeName){const e=i.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substring(0,n.length-1)}}return t}function Se(e){return void 0!==e.build?e.build:e}function Ce(e){const t=[],n=Ve.querySelector('[id="'+e.id+'"]');for(let r=0;r<n.childNodes.length;r++){const e=n.childNodes[r];if(1!==e.nodeType)continue;let o,a;switch(e.nodeName){case"matrix":o=s(e.textContent);const n=(new i.kn4).fromArray(o).transpose();t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:n});break;case"translate":case"scale":o=s(e.textContent),a=(new i.Pq0).fromArray(o),t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:a});break;case"rotate":o=s(e.textContent),a=(new i.Pq0).fromArray(o);const r=i.cj9.degToRad(o[3]);t.push({sid:e.getAttribute("sid"),type:e.nodeName,obj:a,angle:r})}}return t}const Me=new i.kn4,Te=new i.Pq0;function Re(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new i.kn4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1!==r.nodeType)continue;let o;switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),Re(r);break;case"instance_camera":t.instanceCameras.push(l(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ie(r));break;case"instance_light":t.instanceLights.push(l(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ie(r));break;case"instance_node":t.instanceNodes.push(l(r.getAttribute("url")));break;case"matrix":o=s(r.textContent),t.matrix.multiply(Me.fromArray(o).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=s(r.textContent),Te.fromArray(o),t.matrix.multiply(Me.makeTranslation(Te.x,Te.y,Te.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=s(r.textContent);const e=i.cj9.degToRad(o[3]);t.matrix.multiply(Me.makeRotationAxis(Te.fromArray(o),e)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=s(r.textContent),t.matrix.scale(Te.fromArray(o)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Oe(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Je.nodes[t.id]=t,t}function Ie(e){const t={id:l(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];switch(i.nodeName){case"bind_material":const e=i.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const i=e[n],r=i.getAttribute("symbol"),o=i.getAttribute("target");t.materials[r]=l(o)}break;case"skeleton":t.skeletons.push(l(i.textContent))}}return t}function Pe(e,t){const n=[],r=[];let o,s,a;for(o=0;o<e.length;o++){const i=e[o];let r;if(Oe(i))r=Ue(i),Be(r,t,n);else if(l=i,void 0!==Je.visualScenes[l]){const e=Je.visualScenes[i].children;for(let i=0;i<e.length;i++){const r=e[i];if("JOINT"===r.type){Be(Ue(r.id),t,n)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",i)}var l;for(o=0;o<t.length;o++)for(s=0;s<n.length;s++)if(a=n[s],a.bone.name===t[o].name){r[o]=a,a.processed=!0;break}for(o=0;o<n.length;o++)a=n[o],!1===a.processed&&(r.push(a),a.processed=!0);const c=[],u=[];for(o=0;o<r.length;o++)a=r[o],c.push(a.bone),u.push(a.boneInverse);return new i.EAD(c,u)}function Be(e,t,n){e.traverse((function(e){if(!0===e.isBone){let r;for(let n=0;n<t.length;n++){const i=t[n];if(i.name===e.name){r=i.boneInverse;break}}void 0===r&&(r=new i.kn4),n.push({bone:e,boneInverse:r,processed:!1})}}))}function Le(e){const t=[],n=e.matrix,r=e.nodes,o=e.type,s=e.instanceCameras,a=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes;for(let i=0,p=r.length;i<p;i++)t.push(Ue(r[i]));for(let i=0,p=s.length;i<p;i++){const e=ne(s[i]);null!==e&&t.push(e.clone())}for(let i=0,p=a.length;i<p;i++){const e=a[i],n=(h=e.id,f(Je.controllers[h],L)),r=ke(fe(n.id),e.materials),o=Pe(e.skeletons,n.skin.joints);for(let i=0,s=r.length;i<s;i++){const e=r[i];e.isSkinnedMesh&&(e.bind(o,n.skin.bindMatrix),e.normalizeSkinWeights()),t.push(e)}}var h;for(let i=0,p=l.length;i<p;i++){const e=se(l[i]);null!==e&&t.push(e.clone())}for(let i=0,p=c.length;i<p;i++){const e=c[i],n=ke(fe(e.id),e.materials);for(let i=0,r=n.length;i<r;i++)t.push(n[i])}for(let i=0,p=u.length;i<p;i++)t.push(Ue(u[i]).clone());let d;if(0===r.length&&1===t.length)d=t[0];else{d="JOINT"===o?new i.$Kf:new i.YJl;for(let e=0;e<t.length;e++)d.add(t[e])}return d.name="JOINT"===o?e.sid:e.name,d.matrix.copy(n),d.matrix.decompose(d.position,d.quaternion,d.scale),d}const Ne=new i.V9B({name:i.aHM.DEFAULT_MATERIAL_NAME,color:16711935});function De(e,t){const n=[];for(let i=0,r=e.length;i<r;i++){const r=t[e[i]];void 0===r?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[i]),n.push(Ne)):n.push(K(r))}return n}function ke(e,t){const n=[];for(const r in e){const o=e[r],s=De(o.materialKeys,t);if(0===s.length&&("lines"===r||"linestrips"===r?s.push(new i.mrM):s.push(new i.tXL)),"lines"===r||"linestrips"===r)for(let e=0,t=s.length;e<t;e++){const t=s[e];if(!0===t.isMeshPhongMaterial||!0===t.isMeshLambertMaterial){const n=new i.mrM;n.color.copy(t.color),n.opacity=t.opacity,n.transparent=t.transparent,s[e]=n}}const a=void 0!==o.data.attributes.skinIndex,l=1===s.length?s[0]:s;let c;switch(r){case"lines":c=new i.DXC(o.data,l);break;case"linestrips":c=new i.N1A(o.data,l);break;case"triangles":case"polylist":c=a?new i.I46(o.data,l):new i.eaF(o.data,l)}n.push(c)}return n}function Oe(e){return void 0!==Je.nodes[e]}function Ue(e){return f(Je.nodes[e],Le)}function Fe(e){const t=new i.YJl;t.name=e.name;const n=e.children;for(let i=0;i<n.length;i++){const e=n[i];t.add(Ue(e.id))}return t}function ze(e){return f(Je.visualScenes[e],Fe)}if(0===e.length)return{scene:new i.Z58};const je=(new DOMParser).parseFromString(e,"application/xml"),Ve=n(je,"COLLADA")[0],Ge=je.getElementsByTagName("parsererror")[0];if(void 0!==Ge){const e=n(Ge,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(Ge),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const He=Ve.getAttribute("version");console.debug("THREE.ColladaLoader: File version",He);const We=function(e){return{unit:u(n(e,"unit")[0]),upAxis:h(n(e,"up_axis")[0])}}(n(Ve,"asset")[0]),Qe=new i.Tap(this.manager);let qe;Qe.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),r&&(qe=new r(this.manager),qe.setPath(this.resourcePath||t));const Xe=new i.Q1f,$e=[];let Ye={},Ke=0;const Je={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};d(Ve,"library_animations","animation",(function e(t){const n={sources:{},samplers:{},channels:{}};let r=!1;for(let i=0,o=t.childNodes.length;i<o;i++){const o=t.childNodes[i];if(1!==o.nodeType)continue;let s;switch(o.nodeName){case"source":s=o.getAttribute("id"),n.sources[s]=ae(o);break;case"sampler":s=o.getAttribute("id"),n.samplers[s]=m(o);break;case"channel":s=o.getAttribute("target"),n.channels[s]=g(o);break;case"animation":e(o),r=!0;break;default:console.log(o)}}!1===r&&(Je.animations[t.getAttribute("id")||i.cj9.generateUUID()]=n)})),d(Ve,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"instance_animation"===i.nodeName)t.animations.push(l(i.getAttribute("url")))}Je.clips[e.getAttribute("id")]=t})),d(Ve,"library_controllers","controller",(function(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=l(i.getAttribute("source")),t.skin=I(i);break;case"morph":t.id=l(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Je.controllers[e.getAttribute("id")]=t})),d(Ve,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Je.images[e.getAttribute("id")]=t})),d(Ve,"library_effects","effect",(function(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"profile_COMMON"===i.nodeName)t.profile=k(i)}Je.effects[e.getAttribute("id")]=t})),d(Ve,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"instance_effect"===i.nodeName)t.url=l(i.getAttribute("url"))}Je.materials[e.getAttribute("id")]=t})),d(Ve,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"optics"===i.nodeName)t.optics=J(i)}Je.cameras[e.getAttribute("id")]=t})),d(Ve,"library_lights","light",(function(e){let t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType&&"technique_common"===i.nodeName)t=ie(i)}Je.lights[e.getAttribute("id")]=t})),d(Ve,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=n(e,"mesh")[0];if(void 0!==i){for(let e=0;e<i.childNodes.length;e++){const n=i.childNodes[e];if(1!==n.nodeType)continue;const r=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[r]=ae(n);break;case"vertices":t.vertices=le(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ce(n));break;default:console.log(n)}}Je.geometries[e.getAttribute("id")]=t}})),d(Ve,"library_nodes","node",Re),d(Ve,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let n=0;n<t.length;n++){const e=t[n];!1===e.hasAttribute("id")&&e.setAttribute("id","three_default_"+Ke++)}}(e);const i=n(e,"node");for(let n=0;n<i.length;n++)t.children.push(Re(i[n]));Je.visualScenes[e.getAttribute("id")]=t})),d(Ve,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType&&"technique_common"===i.nodeName)ge(i,t)}Je.kinematicsModels[e.getAttribute("id")]=t})),d(Ve,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType&&"rigid_body"===i.nodeName)t.rigidBodies[i.getAttribute("name")]={},_e(i,t.rigidBodies[i.getAttribute("name")])}Je.physicsModels[e.getAttribute("id")]=t})),d(Ve,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1===i.nodeType&&"bind_joint_axis"===i.nodeName)t.bindJointAxis.push(Ee(i))}Je.kinematicsScenes[l(e.getAttribute("url"))]=t})),p(Je.animations,v),p(Je.clips,T),p(Je.controllers,L),p(Je.images,N),p(Je.effects,$),p(Je.materials,Y),p(Je.cameras,te),p(Je.lights,oe),p(Je.geometries,he),p(Je.visualScenes,Fe),function(){const e=Je.clips;if(!0===c(e)){if(!1===c(Je.animations)){const e=[];for(const t in Je.animations){const n=y(t);for(let t=0,i=n.length;t<i;t++)e.push(n[t])}$e.push(new i.tz3("default",-1,e))}}else for(const t in e)$e.push(R(t))}(),function(){const e=Object.keys(Je.kinematicsModels)[0],t=Object.keys(Je.kinematicsScenes)[0],n=Object.keys(Je.visualScenes)[0];if(void 0===e||void 0===t)return;const r=(o=e,f(Je.kinematicsModels[o],me));var o;const s=function(e){return f(Je.kinematicsScenes[e],Se)}(t),a=ze(n),l=s.bindJointAxis,c={};for(let i=0,d=l.length;i<d;i++){const e=l[i],t=Ve.querySelector('[sid="'+e.target+'"]');if(t){const n=t.parentElement;u(e.jointIndex,n)}}function u(e,t){const n=t.getAttribute("name"),i=r.joints[e];a.traverse((function(r){r.name===n&&(c[e]={object:r,transforms:Ce(t),joint:i,position:i.zeroPosition})}))}const h=new i.kn4;Ye={joints:r&&r.joints,getJointValue:function(e){const t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=c[e];if(n){const r=n.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const o=n.object,s=r.axis,a=n.transforms;Me.identity();for(let n=0;n<a.length;n++){const o=a[n];if(o.sid&&-1!==o.sid.indexOf(e))switch(r.type){case"revolute":Me.multiply(h.makeRotationAxis(s,i.cj9.degToRad(t)));break;case"prismatic":Me.multiply(h.makeTranslation(s.x*t,s.y*t,s.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(o.type){case"matrix":Me.multiply(o.obj);break;case"translate":Me.multiply(h.makeTranslation(o.obj.x,o.obj.y,o.obj.z));break;case"scale":Me.scale(o.obj);break;case"rotate":Me.multiply(h.makeRotationAxis(o.obj,o.angle))}}o.matrix.copy(Me),o.matrix.decompose(o.position,o.quaternion,o.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const Ze=function(e){return ze(l(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Ve,"scene")[0]);return Ze.animations=$e,"Z_UP"===We.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),Ze.rotation.set(-Math.PI/2,0,0)),Ze.scale.multiplyScalar(We.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),$e},kinematics:Ye,library:Je,scene:Ze}}}THREE.ColladaLoader=o,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,n=this.data,i=this.el.sceneEl.systems.renderer;n&&(this.remove(),this.loader.load(n,(function(n){e.model=n.scene,e.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&i.applyColorCorrection(t.color),t.map&&i.applyColorCorrection(t.map),t.emissive&&i.applyColorCorrection(t.emissive),t.emissiveMap&&i.applyColorCorrection(t.emissiveMap)}})),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},8812:(e,t,n)=>{"use strict";n.d(t,{A:()=>u,k:()=>l});var i=n(7598),r=n(3815),o=n(7162),s=n(9751),a=n(7758);function l(){function e(e,t,n,r){const a={[e]:t,theme:n},l=r[e];if(!l)return{[e]:t};const{cssProperty:c=e,themeKey:u,transform:h,style:d}=l;if(null==t)return null;if("typography"===u&&"inherit"===t)return{[e]:t};const p=(0,o.Yn)(n,u)||{};if(d)return d(a);return(0,s.NI)(a,t,(t=>{let n=(0,o.BO)(p,h,t);return t===n&&"string"===typeof t&&(n=(0,o.BO)(p,h,`${e}${"default"===t?"":(0,i.A)(t)}`,t)),!1===c?n:{[c]:n}}))}return function t(n){var i;const{sx:o,theme:l={}}=n||{};if(!o)return null;const c=null!=(i=l.unstable_sxConfig)?i:a.A;function u(n){let i=n;if("function"===typeof n)i=n(l);else if("object"!==typeof n)return n;if(!i)return null;const o=(0,s.EU)(l.breakpoints),a=Object.keys(o);let u=o;return Object.keys(i).forEach((n=>{const o=(a=i[n],h=l,"function"===typeof a?a(h):a);var a,h;if(null!==o&&void 0!==o)if("object"===typeof o)if(c[n])u=(0,r.A)(u,e(n,o,l,c));else{const e=(0,s.NI)({theme:l},o,(e=>({[n]:e})));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.reduce(((e,t)=>e.concat(Object.keys(t))),[]),r=new Set(i);return t.every((e=>r.size===Object.keys(e).length))}(e,o)?u=(0,r.A)(u,e):u[n]=t({sx:o,theme:l})}else u=(0,r.A)(u,e(n,o,l,c))})),(0,s.vf)(a,u)}return Array.isArray(o)?o.map(u):u(o)}}const c=l();c.filterProps=["sx"];const u=c},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8918:e=>{e.exports=AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.el.sceneEl,t=e.canvas;if(!t)return void e.addEventListener("render-target-loaded",this.addEventListeners.bind(this));t.addEventListener("touchstart",this.onTouchStart,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd,{passive:!0});const n=e.getAttribute("vr-mode-ui");n&&n.cardboardModeEnabled&&e.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){const e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&e.touches&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()},onEnterVR:function(){const e=this.el.sceneEl.xrSession;e&&(e.addEventListener("selectstart",this.onTouchStart),e.addEventListener("selectend",this.onTouchEnd))}})},8925:e=>{e.exports=function(e){!function(e){if(!e)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],n=0;n<t.length;++n)if(e.hasOwnProperty(t[n]))throw new Error("Subject cannot be eventified, since it already has property '"+t[n]+"'")}(e);var t=function(e){var t=Object.create(null);return{on:function(n,i,r){if("function"!==typeof i)throw new Error("callback is expected to be a function");var o=t[n];return o||(o=t[n]=[]),o.push({callback:i,ctx:r}),e},off:function(n,i){if("undefined"===typeof n)return t=Object.create(null),e;if(t[n])if("function"!==typeof i)delete t[n];else for(var r=t[n],o=0;o<r.length;++o)r[o].callback===i&&r.splice(o,1);return e},fire:function(n){var i,r=t[n];if(!r)return e;arguments.length>1&&(i=Array.prototype.splice.call(arguments,1));for(var o=0;o<r.length;++o){var s=r[o];s.callback.apply(s.ctx,i)}return e}}}(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e}},9019:(e,t,n)=>{"use strict";t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=c(n(3900)),o=c(n(5043)),s=c(n(5173)),a=(c(n(344)),n(5484)),l=n(5051);function c(e){return e&&e.__esModule?e:{default:e}}s.default.any,s.default.func,s.default.node;var u=function(e){function t(n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,e.call(this,n,r));return o.performAppear=function(e,t){o.currentlyTransitioningKeys[e]=!0,t.componentWillAppear?t.componentWillAppear(o._handleDoneAppearing.bind(o,e,t)):o._handleDoneAppearing(e,t)},o._handleDoneAppearing=function(e,t){t&&t.componentDidAppear&&t.componentDidAppear(),delete o.currentlyTransitioningKeys[e];var n=(0,l.getChildMapping)(o.props.children);n&&n.hasOwnProperty(e)||o.performLeave(e,t)},o.performEnter=function(e,t){o.currentlyTransitioningKeys[e]=!0,t.componentWillEnter?t.componentWillEnter(o._handleDoneEntering.bind(o,e,t)):o._handleDoneEntering(e,t)},o._handleDoneEntering=function(e,t){t&&t.componentDidEnter&&t.componentDidEnter(),delete o.currentlyTransitioningKeys[e];var n=(0,l.getChildMapping)(o.props.children);n&&n.hasOwnProperty(e)||o.performLeave(e,t)},o.performLeave=function(e,t){o.currentlyTransitioningKeys[e]=!0,t&&t.componentWillLeave?t.componentWillLeave(o._handleDoneLeaving.bind(o,e,t)):o._handleDoneLeaving(e,t)},o._handleDoneLeaving=function(e,t){t&&t.componentDidLeave&&t.componentDidLeave(),delete o.currentlyTransitioningKeys[e];var n=(0,l.getChildMapping)(o.props.children);n&&n.hasOwnProperty(e)?o.keysToEnter.push(e):o.setState((function(t){var n=i({},t.children);return delete n[e],{children:n}}))},o.childRefs=Object.create(null),o.currentlyTransitioningKeys={},o.keysToEnter=[],o.keysToLeave=[],o.state={children:(0,l.getChildMapping)(n.children)},o}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentDidMount=function(){var e=this.state.children;for(var t in e)e[t]&&this.performAppear(t,this.childRefs[t])},t.getDerivedStateFromProps=function(e,t){var n=(0,l.getChildMapping)(e.children),i=t.children;return{children:(0,l.mergeChildMappings)(i,n)}},t.prototype.componentDidUpdate=function(e,t){var n=this,i=(0,l.getChildMapping)(this.props.children),r=t.children;for(var o in i){var s=r&&r.hasOwnProperty(o);!i[o]||s||this.currentlyTransitioningKeys[o]||this.keysToEnter.push(o)}for(var a in r){var c=i&&i.hasOwnProperty(a);!r[a]||c||this.currentlyTransitioningKeys[a]||this.keysToLeave.push(a)}var u=this.keysToEnter;this.keysToEnter=[],u.forEach((function(e){return n.performEnter(e,n.childRefs[e])}));var h=this.keysToLeave;this.keysToLeave=[],h.forEach((function(e){return n.performLeave(e,n.childRefs[e])}))},t.prototype.render=function(){var e=this,t=[],n=function(n){var i=e.state.children[n];if(i){var s="string"!==typeof i.ref,a=e.props.childFactory(i),l=function(t){e.childRefs[n]=t};a===i&&s&&(l=(0,r.default)(i.ref,l)),t.push(o.default.cloneElement(a,{key:n,ref:l}))}};for(var s in this.state.children)n(s);var a=i({},this.props);return delete a.transitionLeave,delete a.transitionName,delete a.transitionAppear,delete a.transitionEnter,delete a.childFactory,delete a.transitionLeaveTimeout,delete a.transitionEnterTimeout,delete a.transitionAppearTimeout,delete a.component,o.default.createElement(this.props.component,a,t)},t}(o.default.Component);u.displayName="TransitionGroup",u.propTypes={},u.defaultProps={component:"span",childFactory:function(e){return e}},t.default=(0,a.polyfill)(u),e.exports=t.default},9066:(e,t,n)=>{"use strict";var i=n(4994);t.__esModule=!0,t.default=function(e,t){e.classList?e.classList.add(t):(0,r.default)(e,t)||("string"===typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))};var r=i(n(4483));e.exports=t.default},9081:(e,t,n)=>{const i=n(510)(),r=function(){let e;return function(){return e=e||i("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js"),e}}();e.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=r().then((()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")}))},update:function(){const e=this,t=this.el,n=this.data;n&&(this.remove(),this.loaderPromise.then((()=>{this.loader.load(n,(function(n){e.model=n.scene,e.model.animations=n.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},9117:e=>{e.exports=AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){const e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){const t=this.data,n=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=n[0],this.startingAxisData[1]=n[1]),this.startingAxisData.length>0){let e=0,i=0;t.enableNegX&&n[0]<this.startingAxisData[0]&&(e=-1),t.enablePosX&&n[0]>this.startingAxisData[0]&&(e=1),t.enablePosZ&&n[1]>this.startingAxisData[1]&&(i=-1),t.enableNegZ&&n[1]<this.startingAxisData[1]&&(i=1);const r=Math.abs(this.startingAxisData[1]-n[1]);Math.abs(this.startingAxisData[0]-n[0])>r?(this.zVel=0,this.xVel=e,this.isMoving=!0):(this.xVel=0,this.zVel=i,this.isMoving=!0)}},handleTouchAxis:function(e){const t=this.data,n=e.detail.axis;let i=0,r=0;t.enableNegX&&n[0]<0&&(i=-1),t.enablePosX&&n[0]>0&&(i=1),t.enablePosZ&&n[1]>0&&(r=-1),t.enableNegZ&&n[1]<0&&(r=1),Math.abs(n[0])>Math.abs(n[1])?(this.zVel=0,this.xVel=i):(this.xVel=0,this.zVel=r)}})},9172:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,Q:()=>o});var i=n(8168),r=n(5043);function o(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function s(e){if(r.isValidElement(e)||!o(e))return e;const t={};return Object.keys(e).forEach((n=>{t[n]=s(e[n])})),t}function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const l=n.clone?(0,i.A)({},e):e;return o(e)&&o(t)&&Object.keys(t).forEach((i=>{r.isValidElement(t[i])?l[i]=t[i]:o(t[i])&&Object.prototype.hasOwnProperty.call(e,i)&&o(e[i])?l[i]=a(e[i],t[i],n):n.clone?l[i]=o(t[i])?s(t[i]):t[i]:l[i]=t[i]})),l}},9230:(e,t,n)=>{const i=n(1928);function r(e,t){return`\n${s(e,t)}\n${o(e)}\nreturn {Body: Body, Vector: Vector};\n`}function o(e){let t=i(e),n=t("{var}",{join:", "});return`\nfunction Body(${n}) {\n  this.isPinned = false;\n  this.pos = new Vector(${n});\n  this.force = new Vector();\n  this.velocity = new Vector();\n  this.mass = 1;\n\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.reset = function() {\n  this.force.reset();\n  this.springCount = 0;\n  this.springLength = 0;\n}\n\nBody.prototype.setPosition = function (${n}) {\n  ${t("this.pos.{var} = {var} || 0;",{indent:2})}\n};`}function s(e,t){let n=i(e),r="";return t&&(r=`${n("\n   var v{var};\nObject.defineProperty(this, '{var}', {\n  set: function(v) { \n    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n    v{var} = v; \n  },\n  get: function() { return v{var}; }\n});")}`),`function Vector(${n("{var}",{join:", "})}) {\n  ${r}\n    if (typeof arguments[0] === 'object') {\n      // could be another vector\n      let v = arguments[0];\n      ${n('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}\n      ${n("this.{var} = v.{var};",{indent:4})}\n    } else {\n      ${n('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}\n    }\n  }\n  \n  Vector.prototype.reset = function () {\n    ${n("this.{var} = ",{join:""})}0;\n  };`}e.exports=function(e,t){let n=r(e,t),{Body:i}=new Function(n)();return i},e.exports.generateCreateBodyFunctionBody=r,e.exports.getVectorCode=s,e.exports.getBodyCode=o},9303:(e,t,n)=>{"use strict";n.d(t,{E:()=>s,A:()=>a});var i=n(5043);const r={};const o=[];class s{constructor(){this.currentId=null,this.clear=()=>{null!==this.currentId&&(clearTimeout(this.currentId),this.currentId=null)},this.disposeEffect=()=>this.clear}static create(){return new s}start(e,t){this.clear(),this.currentId=setTimeout((()=>{this.currentId=null,t()}),e)}}function a(){const e=function(e,t){const n=i.useRef(r);return n.current===r&&(n.current=e(t)),n}(s.create).current;var t;return t=e.disposeEffect,i.useEffect(t,o),e}},9369:(e,t,n)=>{"use strict";n.d(t,{C:()=>c,E:()=>g,T:()=>h,c:()=>f,h:()=>d,w:()=>u});var i=n(5043),r=n(3803),o=n(1722),s=n(6598),a=n(9436),l=i.createContext("undefined"!==typeof HTMLElement?(0,r.A)({key:"css"}):null),c=l.Provider,u=function(e){return(0,i.forwardRef)((function(t,n){var r=(0,i.useContext)(l);return e(t,r,n)}))},h=i.createContext({});var d={}.hasOwnProperty,p="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",f=function(e,t){var n={};for(var i in t)d.call(t,i)&&(n[i]=t[i]);return n[p]=e,n},m=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;return(0,o.SF)(t,n,i),(0,a.s)((function(){return(0,o.sk)(t,n,i)})),null},g=u((function(e,t,n){var r=e.css;"string"===typeof r&&void 0!==t.registered[r]&&(r=t.registered[r]);var a=e[p],l=[r],c="";"string"===typeof e.className?c=(0,o.Rk)(t.registered,l,e.className):null!=e.className&&(c=e.className+" ");var u=(0,s.J)(l,void 0,i.useContext(h));c+=t.key+"-"+u.name;var f={};for(var g in e)d.call(e,g)&&"css"!==g&&g!==p&&(f[g]=e[g]);return f.className=c,n&&(f.ref=n),i.createElement(i.Fragment,null,i.createElement(m,{cache:t,serialized:u,isStringTag:"string"===typeof a}),i.createElement(a,f))}))},9386:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});const i=e=>e,r=(()=>{let e=i;return{configure(t){e=t},generate:t=>e(t),reset(){e=i}}})()},9435:(e,t,n)=>{"use strict";n.d(t,{$EB:()=>m,$Yl:()=>F,$_I:()=>_e,$ei:()=>C,$p8:()=>Gc,A$4:()=>Gr,AQS:()=>Ln,B69:()=>hr,BH$:()=>pa,BKk:()=>xo,BXX:()=>Je,B_h:()=>at,CMB:()=>ze,CR7:()=>Zt,CSG:()=>$l,CV9:()=>ka,CVz:()=>it,CWW:()=>Ct,Cfg:()=>Ae,Df:()=>Ql,Dmk:()=>De,EZo:()=>y,EdD:()=>x,F1T:()=>Mo,FFZ:()=>dn,FNr:()=>Kl,FV:()=>ie,FXf:()=>w,FZo:()=>Qc,Fn:()=>xt,Fvt:()=>Jl,GJx:()=>fe,GWd:()=>Ue,GYF:()=>ms,G_z:()=>Xl,Gu$:()=>Nl,Gwm:()=>q,H23:()=>bt,H2z:()=>yu,HIg:()=>Oe,HLH:()=>Wt,HO_:()=>St,HPb:()=>Yt,HXV:()=>tt,HiM:()=>Fc,Ho_:()=>Ha,I9Y:()=>In,IE4:()=>$e,IUQ:()=>ni,Iit:()=>vo,Jnc:()=>l,K52:()=>X,KDk:()=>ot,KLL:()=>jt,KRh:()=>K,Kef:()=>wt,Kwu:()=>A,Kzv:()=>Fe,LAk:()=>oe,LiQ:()=>I,LlO:()=>Ao,LoY:()=>eo,LuO:()=>hu,MW4:()=>Hr,Mjd:()=>te,Mmk:()=>Vn,N1A:()=>aa,N5j:()=>Nt,NRn:()=>hi,NTi:()=>v,NZq:()=>we,Nex:()=>Au,Nt7:()=>N,Nz6:()=>Ye,O0B:()=>ii,O9p:()=>Xi,OUM:()=>Ee,Oax:()=>Wr,Om:()=>pe,OuU:()=>B,PPD:()=>Ns,PTz:()=>ai,Pem:()=>xa,Pq0:()=>li,Q1f:()=>Ir,QP0:()=>u,Qev:()=>yn,Qrf:()=>ut,R3r:()=>Bo,ROr:()=>Qt,RQf:()=>Ie,RcT:()=>en,Riy:()=>rt,RlV:()=>Oi,RoJ:()=>Fo,RrE:()=>U,Ru$:()=>qt,RyA:()=>d,S$4:()=>At,THS:()=>Vr,TMh:()=>nn,Tap:()=>Cc,TdN:()=>gn,TiK:()=>ln,TkQ:()=>Qe,U3G:()=>Q,UTZ:()=>le,V3x:()=>Ne,V9B:()=>Nr,VCu:()=>ba,VGF:()=>qe,VT0:()=>Ge,VVr:()=>Gt,Vb5:()=>a,Vnu:()=>fn,VxR:()=>zt,W9U:()=>_t,WNZ:()=>s,Wdf:()=>mn,Wew:()=>Be,Wk7:()=>h,XG_:()=>Et,XIg:()=>g,XTe:()=>Kc,XrR:()=>J,Y9S:()=>Ec,YHV:()=>gu,YJl:()=>Io,Yuy:()=>Te,Z58:()=>Do,ZQM:()=>He,Zcv:()=>Ps,Zr2:()=>Ft,ZyN:()=>Vc,_4j:()=>Gl,_QJ:()=>pt,_Ut:()=>yo,a55:()=>_n,a5J:()=>dt,aEY:()=>k,aHM:()=>bc,aJ8:()=>se,aVO:()=>Yl,agE:()=>pn,amv:()=>on,b4q:()=>To,bC7:()=>gt,bCz:()=>b,bI3:()=>Dt,bTm:()=>c,bdM:()=>Pl,bkx:()=>Re,brA:()=>H,bw0:()=>$,c90:()=>Xe,cHt:()=>Me,caT:()=>Y,cj9:()=>Rn,czI:()=>lt,dYF:()=>si,dcC:()=>Ve,dth:()=>Tc,dwI:()=>Pn,e0p:()=>z,eB$:()=>ko,eHc:()=>V,eHs:()=>Uo,eaF:()=>po,eoi:()=>cn,er$:()=>Ut,f4X:()=>R,fBL:()=>Ce,fJr:()=>Xt,g7M:()=>re,gJ2:()=>Le,gO9:()=>_,gPd:()=>ti,gWB:()=>hn,ghU:()=>me,hB5:()=>p,hdd:()=>L,hgQ:()=>O,hsX:()=>f,hxR:()=>ve,hy7:()=>ce,i7d:()=>bo,i7u:()=>vn,iNn:()=>mo,ie2:()=>P,imn:()=>Lr,ix0:()=>Pe,iyt:()=>Ri,j6:()=>Ul,jR7:()=>Ke,jej:()=>zn,jf0:()=>Ot,jsO:()=>Jt,jut:()=>qc,jzd:()=>un,k6Q:()=>Ze,k6q:()=>xe,kBv:()=>r,kG0:()=>Ht,kO0:()=>an,kRr:()=>be,kTW:()=>ge,kTp:()=>et,kYr:()=>Kt,k_V:()=>vu,klZ:()=>tn,kn4:()=>Ui,kqe:()=>Vt,kyO:()=>ee,lGu:()=>G,lMl:()=>Sr,lPF:()=>On,lxW:()=>go,lyL:()=>mt,mcG:()=>Fn,mrM:()=>Zs,nCl:()=>Nc,nNL:()=>ne,nST:()=>E,nWS:()=>ri,nZQ:()=>tu,o6l:()=>Ro,oVO:()=>$t,ojh:()=>M,ojs:()=>yt,ov9:()=>j,pBf:()=>nt,pHI:()=>ye,paN:()=>We,ppV:()=>Qn,psI:()=>ht,q2:()=>jl,qBx:()=>ql,qFE:()=>Wa,qUd:()=>zc,qa3:()=>st,qad:()=>T,qq$:()=>kn,qtW:()=>Qr,rFo:()=>oi,rSH:()=>ct,s0K:()=>La,sKt:()=>rn,sPf:()=>i,tBo:()=>pu,tJf:()=>Se,tXL:()=>Wl,uB5:()=>ft,uSd:()=>Hl,uV5:()=>de,uWO:()=>As,ubm:()=>So,ure:()=>Hc,vim:()=>sn,vyJ:()=>kt,wfO:()=>he,wn6:()=>D,wrO:()=>ke,wtR:()=>o,xFO:()=>ue,xSv:()=>W,xiE:()=>jn,y3Z:()=>vt,y_p:()=>Z,zD7:()=>nu,zdS:()=>je,zgK:()=>$i,znC:()=>S});const i="174",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s=0,a=1,l=2,c=0,u=1,h=2,d=3,p=0,f=1,m=2,g=0,v=1,y=2,A=3,x=4,b=5,_=100,w=101,E=102,S=103,C=104,M=200,T=201,R=202,I=203,P=204,B=205,L=206,N=207,D=208,k=209,O=210,U=211,F=212,z=213,j=214,V=0,G=1,H=2,W=3,Q=4,q=5,X=6,$=7,Y=0,K=1,J=2,Z=0,ee=1,te=2,ne=3,ie=4,re=5,oe=6,se=7,ae="attached",le=300,ce=301,ue=302,he=303,de=304,pe=306,fe=1e3,me=1001,ge=1002,ve=1003,ye=1004,Ae=1005,xe=1006,be=1007,_e=1008,we=1008,Ee=1009,Se=1010,Ce=1011,Me=1012,Te=1013,Re=1014,Ie=1015,Pe=1016,Be=1017,Le=1018,Ne=1020,De=35902,ke=1021,Oe=1022,Ue=1023,Fe=1024,ze=1025,je=1026,Ve=1027,Ge=1028,He=1029,We=1030,Qe=1031,qe=1032,Xe=1033,$e=33776,Ye=33777,Ke=33778,Je=33779,Ze=35840,et=35841,tt=35842,nt=35843,it=36196,rt=37492,ot=37496,st=37808,at=37809,lt=37810,ct=37811,ut=37812,ht=37813,dt=37814,pt=37815,ft=37816,mt=37817,gt=37818,vt=37819,yt=37820,At=37821,xt=36492,bt=36494,_t=36495,wt=36283,Et=36284,St=36285,Ct=36286,Mt=2300,Tt=2301,Rt=2302,It=2400,Pt=2401,Bt=2402,Lt=2500,Nt=3201,Dt=0,kt=1,Ot="",Ut="srgb",Ft="srgb-linear",zt="linear",jt="srgb",Vt=0,Gt=7680,Ht=7681,Wt=7682,Qt=7683,qt=34055,Xt=34056,$t=5386,Yt=512,Kt=513,Jt=514,Zt=515,en=516,tn=517,nn=518,rn=519,on=512,sn=513,an=514,ln=515,cn=516,un=517,hn=518,dn=519,pn=35044,fn=35048,mn="300 es",gn=2e3,vn=2001;class yn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const i=n[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,i=t.length;n<i;n++)t[n].call(this,e);e.target=null}}}const An=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let xn=1234567;const bn=Math.PI/180,_n=180/Math.PI;function wn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(An[255&e]+An[e>>8&255]+An[e>>16&255]+An[e>>24&255]+"-"+An[255&t]+An[t>>8&255]+"-"+An[t>>16&15|64]+An[t>>24&255]+"-"+An[63&n|128]+An[n>>8&255]+"-"+An[n>>16&255]+An[n>>24&255]+An[255&i]+An[i>>8&255]+An[i>>16&255]+An[i>>24&255]).toLowerCase()}function En(e,t,n){return Math.max(t,Math.min(n,e))}function Sn(e,t){return(e%t+t)%t}function Cn(e,t,n){return(1-n)*e+n*t}function Mn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Tn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const Rn={DEG2RAD:bn,RAD2DEG:_n,generateUUID:wn,clamp:En,euclideanModulo:Sn,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Cn,damp:function(e,t,n,i){return Cn(e,t,1-Math.exp(-n*i))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Sn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(xn=e);let t=xn+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*bn},radToDeg:function(e){return e*_n},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+i)/2),u=s((t+i)/2),h=o((t-i)/2),d=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case"XYX":e.set(a*u,l*h,l*d,a*c);break;case"YZY":e.set(l*d,a*u,l*h,a*c);break;case"ZXZ":e.set(l*h,l*d,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Tn,denormalize:Mn};class In{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;In.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=En(this.x,e.x,t.x),this.y=En(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=En(this.x,e,t),this.y=En(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(En(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(En(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pn{constructor(e,t,n,i,r,o,s,a,l){Pn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l)}set(e,t,n,i,r,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],A=i[7],x=i[2],b=i[5],_=i[8];return r[0]=o*f+s*v+a*x,r[3]=o*m+s*y+a*b,r[6]=o*g+s*A+a*_,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*A+u*_,r[2]=h*f+d*v+p*x,r[5]=h*m+d*y+p*b,r[8]=h*g+d*A+p*_,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*r*c+n*s*a+i*r*l-i*o*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*r,d=l*r-o*a,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(s*n-i*o)*f,e[3]=h*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(Bn.makeScale(e,t)),this}rotate(e){return this.premultiply(Bn.makeRotation(-e)),this}translate(e,t){return this.premultiply(Bn.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Bn=new Pn;function Ln(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Nn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Dn(e,t){return new Nn[e](t)}function kn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function On(){const e=kn("canvas");return e.style.display="block",e}const Un={};function Fn(e){e in Un||(Un[e]=!0,console.warn(e))}function zn(e,t,n){return new Promise((function(i,r){setTimeout((function o(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(o,n);break;default:i()}}),n)}))}function jn(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function Vn(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}const Gn=(new Pn).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Hn=(new Pn).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Wn(){const e={enabled:!0,workingColorSpace:Ft,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===jt&&(e.r=qn(e.r),e.g=qn(e.g),e.b=qn(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===jt&&(e.r=Xn(e.r),e.g=Xn(e.g),e.b=Xn(e.b)),e):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Ot?zt:this.spaces[e].transfer},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return e.define({[Ft]:{primaries:t,whitePoint:i,transfer:zt,toXYZ:Gn,fromXYZ:Hn,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Ut},outputColorSpaceConfig:{drawingBufferColorSpace:Ut}},[Ut]:{primaries:t,whitePoint:i,transfer:jt,toXYZ:Gn,fromXYZ:Hn,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Ut}}}),e}const Qn=Wn();function qn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Xn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let $n;class Yn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===$n&&($n=kn("canvas")),$n.width=e.width,$n.height=e.height;const n=$n.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=$n}return t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=kn("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*qn(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*qn(t[e]/255)):t[e]=qn(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Kn=0;class Jn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Kn++}),this.uuid=wn(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(Zn(i[t].image)):e.push(Zn(i[t]))}else e=Zn(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function Zn(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Yn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ei=0;class ti extends yn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ti.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ti.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:me,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:me,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xe,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:_e,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ue,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Ee,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:ti.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Ot;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ei++}),this.uuid=wn(),this.name="",this.source=new Jn(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new In(0,0),this.repeat=new In(1,1),this.center=new In(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==le)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case fe:e.x=e.x-Math.floor(e.x);break;case me:e.x=e.x<0?0:1;break;case ge:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case fe:e.y=e.y-Math.floor(e.y);break;case me:e.y=e.y<0?0:1;break;case ge:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}ti.DEFAULT_IMAGE=null,ti.DEFAULT_MAPPING=le,ti.DEFAULT_ANISOTROPY=1;class ni{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;ni.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+h)/4,A=(u+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=A/n):a>v?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=x/i):v<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=A/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=En(this.x,e.x,t.x),this.y=En(this.y,e.y,t.y),this.z=En(this.z,e.z,t.z),this.w=En(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=En(this.x,e,t),this.y=En(this.y,e,t),this.z=En(this.z,e,t),this.w=En(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(En(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ii extends yn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ni(0,0,e,t),this.scissorTest=!1,this.viewport=new ni(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:xe,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new ti(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let s=0;s<o;s++)this.textures[s]=r.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new Jn(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ri extends ii{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class oi extends ti{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=ve,this.minFilter=ve,this.wrapR=me,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class si extends ti{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=ve,this.minFilter=ve,this.wrapR=me,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ai{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[o],h=r[o+1],d=r[o+2],p=r[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,i=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(En(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+i*l-r*a,this._y=i*c+o*a+r*s-n*l,this._z=r*c+o*l+n*a-i*s,this._w=o*c-n*s-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class li{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;li.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(ui.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ui.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=2*(o*i-s*n),c=2*(s*t-r*i),u=2*(r*n-o*t);return this.x=t+a*l+o*u-s*c,this.y=n+a*c+s*l-r*u,this.z=i+a*u+r*c-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=En(this.x,e.x,t.x),this.y=En(this.y,e.y,t.y),this.z=En(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=En(this.x,e,t),this.y=En(this.y,e,t),this.z=En(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(En(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ci.copy(this).projectOnVector(e),this.sub(ci)}reflect(e){return this.sub(ci.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(En(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ci=new li,ui=new ai;class hi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(pi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(pi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=pi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,pi):pi.fromBufferAttribute(i,t),pi.applyMatrix4(e.matrixWorld),this.expandByPoint(pi);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),fi.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),fi.copy(n.boundingBox)),fi.applyMatrix4(e.matrixWorld),this.union(fi)}const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,pi),pi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(bi),_i.subVectors(this.max,bi),mi.subVectors(e.a,bi),gi.subVectors(e.b,bi),vi.subVectors(e.c,bi),yi.subVectors(gi,mi),Ai.subVectors(vi,gi),xi.subVectors(mi,vi);let t=[0,-yi.z,yi.y,0,-Ai.z,Ai.y,0,-xi.z,xi.y,yi.z,0,-yi.x,Ai.z,0,-Ai.x,xi.z,0,-xi.x,-yi.y,yi.x,0,-Ai.y,Ai.x,0,-xi.y,xi.x,0];return!!Si(t,mi,gi,vi,_i)&&(t=[1,0,0,0,1,0,0,0,1],!!Si(t,mi,gi,vi,_i)&&(wi.crossVectors(yi,Ai),t=[wi.x,wi.y,wi.z],Si(t,mi,gi,vi,_i)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,pi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(pi).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(di[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),di[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),di[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),di[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),di[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),di[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),di[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),di[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(di)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const di=[new li,new li,new li,new li,new li,new li,new li,new li],pi=new li,fi=new hi,mi=new li,gi=new li,vi=new li,yi=new li,Ai=new li,xi=new li,bi=new li,_i=new li,wi=new li,Ei=new li;function Si(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){Ei.fromArray(e,o);const s=r.x*Math.abs(Ei.x)+r.y*Math.abs(Ei.y)+r.z*Math.abs(Ei.z),a=t.dot(Ei),l=n.dot(Ei),c=i.dot(Ei);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const Ci=new hi,Mi=new li,Ti=new li;class Ri{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ci.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Mi.subVectors(e,this.center);const t=Mi.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Mi,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Ti.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Mi.copy(e.center).add(Ti)),this.expandByPoint(Mi.copy(e.center).sub(Ti))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ii=new li,Pi=new li,Bi=new li,Li=new li,Ni=new li,Di=new li,ki=new li;class Oi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ii)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ii.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ii.copy(this.origin).addScaledVector(this.direction,t),Ii.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Pi.copy(e).add(t).multiplyScalar(.5),Bi.copy(t).sub(e).normalize(),Li.copy(this.origin).sub(Pi);const r=.5*e.distanceTo(t),o=-this.direction.dot(Bi),s=Li.dot(this.direction),a=-Li.dot(Bi),l=Li.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Pi).addScaledVector(Bi,h),d}intersectSphere(e,t){Ii.subVectors(e.center,this.origin);const n=Ii.dot(this.direction),i=Ii.dot(Ii)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>i?null:((s>n||n!==n)&&(n=s),(a<i||i!==i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ii)}intersectTriangle(e,t,n,i,r){Ni.subVectors(t,e),Di.subVectors(n,e),ki.crossVectors(Ni,Di);let o,s=this.direction.dot(ki);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}Li.subVectors(this.origin,e);const a=o*this.direction.dot(Di.crossVectors(Li,Di));if(a<0)return null;const l=o*this.direction.dot(Ni.cross(Li));if(l<0)return null;if(a+l>s)return null;const c=-o*Li.dot(ki);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ui{constructor(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){Ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ui).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Fi.setFromMatrixColumn(e,0).length(),r=1/Fi.setFromMatrixColumn(e,1).length(),o=1/Fi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-o*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*c,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ji,e,Vi)}lookAt(e,t,n){const i=this.elements;return Wi.subVectors(e,t),0===Wi.lengthSq()&&(Wi.z=1),Wi.normalize(),Gi.crossVectors(n,Wi),0===Gi.lengthSq()&&(1===Math.abs(n.z)?Wi.x+=1e-4:Wi.z+=1e-4,Wi.normalize(),Gi.crossVectors(n,Wi)),Gi.normalize(),Hi.crossVectors(Wi,Gi),i[0]=Gi.x,i[4]=Hi.x,i[8]=Wi.x,i[1]=Gi.y,i[5]=Hi.y,i[9]=Wi.y,i[2]=Gi.z,i[6]=Hi.z,i[10]=Wi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],A=n[11],x=n[15],b=i[0],_=i[4],w=i[8],E=i[12],S=i[1],C=i[5],M=i[9],T=i[13],R=i[2],I=i[6],P=i[10],B=i[14],L=i[3],N=i[7],D=i[11],k=i[15];return r[0]=o*b+s*S+a*R+l*L,r[4]=o*_+s*C+a*I+l*N,r[8]=o*w+s*M+a*P+l*D,r[12]=o*E+s*T+a*B+l*k,r[1]=c*b+u*S+h*R+d*L,r[5]=c*_+u*C+h*I+d*N,r[9]=c*w+u*M+h*P+d*D,r[13]=c*E+u*T+h*B+d*k,r[2]=p*b+f*S+m*R+g*L,r[6]=p*_+f*C+m*I+g*N,r[10]=p*w+f*M+m*P+g*D,r[14]=p*E+f*T+m*B+g*k,r[3]=v*b+y*S+A*R+x*L,r[7]=v*_+y*C+A*I+x*N,r[11]=v*w+y*M+A*P+x*D,r[15]=v*E+y*T+A*B+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*l*u-r*s*h+n*l*h+i*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-i*o*d+i*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+n*o*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*a*u+t*s*h+i*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,A=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*v+n*y+i*A+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/b;return e[0]=v*_,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*_,e[2]=(s*m*r-f*a*r+f*i*l-n*m*l-s*i*g+n*a*g)*_,e[3]=(u*a*r-s*h*r-u*i*l+n*h*l+s*i*d-n*a*d)*_,e[4]=y*_,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*_,e[6]=(p*a*r-o*m*r-p*i*l+t*m*l+o*i*g-t*a*g)*_,e[7]=(o*h*r-c*a*r+c*i*l-t*h*l-o*i*d+t*a*d)*_,e[8]=A*_,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*_,e[10]=(o*f*r-p*s*r+p*n*l-t*f*l-o*n*g+t*s*g)*_,e[11]=(c*s*r-o*u*r-c*n*l+t*u*l+o*n*d-t*s*d)*_,e[12]=x*_,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*_,e[14]=(p*s*i-o*f*i-p*n*a+t*f*a+o*n*m-t*s*m)*_,e[15]=(o*u*i-c*s*i+c*n*a-t*u*a-o*n*h+t*s*h)*_,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,c*s+n,c*a-i*o,0,l*a-i*s,c*a+i*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,v=a*l,y=a*c,A=a*u,x=n.x,b=n.y,_=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+A)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-A)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*_,i[9]=(m-v)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Fi.set(i[0],i[1],i[2]).length();const o=Fi.set(i[4],i[5],i[6]).length(),s=Fi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],zi.copy(this);const a=1/r,l=1/o,c=1/s;return zi.elements[0]*=a,zi.elements[1]*=a,zi.elements[2]*=a,zi.elements[4]*=l,zi.elements[5]*=l,zi.elements[6]*=l,zi.elements[8]*=c,zi.elements[9]*=c,zi.elements[10]*=c,t.setFromRotationMatrix(zi),n.x=r,n.y=o,n.z=s,this}makePerspective(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:gn;const a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(s===gn)d=-(o+r)/(o-r),p=-2*o*r/(o-r);else{if(s!==vn)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-o/(o-r),p=-o*r/(o-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:gn;const a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(o-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(s===gn)p=(o+r)*u,f=-2*u;else{if(s!==vn)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Fi=new li,zi=new Ui,ji=new li(0,0,0),Vi=new li(1,1,1),Gi=new li,Hi=new li,Wi=new li,Qi=new Ui,qi=new ai;class Xi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Xi.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=e.elements,r=i[0],o=i[4],s=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(En(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-En(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(En(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-En(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(En(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-En(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Qi.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Qi,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return qi.setFromEuler(this),this.setFromQuaternion(qi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Xi.DEFAULT_ORDER="XYZ";class $i{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let Yi=0;const Ki=new li,Ji=new ai,Zi=new Ui,er=new li,tr=new li,nr=new li,ir=new ai,rr=new li(1,0,0),or=new li(0,1,0),sr=new li(0,0,1),ar={type:"added"},lr={type:"removed"},cr={type:"childadded",child:null},ur={type:"childremoved",child:null};class hr extends yn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Yi++}),this.uuid=wn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hr.DEFAULT_UP.clone();const e=new li,t=new Xi,n=new ai,i=new li(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ui},normalMatrix:{value:new Pn}}),this.matrix=new Ui,this.matrixWorld=new Ui,this.matrixAutoUpdate=hr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new $i,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ji.setFromAxisAngle(e,t),this.quaternion.multiply(Ji),this}rotateOnWorldAxis(e,t){return Ji.setFromAxisAngle(e,t),this.quaternion.premultiply(Ji),this}rotateX(e){return this.rotateOnAxis(rr,e)}rotateY(e){return this.rotateOnAxis(or,e)}rotateZ(e){return this.rotateOnAxis(sr,e)}translateOnAxis(e,t){return Ki.copy(e).applyQuaternion(this.quaternion),this.position.add(Ki.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rr,e)}translateY(e){return this.translateOnAxis(or,e)}translateZ(e){return this.translateOnAxis(sr,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Zi.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?er.copy(e):er.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),tr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Zi.lookAt(tr,er,this.up):Zi.lookAt(er,tr,this.up),this.quaternion.setFromRotationMatrix(Zi),i&&(Zi.extractRotation(i.matrixWorld),Ji.setFromRotationMatrix(Zi),this.quaternion.premultiply(Ji.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ar),cr.child=e,this.dispatchEvent(cr),cr.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(lr),ur.child=e,this.dispatchEvent(ur),ur.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Zi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Zi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Zi),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ar),cr.child=e,this.dispatchEvent(cr),cr.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,e,nr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tr,ir,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}hr.DEFAULT_UP=new li(0,1,0),hr.DEFAULT_MATRIX_AUTO_UPDATE=!0,hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const dr=new li,pr=new li,fr=new li,mr=new li,gr=new li,vr=new li,yr=new li,Ar=new li,xr=new li,br=new li,_r=new ni,wr=new ni,Er=new ni;class Sr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new li;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),dr.subVectors(e,t),i.cross(dr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){dr.subVectors(i,t),pr.subVectors(n,t),fr.subVectors(e,t);const o=dr.dot(dr),s=dr.dot(pr),a=dr.dot(fr),l=pr.dot(pr),c=pr.dot(fr),u=o*l-s*s;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,mr)&&(mr.x>=0&&mr.y>=0&&mr.x+mr.y<=1)}static getInterpolation(e,t,n,i,r,o,s,a){return null===this.getBarycoord(e,t,n,i,mr)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(r,mr.x),a.addScaledVector(o,mr.y),a.addScaledVector(s,mr.z),a)}static getInterpolatedAttribute(e,t,n,i,r,o){return _r.setScalar(0),wr.setScalar(0),Er.setScalar(0),_r.fromBufferAttribute(e,t),wr.fromBufferAttribute(e,n),Er.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(_r,r.x),o.addScaledVector(wr,r.y),o.addScaledVector(Er,r.z),o}static isFrontFacing(e,t,n,i){return dr.subVectors(n,t),pr.subVectors(e,t),dr.cross(pr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return dr.subVectors(this.c,this.b),pr.subVectors(this.a,this.b),.5*dr.cross(pr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Sr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Sr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return Sr.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Sr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Sr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,s;gr.subVectors(i,n),vr.subVectors(r,n),Ar.subVectors(e,n);const a=gr.dot(Ar),l=vr.dot(Ar);if(a<=0&&l<=0)return t.copy(n);xr.subVectors(e,i);const c=gr.dot(xr),u=vr.dot(xr);if(c>=0&&u<=c)return t.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(gr,o);br.subVectors(e,r);const d=gr.dot(br),p=vr.dot(br);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(vr,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return yr.subVectors(r,i),s=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(yr,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(gr,o).addScaledVector(vr,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Cr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mr={h:0,s:0,l:0},Tr={h:0,s:0,l:0};function Rr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Ir{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ut;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Qn.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Qn.workingColorSpace;return this.r=e,this.g=t,this.b=n,Qn.toWorkingColorSpace(this,i),this}setHSL(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Qn.workingColorSpace;if(e=Sn(e,1),t=En(t,0,1),n=En(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Rr(r,i,e+1/3),this.g=Rr(r,i,e),this.b=Rr(r,i,e-1/3)}return Qn.toWorkingColorSpace(this,i),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ut;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=t[1],s=t[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=t[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ut;const n=Cr[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=qn(e.r),this.g=qn(e.g),this.b=qn(e.b),this}copyLinearToSRGB(e){return this.r=Xn(e.r),this.g=Xn(e.g),this.b=Xn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut;return Qn.fromWorkingColorSpace(Pr.copy(this),e),65536*Math.round(En(255*Pr.r,0,255))+256*Math.round(En(255*Pr.g,0,255))+Math.round(En(255*Pr.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qn.workingColorSpace;Qn.fromWorkingColorSpace(Pr.copy(this),t);const n=Pr.r,i=Pr.g,r=Pr.b,o=Math.max(n,i,r),s=Math.min(n,i,r);let a,l;const c=(s+o)/2;if(s===o)a=0,l=0;else{const e=o-s;switch(l=c<=.5?e/(o+s):e/(2-o-s),o){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qn.workingColorSpace;return Qn.fromWorkingColorSpace(Pr.copy(this),t),e.r=Pr.r,e.g=Pr.g,e.b=Pr.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut;Qn.fromWorkingColorSpace(Pr.copy(this),e);const t=Pr.r,n=Pr.g,i=Pr.b;return e!==Ut?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(Mr),this.setHSL(Mr.h+e,Mr.s+t,Mr.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Mr),e.getHSL(Tr);const n=Cn(Mr.h,Tr.h,t),i=Cn(Mr.s,Tr.s,t),r=Cn(Mr.l,Tr.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Pr=new Ir;Ir.NAMES=Cr;let Br=0;class Lr extends yn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Br++}),this.uuid=wn(),this.name="",this.type="Material",this.blending=v,this.side=p,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=P,this.blendDst=B,this.blendEquation=_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ir(0,0,0),this.blendAlpha=0,this.depthFunc=W,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gt,this.stencilZFail=Gt,this.stencilZPass=Gt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==v&&(n.blending=this.blending),this.side!==p&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==P&&(n.blendSrc=this.blendSrc),this.blendDst!==B&&(n.blendDst=this.blendDst),this.blendEquation!==_&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==W&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==rn&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Gt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Gt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Gt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Nr extends Lr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ir(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Dr=kr();function kr(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,o[l]=e|t}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:o,exponentTable:s,offsetTable:a}}function Or(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=En(e,-65504,65504),Dr.floatView[0]=e;const t=Dr.uint32View[0],n=t>>23&511;return Dr.baseTable[n]+((8388607&t)>>Dr.shiftTable[n])}function Ur(e){const t=e>>10;return Dr.uint32View[0]=Dr.mantissaTable[Dr.offsetTable[t]+(1023&e)]+Dr.exponentTable[t],Dr.floatView[0]}const Fr=new li,zr=new In;let jr=0;class Vr{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:jr++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=pn,this.updateRanges=[],this.gpuType=Ie,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)zr.fromBufferAttribute(this,t),zr.applyMatrix3(e),this.setXY(t,zr.x,zr.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Fr.fromBufferAttribute(this,t),Fr.applyMatrix3(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Fr.fromBufferAttribute(this,t),Fr.applyMatrix4(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Fr.fromBufferAttribute(this,t),Fr.applyNormalMatrix(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Fr.fromBufferAttribute(this,t),Fr.transformDirection(e),this.setXYZ(t,Fr.x,Fr.y,Fr.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Mn(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Tn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Mn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Mn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Mn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Mn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array),i=Tn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array),i=Tn(i,this.array),r=Tn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==pn&&(e.usage=this.usage),e}}class Gr extends Vr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Hr extends Vr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Wr extends Vr{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Ur(this.array[e*this.itemSize]);return this.normalized&&(t=Mn(t,this.array)),t}setX(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize]=Or(t),this}getY(e){let t=Ur(this.array[e*this.itemSize+1]);return this.normalized&&(t=Mn(t,this.array)),t}setY(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+1]=Or(t),this}getZ(e){let t=Ur(this.array[e*this.itemSize+2]);return this.normalized&&(t=Mn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+2]=Or(t),this}getW(e){let t=Ur(this.array[e*this.itemSize+3]);return this.normalized&&(t=Mn(t,this.array)),t}setW(e,t){return this.normalized&&(t=Tn(t,this.array)),this.array[e*this.itemSize+3]=Or(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array)),this.array[e+0]=Or(t),this.array[e+1]=Or(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array),i=Tn(i,this.array)),this.array[e+0]=Or(t),this.array[e+1]=Or(n),this.array[e+2]=Or(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array),i=Tn(i,this.array),r=Tn(r,this.array)),this.array[e+0]=Or(t),this.array[e+1]=Or(n),this.array[e+2]=Or(i),this.array[e+3]=Or(r),this}}class Qr extends Vr{constructor(e,t,n){super(new Float32Array(e),t,n)}}let qr=0;const Xr=new Ui,$r=new hr,Yr=new li,Kr=new hi,Jr=new hi,Zr=new li;class eo extends yn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qr++}),this.uuid=wn(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ln(e)?Hr:Gr)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Pn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Xr.makeRotationFromQuaternion(e),this.applyMatrix4(Xr),this}rotateX(e){return Xr.makeRotationX(e),this.applyMatrix4(Xr),this}rotateY(e){return Xr.makeRotationY(e),this.applyMatrix4(Xr),this}rotateZ(e){return Xr.makeRotationZ(e),this.applyMatrix4(Xr),this}translate(e,t,n){return Xr.makeTranslation(e,t,n),this.applyMatrix4(Xr),this}scale(e,t,n){return Xr.makeScale(e,t,n),this.applyMatrix4(Xr),this}lookAt(e){return $r.lookAt(e),$r.updateMatrix(),this.applyMatrix4($r.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Yr).negate(),this.translate(Yr.x,Yr.y,Yr.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new Qr(t,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const n=e[i];t.setXYZ(i,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new hi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new li(-1/0,-1/0,-1/0),new li(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];Kr.setFromBufferAttribute(e),this.morphTargetsRelative?(Zr.addVectors(this.boundingBox.min,Kr.min),this.boundingBox.expandByPoint(Zr),Zr.addVectors(this.boundingBox.max,Kr.max),this.boundingBox.expandByPoint(Zr)):(this.boundingBox.expandByPoint(Kr.min),this.boundingBox.expandByPoint(Kr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ri);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new li,1/0);if(e){const n=this.boundingSphere.center;if(Kr.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];Jr.setFromBufferAttribute(n),this.morphTargetsRelative?(Zr.addVectors(Kr.min,Jr.min),Kr.expandByPoint(Zr),Zr.addVectors(Kr.max,Jr.max),Kr.expandByPoint(Zr)):(Kr.expandByPoint(Jr.min),Kr.expandByPoint(Jr.max))}Kr.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)Zr.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Zr));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)Zr.fromBufferAttribute(o,t),s&&(Yr.fromBufferAttribute(e,t),Zr.add(Yr)),i=Math.max(i,n.distanceToSquared(Zr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Vr(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),s=[],a=[];for(let w=0;w<n.count;w++)s[w]=new li,a[w]=new li;const l=new li,c=new li,u=new li,h=new In,d=new In,p=new In,f=new li,m=new li;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const o=1/(d.x*p.y-p.x*d.y);isFinite(o)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(o),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(o),s[e].add(f),s[t].add(f),s[i].add(f),a[e].add(m),a[t].add(m),a[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let w=0,E=v.length;w<E;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const y=new li,A=new li,x=new li,b=new li;function _(e){x.fromBufferAttribute(i,e),b.copy(x);const t=s[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),A.crossVectors(b,t);const n=A.dot(a[e])<0?-1:1;o.setXYZW(e,y.x,y.y,y.z,n)}for(let w=0,E=v.length;w<E;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)_(e.getX(i+0)),_(e.getX(i+1)),_(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Vr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new li,r=new li,o=new li,s=new li,a=new li,l=new li,c=new li,u=new li;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Zr.fromBufferAttribute(e,t),Zr.normalize(),e.setXYZ(t,Zr.x,Zr.y,Zr.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new Vr(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new eo,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const e=o[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,c=o.length;l<c;l++){const e=o[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const to=new Ui,no=new Oi,io=new Ri,ro=new li,oo=new li,so=new li,ao=new li,lo=new li,co=new li,uo=new li,ho=new li;class po extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Nr;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){co.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],a=r[n];0!==i&&(lo.fromBufferAttribute(a,e),o?co.addScaledVector(lo,i):co.addScaledVector(lo.sub(t),i))}t.add(co)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),io.copy(n.boundingSphere),io.applyMatrix4(r),no.copy(e.ray).recast(e.near),!1===io.containsPoint(no.origin)){if(null===no.intersectSphere(io,ro))return;if(no.origin.distanceToSquared(ro)>(e.far-e.near)**2)return}to.copy(r).invert(),no.copy(e.ray).applyMatrix4(to),null!==n.boundingBox&&!1===no.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,no)}}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,s=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==s)if(Array.isArray(o))for(let p=0,f=h.length;p<f;p++){const r=h[p],a=o[r.materialIndex];for(let o=Math.max(r.start,d.start),h=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));o<h;o+=3){i=fo(this,a,e,n,l,c,u,s.getX(o),s.getX(o+1),s.getX(o+2)),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(s.count,d.start+d.count);r<a;r+=3){i=fo(this,o,e,n,l,c,u,s.getX(r),s.getX(r+1),s.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==a)if(Array.isArray(o))for(let p=0,f=h.length;p<f;p++){const r=h[p],s=o[r.materialIndex];for(let o=Math.max(r.start,d.start),h=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));o<h;o+=3){i=fo(this,s,e,n,l,c,u,o,o+1,o+2),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),s=Math.min(a.count,d.start+d.count);r<s;r+=3){i=fo(this,o,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function fo(e,t,n,i,r,o,s,a,l,c){e.getVertexPosition(a,oo),e.getVertexPosition(l,so),e.getVertexPosition(c,ao);const u=function(e,t,n,i,r,o,s,a){let l;if(l=t.side===f?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,t.side===p,a),null===l)return null;ho.copy(a),ho.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(ho);return c<n.near||c>n.far?null:{distance:c,point:ho.clone(),object:e}}(e,t,n,i,oo,so,ao,uo);if(u){const e=new li;Sr.getBarycoord(uo,oo,so,ao,e),r&&(u.uv=Sr.getInterpolatedAttribute(r,a,l,c,e,new In)),o&&(u.uv1=Sr.getInterpolatedAttribute(o,a,l,c,e,new In)),s&&(u.normal=Sr.getInterpolatedAttribute(s,a,l,c,e,new li),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a:a,b:l,c:c,normal:new li,materialIndex:0};Sr.getNormal(oo,so,ao,t.normal),u.face=t,u.barycoord=e}return u}class mo extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,o,p,f,m,g,v){const y=o/m,A=p/g,x=o/2,b=p/2,_=f/2,w=m+1,E=g+1;let S=0,C=0;const M=new li;for(let s=0;s<E;s++){const o=s*A-b;for(let a=0;a<w;a++){const h=a*y-x;M[e]=h*i,M[t]=o*r,M[n]=_,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/m),u.push(1-s/g),S+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){const t=h+e+w*s,n=h+e+w*(s+1),i=h+(e+1)+w*(s+1),r=h+(e+1)+w*s;a.push(t,n,r),a.push(n,i,r),C+=6}s.addGroup(d,C,v),d+=C,h+=S}p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,i,o,2),p("x","z","y",1,-1,e,n,-t,i,o,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new Qr(l,3)),this.setAttribute("normal",new Qr(c,3)),this.setAttribute("uv",new Qr(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function go(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function vo(e){const t={};for(let n=0;n<e.length;n++){const i=go(e[n]);for(const e in i)t[e]=i[e]}return t}function yo(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Qn.workingColorSpace}const Ao={clone:go,merge:vo};class xo extends Lr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=go(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class bo extends hr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ui,this.projectionMatrix=new Ui,this.projectionMatrixInverse=new Ui,this.coordinateSystem=gn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const _o=new li,wo=new In,Eo=new In;class So extends bo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*_n*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*bn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*_n*Math.atan(Math.tan(.5*bn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){_o.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(_o.x,_o.y).multiplyScalar(-e/_o.z),_o.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(_o.x,_o.y).multiplyScalar(-e/_o.z)}getViewSize(e,t){return this.getViewBounds(e,wo,Eo),t.subVectors(Eo,wo)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*bn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Co=-90;class Mo extends hr{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new So(Co,1,e,t);i.layers=this.layers,this.add(i);const r=new So(Co,1,e,t);r.layers=this.layers,this.add(r);const o=new So(Co,1,e,t);o.layers=this.layers,this.add(o);const s=new So(Co,1,e,t);s.layers=this.layers,this.add(s);const a=new So(Co,1,e,t);a.layers=this.layers,this.add(a);const l=new So(Co,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,s,a]=t;for(const l of t)this.remove(l);if(e===gn)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==vn)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,s,a,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,a),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class To extends ti{constructor(e,t,n,i,r,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ce,n,i,r,o,s,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ro extends ri{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new To(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:xe}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new mo(5,5,5),r=new xo({name:"CubemapFromEquirect",uniforms:go(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:f,blending:g});r.uniforms.tEquirect.value=t;const o=new po(i,r),s=t.minFilter;t.minFilter===_e&&(t.minFilter=xe);return new Mo(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}class Io extends hr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Po={type:"move"};class Bo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Io,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Io,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new li,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new li),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Io,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new li,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new li),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const o of e.hand.values()){const e=t.getJointPose(o,n),i=this._getHandJoint(l,o);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Po)))}return null!==s&&(s.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Io;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Lo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new Ir(e),this.density=t}clone(){return new Lo(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class No{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new Ir(e),this.near=t,this.far=n}clone(){return new No(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Do extends hr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Xi,this.environmentIntensity=1,this.environmentRotation=new Xi,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class ko{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=pn,this.updateRanges=[],this.version=0,this.uuid=wn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=wn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Oo=new li;class Uo{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Oo.fromBufferAttribute(this,t),Oo.applyMatrix4(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Oo.fromBufferAttribute(this,t),Oo.applyNormalMatrix(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Oo.fromBufferAttribute(this,t),Oo.transformDirection(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Mn(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Tn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Tn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Mn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Mn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Mn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Mn(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array),i=Tn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Tn(t,this.array),n=Tn(n,this.array),i=Tn(i,this.array),r=Tn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Vr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Uo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Fo extends Lr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ir(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let zo;const jo=new li,Vo=new li,Go=new li,Ho=new In,Wo=new In,Qo=new Ui,qo=new li,Xo=new li,$o=new li,Yo=new In,Ko=new In,Jo=new In;class Zo extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fo;if(super(),this.isSprite=!0,this.type="Sprite",void 0===zo){zo=new eo;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ko(e,5);zo.setIndex([0,1,2,0,2,3]),zo.setAttribute("position",new Uo(t,3,0,!1)),zo.setAttribute("uv",new Uo(t,2,3,!1))}this.geometry=zo,this.material=e,this.center=new In(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Vo.setFromMatrixScale(this.matrixWorld),Qo.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Go.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Vo.multiplyScalar(-Go.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;es(qo.set(-.5,-.5,0),Go,o,Vo,i,r),es(Xo.set(.5,-.5,0),Go,o,Vo,i,r),es($o.set(.5,.5,0),Go,o,Vo,i,r),Yo.set(0,0),Ko.set(1,0),Jo.set(1,1);let s=e.ray.intersectTriangle(qo,Xo,$o,!1,jo);if(null===s&&(es(Xo.set(-.5,.5,0),Go,o,Vo,i,r),Ko.set(0,1),s=e.ray.intersectTriangle(qo,$o,Xo,!1,jo),null===s))return;const a=e.ray.origin.distanceTo(jo);a<e.near||a>e.far||t.push({distance:a,point:jo.clone(),uv:Sr.getInterpolation(jo,qo,Xo,$o,Yo,Ko,Jo,new In),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function es(e,t,n,i,r,o){Ho.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(Wo.x=o*Ho.x-r*Ho.y,Wo.y=r*Ho.x+o*Ho.y):Wo.copy(Ho),e.copy(t),e.x+=Wo.x,e.y+=Wo.y,e.applyMatrix4(Qo)}const ts=new li,ns=new li;class is extends hr{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){ts.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(ts);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ts.setFromMatrixPosition(e.matrixWorld),ns.setFromMatrixPosition(this.matrixWorld);const n=ts.distanceTo(ns)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const rs=new li,os=new ni,ss=new ni,as=new li,ls=new Ui,cs=new li,us=new Ri,hs=new Ui,ds=new Oi;class ps extends po{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ae,this.bindMatrix=new Ui,this.bindMatrixInverse=new Ui,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new hi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,cs),this.boundingBox.expandByPoint(cs)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Ri),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,cs),this.boundingSphere.expandByPoint(cs)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),us.copy(this.boundingSphere),us.applyMatrix4(i),!1!==e.ray.intersectsSphere(us)&&(hs.copy(i).invert(),ds.copy(e.ray).applyMatrix4(hs),null!==this.boundingBox&&!1===ds.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,ds)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ni,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===ae?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;os.fromBufferAttribute(i.attributes.skinIndex,e),ss.fromBufferAttribute(i.attributes.skinWeight,e),rs.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=ss.getComponent(r);if(0!==e){const i=os.getComponent(r);ls.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(as.copy(rs).applyMatrix4(ls),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class fs extends hr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ms extends ti{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:ve,arguments.length>9&&void 0!==arguments[9]?arguments[9]:ve,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const gs=new Ui,vs=new Ui;class ys{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=wn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Ui;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:vs;gs.multiplyMatrices(i,t[r]),gs.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new ys(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ms(t,e,e,Ue,Ie);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new fs),this.bones.push(r),this.boneInverses.push((new Ui).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class As extends Vr{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const xs=new Ui,bs=new Ui,_s=[],ws=new hi,Es=new Ui,Ss=new po,Cs=new Ri;class Ms extends po{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new As(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Es)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new hi),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,xs),ws.copy(e.boundingBox).applyMatrix4(xs),this.boundingBox.union(ws)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Ri),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,xs),Cs.copy(e.boundingSphere).applyMatrix4(xs),this.boundingSphere.union(Cs)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let o=0;o<n.length;o++)n[o]=i[r+o]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Ss.geometry=this.geometry,Ss.material=this.material,void 0!==Ss.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Cs.copy(this.boundingSphere),Cs.applyMatrix4(n),!1!==e.ray.intersectsSphere(Cs)))for(let r=0;r<i;r++){this.getMatrixAt(r,xs),bs.multiplyMatrices(n,xs),Ss.matrixWorld=bs,Ss.raycast(e,_s);for(let e=0,n=_s.length;e<n;e++){const n=_s[e];n.instanceId=r,n.object=this,t.push(n)}_s.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new As(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new ms(new Float32Array(i*this.count),i,this.count,Ge,Ie));const r=this.morphTexture.source.data.data;let o=0;for(let l=0;l<n.length;l++)o+=n[l];const s=this.geometry.morphTargetsRelative?1:1-o,a=i*e;r[a]=s,r.set(n,a+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Ts=new li,Rs=new li,Is=new Pn;class Ps{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Ts.subVectors(n,t).cross(Rs.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Ts),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Is.getNormalMatrix(e),i=this.coplanarPoint(Ts).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Bs=new Ri,Ls=new li;class Ns{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ps,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ps,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ps,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Ps,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Ps,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Ps;this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gn;const n=this.planes,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],A=i[15];if(n[0].setComponents(a-r,h-l,m-d,A-g).normalize(),n[1].setComponents(a+r,h+l,m+d,A+g).normalize(),n[2].setComponents(a+o,h+c,m+p,A+v).normalize(),n[3].setComponents(a-o,h-c,m-p,A-v).normalize(),n[4].setComponents(a-s,h-u,m-f,A-y).normalize(),t===gn)n[5].setComponents(a+s,h+u,m+f,A+y).normalize();else{if(t!==vn)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Bs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Bs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Bs)}intersectsSprite(e){return Bs.center.set(0,0,0),Bs.radius=.7071067811865476,Bs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Bs)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Ls.x=i.normal.x>0?e.max.x:e.min.x,Ls.y=i.normal.y>0?e.max.y:e.min.y,Ls.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ls)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ds(e,t){return e-t}function ks(e,t){return e.z-t.z}function Os(e,t){return t.z-e.z}class Us{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const r=this.pool,o=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const s=r[this.index];o.push(s),this.index++,s.start=e,s.count=t,s.z=n,s.index=i}reset(){this.list.length=0,this.index=0}}const Fs=new Ui,zs=new Ir(1,1,1),js=new Ns,Vs=new hi,Gs=new Ri,Hs=new li,Ws=new li,Qs=new li,qs=new Us,Xs=new po,$s=[];function Ys(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const r=e.count;for(let o=0;o<r;o++)for(let r=0;r<i;r++)t.setComponent(o+n,r,e.getComponent(o,r))}else t.array.set(e.array,n*i);t.needsUpdate=!0}function Ks(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++)t[i]=e[i]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class Js extends po{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t,i=arguments.length>3?arguments[3]:void 0;super(new eo,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new ms(t,e,e,Ue,Ie);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new ms(t,e,e,He,Re);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new ms(t,e,e,Ue,Ie);n.colorSpace=Qn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in e.attributes){const r=e.getAttribute(i),{array:o,itemSize:s,normalized:a}=r,l=new o.constructor(n*s),c=new Vr(l,s,a);t.setAttribute(i,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new Vr(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),r=t.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new hi);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,Fs),this.getBoundingBoxAt(i,Vs).applyMatrix4(Fs),e.union(Vs)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ri);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,Fs),this.getBoundingSphereAt(i,Gs).applyMatrix4(Fs),e.union(Gs)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Ds),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const i=this._matricesTexture;Fs.identity().toArray(i.image.data,16*n),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(zs.toArray(r.image.data,4*n),r.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const o=e.getIndex();if(null!==o&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===n?o.count:n),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let s;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Ds),s=this._availableGeometryIds.shift(),r[s]=i):(s=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(s,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,s}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),o=t.getIndex(),s=this._geometryInfo[e];if(i&&o.count>s.reservedIndexCount||t.attributes.position.count>s.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=s.vertexStart,l=s.reservedVertexCount;s.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),i=n.getAttribute(c);Ys(e,i,a);const r=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=a+t;for(let t=0;t<r;t++)i.setComponent(e,t,0)}i.needsUpdate=!0,i.addUpdateRange(a*r,l*r)}if(i){const e=s.indexStart,n=s.reservedIndexCount;s.indexCount=t.getIndex().count;for(let t=0;t<o.count;t++)r.setX(e+t,a+o.getX(t));for(let t=o.count,i=n;t<i;t++)r.setX(e+t,a);r.needsUpdate=!0,r.addUpdateRange(e,s.reservedIndexCount)}return s.start=i?s.indexStart:s.vertexStart,s.count=i?s.indexCount:s.vertexCount,s.boundingBox=null,null!==t.boundingBox&&(s.boundingBox=t.boundingBox.clone()),s.boundingSphere=null,null!==t.boundingSphere&&(s.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map(((e,t)=>t)).sort(((e,t)=>n[e].vertexStart-n[t].vertexStart)),r=this.geometry;for(let o=0,s=n.length;o<s;o++){const s=i[o],a=n[s];if(!1!==a.active){if(null!==r.index){if(a.indexStart!==t){const{indexStart:n,vertexStart:i,reservedIndexCount:o}=a,s=r.index,l=s.array,c=e-i;for(let e=n;e<n+o;e++)l[e]=l[e]+c;s.array.copyWithin(t,n,n+o),s.addUpdateRange(t,o),a.indexStart=t}t+=a.reservedIndexCount}if(a.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=a,i=r.attributes;for(const r in i){const o=i[r],{array:s,itemSize:a}=o;s.copyWithin(e*a,t*a,(t+n)*a),o.addUpdateRange(e*a,n*a)}a.vertexStart=e}e+=a.reservedVertexCount,a.start=r.index?a.indexStart:a.vertexStart,this._nextIndexStart=r.index?a.indexStart+a.reservedIndexCount:0,this._nextVertexStart=a.vertexStart+a.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingBox){const e=new hi,t=n.index,r=n.attributes.position;for(let n=i.start,o=i.start+i.count;n<o;n++){let i=n;t&&(i=t.getX(i)),e.expandByPoint(Hs.fromBufferAttribute(r,i))}i.boundingBox=e}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingSphere){const t=new Ri;this.getBoundingBoxAt(e,Vs),Vs.getCenter(t.center);const r=n.index,o=n.attributes.position;let s=0;for(let e=i.start,n=i.start+i.count;e<n;e++){let n=e;r&&(n=r.getX(n)),Hs.fromBufferAttribute(o,n),s=Math.max(s,t.center.distanceToSquared(Hs))}t.radius=Math.sqrt(s),i.boundingSphere=t}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(Ds);t[t.length-1]===n.length;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),r=new Int32Array(e);Ks(this._multiDrawCounts,i),Ks(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=e;const o=this._indirectTexture,s=this._matricesTexture,a=this._colorsTexture;o.dispose(),this._initIndirectTexture(),Ks(o.image.data,this._indirectTexture.image.data),s.dispose(),this._initMatricesTexture(),Ks(s.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),Ks(a.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter((e=>e.active));if(Math.max(...n.map((e=>e.vertexStart+e.reservedVertexCount)))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index){if(Math.max(...n.map((e=>e.indexStart+e.reservedIndexCount)))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`)}const i=this.geometry;i.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new eo,this._initializeGeometry(i));const r=this.geometry;i.index&&Ks(i.index.array,r.index.array);for(const o in i.attributes)Ks(i.attributes[o].array,r.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,o=this.geometry;Xs.material=this.material,Xs.geometry.index=o.index,Xs.geometry.attributes=o.attributes,null===Xs.geometry.boundingBox&&(Xs.geometry.boundingBox=new hi),null===Xs.geometry.boundingSphere&&(Xs.geometry.boundingSphere=new Ri);for(let s=0,a=n.length;s<a;s++){if(!n[s].visible||!n[s].active)continue;const o=n[s].geometryIndex,a=i[o];Xs.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(s,Xs.matrixWorld).premultiply(r),this.getBoundingBoxAt(o,Xs.geometry.boundingBox),this.getBoundingSphereAt(o,Xs.geometry.boundingSphere),Xs.raycast(e,$s);for(let e=0,n=$s.length;e<n;e++){const n=$s[e];n.object=this,n.batchId=s,t.push(n)}$s.length=0}Xs.material=null,Xs.geometry.index=null,Xs.geometry.attributes={},Xs.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map((e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null}))),this._instanceInfo=e._instanceInfo.map((e=>({...e}))),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=i.getIndex(),s=null===o?1:o.array.BYTES_PER_ELEMENT,a=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data;h&&(Fs.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),js.setFromProjectionMatrix(Fs,e.coordinateSystem));let f=0;if(this.sortObjects){Fs.copy(this.matrixWorld).invert(),Hs.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Fs),Ws.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Fs);for(let n=0,i=a.length;n<i;n++)if(a[n].visible&&a[n].active){const e=a[n].geometryIndex;this.getMatrixAt(n,Fs),this.getBoundingSphereAt(e,Gs).applyMatrix4(Fs);let t=!1;if(h&&(t=!js.intersectsSphere(Gs)),!t){const t=u[e],i=Qs.subVectors(Gs.center,Hs).dot(Ws);qs.push(t.start,t.count,i,n)}}const e=qs.list,t=this.customSort;null===t?e.sort(r.transparent?Os:ks):t.call(this,e,n);for(let n=0,i=e.length;n<i;n++){const t=e[n];l[f]=t.start*s,c[f]=t.count,p[f]=t.index,f++}qs.reset()}else for(let m=0,g=a.length;m<g;m++)if(a[m].visible&&a[m].active){const e=a[m].geometryIndex;let t=!1;if(h&&(this.getMatrixAt(m,Fs),this.getBoundingSphereAt(e,Gs).applyMatrix4(Fs),t=!js.intersectsSphere(Gs)),!t){const t=u[e];l[f]=t.start*s,c[f]=t.count,p[f]=m,f++}}d.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,r,o){this.onBeforeRender(e,null,i,r,o)}}class Zs extends Lr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ir(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ea=new li,ta=new li,na=new Ui,ia=new Oi,ra=new Ri,oa=new li,sa=new li;class aa extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Zs;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)ea.fromBufferAttribute(t,e-1),ta.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=ea.distanceTo(ta);e.setAttribute("lineDistance",new Qr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ra.copy(n.boundingSphere),ra.applyMatrix4(i),ra.radius+=r,!1===e.ray.intersectsSphere(ra))return;na.copy(i).invert(),ia.copy(e.ray).applyMatrix4(na);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,o.start),i=Math.min(c.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=c.getX(r),i=c.getX(r+1),o=la(this,e,ia,a,n,i,r);o&&t.push(o)}if(this.isLineLoop){const r=c.getX(i-1),o=c.getX(n),s=la(this,e,ia,a,r,o,i-1);s&&t.push(s)}}else{const n=Math.max(0,o.start),i=Math.min(u.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=la(this,e,ia,a,r,r+1,r);n&&t.push(n)}if(this.isLineLoop){const r=la(this,e,ia,a,i-1,n,i-1);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function la(e,t,n,i,r,o,s){const a=e.geometry.attributes.position;ea.fromBufferAttribute(a,r),ta.fromBufferAttribute(a,o);if(n.distanceSqToSegment(ea,ta,oa,sa)>i)return;oa.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(oa);return l<t.near||l>t.far?void 0:{distance:l,point:sa.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:e}}const ca=new li,ua=new li;class ha extends aa{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)ca.fromBufferAttribute(t,e),ua.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+ca.distanceTo(ua);e.setAttribute("lineDistance",new Qr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class da extends aa{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class pa extends Lr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ir(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const fa=new Ui,ma=new Oi,ga=new Ri,va=new li;class ya extends hr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new eo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pa;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ga.copy(n.boundingSphere),ga.applyMatrix4(i),ga.radius+=r,!1===e.ray.intersectsSphere(ga))return;fa.copy(i).invert(),ma.copy(e.ray).applyMatrix4(fa);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,o.start),r=Math.min(l.count,o.start+o.count);n<r;n++){const r=l.getX(n);va.fromBufferAttribute(c,r),Aa(va,r,a,i,e,t,this)}}else{for(let n=Math.max(0,o.start),r=Math.min(c.count,o.start+o.count);n<r;n++)va.fromBufferAttribute(c,n),Aa(va,n,a,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Aa(e,t,n,i,r,o,s){const a=ma.distanceSqToPoint(e);if(a<n){const n=new li;ma.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:s})}}class xa extends ti{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=ve,this.minFilter=ve,this.generateMipmaps=!1,this.needsUpdate=!0}}class ba extends ti{constructor(e,t,n,i,r,o,s,a,l){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:je;if(c!==je&&c!==Ve)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===je&&(n=Re),void 0===n&&c===Ve&&(n=Ne),super(null,i,r,o,s,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:ve,this.minFilter=void 0!==a?a:ve,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Jn(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class _a{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let s,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),s=n[i]-o,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const c=n[i];return(i+(o-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new In:new li);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new li,i=[],r=[],o=[],s=new li,a=new Ui;for(let d=0;d<=e;d++){const t=d/e;i[d]=this.getTangentAt(t,new li)}r[0]=new li,o[0]=new li;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),s.crossVectors(i[d-1],i[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(En(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(s,e))}o[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(En(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class wa extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const r=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);const o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),a=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,i=a-this.aY;s=n*e-i*t+this.aX,a=n*t+i*e+this.aY}return t.set(s,a)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function Ea(){let e=0,t=0,n=0,i=0;function r(r,o,s,a){e=r,t=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(i-t)/(s+a)+(i-n)/a;l*=s,c*=s,r(t,n,l,c)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}const Sa=new li,Ca=new Ea,Ma=new Ea,Ta=new Ea;function Ra(e,t,n,i,r){const o=.5*(i-t),s=.5*(r-n),a=e*e;return(2*n-2*i+o+s)*(e*a)+(-3*n+3*i-2*o-s)*a+o*e+n}function Ia(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Pa(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class Ba extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new In,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new In,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new In;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In,n=this.v0,i=this.v1,r=this.v2,o=this.v3;return t.set(Pa(e,n.x,i.x,r.x,o.x),Pa(e,n.y,i.y,r.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class La extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new li,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new li;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li,n=this.v0,i=this.v1,r=this.v2,o=this.v3;return t.set(Pa(e,n.x,i.x,r.x,o.x),Pa(e,n.y,i.y,r.y,o.y),Pa(e,n.z,i.z,r.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Na extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new In,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Da extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new In,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new In;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In,n=this.v0,i=this.v1,r=this.v2;return t.set(Ia(e,n.x,i.x,r.x),Ia(e,n.y,i.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ka extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new li;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li,n=this.v0,i=this.v1,r=this.v2;return t.set(Ia(e,n.x,i.x,r.x),Ia(e,n.y,i.y,r.y),Ia(e,n.z,i.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Oa extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new In,n=this.points,i=(n.length-1)*e,r=Math.floor(i),o=i-r,s=n[0===r?r:r-1],a=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return t.set(Ra(o,s.x,a.x,l.x,c.x),Ra(o,s.y,a.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new In).fromArray(n))}return this}}var Ua=Object.freeze({__proto__:null,ArcCurve:class extends wa{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li,n=this.points,i=n.length,r=(i-(this.closed?0:1))*e;let o,s,a=Math.floor(r),l=r-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/i)+1)*i:0===l&&a===i-1&&(a=i-2,l=1),this.closed||a>0?o=n[(a-1)%i]:(Sa.subVectors(n[0],n[1]).add(n[0]),o=Sa);const c=n[a%i],u=n[(a+1)%i];if(this.closed||a+2<i?s=n[(a+2)%i]:(Sa.subVectors(n[i-1],n[i-2]).add(n[i-1]),s=Sa),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Ca.initNonuniformCatmullRom(o.x,c.x,u.x,s.x,t,n,i),Ma.initNonuniformCatmullRom(o.y,c.y,u.y,s.y,t,n,i),Ta.initNonuniformCatmullRom(o.z,c.z,u.z,s.z,t,n,i)}else"catmullrom"===this.curveType&&(Ca.initCatmullRom(o.x,c.x,u.x,s.x,this.tension),Ma.initCatmullRom(o.y,c.y,u.y,s.y,this.tension),Ta.initCatmullRom(o.z,c.z,u.z,s.z,this.tension));return t.set(Ca.calc(l),Ma.calc(l),Ta.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new li).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:Ba,CubicBezierCurve3:La,EllipseCurve:wa,LineCurve:Na,LineCurve3:class extends _a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new li).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:Da,QuadraticBezierCurve3:ka,SplineCurve:Oa});class Fa extends _a{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ua[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,o=this.curves[r],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Ua[n.type]).fromJSON(n))}return this}}class za extends Fa{constructor(e){super(),this.type="Path",this.currentPoint=new In,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Na(this.currentPoint.clone(),new In(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new Da(this.currentPoint.clone(),new In(e,t),new In(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const s=new Ba(this.currentPoint.clone(),new In(e,t),new In(n,i),new In(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Oa(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,o,s,a),this}absellipse(e,t,n,i,r,o,s,a){const l=new wa(e,t,n,i,r,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ja extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new In(0,-.5),new In(.5,0),new In(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=En(i,0,2*Math.PI);const r=[],o=[],s=[],a=[],l=[],c=1/t,u=new li,h=new In,d=new li,p=new li,f=new li;let m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){const r=n+v*c*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*d,u.y=e[n].y,u.z=e[n].x*p,o.push(u.x,u.y,u.z),h.x=v/t,h.y=n/(e.length-1),s.push(h.x,h.y);const i=a[3*n+0]*d,r=a[3*n+1],c=a[3*n+0]*p;l.push(i,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){const n=t+v*e.length,i=n,o=n+e.length,s=n+e.length+1,a=n+1;r.push(i,o,a),r.push(s,a,o)}this.setIndex(r),this.setAttribute("position",new Qr(o,3)),this.setAttribute("uv",new Qr(s,2)),this.setAttribute("normal",new Qr(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ja(e.points,e.segments,e.phiStart,e.phiLength)}}class Va extends ja{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;const r=new za;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new Va(e.radius,e.length,e.capSegments,e.radialSegments)}}class Ga extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],s=[],a=[],l=new li,c=new In;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const r=n+u/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[h]/e+1)/2,c.y=(o[h+1]/e+1)/2,a.push(c.x,c.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new Qr(o,3)),this.setAttribute("normal",new Qr(s,3)),this.setAttribute("uv",new Qr(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ga(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ha extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,o=new In,f=new li;let v=0;const y=!0===n?e:t,A=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*A,0),h.push(0,A,0),d.push(.5,.5),p++;const x=p;for(let e=0;e<=i;e++){const t=e/i*a+s,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*A,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,A,0),o.x=.5*n+.5,o.y=.5*r*A+.5,d.push(o.x,o.y),p++}for(let e=0;e<i;e++){const t=r+e,i=x+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new li,v=new li;let y=0;const A=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(l,A,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let n=0;n<i;n++)for(let i=0;i<r;i++){const o=f[i][n],s=f[i+1][n],a=f[i+1][n+1],l=f[i][n+1];(e>0||0!==i)&&(c.push(o,s,l),y+=3),(t>0||i!==r-1)&&(c.push(s,a,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Qr(u,3)),this.setAttribute("normal",new Qr(h,3)),this.setAttribute("uv",new Qr(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ha(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Wa extends Ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}static fromJSON(e){return new Wa(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Qa extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];function s(e,t,n,i){const r=i+1,o=[];for(let s=0;s<=r;s++){o[s]=[];const i=e.clone().lerp(n,s/r),a=t.clone().lerp(n,s/r),l=r-s;for(let e=0;e<=l;e++)o[s][e]=0===e&&s===r?i:i.clone().lerp(a,e/l)}for(let s=0;s<r;s++)for(let e=0;e<2*(r-s)-1;e++){const t=Math.floor(e/2);e%2===0?(a(o[s][t+1]),a(o[s+1][t]),a(o[s][t])):(a(o[s][t+1]),a(o[s+1][t+1]),a(o[s+1][t]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new li,i=new li,r=new li;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],i),l(t[o+2],r),s(n,i,r,e)}(i),function(e){const t=new li;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new li;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(i,1-s)}var t;(function(){const e=new li,t=new li,n=new li,i=new li,s=new In,a=new In,l=new In;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],i=o[e+4],r=Math.max(t,n,i),s=Math.min(t,n,i);r>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),i<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new Qr(r,3)),this.setAttribute("normal",new Qr(r.slice(),3)),this.setAttribute("uv",new Qr(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qa(e.vertices,e.indices,e.radius,e.details)}}class qa extends Qa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qa(e.radius,e.detail)}}const Xa=new li,$a=new li,Ya=new li,Ka=new Sr;class Ja extends za{constructor(e){super(e),this.uuid=wn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new za).fromJSON(n))}return this}}class Za{static triangulate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=el(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(i&&(o=function(e,t,n,i){const r=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*i,l=o<s-1?t[o+1]*i:e.length,c=el(e,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(hl(c));for(r.sort(al),o=0;o<r.length;o++)n=ll(r[o],n);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return nl(o,s,n,a,l,p,0),s}}function el(e,t,n,i,r){let o,s;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)s=bl(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=bl(o,e[o],e[o+1],s);return s&&ml(s,s.next)&&(_l(s),s=s.next),s}function tl(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!ml(i,i.next)&&0!==fl(i.prev,i,i.next))i=i.next;else{if(_l(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function nl(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=ul(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?rl(e,i,r,o):il(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),_l(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?nl(e=ol(tl(e),t,n),t,n,i,r,o,2):2===s&&sl(e,t,n,i,r,o):nl(tl(e),t,n,i,r,o,1);break}}function il(e){const t=e.prev,n=e,i=e.next;if(fl(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&dl(r,a,o,l,s,c,f.x,f.y)&&fl(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function rl(e,t,n,i){const r=e.prev,o=e,s=e.next;if(fl(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=ul(p,f,t,n,i),y=ul(m,g,t,n,i);let A=e.prevZ,x=e.nextZ;for(;A&&A.z>=v&&x&&x.z<=y;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==s&&dl(a,u,l,h,c,d,A.x,A.y)&&fl(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&dl(a,u,l,h,c,d,x.x,x.y)&&fl(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;A&&A.z>=v;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==s&&dl(a,u,l,h,c,d,A.x,A.y)&&fl(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&dl(a,u,l,h,c,d,x.x,x.y)&&fl(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function ol(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!ml(r,o)&&gl(r,i,i.next,o)&&Al(r,o)&&Al(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),_l(i),_l(i.next),i=e=o),i=i.next}while(i!==e);return tl(i)}function sl(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&pl(s,e)){let a=xl(s,e);return s=tl(s,s.next),a=tl(a,a.next),nl(s,t,n,i,r,o,0),void nl(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function al(e,t){return e.x-t.x}function ll(e,t){const n=function(e,t){let n,i=t,r=-1/0;const o=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=o&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===o))return n}i=i.next}while(i!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,h=1/0;i=n;do{o>=i.x&&i.x>=l&&o!==i.x&&dl(s<c?o:r,s,l,c,s<c?r:o,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(o-i.x),Al(i,e)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&cl(n,i)))&&(n=i,h=u)),i=i.next}while(i!==a);return n}(e,t);if(!n)return t;const i=xl(n,e);return tl(i,i.next),tl(n,n.next)}function cl(e,t){return fl(e.prev,e,t.prev)<0&&fl(t.next,e,e.next)<0}function ul(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hl(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function dl(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function pl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&gl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Al(e,t)&&Al(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(fl(e.prev,e,t.prev)||fl(e,t.prev,t))||ml(e,t)&&fl(e.prev,e,e.next)>0&&fl(t.prev,t,t.next)>0)}function fl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ml(e,t){return e.x===t.x&&e.y===t.y}function gl(e,t,n,i){const r=yl(fl(e,t,n)),o=yl(fl(e,t,i)),s=yl(fl(n,i,e)),a=yl(fl(n,i,t));return r!==o&&s!==a||(!(0!==r||!vl(e,n,t))||(!(0!==o||!vl(e,i,t))||(!(0!==s||!vl(n,e,i))||!(0!==a||!vl(n,t,i)))))}function vl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function yl(e){return e>0?1:e<0?-1:0}function Al(e,t){return fl(e.prev,e,e.next)<0?fl(e,t,e.next)>=0&&fl(e,e.prev,t)>=0:fl(e,t,e.prev)<0||fl(e,e.next,t)<0}function xl(e,t){const n=new wl(e.i,e.x,e.y),i=new wl(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function bl(e,t,n,i){const r=new wl(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function _l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class El{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return El.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Sl(e),Cl(n,e);let o=e.length;t.forEach(Sl);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,Cl(n,t[a]);const s=Za.triangulate(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}}function Sl(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Cl(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Ml extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ja([new In(.5,.5),new In(-.5,.5),new In(-.5,-.5),new In(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++){o(e[s])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Tl;let g,v,y,A,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new li,A=new li,x=new li),c||(p=0,u=0,h=0,d=0);const _=e.extractPoints(s);let w=_.shape;const E=_.holes;if(!El.isClockWise(w)){w=w.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];El.isClockWise(t)&&(E[e]=t.reverse())}}const S=El.triangulateShape(w,E),C=w;for(let t=0,n=E.length;t<n;t++){const e=E[t];w=w.concat(e)}function M(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const T=w.length,R=S.length;function I(e,t,n){let i,r,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);i=p+s*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new In(i,r);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,r=s,o=Math.sqrt(u)):(i=s,r=a,o=Math.sqrt(u/2))}return new In(i/o,r/o)}const P=[];for(let t=0,n=C.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),P[t]=I(C[t],C[i],C[r]);const B=[];let L,N=P.concat();for(let t=0,n=E.length;t<n;t++){const e=E[t];L=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[t]=I(e[t],e[i],e[r]);B.push(L),N=N.concat(L)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=C.length;t<r;t++){const e=M(C[t],P[t],i);O(e.x,e.y,-n)}for(let t=0,r=E.length;t<r;t++){const e=E[t];L=B[t];for(let t=0,r=e.length;t<r;t++){const r=M(e[t],L[t],i);O(r.x,r.y,-n)}}}const D=h+d;for(let t=0;t<T;t++){const e=c?M(w[t],N[t],D):w[t];b?(A.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(A).add(y),O(x.x,x.y,x.z)):O(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<T;e++){const n=c?M(w[e],N[e],D):w[e];b?(A.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(A).add(y),O(x.x,x.y,x.z)):O(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=C.length;t<r;t++){const e=M(C[t],P[t],i);O(e.x,e.y,l+n)}for(let t=0,r=E.length;t<r;t++){const e=E[t];L=B[t];for(let t=0,r=e.length;t<r;t++){const r=M(e[t],L[t],i);b?O(r.x,r.y+g[a-1].y,g[a-1].x+n):O(r.x,r.y,l+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=T*e,o=T*(e+1);F(t+i+n,t+r+n,t+r+o,t+i+o)}}}function O(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,r){z(e),z(t),z(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);j(s[0]),j(s[1]),j(s[2])}function F(e,t,r,o){z(e),z(t),z(o),z(t),z(r),z(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);j(a[0]),j(a[1]),j(a[3]),j(a[1]),j(a[2]),j(a[3])}function z(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function j(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=T*e;for(let n=0;n<R;n++){const e=S[n];U(e[2]+t,e[1]+t,e[0]+t)}e=a+2*p,t=T*e;for(let n=0;n<R;n++){const e=S[n];U(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<R;e++){const t=S[e];U(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=S[e];U(t[0]+T*a,t[1]+T*a,t[2]+T*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;k(C,t),t+=C.length;for(let n=0,i=E.length;n<i;n++){const e=E[n];k(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Qr(i,3)),this.setAttribute("uv",new Qr(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Ua[i.type]).fromJSON(i)),new Ml(n,e.options)}}const Tl={generateTopUV:function(e,t,n,i,r){const o=t[3*n],s=t[3*n+1],a=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new In(o,s),new In(a,l),new In(c,u)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new In(s,1-l),new In(c,1-h),new In(d,1-f),new In(m,1-v)]:[new In(a,1-l),new In(u,1-h),new In(p,1-f),new In(g,1-v)]}};class Rl extends Qa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Rl(e.radius,e.detail)}}class Il extends Qa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Il(e.radius,e.detail)}}class Pl extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,s=Math.floor(n),a=Math.floor(i),l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*h-o;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new Qr(p,3)),this.setAttribute("normal",new Qr(f,3)),this.setAttribute("uv",new Qr(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pl(e.width,e.height,e.widthSegments,e.heightSegments)}}class Bl extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const s=[],a=[],l=[],c=[];let u=e;const h=(t-e)/i,d=new li,p=new In;for(let f=0;f<=i;f++){for(let e=0;e<=n;e++){const i=r+e/n*o;d.x=u*Math.cos(i),d.y=u*Math.sin(i),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let f=0;f<i;f++){const e=f*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,o=i+n+1,a=i+n+2,l=i+1;s.push(r,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute("position",new Qr(a,3)),this.setAttribute("normal",new Qr(l,3)),this.setAttribute("uv",new Qr(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bl(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ll extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ja([new In(0,.5),new In(-.5,-.5),new In(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(s,a,c),s+=a,a=0;function l(e){const s=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===El.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===El.isClockWise(e)&&(u[t]=e.reverse())}const h=El.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,i=h.length;t<i;t++){const e=h[t],i=e[0]+s,r=e[1]+s,o=e[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute("position",new Qr(i,3)),this.setAttribute("normal",new Qr(r,3)),this.setAttribute("uv",new Qr(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new Ll(n,e.curveSegments)}}class Nl extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new li,h=new li,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0===g&&0===o?y=.5/t:g===n&&a===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(i+a*r)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],s=c[g+1][e+1];(0!==g||o>0)&&d.push(t,i,s),(g!==n-1||a<Math.PI)&&d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Qr(p,3)),this.setAttribute("normal",new Qr(f,3)),this.setAttribute("uv",new Qr(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Nl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Dl extends Qa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Dl(e.radius,e.detail)}}class kl extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],a=[],l=[],c=new li,u=new li,h=new li;for(let d=0;d<=n;d++)for(let o=0;o<=i;o++){const p=o/i*r,f=d/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(o/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=i;e++){const t=(i+1)*d+e-1,n=(i+1)*(d-1)+e-1,r=(i+1)*(d-1)+e,s=(i+1)*d+e;o.push(t,n,s),o.push(n,r,s)}this.setIndex(o),this.setAttribute("position",new Qr(s,3)),this.setAttribute("normal",new Qr(a,3)),this.setAttribute("uv",new Qr(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kl(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ol extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],l=[],c=[],u=new li,h=new li,d=new li,p=new li,f=new li,m=new li,g=new li;for(let y=0;y<=n;++y){const s=y/n*r*Math.PI*2;v(s,r,o,e,d),v(s+.01,r,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,o=-t*Math.cos(r),s=t*Math.sin(r);u.x=d.x+(o*g.x+s*f.x),u.y=d.y+(o*g.y+s*f.y),u.z=d.z+(o*g.z+s*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/n),c.push(e/i)}}for(let y=1;y<=n;y++)for(let e=1;e<=i;e++){const t=(i+1)*(y-1)+(e-1),n=(i+1)*y+(e-1),r=(i+1)*y+e,o=(i+1)*(y-1)+e;s.push(t,n,o),s.push(n,r,o)}function v(e,t,n,i,r){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new Qr(a,3)),this.setAttribute("normal",new Qr(l,3)),this.setAttribute("uv",new Qr(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ol(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ul extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ka(new li(-1,-1,0),new li(-1,1,0),new li(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new li,a=new li,l=new In;let c=new li;const u=[],h=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=o.normals[r],d=o.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+r*d.x,a.y=o*l.y+r*d.y,a.z=o*l.z+r*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),o=(i+1)*e+t,s=(i+1)*(e-1)+t;p.push(n,r,s),p.push(r,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new Qr(u,3)),this.setAttribute("normal",new Qr(h,3)),this.setAttribute("uv",new Qr(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ul((new Ua[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}function Fl(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var zl=Object.freeze({__proto__:null,BoxGeometry:mo,CapsuleGeometry:Va,CircleGeometry:Ga,ConeGeometry:Wa,CylinderGeometry:Ha,DodecahedronGeometry:qa,EdgesGeometry:class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(bn*t),o=e.getIndex(),s=e.getAttribute("position"),a=o?o.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<a;e+=3){o?(l[0]=o.getX(e),l[1]=o.getX(e+1),l[2]=o.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:a}=Ka;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),a.fromBufferAttribute(s,l[2]),Ka.getNormal(Ya),u[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,u[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],i=u[t],o=Ka[c[e]],s=Ka[c[t]],a=`${n}_${i}`,p=`${i}_${n}`;p in h&&h[p]?(Ya.dot(h[p].normal)<=r&&(d.push(o.x,o.y,o.z),d.push(s.x,s.y,s.z)),h[p]=null):a in h||(h[a]={index0:l[e],index1:l[t],normal:Ya.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];Xa.fromBufferAttribute(s,t),$a.fromBufferAttribute(s,n),d.push(Xa.x,Xa.y,Xa.z),d.push($a.x,$a.y,$a.z)}this.setAttribute("position",new Qr(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}},ExtrudeGeometry:Ml,IcosahedronGeometry:Rl,LatheGeometry:ja,OctahedronGeometry:Il,PlaneGeometry:Pl,PolyhedronGeometry:Qa,RingGeometry:Bl,ShapeGeometry:Ll,SphereGeometry:Nl,TetrahedronGeometry:Dl,TorusGeometry:kl,TorusKnotGeometry:Ol,TubeGeometry:Ul,WireframeGeometry:class extends eo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new li,r=new li;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let l=0;l<3;l++){const a=s.getX(e+l),c=s.getX(e+(l+1)%3);i.fromBufferAttribute(o,a),r.fromBufferAttribute(o,c),!0===Fl(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let e=0,s=o.count/3;e<s;e++)for(let a=0;a<3;a++){const s=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(o,s),r.fromBufferAttribute(o,l),!0===Fl(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new Qr(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}});class jl extends Lr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ir(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Vl extends xo{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Gl extends Lr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Ir(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Hl extends Gl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new In(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return En(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ir(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ir(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ir(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Wl extends Lr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ir(16777215),this.specular=new Ir(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ql extends Lr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ir(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class ql extends Lr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Xl extends Lr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ir(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ir(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xi,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $l extends Lr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Yl extends Lr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class Kl extends Lr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ir(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Dt,this.normalScale=new In(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Jl extends Zs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Zl(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function ec(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function tc(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function nc(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r}function ic(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push(...s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)}class rc{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class oc extends rc{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:It,endingEnd:It}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case Pt:r=e,s=2*t-n;break;case Bt:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case Pt:o=e,a=2*n-t;break;case Bt:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,A=d*m-d*f;for(let x=0;x!==s;++x)r[x]=g*o[c+x]+v*o[l+x]+y*o[a+x]+A*o[u+x];return r}}class sc extends rc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(i-t),u=1-c;for(let h=0;h!==s;++h)r[h]=o[l+h]*u+o[a+h]*c;return r}}class ac extends rc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class lc{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Zl(t,this.TimeBufferType),this.values=Zl(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Zl(e.times,Array),values:Zl(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new ac(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new sc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new oc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Mt:t=this.InterpolantFactoryMethodDiscrete;break;case Tt:t=this.InterpolantFactoryMethodLinear;break;case Rt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mt;case this.InterpolantFactoryMethodLinear:return Tt;case this.InterpolantFactoryMethodSmooth:return Rt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=n.slice(r,o),this.values=this.values.slice(r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==o&&o>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,o),e=!1;break}o=t}if(void 0!==i&&ec(i))for(let s=0,a=i.length;s!==a;++s){const t=i[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Rt,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}lc.prototype.TimeBufferType=Float32Array,lc.prototype.ValueBufferType=Float32Array,lc.prototype.DefaultInterpolation=Tt;class cc extends lc{constructor(e,t,n){super(e,t,n)}}cc.prototype.ValueTypeName="bool",cc.prototype.ValueBufferType=Array,cc.prototype.DefaultInterpolation=Mt,cc.prototype.InterpolantFactoryMethodLinear=void 0,cc.prototype.InterpolantFactoryMethodSmooth=void 0;class uc extends lc{}uc.prototype.ValueTypeName="color";class hc extends lc{}hc.prototype.ValueTypeName="number";class dc extends rc{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let c=l+s;l!==c;l+=4)ai.slerpFlat(r,0,o,l-s,o,l,a);return r}}class pc extends lc{InterpolantFactoryMethodLinear(e){return new dc(this.times,this.values,this.getValueSize(),e)}}pc.prototype.ValueTypeName="quaternion",pc.prototype.InterpolantFactoryMethodSmooth=void 0;class fc extends lc{constructor(e,t,n){super(e,t,n)}}fc.prototype.ValueTypeName="string",fc.prototype.ValueBufferType=Array,fc.prototype.DefaultInterpolation=Mt,fc.prototype.InterpolantFactoryMethodLinear=void 0,fc.prototype.InterpolantFactoryMethodSmooth=void 0;class mc extends lc{}mc.prototype.ValueTypeName="vector";class gc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Lt;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=wn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,s=n.length;o!==s;++o)t.push(vc(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(lc.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const l=tc(e);e=nc(e,1,l),a=nc(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new hc(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(this.CreateFromMorphTargetSequence(s,i[s],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];ic(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new hc(".morphTargetInfluence["+r+"]",t,o))}a=t.length*o}else{const r=".bones["+t[c].name+"]";n(mc,r+".position",e,"pos",i),n(pc,r+".quaternion",e,"rot",i),n(mc,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function vc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return hc;case"vector":case"vector2":case"vector3":case"vector4":return mc;case"color":return uc;case"quaternion":return pc;case"bool":case"boolean":return cc;case"string":return fc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];ic(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const yc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Ac{constructor(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const xc=new Ac;class bc{constructor(e){this.manager=void 0!==e?e:xc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}bc.DEFAULT_MATERIAL_NAME="__DEFAULT";const _c={};class wc extends Error{constructor(e,t){super(e),this.response=t}}class Ec extends bc{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=yc.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==_c[e])return void _c[e].push({onLoad:t,onProgress:n,onError:i});_c[e]=[],_c[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=_c[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),o=r?parseInt(r):0,s=0!==o;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then((i=>{let{done:r,value:l}=i;if(r)e.close();else{a+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(l),t()}}),(t=>{e.error(t)}))}()}});return new Response(l)}throw new wc(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{yc.add(e,t);const n=_c[e];delete _c[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=_c[e];if(void 0===n)throw this.manager.itemError(e),t;delete _c[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Sc extends bc{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=yc.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const s=kn("img");function a(){c(),yc.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class Cc extends bc{constructor(e){super(e)}load(e,t,n,i){const r=new ti,o=new Sc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class Mc extends hr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new Ir(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class Tc extends Mc{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(hr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ir(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Rc=new Ui,Ic=new li,Pc=new li;class Bc{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new In(512,512),this.map=null,this.mapPass=null,this.matrix=new Ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ns,this._frameExtents=new In(1,1),this._viewportCount=1,this._viewports=[new ni(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Ic.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ic),Pc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Pc),t.updateMatrixWorld(),Rc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Rc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Lc extends Bc{constructor(){super(new So(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*_n*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Nc extends Mc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(hr.DEFAULT_UP),this.updateMatrix(),this.target=new hr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Lc}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Dc=new Ui,kc=new li,Oc=new li;class Uc extends Bc{constructor(){super(new So(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new In(4,2),this._viewportCount=6,this._viewports=[new ni(2,1,1,1),new ni(0,1,1,1),new ni(3,1,1,1),new ni(1,1,1,1),new ni(3,0,1,1),new ni(1,0,1,1)],this._cubeDirections=[new li(1,0,0),new li(-1,0,0),new li(0,0,1),new li(0,0,-1),new li(0,1,0),new li(0,-1,0)],this._cubeUps=[new li(0,1,0),new li(0,1,0),new li(0,1,0),new li(0,1,0),new li(0,0,1),new li(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),kc.setFromMatrixPosition(e.matrixWorld),n.position.copy(kc),Oc.copy(n.position),Oc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Oc),n.updateMatrixWorld(),i.makeTranslation(-kc.x,-kc.y,-kc.z),Dc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dc)}}class Fc extends Mc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Uc}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class zc extends bo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class jc extends Bc{constructor(){super(new zc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Vc extends Mc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(hr.DEFAULT_UP),this.updateMatrix(),this.target=new hr,this.shadow=new jc}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Gc extends Mc{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Hc extends Mc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Wc{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new li)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class Qc extends Mc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wc;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class qc extends bc{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new Ec(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Ir).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(i.dispersion=e.dispersion),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(i.uniforms[r]={},t.type){case"t":i.uniforms[r].value=n(t.value);break;case"c":i.uniforms[r].value=(new Ir).setHex(t.value);break;case"v2":i.uniforms[r].value=(new In).fromArray(t.value);break;case"v3":i.uniforms[r].value=(new li).fromArray(t.value);break;case"v4":i.uniforms[r].value=(new ni).fromArray(t.value);break;case"m3":i.uniforms[r].value=(new Pn).fromArray(t.value);break;case"m4":i.uniforms[r].value=(new Ui).fromArray(t.value);break;default:i.uniforms[r].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new In).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapRotation&&i.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new In).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return qc.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:jl,SpriteMaterial:Fo,RawShaderMaterial:Vl,ShaderMaterial:xo,PointsMaterial:pa,MeshPhysicalMaterial:Hl,MeshStandardMaterial:Gl,MeshPhongMaterial:Wl,MeshToonMaterial:Ql,MeshNormalMaterial:ql,MeshLambertMaterial:Xl,MeshDepthMaterial:$l,MeshDistanceMaterial:Yl,MeshBasicMaterial:Nr,MeshMatcapMaterial:Kl,LineDashedMaterial:Jl,LineBasicMaterial:Zs,Material:Lr}[e]}}class Xc{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class $c extends eo{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Yc extends bc{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new Ec(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(o){i?i(o):console.error(o),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],o=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,r=i[t],o=new Uint32Array(r).buffer;return n[t]=o,o}(e,r.buffer),s=Dn(r.type,o),a=new ko(s,r.stride);return a.uuid=r.uuid,t[i]=a,a}const r=e.isInstancedBufferGeometry?new $c:new eo,o=e.data.index;if(void 0!==o){const e=Dn(o.type,o.array);r.setIndex(new Vr(e,1))}const s=e.data.attributes;for(const u in s){const t=s[u];let n;if(t.isInterleavedBufferAttribute){const r=i(e.data,t.data);n=new Uo(r,t.itemSize,t.offset,t.normalized)}else{const e=Dn(t.type,t.array);n=new(t.isInstancedBufferAttribute?As:Vr)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),r.setAttribute(u,n)}const a=e.data.morphAttributes;if(a)for(const u in a){const t=a[u],n=[];for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;if(o.isInterleavedBufferAttribute){const t=i(e.data,o.data);s=new Uo(t,o.itemSize,o.offset,o.normalized)}else{const e=Dn(o.type,o.array);s=new Vr(e,o.itemSize,o.normalized)}void 0!==o.name&&(s.name=o.name),n.push(s)}r.morphAttributes[u]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const e=l[u];r.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new li;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Ri(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class Kc extends bc{constructor(e){super(e)}load(e,t,n,i){const r=this,o=""===this.path?Xc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Ec(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(a){return void 0!==i&&i(a),void console.error("THREE:ObjectLoader: Can't parse "+e+".",a.message)}const s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);r.parse(o,t)}),n,i)}async loadAsync(e,t){const n=""===this.path?Xc.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new Ec(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),o=JSON.parse(r),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,r,a,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in o)if(o[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,i,s,o,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),this.bindLightTargets(a),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new Ja).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let r=0,o=e.length;r<o;r++){const t=(new ys).fromJSON(e[r],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new Yc;for(let r=0,o=e.length;r<o;r++){let o;const s=e[r];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;default:s.type in zl?o=zl[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new qc;r.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=gc.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Dn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Ac(t);r=new Sc(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=o(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new ms(n.data,n.width,n.height)))}i[n.uuid]=new Jn(e)}else{const e=o(n.url);i[n.uuid]=new Jn(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"===typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:Dn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new Sc(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.url;if(Array.isArray(o)){const e=[];for(let t=0,n=o.length;t<n;t++){const n=o[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new ms(i.data,i.width,i.height)))}n[i.uuid]=new Jn(e)}else{const e=await r(i.url);n[i.uuid]=new Jn(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,o=e.length;r<o;r++){const o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const s=t[o.image],a=s.data;let l;Array.isArray(a)?(l=new To,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new ms:new ti,a&&(l.needsUpdate=!0)),l.source=s,l.uuid=o.uuid,void 0!==o.name&&(l.name=o.name),void 0!==o.mapping&&(l.mapping=n(o.mapping,Jc)),void 0!==o.channel&&(l.channel=o.channel),void 0!==o.offset&&l.offset.fromArray(o.offset),void 0!==o.repeat&&l.repeat.fromArray(o.repeat),void 0!==o.center&&l.center.fromArray(o.center),void 0!==o.rotation&&(l.rotation=o.rotation),void 0!==o.wrap&&(l.wrapS=n(o.wrap[0],Zc),l.wrapT=n(o.wrap[1],Zc)),void 0!==o.format&&(l.format=o.format),void 0!==o.internalFormat&&(l.internalFormat=o.internalFormat),void 0!==o.type&&(l.type=o.type),void 0!==o.colorSpace&&(l.colorSpace=o.colorSpace),void 0!==o.minFilter&&(l.minFilter=n(o.minFilter,eu)),void 0!==o.magFilter&&(l.magFilter=n(o.magFilter,eu)),void 0!==o.anisotropy&&(l.anisotropy=o.anisotropy),void 0!==o.flipY&&(l.flipY=o.flipY),void 0!==o.generateMipmaps&&(l.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(l.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(l.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(l.compareFunction=o.compareFunction),void 0!==o.userData&&(l.userData=o.userData),i[o.uuid]=l}return i}parseObject(e,t,n,i,r){let o,s,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":o=new Do,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new Ir(e.background):o.background=u(e.background)),void 0!==e.environment&&(o.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new No(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new Lo(e.fog.color,e.fog.density)),""!==e.fog.name&&(o.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(o.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(o.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&o.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(o.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new So(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new zc(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Gc(e.color,e.intensity);break;case"DirectionalLight":o=new Vc(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new Fc(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Hc(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Nc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new Tc(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new Qc).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),a=c(e.material),o=new ps(s,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),a=c(e.material),o=new po(s,a);break;case"InstancedMesh":s=l(e.geometry),a=c(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;o=new Ms(s,a,t),o.instanceMatrix=new As(new Float32Array(n.array),16),void 0!==i&&(o.instanceColor=new As(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":s=l(e.geometry),a=c(e.material),o=new Js(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,a),o.geometry=s,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map((e=>{const t=new hi;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const n=new Ri;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:n}})),o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=u(e.matricesTexture.uuid),void 0!==e.colorsTexture&&(o._colorsTexture=u(e.colorsTexture.uuid));break;case"LOD":o=new is;break;case"Line":o=new aa(l(e.geometry),c(e.material));break;case"LineLoop":o=new da(l(e.geometry),c(e.material));break;case"LineSegments":o=new ha(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new ya(l(e.geometry),c(e.material));break;case"Sprite":o=new Zo(c(e.material));break;case"Group":o=new Io;break;case"Bone":o=new fs;break;default:o=new hr}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.up&&o.up.fromArray(e.up),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(o.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=o.getObjectByProperty("uuid",n.object);void 0!==i&&o.addLevel(i,n.distance,n.hysteresis)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}bindLightTargets(e){e.traverse((function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);t.target=void 0!==i?i:new hr}}))}}const Jc={UVMapping:le,CubeReflectionMapping:ce,CubeRefractionMapping:ue,EquirectangularReflectionMapping:he,EquirectangularRefractionMapping:de,CubeUVReflectionMapping:pe},Zc={RepeatWrapping:fe,ClampToEdgeWrapping:me,MirroredRepeatWrapping:ge},eu={NearestFilter:ve,NearestMipmapNearestFilter:ye,NearestMipmapLinearFilter:Ae,LinearFilter:xe,LinearMipmapNearestFilter:be,LinearMipmapLinearFilter:_e};class tu extends So{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class nu{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=iu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=iu();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function iu(){return performance.now()}const ru="\\[\\]\\.:\\/",ou=new RegExp("["+ru+"]","g"),su="[^"+ru+"]",au="[^"+ru.replace("\\.","")+"]",lu=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",su)+/(WCOD+)?/.source.replace("WCOD",au)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",su)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",su)+"$"),cu=["material","materials","bones","map"];class uu{constructor(e,t,n){this.path=t,this.parsedPath=n||uu.parseTrackName(t),this.node=uu.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new uu.Composite(e,t,n):new uu(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ou,"")}static parseTrackName(e){const t=lu.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==cu.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=uu.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?s=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}uu.Composite=class{constructor(e,t,n){const i=n||uu.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},uu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},uu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},uu.prototype.GetterByBindingType=[uu.prototype._getValue_direct,uu.prototype._getValue_array,uu.prototype._getValue_arrayElement,uu.prototype._getValue_toArray],uu.prototype.SetterByBindingTypeAndVersioning=[[uu.prototype._setValue_direct,uu.prototype._setValue_direct_setNeedsUpdate,uu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[uu.prototype._setValue_array,uu.prototype._setValue_array_setNeedsUpdate,uu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[uu.prototype._setValue_arrayElement,uu.prototype._setValue_arrayElement_setNeedsUpdate,uu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[uu.prototype._setValue_fromArray,uu.prototype._setValue_fromArray_setNeedsUpdate,uu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);class hu extends ko{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const du=new Ui;class pu{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new Oi(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new $i,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return du.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(du),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return mu(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(fu),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=e.length;i<r;i++)mu(e[i],this,n,t);return n.sort(fu),n}}function fu(e,t){return e.distance-t.distance}function mu(e,t,n,i){let r=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(r=!1)}if(!0===r&&!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)mu(i[e],t,n,!0)}}class gu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=En(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(En(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class vu{constructor(e,t,n,i){vu.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=i,this}}class yu extends yn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function Au(e,t,n,i){const r=function(e){switch(e){case Ee:case Se:return{byteLength:1,components:1};case Me:case Ce:case Pe:return{byteLength:2,components:1};case Be:case Le:return{byteLength:2,components:4};case Re:case Te:case Ie:return{byteLength:4,components:1};case De:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(i);switch(n){case ke:case Fe:return e*t;case ze:return e*t*2;case Ge:case He:return e*t/r.components*r.byteLength;case We:case Qe:return e*t*2/r.components*r.byteLength;case Oe:return e*t*3/r.components*r.byteLength;case Ue:case Xe:return e*t*4/r.components*r.byteLength;case $e:case Ye:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Ke:case Je:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case et:case nt:return Math.max(e,16)*Math.max(t,8)/4;case Ze:case tt:return Math.max(e,8)*Math.max(t,8)/2;case it:case rt:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case ot:case st:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case at:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case lt:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case ct:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case ut:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case ht:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case dt:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case pt:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case ft:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case mt:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case gt:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case vt:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case yt:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case At:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case xt:case bt:case _t:return Math.ceil(e/4)*Math.ceil(t/4)*16;case wt:case Et:return Math.ceil(e/4)*Math.ceil(t/4)*8;case St:case Ct:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},9436:(e,t,n)=>{"use strict";var i;n.d(t,{i:()=>a,s:()=>s});var r=n(5043),o=!!(i||(i=n.t(r,2))).useInsertionEffect&&(i||(i=n.t(r,2))).useInsertionEffect,s=o||function(e){return e()},a=o||r.useLayoutEffect},9482:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A,isPlainObject:()=>i.Q});var i=n(9172)},9662:(e,t,n)=>{"use strict";n.d(t,{A:()=>A});var i=n(8168),r=n(5043),o=n(8587),s=n(8387),a=n(8610),l=n(6803),c=n(8206),u=n(4535),h=n(2532),d=n(2372);function p(e){return(0,d.Ay)("MuiSvgIcon",e)}(0,h.A)("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var f=n(579);const m=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],g=(0,u.Ay)("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"inherit"!==n.color&&t[`color${(0,l.A)(n.color)}`],t[`fontSize${(0,l.A)(n.fontSize)}`]]}})((e=>{let{theme:t,ownerState:n}=e;var i,r,o,s,a,l,c,u,h,d,p,f,m;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:n.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(i=t.transitions)||null==(r=i.create)?void 0:r.call(i,"fill",{duration:null==(o=t.transitions)||null==(o=o.duration)?void 0:o.shorter}),fontSize:{inherit:"inherit",small:(null==(s=t.typography)||null==(a=s.pxToRem)?void 0:a.call(s,20))||"1.25rem",medium:(null==(l=t.typography)||null==(c=l.pxToRem)?void 0:c.call(l,24))||"1.5rem",large:(null==(u=t.typography)||null==(h=u.pxToRem)?void 0:h.call(u,35))||"2.1875rem"}[n.fontSize],color:null!=(d=null==(p=(t.vars||t).palette)||null==(p=p[n.color])?void 0:p.main)?d:{action:null==(f=(t.vars||t).palette)||null==(f=f.action)?void 0:f.active,disabled:null==(m=(t.vars||t).palette)||null==(m=m.action)?void 0:m.disabled,inherit:void 0}[n.color]}})),v=r.forwardRef((function(e,t){const n=(0,c.b)({props:e,name:"MuiSvgIcon"}),{children:u,className:h,color:d="inherit",component:v="svg",fontSize:y="medium",htmlColor:A,inheritViewBox:x=!1,titleAccess:b,viewBox:_="0 0 24 24"}=n,w=(0,o.A)(n,m),E=r.isValidElement(u)&&"svg"===u.type,S=(0,i.A)({},n,{color:d,component:v,fontSize:y,instanceFontSize:e.fontSize,inheritViewBox:x,viewBox:_,hasSvgAsChild:E}),C={};x||(C.viewBox=_);const M=(e=>{const{color:t,fontSize:n,classes:i}=e,r={root:["root","inherit"!==t&&`color${(0,l.A)(t)}`,`fontSize${(0,l.A)(n)}`]};return(0,a.A)(r,p,i)})(S);return(0,f.jsxs)(g,(0,i.A)({as:v,className:(0,s.A)(M.root,h),focusable:"false",color:A,"aria-hidden":!b||void 0,role:b?"img":void 0,ref:t},C,w,E&&u.props,{ownerState:S,children:[E?u.props.children:u,b?(0,f.jsx)("title",{children:b}):null]}))}));v.muiName="SvgIcon";const y=v;function A(e,t){function n(n,r){return(0,f.jsx)(y,(0,i.A)({"data-testid":`${t}Icon`,ref:r},n,{children:e}))}return n.muiName=y.muiName,r.memo(r.forwardRef(n))}},9703:(e,t,n)=>{"use strict";function i(e,t){const n=this;if(n.vars&&"function"===typeof n.getColorSchemeSelector){const i=n.getColorSchemeSelector(e).replace(/(\[[^\]]+\])/,"*:where($1)");return{[i]:t}}return n.palette.mode===e?t:{}}n.d(t,{A:()=>i})},9751:(e,t,n)=>{"use strict";n.d(t,{EU:()=>a,NI:()=>s,iZ:()=>c,kW:()=>u,vf:()=>l,zu:()=>r});var i=n(9172);const r={xs:0,sm:600,md:900,lg:1200,xl:1536},o={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${r[e]}px)`};function s(e,t,n){const i=e.theme||{};if(Array.isArray(t)){const e=i.breakpoints||o;return t.reduce(((i,r,o)=>(i[e.up(e.keys[o])]=n(t[o]),i)),{})}if("object"===typeof t){const e=i.breakpoints||o;return Object.keys(t).reduce(((i,o)=>{if(-1!==Object.keys(e.values||r).indexOf(o)){i[e.up(o)]=n(t[o],o)}else{const e=o;i[e]=t[e]}return i}),{})}return n(t)}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return(null==(t=e.keys)?void 0:t.reduce(((t,n)=>(t[e.up(n)]={},t)),{}))||{}}function l(e,t){return e.reduce(((e,t)=>{const n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function c(e){const t=a(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];const s=[t,...r].reduce(((e,t)=>(0,i.A)(e,t)),{});return l(Object.keys(t),s)}function u(e){let{values:t,breakpoints:n,base:i}=e;const r=i||function(e,t){if("object"!==typeof e)return{};const n={},i=Object.keys(t);return Array.isArray(e)?i.forEach(((t,i)=>{i<e.length&&(n[t]=!0)})):i.forEach((t=>{null!=e[t]&&(n[t]=!0)})),n}(t,n),o=Object.keys(r);if(0===o.length)return t;let s;return o.reduce(((e,n,i)=>(Array.isArray(t)?(e[n]=null!=t[i]?t[i]:t[s],s=i):"object"===typeof t?(e[n]=null!=t[n]?t[n]:t[s],s=n):e[n]=t,e)),{})}},9760:e=>{function t(e,t,n,i){e&&(t=t||[],e.traverse((e=>{if(!e.isMesh)return;var r;((r=e.material)?Array.isArray(r)?r:r.materials?r.materials:[r]:[]).forEach((e=>{e&&!("envMap"in e)||t.length&&-1===t.indexOf(e.name)||(e.envMap=n,e.reflectivity=i,e.needsUpdate=!0)}))})))}e.exports=AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const e=this.data;this.texture=(new THREE.CubeTextureLoader).load([e.path+"posx."+e.extension,e.path+"negx."+e.extension,e.path+"posy."+e.extension,e.path+"negy."+e.extension,e.path+"posz."+e.extension,e.path+"negz."+e.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{const e=this.el.getObject3D("mesh"),n=this.data;t(e,n.materials,this.texture,n.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(e){const n=this.data,i=this.el.getObject3D("mesh");let r=[],o=[];if(n.materials.length&&(e.materials?(r=n.materials.filter((t=>!e.materials.includes(t))),o=e.materials.filter((e=>!n.materials.includes(e)))):r=n.materials),r.length&&t(i,r,this.texture,n.reflectivity),o.length&&t(i,o,null,1),e.materials&&n.reflectivity!==e.reflectivity){const r=n.materials.filter((t=>e.materials.includes(t)));r.length&&t(i,r,this.texture,n.reflectivity)}this.data.enableBackground&&!e.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&e.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const e=this.el.getObject3D("mesh"),n=this.data;t(e,n.materials,null,1),n.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},9778:(e,t,n)=>{"use strict";var i=n(4994);t.A=void 0;var r=i(n(39)),o=n(579);t.A=(0,r.default)((0,o.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle")},9823:e=>{e.exports=function(e,t,n){this.type=e,this.index=t,this.pressed=n.pressed,this.value=n.value}},9896:(e,t,n)=>{e.exports=function(e){"uniqueLinkId"in(e=e||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),e.multigraph=e.uniqueLinkId);void 0===e.multigraph&&(e.multigraph=!1);if("function"!==typeof Map)throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var t=new Map,n=new Map,l={},c=0,u=e.multigraph?function(e,t,n){var i=a(e,t),r=l.hasOwnProperty(i);if(r||S(e,t)){r||(l[i]=0);var o="@"+ ++l[i];i=a(e+o,t+o)}return new s(e,t,n,i)}:function(e,t,i){var r=a(e,t),o=n.get(r);if(o)return o.data=i,o;return new s(e,t,i,r)},h=[],d=C,p=C,f=C,m=C,g={version:20,addNode:A,addLink:function(e,t,i){f();var r=x(e)||A(e),s=x(t)||A(t),a=u(e,t,i),l=n.has(a.id);n.set(a.id,a),o(r,a),e!==t&&o(s,a);return d(a,l?"update":"add"),m(),a},removeLink:function(e,t){void 0!==t&&(e=S(e,t));return E(e)},removeNode:b,getNode:x,getNodeCount:_,getLinkCount:w,getEdgeCount:w,getLinksCount:w,getNodesCount:_,getLinks:function(e){var t=x(e);return t?t.links:null},forEachNode:R,forEachLinkedNode:function(e,n,i){var r=x(e);if(r&&r.links&&"function"===typeof n)return i?function(e,n,i){var r=e.values(),o=r.next();for(;!o.done;){var s=o.value;if(s.fromId===n&&i(t.get(s.toId),s))return!0;o=r.next()}}(r.links,e,n):function(e,n,i){var r=e.values(),o=r.next();for(;!o.done;){var s=o.value,a=s.fromId===n?s.toId:s.fromId;if(i(t.get(a),s))return!0;o=r.next()}}(r.links,e,n)},forEachLink:function(e){if("function"===typeof e)for(var t=n.values(),i=t.next();!i.done;){if(e(i.value))return!0;i=t.next()}},beginUpdate:f,endUpdate:m,clear:function(){f(),R((function(e){b(e.id)})),m()},hasLink:S,hasNode:x,getLink:S};return i(g),function(){var e=g.on;function t(){return g.beginUpdate=f=M,g.endUpdate=m=T,d=v,p=y,g.on=e,e.apply(g,arguments)}g.on=t}(),g;function v(e,t){h.push({link:e,changeType:t})}function y(e,t){h.push({node:e,changeType:t})}function A(e,n){if(void 0===e)throw new Error("Invalid node identifier");f();var i=x(e);return i?(i.data=n,p(i,"update")):(i=new r(e,n),p(i,"add")),t.set(e,i),m(),i}function x(e){return t.get(e)}function b(e){var n=x(e);if(!n)return!1;f();var i=n.links;return i&&(i.forEach(E),n.links=null),t.delete(e),p(n,"remove"),m(),!0}function _(){return t.size}function w(){return n.size}function E(e){if(!e)return!1;if(!n.get(e.id))return!1;f(),n.delete(e.id);var t=x(e.fromId),i=x(e.toId);return t&&t.links.delete(e),i&&i.links.delete(e),d(e,"remove"),m(),!0}function S(e,t){if(void 0!==e&&void 0!==t)return n.get(a(e,t))}function C(){}function M(){c+=1}function T(){0===(c-=1)&&h.length>0&&(g.fire("changed",h),h.length=0)}function R(e){if("function"!==typeof e)throw new Error("Function is expected to iterate over graph nodes. You passed "+e);for(var n=t.values(),i=n.next();!i.done;){if(e(i.value))return!0;i=n.next()}}};var i=n(8925);function r(e,t){this.id=e,this.links=null,this.data=t}function o(e,t){e.links?e.links.add(t):e.links=new Set([t])}function s(e,t,n,i){this.fromId=e,this.toId=t,this.data=n,this.id=i}function a(e,t){return e.toString()+"\ud83d\udc49 "+t.toString()}}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={exports:{}};return e[t](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var o=Object.create(null);i.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,i.d(o,s),o}})(),i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};i.r(e),i.d(e,{hasBrowserEnv:()=>Ws,hasStandardBrowserEnv:()=>qs,hasStandardBrowserWebWorkerEnv:()=>Xs,navigator:()=>Qs,origin:()=>$s});var n={};i.r(n),i.d(n,{ACESFilmicToneMapping:()=>RM,AddEquation:()=>XC,AddOperation:()=>EM,AdditiveAnimationBlendMode:()=>pR,AdditiveBlending:()=>HC,AgXToneMapping:()=>PM,AlphaFormat:()=>dT,AlwaysCompare:()=>KR,AlwaysDepth:()=>mM,AlwaysStencilFunc:()=>GR,AmbientLight:()=>iU,AnimationAction:()=>qU,AnimationClip:()=>CO,AnimationLoader:()=>DO,AnimationMixer:()=>$U,AnimationObjectGroup:()=>QU,AnimationUtils:()=>pO,ArcCurve:()=>TD,ArrayCamera:()=>wU,ArrowHelper:()=>HF,AttachedBindMode:()=>LM,Audio:()=>PU,AudioAnalyser:()=>OU,AudioContext:()=>vU,AudioListener:()=>IU,AudioLoader:()=>yU,AxesHelper:()=>WF,BackSide:()=>zC,BasicDepthPacking:()=>vR,BasicShadowMap:()=>DC,BatchedMesh:()=>YN,Bone:()=>dN,BooleanKeyframeTrack:()=>AO,Box2:()=>hF,Box3:()=>rP,Box3Helper:()=>FF,BoxGeometry:()=>pL,BoxHelper:()=>UF,BufferAttribute:()=>kB,BufferGeometry:()=>ZB,BufferGeometryLoader:()=>uU,ByteType:()=>tT,Cache:()=>TO,Camera:()=>AL,CameraHelper:()=>DF,CanvasTexture:()=>ED,CapsuleGeometry:()=>$D,CatmullRomCurve3:()=>ND,CineonToneMapping:()=>TM,CircleGeometry:()=>YD,ClampToEdgeWrapping:()=>VM,Clock:()=>EU,Color:()=>wB,ColorKeyframeTrack:()=>xO,ColorManagement:()=>OI,CompressedArrayTexture:()=>_D,CompressedCubeTexture:()=>wD,CompressedTexture:()=>bD,CompressedTextureLoader:()=>kO,ConeGeometry:()=>JD,ConstantAlphaFactor:()=>dM,ConstantColorFactor:()=>uM,Controls:()=>qF,CubeCamera:()=>SL,CubeReflectionMapping:()=>kM,CubeRefractionMapping:()=>OM,CubeTexture:()=>CL,CubeTextureLoader:()=>UO,CubeUVReflectionMapping:()=>zM,CubicBezierCurve:()=>UD,CubicBezierCurve3:()=>FD,CubicInterpolant:()=>mO,CullFaceBack:()=>BC,CullFaceFront:()=>LC,CullFaceFrontBack:()=>NC,CullFaceNone:()=>PC,Curve:()=>CD,CurvePath:()=>QD,CustomBlending:()=>qC,CustomToneMapping:()=>IM,CylinderGeometry:()=>KD,Cylindrical:()=>lF,Data3DTexture:()=>JI,DataArrayTexture:()=>YI,DataTexture:()=>pN,DataTextureLoader:()=>FO,DataUtils:()=>BB,DecrementStencilOp:()=>BR,DecrementWrapStencilOp:()=>NR,DefaultLoadingManager:()=>IO,DepthFormat:()=>vT,DepthStencilFormat:()=>yT,DepthTexture:()=>SD,DetachedBindMode:()=>NM,DirectionalLight:()=>nU,DirectionalLightHelper:()=>BF,DiscreteInterpolant:()=>vO,DodecahedronGeometry:()=>ek,DoubleSide:()=>jC,DstAlphaFactor:()=>oM,DstColorFactor:()=>aM,DynamicCopyUsage:()=>oI,DynamicDrawUsage:()=>ZR,DynamicReadUsage:()=>nI,EdgesGeometry:()=>ok,EllipseCurve:()=>MD,EqualCompare:()=>QR,EqualDepth:()=>yM,EqualStencilFunc:()=>UR,EquirectangularReflectionMapping:()=>UM,EquirectangularRefractionMapping:()=>FM,Euler:()=>jP,EventDispatcher:()=>dI,ExtrudeGeometry:()=>Dk,FileLoader:()=>NO,Float16BufferAttribute:()=>HB,Float32BufferAttribute:()=>WB,FloatType:()=>sT,Fog:()=>BL,FogExp2:()=>PL,FramebufferTexture:()=>xD,FrontSide:()=>FC,Frustum:()=>BN,GLBufferAttribute:()=>nF,GLSL1:()=>aI,GLSL3:()=>lI,GreaterCompare:()=>XR,GreaterDepth:()=>xM,GreaterEqualCompare:()=>YR,GreaterEqualDepth:()=>AM,GreaterEqualStencilFunc:()=>VR,GreaterStencilFunc:()=>zR,GridHelper:()=>MF,Group:()=>TL,HalfFloatType:()=>aT,HemisphereLight:()=>VO,HemisphereLightHelper:()=>CF,IcosahedronGeometry:()=>Ok,ImageBitmapLoader:()=>mU,ImageLoader:()=>OO,ImageUtils:()=>jI,IncrementStencilOp:()=>PR,IncrementWrapStencilOp:()=>LR,InstancedBufferAttribute:()=>vN,InstancedBufferGeometry:()=>cU,InstancedInterleavedBuffer:()=>tF,InstancedMesh:()=>SN,Int16BufferAttribute:()=>zB,Int32BufferAttribute:()=>VB,Int8BufferAttribute:()=>OB,IntType:()=>rT,InterleavedBuffer:()=>NL,InterleavedBufferAttribute:()=>kL,Interpolant:()=>fO,InterpolateDiscrete:()=>sR,InterpolateLinear:()=>aR,InterpolateSmooth:()=>lR,InvertStencilOp:()=>DR,KeepStencilOp:()=>RR,KeyframeTrack:()=>yO,LOD:()=>tN,LatheGeometry:()=>XD,Layers:()=>VP,LessCompare:()=>WR,LessDepth:()=>gM,LessEqualCompare:()=>qR,LessEqualDepth:()=>vM,LessEqualStencilFunc:()=>FR,LessStencilFunc:()=>OR,Light:()=>jO,LightProbe:()=>sU,Line:()=>oD,Line3:()=>fF,LineBasicMaterial:()=>KN,LineCurve:()=>zD,LineCurve3:()=>jD,LineDashedMaterial:()=>aO,LineLoop:()=>uD,LineSegments:()=>cD,LinearFilter:()=>$M,LinearInterpolant:()=>gO,LinearMipMapLinearFilter:()=>ZM,LinearMipMapNearestFilter:()=>KM,LinearMipmapLinearFilter:()=>JM,LinearMipmapNearestFilter:()=>YM,LinearSRGBColorSpace:()=>SR,LinearToneMapping:()=>CM,LinearTransfer:()=>CR,Loader:()=>PO,LoaderUtils:()=>lU,LoadingManager:()=>RO,LoopOnce:()=>iR,LoopPingPong:()=>oR,LoopRepeat:()=>rR,LuminanceAlphaFormat:()=>gT,LuminanceFormat:()=>mT,MOUSE:()=>RC,Material:()=>CB,MaterialLoader:()=>aU,MathUtils:()=>wI,Matrix2:()=>cF,Matrix3:()=>SI,Matrix4:()=>PP,MaxEquation:()=>JC,Mesh:()=>hL,MeshBasicMaterial:()=>MB,MeshDepthMaterial:()=>rO,MeshDistanceMaterial:()=>oO,MeshLambertMaterial:()=>iO,MeshMatcapMaterial:()=>sO,MeshNormalMaterial:()=>nO,MeshPhongMaterial:()=>eO,MeshPhysicalMaterial:()=>Zk,MeshStandardMaterial:()=>Jk,MeshToonMaterial:()=>tO,MinEquation:()=>KC,MirroredRepeatWrapping:()=>GM,MixOperation:()=>wM,MultiplyBlending:()=>QC,MultiplyOperation:()=>_M,NearestFilter:()=>HM,NearestMipMapLinearFilter:()=>XM,NearestMipMapNearestFilter:()=>QM,NearestMipmapLinearFilter:()=>qM,NearestMipmapNearestFilter:()=>WM,NeutralToneMapping:()=>BM,NeverCompare:()=>HR,NeverDepth:()=>fM,NeverStencilFunc:()=>kR,NoBlending:()=>VC,NoColorSpace:()=>wR,NoToneMapping:()=>SM,NormalAnimationBlendMode:()=>dR,NormalBlending:()=>GC,NotEqualCompare:()=>$R,NotEqualDepth:()=>bM,NotEqualStencilFunc:()=>jR,NumberKeyframeTrack:()=>bO,Object3D:()=>rB,ObjectLoader:()=>hU,ObjectSpaceNormalMap:()=>_R,OctahedronGeometry:()=>Uk,OneFactor:()=>eM,OneMinusConstantAlphaFactor:()=>pM,OneMinusConstantColorFactor:()=>hM,OneMinusDstAlphaFactor:()=>sM,OneMinusDstColorFactor:()=>lM,OneMinusSrcAlphaFactor:()=>rM,OneMinusSrcColorFactor:()=>nM,OrthographicCamera:()=>eU,PCFShadowMap:()=>kC,PCFSoftShadowMap:()=>OC,PMREMGenerator:()=>bz,Path:()=>qD,PerspectiveCamera:()=>wL,Plane:()=>RN,PlaneGeometry:()=>Fk,PlaneHelper:()=>zF,PointLight:()=>ZO,PointLightHelper:()=>_F,Points:()=>gD,PointsMaterial:()=>hD,PolarGridHelper:()=>TF,PolyhedronGeometry:()=>ZD,PositionalAudio:()=>kU,PropertyBinding:()=>WU,PropertyMixer:()=>UU,QuadraticBezierCurve:()=>VD,QuadraticBezierCurve3:()=>GD,Quaternion:()=>eP,QuaternionKeyframeTrack:()=>wO,QuaternionLinearInterpolant:()=>_O,RED_GREEN_RGTC2_Format:()=>tR,RED_RGTC1_Format:()=>ZT,REVISION:()=>TC,RGBADepthPacking:()=>yR,RGBAFormat:()=>fT,RGBAIntegerFormat:()=>ET,RGBA_ASTC_10x10_Format:()=>qT,RGBA_ASTC_10x5_Format:()=>HT,RGBA_ASTC_10x6_Format:()=>WT,RGBA_ASTC_10x8_Format:()=>QT,RGBA_ASTC_12x10_Format:()=>XT,RGBA_ASTC_12x12_Format:()=>$T,RGBA_ASTC_4x4_Format:()=>kT,RGBA_ASTC_5x4_Format:()=>OT,RGBA_ASTC_5x5_Format:()=>UT,RGBA_ASTC_6x5_Format:()=>FT,RGBA_ASTC_6x6_Format:()=>zT,RGBA_ASTC_8x5_Format:()=>jT,RGBA_ASTC_8x6_Format:()=>VT,RGBA_ASTC_8x8_Format:()=>GT,RGBA_BPTC_Format:()=>YT,RGBA_ETC2_EAC_Format:()=>DT,RGBA_PVRTC_2BPPV1_Format:()=>BT,RGBA_PVRTC_4BPPV1_Format:()=>PT,RGBA_S3TC_DXT1_Format:()=>CT,RGBA_S3TC_DXT3_Format:()=>MT,RGBA_S3TC_DXT5_Format:()=>TT,RGBDepthPacking:()=>AR,RGBFormat:()=>pT,RGBIntegerFormat:()=>wT,RGB_BPTC_SIGNED_Format:()=>KT,RGB_BPTC_UNSIGNED_Format:()=>JT,RGB_ETC1_Format:()=>LT,RGB_ETC2_Format:()=>NT,RGB_PVRTC_2BPPV1_Format:()=>IT,RGB_PVRTC_4BPPV1_Format:()=>RT,RGB_S3TC_DXT1_Format:()=>ST,RGDepthPacking:()=>xR,RGFormat:()=>bT,RGIntegerFormat:()=>_T,RawShaderMaterial:()=>Kk,Ray:()=>IP,Raycaster:()=>rF,RectAreaLight:()=>rU,RedFormat:()=>AT,RedIntegerFormat:()=>xT,ReinhardToneMapping:()=>MM,RenderTarget:()=>XI,RenderTarget3D:()=>YU,RenderTargetArray:()=>KU,RepeatWrapping:()=>jM,ReplaceStencilOp:()=>IR,ReverseSubtractEquation:()=>YC,RingGeometry:()=>zk,SIGNED_RED_GREEN_RGTC2_Format:()=>nR,SIGNED_RED_RGTC1_Format:()=>eR,SRGBColorSpace:()=>ER,SRGBTransfer:()=>MR,Scene:()=>LL,ShaderChunk:()=>JF,ShaderLib:()=>ez,ShaderMaterial:()=>yL,ShadowMaterial:()=>Yk,Shape:()=>sk,ShapeGeometry:()=>jk,ShapePath:()=>QF,ShapeUtils:()=>Bk,ShortType:()=>nT,Skeleton:()=>gN,SkeletonHelper:()=>xF,SkinnedMesh:()=>hN,Source:()=>GI,Sphere:()=>_P,SphereGeometry:()=>Vk,Spherical:()=>aF,SphericalHarmonics3:()=>oU,SplineCurve:()=>HD,SpotLight:()=>XO,SpotLightHelper:()=>gF,Sprite:()=>KL,SpriteMaterial:()=>OL,SrcAlphaFactor:()=>iM,SrcAlphaSaturateFactor:()=>cM,SrcColorFactor:()=>tM,StaticCopyUsage:()=>rI,StaticDrawUsage:()=>JR,StaticReadUsage:()=>tI,StereoCamera:()=>_U,StreamCopyUsage:()=>sI,StreamDrawUsage:()=>eI,StreamReadUsage:()=>iI,StringKeyframeTrack:()=>EO,SubtractEquation:()=>$C,SubtractiveBlending:()=>WC,TOUCH:()=>IC,TangentSpaceNormalMap:()=>bR,TetrahedronGeometry:()=>Gk,Texture:()=>QI,TextureLoader:()=>zO,TextureUtils:()=>$F,TimestampQuery:()=>hI,TorusGeometry:()=>Hk,TorusKnotGeometry:()=>Wk,Triangle:()=>yB,TriangleFanDrawMode:()=>gR,TriangleStripDrawMode:()=>mR,TrianglesDrawMode:()=>fR,TubeGeometry:()=>Qk,UVMapping:()=>DM,Uint16BufferAttribute:()=>jB,Uint32BufferAttribute:()=>GB,Uint8BufferAttribute:()=>UB,Uint8ClampedBufferAttribute:()=>FB,Uniform:()=>JU,UniformsGroup:()=>eF,UniformsLib:()=>ZF,UniformsUtils:()=>vL,UnsignedByteType:()=>eT,UnsignedInt248Type:()=>uT,UnsignedInt5999Type:()=>hT,UnsignedIntType:()=>oT,UnsignedShort4444Type:()=>lT,UnsignedShort5551Type:()=>cT,UnsignedShortType:()=>iT,VSMShadowMap:()=>UC,Vector2:()=>EI,Vector3:()=>tP,Vector4:()=>qI,VectorKeyframeTrack:()=>SO,VideoFrameTexture:()=>AD,VideoTexture:()=>yD,WebGL3DRenderTarget:()=>ZI,WebGLArrayRenderTarget:()=>KI,WebGLCoordinateSystem:()=>cI,WebGLCubeRenderTarget:()=>ML,WebGLRenderTarget:()=>$I,WebGLRenderer:()=>LV,WebGLUtils:()=>SV,WebGPUCoordinateSystem:()=>uI,WebXRController:()=>IL,WireframeGeometry:()=>qk,WrapAroundEnding:()=>hR,ZeroCurvatureEnding:()=>cR,ZeroFactor:()=>ZC,ZeroSlopeEnding:()=>uR,ZeroStencilOp:()=>TR,createCanvasElement:()=>PI});var r,o,s=i(5043),a=i.t(s,2),l=i(4391),c=i(7950),u=i.t(c,2);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},h.apply(this,arguments)}(o=r||(r={})).Pop="POP",o.Push="PUSH",o.Replace="REPLACE";const d="popstate";function p(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function f(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function m(e,t){return{usr:e.state,key:e.key,idx:t}}function g(e,t,n,i){return void 0===n&&(n=null),h({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?y(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function v(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function y(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function A(e,t,n,i){void 0===i&&(i={});let{window:o=document.defaultView,v5Compat:s=!1}=i,a=o.history,l=r.Pop,c=null,u=f();function f(){return(a.state||{idx:null}).idx}function y(){l=r.Pop;let e=f(),t=null==e?null:e-u;u=e,c&&c({action:l,location:x.location,delta:t})}function A(e){let t="null"!==o.location.origin?o.location.origin:o.location.href,n="string"===typeof e?e:v(e);return n=n.replace(/ $/,"%20"),p(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==u&&(u=0,a.replaceState(h({},a.state,{idx:u}),""));let x={get action(){return l},get location(){return e(o,a)},listen(e){if(c)throw new Error("A history only accepts one active listener");return o.addEventListener(d,y),c=e,()=>{o.removeEventListener(d,y),c=null}},createHref:e=>t(o,e),createURL:A,encodeLocation(e){let t=A(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l=r.Push;let i=g(x.location,e,t);n&&n(i,e),u=f()+1;let h=m(i,u),d=x.createHref(i);try{a.pushState(h,"",d)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;o.location.assign(d)}s&&c&&c({action:l,location:x.location,delta:1})},replace:function(e,t){l=r.Replace;let i=g(x.location,e,t);n&&n(i,e),u=f();let o=m(i,u),h=x.createHref(i);a.replaceState(o,"",h),s&&c&&c({action:l,location:x.location,delta:0})},go:e=>a.go(e)};return x}var x,b;(b=x||(x={})).data="data",b.deferred="deferred",b.redirect="redirect",b.error="error";new Set(["lazy","caseSensitive","path","id","index","children"]);function _(e,t,n){return void 0===n&&(n="/"),w(e,t,n,!1)}function w(e,t,n,i){let r=O(("string"===typeof t?y(t):t).pathname||"/",n);if(null==r)return null;let o=E(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(o);let s=null;for(let a=0;null==s&&a<o.length;++a){let e=k(r);s=N(o[a],e,i)}return s}function E(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let r=(e,r,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};s.relativePath.startsWith("/")&&(p(s.relativePath.startsWith(i),'Absolute route path "'+s.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(i.length));let a=V([i,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(p(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+a+'".'),E(e.children,t,l,a)),(null!=e.path||e.index)&&t.push({path:a,score:L(a,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of S(e.path))r(e,t,i);else r(e,t)})),t}function S(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===i.length)return r?[o,""]:[o];let s=S(i.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),r&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const C=/^:[\w-]+$/,M=3,T=2,R=1,I=10,P=-2,B=e=>"*"===e;function L(e,t){let n=e.split("/"),i=n.length;return n.some(B)&&(i+=P),t&&(i+=T),n.filter((e=>!B(e))).reduce(((e,t)=>e+(C.test(t)?M:""===t?R:I)),i)}function N(e,t,n){void 0===n&&(n=!1);let{routesMeta:i}=e,r={},o="/",s=[];for(let a=0;a<i.length;++a){let e=i[a],l=a===i.length-1,c="/"===o?t:t.slice(o.length)||"/",u=D({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),h=e.route;if(!u&&l&&n&&!i[i.length-1].route.index&&(u=D({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(r,u.params),s.push({params:r,pathname:V([o,u.pathname]),pathnameBase:G(V([o,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(o=V([o,u.pathnameBase]))}return s}function D(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);f("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(i.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let o=new RegExp(r,t?void 0:"i");return[o,i]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let o=r[0],s=o.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce(((e,t,n)=>{let{paramName:i,isOptional:r}=t;if("*"===i){let e=a[n]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[n];return e[i]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:s,pattern:e}}function k(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return f(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function O(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}function U(e,t,n,i){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function F(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function z(e,t){let n=F(e);return t?n.map(((e,t)=>t===n.length-1?e.pathname:e.pathnameBase)):n.map((e=>e.pathnameBase))}function j(e,t,n,i){let r;void 0===i&&(i=!1),"string"===typeof e?r=y(e):(r=h({},e),p(!r.pathname||!r.pathname.includes("?"),U("?","pathname","search",r)),p(!r.pathname||!r.pathname.includes("#"),U("#","pathname","hash",r)),p(!r.search||!r.search.includes("#"),U("#","search","hash",r)));let o,s=""===e||""===r.pathname,a=s?"/":r.pathname;if(null==a)o=n;else{let e=t.length-1;if(!i&&a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:n,search:i="",hash:r=""}="string"===typeof e?y(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:H(i),hash:W(r)}}(r,o),c=a&&"/"!==a&&a.endsWith("/"),u=(s||"."===a)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}const V=e=>e.join("/").replace(/\/\/+/g,"/"),G=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),H=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",W=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function Q(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],X=(new Set(q),["get",...q]);new Set(X),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$.apply(this,arguments)}const Y=s.createContext(null);const K=s.createContext(null);const J=s.createContext(null);const Z=s.createContext(null);const ee=s.createContext({outlet:null,matches:[],isDataRoute:!1});const te=s.createContext(null);function ne(){return null!=s.useContext(Z)}function ie(){return ne()||p(!1),s.useContext(Z).location}function re(e){s.useContext(J).static||s.useLayoutEffect(e)}function oe(){let{isDataRoute:e}=s.useContext(ee);return e?function(){let{router:e}=ge(fe.UseNavigateStable),t=ye(me.UseNavigateStable),n=s.useRef(!1);return re((()=>{n.current=!0})),s.useCallback((function(i,r){void 0===r&&(r={}),n.current&&("number"===typeof i?e.navigate(i):e.navigate(i,$({fromRouteId:t},r)))}),[e,t])}():function(){ne()||p(!1);let e=s.useContext(Y),{basename:t,future:n,navigator:i}=s.useContext(J),{matches:r}=s.useContext(ee),{pathname:o}=ie(),a=JSON.stringify(z(r,n.v7_relativeSplatPath)),l=s.useRef(!1);return re((()=>{l.current=!0})),s.useCallback((function(n,r){if(void 0===r&&(r={}),!l.current)return;if("number"===typeof n)return void i.go(n);let s=j(n,JSON.parse(a),o,"path"===r.relative);null==e&&"/"!==t&&(s.pathname="/"===s.pathname?t:V([t,s.pathname])),(r.replace?i.replace:i.push)(s,r.state,r)}),[t,i,a,o,e])}()}function se(){let{matches:e}=s.useContext(ee),t=e[e.length-1];return t?t.params:{}}function ae(e,t){let{relative:n}=void 0===t?{}:t,{future:i}=s.useContext(J),{matches:r}=s.useContext(ee),{pathname:o}=ie(),a=JSON.stringify(z(r,i.v7_relativeSplatPath));return s.useMemo((()=>j(e,JSON.parse(a),o,"path"===n)),[e,a,o,n])}function le(e,t,n,i){ne()||p(!1);let{navigator:o,static:a}=s.useContext(J),{matches:l}=s.useContext(ee),c=l[l.length-1],u=c?c.params:{},h=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let d,f=ie();if(t){var m;let e="string"===typeof t?y(t):t;"/"===h||(null==(m=e.pathname)?void 0:m.startsWith(h))||p(!1),d=e}else d=f;let g=d.pathname||"/",v=g;if("/"!==h){let e=h.replace(/^\//,"").split("/");v="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let A=!a&&n&&n.matches&&n.matches.length>0?n.matches:_(e,{pathname:v});let x=pe(A&&A.map((e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:V([h,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:V([h,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),l,n,i);return t&&x?s.createElement(Z.Provider,{value:{location:$({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:r.Pop}},x):x}function ce(){let e=function(){var e;let t=s.useContext(te),n=ve(me.UseRouteError),i=ye(me.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[i]}(),t=Q(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i};return s.createElement(s.Fragment,null,s.createElement("h2",null,"Unexpected Application Error!"),s.createElement("h3",{style:{fontStyle:"italic"}},t),n?s.createElement("pre",{style:r},n):null,null)}const ue=s.createElement(ce,null);class he extends s.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?s.createElement(ee.Provider,{value:this.props.routeContext},s.createElement(te.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function de(e){let{routeContext:t,match:n,children:i}=e,r=s.useContext(Y);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),s.createElement(ee.Provider,{value:t},i)}function pe(e,t,n,i){var r;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),null==e){var o;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(o=i)&&o.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let a=e,l=null==(r=n)?void 0:r.errors;if(null!=l){let e=a.findIndex((e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id])));e>=0||p(!1),a=a.slice(0,Math.min(a.length,e+1))}let c=!1,u=-1;if(n&&i&&i.v7_partialHydration)for(let s=0;s<a.length;s++){let e=a[s];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=s),e.route.id){let{loaderData:t,errors:i}=n,r=e.route.loader&&void 0===t[e.route.id]&&(!i||void 0===i[e.route.id]);if(e.route.lazy||r){c=!0,a=u>=0?a.slice(0,u+1):[a[0]];break}}}return a.reduceRight(((e,i,r)=>{let o,h=!1,d=null,p=null;var f;n&&(o=l&&i.route.id?l[i.route.id]:void 0,d=i.route.errorElement||ue,c&&(u<0&&0===r?(f="route-fallback",!1||Ae[f]||(Ae[f]=!0),h=!0,p=null):u===r&&(h=!0,p=i.route.hydrateFallbackElement||null)));let m=t.concat(a.slice(0,r+1)),g=()=>{let t;return t=o?d:h?p:i.route.Component?s.createElement(i.route.Component,null):i.route.element?i.route.element:e,s.createElement(de,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(i.route.ErrorBoundary||i.route.errorElement||0===r)?s.createElement(he,{location:n.location,revalidation:n.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var fe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(fe||{}),me=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(me||{});function ge(e){let t=s.useContext(Y);return t||p(!1),t}function ve(e){let t=s.useContext(K);return t||p(!1),t}function ye(e){let t=function(){let e=s.useContext(ee);return e||p(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||p(!1),n.route.id}const Ae={};function xe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}a.startTransition;function be(e){let{to:t,replace:n,state:i,relative:r}=e;ne()||p(!1);let{future:o,static:a}=s.useContext(J),{matches:l}=s.useContext(ee),{pathname:c}=ie(),u=oe(),h=j(t,z(l,o.v7_relativeSplatPath),c,"path"===r),d=JSON.stringify(h);return s.useEffect((()=>u(JSON.parse(d),{replace:n,state:i,relative:r})),[u,d,r,n,i]),null}function _e(e){p(!1)}function we(e){let{basename:t="/",children:n=null,location:i,navigationType:o=r.Pop,navigator:a,static:l=!1,future:c}=e;ne()&&p(!1);let u=t.replace(/^\/*/,"/"),h=s.useMemo((()=>({basename:u,navigator:a,static:l,future:$({v7_relativeSplatPath:!1},c)})),[u,c,a,l]);"string"===typeof i&&(i=y(i));let{pathname:d="/",search:f="",hash:m="",state:g=null,key:v="default"}=i,A=s.useMemo((()=>{let e=O(d,u);return null==e?null:{location:{pathname:e,search:f,hash:m,state:g,key:v},navigationType:o}}),[u,d,f,m,g,v,o]);return null==A?null:s.createElement(J.Provider,{value:h},s.createElement(Z.Provider,{children:n,value:A}))}function Ee(e){let{children:t,location:n}=e;return le(Se(t),n)}new Promise((()=>{}));s.Component;function Se(e,t){void 0===t&&(t=[]);let n=[];return s.Children.forEach(e,((e,i)=>{if(!s.isValidElement(e))return;let r=[...t,i];if(e.type===s.Fragment)return void n.push.apply(n,Se(e.props.children,r));e.type!==_e&&p(!1),e.props.index&&e.props.children&&p(!1);let o={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=Se(e.props.children,r)),n.push(o)})),n}function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ce.apply(this,arguments)}function Me(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function Te(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce(((t,n)=>{let i=e[n];return t.concat(Array.isArray(i)?i.map((e=>[n,e])):[[n,i]])}),[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Re=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(Jbe){}new Map;const Ie=a.startTransition;u.flushSync,a.useId;function Pe(e){let{basename:t,children:n,future:i,window:r}=e,o=s.useRef();var a;null==o.current&&(o.current=(void 0===(a={window:r,v5Compat:!0})&&(a={}),A((function(e,t){let{pathname:n,search:i,hash:r}=e.location;return g("",{pathname:n,search:i,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:v(t)}),null,a)));let l=o.current,[c,u]=s.useState({action:l.action,location:l.location}),{v7_startTransition:h}=i||{},d=s.useCallback((e=>{h&&Ie?Ie((()=>u(e))):u(e)}),[u,h]);return s.useLayoutEffect((()=>l.listen(d)),[l,d]),s.useEffect((()=>xe(i)),[i]),s.createElement(we,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:l,future:i})}const Be="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Le=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ne=s.forwardRef((function(e,t){let n,{onClick:i,relative:r,reloadDocument:o,replace:a,state:l,target:c,to:u,preventScrollReset:h,viewTransition:d}=e,f=Me(e,Re),{basename:m}=s.useContext(J),g=!1;if("string"===typeof u&&Le.test(u)&&(n=u,Be))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=O(t.pathname,m);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:g=!0}catch(Jbe){}let y=function(e,t){let{relative:n}=void 0===t?{}:t;ne()||p(!1);let{basename:i,navigator:r}=s.useContext(J),{hash:o,pathname:a,search:l}=ae(e,{relative:n}),c=a;return"/"!==i&&(c="/"===a?i:V([i,a])),r.createHref({pathname:c,search:l,hash:o})}(u,{relative:r}),A=function(e,t){let{target:n,replace:i,state:r,preventScrollReset:o,relative:a,viewTransition:l}=void 0===t?{}:t,c=oe(),u=ie(),h=ae(e,{relative:a});return s.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==i?i:v(u)===v(h);c(e,{replace:n,state:r,preventScrollReset:o,relative:a,viewTransition:l})}}),[u,c,h,i,r,n,e,o,a,l])}(u,{replace:a,state:l,target:c,preventScrollReset:h,relative:r,viewTransition:d});return s.createElement("a",Ce({},f,{href:n||y,onClick:g||o?i:function(e){i&&i(e),e.defaultPrevented||A(e)},ref:t,target:c}))}));var De,ke,Oe,Ue;function Fe(e){let t=s.useRef(Te(e)),n=s.useRef(!1),i=ie(),r=s.useMemo((()=>function(e,t){let n=Te(e);return t&&t.forEach(((e,i)=>{n.has(i)||t.getAll(i).forEach((e=>{n.append(i,e)}))})),n}(i.search,n.current?null:t.current)),[i.search]),o=oe(),a=s.useCallback(((e,t)=>{const i=Te("function"===typeof e?e(r):e);n.current=!0,o("?"+i,t)}),[o,r]);return[r,a]}(ke=De||(De={})).UseScrollRestoration="useScrollRestoration",ke.UseSubmit="useSubmit",ke.UseSubmitFetcher="useSubmitFetcher",ke.UseFetcher="useFetcher",ke.useViewTransitionState="useViewTransitionState",(Ue=Oe||(Oe={})).UseFetcher="useFetcher",Ue.UseFetchers="useFetchers",Ue.UseScrollRestoration="useScrollRestoration";var ze=i(8168),je=i(8587);const Ve=s.createContext(null);function Ge(){return s.useContext(Ve)}const He="function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";var We=i(579);const Qe=function(e){const{children:t,theme:n}=e,i=Ge(),r=s.useMemo((()=>{const e=null===i?n:function(e,t){if("function"===typeof t)return t(e);return(0,ze.A)({},e,t)}(i,n);return null!=e&&(e[He]=null!==i),e}),[n,i]);return(0,We.jsx)(Ve.Provider,{value:r,children:t})};var qe=i(9369);const Xe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=s.useContext(qe.T);return t&&(n=t,0!==Object.keys(n).length)?t:e;var n},$e=["value"],Ye=s.createContext();const Ke=()=>{const e=s.useContext(Ye);return null!=e&&e},Je=function(e){let{value:t}=e,n=(0,je.A)(e,$e);return(0,We.jsx)(Ye.Provider,(0,ze.A)({value:null==t||t},n))};var Ze=i(3654);const et={};function tt(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return s.useMemo((()=>{const r=e&&t[e]||t;if("function"===typeof n){const o=n(r),s=e?(0,ze.A)({},t,{[e]:o}):o;return i?()=>s:s}return e?(0,ze.A)({},t,{[e]:n}):(0,ze.A)({},t,n)}),[e,t,n,i])}const nt=function(e){const{children:t,theme:n,themeId:i}=e,r=Xe(et),o=Ge()||et,s=tt(i,r,n),a=tt(i,o,n,!0),l="rtl"===s.direction;return(0,We.jsx)(Qe,{theme:a,children:(0,We.jsx)(qe.T.Provider,{value:s,children:(0,We.jsx)(Je,{value:l,children:(0,We.jsx)(Ze.A,{value:null==s?void 0:s.components,children:t})})})})};var it=i(3375);const rt=["theme"];function ot(e){let{theme:t}=e,n=(0,je.A)(e,rt);const i=t[it.A];let r=i||t;return"function"!==typeof t&&(i&&!i.vars?r=(0,ze.A)({},i,{vars:null}):t&&!t.vars&&(r=(0,ze.A)({},t,{vars:null}))),(0,We.jsx)(nt,(0,ze.A)({},n,{themeId:i?it.A:void 0,theme:r}))}var st=i(8206),at=i(869),lt=i(8280);const ct=(0,lt.A)();const ut=function(){return Xe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ct)};const ht=function(e){let{styles:t,themeId:n,defaultTheme:i={}}=e;const r=ut(i),o="function"===typeof t?t(n&&r[n]||r):t;return(0,We.jsx)(at.A,{styles:o})};var dt=i(5170);const pt=function(e){return(0,We.jsx)(ht,(0,ze.A)({},e,{defaultTheme:dt.A,themeId:it.A}))},ft=(e,t)=>(0,ze.A)({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%"},t&&!e.vars&&{colorScheme:e.palette.mode}),mt=e=>(0,ze.A)({color:(e.vars||e).palette.text.primary},e.typography.body1,{backgroundColor:(e.vars||e).palette.background.default,"@media print":{backgroundColor:(e.vars||e).palette.common.white}});const gt=function(e){const t=(0,st.b)({props:e,name:"MuiCssBaseline"}),{children:n,enableColorScheme:i=!1}=t;return(0,We.jsxs)(s.Fragment,{children:[(0,We.jsx)(pt,{styles:e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var n;const i={};t&&e.colorSchemes&&Object.entries(e.colorSchemes).forEach((t=>{let[n,r]=t;var o;i[e.getColorSchemeSelector(n).replace(/\s*&/,"")]={colorScheme:null==(o=r.palette)?void 0:o.mode}}));let r=(0,ze.A)({html:ft(e,t),"*, *::before, *::after":{boxSizing:"inherit"},"strong, b":{fontWeight:e.typography.fontWeightBold},body:(0,ze.A)({margin:0},mt(e),{"&::backdrop":{backgroundColor:(e.vars||e).palette.background.default}})},i);const o=null==(n=e.components)||null==(n=n.MuiCssBaseline)?void 0:n.styleOverrides;return o&&(r=[r,o]),r}(e,i)}),n]})};var vt=i(8387),yt=i(8610),At=i(4535),xt=i(6803),bt=i(7266);const _t=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};var wt=i(2532),Et=i(2372);function St(e){return(0,Et.Ay)("MuiPaper",e)}(0,wt.A)("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Ct=["className","component","elevation","square","variant"],Mt=(0,At.Ay)("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t[`elevation${n.elevation}`]]}})((e=>{let{theme:t,ownerState:n}=e;var i;return(0,ze.A)({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!n.square&&{borderRadius:t.shape.borderRadius},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.divider}`},"elevation"===n.variant&&(0,ze.A)({boxShadow:(t.vars||t).shadows[n.elevation]},!t.vars&&"dark"===t.palette.mode&&{backgroundImage:`linear-gradient(${(0,bt.X4)("#fff",_t(n.elevation))}, ${(0,bt.X4)("#fff",_t(n.elevation))})`},t.vars&&{backgroundImage:null==(i=t.vars.overlays)?void 0:i[n.elevation]}))})),Tt=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiPaper"}),{className:i,component:r="div",elevation:o=1,square:s=!1,variant:a="elevation"}=n,l=(0,je.A)(n,Ct),c=(0,ze.A)({},n,{component:r,elevation:o,square:s,variant:a}),u=(e=>{const{square:t,elevation:n,variant:i,classes:r}=e,o={root:["root",i,!t&&"rounded","elevation"===i&&`elevation${n}`]};return(0,yt.A)(o,St,r)})(c);return(0,We.jsx)(Mt,(0,ze.A)({as:r,ownerState:c,className:(0,vt.A)(u.root,i),ref:t},l))}));function Rt(e){return(0,Et.Ay)("MuiAppBar",e)}(0,wt.A)("MuiAppBar",["root","positionFixed","positionAbsolute","positionSticky","positionStatic","positionRelative","colorDefault","colorPrimary","colorSecondary","colorInherit","colorTransparent","colorError","colorInfo","colorSuccess","colorWarning"]);const It=["className","color","enableColorOnDark","position"],Pt=(e,t)=>e?`${null==e?void 0:e.replace(")","")}, ${t})`:t,Bt=(0,At.Ay)(Tt,{name:"MuiAppBar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`position${(0,xt.A)(n.position)}`],t[`color${(0,xt.A)(n.color)}`]]}})((e=>{let{theme:t,ownerState:n}=e;const i="light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[900];return(0,ze.A)({display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",flexShrink:0},"fixed"===n.position&&{position:"fixed",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0,"@media print":{position:"absolute"}},"absolute"===n.position&&{position:"absolute",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0},"sticky"===n.position&&{position:"sticky",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0},"static"===n.position&&{position:"static"},"relative"===n.position&&{position:"relative"},!t.vars&&(0,ze.A)({},"default"===n.color&&{backgroundColor:i,color:t.palette.getContrastText(i)},n.color&&"default"!==n.color&&"inherit"!==n.color&&"transparent"!==n.color&&{backgroundColor:t.palette[n.color].main,color:t.palette[n.color].contrastText},"inherit"===n.color&&{color:"inherit"},"dark"===t.palette.mode&&!n.enableColorOnDark&&{backgroundColor:null,color:null},"transparent"===n.color&&(0,ze.A)({backgroundColor:"transparent",color:"inherit"},"dark"===t.palette.mode&&{backgroundImage:"none"})),t.vars&&(0,ze.A)({},"default"===n.color&&{"--AppBar-background":n.enableColorOnDark?t.vars.palette.AppBar.defaultBg:Pt(t.vars.palette.AppBar.darkBg,t.vars.palette.AppBar.defaultBg),"--AppBar-color":n.enableColorOnDark?t.vars.palette.text.primary:Pt(t.vars.palette.AppBar.darkColor,t.vars.palette.text.primary)},n.color&&!n.color.match(/^(default|inherit|transparent)$/)&&{"--AppBar-background":n.enableColorOnDark?t.vars.palette[n.color].main:Pt(t.vars.palette.AppBar.darkBg,t.vars.palette[n.color].main),"--AppBar-color":n.enableColorOnDark?t.vars.palette[n.color].contrastText:Pt(t.vars.palette.AppBar.darkColor,t.vars.palette[n.color].contrastText)},!["inherit","transparent"].includes(n.color)&&{backgroundColor:"var(--AppBar-background)"},{color:"inherit"===n.color?"inherit":"var(--AppBar-color)"},"transparent"===n.color&&{backgroundImage:"none",backgroundColor:"transparent",color:"inherit"}))})),Lt=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiAppBar"}),{className:i,color:r="primary",enableColorOnDark:o=!1,position:s="fixed"}=n,a=(0,je.A)(n,It),l=(0,ze.A)({},n,{color:r,position:s,enableColorOnDark:o}),c=(e=>{const{color:t,position:n,classes:i}=e,r={root:["root",`color${(0,xt.A)(t)}`,`position${(0,xt.A)(n)}`]};return(0,yt.A)(r,Rt,i)})(l);return(0,We.jsx)(Bt,(0,ze.A)({square:!0,component:"header",ownerState:l,elevation:4,className:(0,vt.A)(c.root,i,"fixed"===s&&"mui-fixed"),ref:t},a))}));var Nt=i(3030),Dt=i(1475),kt=i(5849),Ot=i(3319),Ut=i(3574);function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zt(e,t){return zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zt(e,t)}function jt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,zt(e,t)}const Vt=s.createContext(null);function Gt(e,t){var n=Object.create(null);return e&&s.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&(0,s.isValidElement)(e)?t(e):e}(e)})),n}function Ht(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Wt(e,t,n){var i=Gt(e.children),r=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var i,r=Object.create(null),o=[];for(var s in e)s in t?o.length&&(r[s]=o,o=[]):o.push(s);var a={};for(var l in t){if(r[l])for(i=0;i<r[l].length;i++){var c=r[l][i];a[r[l][i]]=n(c)}a[l]=n(l)}for(i=0;i<o.length;i++)a[o[i]]=n(o[i]);return a}(t,i);return Object.keys(r).forEach((function(o){var a=r[o];if((0,s.isValidElement)(a)){var l=o in t,c=o in i,u=t[o],h=(0,s.isValidElement)(u)&&!u.props.in;!c||l&&!h?c||!l||h?c&&l&&(0,s.isValidElement)(u)&&(r[o]=(0,s.cloneElement)(a,{onExited:n.bind(null,a),in:u.props.in,exit:Ht(a,"exit",e),enter:Ht(a,"enter",e)})):r[o]=(0,s.cloneElement)(a,{in:!1}):r[o]=(0,s.cloneElement)(a,{onExited:n.bind(null,a),in:!0,exit:Ht(a,"exit",e),enter:Ht(a,"enter",e)})}})),r}var Qt=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},qt=function(e){function t(t,n){var i,r=(i=e.call(this,t,n)||this).handleExited.bind(Ft(i));return i.state={contextValue:{isMounting:!0},handleExited:r,firstRender:!0},i}jt(t,e);var n=t.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var n,i,r=t.children,o=t.handleExited;return{children:t.firstRender?(n=e,i=o,Gt(n.children,(function(e){return(0,s.cloneElement)(e,{onExited:i.bind(null,e),in:!0,appear:Ht(e,"appear",n),enter:Ht(e,"enter",n),exit:Ht(e,"exit",n)})}))):Wt(e,r,o),firstRender:!1}},n.handleExited=function(e,t){var n=Gt(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,ze.A)({},t.children);return delete n[e.key],{children:n}})))},n.render=function(){var e=this.props,t=e.component,n=e.childFactory,i=(0,je.A)(e,["component","childFactory"]),r=this.state.contextValue,o=Qt(this.state.children).map(n);return delete i.appear,delete i.enter,delete i.exit,null===t?s.createElement(Vt.Provider,{value:r},o):s.createElement(Vt.Provider,{value:r},s.createElement(t,i,o))},t}(s.Component);qt.propTypes={},qt.defaultProps={component:"div",childFactory:function(e){return e}};const Xt=qt;var $t=i(3290),Yt=i(9303);const Kt=function(e){const{className:t,classes:n,pulsate:i=!1,rippleX:r,rippleY:o,rippleSize:a,in:l,onExited:c,timeout:u}=e,[h,d]=s.useState(!1),p=(0,vt.A)(t,n.ripple,n.rippleVisible,i&&n.ripplePulsate),f={width:a,height:a,top:-a/2+o,left:-a/2+r},m=(0,vt.A)(n.child,h&&n.childLeaving,i&&n.childPulsate);return l||h||d(!0),s.useEffect((()=>{if(!l&&null!=c){const e=setTimeout(c,u);return()=>{clearTimeout(e)}}}),[c,l,u]),(0,We.jsx)("span",{className:p,style:f,children:(0,We.jsx)("span",{className:m})})};const Jt=(0,wt.A)("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Zt=["center","classes","className"];let en,tn,nn,rn,on=e=>e;const sn=(0,$t.i7)(en||(en=on`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),an=(0,$t.i7)(tn||(tn=on`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),ln=(0,$t.i7)(nn||(nn=on`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),cn=(0,At.Ay)("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),un=(0,At.Ay)(Kt,{name:"MuiTouchRipple",slot:"Ripple"})(rn||(rn=on`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),Jt.rippleVisible,sn,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Jt.ripplePulsate,(e=>{let{theme:t}=e;return t.transitions.duration.shorter}),Jt.child,Jt.childLeaving,an,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),Jt.childPulsate,ln,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut})),hn=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiTouchRipple"}),{center:i=!1,classes:r={},className:o}=n,a=(0,je.A)(n,Zt),[l,c]=s.useState([]),u=s.useRef(0),h=s.useRef(null);s.useEffect((()=>{h.current&&(h.current(),h.current=null)}),[l]);const d=s.useRef(!1),p=(0,Yt.A)(),f=s.useRef(null),m=s.useRef(null),g=s.useCallback((e=>{const{pulsate:t,rippleX:n,rippleY:i,rippleSize:o,cb:s}=e;c((e=>[...e,(0,We.jsx)(un,{classes:{ripple:(0,vt.A)(r.ripple,Jt.ripple),rippleVisible:(0,vt.A)(r.rippleVisible,Jt.rippleVisible),ripplePulsate:(0,vt.A)(r.ripplePulsate,Jt.ripplePulsate),child:(0,vt.A)(r.child,Jt.child),childLeaving:(0,vt.A)(r.childLeaving,Jt.childLeaving),childPulsate:(0,vt.A)(r.childPulsate,Jt.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:i,rippleSize:o},u.current)])),u.current+=1,h.current=s}),[r]),v=s.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:r=!1,center:o=i||t.pulsate,fakeElement:s=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&d.current)return void(d.current=!1);"touchstart"===(null==e?void 0:e.type)&&(d.current=!0);const a=s?null:m.current,l=a?a.getBoundingClientRect():{width:0,height:0,left:0,top:0};let c,u,h;if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)c=Math.round(l.width/2),u=Math.round(l.height/2);else{const{clientX:t,clientY:n}=e.touches&&e.touches.length>0?e.touches[0]:e;c=Math.round(t-l.left),u=Math.round(n-l.top)}if(o)h=Math.sqrt((2*l.width**2+l.height**2)/3),h%2===0&&(h+=1);else{const e=2*Math.max(Math.abs((a?a.clientWidth:0)-c),c)+2,t=2*Math.max(Math.abs((a?a.clientHeight:0)-u),u)+2;h=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===f.current&&(f.current=()=>{g({pulsate:r,rippleX:c,rippleY:u,rippleSize:h,cb:n})},p.start(80,(()=>{f.current&&(f.current(),f.current=null)}))):g({pulsate:r,rippleX:c,rippleY:u,rippleSize:h,cb:n})}),[i,g,p]),y=s.useCallback((()=>{v({},{pulsate:!0})}),[v]),A=s.useCallback(((e,t)=>{if(p.clear(),"touchend"===(null==e?void 0:e.type)&&f.current)return f.current(),f.current=null,void p.start(0,(()=>{A(e,t)}));f.current=null,c((e=>e.length>0?e.slice(1):e)),h.current=t}),[p]);return s.useImperativeHandle(t,(()=>({pulsate:y,start:v,stop:A})),[y,v,A]),(0,We.jsx)(cn,(0,ze.A)({className:(0,vt.A)(Jt.root,r.root,o),ref:m},a,{children:(0,We.jsx)(Xt,{component:null,exit:!0,children:l})}))}));function dn(e){return(0,Et.Ay)("MuiButtonBase",e)}const pn=(0,wt.A)("MuiButtonBase",["root","disabled","focusVisible"]),fn=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],mn=(0,At.Ay)("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${pn.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),gn=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiButtonBase"}),{action:i,centerRipple:r=!1,children:o,className:a,component:l="button",disabled:c=!1,disableRipple:u=!1,disableTouchRipple:h=!1,focusRipple:d=!1,LinkComponent:p="a",onBlur:f,onClick:m,onContextMenu:g,onDragLeave:v,onFocus:y,onFocusVisible:A,onKeyDown:x,onKeyUp:b,onMouseDown:_,onMouseLeave:w,onMouseUp:E,onTouchEnd:S,onTouchMove:C,onTouchStart:M,tabIndex:T=0,TouchRippleProps:R,touchRippleRef:I,type:P}=n,B=(0,je.A)(n,fn),L=s.useRef(null),N=s.useRef(null),D=(0,kt.A)(N,I),{isFocusVisibleRef:k,onFocus:O,onBlur:U,ref:F}=(0,Ut.A)(),[z,j]=s.useState(!1);c&&z&&j(!1),s.useImperativeHandle(i,(()=>({focusVisible:()=>{j(!0),L.current.focus()}})),[]);const[V,G]=s.useState(!1);s.useEffect((()=>{G(!0)}),[]);const H=V&&!u&&!c;function W(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;return(0,Ot.A)((i=>{t&&t(i);return!n&&N.current&&N.current[e](i),!0}))}s.useEffect((()=>{z&&d&&!u&&V&&N.current.pulsate()}),[u,d,z,V]);const Q=W("start",_),q=W("stop",g),X=W("stop",v),$=W("stop",E),Y=W("stop",(e=>{z&&e.preventDefault(),w&&w(e)})),K=W("start",M),J=W("stop",S),Z=W("stop",C),ee=W("stop",(e=>{U(e),!1===k.current&&j(!1),f&&f(e)}),!1),te=(0,Ot.A)((e=>{L.current||(L.current=e.currentTarget),O(e),!0===k.current&&(j(!0),A&&A(e)),y&&y(e)})),ne=()=>{const e=L.current;return l&&"button"!==l&&!("A"===e.tagName&&e.href)},ie=s.useRef(!1),re=(0,Ot.A)((e=>{d&&!ie.current&&z&&N.current&&" "===e.key&&(ie.current=!0,N.current.stop(e,(()=>{N.current.start(e)}))),e.target===e.currentTarget&&ne()&&" "===e.key&&e.preventDefault(),x&&x(e),e.target===e.currentTarget&&ne()&&"Enter"===e.key&&!c&&(e.preventDefault(),m&&m(e))})),oe=(0,Ot.A)((e=>{d&&" "===e.key&&N.current&&z&&!e.defaultPrevented&&(ie.current=!1,N.current.stop(e,(()=>{N.current.pulsate(e)}))),b&&b(e),m&&e.target===e.currentTarget&&ne()&&" "===e.key&&!e.defaultPrevented&&m(e)}));let se=l;"button"===se&&(B.href||B.to)&&(se=p);const ae={};"button"===se?(ae.type=void 0===P?"button":P,ae.disabled=c):(B.href||B.to||(ae.role="button"),c&&(ae["aria-disabled"]=c));const le=(0,kt.A)(t,F,L);const ce=(0,ze.A)({},n,{centerRipple:r,component:l,disabled:c,disableRipple:u,disableTouchRipple:h,focusRipple:d,tabIndex:T,focusVisible:z}),ue=(e=>{const{disabled:t,focusVisible:n,focusVisibleClassName:i,classes:r}=e,o={root:["root",t&&"disabled",n&&"focusVisible"]},s=(0,yt.A)(o,dn,r);return n&&i&&(s.root+=` ${i}`),s})(ce);return(0,We.jsxs)(mn,(0,ze.A)({as:se,className:(0,vt.A)(ue.root,a),ownerState:ce,onBlur:ee,onClick:m,onContextMenu:q,onFocus:te,onKeyDown:re,onKeyUp:oe,onMouseDown:Q,onMouseLeave:Y,onMouseUp:$,onDragLeave:X,onTouchEnd:J,onTouchMove:Z,onTouchStart:K,ref:le,tabIndex:c?-1:T,type:P},ae,B,{children:[o,H?(0,We.jsx)(hn,(0,ze.A)({ref:D,center:r},R)):null]}))}));function vn(e){return(0,Et.Ay)("MuiButton",e)}const yn=(0,wt.A)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);const An=s.createContext({});const xn=s.createContext(void 0),bn=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],_n=e=>(0,ze.A)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),wn=(0,At.Ay)(gn,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`${n.variant}${(0,xt.A)(n.color)}`],t[`size${(0,xt.A)(n.size)}`],t[`${n.variant}Size${(0,xt.A)(n.size)}`],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((e=>{let{theme:t,ownerState:n}=e;var i,r;const o="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],s="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return(0,ze.A)({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":(0,ze.A)({textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===n.variant&&"inherit"!==n.color&&{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===n.variant&&"inherit"!==n.color&&{border:`1px solid ${(t.vars||t).palette[n.color].main}`,backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===n.variant&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:s,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},"contained"===n.variant&&"inherit"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}),"&:active":(0,ze.A)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[8]}),[`&.${yn.focusVisible}`]:(0,ze.A)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[6]}),[`&.${yn.disabled}`]:(0,ze.A)({color:(t.vars||t).palette.action.disabled},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"contained"===n.variant&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},"text"===n.variant&&{padding:"6px 8px"},"text"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main},"outlined"===n.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:t.vars?`1px solid rgba(${t.vars.palette[n.color].mainChannel} / 0.5)`:`1px solid ${(0,bt.X4)(t.palette[n.color].main,.5)}`},"contained"===n.variant&&{color:t.vars?t.vars.palette.text.primary:null==(i=(r=t.palette).getContrastText)?void 0:i.call(r,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:o,boxShadow:(t.vars||t).shadows[2]},"contained"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main},"inherit"===n.color&&{color:"inherit",borderColor:"currentColor"},"small"===n.size&&"text"===n.variant&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"text"===n.variant&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"outlined"===n.variant&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"outlined"===n.variant&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"contained"===n.variant&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"contained"===n.variant&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},n.fullWidth&&{width:"100%"})}),(e=>{let{ownerState:t}=e;return t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${yn.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${yn.disabled}`]:{boxShadow:"none"}}})),En=(0,At.Ay)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.startIcon,t[`iconSize${(0,xt.A)(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},_n(t))})),Sn=(0,At.Ay)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.endIcon,t[`iconSize${(0,xt.A)(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},_n(t))})),Cn=s.forwardRef((function(e,t){const n=s.useContext(An),i=s.useContext(xn),r=(0,Nt.A)(n,e),o=(0,st.b)({props:r,name:"MuiButton"}),{children:a,color:l="primary",component:c="button",className:u,disabled:h=!1,disableElevation:d=!1,disableFocusRipple:p=!1,endIcon:f,focusVisibleClassName:m,fullWidth:g=!1,size:v="medium",startIcon:y,type:A,variant:x="text"}=o,b=(0,je.A)(o,bn),_=(0,ze.A)({},o,{color:l,component:c,disabled:h,disableElevation:d,disableFocusRipple:p,fullWidth:g,size:v,type:A,variant:x}),w=(e=>{const{color:t,disableElevation:n,fullWidth:i,size:r,variant:o,classes:s}=e,a={root:["root",o,`${o}${(0,xt.A)(t)}`,`size${(0,xt.A)(r)}`,`${o}Size${(0,xt.A)(r)}`,`color${(0,xt.A)(t)}`,n&&"disableElevation",i&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${(0,xt.A)(r)}`],endIcon:["icon","endIcon",`iconSize${(0,xt.A)(r)}`]},l=(0,yt.A)(a,vn,s);return(0,ze.A)({},s,l)})(_),E=y&&(0,We.jsx)(En,{className:w.startIcon,ownerState:_,children:y}),S=f&&(0,We.jsx)(Sn,{className:w.endIcon,ownerState:_,children:f}),C=i||"";return(0,We.jsxs)(wn,(0,ze.A)({ownerState:_,className:(0,vt.A)(n.className,w.root,u,C),component:c,disabled:h,focusRipple:!p,focusVisibleClassName:(0,vt.A)(w.focusVisible,m),ref:t,type:A},b,{classes:w,children:[E,a,S]}))}));var Mn=i(8698);function Tn(e){return(0,Et.Ay)("MuiTypography",e)}(0,wt.A)("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Rn=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],In=(0,At.Ay)("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t[`align${(0,xt.A)(n.align)}`],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({margin:0},"inherit"===n.variant&&{font:"inherit"},"inherit"!==n.variant&&t.typography[n.variant],"inherit"!==n.align&&{textAlign:n.align},n.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n.gutterBottom&&{marginBottom:"0.35em"},n.paragraph&&{marginBottom:16})})),Pn={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Bn={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},Ln=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiTypography"}),i=(e=>Bn[e]||e)(n.color),r=(0,Mn.A)((0,ze.A)({},n,{color:i})),{align:o="inherit",className:s,component:a,gutterBottom:l=!1,noWrap:c=!1,paragraph:u=!1,variant:h="body1",variantMapping:d=Pn}=r,p=(0,je.A)(r,Rn),f=(0,ze.A)({},r,{align:o,color:i,className:s,component:a,gutterBottom:l,noWrap:c,paragraph:u,variant:h,variantMapping:d}),m=a||(u?"p":d[h]||Pn[h])||"span",g=(e=>{const{align:t,gutterBottom:n,noWrap:i,paragraph:r,variant:o,classes:s}=e,a={root:["root",o,"inherit"!==e.align&&`align${(0,xt.A)(t)}`,n&&"gutterBottom",i&&"noWrap",r&&"paragraph"]};return(0,yt.A)(a,Tn,s)})(f);return(0,We.jsx)(In,(0,ze.A)({as:m,ref:t,ownerState:f,className:(0,vt.A)(g.root,s)},p))}));var Nn=i(7598);function Dn(e){let{props:t,name:n,defaultTheme:i,themeId:r}=e,o=ut(i);r&&(o=o[r]||o);const s=function(e){const{theme:t,name:n,props:i}=e;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?(0,Nt.A)(t.components[n].defaultProps,i):i}({theme:o,name:n,props:t});return s}var kn=i(3174),On=i(9172),Un=i(8812);const Fn=["ownerState"],zn=["variants"],jn=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function Vn(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const Gn=(0,lt.A)(),Hn=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function Wn(e){let{defaultTheme:t,theme:n,themeId:i}=e;return r=n,0===Object.keys(r).length?t:n[i]||n;var r}function Qn(e){return e?(t,n)=>n[e]:null}function qn(e,t){let{ownerState:n}=t,i=(0,je.A)(t,Fn);const r="function"===typeof e?e((0,ze.A)({ownerState:n},i)):e;if(Array.isArray(r))return r.flatMap((e=>qn(e,(0,ze.A)({ownerState:n},i))));if(r&&"object"===typeof r&&Array.isArray(r.variants)){const{variants:e=[]}=r;let t=(0,je.A)(r,zn);return e.forEach((e=>{let r=!0;"function"===typeof e.props?r=e.props((0,ze.A)({ownerState:n},i,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&i[t]!==e.props[t]&&(r=!1)})),r&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,ze.A)({ownerState:n},i,n)):e.style))})),t}return r}const Xn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=Gn,rootShouldForwardProp:i=Vn,slotShouldForwardProp:r=Vn}=e,o=e=>(0,Un.A)((0,ze.A)({},e,{theme:Wn((0,ze.A)({},e,{defaultTheme:n,themeId:t}))}));return o.__mui_systemSx=!0,function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,kn.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:a,slot:l,skipVariantsResolver:c,skipSx:u,overridesResolver:h=Qn(Hn(l))}=s,d=(0,je.A)(s,jn),p=void 0!==c?c:l&&"Root"!==l&&"root"!==l||!1,f=u||!1;let m=Vn;"Root"===l||"root"===l?m=i:l?m=r:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(m=void 0);const g=(0,kn.default)(e,(0,ze.A)({shouldForwardProp:m,label:undefined},d)),v=e=>"function"===typeof e&&e.__emotion_real!==e||(0,On.Q)(e)?i=>qn(e,(0,ze.A)({},i,{theme:Wn({theme:i.theme,defaultTheme:n,themeId:t})})):e,y=function(i){let r=v(i);for(var s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];const u=l?l.map(v):[];a&&h&&u.push((e=>{const i=Wn((0,ze.A)({},e,{defaultTheme:n,themeId:t}));if(!i.components||!i.components[a]||!i.components[a].styleOverrides)return null;const r=i.components[a].styleOverrides,o={};return Object.entries(r).forEach((t=>{let[n,r]=t;o[n]=qn(r,(0,ze.A)({},e,{theme:i}))})),h(e,o)})),a&&!p&&u.push((e=>{var i;const r=Wn((0,ze.A)({},e,{defaultTheme:n,themeId:t}));return qn({variants:null==r||null==(i=r.components)||null==(i=i[a])?void 0:i.variants},(0,ze.A)({},e,{theme:r}))})),f||u.push(o);const d=u.length-l.length;if(Array.isArray(i)&&d>0){const e=new Array(d).fill("");r=[...i,...e],r.raw=[...i.raw,...e]}const m=g(r,...u);return e.muiName&&(m.muiName=e.muiName),m};return g.withConfig&&(y.withConfig=g.withConfig),y}}(),$n=["className","component","disableGutters","fixed","maxWidth","classes"],Yn=(0,lt.A)(),Kn=Xn("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`maxWidth${(0,Nn.A)(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),Jn=e=>Dn({props:e,name:"MuiContainer",defaultTheme:Yn});const Zn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=Kn,useThemeProps:n=Jn,componentName:i="MuiContainer"}=e,r=t((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})}),(e=>{let{theme:t,ownerState:n}=e;return n.fixed&&Object.keys(t.breakpoints.values).reduce(((e,n)=>{const i=n,r=t.breakpoints.values[i];return 0!==r&&(e[t.breakpoints.up(i)]={maxWidth:`${r}${t.breakpoints.unit}`}),e}),{})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},"xs"===n.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},n.maxWidth&&"xs"!==n.maxWidth&&{[t.breakpoints.up(n.maxWidth)]:{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`}})}));return s.forwardRef((function(e,t){const o=n(e),{className:s,component:a="div",disableGutters:l=!1,fixed:c=!1,maxWidth:u="lg"}=o,h=(0,je.A)(o,$n),d=(0,ze.A)({},o,{component:a,disableGutters:l,fixed:c,maxWidth:u}),p=((e,t)=>{const{classes:n,fixed:i,disableGutters:r,maxWidth:o}=e,s={root:["root",o&&`maxWidth${(0,Nn.A)(String(o))}`,i&&"fixed",r&&"disableGutters"]};return(0,yt.A)(s,(e=>(0,Et.Ay)(t,e)),n)})(d,i);return(0,We.jsx)(r,(0,ze.A)({as:a,ownerState:d,className:(0,vt.A)(p.root,s),ref:t},h))}))}({createStyledComponent:(0,At.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`maxWidth${(0,xt.A)(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>(0,st.b)({props:e,name:"MuiContainer"})});function ei(e){return(0,Et.Ay)("MuiToolbar",e)}(0,wt.A)("MuiToolbar",["root","gutters","regular","dense"]);const ti=["className","component","disableGutters","variant"],ni=(0,At.Ay)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableGutters&&t.gutters,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({position:"relative",display:"flex",alignItems:"center"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}},"dense"===n.variant&&{minHeight:48})}),(e=>{let{theme:t,ownerState:n}=e;return"regular"===n.variant&&t.mixins.toolbar})),ii=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiToolbar"}),{className:i,component:r="div",disableGutters:o=!1,variant:s="regular"}=n,a=(0,je.A)(n,ti),l=(0,ze.A)({},n,{component:r,disableGutters:o,variant:s}),c=(e=>{const{classes:t,disableGutters:n,variant:i}=e,r={root:["root",!n&&"gutters",i]};return(0,yt.A)(r,ei,t)})(l);return(0,We.jsx)(ni,(0,ze.A)({as:r,className:(0,vt.A)(c.root,i),ref:t,ownerState:l},a))})),ri=["className","component"];var oi=i(9386),si=i(8279);const ai=(0,wt.A)("MuiBox",["root"]),li=(0,si.A)(),ci=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n,defaultClassName:i="MuiBox-root",generateClassName:r}=e,o=(0,kn.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(Un.A);return s.forwardRef((function(e,s){const a=ut(n),l=(0,Mn.A)(e),{className:c,component:u="div"}=l,h=(0,je.A)(l,ri);return(0,We.jsx)(o,(0,ze.A)({as:u,ref:s,className:(0,vt.A)(c,r?r(i):i),theme:t&&a[t]||a},h))}))}({themeId:it.A,defaultTheme:li,defaultClassName:ai.root,generateClassName:oi.A.generate});var ui=i(9751),hi=i(8604);const di=["component","direction","spacing","divider","children","className","useFlexGap"],pi=(0,lt.A)(),fi=Xn("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function mi(e){return Dn({props:e,name:"MuiStack",defaultTheme:pi})}function gi(e,t){const n=s.Children.toArray(e).filter(Boolean);return n.reduce(((e,i,r)=>(e.push(i),r<n.length-1&&e.push(s.cloneElement(t,{key:`separator-${r}`})),e)),[])}const vi=e=>{let{ownerState:t,theme:n}=e,i=(0,ze.A)({display:"flex",flexDirection:"column"},(0,ui.NI)({theme:n},(0,ui.kW)({values:t.direction,breakpoints:n.breakpoints.values}),(e=>({flexDirection:e}))));if(t.spacing){const e=(0,hi.LX)(n),r=Object.keys(n.breakpoints.values).reduce(((e,n)=>(("object"===typeof t.spacing&&null!=t.spacing[n]||"object"===typeof t.direction&&null!=t.direction[n])&&(e[n]=!0),e)),{}),o=(0,ui.kW)({values:t.direction,base:r}),s=(0,ui.kW)({values:t.spacing,base:r});"object"===typeof o&&Object.keys(o).forEach(((e,t,n)=>{if(!o[e]){const i=t>0?o[n[t-1]]:"column";o[e]=i}}));const a=(n,i)=>{return t.useFlexGap?{gap:(0,hi._W)(e,n)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${r=i?o[i]:t.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[r]}`]:(0,hi._W)(e,n)}};var r};i=(0,On.A)(i,(0,ui.NI)({theme:n},s,a))}return i=(0,ui.iZ)(n.breakpoints,i),i};const yi=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:t=fi,useThemeProps:n=mi,componentName:i="MuiStack"}=e,r=t(vi);return s.forwardRef((function(e,t){const o=n(e),s=(0,Mn.A)(o),{component:a="div",direction:l="column",spacing:c=0,divider:u,children:h,className:d,useFlexGap:p=!1}=s,f=(0,je.A)(s,di),m={direction:l,spacing:c,useFlexGap:p},g=(0,yt.A)({root:["root"]},(e=>(0,Et.Ay)(i,e)),{});return(0,We.jsx)(r,(0,ze.A)({as:a,ownerState:m,ref:t,className:(0,vt.A)(g.root,d)},f,{children:u?gi(h,u):h}))}))}({createStyledComponent:(0,At.Ay)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>(0,st.b)({props:e,name:"MuiStack"})});function Ai(e){return(0,Et.Ay)("MuiIconButton",e)}const xi=(0,wt.A)("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),bi=["edge","children","className","color","disabled","disableFocusRipple","size"],_i=(0,At.Ay)(gn,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"default"!==n.color&&t[`color${(0,xt.A)(n.color)}`],n.edge&&t[`edge${(0,xt.A)(n.edge)}`],t[`size${(0,xt.A)(n.size)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest})},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===n.edge&&{marginLeft:"small"===n.size?-3:-12},"end"===n.edge&&{marginRight:"small"===n.size?-3:-12})}),(e=>{let{theme:t,ownerState:n}=e;var i;const r=null==(i=(t.vars||t).palette)?void 0:i[n.color];return(0,ze.A)({},"inherit"===n.color&&{color:"inherit"},"inherit"!==n.color&&"default"!==n.color&&(0,ze.A)({color:null==r?void 0:r.main},!n.disableRipple&&{"&:hover":(0,ze.A)({},r&&{backgroundColor:t.vars?`rgba(${r.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)(r.main,t.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),"small"===n.size&&{padding:5,fontSize:t.typography.pxToRem(18)},"large"===n.size&&{padding:12,fontSize:t.typography.pxToRem(28)},{[`&.${xi.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}})})),wi=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiIconButton"}),{edge:i=!1,children:r,className:o,color:s="default",disabled:a=!1,disableFocusRipple:l=!1,size:c="medium"}=n,u=(0,je.A)(n,bi),h=(0,ze.A)({},n,{edge:i,color:s,disabled:a,disableFocusRipple:l,size:c}),d=(e=>{const{classes:t,disabled:n,color:i,edge:r,size:o}=e,s={root:["root",n&&"disabled","default"!==i&&`color${(0,xt.A)(i)}`,r&&`edge${(0,xt.A)(r)}`,`size${(0,xt.A)(o)}`]};return(0,yt.A)(s,Ai,t)})(h);return(0,We.jsx)(_i,(0,ze.A)({className:(0,vt.A)(d.root,o),centerRipple:!0,focusRipple:!l,disabled:a,ref:t},u,{ownerState:h,children:r}))})),Ei=e=>{const t=s.useRef({});return s.useEffect((()=>{t.current=e})),t.current};var Si=i(3462);const Ci=function(e){return"string"===typeof e};const Mi=function(e,t,n){return void 0===e||Ci(e)?t:(0,ze.A)({},t,{ownerState:(0,ze.A)({},t.ownerState,n)})};const Ti=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n};const Ri=function(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t]))).forEach((n=>{t[n]=e[n]})),t};const Ii=function(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:i,externalForwardedProps:r,className:o}=e;if(!t){const e=(0,vt.A)(null==n?void 0:n.className,o,null==r?void 0:r.className,null==i?void 0:i.className),t=(0,ze.A)({},null==n?void 0:n.style,null==r?void 0:r.style,null==i?void 0:i.style),s=(0,ze.A)({},n,r,i);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const s=Ti((0,ze.A)({},r,i)),a=Ri(i),l=Ri(r),c=t(s),u=(0,vt.A)(null==c?void 0:c.className,null==n?void 0:n.className,o,null==r?void 0:r.className,null==i?void 0:i.className),h=(0,ze.A)({},null==c?void 0:c.style,null==n?void 0:n.style,null==r?void 0:r.style,null==i?void 0:i.style),d=(0,ze.A)({},c,n,l,a);return u.length>0&&(d.className=u),Object.keys(h).length>0&&(d.style=h),{props:d,internalRef:c.ref}};const Pi=function(e,t,n){return"function"===typeof e?e(t,n):e},Bi=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];const Li=function(e){var t;const{elementType:n,externalSlotProps:i,ownerState:r,skipResolvingSlotProps:o=!1}=e,s=(0,je.A)(e,Bi),a=o?{}:Pi(i,r),{props:l,internalRef:c}=Ii((0,ze.A)({},s,{externalSlotProps:a})),u=(0,Si.A)(c,null==a?void 0:a.ref,null==(t=e.additionalProps)?void 0:t.ref);return Mi(n,(0,ze.A)({},l,{ref:u}),r)};const Ni=function(e){const{badgeContent:t,invisible:n=!1,max:i=99,showZero:r=!1}=e,o=Ei({badgeContent:t,max:i});let s=n;!1!==n||0!==t||r||(s=!0);const{badgeContent:a,max:l=i}=s?o:e;return{badgeContent:a,invisible:s,max:l,displayValue:a&&Number(a)>l?`${l}+`:a}};function Di(e){return(0,Et.Ay)("MuiBadge",e)}const ki=(0,wt.A)("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),Oi=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Ui=(0,At.Ay)("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Fi=(0,At.Ay)("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.badge,t[n.variant],t[`anchorOrigin${(0,xt.A)(n.anchorOrigin.vertical)}${(0,xt.A)(n.anchorOrigin.horizontal)}${(0,xt.A)(n.overlap)}`],"default"!==n.color&&t[`color${(0,xt.A)(n.color)}`],n.invisible&&t.invisible]}})((e=>{let{theme:t}=e;var n;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.keys((null!=(n=t.vars)?n:t).palette).filter((e=>{var n,i;return(null!=(n=t.vars)?n:t).palette[e].main&&(null!=(i=t.vars)?i:t).palette[e].contrastText})).map((e=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main,color:(t.vars||t).palette[e].contrastText}}))),{props:{variant:"dot"},style:{borderRadius:4,height:8,minWidth:8,padding:0}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"rectangular"===t.overlap},style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"right"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:e=>{let{ownerState:t}=e;return"top"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:e=>{let{ownerState:t}=e;return"bottom"===t.anchorOrigin.vertical&&"left"===t.anchorOrigin.horizontal&&"circular"===t.overlap},style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ki.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}})),zi=s.forwardRef((function(e,t){var n,i,r,o,s,a;const l=(0,st.b)({props:e,name:"MuiBadge"}),{anchorOrigin:c={vertical:"top",horizontal:"right"},className:u,component:h,components:d={},componentsProps:p={},children:f,overlap:m="rectangular",color:g="default",invisible:v=!1,max:y=99,badgeContent:A,slots:x,slotProps:b,showZero:_=!1,variant:w="standard"}=l,E=(0,je.A)(l,Oi),{badgeContent:S,invisible:C,max:M,displayValue:T}=Ni({max:y,invisible:v,badgeContent:A,showZero:_}),R=Ei({anchorOrigin:c,color:g,overlap:m,variant:w,badgeContent:A}),I=C||null==S&&"dot"!==w,{color:P=g,overlap:B=m,anchorOrigin:L=c,variant:N=w}=I?R:l,D="dot"!==N?T:void 0,k=(0,ze.A)({},l,{badgeContent:S,invisible:I,max:M,displayValue:D,showZero:_,anchorOrigin:L,color:P,overlap:B,variant:N}),O=(e=>{const{color:t,anchorOrigin:n,invisible:i,overlap:r,variant:o,classes:s={}}=e,a={root:["root"],badge:["badge",o,i&&"invisible",`anchorOrigin${(0,xt.A)(n.vertical)}${(0,xt.A)(n.horizontal)}`,`anchorOrigin${(0,xt.A)(n.vertical)}${(0,xt.A)(n.horizontal)}${(0,xt.A)(r)}`,`overlap${(0,xt.A)(r)}`,"default"!==t&&`color${(0,xt.A)(t)}`]};return(0,yt.A)(a,Di,s)})(k),U=null!=(n=null!=(i=null==x?void 0:x.root)?i:d.Root)?n:Ui,F=null!=(r=null!=(o=null==x?void 0:x.badge)?o:d.Badge)?r:Fi,z=null!=(s=null==b?void 0:b.root)?s:p.root,j=null!=(a=null==b?void 0:b.badge)?a:p.badge,V=Li({elementType:U,externalSlotProps:z,externalForwardedProps:E,additionalProps:{ref:t,as:h},ownerState:k,className:(0,vt.A)(null==z?void 0:z.className,O.root,u)}),G=Li({elementType:F,externalSlotProps:j,ownerState:k,className:(0,vt.A)(O.badge,null==j?void 0:j.className)});return(0,We.jsxs)(U,(0,ze.A)({},V,{children:[f,(0,We.jsx)(F,(0,ze.A)({},G,{children:D}))]}))}));var ji=i(9662);const Vi=(0,ji.A)((0,We.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function Gi(e){return(0,Et.Ay)("MuiAvatar",e)}(0,wt.A)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const Hi=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Wi=["component","slots","slotProps"],Qi=["component"];function qi(e,t){const{className:n,elementType:i,ownerState:r,externalForwardedProps:o,getSlotOwnerState:s,internalForwardedProps:a}=t,l=(0,je.A)(t,Hi),{component:c,slots:u={[e]:void 0},slotProps:h={[e]:void 0}}=o,d=(0,je.A)(o,Wi),p=u[e]||i,f=Pi(h[e],r),m=Ii((0,ze.A)({className:n},l,{externalForwardedProps:"root"===e?d:void 0,externalSlotProps:f})),{props:{component:g},internalRef:v}=m,y=(0,je.A)(m.props,Qi),A=(0,Si.A)(v,null==f?void 0:f.ref,t.ref),x=s?s(y):{},b=(0,ze.A)({},r,x),_="root"===e?g||c:g,w=Mi(p,(0,ze.A)({},"root"===e&&!c&&!u[e]&&a,"root"!==e&&!u[e]&&a,y,_&&{as:_},{ref:A}),b);return Object.keys(x).forEach((e=>{delete w[e]})),[p,w]}const Xi=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],$i=(0,At.Ay)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],n.colorDefault&&t.colorDefault]}})((e=>{let{theme:t}=e;return{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,ze.A)({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:(0,ze.A)({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]}})),Yi=(0,At.Ay)("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),Ki=(0,At.Ay)(Vi,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"});const Ji=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiAvatar"}),{alt:i,children:r,className:o,component:a="div",slots:l={},slotProps:c={},imgProps:u,sizes:h,src:d,srcSet:p,variant:f="circular"}=n,m=(0,je.A)(n,Xi);let g=null;const v=function(e){let{crossOrigin:t,referrerPolicy:n,src:i,srcSet:r}=e;const[o,a]=s.useState(!1);return s.useEffect((()=>{if(!i&&!r)return;a(!1);let e=!0;const o=new Image;return o.onload=()=>{e&&a("loaded")},o.onerror=()=>{e&&a("error")},o.crossOrigin=t,o.referrerPolicy=n,o.src=i,r&&(o.srcset=r),()=>{e=!1}}),[t,n,i,r]),o}((0,ze.A)({},u,{src:d,srcSet:p})),y=d||p,A=y&&"error"!==v,x=(0,ze.A)({},n,{colorDefault:!A,component:a,variant:f}),b=(e=>{const{classes:t,variant:n,colorDefault:i}=e,r={root:["root",n,i&&"colorDefault"],img:["img"],fallback:["fallback"]};return(0,yt.A)(r,Gi,t)})(x),[_,w]=qi("img",{className:b.img,elementType:Yi,externalForwardedProps:{slots:l,slotProps:{img:(0,ze.A)({},u,c.img)}},additionalProps:{alt:i,src:d,srcSet:p,sizes:h},ownerState:x});return g=A?(0,We.jsx)(_,(0,ze.A)({},w)):r||0===r?r:y&&i?i[0]:(0,We.jsx)(Ki,{ownerState:x,className:b.fallback}),(0,We.jsx)($i,(0,ze.A)({as:a,ownerState:x,className:(0,vt.A)(b.root,o),ref:t},m,{children:g}))}));var Zi=i(2427);const er=s.createContext({});function tr(e){return(0,Et.Ay)("MuiList",e)}(0,wt.A)("MuiList",["root","padding","dense","subheader"]);const nr=["children","className","component","dense","disablePadding","subheader"],ir=(0,At.Ay)("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disablePadding&&t.padding,n.dense&&t.dense,n.subheader&&t.subheader]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})})),rr=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiList"}),{children:i,className:r,component:o="ul",dense:a=!1,disablePadding:l=!1,subheader:c}=n,u=(0,je.A)(n,nr),h=s.useMemo((()=>({dense:a})),[a]),d=(0,ze.A)({},n,{component:o,dense:a,disablePadding:l}),p=(e=>{const{classes:t,disablePadding:n,dense:i,subheader:r}=e,o={root:["root",!n&&"padding",i&&"dense",r&&"subheader"]};return(0,yt.A)(o,tr,t)})(d);return(0,We.jsx)(er.Provider,{value:h,children:(0,We.jsxs)(ir,(0,ze.A)({as:o,className:(0,vt.A)(p.root,r),ref:t,ownerState:d},u,{children:[c,i]}))})}));function or(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}const sr=or;var ar=i(5013);const lr=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function cr(e,t,n){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:n?null:e.firstChild}function ur(e,t,n){return e===t?n?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:n?null:e.lastChild}function hr(e,t){if(void 0===t)return!0;let n=e.innerText;return void 0===n&&(n=e.textContent),n=n.trim().toLowerCase(),0!==n.length&&(t.repeating?n[0]===t.keys[0]:0===n.indexOf(t.keys.join("")))}function dr(e,t,n,i,r,o){let s=!1,a=r(e,t,!!t&&n);for(;a;){if(a===e.firstChild){if(s)return!1;s=!0}const t=!i&&(a.disabled||"true"===a.getAttribute("aria-disabled"));if(a.hasAttribute("tabindex")&&hr(a,o)&&!t)return a.focus(),!0;a=r(e,a,n)}return!1}const pr=s.forwardRef((function(e,t){const{actions:n,autoFocus:i=!1,autoFocusItem:r=!1,children:o,className:a,disabledItemsFocusable:l=!1,disableListWrap:c=!1,onKeyDown:u,variant:h="selectedMenu"}=e,d=(0,je.A)(e,lr),p=s.useRef(null),f=s.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});(0,ar.A)((()=>{i&&p.current.focus()}),[i]),s.useImperativeHandle(n,(()=>({adjustStyleForScrollbar:(e,t)=>{let{direction:n}=t;const i=!p.current.style.width;if(e.clientHeight<p.current.clientHeight&&i){const t=`${sr((0,Zi.A)(e))}px`;p.current.style["rtl"===n?"paddingLeft":"paddingRight"]=t,p.current.style.width=`calc(100% + ${t})`}return p.current}})),[]);const m=(0,kt.A)(p,t);let g=-1;s.Children.forEach(o,((e,t)=>{s.isValidElement(e)?(e.props.disabled||("selectedMenu"===h&&e.props.selected||-1===g)&&(g=t),g===t&&(e.props.disabled||e.props.muiSkipListHighlight||e.type.muiSkipListHighlight)&&(g+=1,g>=o.length&&(g=-1))):g===t&&(g+=1,g>=o.length&&(g=-1))}));const v=s.Children.map(o,((e,t)=>{if(t===g){const t={};return r&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===h&&(t.tabIndex=0),s.cloneElement(e,t)}return e}));return(0,We.jsx)(rr,(0,ze.A)({role:"menu",ref:m,className:a,onKeyDown:e=>{const t=p.current,n=e.key,i=(0,Zi.A)(t).activeElement;if("ArrowDown"===n)e.preventDefault(),dr(t,i,c,l,cr);else if("ArrowUp"===n)e.preventDefault(),dr(t,i,c,l,ur);else if("Home"===n)e.preventDefault(),dr(t,null,c,l,cr);else if("End"===n)e.preventDefault(),dr(t,null,c,l,ur);else if(1===n.length){const r=f.current,o=n.toLowerCase(),s=performance.now();r.keys.length>0&&(s-r.lastTime>500?(r.keys=[],r.repeating=!0,r.previousKeyMatched=!0):r.repeating&&o!==r.keys[0]&&(r.repeating=!1)),r.lastTime=s,r.keys.push(o);const a=i&&!r.repeating&&hr(i,r);r.previousKeyMatched&&(a||dr(t,i,!1,l,cr,r))?e.preventDefault():r.previousKeyMatched=!1}u&&u(e)},tabIndex:i?0:-1},d,{children:v}))}));var fr=i(950),mr=i(6078);function gr(e){var t;return parseInt(s.version,10)>=19?(null==e||null==(t=e.props)?void 0:t.ref)||null:(null==e?void 0:e.ref)||null}const vr=!1;var yr="unmounted",Ar="exited",xr="entering",br="entered",_r="exiting",wr=function(e){function t(t,n){var i;i=e.call(this,t,n)||this;var r,o=n&&!n.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?o?(r=Ar,i.appearStatus=xr):r=br:r=t.unmountOnExit||t.mountOnEnter?yr:Ar,i.state={status:r},i.nextCallback=null,i}jt(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===yr?{status:Ar}:null};var n=t.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==xr&&n!==br&&(t=xr):n!==xr&&n!==br||(t=_r)}this.updateStatus(!1,t)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!==typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},n.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===xr){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:c.findDOMNode(this);n&&function(e){e.scrollTop}(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Ar&&this.setState({status:yr})},n.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[c.findDOMNode(this),i],o=r[0],s=r[1],a=this.getTimeouts(),l=i?a.appear:a.enter;!e&&!n||vr?this.safeSetState({status:br},(function(){t.props.onEntered(o)})):(this.props.onEnter(o,s),this.safeSetState({status:xr},(function(){t.props.onEntering(o,s),t.onTransitionEnd(l,(function(){t.safeSetState({status:br},(function(){t.props.onEntered(o,s)}))}))})))},n.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:c.findDOMNode(this);t&&!vr?(this.props.onExit(i),this.safeSetState({status:_r},(function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:Ar},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:Ar},(function(){e.props.onExited(i)}))},n.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},n.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},n.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:c.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=r[0],s=r[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},n.render=function(){var e=this.state.status;if(e===yr)return null;var t=this.props,n=t.children,i=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,je.A)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return s.createElement(Vt.Provider,{value:null},"function"===typeof n?n(e,i):s.cloneElement(s.Children.only(n),i))},t}(s.Component);function Er(){}wr.contextType=Vt,wr.propTypes={},wr.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Er,onEntering:Er,onEntered:Er,onExit:Er,onExiting:Er,onExited:Er},wr.UNMOUNTED=yr,wr.EXITED=Ar,wr.ENTERING=xr,wr.ENTERED=br,wr.EXITING=_r;const Sr=wr;function Cr(){const e=ut(dt.A);return e[it.A]||e}const Mr=e=>e.scrollTop;function Tr(e,t){var n,i;const{timeout:r,easing:o,style:s={}}=e;return{duration:null!=(n=s.transitionDuration)?n:"number"===typeof r?r:r[t.mode]||0,easing:null!=(i=s.transitionTimingFunction)?i:"object"===typeof o?o[t.mode]:o,delay:s.transitionDelay}}const Rr=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function Ir(e){return`scale(${e}, ${e**2})`}const Pr={entering:{opacity:1,transform:Ir(1)},entered:{opacity:1,transform:"none"}},Br="undefined"!==typeof navigator&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),Lr=s.forwardRef((function(e,t){const{addEndListener:n,appear:i=!0,children:r,easing:o,in:a,onEnter:l,onEntered:c,onEntering:u,onExit:h,onExited:d,onExiting:p,style:f,timeout:m="auto",TransitionComponent:g=Sr}=e,v=(0,je.A)(e,Rr),y=(0,Yt.A)(),A=s.useRef(),x=Cr(),b=s.useRef(null),_=(0,kt.A)(b,gr(r),t),w=e=>t=>{if(e){const n=b.current;void 0===t?e(n):e(n,t)}},E=w(u),S=w(((e,t)=>{Mr(e);const{duration:n,delay:i,easing:r}=Tr({style:f,timeout:m,easing:o},{mode:"enter"});let s;"auto"===m?(s=x.transitions.getAutoHeightDuration(e.clientHeight),A.current=s):s=n,e.style.transition=[x.transitions.create("opacity",{duration:s,delay:i}),x.transitions.create("transform",{duration:Br?s:.666*s,delay:i,easing:r})].join(","),l&&l(e,t)})),C=w(c),M=w(p),T=w((e=>{const{duration:t,delay:n,easing:i}=Tr({style:f,timeout:m,easing:o},{mode:"exit"});let r;"auto"===m?(r=x.transitions.getAutoHeightDuration(e.clientHeight),A.current=r):r=t,e.style.transition=[x.transitions.create("opacity",{duration:r,delay:n}),x.transitions.create("transform",{duration:Br?r:.666*r,delay:Br?n:n||.333*r,easing:i})].join(","),e.style.opacity=0,e.style.transform=Ir(.75),h&&h(e)})),R=w(d);return(0,We.jsx)(g,(0,ze.A)({appear:i,in:a,nodeRef:b,onEnter:S,onEntered:C,onEntering:E,onExit:T,onExited:R,onExiting:M,addEndListener:e=>{"auto"===m&&y.start(A.current||0,e),n&&n(b.current,e)},timeout:"auto"===m?null:m},v,{children:(e,t)=>s.cloneElement(r,(0,ze.A)({style:(0,ze.A)({opacity:0,transform:Ir(.75),visibility:"exited"!==e||a?void 0:"hidden"},Pr[e],f,r.props.style),ref:_},t))}))}));Lr.muiSupportAuto=!0;const Nr=Lr;var Dr=i(1668);const kr=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Or(e){const t=[],n=[];return Array.from(e.querySelectorAll(kr)).forEach(((e,i)=>{const r=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==r&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let n=t(`[name="${e.name}"]:checked`);return n||(n=t(`[name="${e.name}"]`)),n!==e}(e))}(e)&&(0===r?t.push(e):n.push({documentOrder:i,tabIndex:r,node:e}))})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function Ur(){return!0}const Fr=function(e){const{children:t,disableAutoFocus:n=!1,disableEnforceFocus:i=!1,disableRestoreFocus:r=!1,getTabbable:o=Or,isEnabled:a=Ur,open:l}=e,c=s.useRef(!1),u=s.useRef(null),h=s.useRef(null),d=s.useRef(null),p=s.useRef(null),f=s.useRef(!1),m=s.useRef(null),g=(0,Si.A)(gr(t),m),v=s.useRef(null);s.useEffect((()=>{l&&m.current&&(f.current=!n)}),[n,l]),s.useEffect((()=>{if(!l||!m.current)return;const e=(0,Dr.A)(m.current);return m.current.contains(e.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),f.current&&m.current.focus()),()=>{r||(d.current&&d.current.focus&&(c.current=!0,d.current.focus()),d.current=null)}}),[l]),s.useEffect((()=>{if(!l||!m.current)return;const e=(0,Dr.A)(m.current),t=t=>{v.current=t,!i&&a()&&"Tab"===t.key&&e.activeElement===m.current&&t.shiftKey&&(c.current=!0,h.current&&h.current.focus())},n=()=>{const t=m.current;if(null===t)return;if(!e.hasFocus()||!a()||c.current)return void(c.current=!1);if(t.contains(e.activeElement))return;if(i&&e.activeElement!==u.current&&e.activeElement!==h.current)return;if(e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!f.current)return;let n=[];if(e.activeElement!==u.current&&e.activeElement!==h.current||(n=o(m.current)),n.length>0){var r,s;const e=Boolean((null==(r=v.current)?void 0:r.shiftKey)&&"Tab"===(null==(s=v.current)?void 0:s.key)),t=n[0],i=n[n.length-1];"string"!==typeof t&&"string"!==typeof i&&(e?i.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const r=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()}),50);return()=>{clearInterval(r),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}}),[n,i,r,a,l,o]);const y=e=>{null===d.current&&(d.current=e.relatedTarget),f.current=!0};return(0,We.jsxs)(s.Fragment,{children:[(0,We.jsx)("div",{tabIndex:l?0:-1,onFocus:y,ref:u,"data-testid":"sentinelStart"}),s.cloneElement(t,{ref:g,onFocus:e=>{null===d.current&&(d.current=e.relatedTarget),f.current=!0,p.current=e.target;const n=t.props.onFocus;n&&n(e)}}),(0,We.jsx)("div",{tabIndex:l?0:-1,onFocus:y,ref:h,"data-testid":"sentinelEnd"})]})};var zr=i(4440),jr=i(6564);const Vr=s.forwardRef((function(e,t){const{children:n,container:i,disablePortal:r=!1}=e,[o,a]=s.useState(null),l=(0,Si.A)(s.isValidElement(n)?gr(n):null,t);if((0,zr.A)((()=>{r||a(function(e){return"function"===typeof e?e():e}(i)||document.body)}),[i,r]),(0,zr.A)((()=>{if(o&&!r)return(0,jr.A)(t,o),()=>{(0,jr.A)(t,null)}}),[t,o,r]),r){if(s.isValidElement(n)){const e={ref:l};return s.cloneElement(n,e)}return(0,We.jsx)(s.Fragment,{children:n})}return(0,We.jsx)(s.Fragment,{children:o?c.createPortal(n,o):o})})),Gr=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],Hr={entering:{opacity:1},entered:{opacity:1}},Wr=s.forwardRef((function(e,t){const n=Cr(),i={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{addEndListener:r,appear:o=!0,children:a,easing:l,in:c,onEnter:u,onEntered:h,onEntering:d,onExit:p,onExited:f,onExiting:m,style:g,timeout:v=i,TransitionComponent:y=Sr}=e,A=(0,je.A)(e,Gr),x=s.useRef(null),b=(0,kt.A)(x,gr(a),t),_=e=>t=>{if(e){const n=x.current;void 0===t?e(n):e(n,t)}},w=_(d),E=_(((e,t)=>{Mr(e);const i=Tr({style:g,timeout:v,easing:l},{mode:"enter"});e.style.webkitTransition=n.transitions.create("opacity",i),e.style.transition=n.transitions.create("opacity",i),u&&u(e,t)})),S=_(h),C=_(m),M=_((e=>{const t=Tr({style:g,timeout:v,easing:l},{mode:"exit"});e.style.webkitTransition=n.transitions.create("opacity",t),e.style.transition=n.transitions.create("opacity",t),p&&p(e)})),T=_(f);return(0,We.jsx)(y,(0,ze.A)({appear:o,in:c,nodeRef:x,onEnter:E,onEntered:S,onEntering:w,onExit:M,onExited:T,onExiting:C,addEndListener:e=>{r&&r(x.current,e)},timeout:v},A,{children:(e,t)=>s.cloneElement(a,(0,ze.A)({style:(0,ze.A)({opacity:0,visibility:"exited"!==e||c?void 0:"hidden"},Hr[e],g,a.props.style),ref:b},t))}))}));function Qr(e){return(0,Et.Ay)("MuiBackdrop",e)}(0,wt.A)("MuiBackdrop",["root","invisible"]);const qr=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],Xr=(0,At.Ay)("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.invisible&&t.invisible]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})})),$r=s.forwardRef((function(e,t){var n,i,r;const o=(0,st.b)({props:e,name:"MuiBackdrop"}),{children:s,className:a,component:l="div",components:c={},componentsProps:u={},invisible:h=!1,open:d,slotProps:p={},slots:f={},TransitionComponent:m=Wr,transitionDuration:g}=o,v=(0,je.A)(o,qr),y=(0,ze.A)({},o,{component:l,invisible:h}),A=(e=>{const{classes:t,invisible:n}=e,i={root:["root",n&&"invisible"]};return(0,yt.A)(i,Qr,t)})(y),x=null!=(n=p.root)?n:u.root;return(0,We.jsx)(m,(0,ze.A)({in:d,timeout:g},v,{children:(0,We.jsx)(Xr,(0,ze.A)({"aria-hidden":!0},x,{as:null!=(i=null!=(r=f.root)?r:c.Root)?i:l,className:(0,vt.A)(A.root,a,null==x?void 0:x.className),ownerState:(0,ze.A)({},y,null==x?void 0:x.ownerState),classes:A,ref:t,children:s}))}))}));var Yr=i(1782),Kr=i(2456),Jr=i(3940);function Zr(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function eo(e){return parseInt((0,Jr.A)(e).getComputedStyle(e).paddingRight,10)||0}function to(e,t,n,i,r){const o=[t,n,...i];[].forEach.call(e.children,(e=>{const t=-1===o.indexOf(e),n=!function(e){const t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}(e);t&&n&&Zr(e,r)}))}function no(e,t){let n=-1;return e.some(((e,i)=>!!t(e)&&(n=i,!0))),n}function io(e,t){const n=[],i=e.container;if(!t.disableScrollLock){if(function(e){const t=(0,Dr.A)(e);return t.body===e?(0,Jr.A)(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(i)){const e=or((0,Dr.A)(i));n.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight=`${eo(i)+e}px`;const t=(0,Dr.A)(i).querySelectorAll(".mui-fixed");[].forEach.call(t,(t=>{n.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight=`${eo(t)+e}px`}))}let e;if(i.parentNode instanceof DocumentFragment)e=(0,Dr.A)(i).body;else{const t=i.parentElement,n=(0,Jr.A)(i);e="HTML"===(null==t?void 0:t.nodeName)&&"scroll"===n.getComputedStyle(t).overflowY?t:i}n.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{n.forEach((e=>{let{value:t,el:n,property:i}=e;t?n.style.setProperty(i,t):n.style.removeProperty(i)}))}}const ro=new class{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&Zr(e.modalRef,!1);const i=function(e){const t=[];return[].forEach.call(e.children,(e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);to(t,e.mount,e.modalRef,i,!0);const r=no(this.containers,(e=>e.container===t));return-1!==r?(this.containers[r].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:i}),n)}mount(e,t){const n=no(this.containers,(t=>-1!==t.modals.indexOf(e))),i=this.containers[n];i.restore||(i.restore=io(i,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.modals.indexOf(e);if(-1===n)return n;const i=no(this.containers,(t=>-1!==t.modals.indexOf(e))),r=this.containers[i];if(r.modals.splice(r.modals.indexOf(e),1),this.modals.splice(n,1),0===r.modals.length)r.restore&&r.restore(),e.modalRef&&Zr(e.modalRef,t),to(r.container,e.mount,e.modalRef,r.hiddenSiblings,!1),this.containers.splice(i,1);else{const e=r.modals[r.modals.length-1];e.modalRef&&Zr(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};const oo=function(e){const{container:t,disableEscapeKeyDown:n=!1,disableScrollLock:i=!1,manager:r=ro,closeAfterTransition:o=!1,onTransitionEnter:a,onTransitionExited:l,children:c,onClose:u,open:h,rootRef:d}=e,p=s.useRef({}),f=s.useRef(null),m=s.useRef(null),g=(0,Si.A)(m,d),[v,y]=s.useState(!h),A=function(e){return!!e&&e.props.hasOwnProperty("in")}(c);let x=!0;"false"!==e["aria-hidden"]&&!1!==e["aria-hidden"]||(x=!1);const b=()=>(p.current.modalRef=m.current,p.current.mount=f.current,p.current),_=()=>{r.mount(b(),{disableScrollLock:i}),m.current&&(m.current.scrollTop=0)},w=(0,Yr.A)((()=>{const e=function(e){return"function"===typeof e?e():e}(t)||(0,Dr.A)(f.current).body;r.add(b(),e),m.current&&_()})),E=s.useCallback((()=>r.isTopModal(b())),[r]),S=(0,Yr.A)((e=>{f.current=e,e&&(h&&E()?_():m.current&&Zr(m.current,x))})),C=s.useCallback((()=>{r.remove(b(),x)}),[x,r]);s.useEffect((()=>()=>{C()}),[C]),s.useEffect((()=>{h?w():A&&o||C()}),[h,C,A,o,w]);const M=e=>t=>{var i;null==(i=e.onKeyDown)||i.call(e,t),"Escape"===t.key&&229!==t.which&&E()&&(n||(t.stopPropagation(),u&&u(t,"escapeKeyDown")))},T=e=>t=>{var n;null==(n=e.onClick)||n.call(e,t),t.target===t.currentTarget&&u&&u(t,"backdropClick")};return{getRootProps:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Ti(e);delete n.onTransitionEnter,delete n.onTransitionExited;const i=(0,ze.A)({},n,t);return(0,ze.A)({role:"presentation"},i,{onKeyDown:M(i),ref:g})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ze.A)({"aria-hidden":!0},e,{onClick:T(e),open:h})},getTransitionProps:()=>({onEnter:(0,Kr.A)((()=>{y(!1),a&&a()}),null==c?void 0:c.props.onEnter),onExited:(0,Kr.A)((()=>{y(!0),l&&l(),o&&C()}),null==c?void 0:c.props.onExited)}),rootRef:g,portalRef:S,isTopModal:E,exited:v,hasTransition:A}};function so(e){return(0,Et.Ay)("MuiModal",e)}(0,wt.A)("MuiModal",["root","hidden","backdrop"]);const ao=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],lo=(0,At.Ay)("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.open&&n.exited&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),co=(0,At.Ay)($r,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),uo=s.forwardRef((function(e,t){var n,i,r,o,a,l;const c=(0,st.b)({name:"MuiModal",props:e}),{BackdropComponent:u=co,BackdropProps:h,className:d,closeAfterTransition:p=!1,children:f,container:m,component:g,components:v={},componentsProps:y={},disableAutoFocus:A=!1,disableEnforceFocus:x=!1,disableEscapeKeyDown:b=!1,disablePortal:_=!1,disableRestoreFocus:w=!1,disableScrollLock:E=!1,hideBackdrop:S=!1,keepMounted:C=!1,onBackdropClick:M,open:T,slotProps:R,slots:I}=c,P=(0,je.A)(c,ao),B=(0,ze.A)({},c,{closeAfterTransition:p,disableAutoFocus:A,disableEnforceFocus:x,disableEscapeKeyDown:b,disablePortal:_,disableRestoreFocus:w,disableScrollLock:E,hideBackdrop:S,keepMounted:C}),{getRootProps:L,getBackdropProps:N,getTransitionProps:D,portalRef:k,isTopModal:O,exited:U,hasTransition:F}=oo((0,ze.A)({},B,{rootRef:t})),z=(0,ze.A)({},B,{exited:U}),j=(e=>{const{open:t,exited:n,classes:i}=e,r={root:["root",!t&&n&&"hidden"],backdrop:["backdrop"]};return(0,yt.A)(r,so,i)})(z),V={};if(void 0===f.props.tabIndex&&(V.tabIndex="-1"),F){const{onEnter:e,onExited:t}=D();V.onEnter=e,V.onExited=t}const G=null!=(n=null!=(i=null==I?void 0:I.root)?i:v.Root)?n:lo,H=null!=(r=null!=(o=null==I?void 0:I.backdrop)?o:v.Backdrop)?r:u,W=null!=(a=null==R?void 0:R.root)?a:y.root,Q=null!=(l=null==R?void 0:R.backdrop)?l:y.backdrop,q=Li({elementType:G,externalSlotProps:W,externalForwardedProps:P,getSlotProps:L,additionalProps:{ref:t,as:g},ownerState:z,className:(0,vt.A)(d,null==W?void 0:W.className,null==j?void 0:j.root,!z.open&&z.exited&&(null==j?void 0:j.hidden))}),X=Li({elementType:H,externalSlotProps:Q,additionalProps:h,getSlotProps:e=>N((0,ze.A)({},e,{onClick:t=>{M&&M(t),null!=e&&e.onClick&&e.onClick(t)}})),className:(0,vt.A)(null==Q?void 0:Q.className,null==h?void 0:h.className,null==j?void 0:j.backdrop),ownerState:z});return C||T||F&&!U?(0,We.jsx)(Vr,{ref:k,container:m,disablePortal:_,children:(0,We.jsxs)(G,(0,ze.A)({},q,{children:[!S&&u?(0,We.jsx)(H,(0,ze.A)({},X)):null,(0,We.jsx)(Fr,{disableEnforceFocus:x,disableAutoFocus:A,disableRestoreFocus:w,isEnabled:O,open:T,children:s.cloneElement(f,V)})]}))}):null}));function ho(e){return(0,Et.Ay)("MuiPopover",e)}(0,wt.A)("MuiPopover",["root","paper"]);const po=["onEntering"],fo=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"],mo=["slotProps"];function go(e,t){let n=0;return"number"===typeof t?n=t:"center"===t?n=e.height/2:"bottom"===t&&(n=e.height),n}function vo(e,t){let n=0;return"number"===typeof t?n=t:"center"===t?n=e.width/2:"right"===t&&(n=e.width),n}function yo(e){return[e.horizontal,e.vertical].map((e=>"number"===typeof e?`${e}px`:e)).join(" ")}function Ao(e){return"function"===typeof e?e():e}const xo=(0,At.Ay)(uo,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),bo=(0,At.Ay)(Tt,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),_o=s.forwardRef((function(e,t){var n,i,r;const o=(0,st.b)({props:e,name:"MuiPopover"}),{action:a,anchorEl:l,anchorOrigin:c={vertical:"top",horizontal:"left"},anchorPosition:u,anchorReference:h="anchorEl",children:d,className:p,container:f,elevation:m=8,marginThreshold:g=16,open:v,PaperProps:y={},slots:A,slotProps:x,transformOrigin:b={vertical:"top",horizontal:"left"},TransitionComponent:_=Nr,transitionDuration:w="auto",TransitionProps:{onEntering:E}={},disableScrollLock:S=!1}=o,C=(0,je.A)(o.TransitionProps,po),M=(0,je.A)(o,fo),T=null!=(n=null==x?void 0:x.paper)?n:y,R=s.useRef(),I=(0,kt.A)(R,T.ref),P=(0,ze.A)({},o,{anchorOrigin:c,anchorReference:h,elevation:m,marginThreshold:g,externalPaperSlotProps:T,transformOrigin:b,TransitionComponent:_,transitionDuration:w,TransitionProps:C}),B=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"],paper:["paper"]},ho,t)})(P),L=s.useCallback((()=>{if("anchorPosition"===h)return u;const e=Ao(l),t=(e&&1===e.nodeType?e:(0,Zi.A)(R.current).body).getBoundingClientRect();return{top:t.top+go(t,c.vertical),left:t.left+vo(t,c.horizontal)}}),[l,c.horizontal,c.vertical,u,h]),N=s.useCallback((e=>({vertical:go(e,b.vertical),horizontal:vo(e,b.horizontal)})),[b.horizontal,b.vertical]),D=s.useCallback((e=>{const t={width:e.offsetWidth,height:e.offsetHeight},n=N(t);if("none"===h)return{top:null,left:null,transformOrigin:yo(n)};const i=L();let r=i.top-n.vertical,o=i.left-n.horizontal;const s=r+t.height,a=o+t.width,c=(0,mr.A)(Ao(l)),u=c.innerHeight-g,d=c.innerWidth-g;if(null!==g&&r<g){const e=r-g;r-=e,n.vertical+=e}else if(null!==g&&s>u){const e=s-u;r-=e,n.vertical+=e}if(null!==g&&o<g){const e=o-g;o-=e,n.horizontal+=e}else if(a>d){const e=a-d;o-=e,n.horizontal+=e}return{top:`${Math.round(r)}px`,left:`${Math.round(o)}px`,transformOrigin:yo(n)}}),[l,h,L,N,g]),[k,O]=s.useState(v),U=s.useCallback((()=>{const e=R.current;if(!e)return;const t=D(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin,O(!0)}),[D]);s.useEffect((()=>(S&&window.addEventListener("scroll",U),()=>window.removeEventListener("scroll",U))),[l,S,U]);s.useEffect((()=>{v&&U()})),s.useImperativeHandle(a,(()=>v?{updatePosition:()=>{U()}}:null),[v,U]),s.useEffect((()=>{if(!v)return;const e=(0,fr.A)((()=>{U()})),t=(0,mr.A)(l);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[l,v,U]);let F=w;"auto"!==w||_.muiSupportAuto||(F=void 0);const z=f||(l?(0,Zi.A)(Ao(l)).body:void 0),j=null!=(i=null==A?void 0:A.root)?i:xo,V=null!=(r=null==A?void 0:A.paper)?r:bo,G=Li({elementType:V,externalSlotProps:(0,ze.A)({},T,{style:k?T.style:(0,ze.A)({},T.style,{opacity:0})}),additionalProps:{elevation:m,ref:I},ownerState:P,className:(0,vt.A)(B.paper,null==T?void 0:T.className)}),H=Li({elementType:j,externalSlotProps:(null==x?void 0:x.root)||{},externalForwardedProps:M,additionalProps:{ref:t,slotProps:{backdrop:{invisible:!0}},container:z,open:v},ownerState:P,className:(0,vt.A)(B.root,p)}),{slotProps:W}=H,Q=(0,je.A)(H,mo);return(0,We.jsx)(j,(0,ze.A)({},Q,!Ci(j)&&{slotProps:W,disableScrollLock:S},{children:(0,We.jsx)(_,(0,ze.A)({appear:!0,in:v,onEntering:(e,t)=>{E&&E(e,t),U()},onExited:()=>{O(!1)},timeout:F},C,{children:(0,We.jsx)(V,(0,ze.A)({},G,{children:d}))}))}))}));function wo(e){return(0,Et.Ay)("MuiMenu",e)}(0,wt.A)("MuiMenu",["root","paper","list"]);const Eo=["onEntering"],So=["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"],Co={vertical:"top",horizontal:"right"},Mo={vertical:"top",horizontal:"left"},To=(0,At.Ay)(_o,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Ro=(0,At.Ay)(bo,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Io=(0,At.Ay)(pr,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),Po=s.forwardRef((function(e,t){var n,i;const r=(0,st.b)({props:e,name:"MuiMenu"}),{autoFocus:o=!0,children:a,className:l,disableAutoFocusItem:c=!1,MenuListProps:u={},onClose:h,open:d,PaperProps:p={},PopoverClasses:f,transitionDuration:m="auto",TransitionProps:{onEntering:g}={},variant:v="selectedMenu",slots:y={},slotProps:A={}}=r,x=(0,je.A)(r.TransitionProps,Eo),b=(0,je.A)(r,So),_=Ke(),w=(0,ze.A)({},r,{autoFocus:o,disableAutoFocusItem:c,MenuListProps:u,onEntering:g,PaperProps:p,transitionDuration:m,TransitionProps:x,variant:v}),E=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"],paper:["paper"],list:["list"]},wo,t)})(w),S=o&&!c&&d,C=s.useRef(null);let M=-1;s.Children.map(a,((e,t)=>{s.isValidElement(e)&&(e.props.disabled||("selectedMenu"===v&&e.props.selected||-1===M)&&(M=t))}));const T=null!=(n=y.paper)?n:Ro,R=null!=(i=A.paper)?i:p,I=Li({elementType:y.root,externalSlotProps:A.root,ownerState:w,className:[E.root,l]}),P=Li({elementType:T,externalSlotProps:R,ownerState:w,className:E.paper});return(0,We.jsx)(To,(0,ze.A)({onClose:h,anchorOrigin:{vertical:"bottom",horizontal:_?"right":"left"},transformOrigin:_?Co:Mo,slots:{paper:T,root:y.root},slotProps:{root:I,paper:P},open:d,ref:t,transitionDuration:m,TransitionProps:(0,ze.A)({onEntering:(e,t)=>{C.current&&C.current.adjustStyleForScrollbar(e,{direction:_?"rtl":"ltr"}),g&&g(e,t)}},x),ownerState:w},b,{classes:f,children:(0,We.jsx)(Io,(0,ze.A)({onKeyDown:e=>{"Tab"===e.key&&(e.preventDefault(),h&&h(e,"tabKeyDown"))},actions:C,autoFocus:o&&(-1===M||c),autoFocusItem:S,variant:v},u,{className:(0,vt.A)(E.list,u.className),children:a}))}))}));function Bo(e){return(0,Et.Ay)("MuiDivider",e)}const Lo=(0,wt.A)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);function No(e){return(0,Et.Ay)("MuiListItemIcon",e)}const Do=(0,wt.A)("MuiListItemIcon",["root","alignItemsFlexStart"]);function ko(e){return(0,Et.Ay)("MuiListItemText",e)}const Oo=(0,wt.A)("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function Uo(e){return(0,Et.Ay)("MuiMenuItem",e)}const Fo=(0,wt.A)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),zo=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],jo=(0,At.Ay)(gn,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.divider&&t.divider,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Fo.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${Fo.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${Fo.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${Fo.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Fo.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${Lo.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${Lo.inset}`]:{marginLeft:52},[`& .${Oo.root}`]:{marginTop:0,marginBottom:0},[`& .${Oo.inset}`]:{paddingLeft:36},[`& .${Do.root}`]:{minWidth:36}},!n.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&(0,ze.A)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${Do.root} svg`]:{fontSize:"1.25rem"}}))})),Vo=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiMenuItem"}),{autoFocus:i=!1,component:r="li",dense:o=!1,divider:a=!1,disableGutters:l=!1,focusVisibleClassName:c,role:u="menuitem",tabIndex:h,className:d}=n,p=(0,je.A)(n,zo),f=s.useContext(er),m=s.useMemo((()=>({dense:o||f.dense||!1,disableGutters:l})),[f.dense,o,l]),g=s.useRef(null);(0,ar.A)((()=>{i&&g.current&&g.current.focus()}),[i]);const v=(0,ze.A)({},n,{dense:m.dense,divider:a,disableGutters:l}),y=(e=>{const{disabled:t,dense:n,divider:i,disableGutters:r,selected:o,classes:s}=e,a={root:["root",n&&"dense",t&&"disabled",!r&&"gutters",i&&"divider",o&&"selected"]},l=(0,yt.A)(a,Uo,s);return(0,ze.A)({},s,l)})(n),A=(0,kt.A)(g,t);let x;return n.disabled||(x=void 0!==h?h:-1),(0,We.jsx)(er.Provider,{value:m,children:(0,We.jsx)(jo,(0,ze.A)({ref:A,role:u,tabIndex:x,component:r,focusVisibleClassName:(0,vt.A)(y.focusVisible,c),className:(0,vt.A)(y.root,d)},p,{ownerState:v,classes:y}))})}));function Go(e,t){return function(){return e.apply(t,arguments)}}const{toString:Ho}=Object.prototype,{getPrototypeOf:Wo}=Object,Qo=(qo=Object.create(null),e=>{const t=Ho.call(e);return qo[t]||(qo[t]=t.slice(8,-1).toLowerCase())});var qo;const Xo=e=>(e=e.toLowerCase(),t=>Qo(t)===e),$o=e=>t=>typeof t===e,{isArray:Yo}=Array,Ko=$o("undefined");const Jo=Xo("ArrayBuffer");const Zo=$o("string"),es=$o("function"),ts=$o("number"),ns=e=>null!==e&&"object"===typeof e,is=e=>{if("object"!==Qo(e))return!1;const t=Wo(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},rs=Xo("Date"),os=Xo("File"),ss=Xo("Blob"),as=Xo("FileList"),ls=Xo("URLSearchParams"),[cs,us,hs,ds]=["ReadableStream","Request","Response","Headers"].map(Xo);function ps(e,t){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Yo(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const i=r?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let s;for(n=0;n<o;n++)s=i[n],t.call(null,e[s],s,e)}}function fs(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const ms="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,gs=e=>!Ko(e)&&e!==ms;const vs=(ys="undefined"!==typeof Uint8Array&&Wo(Uint8Array),e=>ys&&e instanceof ys);var ys;const As=Xo("HTMLFormElement"),xs=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),bs=Xo("RegExp"),_s=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};ps(n,((n,r)=>{let o;!1!==(o=t(n,r,e))&&(i[r]=o||n)})),Object.defineProperties(e,i)};const ws=Xo("AsyncFunction"),Es=((e,t)=>{return e?setImmediate:t?(n=`axios@${Math.random()}`,i=[],ms.addEventListener("message",(e=>{let{source:t,data:r}=e;t===ms&&r===n&&i.length&&i.shift()()}),!1),e=>{i.push(e),ms.postMessage(n,"*")}):e=>setTimeout(e);var n,i})("function"===typeof setImmediate,es(ms.postMessage)),Ss="undefined"!==typeof queueMicrotask?queueMicrotask.bind(ms):"undefined"!==typeof process&&process.nextTick||Es,Cs={isArray:Yo,isArrayBuffer:Jo,isBuffer:function(e){return null!==e&&!Ko(e)&&null!==e.constructor&&!Ko(e.constructor)&&es(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||es(e.append)&&("formdata"===(t=Qo(e))||"object"===t&&es(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Jo(e.buffer),t},isString:Zo,isNumber:ts,isBoolean:e=>!0===e||!1===e,isObject:ns,isPlainObject:is,isReadableStream:cs,isRequest:us,isResponse:hs,isHeaders:ds,isUndefined:Ko,isDate:rs,isFile:os,isBlob:ss,isRegExp:bs,isFunction:es,isStream:e=>ns(e)&&es(e.pipe),isURLSearchParams:ls,isTypedArray:vs,isFileList:as,forEach:ps,merge:function e(){const{caseless:t}=gs(this)&&this||{},n={},i=(i,r)=>{const o=t&&fs(n,r)||r;is(n[o])&&is(i)?n[o]=e(n[o],i):is(i)?n[o]=e({},i):Yo(i)?n[o]=i.slice():n[o]=i};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&ps(arguments[r],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ps(t,((t,i)=>{n&&es(t)?e[i]=Go(t,n):e[i]=t}),{allOwnKeys:i}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,o,s;const a={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)s=r[o],i&&!i(s,e,t)||a[s]||(t[s]=e[s],a[s]=!0);e=!1!==n&&Wo(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Qo,kindOfTest:Xo,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(Yo(e))return e;let t=e.length;if(!ts(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const n=i.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:As,hasOwnProperty:xs,hasOwnProp:xs,reduceDescriptors:_s,freezeMethods:e=>{_s(e,((t,n)=>{if(es(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const i=e[n];es(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},i=e=>{e.forEach((e=>{n[e]=!0}))};return Yo(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:fs,global:ms,isContextDefined:gs,isSpecCompliantForm:function(e){return!!(e&&es(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,i)=>{if(ns(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;const r=Yo(e)?[]:{};return ps(e,((e,t)=>{const o=n(e,i+1);!Ko(o)&&(r[t]=o)})),t[i]=void 0,r}}return e};return n(e,0)},isAsyncFn:ws,isThenable:e=>e&&(ns(e)||es(e))&&es(e.then)&&es(e.catch),setImmediate:Es,asap:Ss};function Ms(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}Cs.inherits(Ms,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Cs.toJSONObject(this.config),code:this.code,status:this.status}}});const Ts=Ms.prototype,Rs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Rs[e]={value:e}})),Object.defineProperties(Ms,Rs),Object.defineProperty(Ts,"isAxiosError",{value:!0}),Ms.from=(e,t,n,i,r,o)=>{const s=Object.create(Ts);return Cs.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Ms.call(s,e.message,t,n,i,r),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const Is=Ms;function Ps(e){return Cs.isPlainObject(e)||Cs.isArray(e)}function Bs(e){return Cs.endsWith(e,"[]")?e.slice(0,-2):e}function Ls(e,t,n){return e?e.concat(t).map((function(e,t){return e=Bs(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const Ns=Cs.toFlatObject(Cs,{},null,(function(e){return/^is[A-Z]/.test(e)}));const Ds=function(e,t,n){if(!Cs.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Cs.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Cs.isUndefined(t[e])}))).metaTokens,r=n.visitor||c,o=n.dots,s=n.indexes,a=(n.Blob||"undefined"!==typeof Blob&&Blob)&&Cs.isSpecCompliantForm(t);if(!Cs.isFunction(r))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Cs.isDate(e))return e.toISOString();if(!a&&Cs.isBlob(e))throw new Is("Blob is not supported. Use a Buffer instead.");return Cs.isArrayBuffer(e)||Cs.isTypedArray(e)?a&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,r){let a=e;if(e&&!r&&"object"===typeof e)if(Cs.endsWith(n,"{}"))n=i?n:n.slice(0,-2),e=JSON.stringify(e);else if(Cs.isArray(e)&&function(e){return Cs.isArray(e)&&!e.some(Ps)}(e)||(Cs.isFileList(e)||Cs.endsWith(n,"[]"))&&(a=Cs.toArray(e)))return n=Bs(n),a.forEach((function(e,i){!Cs.isUndefined(e)&&null!==e&&t.append(!0===s?Ls([n],i,o):null===s?n:n+"[]",l(e))})),!1;return!!Ps(e)||(t.append(Ls(r,n,o),l(e)),!1)}const u=[],h=Object.assign(Ns,{defaultVisitor:c,convertValue:l,isVisitable:Ps});if(!Cs.isObject(e))throw new TypeError("data must be an object");return function e(n,i){if(!Cs.isUndefined(n)){if(-1!==u.indexOf(n))throw Error("Circular reference detected in "+i.join("."));u.push(n),Cs.forEach(n,(function(n,o){!0===(!(Cs.isUndefined(n)||null===n)&&r.call(t,n,Cs.isString(o)?o.trim():o,i,h))&&e(n,i?i.concat(o):[o])})),u.pop()}}(e),t};function ks(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function Os(e,t){this._pairs=[],e&&Ds(e,this,t)}const Us=Os.prototype;Us.append=function(e,t){this._pairs.push([e,t])},Us.toString=function(e){const t=e?function(t){return e.call(this,t,ks)}:ks;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Fs=Os;function zs(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function js(e,t,n){if(!t)return e;const i=n&&n.encode||zs;Cs.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let o;if(o=r?r(t,n):Cs.isURLSearchParams(t)?t.toString():new Fs(t,n).toString(i),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const Vs=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Cs.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Gs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Hs={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Fs,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Ws="undefined"!==typeof window&&"undefined"!==typeof document,Qs="object"===typeof navigator&&navigator||void 0,qs=Ws&&(!Qs||["ReactNative","NativeScript","NS"].indexOf(Qs.product)<0),Xs="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,$s=Ws&&window.location.href||"http://localhost",Ys={...e,...Hs};const Ks=function(e){function t(e,n,i,r){let o=e[r++];if("__proto__"===o)return!0;const s=Number.isFinite(+o),a=r>=e.length;if(o=!o&&Cs.isArray(i)?i.length:o,a)return Cs.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!s;i[o]&&Cs.isObject(i[o])||(i[o]=[]);return t(e,n,i[o],r)&&Cs.isArray(i[o])&&(i[o]=function(e){const t={},n=Object.keys(e);let i;const r=n.length;let o;for(i=0;i<r;i++)o=n[i],t[o]=e[o];return t}(i[o])),!s}if(Cs.isFormData(e)&&Cs.isFunction(e.entries)){const n={};return Cs.forEachEntry(e,((e,i)=>{t(function(e){return Cs.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),i,n,0)})),n}return null};const Js={transitional:Gs,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=Cs.isObject(e);r&&Cs.isHTMLForm(e)&&(e=new FormData(e));if(Cs.isFormData(e))return i?JSON.stringify(Ks(e)):e;if(Cs.isArrayBuffer(e)||Cs.isBuffer(e)||Cs.isStream(e)||Cs.isFile(e)||Cs.isBlob(e)||Cs.isReadableStream(e))return e;if(Cs.isArrayBufferView(e))return e.buffer;if(Cs.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Ds(e,new Ys.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,i){return Ys.isNode&&Cs.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=Cs.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Ds(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),function(e,t,n){if(Cs.isString(e))try{return(t||JSON.parse)(e),Cs.trim(e)}catch(Jbe){if("SyntaxError"!==Jbe.name)throw Jbe}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Js.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(Cs.isResponse(e)||Cs.isReadableStream(e))return e;if(e&&Cs.isString(e)&&(n&&!this.responseType||i)){const n=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(Jbe){if(n){if("SyntaxError"===Jbe.name)throw Is.from(Jbe,Is.ERR_BAD_RESPONSE,this,null,this.response);throw Jbe}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ys.classes.FormData,Blob:Ys.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Cs.forEach(["delete","get","head","post","put","patch"],(e=>{Js.headers[e]={}}));const Zs=Js,ea=Cs.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ta=Symbol("internals");function na(e){return e&&String(e).trim().toLowerCase()}function ia(e){return!1===e||null==e?e:Cs.isArray(e)?e.map(ia):String(e)}function ra(e,t,n,i,r){return Cs.isFunction(i)?i.call(this,t,n):(r&&(t=n),Cs.isString(t)?Cs.isString(i)?-1!==t.indexOf(i):Cs.isRegExp(i)?i.test(t):void 0:void 0)}class oa{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function r(e,t,n){const r=na(t);if(!r)throw new Error("header name must be a non-empty string");const o=Cs.findKey(i,r);(!o||void 0===i[o]||!0===n||void 0===n&&!1!==i[o])&&(i[o||t]=ia(e))}const o=(e,t)=>Cs.forEach(e,((e,n)=>r(e,n,t)));if(Cs.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(Cs.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const t={};let n,i,r;return e&&e.split("\n").forEach((function(e){r=e.indexOf(":"),n=e.substring(0,r).trim().toLowerCase(),i=e.substring(r+1).trim(),!n||t[n]&&ea[n]||("set-cookie"===n?t[n]?t[n].push(i):t[n]=[i]:t[n]=t[n]?t[n]+", "+i:i)})),t})(e),t);else if(Cs.isHeaders(e))for(const[s,a]of e.entries())r(a,s,n);else null!=e&&r(t,e,n);return this}get(e,t){if(e=na(e)){const n=Cs.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(e);)t[i[1]]=i[2];return t}(e);if(Cs.isFunction(t))return t.call(this,e,n);if(Cs.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=na(e)){const n=Cs.findKey(this,e);return!(!n||void 0===this[n]||t&&!ra(0,this[n],n,t))}return!1}delete(e,t){const n=this;let i=!1;function r(e){if(e=na(e)){const r=Cs.findKey(n,e);!r||t&&!ra(0,n[r],r,t)||(delete n[r],i=!0)}}return Cs.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const r=t[n];e&&!ra(0,this[r],r,e,!0)||(delete this[r],i=!0)}return i}normalize(e){const t=this,n={};return Cs.forEach(this,((i,r)=>{const o=Cs.findKey(n,r);if(o)return t[o]=ia(i),void delete t[r];const s=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(r):String(r).trim();s!==r&&delete t[r],t[s]=ia(i),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Cs.forEach(this,((n,i)=>{null!=n&&!1!==n&&(t[i]=e&&Cs.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[ta]=this[ta]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=na(e);t[i]||(!function(e,t){const n=Cs.toCamelCase(" "+t);["get","set","has"].forEach((i=>{Object.defineProperty(e,i+n,{value:function(e,n,r){return this[i].call(this,t,e,n,r)},configurable:!0})}))}(n,e),t[i]=!0)}return Cs.isArray(e)?e.forEach(i):i(e),this}}oa.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Cs.reduceDescriptors(oa.prototype,((e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[i]=e}}})),Cs.freezeMethods(oa);const sa=oa;function aa(e,t){const n=this||Zs,i=t||n,r=sa.from(i.headers);let o=i.data;return Cs.forEach(e,(function(e){o=e.call(n,o,r.normalize(),t?t.status:void 0)})),r.normalize(),o}function la(e){return!(!e||!e.__CANCEL__)}function ca(e,t,n){Is.call(this,null==e?"canceled":e,Is.ERR_CANCELED,t,n),this.name="CanceledError"}Cs.inherits(ca,Is,{__CANCEL__:!0});const ua=ca;function ha(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new Is("Request failed with status code "+n.status,[Is.ERR_BAD_REQUEST,Is.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const da=function(e,t){e=e||10;const n=new Array(e),i=new Array(e);let r,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const l=Date.now(),c=i[s];r||(r=l),n[o]=a,i[o]=l;let u=s,h=0;for(;u!==o;)h+=n[u++],u%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),l-r<t)return;const d=c&&l-c;return d?Math.round(1e3*h/d):void 0}};const pa=function(e,t){let n,i,r=0,o=1e3/t;const s=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();r=o,n=null,i&&(clearTimeout(i),i=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-r;for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];t>=o?s(l,e):(n=l,i||(i=setTimeout((()=>{i=null,s(n)}),o-t)))},()=>n&&s(n)]},fa=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0;const r=da(50,250);return pa((n=>{const o=n.loaded,s=n.lengthComputable?n.total:void 0,a=o-i,l=r(a);i=o;e({loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:l||void 0,estimated:l&&s&&o<=s?(s-o)/l:void 0,event:n,lengthComputable:null!=s,[t?"download":"upload"]:!0})}),n)},ma=(e,t)=>{const n=null!=e;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},ga=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Cs.asap((()=>e(...n)))},va=Ys.hasStandardBrowserEnv?(ya=new URL(Ys.origin),Aa=Ys.navigator&&/(msie|trident)/i.test(Ys.navigator.userAgent),e=>(e=new URL(e,Ys.origin),ya.protocol===e.protocol&&ya.host===e.host&&(Aa||ya.port===e.port))):()=>!0;var ya,Aa;const xa=Ys.hasStandardBrowserEnv?{write(e,t,n,i,r,o){const s=[e+"="+encodeURIComponent(t)];Cs.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),Cs.isString(i)&&s.push("path="+i),Cs.isString(r)&&s.push("domain="+r),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function ba(e,t,n){let i=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(i||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const _a=e=>e instanceof sa?{...e}:e;function wa(e,t){t=t||{};const n={};function i(e,t,n,i){return Cs.isPlainObject(e)&&Cs.isPlainObject(t)?Cs.merge.call({caseless:i},e,t):Cs.isPlainObject(t)?Cs.merge({},t):Cs.isArray(t)?t.slice():t}function r(e,t,n,r){return Cs.isUndefined(t)?Cs.isUndefined(e)?void 0:i(void 0,e,0,r):i(e,t,0,r)}function o(e,t){if(!Cs.isUndefined(t))return i(void 0,t)}function s(e,t){return Cs.isUndefined(t)?Cs.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function a(n,r,o){return o in t?i(n,r):o in e?i(void 0,n):void 0}const l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t,n)=>r(_a(e),_a(t),0,!0)};return Cs.forEach(Object.keys(Object.assign({},e,t)),(function(i){const o=l[i]||r,s=o(e[i],t[i],i);Cs.isUndefined(s)&&o!==a||(n[i]=s)})),n}const Ea=e=>{const t=wa({},e);let n,{data:i,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:s,headers:a,auth:l}=t;if(t.headers=a=sa.from(a),t.url=js(ba(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&a.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Cs.isFormData(i))if(Ys.hasStandardBrowserEnv||Ys.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(n=a.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];a.setContentType([e||"multipart/form-data",...t].join("; "))}if(Ys.hasStandardBrowserEnv&&(r&&Cs.isFunction(r)&&(r=r(t)),r||!1!==r&&va(t.url))){const e=o&&s&&xa.read(s);e&&a.set(o,e)}return t},Sa="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const i=Ea(e);let r=i.data;const o=sa.from(i.headers).normalize();let s,a,l,c,u,{responseType:h,onUploadProgress:d,onDownloadProgress:p}=i;function f(){c&&c(),u&&u(),i.cancelToken&&i.cancelToken.unsubscribe(s),i.signal&&i.signal.removeEventListener("abort",s)}let m=new XMLHttpRequest;function g(){if(!m)return;const i=sa.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());ha((function(e){t(e),f()}),(function(e){n(e),f()}),{data:h&&"text"!==h&&"json"!==h?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:i,config:e,request:m}),m=null}m.open(i.method.toUpperCase(),i.url,!0),m.timeout=i.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new Is("Request aborted",Is.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new Is("Network Error",Is.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const r=i.transitional||Gs;i.timeoutErrorMessage&&(t=i.timeoutErrorMessage),n(new Is(t,r.clarifyTimeoutError?Is.ETIMEDOUT:Is.ECONNABORTED,e,m)),m=null},void 0===r&&o.setContentType(null),"setRequestHeader"in m&&Cs.forEach(o.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),Cs.isUndefined(i.withCredentials)||(m.withCredentials=!!i.withCredentials),h&&"json"!==h&&(m.responseType=i.responseType),p&&([l,u]=fa(p,!0),m.addEventListener("progress",l)),d&&m.upload&&([a,c]=fa(d),m.upload.addEventListener("progress",a),m.upload.addEventListener("loadend",c)),(i.cancelToken||i.signal)&&(s=t=>{m&&(n(!t||t.type?new ua(null,e,m):t),m.abort(),m=null)},i.cancelToken&&i.cancelToken.subscribe(s),i.signal&&(i.signal.aborted?s():i.signal.addEventListener("abort",s)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(i.url);v&&-1===Ys.protocols.indexOf(v)?n(new Is("Unsupported protocol "+v+":",Is.ERR_BAD_REQUEST,e)):m.send(r||null)}))},Ca=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,i=new AbortController;const r=function(e){if(!n){n=!0,s();const t=e instanceof Error?e:this.reason;i.abort(t instanceof Is?t:new ua(t instanceof Error?t.message:t))}};let o=t&&setTimeout((()=>{o=null,r(new Is(`timeout ${t} of ms exceeded`,Is.ETIMEDOUT))}),t);const s=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(r):e.removeEventListener("abort",r)})),e=null)};e.forEach((e=>e.addEventListener("abort",r)));const{signal:a}=i;return a.unsubscribe=()=>Cs.asap(s),a}},Ma=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},Ta=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;yield n}}finally{await t.cancel()}},Ra=(e,t,n,i)=>{const r=async function*(e,t){for await(const n of Ta(e))yield*Ma(n,t)}(e,t);let o,s=0,a=e=>{o||(o=!0,i&&i(e))};return new ReadableStream({async pull(e){try{const{done:t,value:i}=await r.next();if(t)return a(),void e.close();let o=i.byteLength;if(n){let e=s+=o;n(e)}e.enqueue(new Uint8Array(i))}catch(t){throw a(t),t}},cancel:e=>(a(e),r.return())},{highWaterMark:2})},Ia="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,Pa=Ia&&"function"===typeof ReadableStream,Ba=Ia&&("function"===typeof TextEncoder?(La=new TextEncoder,e=>La.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var La;const Na=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch(Jbe){return!1}},Da=Pa&&Na((()=>{let e=!1;const t=new Request(Ys.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),ka=Pa&&Na((()=>Cs.isReadableStream(new Response("").body))),Oa={stream:ka&&(e=>e.body)};var Ua;Ia&&(Ua=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Oa[e]&&(Oa[e]=Cs.isFunction(Ua[e])?t=>t[e]():(t,n)=>{throw new Is(`Response type '${e}' is not supported`,Is.ERR_NOT_SUPPORT,n)})})));const Fa=async(e,t)=>{const n=Cs.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(Cs.isBlob(e))return e.size;if(Cs.isSpecCompliantForm(e)){const t=new Request(Ys.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Cs.isArrayBufferView(e)||Cs.isArrayBuffer(e)?e.byteLength:(Cs.isURLSearchParams(e)&&(e+=""),Cs.isString(e)?(await Ba(e)).byteLength:void 0)})(t):n},za={http:null,xhr:Sa,fetch:Ia&&(async e=>{let{url:t,method:n,data:i,signal:r,cancelToken:o,timeout:s,onDownloadProgress:a,onUploadProgress:l,responseType:c,headers:u,withCredentials:h="same-origin",fetchOptions:d}=Ea(e);c=c?(c+"").toLowerCase():"text";let p,f=Ca([r,o&&o.toAbortSignal()],s);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let g;try{if(l&&Da&&"get"!==n&&"head"!==n&&0!==(g=await Fa(u,i))){let e,n=new Request(t,{method:"POST",body:i,duplex:"half"});if(Cs.isFormData(i)&&(e=n.headers.get("content-type"))&&u.setContentType(e),n.body){const[e,t]=ma(g,fa(ga(l)));i=Ra(n.body,65536,e,t)}}Cs.isString(h)||(h=h?"include":"omit");const r="credentials"in Request.prototype;p=new Request(t,{...d,signal:f,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:i,duplex:"half",credentials:r?h:void 0});let o=await fetch(p);const s=ka&&("stream"===c||"response"===c);if(ka&&(a||s&&m)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=o[t]}));const t=Cs.toFiniteNumber(o.headers.get("content-length")),[n,i]=a&&ma(t,fa(ga(a),!0))||[];o=new Response(Ra(o.body,65536,n,(()=>{i&&i(),m&&m()})),e)}c=c||"text";let v=await Oa[Cs.findKey(Oa,c)||"text"](o,e);return!s&&m&&m(),await new Promise(((t,n)=>{ha(t,n,{data:v,headers:sa.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:p})}))}catch(v){if(m&&m(),v&&"TypeError"===v.name&&/fetch/i.test(v.message))throw Object.assign(new Is("Network Error",Is.ERR_NETWORK,e,p),{cause:v.cause||v});throw Is.from(v,v&&v.code,e,p)}})};Cs.forEach(za,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(Jbe){}Object.defineProperty(e,"adapterName",{value:t})}}));const ja=e=>`- ${e}`,Va=e=>Cs.isFunction(e)||null===e||!1===e,Ga=e=>{e=Cs.isArray(e)?e:[e];const{length:t}=e;let n,i;const r={};for(let o=0;o<t;o++){let t;if(n=e[o],i=n,!Va(n)&&(i=za[(t=String(n)).toLowerCase()],void 0===i))throw new Is(`Unknown adapter '${t}'`);if(i)break;r[t||"#"+o]=i}if(!i){const e=Object.entries(r).map((e=>{let[t,n]=e;return`adapter ${t} `+(!1===n?"is not supported by the environment":"is not available in the build")}));let n=t?e.length>1?"since :\n"+e.map(ja).join("\n"):" "+ja(e[0]):"as no adapter specified";throw new Is("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return i};function Ha(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ua(null,e)}function Wa(e){Ha(e),e.headers=sa.from(e.headers),e.data=aa.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Ga(e.adapter||Zs.adapter)(e).then((function(t){return Ha(e),t.data=aa.call(e,e.transformResponse,t),t.headers=sa.from(t.headers),t}),(function(t){return la(t)||(Ha(e),t&&t.response&&(t.response.data=aa.call(e,e.transformResponse,t.response),t.response.headers=sa.from(t.response.headers))),Promise.reject(t)}))}const Qa="1.8.4",qa={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{qa[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Xa={};qa.transitional=function(e,t,n){function i(e,t){return"[Axios v1.8.4] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,r,o)=>{if(!1===e)throw new Is(i(r," has been removed"+(t?" in "+t:"")),Is.ERR_DEPRECATED);return t&&!Xa[r]&&(Xa[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,o)}},qa.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};const $a={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Is("options must be an object",Is.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const o=i[r],s=t[o];if(s){const t=e[o],n=void 0===t||s(t,o,e);if(!0!==n)throw new Is("option "+o+" must be "+n,Is.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Is("Unknown option "+o,Is.ERR_BAD_OPTION)}},validators:qa},Ya=$a.validators;class Ka{constructor(e){this.defaults=e,this.interceptors={request:new Vs,response:new Vs}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(Jbe){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=wa(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;void 0!==n&&$a.assertOptions(n,{silentJSONParsing:Ya.transitional(Ya.boolean),forcedJSONParsing:Ya.transitional(Ya.boolean),clarifyTimeoutError:Ya.transitional(Ya.boolean)},!1),null!=i&&(Cs.isFunction(i)?t.paramsSerializer={serialize:i}:$a.assertOptions(i,{encode:Ya.function,serialize:Ya.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),$a.assertOptions(t,{baseUrl:Ya.spelling("baseURL"),withXsrfToken:Ya.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=r&&Cs.merge(r.common,r[t.method]);r&&Cs.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete r[e]})),t.headers=sa.concat(o,r);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,h=0;if(!a){const e=[Wa.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);h<u;)c=c.then(e[h++],e[h++]);return c}u=s.length;let d=t;for(h=0;h<u;){const e=s[h++],t=s[h++];try{d=e(d)}catch(p){t.call(this,p);break}}try{c=Wa.call(this,d)}catch(p){return Promise.reject(p)}for(h=0,u=l.length;h<u;)c=c.then(l[h++],l[h++]);return c}getUri(e){return js(ba((e=wa(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Cs.forEach(["delete","get","head","options"],(function(e){Ka.prototype[e]=function(t,n){return this.request(wa(n||{},{method:e,url:t,data:(n||{}).data}))}})),Cs.forEach(["post","put","patch"],(function(e){function t(t){return function(n,i,r){return this.request(wa(r||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}Ka.prototype[e]=t(),Ka.prototype[e+"Form"]=t(!0)}));const Ja=Ka;class Za{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const i=new Promise((e=>{n.subscribe(e),t=e})).then(e);return i.cancel=function(){n.unsubscribe(t)},i},e((function(e,i,r){n.reason||(n.reason=new ua(e,i,r),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Za((function(t){e=t})),cancel:e}}}const el=Za;const tl={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tl).forEach((e=>{let[t,n]=e;tl[n]=t}));const nl=tl;const il=function e(t){const n=new Ja(t),i=Go(Ja.prototype.request,n);return Cs.extend(i,Ja.prototype,n,{allOwnKeys:!0}),Cs.extend(i,n,null,{allOwnKeys:!0}),i.create=function(n){return e(wa(t,n))},i}(Zs);il.Axios=Ja,il.CanceledError=ua,il.CancelToken=el,il.isCancel=la,il.VERSION=Qa,il.toFormData=Ds,il.AxiosError=Is,il.Cancel=il.CanceledError,il.all=function(e){return Promise.all(e)},il.spread=function(e){return function(t){return e.apply(null,t)}},il.isAxiosError=function(e){return Cs.isObject(e)&&!0===e.isAxiosError},il.mergeConfig=wa,il.AxiosHeaders=sa,il.formToJSON=e=>Ks(Cs.isHTMLForm(e)?new FormData(e):e),il.getAdapter=Ga,il.HttpStatusCode=nl,il.default=il;const rl=il,ol=(0,s.createContext)(null),sl=()=>{const e=(0,s.useContext)(ol);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},al=e=>{let{children:t}=e;const[n,i]=(0,s.useState)(null),[r,o]=(0,s.useState)(!0),[a,l]=(0,s.useState)(null);(0,s.useEffect)((()=>{c()}),[]);const c=async()=>{try{const e=localStorage.getItem("token");if(e){const t=await rl.get("http://localhost:5000/api/auth/me",{headers:{Authorization:`Bearer ${e}`}});console.log("Auth check response:",t.data),i(t.data)}}catch(a){console.error("Auth check failed:",a),localStorage.removeItem("token")}finally{o(!1)}},u={user:n,loading:r,error:a,login:async(e,t)=>{try{const n=await rl.post("http://localhost:5000/api/auth/login",{email:e,password:t}),{token:r,user:o}=n.data;return localStorage.setItem("token",r),i(o),o}catch(a){var n,r;throw(null===(n=a.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.message)||"Login failed"}},register:async e=>{try{const t=await rl.post("http://localhost:5000/api/auth/register",e),{token:n,user:r}=t.data;return localStorage.setItem("token",n),i(r),r}catch(a){var t,n;throw l((null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Registration failed"),a}},logout:()=>{localStorage.removeItem("token"),i(null)},updateProfile:async e=>{try{const t=localStorage.getItem("token");console.log("Updating profile with data:",e);const n={...e};n.profilePicture&&n.profilePicture.startsWith("http")&&delete n.profilePicture;const r=await rl.patch("http://localhost:5000/api/users/profile",n,{headers:{Authorization:`Bearer ${t}`}});return console.log("Profile update response:",r.data),i(r.data),r.data}catch(a){var t,n;throw l((null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Profile update failed"),a}},updateSkills:async e=>{try{const t=localStorage.getItem("token");console.log("Updating skills with data:",e);const n=await rl.patch("http://localhost:5000/api/users/skills",{skills:e},{headers:{Authorization:`Bearer ${t}`}});return console.log("Skills update response:",n.data),i(n.data),n.data}catch(a){var t,n;throw l((null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Skills update failed"),a}},updateProfilePicture:async e=>{try{const t=localStorage.getItem("token"),n=await rl.patch("http://localhost:5000/api/users/profile",{profilePicture:e},{headers:{Authorization:`Bearer ${t}`}});return i(n.data),n.data}catch(a){var t,n;throw l((null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Profile picture update failed"),a}}};return(0,We.jsx)(ol.Provider,{value:u,children:!r&&t})};var ll=i(7328);function cl(e){return(0,Et.Ay)("MuiListItem",e)}const ul=(0,wt.A)("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]);const hl=(0,wt.A)("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);function dl(e){return(0,Et.Ay)("MuiListItemSecondaryAction",e)}(0,wt.A)("MuiListItemSecondaryAction",["root","disableGutters"]);const pl=["className"],fl=(0,At.Ay)("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.disableGutters&&t.disableGutters]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})})),ml=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiListItemSecondaryAction"}),{className:i}=n,r=(0,je.A)(n,pl),o=s.useContext(er),a=(0,ze.A)({},n,{disableGutters:o.disableGutters}),l=(e=>{const{disableGutters:t,classes:n}=e,i={root:["root",t&&"disableGutters"]};return(0,yt.A)(i,dl,n)})(a);return(0,We.jsx)(fl,(0,ze.A)({className:(0,vt.A)(l.root,i),ownerState:a,ref:t},r))}));ml.muiName="ListItemSecondaryAction";const gl=ml,vl=["className"],yl=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],Al=(0,At.Ay)("div",{name:"MuiListItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,"flex-start"===n.alignItems&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters,!n.disablePadding&&t.padding,n.button&&t.button,n.hasSecondaryAction&&t.secondaryAction]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!n.disablePadding&&(0,ze.A)({paddingTop:8,paddingBottom:8},n.dense&&{paddingTop:4,paddingBottom:4},!n.disableGutters&&{paddingLeft:16,paddingRight:16},!!n.secondaryAction&&{paddingRight:48}),!!n.secondaryAction&&{[`& > .${hl.root}`]:{paddingRight:48}},{[`&.${ul.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${ul.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${ul.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${ul.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"flex-start"===n.alignItems&&{alignItems:"flex-start"},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},n.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ul.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,bt.X4)(t.palette.primary.main,t.palette.action.selectedOpacity)}}},n.hasSecondaryAction&&{paddingRight:48})})),xl=(0,At.Ay)("li",{name:"MuiListItem",slot:"Container",overridesResolver:(e,t)=>t.container})({position:"relative"}),bl=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiListItem"}),{alignItems:i="center",autoFocus:r=!1,button:o=!1,children:a,className:l,component:c,components:u={},componentsProps:h={},ContainerComponent:d="li",ContainerProps:{className:p}={},dense:f=!1,disabled:m=!1,disableGutters:g=!1,disablePadding:v=!1,divider:y=!1,focusVisibleClassName:A,secondaryAction:x,selected:b=!1,slotProps:_={},slots:w={}}=n,E=(0,je.A)(n.ContainerProps,vl),S=(0,je.A)(n,yl),C=s.useContext(er),M=s.useMemo((()=>({dense:f||C.dense||!1,alignItems:i,disableGutters:g})),[i,C.dense,f,g]),T=s.useRef(null);(0,ar.A)((()=>{r&&T.current&&T.current.focus()}),[r]);const R=s.Children.toArray(a),I=R.length&&(0,ll.A)(R[R.length-1],["ListItemSecondaryAction"]),P=(0,ze.A)({},n,{alignItems:i,autoFocus:r,button:o,dense:M.dense,disabled:m,disableGutters:g,disablePadding:v,divider:y,hasSecondaryAction:I,selected:b}),B=(e=>{const{alignItems:t,button:n,classes:i,dense:r,disabled:o,disableGutters:s,disablePadding:a,divider:l,hasSecondaryAction:c,selected:u}=e,h={root:["root",r&&"dense",!s&&"gutters",!a&&"padding",l&&"divider",o&&"disabled",n&&"button","flex-start"===t&&"alignItemsFlexStart",c&&"secondaryAction",u&&"selected"],container:["container"]};return(0,yt.A)(h,cl,i)})(P),L=(0,kt.A)(T,t),N=w.root||u.Root||Al,D=_.root||h.root||{},k=(0,ze.A)({className:(0,vt.A)(B.root,D.className,l),disabled:m},S);let O=c||"li";return o&&(k.component=c||"div",k.focusVisibleClassName=(0,vt.A)(ul.focusVisible,A),O=gn),I?(O=k.component||c?O:"div","li"===d&&("li"===O?O="div":"li"===k.component&&(k.component="div")),(0,We.jsx)(er.Provider,{value:M,children:(0,We.jsxs)(xl,(0,ze.A)({as:d,className:(0,vt.A)(B.container,p),ref:L,ownerState:P},E,{children:[(0,We.jsx)(N,(0,ze.A)({},D,!Ci(N)&&{as:O,ownerState:(0,ze.A)({},P,D.ownerState)},k,{children:R})),R.pop()]}))})):(0,We.jsx)(er.Provider,{value:M,children:(0,We.jsxs)(N,(0,ze.A)({},D,{as:O,ref:L},!Ci(N)&&{ownerState:(0,ze.A)({},P,D.ownerState)},k,{children:[R,x&&(0,We.jsx)(gl,{children:x})]}))})})),_l=["className"],wl=(0,At.Ay)("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"flex-start"===n.alignItems&&t.alignItemsFlexStart]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex"},"flex-start"===n.alignItems&&{marginTop:8})})),El=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiListItemIcon"}),{className:i}=n,r=(0,je.A)(n,_l),o=s.useContext(er),a=(0,ze.A)({},n,{alignItems:o.alignItems}),l=(e=>{const{alignItems:t,classes:n}=e,i={root:["root","flex-start"===t&&"alignItemsFlexStart"]};return(0,yt.A)(i,No,n)})(a);return(0,We.jsx)(wl,(0,ze.A)({className:(0,vt.A)(l.root,i),ownerState:a,ref:t},r))})),Sl=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],Cl=(0,At.Ay)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${Oo.primary}`]:t.primary},{[`& .${Oo.secondary}`]:t.secondary},t.root,n.inset&&t.inset,n.primary&&n.secondary&&t.multiline,n.dense&&t.dense]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},t.primary&&t.secondary&&{marginTop:6,marginBottom:6},t.inset&&{paddingLeft:56})})),Ml=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiListItemText"}),{children:i,className:r,disableTypography:o=!1,inset:a=!1,primary:l,primaryTypographyProps:c,secondary:u,secondaryTypographyProps:h}=n,d=(0,je.A)(n,Sl),{dense:p}=s.useContext(er);let f=null!=l?l:i,m=u;const g=(0,ze.A)({},n,{disableTypography:o,inset:a,primary:!!f,secondary:!!m,dense:p}),v=(e=>{const{classes:t,inset:n,primary:i,secondary:r,dense:o}=e,s={root:["root",n&&"inset",o&&"dense",i&&r&&"multiline"],primary:["primary"],secondary:["secondary"]};return(0,yt.A)(s,ko,t)})(g);return null==f||f.type===Ln||o||(f=(0,We.jsx)(Ln,(0,ze.A)({variant:p?"body2":"body1",className:v.primary,component:null!=c&&c.variant?void 0:"span",display:"block"},c,{children:f}))),null==m||m.type===Ln||o||(m=(0,We.jsx)(Ln,(0,ze.A)({variant:"body2",className:v.secondary,color:"text.secondary",display:"block"},h,{children:m}))),(0,We.jsxs)(Cl,(0,ze.A)({className:(0,vt.A)(v.root,r),ownerState:g,ref:t},d,{children:[f,m]}))}));var Tl=i(5310),Rl=i(9778),Il=i(5502),Pl=i(5540),Bl=i(5129);const Ll=()=>{const[e,t]=(0,s.useState)([]),[n,i]=(0,s.useState)(null),[r,o]=(0,s.useState)(0),a=oe(),l=async()=>{try{const e=localStorage.getItem("token");if(!e)return void console.error("No token found");console.log("Fetching notifications with token:",e);const n=await rl.get("http://localhost:5000/api/notifications",{headers:{Authorization:`Bearer ${e}`}});console.log("Notifications response:",n.data),t(n.data),o(n.data.filter((e=>!e.read)).length)}catch(i){var e,n;console.error("Error fetching notifications:",(null===(e=i.response)||void 0===e?void 0:e.data)||i),401===(null===(n=i.response)||void 0===n?void 0:n.status)&&(localStorage.removeItem("token"),window.location.href="/login")}};(0,s.useEffect)((()=>{l();const e=setInterval(l,3e4);return()=>clearInterval(e)}),[]);const c=e=>{switch(e){case"application":return(0,We.jsx)(Bl.A,{color:"primary"});case"application_accepted":return(0,We.jsx)(Rl.A,{color:"success"});case"application_rejected":return(0,We.jsx)(Il.A,{color:"error"});case"application_deleted":return(0,We.jsx)(Pl.A,{color:"warning"});default:return(0,We.jsx)(Tl.A,{})}};return(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(wi,{color:"inherit",onClick:e=>{i(e.currentTarget)},sx:{width:40,height:40,color:"#FEF6EB","&:hover":{backgroundColor:"#A35C7A"}},children:(0,We.jsx)(zi,{badgeContent:r,color:"primary",children:(0,We.jsx)(Tl.A,{})})}),(0,We.jsxs)(Po,{anchorEl:n,open:Boolean(n),onClose:()=>{i(null)},PaperProps:{sx:{mt:1.5,maxHeight:400,width:360,background:"#212121",color:"#FEF6EB",border:"1px solid #A35C7A","& .MuiMenuItem-root":{color:"#FEF6EB",fontFamily:"Futura",fontSize:"0.9rem",letterSpacing:"0.05em","&:hover":{backgroundColor:"#A35C7A"}}}},children:[(0,We.jsxs)(ci,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #A35C7A"},children:[(0,We.jsx)(Ln,{variant:"h6",sx:{fontFamily:"Futura",fontSize:"1rem",letterSpacing:"0.05em"},children:"Notifications"}),r>0&&(0,We.jsx)(Cn,{size:"small",onClick:async()=>{try{const e=localStorage.getItem("token");await rl.patch("http://localhost:5000/api/notifications/read-all",{},{headers:{Authorization:`Bearer ${e}`}}),l()}catch(e){console.error("Error marking all notifications as read:",e)}},sx:{color:"#FEF6EB","&:hover":{backgroundColor:"#A35C7A"}},children:"Mark all as read"})]}),(0,We.jsx)(rr,{sx:{p:0},children:e.length>0?e.map((e=>(0,We.jsxs)(bl,{onClick:()=>(async e=>{try{const n=localStorage.getItem("token");if(!n)return;if(await rl.patch(`http://localhost:5000/api/notifications/${e._id}/read`,{},{headers:{Authorization:`Bearer ${n}`}}),t((t=>t.map((t=>t._id===e._id?{...t,read:!0}:t)))),"message"===e.type){const t=e.link||`/messages/${e.sender}/${e.job||"general"}`;a(t)}else a(e.link);i(null)}catch(n){console.error("Error marking notification as read:",n)}})(e),sx:{cursor:"pointer",backgroundColor:e.read?"transparent":"rgba(163, 92, 122, 0.1)",borderBottom:"1px solid rgba(163, 92, 122, 0.1)","&:hover":{backgroundColor:"#A35C7A"}},children:[(0,We.jsx)(El,{sx:{color:"#FEF6EB",minWidth:40},children:c(e.type)}),(0,We.jsx)(Ml,{primary:(0,We.jsx)(Ln,{variant:"body2",sx:{fontFamily:"Futura",color:"#FEF6EB"},children:e.message}),secondary:(0,We.jsx)(Ln,{variant:"caption",sx:{color:"#C890A7",fontFamily:"Futura"},children:new Date(e.createdAt).toLocaleDateString()})})]},e._id))):(0,We.jsx)(bl,{children:(0,We.jsx)(Ml,{primary:(0,We.jsx)(Ln,{variant:"body2",sx:{textAlign:"center",color:"#C890A7",fontFamily:"Futura"},children:"No notifications"})})})})]})]})},Nl=(0,ji.A)((0,We.jsx)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Mail"),Dl=(0,At.Ay)(Lt)((e=>{let{theme:t}=e;return{background:"#212121",borderBottom:"1px solid #A35C7A",zIndex:t.zIndex.drawer+1,height:"64px"}})),kl=(0,At.Ay)(Cn)((e=>{let{theme:t}=e;return{color:"#FEF6EB",padding:"6px 16px",fontFamily:"Futura",fontSize:"0.9rem",letterSpacing:"0.05em",textTransform:"uppercase",fontWeight:500,"&:hover":{backgroundColor:"#A35C7A"}}})),Ol=(0,At.Ay)(Ln)({fontFamily:"Futura",fontSize:"0.9rem",letterSpacing:"0.05em",textTransform:"uppercase",fontWeight:500}),Ul=()=>{const{user:e,logout:t}=sl(),n=oe(),[i,r]=(0,s.useState)(null),[o,a]=(0,s.useState)(0),l=()=>{r(null)};return(0,s.useEffect)((()=>{e&&(async()=>{try{const e=localStorage.getItem("token");if(!e)return;const t=await rl.get("http://localhost:5000/api/messages/unread/count",{headers:{Authorization:`Bearer ${e}`}});a(t.data.count)}catch(e){console.error("Error fetching unread count:",e)}})()}),[e]),(0,We.jsx)(Dl,{position:"fixed",children:(0,We.jsx)(Zn,{maxWidth:"xl",children:(0,We.jsxs)(ii,{disableGutters:!0,sx:{height:"100%"},children:[(0,We.jsx)(ci,{component:Ne,to:"/",sx:{display:"flex",alignItems:"center",textDecoration:"none",color:"inherit"},children:(0,We.jsx)("img",{src:"/gighub-logo.png",alt:"GigHub",style:{width:"40px",height:"40px",marginRight:"16px",cursor:"pointer",borderRadius:"50%",border:"2px solid #A35C7A",padding:"2px",background:"#FEF6EB"}})}),(0,We.jsxs)(yi,{direction:"row",spacing:2,sx:{ml:2},children:[(0,We.jsx)(kl,{onClick:()=>n("/jobs"),sx:{display:{xs:"none",sm:"block"}},children:"Jobs"}),e&&(0,We.jsxs)(We.Fragment,{children:["student"===e.role&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(kl,{onClick:()=>n("/my-applications"),sx:{display:{xs:"none",sm:"block"}},children:"My Applications"}),(0,We.jsx)(kl,{onClick:()=>n("/dashboard"),sx:{display:{xs:"none",sm:"block"}},children:"Dashboard"})]}),"recruiter"===e.role&&(0,We.jsx)(kl,{onClick:()=>n("/create-job"),sx:{display:{xs:"none",sm:"block"}},children:"Post a Job"})]})]}),(0,We.jsx)(ci,{sx:{ml:"auto",display:"flex",alignItems:"center",gap:2},children:e?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Ll,{}),(0,We.jsx)(wi,{onClick:()=>n("/messages"),sx:{width:40,height:40,color:"#FEF6EB","&:hover":{backgroundColor:"#A35C7A"}},children:(0,We.jsx)(zi,{badgeContent:o,color:"primary",children:(0,We.jsx)(Nl,{})})}),(0,We.jsx)(wi,{onClick:e=>{r(e.currentTarget)},sx:{p:0,width:40,height:40,"&:hover":{backgroundColor:"#A35C7A"}},children:(0,We.jsx)(Ji,{src:e.profilePicture,alt:e.name,sx:{border:"2px solid #A35C7A",width:35,height:35}})}),(0,We.jsxs)(Po,{anchorEl:i,open:Boolean(i),onClose:l,PaperProps:{sx:{mt:1.5,minWidth:180,borderRadius:1,background:"#212121",color:"#FEF6EB",border:"1px solid #A35C7A","& .MuiMenuItem-root":{color:"#FEF6EB",fontFamily:"Futura",fontSize:"0.9rem",letterSpacing:"0.05em",textTransform:"uppercase","&:hover":{backgroundColor:"#A35C7A"}}}},children:[(0,We.jsx)(Vo,{onClick:()=>{l(),n(`/profile/${e._id}`)},children:(0,We.jsx)(Ol,{children:"Profile"})}),(0,We.jsx)(Vo,{onClick:()=>{t(),l()},children:(0,We.jsx)(Ol,{children:"Logout"})})]})]}):(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(kl,{onClick:()=>n("/login"),sx:{display:{xs:"none",sm:"block"}},children:"Login"}),(0,We.jsx)(kl,{onClick:()=>n("/register"),sx:{display:{xs:"none",sm:"block"}},children:"Register"})]})})]})})})};const Fl=s.createContext();function zl(e){return(0,Et.Ay)("MuiGrid",e)}const jl=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Vl=(0,wt.A)("MuiGrid",["root","container","item","zeroMinWidth",...[0,1,2,3,4,5,6,7,8,9,10].map((e=>`spacing-xs-${e}`)),...["column-reverse","column","row-reverse","row"].map((e=>`direction-xs-${e}`)),...["nowrap","wrap-reverse","wrap"].map((e=>`wrap-xs-${e}`)),...jl.map((e=>`grid-xs-${e}`)),...jl.map((e=>`grid-sm-${e}`)),...jl.map((e=>`grid-md-${e}`)),...jl.map((e=>`grid-lg-${e}`)),...jl.map((e=>`grid-xl-${e}`))]),Gl=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function Hl(e){const t=parseFloat(e);return`${t}${String(e).replace(String(t),"")||"px"}`}function Wl(e){let{breakpoints:t,values:n}=e,i="";Object.keys(n).forEach((e=>{""===i&&0!==n[e]&&(i=e)}));const r=Object.keys(t).sort(((e,n)=>t[e]-t[n]));return r.slice(0,r.indexOf(i))}const Ql=(0,At.Ay)("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{container:i,direction:r,item:o,spacing:s,wrap:a,zeroMinWidth:l,breakpoints:c}=n;let u=[];i&&(u=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||e<=0)return[];if("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e)return[n[`spacing-xs-${String(e)}`]];const i=[];return t.forEach((t=>{const r=e[t];Number(r)>0&&i.push(n[`spacing-${t}-${String(r)}`])})),i}(s,c,t));const h=[];return c.forEach((e=>{const i=n[e];i&&h.push(t[`grid-${e}-${String(i)}`])})),[t.root,i&&t.container,o&&t.item,l&&t.zeroMinWidth,...u,"row"!==r&&t[`direction-xs-${String(r)}`],"wrap"!==a&&t[`wrap-xs-${String(a)}`],...h]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},"wrap"!==t.wrap&&{flexWrap:t.wrap})}),(function(e){let{theme:t,ownerState:n}=e;const i=(0,ui.kW)({values:n.direction,breakpoints:t.breakpoints.values});return(0,ui.NI)({theme:t},i,(e=>{const t={flexDirection:e};return 0===e.indexOf("column")&&(t[`& > .${Vl.item}`]={maxWidth:"none"}),t}))}),(function(e){let{theme:t,ownerState:n}=e;const{container:i,rowSpacing:r}=n;let o={};if(i&&0!==r){const e=(0,ui.kW)({values:r,breakpoints:t.breakpoints.values});let n;"object"===typeof e&&(n=Wl({breakpoints:t.breakpoints.values,values:e})),o=(0,ui.NI)({theme:t},e,((e,i)=>{var r;const o=t.spacing(e);return"0px"!==o?{marginTop:`-${Hl(o)}`,[`& > .${Vl.item}`]:{paddingTop:Hl(o)}}:null!=(r=n)&&r.includes(i)?{}:{marginTop:0,[`& > .${Vl.item}`]:{paddingTop:0}}}))}return o}),(function(e){let{theme:t,ownerState:n}=e;const{container:i,columnSpacing:r}=n;let o={};if(i&&0!==r){const e=(0,ui.kW)({values:r,breakpoints:t.breakpoints.values});let n;"object"===typeof e&&(n=Wl({breakpoints:t.breakpoints.values,values:e})),o=(0,ui.NI)({theme:t},e,((e,i)=>{var r;const o=t.spacing(e);return"0px"!==o?{width:`calc(100% + ${Hl(o)})`,marginLeft:`-${Hl(o)}`,[`& > .${Vl.item}`]:{paddingLeft:Hl(o)}}:null!=(r=n)&&r.includes(i)?{}:{width:"100%",marginLeft:0,[`& > .${Vl.item}`]:{paddingLeft:0}}}))}return o}),(function(e){let t,{theme:n,ownerState:i}=e;return n.breakpoints.keys.reduce(((e,r)=>{let o={};if(i[r]&&(t=i[r]),!t)return e;if(!0===t)o={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if("auto"===t)o={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const s=(0,ui.kW)({values:i.columns,breakpoints:n.breakpoints.values}),a="object"===typeof s?s[r]:s;if(void 0===a||null===a)return e;const l=Math.round(t/a*1e8)/1e6+"%";let c={};if(i.container&&i.item&&0!==i.columnSpacing){const e=n.spacing(i.columnSpacing);if("0px"!==e){const t=`calc(${l} + ${Hl(e)})`;c={flexBasis:t,maxWidth:t}}}o=(0,ze.A)({flexBasis:l,flexGrow:0,maxWidth:l},c)}return 0===n.breakpoints.values[r]?Object.assign(e,o):e[n.breakpoints.up(r)]=o,e}),{})}));const ql=e=>{const{classes:t,container:n,direction:i,item:r,spacing:o,wrap:s,zeroMinWidth:a,breakpoints:l}=e;let c=[];n&&(c=function(e,t){if(!e||e<=0)return[];if("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e)return[`spacing-xs-${String(e)}`];const n=[];return t.forEach((t=>{const i=e[t];if(Number(i)>0){const e=`spacing-${t}-${String(i)}`;n.push(e)}})),n}(o,l));const u=[];l.forEach((t=>{const n=e[t];n&&u.push(`grid-${t}-${String(n)}`)}));const h={root:["root",n&&"container",r&&"item",a&&"zeroMinWidth",...c,"row"!==i&&`direction-xs-${String(i)}`,"wrap"!==s&&`wrap-xs-${String(s)}`,...u]};return(0,yt.A)(h,zl,t)};const Xl=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiGrid"}),{breakpoints:i}=Cr(),r=(0,Mn.A)(n),{className:o,columns:a,columnSpacing:l,component:c="div",container:u=!1,direction:h="row",item:d=!1,rowSpacing:p,spacing:f=0,wrap:m="wrap",zeroMinWidth:g=!1}=r,v=(0,je.A)(r,Gl),y=p||f,A=l||f,x=s.useContext(Fl),b=u?a||12:x,_={},w=(0,ze.A)({},v);i.keys.forEach((e=>{null!=v[e]&&(_[e]=v[e],delete w[e])}));const E=(0,ze.A)({},r,{columns:b,container:u,direction:h,item:d,rowSpacing:y,columnSpacing:A,wrap:m,zeroMinWidth:g,spacing:f},_,{breakpoints:i.keys}),S=ql(E);return(0,We.jsx)(Fl.Provider,{value:b,children:(0,We.jsx)(Ql,(0,ze.A)({ownerState:E,className:(0,vt.A)(S.root,o),as:c,ref:t},w))})}));function $l(e,t){-1===e.indexOf(t)&&e.push(t)}function Yl(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Kl=e=>e;let Jl=Kl,Zl=Kl;const ec=!1,tc=!1;function nc(e){let t;return()=>(void 0===t&&(t=e()),t)}const ic=(e,t,n)=>{const i=t-e;return 0===i?1:(n-e)/i};class rc{constructor(){this.subscriptions=[]}add(e){return $l(this.subscriptions,e),()=>Yl(this.subscriptions,e)}notify(e,t,n){const i=this.subscriptions.length;if(i)if(1===i)this.subscriptions[0](e,t,n);else for(let r=0;r<i;r++){const i=this.subscriptions[r];i&&i(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const oc=e=>1e3*e,sc=e=>e/1e3;function ac(e,t){return t?e*(1e3/t):0}new Set;function lc(e){if("undefined"===typeof Proxy)return e;const t=new Map;return new Proxy((function(){return e(...arguments)}),{get:(n,i)=>"create"===i?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}function cc(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}function uc(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach(((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()})),t}function hc(e,t,n,i){if("function"===typeof t){const[r,o]=uc(i);t=t(void 0!==n?n:e.custom,r,o)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[r,o]=uc(i);t=t(void 0!==n?n:e.custom,r,o)}return t}function dc(e,t,n){const i=e.getProps();return hc(i,t,void 0!==n?n:i.custom,e)}const pc=nc((()=>void 0!==window.ScrollTimeline));class fc{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map((e=>"finished"in e?e.finished:e)))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let n=0;n<this.animations.length;n++)this.animations[n][e]=t}attachTimeline(e,t){const n=this.animations.map((n=>pc()&&n.attachTimeline?n.attachTimeline(e):"function"===typeof t?t(n):void 0));return()=>{n.forEach(((e,t)=>{e&&e(),this.animations[t].stop()}))}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach((t=>t[e]()))}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class mc extends fc{then(e,t){return Promise.all(this.animations).then(e).catch(t)}}function gc(e,t){return e?e[t]||e.default||e:void 0}const vc=2e4;function yc(e){let t=0;let n=e.next(t);for(;!n.done&&t<vc;)t+=50,n=e.next(t);return t>=vc?1/0:t}function Ac(e){return"function"===typeof e}function xc(e,t){e.timeline=t,e.onfinish=null}const bc=e=>Array.isArray(e)&&"number"===typeof e[0],_c={linearEasing:void 0};function wc(e,t){const n=nc(e);return()=>{var e;return null!==(e=_c[t])&&void 0!==e?e:n()}}const Ec=wc((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(Jbe){return!1}return!0}),"linearEasing"),Sc=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i="";const r=Math.max(Math.round(t/n),2);for(let o=0;o<r;o++)i+=e(ic(0,r-1,o))+", ";return`linear(${i.substring(0,i.length-2)})`};function Cc(e){return Boolean("function"===typeof e&&Ec()||!e||"string"===typeof e&&(e in Tc||Ec())||bc(e)||Array.isArray(e)&&e.every(Cc))}const Mc=e=>{let[t,n,i,r]=e;return`cubic-bezier(${t}, ${n}, ${i}, ${r})`},Tc={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Mc([0,.65,.55,1]),circOut:Mc([.55,0,1,.45]),backIn:Mc([.31,.01,.66,-.59]),backOut:Mc([.33,1.53,.69,.99])};function Rc(e,t){return e?"function"===typeof e&&Ec()?Sc(e,t):bc(e)?Mc(e):Array.isArray(e)?e.map((e=>Rc(e,t)||Tc.easeOut)):Tc[e]:void 0}const Ic=["read","resolveKeyframes","update","preRender","render","postRender"],Pc={value:null,addProjectionMetrics:null};function Bc(e,t){let n=!1,i=!0;const r={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,s=Ic.reduce(((e,n)=>(e[n]=function(e,t){let n=new Set,i=new Set,r=!1,o=!1;const s=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1},l=0;function c(t){s.has(t)&&(u.schedule(t),e()),l++,t(a)}const u={schedule:function(e){const t=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&r?n:i;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&s.add(e),t.has(e)||t.add(e),e},cancel:e=>{i.delete(e),s.delete(e)},process:e=>{a=e,r?o=!0:(r=!0,[n,i]=[i,n],n.forEach(c),t&&Pc.value&&Pc.value.frameloop[t].push(l),l=0,n.clear(),r=!1,o&&(o=!1,u.process(e)))}};return u}(o,t?n:void 0),e)),{}),{read:a,resolveKeyframes:l,update:c,preRender:u,render:h,postRender:d}=s,p=()=>{const o=tc?r.timestamp:performance.now();n=!1,tc||(r.delta=i?1e3/60:Math.max(Math.min(o-r.timestamp,40),1)),r.timestamp=o,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),u.process(r),h.process(r),d.process(r),r.isProcessing=!1,n&&t&&(i=!1,e(p))},f=Ic.reduce(((t,o)=>{const a=s[o];return t[o]=function(t){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,i=!0,r.isProcessing||e(p)),a.schedule(t,o,s)},t}),{});return{schedule:f,cancel:e=>{for(let t=0;t<Ic.length;t++)s[Ic[t]].cancel(e)},state:r,steps:s}}const{schedule:Lc,cancel:Nc,state:Dc,steps:kc}=Bc("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:Kl,!0),{schedule:Oc,cancel:Uc}=Bc(queueMicrotask,!1);let Fc;function zc(){Fc=void 0}const jc={now:()=>(void 0===Fc&&jc.set(Dc.isProcessing||tc?Dc.timestamp:performance.now()),Fc),set:e=>{Fc=e,queueMicrotask(zc)}},Vc={x:!1,y:!1};function Gc(){return Vc.x||Vc.y}function Hc(e,t){const n=function(e,t,n){var i;if(e instanceof EventTarget)return[e];if("string"===typeof e){let r=document;t&&(r=t.current);const o=null!==(i=null===n||void 0===n?void 0:n[e])&&void 0!==i?i:r.querySelectorAll(e);return o?Array.from(o):[]}return Array.from(e)}(e),i=new AbortController;return[n,{passive:!0,...t,signal:i.signal},()=>i.abort()]}function Wc(e){return!("touch"===e.pointerType||Gc())}function Qc(e,t){const n=`${t}PointerCapture`;if(e.target instanceof Element&&n in e.target&&void 0!==e.pointerId)try{e.target[n](e.pointerId)}catch(Jbe){}}const qc=(e,t)=>!!t&&(e===t||qc(e,t.parentElement)),Xc=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary,$c=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const Yc=new WeakSet;function Kc(e){return t=>{"Enter"===t.key&&e(t)}}function Jc(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function Zc(e){return Xc(e)&&!Gc()}function eu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[i,r,o]=Hc(e,n),s=e=>{const n=e.currentTarget;if(!n||!Zc(e)||Yc.has(n))return;Yc.add(n),Qc(e,"set");const i=t(n,e),o=(e,t)=>{n.removeEventListener("pointerup",s),n.removeEventListener("pointercancel",a),Qc(e,"release"),Zc(e)&&Yc.has(n)&&(Yc.delete(n),"function"===typeof i&&i(e,{success:t}))},s=e=>{const t=!!e.isTrusted&&(i=e,r=n instanceof Element?n.getBoundingClientRect():{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight},i.clientX<r.left||i.clientX>r.right||i.clientY<r.top||i.clientY>r.bottom);var i,r;o(e,!t&&(!(n instanceof Element)||qc(n,e.target)))},a=e=>{o(e,!1)};n.addEventListener("pointerup",s,r),n.addEventListener("pointercancel",a,r),n.addEventListener("lostpointercapture",a,r)};return i.forEach((e=>{let t=!1;var i;(e=n.useGlobalTarget?window:e)instanceof HTMLElement&&(t=!0,i=e,$c.has(i.tagName)||-1!==i.tabIndex||null!==e.getAttribute("tabindex")||(e.tabIndex=0)),e.addEventListener("pointerdown",s,r),t&&e.addEventListener("focus",(e=>((e,t)=>{const n=e.currentTarget;if(!n)return;const i=Kc((()=>{if(Yc.has(n))return;Jc(n,"down");const e=Kc((()=>{Jc(n,"up")}));n.addEventListener("keyup",e,t),n.addEventListener("blur",(()=>Jc(n,"cancel")),t)}));n.addEventListener("keydown",i,t),n.addEventListener("blur",(()=>n.removeEventListener("keydown",i)),t)})(e,r)),r)})),o}const tu={layout:0,mainThread:0,waapi:0};const nu={current:void 0};class iu{constructor(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.version="12.5.0",this.canTrackVelocity=null,this.events={},this.updateAndNotify=function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=jc.now();t.updatedAt!==i&&t.setPrevFrameValue(),t.prev=t.current,t.setCurrent(e),t.current!==t.prev&&t.events.change&&t.events.change.notify(t.current),n&&t.events.renderRequest&&t.events.renderRequest.notify(t.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){var t;this.current=e,this.updatedAt=jc.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(t=this.current,!isNaN(parseFloat(t))))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new rc);const n=this.events[e].add(t);return"change"===e?()=>{n(),Lc.read((()=>{this.events.change.getSize()||this.stop()}))}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return nu.current&&nu.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=jc.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return ac(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ru(e,t){return new iu(e,t)}const ou=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],su=new Set(ou),au=new Set(["width","height","top","left","right","bottom",...ou]),lu=e=>Array.isArray(e);function cu(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,ru(n))}const uu=e=>Boolean(e&&e.getVelocity);function hu(e,t){const n=e.getValue("willChange");if(i=n,Boolean(uu(i)&&i.add))return n.add(t);var i}const du=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),pu="data-"+du("framerAppearId");function fu(e){return e.props[pu]}const mu=!1,gu=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function vu(e,t,n,i){if(e===t&&n===i)return Kl;const r=t=>function(e,t,n,i,r){let o,s,a=0;do{s=t+(n-t)/2,o=gu(s,i,r)-e,o>0?n=s:t=s}while(Math.abs(o)>1e-7&&++a<12);return s}(t,0,1,e,n);return e=>0===e||1===e?e:gu(r(e),t,i)}const yu=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Au=e=>t=>1-e(1-t),xu=vu(.33,1.53,.69,.99),bu=Au(xu),_u=yu(bu),wu=e=>(e*=2)<1?.5*bu(e):.5*(2-Math.pow(2,-10*(e-1))),Eu=e=>1-Math.sin(Math.acos(e)),Su=Au(Eu),Cu=yu(Eu),Mu=e=>/^0[^.\s]+$/u.test(e);const Tu=(e,t,n)=>n>t?t:n<e?e:n,Ru={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},Iu={...Ru,transform:e=>Tu(0,1,e)},Pu={...Ru,default:1},Bu=e=>Math.round(1e5*e)/1e5,Lu=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;const Nu=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Du=(e,t)=>n=>Boolean("string"===typeof n&&Nu.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),ku=(e,t,n)=>i=>{if("string"!==typeof i)return i;const[r,o,s,a]=i.match(Lu);return{[e]:parseFloat(r),[t]:parseFloat(o),[n]:parseFloat(s),alpha:void 0!==a?parseFloat(a):1}},Ou={...Ru,transform:e=>Math.round((e=>Tu(0,255,e))(e))},Uu={test:Du("rgb","red"),parse:ku("red","green","blue"),transform:e=>{let{red:t,green:n,blue:i,alpha:r=1}=e;return"rgba("+Ou.transform(t)+", "+Ou.transform(n)+", "+Ou.transform(i)+", "+Bu(Iu.transform(r))+")"}};const Fu={test:Du("#"),parse:function(e){let t="",n="",i="",r="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),r=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),r=e.substring(4,5),t+=t,n+=n,i+=i,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:r?parseInt(r,16)/255:1}},transform:Uu.transform},zu=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>`${t}${e}`}),ju=zu("deg"),Vu=zu("%"),Gu=zu("px"),Hu=zu("vh"),Wu=zu("vw"),Qu={...Vu,parse:e=>Vu.parse(e)/100,transform:e=>Vu.transform(100*e)},qu={test:Du("hsl","hue"),parse:ku("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:n,lightness:i,alpha:r=1}=e;return"hsla("+Math.round(t)+", "+Vu.transform(Bu(n))+", "+Vu.transform(Bu(i))+", "+Bu(Iu.transform(r))+")"}},Xu={test:e=>Uu.test(e)||Fu.test(e)||qu.test(e),parse:e=>Uu.test(e)?Uu.parse(e):qu.test(e)?qu.parse(e):Fu.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?Uu.transform(e):qu.transform(e)},$u=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;const Yu="number",Ku="color",Ju=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Zu(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},r=[];let o=0;const s=t.replace(Ju,(e=>(Xu.test(e)?(i.color.push(o),r.push(Ku),n.push(Xu.parse(e))):e.startsWith("var(")?(i.var.push(o),r.push("var"),n.push(e)):(i.number.push(o),r.push(Yu),n.push(parseFloat(e))),++o,"${}"))).split("${}");return{values:n,split:s,indexes:i,types:r}}function eh(e){return Zu(e).values}function th(e){const{split:t,types:n}=Zu(e),i=t.length;return e=>{let r="";for(let o=0;o<i;o++)if(r+=t[o],void 0!==e[o]){const t=n[o];r+=t===Yu?Bu(e[o]):t===Ku?Xu.transform(e[o]):e[o]}return r}}const nh=e=>"number"===typeof e?0:e;const ih={test:function(e){var t,n;return isNaN(e)&&"string"===typeof e&&((null===(t=e.match(Lu))||void 0===t?void 0:t.length)||0)+((null===(n=e.match($u))||void 0===n?void 0:n.length)||0)>0},parse:eh,createTransformer:th,getAnimatableNone:function(e){const t=eh(e);return th(e)(t.map(nh))}},rh=new Set(["brightness","contrast","saturate","opacity"]);function oh(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[i]=n.match(Lu)||[];if(!i)return e;const r=n.replace(i,"");let o=rh.has(t)?1:0;return i!==n&&(o*=100),t+"("+o+r+")"}const sh=/\b([a-z-]*)\(.*?\)/gu,ah={...ih,getAnimatableNone:e=>{const t=e.match(sh);return t?t.map(oh).join(" "):e}},lh={borderWidth:Gu,borderTopWidth:Gu,borderRightWidth:Gu,borderBottomWidth:Gu,borderLeftWidth:Gu,borderRadius:Gu,radius:Gu,borderTopLeftRadius:Gu,borderTopRightRadius:Gu,borderBottomRightRadius:Gu,borderBottomLeftRadius:Gu,width:Gu,maxWidth:Gu,height:Gu,maxHeight:Gu,top:Gu,right:Gu,bottom:Gu,left:Gu,padding:Gu,paddingTop:Gu,paddingRight:Gu,paddingBottom:Gu,paddingLeft:Gu,margin:Gu,marginTop:Gu,marginRight:Gu,marginBottom:Gu,marginLeft:Gu,backgroundPositionX:Gu,backgroundPositionY:Gu},ch={rotate:ju,rotateX:ju,rotateY:ju,rotateZ:ju,scale:Pu,scaleX:Pu,scaleY:Pu,scaleZ:Pu,skew:ju,skewX:ju,skewY:ju,distance:Gu,translateX:Gu,translateY:Gu,translateZ:Gu,x:Gu,y:Gu,z:Gu,perspective:Gu,transformPerspective:Gu,opacity:Iu,originX:Qu,originY:Qu,originZ:Gu},uh={...Ru,transform:Math.round},hh={...lh,...ch,zIndex:uh,size:Gu,fillOpacity:Iu,strokeOpacity:Iu,numOctaves:uh},dh={...hh,color:Xu,backgroundColor:Xu,outlineColor:Xu,fill:Xu,stroke:Xu,borderColor:Xu,borderTopColor:Xu,borderRightColor:Xu,borderBottomColor:Xu,borderLeftColor:Xu,filter:ah,WebkitFilter:ah},ph=e=>dh[e];function fh(e,t){let n=ph(e);return n!==ah&&(n=ih),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const mh=new Set(["auto","none","0"]);const gh=e=>180*e/Math.PI,vh=e=>{const t=gh(Math.atan2(e[1],e[0]));return Ah(t)},yh={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:vh,rotateZ:vh,skewX:e=>gh(Math.atan(e[1])),skewY:e=>gh(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Ah=e=>((e%=360)<0&&(e+=360),e),xh=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),bh=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),_h={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:xh,scaleY:bh,scale:e=>(xh(e)+bh(e))/2,rotateX:e=>Ah(gh(Math.atan2(e[6],e[5]))),rotateY:e=>Ah(gh(Math.atan2(-e[2],e[0]))),rotateZ:vh,rotate:vh,skewX:e=>gh(Math.atan(e[4])),skewY:e=>gh(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function wh(e){return e.includes("scale")?1:0}function Eh(e,t){if(!e||"none"===e)return wh(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,r;if(n)i=_h,r=n;else{const t=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=yh,r=t}if(!r)return wh(t);const o=i[t],s=r[1].split(",").map(Sh);return"function"===typeof o?o(s):s[o]}function Sh(e){return parseFloat(e.trim())}const Ch=e=>e===Ru||e===Gu,Mh=new Set(["x","y","z"]),Th=ou.filter((e=>!Mh.has(e)));const Rh={width:(e,t)=>{let{x:n}=e,{paddingLeft:i="0",paddingRight:r="0"}=t;return n.max-n.min-parseFloat(i)-parseFloat(r)},height:(e,t)=>{let{y:n}=e,{paddingTop:i="0",paddingBottom:r="0"}=t;return n.max-n.min-parseFloat(i)-parseFloat(r)},top:(e,t)=>{let{top:n}=t;return parseFloat(n)},left:(e,t)=>{let{left:n}=t;return parseFloat(n)},bottom:(e,t)=>{let{y:n}=e,{top:i}=t;return parseFloat(i)+(n.max-n.min)},right:(e,t)=>{let{x:n}=e,{left:i}=t;return parseFloat(i)+(n.max-n.min)},x:(e,t)=>{let{transform:n}=t;return Eh(n,"x")},y:(e,t)=>{let{transform:n}=t;return Eh(n,"y")}};Rh.translateX=Rh.x,Rh.translateY=Rh.y;const Ih=new Set;let Ph=!1,Bh=!1;function Lh(){if(Bh){const e=Array.from(Ih).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),n=new Map;t.forEach((e=>{const t=function(e){const t=[];return Th.forEach((n=>{const i=e.getValue(n);void 0!==i&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))})),t}(e);t.length&&(n.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=n.get(e);t&&t.forEach((t=>{let[n,i]=t;var r;null===(r=e.getValue(n))||void 0===r||r.set(i)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}Bh=!1,Ph=!1,Ih.forEach((e=>e.complete())),Ih.clear()}function Nh(){Ih.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(Bh=!0)}))}class Dh{constructor(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=i,this.element=r,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ih.add(this),Ph||(Ph=!0,Lc.read(Nh),Lc.resolveKeyframes(Lh))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:i}=this;for(let r=0;r<e.length;r++)if(null===e[r])if(0===r){const r=null===i||void 0===i?void 0:i.get(),o=e[e.length-1];if(void 0!==r)e[0]=r;else if(n&&t){const i=n.readValue(t,o);void 0!==i&&null!==i&&(e[0]=i)}void 0===e[0]&&(e[0]=o),i&&void 0===r&&i.set(e[0])}else e[r]=e[r-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ih.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ih.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const kh=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Oh=e=>t=>"string"===typeof t&&t.startsWith(e),Uh=Oh("--"),Fh=Oh("var(--"),zh=e=>!!Fh(e)&&jh.test(e.split("/*")[0].trim()),jh=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Vh=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Gh(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Zl(n<=4,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`);const[i,r]=function(e){const t=Vh.exec(e);if(!t)return[,];const[,n,i,r]=t;return[`--${null!==n&&void 0!==n?n:i}`,r]}(e);if(!i)return;const o=window.getComputedStyle(t).getPropertyValue(i);if(o){const e=o.trim();return kh(e)?parseFloat(e):e}return zh(r)?Gh(r,t,n+1):r}const Hh=e=>t=>t.test(e),Wh=[Ru,Gu,Vu,ju,Wu,Hu,{test:e=>"auto"===e,parse:e=>e}],Qh=e=>Wh.find(Hh(e));class qh extends Dh{constructor(e,t,n,i,r){super(e,t,n,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let a=0;a<e.length;a++){let n=e[a];if("string"===typeof n&&(n=n.trim(),zh(n))){const i=Gh(n,t.current);void 0!==i&&(e[a]=i),a===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!au.has(n)||2!==e.length)return;const[i,r]=e,o=Qh(i),s=Qh(r);if(o!==s)if(Ch(o)&&Ch(s))for(let a=0;a<e.length;a++){const t=e[a];"string"===typeof t&&(e[a]=parseFloat(t))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)("number"===typeof(i=e[r])?0===i:null===i||"none"===i||"0"===i||Mu(i))&&n.push(r);var i;n.length&&function(e,t,n){let i,r=0;for(;r<e.length&&!i;){const t=e[r];"string"===typeof t&&!mh.has(t)&&Zu(t).values.length&&(i=e[r]),r++}if(i&&n)for(const o of t)e[o]=fh(n,i)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Rh[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];void 0!==i&&e.getValue(n,i).jump(i,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const r=t.getValue(n);r&&r.jump(this.measuredOrigin,!1);const o=i.length-1,s=i[o];i[o]=Rh[n](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==s&&void 0===this.finalKeyframe&&(this.finalKeyframe=s),(null===(e=this.removedTransforms)||void 0===e?void 0:e.length)&&this.removedTransforms.forEach((e=>{let[n,i]=e;t.getValue(n).set(i)})),this.resolveNoneKeyframes()}}const Xh=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!ih.test(e)&&"0"!==e||e.startsWith("url(")));const $h=e=>null!==e;function Yh(e,t,n){let{repeat:i,repeatType:r="loop"}=t;const o=e.filter($h),s=i&&"loop"!==r&&i%2===1?0:o.length-1;return s&&void 0!==n?n:o[s]}class Kh{constructor(e){let{autoplay:t=!0,delay:n=0,type:i="keyframes",repeat:r=0,repeatDelay:o=0,repeatType:s="loop",...a}=e;this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=jc.now(),this.options={autoplay:t,delay:n,type:i,repeat:r,repeatDelay:o,repeatType:s,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt}get resolved(){return this._resolved||this.hasAttemptedResolve||(Nh(),Lh()),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=jc.now(),this.hasAttemptedResolve=!0;const{name:n,type:i,velocity:r,delay:o,onComplete:s,onUpdate:a,isGenerator:l}=this.options;if(!l&&!function(e,t,n,i){const r=e[0];if(null===r)return!1;if("display"===t||"visibility"===t)return!0;const o=e[e.length-1],s=Xh(r,t),a=Xh(o,t);return Jl(s===a,`You are trying to animate ${t} from "${r}" to "${o}". ${r} is not an animatable value - to enable this animation set ${r} to a value animatable to ${o} via the \`style\` property.`),!(!s||!a)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||Ac(n))&&i)}(e,n,i,r)){if(mu||!o)return a&&a(Yh(e,this.options,t)),s&&s(),void this.resolveFinishedPromise();this.options.duration=0}const c=this.initPlayback(e,t);!1!==c&&(this._resolved={keyframes:e,finalKeyframe:t,...c},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear")}updateFinishedPromise(){this.currentFinishedPromise=new Promise((e=>{this.resolveFinishedPromise=e}))}}const Jh=(e,t,n)=>e+(t-e)*n;function Zh(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function ed(e,t){return n=>n>0?t:e}const td=(e,t,n)=>{const i=e*e,r=n*(t*t-i)+i;return r<0?0:Math.sqrt(r)},nd=[Fu,Uu,qu];function id(e){const t=(n=e,nd.find((e=>e.test(n))));var n;if(Jl(Boolean(t),`'${e}' is not an animatable color. Use the equivalent color code instead.`),!Boolean(t))return!1;let i=t.parse(e);return t===qu&&(i=function(e){let{hue:t,saturation:n,lightness:i,alpha:r}=e;t/=360,n/=100,i/=100;let o=0,s=0,a=0;if(n){const e=i<.5?i*(1+n):i+n-i*n,r=2*i-e;o=Zh(r,e,t+1/3),s=Zh(r,e,t),a=Zh(r,e,t-1/3)}else o=s=a=i;return{red:Math.round(255*o),green:Math.round(255*s),blue:Math.round(255*a),alpha:r}}(i)),i}const rd=(e,t)=>{const n=id(e),i=id(t);if(!n||!i)return ed(e,t);const r={...n};return e=>(r.red=td(n.red,i.red,e),r.green=td(n.green,i.green,e),r.blue=td(n.blue,i.blue,e),r.alpha=Jh(n.alpha,i.alpha,e),Uu.transform(r))},od=(e,t)=>n=>t(e(n)),sd=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(od)},ad=new Set(["none","hidden"]);function ld(e,t){return n=>Jh(e,t,n)}function cd(e){return"number"===typeof e?ld:"string"===typeof e?zh(e)?ed:Xu.test(e)?rd:dd:Array.isArray(e)?ud:"object"===typeof e?Xu.test(e)?rd:hd:ed}function ud(e,t){const n=[...e],i=n.length,r=e.map(((e,n)=>cd(e)(e,t[n])));return e=>{for(let t=0;t<i;t++)n[t]=r[t](e);return n}}function hd(e,t){const n={...e,...t},i={};for(const r in n)void 0!==e[r]&&void 0!==t[r]&&(i[r]=cd(e[r])(e[r],t[r]));return e=>{for(const t in i)n[t]=i[t](e);return n}}const dd=(e,t)=>{const n=ih.createTransformer(t),i=Zu(e),r=Zu(t);return i.indexes.var.length===r.indexes.var.length&&i.indexes.color.length===r.indexes.color.length&&i.indexes.number.length>=r.indexes.number.length?ad.has(e)&&!r.values.length||ad.has(t)&&!i.values.length?function(e,t){return ad.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):sd(ud(function(e,t){var n;const i=[],r={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const s=t.types[o],a=e.indexes[s][r[s]],l=null!==(n=e.values[a])&&void 0!==n?n:0;i[o]=l,r[s]++}return i}(i,r),r.values),n):(Jl(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`),ed(e,t))};function pd(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return Jh(e,t,n);return cd(e)(e,t)}function fd(e,t,n){const i=Math.max(t-5,0);return ac(n-e(i),t-i)}const md={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},gd=.001;function vd(e){let t,n,{duration:i=md.duration,bounce:r=md.bounce,velocity:o=md.velocity,mass:s=md.mass}=e;Jl(i<=oc(md.maxDuration),"Spring duration must be 10 seconds or less");let a=1-r;a=Tu(md.minDamping,md.maxDamping,a),i=Tu(md.minDuration,md.maxDuration,sc(i)),a<1?(t=e=>{const t=e*a,n=t*i,r=t-o,s=Ad(e,a),l=Math.exp(-n);return gd-r/s*l},n=e=>{const n=e*a*i,r=n*o+o,s=Math.pow(a,2)*Math.pow(e,2)*i,l=Math.exp(-n),c=Ad(Math.pow(e,2),a);return(-t(e)+gd>0?-1:1)*((r-s)*l)/c}):(t=e=>Math.exp(-e*i)*((e-o)*i+1)-.001,n=e=>Math.exp(-e*i)*(i*i*(o-e)));const l=function(e,t,n){let i=n;for(let r=1;r<yd;r++)i-=e(i)/t(i);return i}(t,n,5/i);if(i=oc(i),isNaN(l))return{stiffness:md.stiffness,damping:md.damping,duration:i};{const e=Math.pow(l,2)*s;return{stiffness:e,damping:2*a*Math.sqrt(s*e),duration:i}}}const yd=12;function Ad(e,t){return e*Math.sqrt(1-t*t)}const xd=["duration","bounce"],bd=["stiffness","damping","mass"];function _d(e,t){return t.some((t=>void 0!==e[t]))}function wd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:md.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:md.bounce;const n="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:r}=n;const o=n.keyframes[0],s=n.keyframes[n.keyframes.length-1],a={done:!1,value:o},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:p}=function(e){let t={velocity:md.velocity,stiffness:md.stiffness,damping:md.damping,mass:md.mass,isResolvedFromDuration:!1,...e};if(!_d(e,bd)&&_d(e,xd))if(e.visualDuration){const n=e.visualDuration,i=2*Math.PI/(1.2*n),r=i*i,o=2*Tu(.05,1,1-(e.bounce||0))*Math.sqrt(r);t={...t,mass:md.mass,stiffness:r,damping:o}}else{const n=vd(e);t={...t,...n,mass:md.mass},t.isResolvedFromDuration=!0}return t}({...n,velocity:-sc(n.velocity||0)}),f=d||0,m=c/(2*Math.sqrt(l*u)),g=s-o,v=sc(Math.sqrt(l/u)),y=Math.abs(g)<5;let A;if(i||(i=y?md.restSpeed.granular:md.restSpeed.default),r||(r=y?md.restDelta.granular:md.restDelta.default),m<1){const e=Ad(v,m);A=t=>{const n=Math.exp(-m*v*t);return s-n*((f+m*v*g)/e*Math.sin(e*t)+g*Math.cos(e*t))}}else if(1===m)A=e=>s-Math.exp(-v*e)*(g+(f+v*g)*e);else{const e=v*Math.sqrt(m*m-1);A=t=>{const n=Math.exp(-m*v*t),i=Math.min(e*t,300);return s-n*((f+m*v*g)*Math.sinh(i)+e*g*Math.cosh(i))/e}}const x={calculatedDuration:p&&h||null,next:e=>{const t=A(e);if(p)a.done=e>=h;else{let n=0;m<1&&(n=0===e?oc(f):fd(A,e,t));const o=Math.abs(n)<=i,l=Math.abs(s-t)<=r;a.done=o&&l}return a.value=a.done?s:t,a},toString:()=>{const e=Math.min(yc(x),vc),t=Sc((t=>x.next(e*t).value),e,30);return e+"ms "+t}};return x}function Ed(e){let{keyframes:t,velocity:n=0,power:i=.8,timeConstant:r=325,bounceDamping:o=10,bounceStiffness:s=500,modifyTarget:a,min:l,max:c,restDelta:u=.5,restSpeed:h}=e;const d=t[0],p={done:!1,value:d},f=e=>void 0===l?c:void 0===c||Math.abs(l-e)<Math.abs(c-e)?l:c;let m=i*n;const g=d+m,v=void 0===a?g:a(g);v!==g&&(m=v-d);const y=e=>-m*Math.exp(-e/r),A=e=>v+y(e),x=e=>{const t=y(e),n=A(e);p.done=Math.abs(t)<=u,p.value=p.done?v:n};let b,_;const w=e=>{var t;(t=p.value,void 0!==l&&t<l||void 0!==c&&t>c)&&(b=e,_=wd({keyframes:[p.value,f(p.value)],velocity:fd(A,e,p.value),damping:o,stiffness:s,restDelta:u,restSpeed:h}))};return w(0),{calculatedDuration:null,next:e=>{let t=!1;return _||void 0!==b||(t=!0,x(e),w(e)),void 0!==b&&e>=b?_.next(e-b):(!t&&x(e),p)}}}const Sd=vu(.42,0,1,1),Cd=vu(0,0,.58,1),Md=vu(.42,0,.58,1),Td={linear:Kl,easeIn:Sd,easeInOut:Md,easeOut:Cd,circIn:Eu,circInOut:Cu,circOut:Su,backIn:bu,backInOut:_u,backOut:xu,anticipate:wu},Rd=e=>{if(bc(e)){Zl(4===e.length,"Cubic bezier arrays must contain four numerical values.");const[t,n,i,r]=e;return vu(t,n,i,r)}return"string"===typeof e?(Zl(void 0!==Td[e],`Invalid easing type '${e}'`),Td[e]):e};function Id(e,t){let{clamp:n=!0,ease:i,mixer:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=e.length;if(Zl(o===t.length,"Both input and output ranges must be the same length"),1===o)return()=>t[0];if(2===o&&t[0]===t[1])return()=>t[1];const s=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=function(e,t,n){const i=[],r=n||pd,o=e.length-1;for(let s=0;s<o;s++){let n=r(e[s],e[s+1]);if(t){const e=Array.isArray(t)?t[s]||Kl:t;n=sd(e,n)}i.push(n)}return i}(t,i,r),l=a.length,c=n=>{if(s&&n<e[0])return t[0];let i=0;if(l>1)for(;i<e.length-2&&!(n<e[i+1]);i++);const r=ic(e[i],e[i+1],n);return a[i](r)};return n?t=>c(Tu(e[0],e[o-1],t)):c}function Pd(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const r=ic(0,t,i);e.push(Jh(n,1,r))}}(t,e.length-1),t}function Bd(e){let{duration:t=300,keyframes:n,times:i,ease:r="easeInOut"}=e;const o=(e=>Array.isArray(e)&&"number"!==typeof e[0])(r)?r.map(Rd):Rd(r),s={done:!1,value:n[0]},a=function(e,t){return e.map((e=>e*t))}(i&&i.length===n.length?i:Pd(n),t),l=Id(a,n,{ease:Array.isArray(o)?o:(c=n,u=o,c.map((()=>u||Md)).splice(0,c.length-1))});var c,u;return{calculatedDuration:t,next:e=>(s.value=l(e),s.done=e>=t,s)}}const Ld=e=>{const t=t=>{let{timestamp:n}=t;return e(n)};return{start:()=>Lc.update(t,!0),stop:()=>Nc(t),now:()=>Dc.isProcessing?Dc.timestamp:jc.now()}},Nd={decay:Ed,inertia:Ed,tween:Bd,keyframes:Bd,spring:wd},Dd=e=>e/100;class kd extends Kh{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.teardown();const{onStop:e}=this.options;e&&e()};const{name:t,motionValue:n,element:i,keyframes:r}=this.options,o=(null===i||void 0===i?void 0:i.KeyframeResolver)||Dh;this.resolver=new o(r,((e,t)=>this.onKeyframesResolved(e,t)),t,n,i),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:n=0,repeatDelay:i=0,repeatType:r,velocity:o=0}=this.options,s=Ac(t)?t:Nd[t]||Bd;let a,l;s!==Bd&&"number"!==typeof e[0]&&(a=sd(Dd,pd(e[0],e[1])),e=[0,100]);const c=s({...this.options,keyframes:e});"mirror"===r&&(l=s({...this.options,keyframes:[...e].reverse(),velocity:-o})),null===c.calculatedDuration&&(c.calculatedDuration=yc(c));const{calculatedDuration:u}=c,h=u+i;return{generator:c,mirroredGenerator:l,mapPercentToKeyframes:a,calculatedDuration:u,resolvedDuration:h,totalDuration:h*(n+1)-i}}onPostResolved(){const{autoplay:e=!0}=this.options;tu.mainThread++,this.play(),"paused"!==this.pendingPlayState&&e?this.state=this.pendingPlayState:this.pause()}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{resolved:n}=this;if(!n){const{keyframes:e}=this.options;return{done:!0,value:e[e.length-1]}}const{finalKeyframe:i,generator:r,mirroredGenerator:o,mapPercentToKeyframes:s,keyframes:a,calculatedDuration:l,totalDuration:c,resolvedDuration:u}=n;if(null===this.startTime)return r.next(0);const{delay:h,repeat:d,repeatType:p,repeatDelay:f,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const g=this.currentTime-h*(this.speed>=0?1:-1),v=this.speed>=0?g<0:g>c;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=c);let y=this.currentTime,A=r;if(d){const e=Math.min(this.currentTime,c)/u;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,d+1);Boolean(t%2)&&("reverse"===p?(n=1-n,f&&(n-=f/u)):"mirror"===p&&(A=o)),y=Tu(0,1,n)*u}const x=v?{done:!1,value:a[0]}:A.next(y);s&&(x.value=s(x.value));let{done:b}=x;v||null===l||(b=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const _=null===this.holdTime&&("finished"===this.state||"running"===this.state&&b);return _&&void 0!==i&&(x.value=Yh(a,this.options,i)),m&&m(x.value),_&&this.finish(),x}get duration(){const{resolved:e}=this;return e?sc(e.calculatedDuration):0}get time(){return sc(this.currentTime)}set time(e){e=oc(e),this.currentTime=e,null!==this.holdTime||0===this.speed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=sc(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved)return void(this.pendingPlayState="running");if(this.isStopped)return;const{driver:e=Ld,onPlay:t,startTime:n}=this.options;this.driver||(this.driver=e((e=>this.tick(e)))),t&&t();const i=this.driver.now();null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime?"finished"===this.state&&(this.startTime=i):this.startTime=null!==n&&void 0!==n?n:this.calcStartTime(),"finished"===this.state&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;this._resolved?(this.state="paused",this.holdTime=null!==(e=this.currentTime)&&void 0!==e?e:0):this.pendingPlayState="paused"}complete(){"running"!==this.state&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){null!==this.cancelTime&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel(),tu.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const Od=new Set(["opacity","clipPath","filter","transform"]);const Ud=nc((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));const Fd={anticipate:wu,backInOut:_u,circInOut:Cu};class zd extends Kh{constructor(e){super(e);const{name:t,motionValue:n,element:i,keyframes:r}=this.options;this.resolver=new qh(r,((e,t)=>this.onKeyframesResolved(e,t)),t,n,i),this.resolver.scheduleResolve()}initPlayback(e,t){let{duration:n=300,times:i,ease:r,type:o,motionValue:s,name:a,startTime:l}=this.options;if(!s.owner||!s.owner.current)return!1;var c;if("string"===typeof r&&Ec()&&r in Fd&&(r=Fd[r]),Ac((c=this.options).type)||"spring"===c.type||!Cc(c.ease)){const{onComplete:t,onUpdate:s,motionValue:a,element:l,...c}=this.options,u=function(e,t){const n=new kd({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:e[0]};const r=[];let o=0;for(;!i.done&&o<2e4;)i=n.sample(o),r.push(i.value),o+=10;return{times:void 0,keyframes:r,duration:o-10,ease:"linear"}}(e,c);1===(e=u.keyframes).length&&(e[1]=e[0]),n=u.duration,i=u.times,r=u.ease,o="keyframes"}const u=function(e,t,n){let{delay:i=0,duration:r=300,repeat:o=0,repeatType:s="loop",ease:a="easeInOut",times:l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={[t]:n};l&&(c.offset=l);const u=Rc(a,r);Array.isArray(u)&&(c.easing=u),Pc.value&&tu.waapi++;const h=e.animate(c,{delay:i,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:o+1,direction:"reverse"===s?"alternate":"normal"});return Pc.value&&h.finished.finally((()=>{tu.waapi--})),h}(s.owner.current,a,e,{...this.options,duration:n,times:i,ease:r});return u.startTime=null!==l&&void 0!==l?l:this.calcStartTime(),this.pendingTimeline?(xc(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:n}=this.options;s.set(Yh(e,this.options,t)),n&&n(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:n,times:i,type:o,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return sc(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return sc(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.currentTime=oc(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(this._resolved){const{resolved:t}=this;if(!t)return Kl;const{animation:n}=t;xc(n,e)}else this.pendingTimeline=e;return Kl}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;"finished"===t.playState&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,"idle"===this.state)return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:n,duration:i,type:r,ease:o,times:s}=e;if("idle"===t.playState||"finished"===t.playState)return;if(this.time){const{motionValue:e,onUpdate:t,onComplete:a,element:l,...c}=this.options,u=new kd({...c,keyframes:n,duration:i,type:r,ease:o,times:s,isGenerator:!0}),h=oc(this.time);e.setWithVelocity(u.sample(h-10).value,u.sample(h).value,10)}const{onStop:a}=this.options;a&&a(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:n,repeatDelay:i,repeatType:r,damping:o,type:s}=e;if(!t||!t.owner||!(t.owner.current instanceof HTMLElement))return!1;const{onUpdate:a,transformTemplate:l}=t.owner.getProps();return Ud()&&n&&Od.has(n)&&!a&&!l&&!i&&"mirror"!==r&&0!==o&&"inertia"!==s}}const jd={type:"spring",stiffness:500,damping:25,restSpeed:10},Vd={type:"keyframes",duration:.8},Gd={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Hd=(e,t)=>{let{keyframes:n}=t;return n.length>2?Vd:su.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:jd:Gd};const Wd=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return s=>{const a=gc(i,e)||{},l=a.delay||i.delay||0;let{elapsed:c=0}=i;c-=oc(l);let u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...a,delay:-c,onUpdate:e=>{t.set(e),a.onUpdate&&a.onUpdate(e)},onComplete:()=>{s(),a.onComplete&&a.onComplete()},name:e,motionValue:t,element:o?void 0:r};(function(e){let{when:t,delay:n,delayChildren:i,staggerChildren:r,staggerDirection:o,repeat:s,repeatType:a,repeatDelay:l,from:c,elapsed:u,...h}=e;return!!Object.keys(h).length})(a)||(u={...u,...Hd(e,u)}),u.duration&&(u.duration=oc(u.duration)),u.repeatDelay&&(u.repeatDelay=oc(u.repeatDelay)),void 0!==u.from&&(u.keyframes[0]=u.from);let h=!1;if((!1===u.type||0===u.duration&&!u.repeatDelay)&&(u.duration=0,0===u.delay&&(h=!0)),(mu||ec)&&(h=!0,u.duration=0,u.delay=0),u.allowFlatten=!a.type&&!a.ease,h&&!o&&void 0!==t.get()){const e=Yh(u.keyframes,a);if(void 0!==e)return Lc.update((()=>{u.onUpdate(e),u.onComplete()})),new mc([])}return!o&&zd.supports(u)?new zd(u):new kd(u)}};function Qd(e,t){let{protectedKeys:n,needsAnimating:i}=e;const r=n.hasOwnProperty(t)&&!0!==i[t];return i[t]=!1,r}function qd(e,t){let{delay:n=0,transitionOverride:i,type:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o;let{transition:s=e.getDefaultTransition(),transitionEnd:a,...l}=t;i&&(s=i);const c=[],u=r&&e.animationState&&e.animationState.getState()[r];for(const h in l){const t=e.getValue(h,null!==(o=e.latestValues[h])&&void 0!==o?o:null),i=l[h];if(void 0===i||u&&Qd(u,h))continue;const r={delay:n,...gc(s||{},h)};let a=!1;if(window.MotionHandoffAnimation){const t=fu(e);if(t){const e=window.MotionHandoffAnimation(t,h,Lc);null!==e&&(r.startTime=e,a=!0)}}hu(e,h),t.start(Wd(h,t,i,e.shouldReduceMotion&&au.has(h)?{type:!1}:r,e,a));const d=t.animation;d&&c.push(d)}return a&&Promise.all(c).then((()=>{Lc.update((()=>{a&&function(e,t){const n=dc(e,t);let{transitionEnd:i={},transition:r={},...o}=n||{};o={...o,...i};for(const a in o)cu(e,a,(s=o[a],lu(s)?s[s.length-1]||0:s));var s}(e,a)}))})),c}function Xd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i;const r=dc(e,t,"exit"===n.type?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(o=n.transitionOverride);const s=r?()=>Promise.all(qd(e,r,n)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:r=0,staggerChildren:s,staggerDirection:a}=o;return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5?arguments[5]:void 0;const s=[],a=(e.variantChildren.size-1)*i,l=1===r?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i}:function(){return a-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*i};return Array.from(e.variantChildren).sort($d).forEach(((e,i)=>{e.notify("AnimationStart",t),s.push(Xd(e,t,{...o,delay:n+l(i)}).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(s)}(e,t,r+i,s,a,n)}:()=>Promise.resolve(),{when:l}=o;if(l){const[e,t]="beforeChildren"===l?[s,a]:[a,s];return e().then((()=>t()))}return Promise.all([s(),a(n.delay)])}function $d(e,t){return e.sortNodePosition(t)}function Yd(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Kd(e){return"string"===typeof e||Array.isArray(e)}const Jd=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Zd=["initial",...Jd],ep=Zd.length;function tp(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&tp(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let n=0;n<ep;n++){const i=Zd[n],r=e.props[i];(Kd(r)||!1===r)&&(t[i]=r)}return t}const np=[...Jd].reverse(),ip=Jd.length;function rp(e){return t=>Promise.all(t.map((t=>{let{animation:n,options:i}=t;return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const r=t.map((t=>Xd(e,t,i)));n=Promise.all(r)}else if("string"===typeof t)n=Xd(e,t,i);else{const r="function"===typeof t?dc(e,t,i.custom):t;n=Promise.all(qd(e,r,i))}return n.then((()=>{e.notify("AnimationComplete",t)}))}(e,n,i)})))}function op(e){let t=rp(e),n=lp(),i=!0;const r=t=>(n,i)=>{var r;const o=dc(e,i,"exit"===t?null===(r=e.presenceContext)||void 0===r?void 0:r.custom:void 0);if(o){const{transition:e,transitionEnd:t,...i}=o;n={...n,...i,...t}}return n};function o(o){const{props:s}=e,a=tp(e.parent)||{},l=[],c=new Set;let u={},h=1/0;for(let t=0;t<ip;t++){const d=np[t],p=n[d],f=void 0!==s[d]?s[d]:a[d],m=Kd(f),g=d===o?p.isActive:null;!1===g&&(h=t);let v=f===a[d]&&f!==s[d]&&m;if(v&&i&&e.manuallyAnimateOnMount&&(v=!1),p.protectedKeys={...u},!p.isActive&&null===g||!f&&!p.prevProp||cc(f)||"boolean"===typeof f)continue;const y=sp(p.prevProp,f);let A=y||d===o&&p.isActive&&!v&&m||t>h&&m,x=!1;const b=Array.isArray(f)?f:[f];let _=b.reduce(r(d),{});!1===g&&(_={});const{prevResolvedValues:w={}}=p,E={...w,..._},S=t=>{A=!0,c.has(t)&&(x=!0,c.delete(t)),p.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in E){const t=_[e],n=w[e];if(u.hasOwnProperty(e))continue;let i=!1;i=lu(t)&&lu(n)?!Yd(t,n):t!==n,i?void 0!==t&&null!==t?S(e):c.add(e):void 0!==t&&c.has(e)?S(e):p.protectedKeys[e]=!0}p.prevProp=f,p.prevResolvedValues=_,p.isActive&&(u={...u,..._}),i&&e.blockInitialAnimation&&(A=!1);A&&(!(v&&y)||x)&&l.push(...b.map((e=>({animation:e,options:{type:d}}))))}if(c.size){const t={};if("boolean"!==typeof s.initial){const n=dc(e,Array.isArray(s.initial)?s.initial[0]:s.initial);n&&n.transition&&(t.transition=n.transition)}c.forEach((n=>{const i=e.getBaseTarget(n),r=e.getValue(n);r&&(r.liveStyle=!0),t[n]=null!==i&&void 0!==i?i:null})),l.push({animation:t})}let d=Boolean(l.length);return!i||!1!==s.initial&&s.initial!==s.animate||e.manuallyAnimateOnMount||(d=!1),i=!1,d?t(l):Promise.resolve()}return{animateChanges:o,setActive:function(t,i){var r;if(n[t].isActive===i)return Promise.resolve();null===(r=e.variantChildren)||void 0===r||r.forEach((e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,i)})),n[t].isActive=i;const s=o(t);for(const e in n)n[e].protectedKeys={};return s},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=lp(),i=!0}}}function sp(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!Yd(t,e)}function ap(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function lp(){return{animate:ap(!0),whileInView:ap(),whileHover:ap(),whileTap:ap(),whileDrag:ap(),whileFocus:ap(),exit:ap()}}class cp{constructor(e){this.isMounted=!1,this.node=e}update(){}}let up=0;const hp={animation:{Feature:class extends cp{constructor(e){super(e),e.animationState||(e.animationState=op(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();cc(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends cp{constructor(){super(...arguments),this.id=up++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then((()=>{t(this.id)}))}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}};function dp(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}function pp(e){return{point:{x:e.pageX,y:e.pageY}}}function fp(e,t,n,i){return dp(e,t,(e=>t=>Xc(t)&&e(t,pp(t)))(n),i)}function mp(e){let{top:t,left:n,right:i,bottom:r}=e;return{x:{min:n,max:i},y:{min:t,max:r}}}function gp(e){return e.max-e.min}function vp(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=i,e.originPoint=Jh(t.min,t.max,e.origin),e.scale=gp(n)/gp(t),e.translate=Jh(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function yp(e,t,n,i){vp(e.x,t.x,n.x,i?i.originX:void 0),vp(e.y,t.y,n.y,i?i.originY:void 0)}function Ap(e,t,n){e.min=n.min+t.min,e.max=e.min+gp(t)}function xp(e,t,n){e.min=t.min-n.min,e.max=e.min+gp(t)}function bp(e,t,n){xp(e.x,t.x,n.x),xp(e.y,t.y,n.y)}const _p=()=>({x:{min:0,max:0},y:{min:0,max:0}});function wp(e){return[e("x"),e("y")]}function Ep(e){return void 0===e||1===e}function Sp(e){let{scale:t,scaleX:n,scaleY:i}=e;return!Ep(t)||!Ep(n)||!Ep(i)}function Cp(e){return Sp(e)||Mp(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function Mp(e){return Tp(e.x)||Tp(e.y)}function Tp(e){return e&&"0%"!==e}function Rp(e,t,n){return n+t*(e-n)}function Ip(e,t,n,i,r){return void 0!==r&&(e=Rp(e,r,i)),Rp(e,n,i)+t}function Pp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;e.min=Ip(e.min,t,n,i,r),e.max=Ip(e.max,t,n,i,r)}function Bp(e,t){let{x:n,y:i}=t;Pp(e.x,n.translate,n.scale,n.originPoint),Pp(e.y,i.translate,i.scale,i.originPoint)}const Lp=.999999999999,Np=1.0000000000001;function Dp(e,t){e.min=e.min+t,e.max=e.max+t}function kp(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;Pp(e,t,n,Jh(e.min,e.max,r),i)}function Op(e,t){kp(e.x,t.x,t.scaleX,t.scale,t.originX),kp(e.y,t.y,t.scaleY,t.scale,t.originY)}function Up(e,t){return mp(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}(e.getBoundingClientRect(),t))}const Fp=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null};function zp(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}const jp=(e,t)=>Math.abs(e-t);class Vp{constructor(e,t){let{transformPagePoint:n,contextWindow:i,dragSnapToOrigin:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=Wp(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=jp(e.x,t.x),i=jp(e.y,t.y);return Math.sqrt(n**2+i**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!n)return;const{point:i}=e,{timestamp:r}=Dc;this.history.push({...i,timestamp:r});const{onStart:o,onMove:s}=this.handlers;t||(o&&o(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),s&&s(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Gp(t,this.transformPagePoint),Lc.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:i,resumeAnimation:r}=this.handlers;if(this.dragSnapToOrigin&&r&&r(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const o=Wp("pointercancel"===e.type?this.lastMoveEventInfo:Gp(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,o),i&&i(e,o)},!Xc(e))return;this.dragSnapToOrigin=r,this.handlers=t,this.transformPagePoint=n,this.contextWindow=i||window;const o=Gp(pp(e),this.transformPagePoint),{point:s}=o,{timestamp:a}=Dc;this.history=[{...s,timestamp:a}];const{onSessionStart:l}=t;l&&l(e,Wp(o,this.history)),this.removeListeners=sd(fp(this.contextWindow,"pointermove",this.handlePointerMove),fp(this.contextWindow,"pointerup",this.handlePointerUp),fp(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Nc(this.updatePoint)}}function Gp(e,t){return t?{point:t(e.point)}:e}function Hp(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Wp(e,t){let{point:n}=e;return{point:n,delta:Hp(n,qp(t)),offset:Hp(n,Qp(t)),velocity:Xp(t,.1)}}function Qp(e){return e[0]}function qp(e){return e[e.length-1]}function Xp(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const r=qp(e);for(;n>=0&&(i=e[n],!(r.timestamp-i.timestamp>oc(t)));)n--;if(!i)return{x:0,y:0};const o=sc(r.timestamp-i.timestamp);if(0===o)return{x:0,y:0};const s={x:(r.x-i.x)/o,y:(r.y-i.y)/o};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function $p(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function Yp(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}const Kp=.35;function Jp(e,t,n){return{min:Zp(e,t),max:Zp(e,n)}}function Zp(e,t){return"number"===typeof e?e:e[t]||0}const ef=new WeakMap;class tf{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e){let{snapToCursor:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:i}=this.getProps();this.panSession=new Vp(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(pp(e).point)},onStart:(e,t)=>{const{drag:n,dragPropagation:i,onDragStart:r}=this.getProps();if(n&&!i&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(o=n)||"y"===o?Vc[o]?null:(Vc[o]=!0,()=>{Vc[o]=!1}):Vc.x||Vc.y?null:(Vc.x=Vc.y=!0,()=>{Vc.x=Vc.y=!1}),!this.openDragLock))return;var o;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),wp((e=>{let t=this.getAxisMotionValue(e).get()||0;if(Vu.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const i=n.layout.layoutBox[e];if(i){t=gp(i)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),r&&Lc.postRender((()=>r(e,t))),hu(this.visualElement,"transform");const{animationState:s}=this.visualElement;s&&s.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:n,dragDirectionLock:i,onDirectionLock:r,onDrag:o}=this.getProps();if(!n&&!this.openDragLock)return;const{offset:s}=t;if(i&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(s),void(null!==this.currentDirection&&r&&r(this.currentDirection));this.updateAxis("x",t.point,s),this.updateAxis("y",t.point,s),this.visualElement.render(),o&&o(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>wp((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:i,contextWindow:Fp(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:i}=t;this.startAnimation(i);const{onDragEnd:r}=this.getProps();r&&Lc.postRender((()=>r(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:i}=this.getProps();if(!n||!nf(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let o=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(o=function(e,t,n){let{min:i,max:r}=t;return void 0!==i&&e<i?e=n?Jh(i,e,n.min):Math.max(e,i):void 0!==r&&e>r&&(e=n?Jh(r,e,n.max):Math.min(e,r)),e}(o,this.constraints[e],this.elastic[e])),r.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,r=this.constraints;t&&zp(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!i)&&function(e,t){let{top:n,left:i,bottom:r,right:o}=t;return{x:$p(e.x,i,o),y:$p(e.y,n,r)}}(i.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kp;return!1===e?e=0:!0===e&&(e=Kp),{x:Jp(e,"left","right"),y:Jp(e,"top","bottom")}}(n),r!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&wp((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(i.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!zp(e))return!1;const n=e.current;Zl(null!==n,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.");const{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=function(e,t,n){const i=Up(e,n),{scroll:r}=t;return r&&(Dp(i.x,r.offset.x),Dp(i.y,r.offset.y)),i}(n,i.root,this.visualElement.getTransformPagePoint());let o=function(e,t){return{x:Yp(e.x,t.x),y:Yp(e.y,t.y)}}(i.layout.layoutBox,r);if(t){const e=t(function(e){let{x:t,y:n}=e;return{top:n.min,right:t.max,bottom:n.max,left:t.min}}(o));this.hasMutatedConstraints=!!e,e&&(o=mp(e))}return o}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:o,onDragTransitionEnd:s}=this.getProps(),a=this.constraints||{},l=wp((s=>{if(!nf(s,t,this.currentDirection))return;let l=a&&a[s]||{};o&&(l={min:0,max:0});const c=i?200:1e6,u=i?40:1e7,h={type:"inertia",velocity:n?e[s]:0,bounceStiffness:c,bounceDamping:u,timeConstant:750,restDelta:1,restSpeed:10,...r,...l};return this.startAxisValueAnimation(s,h)}));return Promise.all(l).then(s)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return hu(this.visualElement,e),n.start(Wd(e,n,0,t,this.visualElement,!1))}stopAnimation(){wp((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){wp((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),i=n[t];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){wp((t=>{const{drag:n}=this.getProps();if(!nf(t,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(t);if(i&&i.layout){const{min:n,max:o}=i.layout.layoutBox[t];r.set(e[t]-Jh(n,o,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!zp(t)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};wp((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();i[e]=function(e,t){let n=.5;const i=gp(e),r=gp(t);return r>i?n=ic(t.min,t.max-i,e.min):i>r&&(n=ic(e.min,e.max-r,t.min)),Tu(0,1,n)}({min:n,max:n},this.constraints[e])}}));const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),wp((t=>{if(!nf(t,e,null))return;const n=this.getAxisMotionValue(t),{min:r,max:o}=this.constraints[t];n.set(Jh(r,o,i[t]))}))}addListeners(){if(!this.visualElement.current)return;ef.set(this.visualElement,this);const e=fp(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();zp(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Lc.read(t);const r=dp(window,"resize",(()=>this.scalePositionWithinConstraints())),o=n.addEventListener("didUpdate",(e=>{let{delta:t,hasLayoutChanged:n}=e;this.isDragging&&n&&(wp((e=>{const n=this.getAxisMotionValue(e);n&&(this.originPoint[e]+=t[e].translate,n.set(n.get()+t[e].translate))})),this.visualElement.render())}));return()=>{r(),e(),i(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:o=Kp,dragMomentum:s=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:o,dragMomentum:s}}}function nf(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}const rf=e=>(t,n)=>{e&&Lc.postRender((()=>e(t,n)))};const of=(0,s.createContext)(null);const sf=(0,s.createContext)({}),af=(0,s.createContext)({}),lf={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function cf(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const uf={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!Gu.test(e))return e;e=parseFloat(e)}return`${cf(e,t.target.x)}% ${cf(e,t.target.y)}%`}},hf={correct:(e,t)=>{let{treeScale:n,projectionDelta:i}=t;const r=e,o=ih.parse(e);if(o.length>5)return r;const s=ih.createTransformer(e),a="number"!==typeof o[0]?1:0,l=i.x.scale*n.x,c=i.y.scale*n.y;o[0+a]/=l,o[1+a]/=c;const u=Jh(l,c,.5);return"number"===typeof o[2+a]&&(o[2+a]/=u),"number"===typeof o[3+a]&&(o[3+a]/=u),s(o)}},df={};class pf extends s.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;!function(e){for(const t in e)df[t]=e[t],Uh(t)&&(df[t].isCSSVariable=!0)}(mf),r&&(t.group&&t.group.add(r),n&&n.register&&i&&n.register(r),r.root.didUpdate(),r.addEventListener("animationComplete",(()=>{this.safeToRemove()})),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),lf.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:i,isPresent:r}=this.props,o=n.projection;return o?(o.isPresent=r,i||e.layoutDependency!==t||void 0===t||e.isPresent!==r?o.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?o.promote():o.relegate()||Lc.postRender((()=>{const e=o.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Oc.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:i}=e;i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ff(e){const[t,n]=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=(0,s.useContext)(of);if(null===t)return[!0,null];const{isPresent:n,onExitComplete:i,register:r}=t,o=(0,s.useId)();(0,s.useEffect)((()=>{if(e)return r(o)}),[e]);const a=(0,s.useCallback)((()=>e&&i&&i(o)),[o,i,e]);return!n&&i?[!1,a]:[!0]}(),i=(0,s.useContext)(sf);return(0,We.jsx)(pf,{...e,layoutGroup:i,switchLayoutGroup:(0,s.useContext)(af),isPresent:t,safeToRemove:n})}const mf={borderRadius:{...uf,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:uf,borderTopRightRadius:uf,borderBottomLeftRadius:uf,borderBottomRightRadius:uf,boxShadow:hf};const gf=(e,t)=>e.depth-t.depth;class vf{constructor(){this.children=[],this.isDirty=!1}add(e){$l(this.children,e),this.isDirty=!0}remove(e){Yl(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(gf),this.isDirty=!1,this.children.forEach(e)}}function yf(e,t){const n=jc.now(),i=r=>{let{timestamp:o}=r;const s=o-n;s>=t&&(Nc(i),e(s-t))};return Lc.read(i,!0),()=>Nc(i)}function Af(e){const t=uu(e)?e.get():e;return n=t,Boolean(n&&"object"===typeof n&&n.mix&&n.toValue)?t.toValue():t;var n}const xf=["TopLeft","TopRight","BottomLeft","BottomRight"],bf=xf.length,_f=e=>"string"===typeof e?parseFloat(e):e,wf=e=>"number"===typeof e||Gu.test(e);function Ef(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const Sf=Mf(0,.5,Su),Cf=Mf(.5,.95,Kl);function Mf(e,t,n){return i=>i<e?0:i>t?1:n(ic(e,t,i))}function Tf(e,t){e.min=t.min,e.max=t.max}function Rf(e,t){Tf(e.x,t.x),Tf(e.y,t.y)}function If(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function Pf(e,t,n,i,r){return e=Rp(e-=t,1/n,i),void 0!==r&&(e=Rp(e,1/r,i)),e}function Bf(e,t,n,i,r){let[o,s,a]=n;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;Vu.test(t)&&(t=parseFloat(t),t=Jh(s.min,s.max,t/100)-s.min);if("number"!==typeof t)return;let a=Jh(o.min,o.max,i);e===o&&(a-=t),e.min=Pf(e.min,t,n,a,r),e.max=Pf(e.max,t,n,a,r)}(e,t[o],t[s],t[a],t.scale,i,r)}const Lf=["x","scaleX","originX"],Nf=["y","scaleY","originY"];function Df(e,t,n,i){Bf(e.x,t,Lf,n?n.x:void 0,i?i.x:void 0),Bf(e.y,t,Nf,n?n.y:void 0,i?i.y:void 0)}function kf(e){return 0===e.translate&&1===e.scale}function Of(e){return kf(e.x)&&kf(e.y)}function Uf(e,t){return e.min===t.min&&e.max===t.max}function Ff(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function zf(e,t){return Ff(e.x,t.x)&&Ff(e.y,t.y)}function jf(e){return gp(e.x)/gp(e.y)}function Vf(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Gf{constructor(){this.members=[]}add(e){$l(this.members,e),e.scheduleRender()}remove(e){if(Yl(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let n;for(let i=t;i>=0;i--){const e=this.members[i];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;!1===i&&n.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Hf={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},Wf=["","X","Y","Z"],Qf={visibility:"hidden"};let qf=0;function Xf(e,t,n,i){const{latestValues:r}=t;r[e]&&(n[e]=r[e],t.setStaticValue(e,0),i&&(i[e]=0))}function $f(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=fu(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:t,layoutId:i}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Lc,!(t||i))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&$f(i)}function Yf(e){let{attachResizeListener:t,defaultParent:n,measureScroll:i,checkIsScrollRoot:r,resetTransform:o}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=qf++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Pc.value&&(Hf.nodes=Hf.calculatedTargetDeltas=Hf.calculatedProjections=0),this.nodes.forEach(Zf),this.nodes.forEach(sm),this.nodes.forEach(am),this.nodes.forEach(em),Pc.addProjectionMetrics&&Pc.addProjectionMetrics(Hf)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new vf)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new rc),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t&&t.notify(...i)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.root.hasTreeAnimated;if(this.instance)return;var i;this.isSVG=(i=e)instanceof SVGElement&&"svg"!==i.tagName,this.instance=e;const{layoutId:r,layout:o,visualElement:s}=this.options;if(s&&!s.current&&s.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),n&&(o||r)&&(this.isLayoutDirty=!0),t){let n;const i=()=>this.root.updateBlockedByResize=!1;t(e,(()=>{this.root.updateBlockedByResize=!0,n&&n(),n=yf(i,250),lf.hasAnimatedSinceResize&&(lf.hasAnimatedSinceResize=!1,this.nodes.forEach(om))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&s&&(r||o)&&this.addEventListener("didUpdate",(e=>{let{delta:t,hasLayoutChanged:n,hasRelativeLayoutChanged:i,layout:r}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const o=this.options.transition||s.getDefaultTransition()||pm,{onLayoutAnimationStart:a,onLayoutAnimationComplete:l}=s.getProps(),c=!this.targetLayout||!zf(this.targetLayout,r),u=!n&&i;if(this.options.layoutRoot||this.resumeFrom||u||n&&(c||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(t,u);const e={...gc(o,"layout"),onPlay:a,onComplete:l};(s.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e)}else n||om(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=r}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Nc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(lm),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&$f(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let r=0;r<this.path.length;r++){const e=this.path[r];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const i=this.getTransformTemplate();this.prevTransformTemplateValue=i?i(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(nm);this.isUpdating||this.nodes.forEach(im),this.isUpdating=!1,this.nodes.forEach(rm),this.nodes.forEach(Kf),this.nodes.forEach(Jf),this.clearAllSnapshots();const e=jc.now();Dc.delta=Tu(0,1e3/60,e-Dc.timestamp),Dc.timestamp=e,Dc.isProcessing=!0,kc.update.process(Dc),kc.preRender.process(Dc),kc.render.process(Dc),Dc.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Oc.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(tm),this.sharedNodes.forEach(cm)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Lc.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Lc.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||gp(this.snapshot.measuredBox.x)||gp(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t){const t=r(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!o)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!Of(this.projectionDelta),n=this.getTransformTemplate(),i=n?n(this.latestValues,""):void 0,r=i!==this.prevTransformTemplateValue;e&&(t||Cp(this.latestValues)||r)&&(o(this.instance,i),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let n=this.removeElementScroll(t);var i;return e&&(n=this.removeTransform(n)),gm((i=n).x),gm(i.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const n=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(ym))){const{scroll:e}=this.root;e&&(Dp(n.x,e.offset.x),Dp(n.y,e.offset.y))}return n}removeElementScroll(e){var t;const n={x:{min:0,max:0},y:{min:0,max:0}};if(Rf(n,e),null===(t=this.scroll)||void 0===t?void 0:t.wasRoot)return n;for(let i=0;i<this.path.length;i++){const t=this.path[i],{scroll:r,options:o}=t;t!==this.root&&r&&o.layoutScroll&&(r.wasRoot&&Rf(n,e),Dp(n.x,r.offset.x),Dp(n.y,r.offset.y))}return n}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};Rf(n,e);for(let i=0;i<this.path.length;i++){const e=this.path[i];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&Op(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),Cp(e.latestValues)&&Op(n,e.latestValues)}return Cp(this.latestValues)&&Op(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};Rf(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!Cp(e.latestValues))continue;Sp(e.latestValues)&&e.updateSnapshot();const i={x:{min:0,max:0},y:{min:0,max:0}};Rf(i,e.measurePageBox()),Df(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,i)}return Cp(this.latestValues)&&Df(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options={...this.options,...e,crossfade:void 0===e.crossfade||e.crossfade}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Dc.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t;const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const i=Boolean(this.resumingFrom)||this!==n;if(!(e||i&&this.isSharedProjectionDirty||this.isProjectionDirty||(null===(t=this.parent)||void 0===t?void 0:t.isProjectionDirty)||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:r,layoutId:o}=this.options;if(this.layout&&(r||o)){if(this.resolvedRelativeTargetAt=Dc.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},bp(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),Rf(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var s,a,l;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),s=this.target,a=this.relativeTarget,l=this.relativeParent.target,Ap(s.x,a.x,l.x),Ap(s.y,a.y,l.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):Rf(this.target,this.layout.layoutBox),Bp(this.target,this.targetDelta)):Rf(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},bp(this.relativeTargetOrigin,this.target,e.target),Rf(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Pc.value&&Hf.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!Sp(this.parent.latestValues)&&!Mp(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let i=!0;if((this.isProjectionDirty||(null===(e=this.parent)||void 0===e?void 0:e.isProjectionDirty))&&(i=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(i=!1),this.resolvedRelativeTargetAt===Dc.timestamp&&(i=!1),i)return;const{layout:r,layoutId:o}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!r&&!o)return;Rf(this.layoutCorrected,this.layout.layoutBox);const s=this.treeScale.x,a=this.treeScale.y;!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=n.length;if(!r)return;let o,s;t.x=t.y=1;for(let a=0;a<r;a++){o=n[a],s=o.projectionDelta;const{visualElement:r}=o.options;r&&r.props.style&&"contents"===r.props.style.display||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Op(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(t.x*=s.x.scale,t.y*=s.y.scale,Bp(e,s)),i&&Cp(o.latestValues)&&Op(e,o.latestValues))}t.x<Np&&t.x>Lp&&(t.x=1),t.y<Np&&t.y>Lp&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:l}=t;l?(this.projectionDelta&&this.prevProjectionDelta?(If(this.prevProjectionDelta.x,this.projectionDelta.x),If(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),yp(this.projectionDelta,this.layoutCorrected,l,this.latestValues),this.treeScale.x===s&&this.treeScale.y===a&&Vf(this.projectionDelta.x,this.prevProjectionDelta.x)&&Vf(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",l)),Pc.value&&Hf.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t;if(null===(t=this.options.visualElement)||void 0===t||t.scheduleRender(),e){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,i=n?n.latestValues:{},r={...this.latestValues},o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const s={x:{min:0,max:0},y:{min:0,max:0}},a=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),l=this.getStack(),c=!l||l.members.length<=1,u=Boolean(a&&!c&&!0===this.options.crossfade&&!this.path.some(dm));let h;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;var l,d;um(o.x,e.x,n),um(o.y,e.y,n),this.setTargetDelta(o),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(bp(s,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,i){hm(e.x,t.x,n.x,i),hm(e.y,t.y,n.y,i)}(this.relativeTarget,this.relativeTargetOrigin,s,n),h&&(l=this.relativeTarget,d=h,Uf(l.x,d.x)&&Uf(l.y,d.y))&&(this.isProjectionDirty=!1),h||(h={x:{min:0,max:0},y:{min:0,max:0}}),Rf(h,this.relativeTarget)),a&&(this.animationValues=r,function(e,t,n,i,r,o){r?(e.opacity=Jh(0,void 0!==n.opacity?n.opacity:1,Sf(i)),e.opacityExit=Jh(void 0!==t.opacity?t.opacity:1,0,Cf(i))):o&&(e.opacity=Jh(void 0!==t.opacity?t.opacity:1,void 0!==n.opacity?n.opacity:1,i));for(let s=0;s<bf;s++){const r=`border${xf[s]}Radius`;let o=Ef(t,r),a=Ef(n,r);void 0===o&&void 0===a||(o||(o=0),a||(a=0),0===o||0===a||wf(o)===wf(a)?(e[r]=Math.max(Jh(_f(o),_f(a),i),0),(Vu.test(a)||Vu.test(o))&&(e[r]+="%")):e[r]=a)}(t.rotate||n.rotate)&&(e.rotate=Jh(t.rotate||0,n.rotate||0,i))}(r,i,this.latestValues,n,u,c)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Nc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Lc.update((()=>{lf.hasAnimatedSinceResize=!0,tu.layout++,this.currentAnimation=function(e,t,n){const i=uu(e)?e:ru(e);return i.start(Wd("",i,t,n)),i.animation}(0,1e3,{...e,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{tu.layout--},onComplete:()=>{tu.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:i,latestValues:r}=e;if(t&&n&&i){if(this!==e&&this.layout&&i&&vm(this.options.animationType,this.layout.layoutBox,i.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=gp(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const i=gp(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+i}Rf(t,n),Op(t,r),yp(this.projectionDeltaWithTransform,this.layoutCorrected,t,r)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new Gf);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=this.getStack();i&&i.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const i={};n.z&&Xf("z",e,i,this.animationValues);for(let r=0;r<Wf.length;r++)Xf(`rotate${Wf[r]}`,e,i,this.animationValues),Xf(`skew${Wf[r]}`,e,i,this.animationValues);e.render();for(const r in i)e.setStaticValue(r,i[r]),this.animationValues&&(this.animationValues[r]=i[r]);e.scheduleRender()}getProjectionStyles(e){var t,n;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Qf;const i={visibility:""},r=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,i.opacity="",i.pointerEvents=Af(null===e||void 0===e?void 0:e.pointerEvents)||"",i.transform=r?r(this.latestValues,""):"none",i;const o=this.getLead();if(!this.projectionDelta||!this.layout||!o.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=Af(null===e||void 0===e?void 0:e.pointerEvents)||""),this.hasProjected&&!Cp(this.latestValues)&&(t.transform=r?r({},""):"none",this.hasProjected=!1),t}const s=o.animationValues||o.latestValues;this.applyTransformsToTarget(),i.transform=function(e,t,n){let i="";const r=e.x.translate/t.x,o=e.y.translate/t.y,s=(null===n||void 0===n?void 0:n.z)||0;if((r||o||s)&&(i=`translate3d(${r}px, ${o}px, ${s}px) `),1===t.x&&1===t.y||(i+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:e,rotate:t,rotateX:r,rotateY:o,skewX:s,skewY:a}=n;e&&(i=`perspective(${e}px) ${i}`),t&&(i+=`rotate(${t}deg) `),r&&(i+=`rotateX(${r}deg) `),o&&(i+=`rotateY(${o}deg) `),s&&(i+=`skewX(${s}deg) `),a&&(i+=`skewY(${a}deg) `)}const a=e.x.scale*t.x,l=e.y.scale*t.y;return 1===a&&1===l||(i+=`scale(${a}, ${l})`),i||"none"}(this.projectionDeltaWithTransform,this.treeScale,s),r&&(i.transform=r(s,i.transform));const{x:a,y:l}=this.projectionDelta;i.transformOrigin=`${100*a.origin}% ${100*l.origin}% 0`,o.animationValues?i.opacity=o===this?null!==(n=null!==(t=s.opacity)&&void 0!==t?t:this.latestValues.opacity)&&void 0!==n?n:1:this.preserveOpacity?this.latestValues.opacity:s.opacityExit:i.opacity=o===this?void 0!==s.opacity?s.opacity:"":void 0!==s.opacityExit?s.opacityExit:0;for(const c in df){if(void 0===s[c])continue;const{correct:e,applyTo:t,isCSSVariable:n}=df[c],r="none"===i.transform?s[c]:e(s[c],o);if(t){const e=t.length;for(let n=0;n<e;n++)i[t[n]]=r}else n?this.options.visualElement.renderState.vars[c]=r:i[c]=r}return this.options.layoutId&&(i.pointerEvents=o===this?Af(null===e||void 0===e?void 0:e.pointerEvents)||"":"none"),i}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(nm),this.root.sharedNodes.clear()}}}function Kf(e){e.updateLayout()}function Jf(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:i}=e.layout,{animationType:r}=e.options,o=n.source!==e.layout.source;"size"===r?wp((e=>{const i=o?n.measuredBox[e]:n.layoutBox[e],r=gp(i);i.min=t[e].min,i.max=i.min+r})):vm(r,n.layoutBox,t)&&wp((i=>{const r=o?n.measuredBox[i]:n.layoutBox[i],s=gp(t[i]);r.max=r.min+s,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[i].max=e.relativeTarget[i].min+s)}));const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};yp(s,t,n.layoutBox);const a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};o?yp(a,e.applyTransform(i,!0),n.measuredBox):yp(a,t,n.layoutBox);const l=!Of(s);let c=!1;if(!e.resumeFrom){const i=e.getClosestProjectingParent();if(i&&!i.resumeFrom){const{snapshot:r,layout:o}=i;if(r&&o){const s={x:{min:0,max:0},y:{min:0,max:0}};bp(s,n.layoutBox,r.layoutBox);const a={x:{min:0,max:0},y:{min:0,max:0}};bp(a,t,o.layoutBox),zf(s,a)||(c=!0),i.options.layoutRoot&&(e.relativeTarget=a,e.relativeTargetOrigin=s,e.relativeParent=i)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:a,layoutDelta:s,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function Zf(e){Pc.value&&Hf.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function em(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function tm(e){e.clearSnapshot()}function nm(e){e.clearMeasurements()}function im(e){e.isLayoutDirty=!1}function rm(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function om(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function sm(e){e.resolveTargetDelta()}function am(e){e.calcProjection()}function lm(e){e.resetSkewAndRotation()}function cm(e){e.removeLeadSnapshot()}function um(e,t,n){e.translate=Jh(t.translate,0,n),e.scale=Jh(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function hm(e,t,n,i){e.min=Jh(t.min,n.min,i),e.max=Jh(t.max,n.max,i)}function dm(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const pm={duration:.45,ease:[.4,0,.1,1]},fm=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),mm=fm("applewebkit/")&&!fm("chrome/")?Math.round:Kl;function gm(e){e.min=mm(e.min),e.max=mm(e.max)}function vm(e,t,n){return"position"===e||"preserve-aspect"===e&&(i=jf(t),r=jf(n),o=.2,!(Math.abs(i-r)<=o));var i,r,o}function ym(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const Am=Yf({attachResizeListener:(e,t)=>dp(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),xm={current:void 0},bm=Yf({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!xm.current){const e=new Am({});e.mount(window),e.setOptions({layoutScroll:!0}),xm.current=e}return xm.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),_m={pan:{Feature:class extends cp{constructor(){super(...arguments),this.removePointerDownListener=Kl}onPointerDown(e){this.session=new Vp(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Fp(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:rf(e),onStart:rf(t),onMove:n,onEnd:(e,t)=>{delete this.session,i&&Lc.postRender((()=>i(e,t)))}}}mount(){this.removePointerDownListener=fp(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends cp{constructor(e){super(e),this.removeGroupControls=Kl,this.removeListeners=Kl,this.controls=new tf(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Kl}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:bm,MeasureLayout:ff}};function wm(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover","Start"===n);const r=i["onHover"+n];r&&Lc.postRender((()=>r(t,pp(t))))}function Em(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap","Start"===n);const r=i["onTap"+("End"===n?"":n)];r&&Lc.postRender((()=>r(t,pp(t))))}const Sm=new WeakMap,Cm=new WeakMap,Mm=e=>{const t=Sm.get(e.target);t&&t(e)},Tm=e=>{e.forEach(Mm)};function Rm(e,t,n){const i=function(e){let{root:t,...n}=e;const i=t||document;Cm.has(i)||Cm.set(i,{});const r=Cm.get(i),o=JSON.stringify(n);return r[o]||(r[o]=new IntersectionObserver(Tm,{root:t,...n})),r[o]}(t);return Sm.set(e,n),i.observe(e),()=>{Sm.delete(e),i.unobserve(e)}}const Im={some:0,all:1};const Pm={inView:{Feature:class extends cp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:i="some",once:r}=e,o={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof i?i:Im[i]};return Rm(this.node.current,o,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,r&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:i}=this.node.getProps(),o=t?n:i;o&&o(e)}))}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,n=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==n[e]}(e,t));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends cp{mount(){const{current:e}=this.node;e&&(this.unmount=eu(e,((e,t)=>(Em(this.node,t,"Start"),(e,t)=>{let{success:n}=t;return Em(this.node,e,n?"End":"Cancel")})),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends cp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(Jbe){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=sd(dp(this.node.current,"focus",(()=>this.onFocus())),dp(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends cp{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[i,r,o]=Hc(e,n),s=e=>{if(!Wc(e))return;const{target:n}=e,i=t(n,e);if("function"!==typeof i||!n)return;const o=e=>{Wc(e)&&(i(e),n.removeEventListener("pointerleave",o))};n.addEventListener("pointerleave",o,r)};return i.forEach((e=>{e.addEventListener("pointerenter",s,r)})),o}(e,((e,t)=>(wm(this.node,t,"Start"),e=>wm(this.node,e,"End")))))}unmount(){}}}},Bm={layout:{ProjectionNode:bm,MeasureLayout:ff}},Lm=(0,s.createContext)({strict:!1}),Nm=(0,s.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Dm=(0,s.createContext)({});function km(e){return cc(e.animate)||Zd.some((t=>Kd(e[t])))}function Om(e){return Boolean(km(e)||e.variants)}function Um(e){const{initial:t,animate:n}=function(e,t){if(km(e)){const{initial:t,animate:n}=e;return{initial:!1===t||Kd(t)?t:void 0,animate:Kd(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,s.useContext)(Dm));return(0,s.useMemo)((()=>({initial:t,animate:n})),[Fm(t),Fm(n)])}function Fm(e){return Array.isArray(e)?e.join(" "):e}const zm="undefined"!==typeof window,jm={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Vm={};for(const t in jm)Vm[t]={isEnabled:e=>jm[t].some((t=>!!e[t]))};const Gm=Symbol.for("motionComponentSymbol");function Hm(e,t,n){return(0,s.useCallback)((i=>{i&&e.onMount&&e.onMount(i),t&&(i?t.mount(i):t.unmount()),n&&("function"===typeof n?n(i):zp(n)&&(n.current=i))}),[t])}const Wm=zm?s.useLayoutEffect:s.useEffect;function Qm(e,t,n,i,r){var o,a;const{visualElement:l}=(0,s.useContext)(Dm),c=(0,s.useContext)(Lm),u=(0,s.useContext)(of),h=(0,s.useContext)(Nm).reducedMotion,d=(0,s.useRef)(null);i=i||c.renderer,!d.current&&i&&(d.current=i(e,{visualState:t,parent:l,props:n,presenceContext:u,blockInitialAnimation:!!u&&!1===u.initial,reducedMotionConfig:h}));const p=d.current,f=(0,s.useContext)(af);!p||p.projection||!r||"html"!==p.type&&"svg"!==p.type||function(e,t,n,i){const{layoutId:r,layout:o,drag:s,dragConstraints:a,layoutScroll:l,layoutRoot:c}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:qm(e.parent)),e.projection.setOptions({layoutId:r,layout:o,alwaysMeasureLayout:Boolean(s)||a&&zp(a),visualElement:e,animationType:"string"===typeof o?o:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:c})}(d.current,n,r,f);const m=(0,s.useRef)(!1);(0,s.useInsertionEffect)((()=>{p&&m.current&&p.update(n,u)}));const g=n[pu],v=(0,s.useRef)(Boolean(g)&&!(null===(o=window.MotionHandoffIsComplete)||void 0===o?void 0:o.call(window,g))&&(null===(a=window.MotionHasOptimisedAnimation)||void 0===a?void 0:a.call(window,g)));return Wm((()=>{p&&(m.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),Oc.render(p.render),v.current&&p.animationState&&p.animationState.animateChanges())})),(0,s.useEffect)((()=>{p&&(!v.current&&p.animationState&&p.animationState.animateChanges(),v.current&&(queueMicrotask((()=>{var e;null===(e=window.MotionHandoffMarkAsComplete)||void 0===e||e.call(window,g)})),v.current=!1))})),p}function qm(e){if(e)return!1!==e.options.allowProjection?e.projection:qm(e.parent)}function Xm(e){let{preloadedFeatures:t,createVisualElement:n,useRender:i,useVisualState:r,Component:o}=e;var a,l;function c(e,t){let a;const l={...(0,s.useContext)(Nm),...e,layoutId:$m(e)},{isStatic:c}=l,u=Um(e),h=r(e,c);if(!c&&zm){!function(){(0,s.useContext)(Lm).strict;0}();const e=function(e){const{drag:t,layout:n}=Vm;if(!t&&!n)return{};const i={...t,...n};return{MeasureLayout:(null===t||void 0===t?void 0:t.isEnabled(e))||(null===n||void 0===n?void 0:n.isEnabled(e))?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}(l);a=e.MeasureLayout,u.visualElement=Qm(o,h,l,n,e.ProjectionNode)}return(0,We.jsxs)(Dm.Provider,{value:u,children:[a&&u.visualElement?(0,We.jsx)(a,{visualElement:u.visualElement,...l}):null,i(o,e,Hm(h,u.visualElement,t),h,c,u.visualElement)]})}t&&function(e){for(const t in e)Vm[t]={...Vm[t],...e[t]}}(t),c.displayName=`motion.${"string"===typeof o?o:`create(${null!==(l=null!==(a=o.displayName)&&void 0!==a?a:o.name)&&void 0!==l?l:""})`}`;const u=(0,s.forwardRef)(c);return u[Gm]=o,u}function $m(e){let{layoutId:t}=e;const n=(0,s.useContext)(sf).id;return n&&void 0!==t?n+"-"+t:t}function Ym(e,t){let{layout:n,layoutId:i}=t;return su.has(e)||e.startsWith("origin")||(n||void 0!==i)&&(!!df[e]||"opacity"===e)}const Km=(e,t)=>t&&"number"===typeof e?t.transform(e):e,Jm={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Zm=ou.length;function eg(e,t,n){const{style:i,vars:r,transformOrigin:o}=e;let s=!1,a=!1;for(const l in t){const e=t[l];if(su.has(l))s=!0;else if(Uh(l))r[l]=e;else{const t=Km(e,hh[l]);l.startsWith("origin")?(a=!0,o[l]=t):i[l]=t}}if(t.transform||(s||n?i.transform=function(e,t,n){let i="",r=!0;for(let o=0;o<Zm;o++){const s=ou[o],a=e[s];if(void 0===a)continue;let l=!0;if(l="number"===typeof a?a===(s.startsWith("scale")?1:0):0===parseFloat(a),!l||n){const e=Km(a,hh[s]);l||(r=!1,i+=`${Jm[s]||s}(${e}) `),n&&(t[s]=e)}}return i=i.trim(),n?i=n(t,r?"":i):r&&(i="none"),i}(t,e.transform,n):i.transform&&(i.transform="none")),a){const{originX:e="50%",originY:t="50%",originZ:n=0}=o;i.transformOrigin=`${e} ${t} ${n}`}}const tg=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ng(e,t,n){for(const i in t)uu(t[i])||Ym(i,n)||(e[i]=t[i])}function ig(e,t){const n={};return ng(n,e.style||{},e),Object.assign(n,function(e,t){let{transformTemplate:n}=e;return(0,s.useMemo)((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return eg(e,t,n),Object.assign({},e.vars,e.style)}),[t])}(e,t)),n}function rg(e,t){const n={},i=ig(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=!0===e.drag?"none":"pan-"+("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const og=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function sg(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||og.has(e)}let ag=e=>!sg(e);try{(lg=require("@emotion/is-prop-valid").default)&&(ag=e=>e.startsWith("on")?!sg(e):lg(e))}catch(Zbe){}var lg;const cg=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ug(e){return"string"===typeof e&&!e.includes("-")&&!!(cg.indexOf(e)>-1||/[A-Z]/u.test(e))}const hg={offset:"stroke-dashoffset",array:"stroke-dasharray"},dg={offset:"strokeDashoffset",array:"strokeDasharray"};function pg(e,t,n){return"string"===typeof e?e:Gu.transform(t+n*e)}function fg(e,t,n,i){let{attrX:r,attrY:o,attrScale:s,originX:a,originY:l,pathLength:c,pathSpacing:u=1,pathOffset:h=0,...d}=t;if(eg(e,d,i),n)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:p,style:f,dimensions:m}=e;p.transform&&(m&&(f.transform=p.transform),delete p.transform),m&&(void 0!==a||void 0!==l||f.transform)&&(f.transformOrigin=function(e,t,n){return`${pg(t,e.x,e.width)} ${pg(n,e.y,e.height)}`}(m,void 0!==a?a:.5,void 0!==l?l:.5)),void 0!==r&&(p.x=r),void 0!==o&&(p.y=o),void 0!==s&&(p.scale=s),void 0!==c&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const o=r?hg:dg;e[o.offset]=Gu.transform(-i);const s=Gu.transform(t),a=Gu.transform(n);e[o.array]=`${s} ${a}`}(p,c,u,h,!1)}const mg=()=>({style:{},transform:{},transformOrigin:{},vars:{},attrs:{}}),gg=e=>"string"===typeof e&&"svg"===e.toLowerCase();function vg(e,t,n,i){const r=(0,s.useMemo)((()=>{const n={style:{},transform:{},transformOrigin:{},vars:{},attrs:{}};return fg(n,t,gg(i),e.transformTemplate),{...n.attrs,style:{...n.style}}}),[t]);if(e.style){const t={};ng(t,e.style,e),r.style={...t,...r.style}}return r}function yg(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,n,i,r,o)=>{let{latestValues:a}=r;const l=(ug(t)?vg:rg)(n,a,o,t),c=function(e,t,n){const i={};for(const r in e)"values"===r&&"object"===typeof e.values||(ag(r)||!0===n&&sg(r)||!t&&!sg(r)||e.draggable&&r.startsWith("onDrag"))&&(i[r]=e[r]);return i}(n,"string"===typeof t,e),u=t!==s.Fragment?{...c,...l,ref:i}:{},{children:h}=n,d=(0,s.useMemo)((()=>uu(h)?h.get():h),[h]);return(0,s.createElement)(t,{...u,children:d})}}const Ag=e=>(t,n)=>{const i=(0,s.useContext)(Dm),r=(0,s.useContext)(of),o=()=>function(e,t,n,i){let{scrapeMotionValuesFromProps:r,createRenderState:o,onUpdate:s}=e;const a={latestValues:xg(t,n,i,r),renderState:o()};return s&&(a.onMount=e=>s({props:t,current:e,...a}),a.onUpdate=e=>s(e)),a}(e,t,i,r);return n?o():function(e){const t=(0,s.useRef)(null);return null===t.current&&(t.current=e()),t.current}(o)};function xg(e,t,n,i){const r={},o=i(e,{});for(const d in o)r[d]=Af(o[d]);let{initial:s,animate:a}=e;const l=km(e),c=Om(e);t&&c&&!l&&!1!==e.inherit&&(void 0===s&&(s=t.initial),void 0===a&&(a=t.animate));let u=!!n&&!1===n.initial;u=u||!1===s;const h=u?a:s;if(h&&"boolean"!==typeof h&&!cc(h)){const t=Array.isArray(h)?h:[h];for(let n=0;n<t.length;n++){const i=hc(e,t[n]);if(i){const{transitionEnd:e,transition:t,...n}=i;for(const i in n){let e=n[i];if(Array.isArray(e)){e=e[u?e.length-1:0]}null!==e&&(r[i]=e)}for(const i in e)r[i]=e[i]}}}return r}function bg(e,t,n){var i;const{style:r}=e,o={};for(const s in r)(uu(r[s])||t.style&&uu(t.style[s])||Ym(s,e)||void 0!==(null===(i=null===n||void 0===n?void 0:n.getValue(s))||void 0===i?void 0:i.liveStyle))&&(o[s]=r[s]);return o}const _g={useVisualState:Ag({scrapeMotionValuesFromProps:bg,createRenderState:tg})};function wg(e,t){try{t.dimensions="function"===typeof e.getBBox?e.getBBox():e.getBoundingClientRect()}catch(Jbe){t.dimensions={x:0,y:0,width:0,height:0}}}function Eg(e,t,n,i){let{style:r,vars:o}=t;Object.assign(e.style,r,i&&i.getProjectionStyles(n));for(const s in o)e.style.setProperty(s,o[s])}const Sg=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Cg(e,t,n,i){Eg(e,t,void 0,i);for(const r in t.attrs)e.setAttribute(Sg.has(r)?r:du(r),t.attrs[r])}function Mg(e,t,n){const i=bg(e,t,n);for(const r in e)if(uu(e[r])||uu(t[r])){i[-1!==ou.indexOf(r)?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r]=e[r]}return i}const Tg=["x","y","width","height","cx","cy","r"],Rg={useVisualState:Ag({scrapeMotionValuesFromProps:Mg,createRenderState:mg,onUpdate:e=>{let{props:t,prevProps:n,current:i,renderState:r,latestValues:o}=e;if(!i)return;let s=!!t.drag;if(!s)for(const l in o)if(su.has(l)){s=!0;break}if(!s)return;let a=!n;if(n)for(let l=0;l<Tg.length;l++){const e=Tg[l];t[e]!==n[e]&&(a=!0)}a&&Lc.read((()=>{wg(i,r),Lc.render((()=>{fg(r,o,gg(i.tagName),t.transformTemplate),Cg(i,r)}))}))}})};function Ig(e,t){return function(n){let{forwardMotionProps:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{forwardMotionProps:!1};return Xm({...ug(n)?Rg:_g,preloadedFeatures:e,useRender:yg(i),createVisualElement:t,Component:n})}}const Pg={current:null},Bg={current:!1};const Lg=[...Wh,Xu,ih],Ng=new WeakMap;const Dg=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class kg{scrapeMotionValuesFromProps(e,t,n){return{}}constructor(e){let{parent:t,props:n,presenceContext:i,reducedMotionConfig:r,blockInitialAnimation:o,visualState:s}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Dh,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=jc.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,Lc.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:u}=s;this.onUpdate=u,this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=n,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=Boolean(o),this.isControllingVariants=km(n),this.isVariantNode=Om(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const{willChange:h,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in d){const e=d[p];void 0!==l[p]&&uu(e)&&e.set(l[p],!1)}}mount(e){this.current=e,Ng.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),Bg.current||function(){if(Bg.current=!0,zm)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>Pg.current=e.matches;e.addListener(t),t()}else Pg.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||Pg.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Nc(this.notifyUpdate),Nc(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=su.has(e);n&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&Lc.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)})),r=t.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{i(),r(),o&&o(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in Vm){const t=Vm[e];if(!t)continue;const{isEnabled:n,Feature:i}=t;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<Dg.length;n++){const t=Dg[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const i=e["on"+t];i&&(this.propEventSubscriptions[t]=this.on(t,i))}this.prevMotionValues=function(e,t,n){for(const i in t){const r=t[i],o=n[i];if(uu(r))e.addValue(i,r);else if(uu(o))e.addValue(i,ru(r,{owner:e}));else if(o!==r)if(e.hasValue(i)){const t=e.getValue(i);!0===t.liveStyle?t.jump(r):t.hasAnimated||t.set(r)}else{const t=e.getStaticValue(i);e.addValue(i,ru(void 0!==t?t:r,{owner:e}))}}for(const i in n)void 0===t[i]&&e.removeValue(i);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=ru(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){var n;let i=void 0===this.latestValues[e]&&this.current?null!==(n=this.getBaseTargetFromProps(this.props,e))&&void 0!==n?n:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];var r;return void 0!==i&&null!==i&&("string"===typeof i&&(kh(i)||Mu(i))?i=parseFloat(i):(r=i,!Lg.find(Hh(r))&&ih.test(t)&&(i=fh(e,t))),this.setBaseTarget(e,uu(i)?i.get():i)),uu(i)?i.get():i}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:n}=this.props;let i;if("string"===typeof n||"object"===typeof n){const r=hc(this.props,n,null===(t=this.presenceContext)||void 0===t?void 0:t.custom);r&&(i=r[e])}if(n&&void 0!==i)return i;const r=this.getBaseTargetFromProps(this.props,e);return void 0===r||uu(r)?void 0!==this.initialValues[e]&&void 0===i?void 0:this.baseTarget[e]:r}on(e,t){return this.events[e]||(this.events[e]=new rc),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.events[e].notify(...n)}}}class Og extends kg{constructor(){super(...arguments),this.KeyframeResolver=qh}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:n,style:i}=t;delete n[e],delete i[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;uu(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent=`${e}`)})))}}class Ug extends Og{constructor(){super(...arguments),this.type="html",this.renderInstance=Eg}readValueFromInstance(e,t){if(su.has(t))return((e,t)=>{const{transform:n="none"}=getComputedStyle(e);return Eh(n,t)})(e,t);{const i=(n=e,window.getComputedStyle(n)),r=(Uh(t)?i.getPropertyValue(t):i[t])||0;return"string"===typeof r?r.trim():r}var n}measureInstanceViewportBox(e,t){let{transformPagePoint:n}=t;return Up(e,n)}build(e,t,n){eg(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return bg(e,t,n)}}class Fg extends Og{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=_p,this.updateDimensions=()=>{this.current&&!this.renderState.dimensions&&wg(this.current,this.renderState)}}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(su.has(t)){const e=ph(t);return e&&e.default||0}return t=Sg.has(t)?t:du(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return Mg(e,t,n)}onBindTransform(){this.current&&!this.renderState.dimensions&&Lc.postRender(this.updateDimensions)}build(e,t,n){fg(e,t,this.isSVGTag,n.transformTemplate)}renderInstance(e,t,n,i){Cg(e,t,0,i)}mount(e){this.isSVGTag=gg(e.tagName),super.mount(e)}}const zg=lc(Ig({...hp,...Pm,..._m,...Bm},((e,t)=>ug(e)?new Fg(t):new Ug(t,{allowProjection:e!==s.Fragment})))),jg=(0,ji.A)((0,We.jsx)("path",{d:"M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2m-6 0h-4V4h4z"}),"Work"),Vg=(0,ji.A)((0,We.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Gg=(0,ji.A)((0,We.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),Hg=(0,ji.A)((0,We.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");function Wg(e){return(0,Et.Ay)("MuiFab",e)}const Qg=(0,wt.A)("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]),qg=["children","className","color","component","disabled","disableFocusRipple","focusVisibleClassName","size","variant"],Xg=(0,At.Ay)(gn,{name:"MuiFab",slot:"Root",shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`size${(0,xt.A)(n.size)}`],"inherit"===n.color&&t.colorInherit,t[(0,xt.A)(n.size)],t[n.color]]}})((e=>{let{theme:t,ownerState:n}=e;var i,r;return(0,ze.A)({},t.typography.button,{minHeight:36,transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(t.vars||t).zIndex.fab,boxShadow:(t.vars||t).shadows[6],"&:active":{boxShadow:(t.vars||t).shadows[12]},color:t.vars?t.vars.palette.text.primary:null==(i=(r=t.palette).getContrastText)?void 0:i.call(r,t.palette.grey[300]),backgroundColor:(t.vars||t).palette.grey[300],"&:hover":{backgroundColor:(t.vars||t).palette.grey.A100,"@media (hover: none)":{backgroundColor:(t.vars||t).palette.grey[300]},textDecoration:"none"},[`&.${Qg.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]}},"small"===n.size&&{width:40,height:40},"medium"===n.size&&{width:48,height:48},"extended"===n.variant&&{borderRadius:24,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48},"extended"===n.variant&&"small"===n.size&&{width:"auto",padding:"0 8px",borderRadius:17,minWidth:34,height:34},"extended"===n.variant&&"medium"===n.size&&{width:"auto",padding:"0 16px",borderRadius:20,minWidth:40,height:40},"inherit"===n.color&&{color:"inherit"})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},"inherit"!==n.color&&"default"!==n.color&&null!=(t.vars||t).palette[n.color]&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}})}),(e=>{let{theme:t}=e;return{[`&.${Qg.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}})),$g=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiFab"}),{children:i,className:r,color:o="default",component:s="button",disabled:a=!1,disableFocusRipple:l=!1,focusVisibleClassName:c,size:u="large",variant:h="circular"}=n,d=(0,je.A)(n,qg),p=(0,ze.A)({},n,{color:o,component:s,disabled:a,disableFocusRipple:l,size:u,variant:h}),f=(e=>{const{color:t,variant:n,classes:i,size:r}=e,o={root:["root",n,`size${(0,xt.A)(r)}`,"inherit"===t?"colorInherit":t]},s=(0,yt.A)(o,Wg,i);return(0,ze.A)({},i,s)})(p);return(0,We.jsx)(Xg,(0,ze.A)({className:(0,vt.A)(f.root,r),component:s,disabled:a,focusRipple:!l,focusVisibleClassName:(0,vt.A)(f.focusVisible,c),ownerState:p,ref:t},d,{classes:f,children:i}))})),Yg=["addEndListener","appear","children","container","direction","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function Kg(e,t,n){var i;const r=function(e,t,n){const i=t.getBoundingClientRect(),r=n&&n.getBoundingClientRect(),o=(0,mr.A)(t);let s;if(t.fakeTransform)s=t.fakeTransform;else{const e=o.getComputedStyle(t);s=e.getPropertyValue("-webkit-transform")||e.getPropertyValue("transform")}let a=0,l=0;if(s&&"none"!==s&&"string"===typeof s){const e=s.split("(")[1].split(")")[0].split(",");a=parseInt(e[4],10),l=parseInt(e[5],10)}return"left"===e?r?`translateX(${r.right+a-i.left}px)`:`translateX(${o.innerWidth+a-i.left}px)`:"right"===e?r?`translateX(-${i.right-r.left-a}px)`:`translateX(-${i.left+i.width-a}px)`:"up"===e?r?`translateY(${r.bottom+l-i.top}px)`:`translateY(${o.innerHeight+l-i.top}px)`:r?`translateY(-${i.top-r.top+i.height-l}px)`:`translateY(-${i.top+i.height-l}px)`}(e,t,"function"===typeof(i=n)?i():i);r&&(t.style.webkitTransform=r,t.style.transform=r)}const Jg=s.forwardRef((function(e,t){const n=Cr(),i={enter:n.transitions.easing.easeOut,exit:n.transitions.easing.sharp},r={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{addEndListener:o,appear:a=!0,children:l,container:c,direction:u="down",easing:h=i,in:d,onEnter:p,onEntered:f,onEntering:m,onExit:g,onExited:v,onExiting:y,style:A,timeout:x=r,TransitionComponent:b=Sr}=e,_=(0,je.A)(e,Yg),w=s.useRef(null),E=(0,kt.A)(gr(l),w,t),S=e=>t=>{e&&(void 0===t?e(w.current):e(w.current,t))},C=S(((e,t)=>{Kg(u,e,c),Mr(e),p&&p(e,t)})),M=S(((e,t)=>{const i=Tr({timeout:x,style:A,easing:h},{mode:"enter"});e.style.webkitTransition=n.transitions.create("-webkit-transform",(0,ze.A)({},i)),e.style.transition=n.transitions.create("transform",(0,ze.A)({},i)),e.style.webkitTransform="none",e.style.transform="none",m&&m(e,t)})),T=S(f),R=S(y),I=S((e=>{const t=Tr({timeout:x,style:A,easing:h},{mode:"exit"});e.style.webkitTransition=n.transitions.create("-webkit-transform",t),e.style.transition=n.transitions.create("transform",t),Kg(u,e,c),g&&g(e)})),P=S((e=>{e.style.webkitTransition="",e.style.transition="",v&&v(e)})),B=s.useCallback((()=>{w.current&&Kg(u,w.current,c)}),[u,c]);return s.useEffect((()=>{if(d||"down"===u||"right"===u)return;const e=(0,fr.A)((()=>{w.current&&Kg(u,w.current,c)})),t=(0,mr.A)(w.current);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[u,d,c]),s.useEffect((()=>{d||B()}),[d,B]),(0,We.jsx)(b,(0,ze.A)({nodeRef:w,onEnter:C,onEntered:T,onEntering:M,onExit:I,onExited:P,onExiting:R,addEndListener:e=>{o&&o(w.current,e)},appear:a,in:d,timeout:x},_,{children:(e,t)=>s.cloneElement(l,(0,ze.A)({ref:E,style:(0,ze.A)({visibility:"exited"!==e||d?void 0:"hidden"},A,l.props.style)},t))}))})),Zg=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],ev=(0,At.Ay)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.absolute&&t.absolute,t[n.variant],n.light&&t.light,"vertical"===n.orientation&&t.vertical,n.flexItem&&t.flexItem,n.children&&t.withChildren,n.children&&"vertical"===n.orientation&&t.withChildrenVertical,"right"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignRight,"left"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignLeft]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin"},n.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},n.light&&{borderColor:t.vars?`rgba(${t.vars.palette.dividerChannel} / 0.08)`:(0,bt.X4)(t.palette.divider,.08)},"inset"===n.variant&&{marginLeft:72},"middle"===n.variant&&"horizontal"===n.orientation&&{marginLeft:t.spacing(2),marginRight:t.spacing(2)},"middle"===n.variant&&"vertical"===n.orientation&&{marginTop:t.spacing(1),marginBottom:t.spacing(1)},"vertical"===n.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},n.flexItem&&{alignSelf:"stretch",height:"auto"})}),(e=>{let{ownerState:t}=e;return(0,ze.A)({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},n.children&&"vertical"!==n.orientation&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`,borderTopStyle:"inherit"}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},n.children&&"vertical"===n.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`,borderLeftStyle:"inherit"}})}),(e=>{let{ownerState:t}=e;return(0,ze.A)({},"right"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})})),tv=(0,At.Ay)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.wrapper,"vertical"===n.orientation&&t.wrapperVertical]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`},"vertical"===n.orientation&&{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`})})),nv=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiDivider"}),{absolute:i=!1,children:r,className:o,component:s=(r?"div":"hr"),flexItem:a=!1,light:l=!1,orientation:c="horizontal",role:u=("hr"!==s?"separator":void 0),textAlign:h="center",variant:d="fullWidth"}=n,p=(0,je.A)(n,Zg),f=(0,ze.A)({},n,{absolute:i,component:s,flexItem:a,light:l,orientation:c,role:u,textAlign:h,variant:d}),m=(e=>{const{absolute:t,children:n,classes:i,flexItem:r,light:o,orientation:s,textAlign:a,variant:l}=e,c={root:["root",t&&"absolute",l,o&&"light","vertical"===s&&"vertical",r&&"flexItem",n&&"withChildren",n&&"vertical"===s&&"withChildrenVertical","right"===a&&"vertical"!==s&&"textAlignRight","left"===a&&"vertical"!==s&&"textAlignLeft"],wrapper:["wrapper","vertical"===s&&"wrapperVertical"]};return(0,yt.A)(c,Bo,i)})(f);return(0,We.jsx)(ev,(0,ze.A)({as:s,className:(0,vt.A)(m.root,o),role:u,ref:t,ownerState:f},p,{children:r?(0,We.jsx)(tv,{className:m.wrapper,ownerState:f,children:r}):null}))}));nv.muiSkipListHighlight=!0;const iv=nv;var rv=i(5844),ov=i(7868),sv=i(3468);const av=["onChange","maxRows","minRows","style","value"];function lv(e){return parseInt(e,10)||0}const cv={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"};function uv(e){return function(e){for(const t in e)return!1;return!0}(e)||0===e.outerHeightStyle&&!e.overflowing}const hv=s.forwardRef((function(e,t){const{onChange:n,maxRows:i,minRows:r=1,style:o,value:a}=e,l=(0,je.A)(e,av),{current:c}=s.useRef(null!=a),u=s.useRef(null),h=(0,Si.A)(t,u),d=s.useRef(null),p=s.useRef(null),f=s.useCallback((()=>{const t=u.current,n=p.current;if(!t||!n)return;const o=(0,Jr.A)(t).getComputedStyle(t);if("0px"===o.width)return{outerHeightStyle:0,overflowing:!1};n.style.width=o.width,n.value=t.value||e.placeholder||"x","\n"===n.value.slice(-1)&&(n.value+=" ");const s=o.boxSizing,a=lv(o.paddingBottom)+lv(o.paddingTop),l=lv(o.borderBottomWidth)+lv(o.borderTopWidth),c=n.scrollHeight;n.value="x";const h=n.scrollHeight;let d=c;r&&(d=Math.max(Number(r)*h,d)),i&&(d=Math.min(Number(i)*h,d)),d=Math.max(d,h);return{outerHeightStyle:d+("border-box"===s?a+l:0),overflowing:Math.abs(d-c)<=1}}),[i,r,e.placeholder]),m=(0,Yr.A)((()=>{const e=u.current,t=f();if(!e||!t||uv(t))return!1;const n=t.outerHeightStyle;return null!=d.current&&d.current!==n})),g=s.useCallback((()=>{const e=u.current,t=f();if(!e||!t||uv(t))return;const n=t.outerHeightStyle;d.current!==n&&(d.current=n,e.style.height=`${n}px`),e.style.overflow=t.overflowing?"hidden":""}),[f]),v=s.useRef(-1);(0,zr.A)((()=>{const e=(0,sv.A)(g),t=null==u?void 0:u.current;if(!t)return;const n=(0,Jr.A)(t);let i;return n.addEventListener("resize",e),"undefined"!==typeof ResizeObserver&&(i=new ResizeObserver((()=>{m()&&(i.unobserve(t),cancelAnimationFrame(v.current),g(),v.current=requestAnimationFrame((()=>{i.observe(t)})))})),i.observe(t)),()=>{e.clear(),cancelAnimationFrame(v.current),n.removeEventListener("resize",e),i&&i.disconnect()}}),[f,g,m]),(0,zr.A)((()=>{g()}));return(0,We.jsxs)(s.Fragment,{children:[(0,We.jsx)("textarea",(0,ze.A)({value:a,onChange:e=>{c||g(),n&&n(e)},ref:h,rows:r,style:o},l)),(0,We.jsx)("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:p,tabIndex:-1,style:(0,ze.A)({},cv,o,{paddingTop:0,paddingBottom:0})})]})}));function dv(e){let{props:t,states:n,muiFormControl:i}=e;return n.reduce(((e,n)=>(e[n]=t[n],i&&"undefined"===typeof t[n]&&(e[n]=i[n]),e)),{})}const pv=s.createContext(void 0);function fv(){return s.useContext(pv)}function mv(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function gv(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(mv(e.value)&&""!==e.value||t&&mv(e.defaultValue)&&""!==e.defaultValue)}function vv(e){return(0,Et.Ay)("MuiInputBase",e)}const yv=(0,wt.A)("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),Av=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],xv=(e,t)=>{const{ownerState:n}=e;return[t.root,n.formControl&&t.formControl,n.startAdornment&&t.adornedStart,n.endAdornment&&t.adornedEnd,n.error&&t.error,"small"===n.size&&t.sizeSmall,n.multiline&&t.multiline,n.color&&t[`color${(0,xt.A)(n.color)}`],n.fullWidth&&t.fullWidth,n.hiddenLabel&&t.hiddenLabel]},bv=(e,t)=>{const{ownerState:n}=e;return[t.input,"small"===n.size&&t.inputSizeSmall,n.multiline&&t.inputMultiline,"search"===n.type&&t.inputTypeSearch,n.startAdornment&&t.inputAdornedStart,n.endAdornment&&t.inputAdornedEnd,n.hiddenLabel&&t.inputHiddenLabel]},_v=(0,At.Ay)("div",{name:"MuiInputBase",slot:"Root",overridesResolver:xv})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},t.typography.body1,{color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${yv.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"}},n.multiline&&(0,ze.A)({padding:"4px 0 5px"},"small"===n.size&&{paddingTop:1}),n.fullWidth&&{width:"100%"})})),wv=(0,At.Ay)("input",{name:"MuiInputBase",slot:"Input",overridesResolver:bv})((e=>{let{theme:t,ownerState:n}=e;const i="light"===t.palette.mode,r=(0,ze.A)({color:"currentColor"},t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:i?.42:.5},{transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})}),o={opacity:"0 !important"},s=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:i?.42:.5};return(0,ze.A)({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&:-ms-input-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${yv.formControl} &`]:{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&:-ms-input-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s},[`&.${yv.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},"small"===n.size&&{paddingTop:1},n.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},"search"===n.type&&{MozAppearance:"textfield"})})),Ev=(0,We.jsx)(pt,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),Sv=s.forwardRef((function(e,t){var n;const i=(0,st.b)({props:e,name:"MuiInputBase"}),{"aria-describedby":r,autoComplete:o,autoFocus:a,className:l,components:c={},componentsProps:u={},defaultValue:h,disabled:d,disableInjectingGlobalStyles:p,endAdornment:f,fullWidth:m=!1,id:g,inputComponent:v="input",inputProps:y={},inputRef:A,maxRows:x,minRows:b,multiline:_=!1,name:w,onBlur:E,onChange:S,onClick:C,onFocus:M,onKeyDown:T,onKeyUp:R,placeholder:I,readOnly:P,renderSuffix:B,rows:L,slotProps:N={},slots:D={},startAdornment:k,type:O="text",value:U}=i,F=(0,je.A)(i,Av),z=null!=y.value?y.value:U,{current:j}=s.useRef(null!=z),V=s.useRef(),G=s.useCallback((e=>{0}),[]),H=(0,kt.A)(V,A,y.ref,G),[W,Q]=s.useState(!1),q=fv();const X=dv({props:i,muiFormControl:q,states:["color","disabled","error","hiddenLabel","size","required","filled"]});X.focused=q?q.focused:W,s.useEffect((()=>{!q&&d&&W&&(Q(!1),E&&E())}),[q,d,W,E]);const $=q&&q.onFilled,Y=q&&q.onEmpty,K=s.useCallback((e=>{gv(e)?$&&$():Y&&Y()}),[$,Y]);(0,ar.A)((()=>{j&&K({value:z})}),[z,K,j]);s.useEffect((()=>{K(V.current)}),[]);let J=v,Z=y;_&&"input"===J&&(Z=L?(0,ze.A)({type:void 0,minRows:L,maxRows:L},Z):(0,ze.A)({type:void 0,maxRows:x,minRows:b},Z),J=hv);s.useEffect((()=>{q&&q.setAdornedStart(Boolean(k))}),[q,k]);const ee=(0,ze.A)({},i,{color:X.color||"primary",disabled:X.disabled,endAdornment:f,error:X.error,focused:X.focused,formControl:q,fullWidth:m,hiddenLabel:X.hiddenLabel,multiline:_,size:X.size,startAdornment:k,type:O}),te=(e=>{const{classes:t,color:n,disabled:i,error:r,endAdornment:o,focused:s,formControl:a,fullWidth:l,hiddenLabel:c,multiline:u,readOnly:h,size:d,startAdornment:p,type:f}=e,m={root:["root",`color${(0,xt.A)(n)}`,i&&"disabled",r&&"error",l&&"fullWidth",s&&"focused",a&&"formControl",d&&"medium"!==d&&`size${(0,xt.A)(d)}`,u&&"multiline",p&&"adornedStart",o&&"adornedEnd",c&&"hiddenLabel",h&&"readOnly"],input:["input",i&&"disabled","search"===f&&"inputTypeSearch",u&&"inputMultiline","small"===d&&"inputSizeSmall",c&&"inputHiddenLabel",p&&"inputAdornedStart",o&&"inputAdornedEnd",h&&"readOnly"]};return(0,yt.A)(m,vv,t)})(ee),ne=D.root||c.Root||_v,ie=N.root||u.root||{},re=D.input||c.Input||wv;return Z=(0,ze.A)({},Z,null!=(n=N.input)?n:u.input),(0,We.jsxs)(s.Fragment,{children:[!p&&Ev,(0,We.jsxs)(ne,(0,ze.A)({},ie,!Ci(ne)&&{ownerState:(0,ze.A)({},ee,ie.ownerState)},{ref:t,onClick:e=>{V.current&&e.currentTarget===e.target&&V.current.focus(),C&&C(e)}},F,{className:(0,vt.A)(te.root,ie.className,l,P&&"MuiInputBase-readOnly"),children:[k,(0,We.jsx)(pv.Provider,{value:null,children:(0,We.jsx)(re,(0,ze.A)({ownerState:ee,"aria-invalid":X.error,"aria-describedby":r,autoComplete:o,autoFocus:a,defaultValue:h,disabled:X.disabled,id:g,onAnimationStart:e=>{K("mui-auto-fill-cancel"===e.animationName?V.current:{value:"x"})},name:w,placeholder:I,readOnly:P,required:X.required,rows:L,value:z,onKeyDown:T,onKeyUp:R,type:O},Z,!Ci(re)&&{as:J,ownerState:(0,ze.A)({},ee,Z.ownerState)},{ref:H,className:(0,vt.A)(te.input,Z.className,P&&"MuiInputBase-readOnly"),onBlur:e=>{E&&E(e),y.onBlur&&y.onBlur(e),q&&q.onBlur?q.onBlur(e):Q(!1)},onChange:function(e){if(!j){const t=e.target||V.current;if(null==t)throw new Error((0,ov.A)(1));K({value:t.value})}for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];y.onChange&&y.onChange(e,...n),S&&S(e,...n)},onFocus:e=>{X.disabled?e.stopPropagation():(M&&M(e),y.onFocus&&y.onFocus(e),q&&q.onFocus?q.onFocus(e):Q(!0))}}))}),f,B?B((0,ze.A)({},X,{startAdornment:k})):null]}))]})})),Cv=Sv;function Mv(e){return(0,Et.Ay)("MuiInput",e)}const Tv=(0,ze.A)({},yv,(0,wt.A)("MuiInput",["root","underline","input"])),Rv=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],Iv=(0,At.Ay)(_v,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...xv(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;let i="light"===t.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(i=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),(0,ze.A)({position:"relative"},n.formControl&&{"label + &":{marginTop:16}},!n.disableUnderline&&{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[n.color].main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Tv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Tv.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${i}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Tv.disabled}, .${Tv.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${i}`}},[`&.${Tv.disabled}:before`]:{borderBottomStyle:"dotted"}})})),Pv=(0,At.Ay)(wv,{name:"MuiInput",slot:"Input",overridesResolver:bv})({}),Bv=s.forwardRef((function(e,t){var n,i,r,o;const s=(0,st.b)({props:e,name:"MuiInput"}),{disableUnderline:a,components:l={},componentsProps:c,fullWidth:u=!1,inputComponent:h="input",multiline:d=!1,slotProps:p,slots:f={},type:m="text"}=s,g=(0,je.A)(s,Rv),v=(e=>{const{classes:t,disableUnderline:n}=e,i={root:["root",!n&&"underline"],input:["input"]},r=(0,yt.A)(i,Mv,t);return(0,ze.A)({},t,r)})(s),y={root:{ownerState:{disableUnderline:a}}},A=(null!=p?p:c)?(0,On.A)(null!=p?p:c,y):y,x=null!=(n=null!=(i=f.root)?i:l.Root)?n:Iv,b=null!=(r=null!=(o=f.input)?o:l.Input)?r:Pv;return(0,We.jsx)(Cv,(0,ze.A)({slots:{root:x,input:b},slotProps:A,fullWidth:u,inputComponent:h,multiline:d,ref:t,type:m},g,{classes:v}))}));Bv.muiName="Input";const Lv=Bv;function Nv(e){return(0,Et.Ay)("MuiFilledInput",e)}const Dv=(0,ze.A)({},yv,(0,wt.A)("MuiFilledInput",["root","underline","input"])),kv=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],Ov=(0,At.Ay)(_v,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...xv(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;var i;const r="light"===t.palette.mode,o=r?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=r?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",a=r?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",l=r?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return(0,ze.A)({position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:a,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s}},[`&.${Dv.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s},[`&.${Dv.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:l}},!n.disableUnderline&&{"&::after":{borderBottom:`2px solid ${null==(i=(t.vars||t).palette[n.color||"primary"])?void 0:i.main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Dv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Dv.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:o}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Dv.disabled}, .${Dv.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Dv.disabled}:before`]:{borderBottomStyle:"dotted"}},n.startAdornment&&{paddingLeft:12},n.endAdornment&&{paddingRight:12},n.multiline&&(0,ze.A)({padding:"25px 12px 8px"},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9}))})),Uv=(0,At.Ay)(wv,{name:"MuiFilledInput",slot:"Input",overridesResolver:bv})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9},n.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})})),Fv=s.forwardRef((function(e,t){var n,i,r,o;const s=(0,st.b)({props:e,name:"MuiFilledInput"}),{components:a={},componentsProps:l,fullWidth:c=!1,inputComponent:u="input",multiline:h=!1,slotProps:d,slots:p={},type:f="text"}=s,m=(0,je.A)(s,kv),g=(0,ze.A)({},s,{fullWidth:c,inputComponent:u,multiline:h,type:f}),v=(e=>{const{classes:t,disableUnderline:n}=e,i={root:["root",!n&&"underline"],input:["input"]},r=(0,yt.A)(i,Nv,t);return(0,ze.A)({},t,r)})(s),y={root:{ownerState:g},input:{ownerState:g}},A=(null!=d?d:l)?(0,On.A)(y,null!=d?d:l):y,x=null!=(n=null!=(i=p.root)?i:a.Root)?n:Ov,b=null!=(r=null!=(o=p.input)?o:a.Input)?r:Uv;return(0,We.jsx)(Cv,(0,ze.A)({slots:{root:x,input:b},componentsProps:A,fullWidth:c,inputComponent:u,multiline:h,ref:t,type:f},m,{classes:v}))}));Fv.muiName="Input";const zv=Fv;var jv;const Vv=["children","classes","className","label","notched"],Gv=(0,At.Ay)("fieldset",{shouldForwardProp:Dt.A})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Hv=(0,At.Ay)("legend",{shouldForwardProp:Dt.A})((e=>{let{ownerState:t,theme:n}=e;return(0,ze.A)({float:"unset",width:"auto",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:n.transitions.create("width",{duration:150,easing:n.transitions.easing.easeOut})},t.withLabel&&(0,ze.A)({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:n.transitions.create("max-width",{duration:50,easing:n.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:n.transitions.create("max-width",{duration:100,easing:n.transitions.easing.easeOut,delay:50})}))}));function Wv(e){return(0,Et.Ay)("MuiOutlinedInput",e)}const Qv=(0,ze.A)({},yv,(0,wt.A)("MuiOutlinedInput",["root","notchedOutline","input"])),qv=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],Xv=(0,At.Ay)(_v,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiOutlinedInput",slot:"Root",overridesResolver:xv})((e=>{let{theme:t,ownerState:n}=e;const i="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return(0,ze.A)({position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${Qv.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${Qv.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:i}},[`&.${Qv.focused} .${Qv.notchedOutline}`]:{borderColor:(t.vars||t).palette[n.color].main,borderWidth:2},[`&.${Qv.error} .${Qv.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${Qv.disabled} .${Qv.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}},n.startAdornment&&{paddingLeft:14},n.endAdornment&&{paddingRight:14},n.multiline&&(0,ze.A)({padding:"16.5px 14px"},"small"===n.size&&{padding:"8.5px 14px"}))})),$v=(0,At.Ay)((function(e){const{className:t,label:n,notched:i}=e,r=(0,je.A)(e,Vv),o=null!=n&&""!==n,s=(0,ze.A)({},e,{notched:i,withLabel:o});return(0,We.jsx)(Gv,(0,ze.A)({"aria-hidden":!0,className:t,ownerState:s},r,{children:(0,We.jsx)(Hv,{ownerState:s,children:o?(0,We.jsx)("span",{children:n}):jv||(jv=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"}))})}))}),{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:n}})),Yv=(0,At.Ay)(wv,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:bv})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{padding:"8.5px 14px"},n.multiline&&{padding:0},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0})})),Kv=s.forwardRef((function(e,t){var n,i,r,o,a;const l=(0,st.b)({props:e,name:"MuiOutlinedInput"}),{components:c={},fullWidth:u=!1,inputComponent:h="input",label:d,multiline:p=!1,notched:f,slots:m={},type:g="text"}=l,v=(0,je.A)(l,qv),y=(e=>{const{classes:t}=e,n=(0,yt.A)({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Wv,t);return(0,ze.A)({},t,n)})(l),A=fv(),x=dv({props:l,muiFormControl:A,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),b=(0,ze.A)({},l,{color:x.color||"primary",disabled:x.disabled,error:x.error,focused:x.focused,formControl:A,fullWidth:u,hiddenLabel:x.hiddenLabel,multiline:p,size:x.size,type:g}),_=null!=(n=null!=(i=m.root)?i:c.Root)?n:Xv,w=null!=(r=null!=(o=m.input)?o:c.Input)?r:Yv;return(0,We.jsx)(Cv,(0,ze.A)({slots:{root:_,input:w},renderSuffix:e=>(0,We.jsx)($v,{ownerState:b,className:y.notchedOutline,label:null!=d&&""!==d&&x.required?a||(a=(0,We.jsxs)(s.Fragment,{children:[d,"\u2009","*"]})):d,notched:"undefined"!==typeof f?f:Boolean(e.startAdornment||e.filled||e.focused)}),fullWidth:u,inputComponent:h,multiline:p,ref:t,type:g},v,{classes:(0,ze.A)({},y,{notchedOutline:null})}))}));Kv.muiName="Input";const Jv=Kv;function Zv(e){return(0,Et.Ay)("MuiFormLabel",e)}const ey=(0,wt.A)("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),ty=["children","className","color","component","disabled","error","filled","focused","required"],ny=(0,At.Ay)("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,ze.A)({},t.root,"secondary"===n.color&&t.colorSecondary,n.filled&&t.filled)}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({color:(t.vars||t).palette.text.secondary},t.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${ey.focused}`]:{color:(t.vars||t).palette[n.color].main},[`&.${ey.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${ey.error}`]:{color:(t.vars||t).palette.error.main}})})),iy=(0,At.Ay)("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${ey.error}`]:{color:(t.vars||t).palette.error.main}}})),ry=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiFormLabel"}),{children:i,className:r,component:o="label"}=n,s=(0,je.A)(n,ty),a=dv({props:n,muiFormControl:fv(),states:["color","required","focused","disabled","error","filled"]}),l=(0,ze.A)({},n,{color:a.color||"primary",component:o,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),c=(e=>{const{classes:t,color:n,focused:i,disabled:r,error:o,filled:s,required:a}=e,l={root:["root",`color${(0,xt.A)(n)}`,r&&"disabled",o&&"error",s&&"filled",i&&"focused",a&&"required"],asterisk:["asterisk",o&&"error"]};return(0,yt.A)(l,Zv,t)})(l);return(0,We.jsxs)(ny,(0,ze.A)({as:o,ownerState:l,className:(0,vt.A)(c.root,r),ref:t},s,{children:[i,a.required&&(0,We.jsxs)(iy,{ownerState:l,"aria-hidden":!0,className:c.asterisk,children:["\u2009","*"]})]}))}));function oy(e){return(0,Et.Ay)("MuiInputLabel",e)}(0,wt.A)("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const sy=["disableAnimation","margin","shrink","variant","className"],ay=(0,At.Ay)(ry,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${ey.asterisk}`]:t.asterisk},t.root,n.formControl&&t.formControl,"small"===n.size&&t.sizeSmall,n.shrink&&t.shrink,!n.disableAnimation&&t.animated,n.focused&&t.focused,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},n.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},"small"===n.size&&{transform:"translate(0, 17px) scale(1)"},n.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!n.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},"filled"===n.variant&&(0,ze.A)({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(12px, 13px) scale(1)"},n.shrink&&(0,ze.A)({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},"small"===n.size&&{transform:"translate(12px, 4px) scale(0.75)"})),"outlined"===n.variant&&(0,ze.A)({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(14px, 9px) scale(1)"},n.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))})),ly=s.forwardRef((function(e,t){const n=(0,st.b)({name:"MuiInputLabel",props:e}),{disableAnimation:i=!1,shrink:r,className:o}=n,s=(0,je.A)(n,sy),a=fv();let l=r;"undefined"===typeof l&&a&&(l=a.filled||a.focused||a.adornedStart);const c=dv({props:n,muiFormControl:a,states:["size","variant","required","focused"]}),u=(0,ze.A)({},n,{disableAnimation:i,formControl:a,shrink:l,size:c.size,variant:c.variant,required:c.required,focused:c.focused}),h=(e=>{const{classes:t,formControl:n,size:i,shrink:r,disableAnimation:o,variant:s,required:a}=e,l={root:["root",n&&"formControl",!o&&"animated",r&&"shrink",i&&"normal"!==i&&`size${(0,xt.A)(i)}`,s],asterisk:[a&&"asterisk"]},c=(0,yt.A)(l,oy,t);return(0,ze.A)({},t,c)})(u);return(0,We.jsx)(ay,(0,ze.A)({"data-shrink":l,ownerState:u,ref:t,className:(0,vt.A)(h.root,o)},s,{classes:h}))}));function cy(e){return(0,Et.Ay)("MuiFormControl",e)}(0,wt.A)("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const uy=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],hy=(0,At.Ay)("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,ze.A)({},t.root,t[`margin${(0,xt.A)(n.margin)}`],n.fullWidth&&t.fullWidth)}})((e=>{let{ownerState:t}=e;return(0,ze.A)({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},"normal"===t.margin&&{marginTop:16,marginBottom:8},"dense"===t.margin&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})})),dy=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiFormControl"}),{children:i,className:r,color:o="primary",component:a="div",disabled:l=!1,error:c=!1,focused:u,fullWidth:h=!1,hiddenLabel:d=!1,margin:p="none",required:f=!1,size:m="medium",variant:g="outlined"}=n,v=(0,je.A)(n,uy),y=(0,ze.A)({},n,{color:o,component:a,disabled:l,error:c,fullWidth:h,hiddenLabel:d,margin:p,required:f,size:m,variant:g}),A=(e=>{const{classes:t,margin:n,fullWidth:i}=e,r={root:["root","none"!==n&&`margin${(0,xt.A)(n)}`,i&&"fullWidth"]};return(0,yt.A)(r,cy,t)})(y),[x,b]=s.useState((()=>{let e=!1;return i&&s.Children.forEach(i,(t=>{if(!(0,ll.A)(t,["Input","Select"]))return;const n=(0,ll.A)(t,["Select"])?t.props.input:t;n&&n.props.startAdornment&&(e=!0)})),e})),[_,w]=s.useState((()=>{let e=!1;return i&&s.Children.forEach(i,(t=>{(0,ll.A)(t,["Input","Select"])&&(gv(t.props,!0)||gv(t.props.inputProps,!0))&&(e=!0)})),e})),[E,S]=s.useState(!1);l&&E&&S(!1);const C=void 0===u||l?E:u;let M;const T=s.useMemo((()=>({adornedStart:x,setAdornedStart:b,color:o,disabled:l,error:c,filled:_,focused:C,fullWidth:h,hiddenLabel:d,size:m,onBlur:()=>{S(!1)},onEmpty:()=>{w(!1)},onFilled:()=>{w(!0)},onFocus:()=>{S(!0)},registerEffect:M,required:f,variant:g})),[x,o,l,c,_,C,h,d,M,f,m,g]);return(0,We.jsx)(pv.Provider,{value:T,children:(0,We.jsx)(hy,(0,ze.A)({as:a,ownerState:y,className:(0,vt.A)(A.root,r),ref:t},v,{children:i}))})}));function py(e){return(0,Et.Ay)("MuiFormHelperText",e)}const fy=(0,wt.A)("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var my;const gy=["children","className","component","disabled","error","filled","focused","margin","required","variant"],vy=(0,At.Ay)("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.size&&t[`size${(0,xt.A)(n.size)}`],n.contained&&t.contained,n.filled&&t.filled]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({color:(t.vars||t).palette.text.secondary},t.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${fy.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${fy.error}`]:{color:(t.vars||t).palette.error.main}},"small"===n.size&&{marginTop:4},n.contained&&{marginLeft:14,marginRight:14})})),yy=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiFormHelperText"}),{children:i,className:r,component:o="p"}=n,s=(0,je.A)(n,gy),a=dv({props:n,muiFormControl:fv(),states:["variant","size","disabled","error","filled","focused","required"]}),l=(0,ze.A)({},n,{component:o,contained:"filled"===a.variant||"outlined"===a.variant,variant:a.variant,size:a.size,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),c=(e=>{const{classes:t,contained:n,size:i,disabled:r,error:o,filled:s,focused:a,required:l}=e,c={root:["root",r&&"disabled",o&&"error",i&&`size${(0,xt.A)(i)}`,n&&"contained",a&&"focused",s&&"filled",l&&"required"]};return(0,yt.A)(c,py,t)})(l);return(0,We.jsx)(vy,(0,ze.A)({as:o,ownerState:l,className:(0,vt.A)(c.root,r),ref:t},s,{children:" "===i?my||(my=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"})):i}))}));function Ay(e){return(0,Et.Ay)("MuiNativeSelect",e)}const xy=(0,wt.A)("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),by=["className","disabled","error","IconComponent","inputRef","variant"],_y=e=>{let{ownerState:t,theme:n}=e;return(0,ze.A)({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":(0,ze.A)({},n.vars?{backgroundColor:`rgba(${n.vars.palette.common.onBackgroundChannel} / 0.05)`}:{backgroundColor:"light"===n.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},[`&.${xy.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(n.vars||n).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},"filled"===t.variant&&{"&&&":{paddingRight:32}},"outlined"===t.variant&&{borderRadius:(n.vars||n).shape.borderRadius,"&:focus":{borderRadius:(n.vars||n).shape.borderRadius},"&&&":{paddingRight:32}})},wy=(0,At.Ay)("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Dt.A,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.select,t[n.variant],n.error&&t.error,{[`&.${xy.multiple}`]:t.multiple}]}})(_y),Ey=e=>{let{ownerState:t,theme:n}=e;return(0,ze.A)({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(n.vars||n).palette.action.active,[`&.${xy.disabled}`]:{color:(n.vars||n).palette.action.disabled}},t.open&&{transform:"rotate(180deg)"},"filled"===t.variant&&{right:7},"outlined"===t.variant&&{right:7})},Sy=(0,At.Ay)("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t[`icon${(0,xt.A)(n.variant)}`],n.open&&t.iconOpen]}})(Ey),Cy=s.forwardRef((function(e,t){const{className:n,disabled:i,error:r,IconComponent:o,inputRef:a,variant:l="standard"}=e,c=(0,je.A)(e,by),u=(0,ze.A)({},e,{disabled:i,variant:l,error:r}),h=(e=>{const{classes:t,variant:n,disabled:i,multiple:r,open:o,error:s}=e,a={select:["select",n,i&&"disabled",r&&"multiple",s&&"error"],icon:["icon",`icon${(0,xt.A)(n)}`,o&&"iconOpen",i&&"disabled"]};return(0,yt.A)(a,Ay,t)})(u);return(0,We.jsxs)(s.Fragment,{children:[(0,We.jsx)(wy,(0,ze.A)({ownerState:u,className:(0,vt.A)(h.select,n),disabled:i,ref:a||t},c)),e.multiple?null:(0,We.jsx)(Sy,{as:o,ownerState:u,className:h.icon})]})}));var My=i(7123),Ty=i(5420);function Ry(e){return(0,Et.Ay)("MuiSelect",e)}const Iy=(0,wt.A)("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var Py;const By=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],Ly=(0,At.Ay)("div",{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`&.${Iy.select}`]:t.select},{[`&.${Iy.select}`]:t[n.variant]},{[`&.${Iy.error}`]:t.error},{[`&.${Iy.multiple}`]:t.multiple}]}})(_y,{[`&.${Iy.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),Ny=(0,At.Ay)("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t[`icon${(0,xt.A)(n.variant)}`],n.open&&t.iconOpen]}})(Ey),Dy=(0,At.Ay)("input",{shouldForwardProp:e=>(0,My.A)(e)&&"classes"!==e,name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function ky(e,t){return"object"===typeof t&&null!==t?e===t:String(e)===String(t)}function Oy(e){return null==e||"string"===typeof e&&!e.trim()}const Uy=s.forwardRef((function(e,t){var n;const{"aria-describedby":i,"aria-label":r,autoFocus:o,autoWidth:a,children:l,className:c,defaultOpen:u,defaultValue:h,disabled:d,displayEmpty:p,error:f=!1,IconComponent:m,inputRef:g,labelId:v,MenuProps:y={},multiple:A,name:x,onBlur:b,onChange:_,onClose:w,onFocus:E,onOpen:S,open:C,readOnly:M,renderValue:T,SelectDisplayProps:R={},tabIndex:I,value:P,variant:B="standard"}=e,L=(0,je.A)(e,By),[N,D]=(0,Ty.A)({controlled:P,default:h,name:"Select"}),[k,O]=(0,Ty.A)({controlled:C,default:u,name:"Select"}),U=s.useRef(null),F=s.useRef(null),[z,j]=s.useState(null),{current:V}=s.useRef(null!=C),[G,H]=s.useState(),W=(0,kt.A)(t,g),Q=s.useCallback((e=>{F.current=e,e&&j(e)}),[]),q=null==z?void 0:z.parentNode;s.useImperativeHandle(W,(()=>({focus:()=>{F.current.focus()},node:U.current,value:N})),[N]),s.useEffect((()=>{u&&k&&z&&!V&&(H(a?null:q.clientWidth),F.current.focus())}),[z,a]),s.useEffect((()=>{o&&F.current.focus()}),[o]),s.useEffect((()=>{if(!v)return;const e=(0,Zi.A)(F.current).getElementById(v);if(e){const t=()=>{getSelection().isCollapsed&&F.current.focus()};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}}),[v]);const X=(e,t)=>{e?S&&S(t):w&&w(t),V||(H(a?null:q.clientWidth),O(e))},$=s.Children.toArray(l),Y=e=>t=>{let n;if(t.currentTarget.hasAttribute("tabindex")){if(A){n=Array.isArray(N)?N.slice():[];const t=N.indexOf(e.props.value);-1===t?n.push(e.props.value):n.splice(t,1)}else n=e.props.value;if(e.props.onClick&&e.props.onClick(t),N!==n&&(D(n),_)){const i=t.nativeEvent||t,r=new i.constructor(i.type,i);Object.defineProperty(r,"target",{writable:!0,value:{value:n,name:x}}),_(r,e)}A||X(!1,t)}},K=null!==z&&k;let J,Z;delete L["aria-invalid"];const ee=[];let te=!1,ne=!1;(gv({value:N})||p)&&(T?J=T(N):te=!0);const ie=$.map((e=>{if(!s.isValidElement(e))return null;let t;if(A){if(!Array.isArray(N))throw new Error((0,ov.A)(2));t=N.some((t=>ky(t,e.props.value))),t&&te&&ee.push(e.props.children)}else t=ky(N,e.props.value),t&&te&&(Z=e.props.children);return t&&(ne=!0),s.cloneElement(e,{"aria-selected":t?"true":"false",onClick:Y(e),onKeyUp:t=>{" "===t.key&&t.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(t)},role:"option",selected:t,value:void 0,"data-value":e.props.value})}));te&&(J=A?0===ee.length?null:ee.reduce(((e,t,n)=>(e.push(t),n<ee.length-1&&e.push(", "),e)),[]):Z);let re,oe=G;!a&&V&&z&&(oe=q.clientWidth),re="undefined"!==typeof I?I:d?null:0;const se=R.id||(x?`mui-component-select-${x}`:void 0),ae=(0,ze.A)({},e,{variant:B,value:N,open:K,error:f}),le=(e=>{const{classes:t,variant:n,disabled:i,multiple:r,open:o,error:s}=e,a={select:["select",n,i&&"disabled",r&&"multiple",s&&"error"],icon:["icon",`icon${(0,xt.A)(n)}`,o&&"iconOpen",i&&"disabled"],nativeInput:["nativeInput"]};return(0,yt.A)(a,Ry,t)})(ae),ce=(0,ze.A)({},y.PaperProps,null==(n=y.slotProps)?void 0:n.paper),ue=(0,rv.A)();return(0,We.jsxs)(s.Fragment,{children:[(0,We.jsx)(Ly,(0,ze.A)({ref:Q,tabIndex:re,role:"combobox","aria-controls":ue,"aria-disabled":d?"true":void 0,"aria-expanded":K?"true":"false","aria-haspopup":"listbox","aria-label":r,"aria-labelledby":[v,se].filter(Boolean).join(" ")||void 0,"aria-describedby":i,onKeyDown:e=>{if(!M){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),X(!0,e))}},onMouseDown:d||M?null:e=>{0===e.button&&(e.preventDefault(),F.current.focus(),X(!0,e))},onBlur:e=>{!K&&b&&(Object.defineProperty(e,"target",{writable:!0,value:{value:N,name:x}}),b(e))},onFocus:E},R,{ownerState:ae,className:(0,vt.A)(R.className,le.select,c),id:se,children:Oy(J)?Py||(Py=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"})):J})),(0,We.jsx)(Dy,(0,ze.A)({"aria-invalid":f,value:Array.isArray(N)?N.join(","):N,name:x,ref:U,"aria-hidden":!0,onChange:e=>{const t=$.find((t=>t.props.value===e.target.value));void 0!==t&&(D(t.props.value),_&&_(e,t))},tabIndex:-1,disabled:d,className:le.nativeInput,autoFocus:o,ownerState:ae},L)),(0,We.jsx)(Ny,{as:m,className:le.icon,ownerState:ae}),(0,We.jsx)(Po,(0,ze.A)({id:`menu-${x||""}`,anchorEl:q,open:K,onClose:e=>{X(!1,e)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},y,{MenuListProps:(0,ze.A)({"aria-labelledby":v,role:"listbox","aria-multiselectable":A?"true":void 0,disableListWrap:!0,id:ue},y.MenuListProps),slotProps:(0,ze.A)({},y.slotProps,{paper:(0,ze.A)({},ce,{style:(0,ze.A)({minWidth:oe},null!=ce?ce.style:null)})}),children:ie}))]})})),Fy=(0,ji.A)((0,We.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),zy=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],jy=["root"],Vy={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>(0,Dt.A)(e)&&"variant"!==e,slot:"Root"},Gy=(0,At.Ay)(Lv,Vy)(""),Hy=(0,At.Ay)(Jv,Vy)(""),Wy=(0,At.Ay)(zv,Vy)(""),Qy=s.forwardRef((function(e,t){const n=(0,st.b)({name:"MuiSelect",props:e}),{autoWidth:i=!1,children:r,classes:o={},className:a,defaultOpen:l=!1,displayEmpty:c=!1,IconComponent:u=Fy,id:h,input:d,inputProps:p,label:f,labelId:m,MenuProps:g,multiple:v=!1,native:y=!1,onClose:A,onOpen:x,open:b,renderValue:_,SelectDisplayProps:w,variant:E="outlined"}=n,S=(0,je.A)(n,zy),C=y?Cy:Uy,M=dv({props:n,muiFormControl:fv(),states:["variant","error"]}),T=M.variant||E,R=(0,ze.A)({},n,{variant:T,classes:o}),I=(e=>{const{classes:t}=e;return t})(R),P=(0,je.A)(I,jy),B=d||{standard:(0,We.jsx)(Gy,{ownerState:R}),outlined:(0,We.jsx)(Hy,{label:f,ownerState:R}),filled:(0,We.jsx)(Wy,{ownerState:R})}[T],L=(0,kt.A)(t,gr(B));return(0,We.jsx)(s.Fragment,{children:s.cloneElement(B,(0,ze.A)({inputComponent:C,inputProps:(0,ze.A)({children:r,error:M.error,IconComponent:u,variant:T,type:void 0,multiple:v},y?{id:h}:{autoWidth:i,defaultOpen:l,displayEmpty:c,labelId:m,MenuProps:g,onClose:A,onOpen:x,open:b,renderValue:_,SelectDisplayProps:(0,ze.A)({id:h},w)},p,{classes:p?(0,On.A)(P,p.classes):P},d?d.props.inputProps:{})},(v&&y||c)&&"outlined"===T?{notched:!0}:{},{ref:L,className:(0,vt.A)(B.props.className,a,I.root)},!d&&{variant:T},S))})}));Qy.muiName="Select";const qy=Qy;function Xy(e){return(0,Et.Ay)("MuiTextField",e)}(0,wt.A)("MuiTextField",["root"]);const $y=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],Yy={standard:Lv,filled:zv,outlined:Jv},Ky=(0,At.Ay)(dy,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Jy=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiTextField"}),{autoComplete:i,autoFocus:r=!1,children:o,className:s,color:a="primary",defaultValue:l,disabled:c=!1,error:u=!1,FormHelperTextProps:h,fullWidth:d=!1,helperText:p,id:f,InputLabelProps:m,inputProps:g,InputProps:v,inputRef:y,label:A,maxRows:x,minRows:b,multiline:_=!1,name:w,onBlur:E,onChange:S,onFocus:C,placeholder:M,required:T=!1,rows:R,select:I=!1,SelectProps:P,type:B,value:L,variant:N="outlined"}=n,D=(0,je.A)(n,$y),k=(0,ze.A)({},n,{autoFocus:r,color:a,disabled:c,error:u,fullWidth:d,multiline:_,required:T,select:I,variant:N}),O=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"]},Xy,t)})(k);const U={};"outlined"===N&&(m&&"undefined"!==typeof m.shrink&&(U.notched=m.shrink),U.label=A),I&&(P&&P.native||(U.id=void 0),U["aria-describedby"]=void 0);const F=(0,rv.A)(f),z=p&&F?`${F}-helper-text`:void 0,j=A&&F?`${F}-label`:void 0,V=Yy[N],G=(0,We.jsx)(V,(0,ze.A)({"aria-describedby":z,autoComplete:i,autoFocus:r,defaultValue:l,fullWidth:d,multiline:_,name:w,rows:R,maxRows:x,minRows:b,type:B,value:L,id:F,inputRef:y,onBlur:E,onChange:S,onFocus:C,placeholder:M,inputProps:g},U,v));return(0,We.jsxs)(Ky,(0,ze.A)({className:(0,vt.A)(O.root,s),disabled:c,error:u,fullWidth:d,ref:t,required:T,color:a,variant:N,ownerState:k},D,{children:[null!=A&&""!==A&&(0,We.jsx)(ly,(0,ze.A)({htmlFor:F,id:j},m,{children:A})),I?(0,We.jsx)(qy,(0,ze.A)({"aria-describedby":z,id:F,labelId:j,value:L,input:G},P,{children:o})):G,p&&(0,We.jsx)(yy,(0,ze.A)({id:z},h,{children:p}))]}))})),Zy=(0,ji.A)((0,We.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),eA=(0,ji.A)((0,We.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),tA=(0,ji.A)((0,We.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),nA=(0,At.Ay)(Tt)((e=>{let{theme:t}=e;return{position:"fixed",bottom:80,right:20,width:350,height:500,display:"flex",flexDirection:"column",zIndex:1e3,background:"#212121",border:"1px solid #A35C7A",borderRadius:"12px",overflow:"hidden"}})),iA=(0,At.Ay)(ci)((e=>{let{theme:t}=e;return{padding:t.spacing(2),background:"#A35C7A",color:"#FEF6EB",display:"flex",alignItems:"center",justifyContent:"space-between"}})),rA=(0,At.Ay)(ci)((e=>{let{theme:t}=e;return{flex:1,padding:t.spacing(2),overflowY:"auto",display:"flex",flexDirection:"column",gap:t.spacing(1)}})),oA=(0,At.Ay)("div")((e=>{let{theme:t,$isUser:n}=e;return{maxWidth:"80%",padding:t.spacing(1,2),borderRadius:"12px",background:n?"#A35C7A":"#2C2C2C",color:"#FEF6EB",alignSelf:n?"flex-end":"flex-start"}})),sA=(0,At.Ay)(ci)((e=>{let{theme:t}=e;return{padding:t.spacing(2),borderTop:"1px solid #A35C7A",display:"flex",gap:t.spacing(1)}})),aA=((0,At.Ay)(ci)((e=>{let{theme:t}=e;return{padding:t.spacing(2),display:"flex",flexDirection:"column",gap:t.spacing(2)}})),()=>{const[e,t]=(0,s.useState)(!1),[n,i]=(0,s.useState)([{text:"Hello! I'm GigAI, your career assistant. Please tell me which job you're interested in.",isUser:!1}]),[r,o]=(0,s.useState)(""),[a,l]=(0,s.useState)(!1),[c,u]=(0,s.useState)(""),[h,d]=(0,s.useState)(""),[p,f]=(0,s.useState)(!1),m=async()=>{if(!r.trim())return;const e={text:r,isUser:!0};if(i((t=>[...t,e])),o(""),a)try{const e="https://gighub-backend.onrender.com",t=await fetch(`${e}/api/chat/message`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:r})});if(!t.ok)throw new Error("Failed to send message");const n=await t.json();i((e=>[...e,{text:n.response,isUser:!1}]))}catch(t){console.error("Error:",t),i((e=>[...e,{text:"Sorry, there was an error processing your message. Please try again.",isUser:!1}]))}else p?(d(r),f(!1),l(!0),g(r)):(u(r),f(!0),i((e=>[...e,{text:"Great! Now, please list your current skills (comma-separated).",isUser:!1}])))},g=async e=>{try{const t=await fetch("http://localhost:5000/api/chat/initialize",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({job:c,skills:e})});if(!t.ok)throw new Error("Failed to initialize chat");const n=await t.json();i((e=>[...e,{text:n.message,isUser:!1}]))}catch(t){console.error("Error initializing chat:",t),i((e=>[...e,{text:"Sorry, there was an error initializing the chat. Please try again later.",isUser:!1}]))}};return(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)($g,{color:"primary","aria-label":"chat",onClick:()=>t(!e),sx:{position:"fixed",bottom:20,right:20,background:"#A35C7A","&:hover":{background:"#8B4B66"}},children:e?(0,We.jsx)(Zy,{}):(0,We.jsx)(eA,{})}),(0,We.jsx)(Wr,{in:e,children:(0,We.jsx)(Jg,{direction:"up",in:e,mountOnEnter:!0,unmountOnExit:!0,children:(0,We.jsxs)(nA,{elevation:3,children:[(0,We.jsxs)(iA,{children:[(0,We.jsx)(Ln,{variant:"h6",children:"GigAI"}),(0,We.jsx)(wi,{size:"small",onClick:()=>t(!1),sx:{color:"#FEF6EB"},children:(0,We.jsx)(Zy,{})})]}),(0,We.jsx)(rA,{children:n.map(((e,t)=>(0,We.jsx)(oA,{$isUser:e.isUser,children:(0,We.jsx)(Ln,{variant:"body2",children:e.text})},t)))}),(0,We.jsx)(iv,{sx:{borderColor:"#A35C7A"}}),(0,We.jsxs)(sA,{children:[(0,We.jsx)(Jy,{fullWidth:!0,size:"small",placeholder:p?"Enter your skills (comma-separated)...":"Type your message...",value:r,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),m())},disabled:!e,sx:{"& .MuiOutlinedInput-root":{color:"#FEF6EB","& fieldset":{borderColor:"#A35C7A"},"&:hover fieldset":{borderColor:"#8B4B66"},"&.Mui-focused fieldset":{borderColor:"#A35C7A"}}}}),(0,We.jsx)(wi,{color:"primary",onClick:m,disabled:!r.trim()||!e,sx:{color:"#A35C7A","&:hover":{color:"#8B4B66"}},children:(0,We.jsx)(tA,{})})]})]})})})]})}),lA=(0,At.Ay)(ci)((e=>{let{theme:t}=e;return{width:"100%",minHeight:"90vh",display:"flex",alignItems:"center",background:"#FEF6EB",position:"relative",padding:t.spacing(4)}})),cA=(0,At.Ay)("img")({width:"100%",maxWidth:"600px",height:"auto",objectFit:"contain",marginBottom:"2rem"}),uA=(0,At.Ay)(ci)((e=>{let{theme:t}=e;return{padding:t.spacing(4),height:"100%",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",background:"#212121",borderRadius:2*t.shape.borderRadius,border:"1px solid #A35C7A",transition:"transform 0.3s ease-in-out, border-color 0.3s ease-in-out","&:hover":{transform:"translateY(-8px)",borderColor:"#C890A7",background:"#A35C7A","& .MuiTypography-root":{color:"#FEF6EB"},"& .MuiSvgIcon-root":{color:"#FEF6EB"}}}})),hA=[{icon:(0,We.jsx)(jg,{sx:{fontSize:40,color:"#A35C7A"}}),title:"Find Jobs",description:"Discover opportunities that match your skills and experience"},{icon:(0,We.jsx)(Vg,{sx:{fontSize:40,color:"#A35C7A"}}),title:"Smart Search",description:"Advanced filters and AI-powered job recommendations"},{icon:(0,We.jsx)(Gg,{sx:{fontSize:40,color:"#A35C7A"}}),title:"Skill Analysis",description:"Visual skill tree to track and showcase your expertise"},{icon:(0,We.jsx)(Hg,{sx:{fontSize:40,color:"#A35C7A"}}),title:"Profile Builder",description:"Create a compelling profile to stand out to employers"}],dA=()=>{const e=oe();return(0,We.jsxs)(ci,{sx:{background:"#FEF6EB",minHeight:"100vh"},children:[(0,We.jsx)(lA,{children:(0,We.jsx)(Zn,{children:(0,We.jsxs)(Xl,{container:!0,spacing:6,alignItems:"center",children:[(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(zg.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.8},children:[(0,We.jsxs)(Ln,{variant:"h1",sx:{fontSize:{xs:"2.5rem",md:"3.5rem"},fontWeight:600,color:"#212121",letterSpacing:"0.02em",marginBottom:"1.5rem",textTransform:"uppercase"},children:["Branch Out.",(0,We.jsx)("br",{}),"Stand Out."]}),(0,We.jsx)(Ln,{variant:"h5",sx:{color:"#A35C7A",fontWeight:400,maxWidth:"600px",marginBottom:"2rem",letterSpacing:"0.02em"},children:"Connect with top companies and showcase your skills with our innovative skill tree visualization"}),(0,We.jsx)(Cn,{variant:"contained",size:"large",onClick:()=>e("/jobs"),sx:{px:4,py:1.5,fontSize:"1.1rem",fontWeight:500,bgcolor:"#A35C7A",color:"#FEF6EB",letterSpacing:"0.05em","&:hover":{bgcolor:"#C890A7"}},children:"Explore Jobs"})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(zg.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.8},style:{textAlign:"center"},children:(0,We.jsx)(cA,{src:"/home-image.png",alt:"GigHub Platform"})})})]})})}),(0,We.jsx)(Zn,{sx:{py:12},children:(0,We.jsxs)(zg.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},children:[(0,We.jsx)(Ln,{variant:"h2",align:"center",sx:{mb:8,color:"#212121",letterSpacing:"0.02em",textTransform:"uppercase",fontWeight:600},children:"Why Choose Us"}),(0,We.jsx)(Xl,{container:!0,spacing:4,justifyContent:"center",children:hA.map(((e,t)=>(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,md:3,children:(0,We.jsx)(zg.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2+.1*t},style:{height:"100%"},children:(0,We.jsxs)(uA,{children:[e.icon,(0,We.jsx)(Ln,{variant:"h5",sx:{mt:2,mb:1,color:"#FEF6EB",letterSpacing:"0.02em",fontWeight:500},children:e.title}),(0,We.jsx)(Ln,{variant:"body1",sx:{color:"#C890A7",letterSpacing:"0.02em"},children:e.description})]})})},t)))})]})}),(0,We.jsx)(aA,{})]})},pA=()=>{const{user:e}=sl();return(0,We.jsx)(dA,{})};function fA(e){return(0,Et.Ay)("MuiAlert",e)}const mA=(0,wt.A)("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),gA=(0,ji.A)((0,We.jsx)("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),vA=(0,ji.A)((0,We.jsx)("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),yA=(0,ji.A)((0,We.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),AA=(0,ji.A)((0,We.jsx)("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),xA=(0,ji.A)((0,We.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),bA=["action","children","className","closeText","color","components","componentsProps","icon","iconMapping","onClose","role","severity","slotProps","slots","variant"],_A=(0,At.Ay)(Tt,{name:"MuiAlert",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`${n.variant}${(0,xt.A)(n.color||n.severity)}`]]}})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?bt.e$:bt.a,i="light"===t.palette.mode?bt.a:bt.e$;return(0,ze.A)({},t.typography.body2,{backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.light})).map((e=>{let[r]=e;return{props:{colorSeverity:r,variant:"standard"},style:{color:t.vars?t.vars.palette.Alert[`${r}Color`]:n(t.palette[r].light,.6),backgroundColor:t.vars?t.vars.palette.Alert[`${r}StandardBg`]:i(t.palette[r].light,.9),[`& .${mA.icon}`]:t.vars?{color:t.vars.palette.Alert[`${r}IconColor`]}:{color:t.palette[r].main}}}})),...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.light})).map((e=>{let[i]=e;return{props:{colorSeverity:i,variant:"outlined"},style:{color:t.vars?t.vars.palette.Alert[`${i}Color`]:n(t.palette[i].light,.6),border:`1px solid ${(t.vars||t).palette[i].light}`,[`& .${mA.icon}`]:t.vars?{color:t.vars.palette.Alert[`${i}IconColor`]}:{color:t.palette[i].main}}}})),...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.dark})).map((e=>{let[n]=e;return{props:{colorSeverity:n,variant:"filled"},style:(0,ze.A)({fontWeight:t.typography.fontWeightMedium},t.vars?{color:t.vars.palette.Alert[`${n}FilledColor`],backgroundColor:t.vars.palette.Alert[`${n}FilledBg`]}:{backgroundColor:"dark"===t.palette.mode?t.palette[n].dark:t.palette[n].main,color:t.palette.getContrastText(t.palette[n].main)})}}))]})})),wA=(0,At.Ay)("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(e,t)=>t.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),EA=(0,At.Ay)("div",{name:"MuiAlert",slot:"Message",overridesResolver:(e,t)=>t.message})({padding:"8px 0",minWidth:0,overflow:"auto"}),SA=(0,At.Ay)("div",{name:"MuiAlert",slot:"Action",overridesResolver:(e,t)=>t.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),CA={success:(0,We.jsx)(gA,{fontSize:"inherit"}),warning:(0,We.jsx)(vA,{fontSize:"inherit"}),error:(0,We.jsx)(yA,{fontSize:"inherit"}),info:(0,We.jsx)(AA,{fontSize:"inherit"})},MA=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiAlert"}),{action:i,children:r,className:o,closeText:s="Close",color:a,components:l={},componentsProps:c={},icon:u,iconMapping:h=CA,onClose:d,role:p="alert",severity:f="success",slotProps:m={},slots:g={},variant:v="standard"}=n,y=(0,je.A)(n,bA),A=(0,ze.A)({},n,{color:a,severity:f,variant:v,colorSeverity:a||f}),x=(e=>{const{variant:t,color:n,severity:i,classes:r}=e,o={root:["root",`color${(0,xt.A)(n||i)}`,`${t}${(0,xt.A)(n||i)}`,`${t}`],icon:["icon"],message:["message"],action:["action"]};return(0,yt.A)(o,fA,r)})(A),b={slots:(0,ze.A)({closeButton:l.CloseButton,closeIcon:l.CloseIcon},g),slotProps:(0,ze.A)({},c,m)},[_,w]=qi("closeButton",{elementType:wi,externalForwardedProps:b,ownerState:A}),[E,S]=qi("closeIcon",{elementType:xA,externalForwardedProps:b,ownerState:A});return(0,We.jsxs)(_A,(0,ze.A)({role:p,elevation:0,ownerState:A,className:(0,vt.A)(x.root,o),ref:t},y,{children:[!1!==u?(0,We.jsx)(wA,{ownerState:A,className:x.icon,children:u||h[f]||CA[f]}):null,(0,We.jsx)(EA,{ownerState:A,className:x.message,children:r}),null!=i?(0,We.jsx)(SA,{ownerState:A,className:x.action,children:i}):null,null==i&&d?(0,We.jsx)(SA,{ownerState:A,className:x.action,children:(0,We.jsx)(_,(0,ze.A)({size:"small","aria-label":s,title:s,color:"inherit",onClick:d},w,{children:(0,We.jsx)(E,(0,ze.A)({fontSize:"small"},S))}))}):null]}))}));function TA(e){return(0,Et.Ay)("MuiCircularProgress",e)}(0,wt.A)("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const RA=["className","color","disableShrink","size","style","thickness","value","variant"];let IA,PA,BA,LA,NA=e=>e;const DA=44,kA=(0,$t.i7)(IA||(IA=NA`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),OA=(0,$t.i7)(PA||(PA=NA`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),UA=(0,At.Ay)("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`color${(0,xt.A)(n.color)}`]]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ze.A)({display:"inline-block"},"determinate"===t.variant&&{transition:n.transitions.create("transform")},"inherit"!==t.color&&{color:(n.vars||n).palette[t.color].main})}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&(0,$t.AH)(BA||(BA=NA`
      animation: ${0} 1.4s linear infinite;
    `),kA)})),FA=(0,At.Ay)("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),zA=(0,At.Ay)("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.circle,t[`circle${(0,xt.A)(n.variant)}`],n.disableShrink&&t.circleDisableShrink]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ze.A)({stroke:"currentColor"},"determinate"===t.variant&&{transition:n.transitions.create("stroke-dashoffset")},"indeterminate"===t.variant&&{strokeDasharray:"80px, 200px",strokeDashoffset:0})}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&!t.disableShrink&&(0,$t.AH)(LA||(LA=NA`
      animation: ${0} 1.4s ease-in-out infinite;
    `),OA)})),jA=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiCircularProgress"}),{className:i,color:r="primary",disableShrink:o=!1,size:s=40,style:a,thickness:l=3.6,value:c=0,variant:u="indeterminate"}=n,h=(0,je.A)(n,RA),d=(0,ze.A)({},n,{color:r,disableShrink:o,size:s,thickness:l,value:c,variant:u}),p=(e=>{const{classes:t,variant:n,color:i,disableShrink:r}=e,o={root:["root",n,`color${(0,xt.A)(i)}`],svg:["svg"],circle:["circle",`circle${(0,xt.A)(n)}`,r&&"circleDisableShrink"]};return(0,yt.A)(o,TA,t)})(d),f={},m={},g={};if("determinate"===u){const e=2*Math.PI*((DA-l)/2);f.strokeDasharray=e.toFixed(3),g["aria-valuenow"]=Math.round(c),f.strokeDashoffset=`${((100-c)/100*e).toFixed(3)}px`,m.transform="rotate(-90deg)"}return(0,We.jsx)(UA,(0,ze.A)({className:(0,vt.A)(p.root,i),style:(0,ze.A)({width:s,height:s},m,a),ownerState:d,ref:t,role:"progressbar"},g,h,{children:(0,We.jsx)(FA,{className:p.svg,ownerState:d,viewBox:"22 22 44 44",children:(0,We.jsx)(zA,{className:p.circle,style:f,ownerState:d,cx:DA,cy:DA,r:(DA-l)/2,fill:"none",strokeWidth:l})})}))}));function VA(e){return(0,Et.Ay)("MuiLink",e)}const GA=(0,wt.A)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var HA=i(7162);const WA={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},QA=e=>{let{theme:t,ownerState:n}=e;const i=(e=>WA[e]||e)(n.color),r=(0,HA.Yn)(t,`palette.${i}`,!1)||n.color,o=(0,HA.Yn)(t,`palette.${i}Channel`);return"vars"in t&&o?`rgba(${o} / 0.4)`:(0,bt.X4)(r,.4)},qA=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],XA=(0,At.Ay)(Ln,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`underline${(0,xt.A)(n.underline)}`],"button"===n.component&&t.button]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},"none"===n.underline&&{textDecoration:"none"},"hover"===n.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===n.underline&&(0,ze.A)({textDecoration:"underline"},"inherit"!==n.color&&{textDecorationColor:QA({theme:t,ownerState:n})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===n.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${GA.focusVisible}`]:{outline:"auto"}})})),$A=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiLink"}),{className:i,color:r="primary",component:o="a",onBlur:a,onFocus:l,TypographyClasses:c,underline:u="always",variant:h="inherit",sx:d}=n,p=(0,je.A)(n,qA),{isFocusVisibleRef:f,onBlur:m,onFocus:g,ref:v}=(0,Ut.A)(),[y,A]=s.useState(!1),x=(0,kt.A)(t,v),b=(0,ze.A)({},n,{color:r,component:o,focusVisible:y,underline:u,variant:h}),_=(e=>{const{classes:t,component:n,focusVisible:i,underline:r}=e,o={root:["root",`underline${(0,xt.A)(r)}`,"button"===n&&"button",i&&"focusVisible"]};return(0,yt.A)(o,VA,t)})(b);return(0,We.jsx)(XA,(0,ze.A)({color:r,className:(0,vt.A)(_.root,i),classes:c,component:o,onBlur:e=>{m(e),!1===f.current&&A(!1),a&&a(e)},onFocus:e=>{g(e),!0===f.current&&A(!0),l&&l(e)},ref:x,ownerState:b,variant:h,sx:[...Object.keys(WA).includes(r)?[]:[{color:r}],...Array.isArray(d)?d:[d]]},p))})),YA=(0,At.Ay)(Zn)((e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"calc(100vh - 64px)",padding:t.spacing(3)}})),KA=(0,At.Ay)(Tt)((e=>{let{theme:t}=e;return{padding:t.spacing(4),display:"flex",flexDirection:"column",alignItems:"center",background:"#212121",backdropFilter:"blur(20px)",border:"1px solid #A35C7A",borderRadius:16,maxWidth:400,width:"100%"}})),JA=(0,At.Ay)("form")((e=>{let{theme:t}=e;return{width:"100%",marginTop:t.spacing(1)}})),ZA=()=>{const[e,t]=(0,s.useState)({email:"",password:""}),[n,i]=(0,s.useState)(""),[r,o]=(0,s.useState)(!1),a=oe(),{login:l}=sl(),c=n=>{t({...e,[n.target.name]:n.target.value})};return(0,We.jsx)(YA,{component:"main",maxWidth:"xs",children:(0,We.jsxs)(KA,{children:[(0,We.jsx)(Ln,{component:"h1",variant:"h4",gutterBottom:!0,sx:{fontWeight:700,color:"#FEF6EB"},children:"Welcome Back"}),(0,We.jsx)(Ln,{variant:"body2",sx:{mb:4,color:"#FEF6EB"},children:"Sign in to continue to GigHub"}),n&&(0,We.jsx)(MA,{severity:"error",sx:{width:"100%",mb:2},children:n}),(0,We.jsxs)(JA,{onSubmit:async t=>{t.preventDefault(),i(""),o(!0);try{await l(e.email,e.password),a("/")}catch(n){var r,s;i((null===(r=n.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||"Failed to login")}finally{o(!1)}},children:[(0,We.jsx)(Jy,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:e.email,onChange:c,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.03)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},"& .MuiInputLabel-root":{color:"#FEF6EB","&.Mui-required":{"& .MuiInputLabel-asterisk":{color:"#A35C7A"}}},"& .MuiOutlinedInput-input":{color:"#FEF6EB"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#A35C7A"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#A35C7A"}}}),(0,We.jsx)(Jy,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:e.password,onChange:c,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.03)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},"& .MuiInputLabel-root":{color:"#FEF6EB","&.Mui-required":{"& .MuiInputLabel-asterisk":{color:"#A35C7A"}}},"& .MuiOutlinedInput-input":{color:"#FEF6EB"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#A35C7A"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#A35C7A"}}}),(0,We.jsx)(Cn,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5,bgcolor:"#A35C7A",color:"#FEF6EB","&:hover":{bgcolor:"#C890A7"}},disabled:r,children:r?(0,We.jsx)(jA,{size:24}):"Sign In"}),(0,We.jsx)(ci,{sx:{textAlign:"center"},children:(0,We.jsx)($A,{component:"button",variant:"body2",onClick:()=>a("/register"),sx:{color:"#FEF6EB",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Don't have an account? Sign Up"})})]})]})})};function ex(e){return(0,Et.Ay)("MuiFormGroup",e)}(0,wt.A)("MuiFormGroup",["root","row","error"]);const tx=["className","row"],nx=(0,At.Ay)("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.row&&t.row]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({display:"flex",flexDirection:"column",flexWrap:"wrap"},t.row&&{flexDirection:"row"})})),ix=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiFormGroup"}),{className:i,row:r=!1}=n,o=(0,je.A)(n,tx),s=dv({props:n,muiFormControl:fv(),states:["error"]}),a=(0,ze.A)({},n,{row:r,error:s.error}),l=(e=>{const{classes:t,row:n,error:i}=e,r={root:["root",n&&"row",i&&"error"]};return(0,yt.A)(r,ex,t)})(a);return(0,We.jsx)(nx,(0,ze.A)({className:(0,vt.A)(l.root,i),ownerState:a,ref:t},o))}));function rx(e){return(0,Et.Ay)("MuiRadioGroup",e)}(0,wt.A)("MuiRadioGroup",["root","row","error"]);const ox=s.createContext(void 0);var sx=i(5879);const ax=["actions","children","className","defaultValue","name","onChange","value"],lx=s.forwardRef((function(e,t){const{actions:n,children:i,className:r,defaultValue:o,name:a,onChange:l,value:c}=e,u=(0,je.A)(e,ax),h=s.useRef(null),d=(e=>{const{classes:t,row:n,error:i}=e,r={root:["root",n&&"row",i&&"error"]};return(0,yt.A)(r,rx,t)})(e),[p,f]=(0,Ty.A)({controlled:c,default:o,name:"RadioGroup"});s.useImperativeHandle(n,(()=>({focus:()=>{let e=h.current.querySelector("input:not(:disabled):checked");e||(e=h.current.querySelector("input:not(:disabled)")),e&&e.focus()}})),[]);const m=(0,kt.A)(t,h),g=(0,sx.A)(a),v=s.useMemo((()=>({name:g,onChange(e){f(e.target.value),l&&l(e,e.target.value)},value:p})),[g,l,f,p]);return(0,We.jsx)(ox.Provider,{value:v,children:(0,We.jsx)(ix,(0,ze.A)({role:"radiogroup",ref:m,className:(0,vt.A)(d.root,r)},u,{children:i}))})}));function cx(e){return(0,Et.Ay)("MuiFormControlLabel",e)}const ux=(0,wt.A)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),hx=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],dx=(0,At.Ay)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${ux.label}`]:t.label},t.root,t[`labelPlacement${(0,xt.A)(n.labelPlacement)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${ux.disabled}`]:{cursor:"default"}},"start"===n.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===n.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===n.labelPlacement&&{flexDirection:"column",marginLeft:16},{[`& .${ux.label}`]:{[`&.${ux.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})})),px=(0,At.Ay)("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${ux.error}`]:{color:(t.vars||t).palette.error.main}}})),fx=s.forwardRef((function(e,t){var n,i;const r=(0,st.b)({props:e,name:"MuiFormControlLabel"}),{className:o,componentsProps:a={},control:l,disabled:c,disableTypography:u,label:h,labelPlacement:d="end",required:p,slotProps:f={}}=r,m=(0,je.A)(r,hx),g=fv(),v=null!=(n=null!=c?c:l.props.disabled)?n:null==g?void 0:g.disabled,y=null!=p?p:l.props.required,A={disabled:v,required:y};["checked","name","onChange","value","inputRef"].forEach((e=>{"undefined"===typeof l.props[e]&&"undefined"!==typeof r[e]&&(A[e]=r[e])}));const x=dv({props:r,muiFormControl:g,states:["error"]}),b=(0,ze.A)({},r,{disabled:v,labelPlacement:d,required:y,error:x.error}),_=(e=>{const{classes:t,disabled:n,labelPlacement:i,error:r,required:o}=e,s={root:["root",n&&"disabled",`labelPlacement${(0,xt.A)(i)}`,r&&"error",o&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",r&&"error"]};return(0,yt.A)(s,cx,t)})(b),w=null!=(i=f.typography)?i:a.typography;let E=h;return null==E||E.type===Ln||u||(E=(0,We.jsx)(Ln,(0,ze.A)({component:"span"},w,{className:(0,vt.A)(_.label,null==w?void 0:w.className),children:E}))),(0,We.jsxs)(dx,(0,ze.A)({className:(0,vt.A)(_.root,o),ownerState:b,ref:t},m,{children:[s.cloneElement(l,A),y?(0,We.jsxs)(yi,{display:"block",children:[E,(0,We.jsxs)(px,{ownerState:b,"aria-hidden":!0,className:_.asterisk,children:["\u2009","*"]})]}):E]}))}));function mx(e){return(0,Et.Ay)("PrivateSwitchBase",e)}(0,wt.A)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const gx=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],vx=(0,At.Ay)(gn)((e=>{let{ownerState:t}=e;return(0,ze.A)({padding:9,borderRadius:"50%"},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})})),yx=(0,At.Ay)("input",{shouldForwardProp:Dt.A})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),Ax=s.forwardRef((function(e,t){const{autoFocus:n,checked:i,checkedIcon:r,className:o,defaultChecked:s,disabled:a,disableFocusRipple:l=!1,edge:c=!1,icon:u,id:h,inputProps:d,inputRef:p,name:f,onBlur:m,onChange:g,onFocus:v,readOnly:y,required:A=!1,tabIndex:x,type:b,value:_}=e,w=(0,je.A)(e,gx),[E,S]=(0,Ty.A)({controlled:i,default:Boolean(s),name:"SwitchBase",state:"checked"}),C=fv();let M=a;C&&"undefined"===typeof M&&(M=C.disabled);const T="checkbox"===b||"radio"===b,R=(0,ze.A)({},e,{checked:E,disabled:M,disableFocusRipple:l,edge:c}),I=(e=>{const{classes:t,checked:n,disabled:i,edge:r}=e,o={root:["root",n&&"checked",i&&"disabled",r&&`edge${(0,xt.A)(r)}`],input:["input"]};return(0,yt.A)(o,mx,t)})(R);return(0,We.jsxs)(vx,(0,ze.A)({component:"span",className:(0,vt.A)(I.root,o),centerRipple:!0,focusRipple:!l,disabled:M,tabIndex:null,role:void 0,onFocus:e=>{v&&v(e),C&&C.onFocus&&C.onFocus(e)},onBlur:e=>{m&&m(e),C&&C.onBlur&&C.onBlur(e)},ownerState:R,ref:t},w,{children:[(0,We.jsx)(yx,(0,ze.A)({autoFocus:n,checked:i,defaultChecked:s,className:I.input,disabled:M,id:T?h:void 0,name:f,onChange:e=>{if(e.nativeEvent.defaultPrevented)return;const t=e.target.checked;S(t),g&&g(e,t)},readOnly:y,ref:p,required:A,ownerState:R,tabIndex:x,type:b},"checkbox"===b&&void 0===_?{}:{value:_},d)),E?r:u]}))})),xx=(0,ji.A)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),bx=(0,ji.A)((0,We.jsx)("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),_x=(0,At.Ay)("span",{shouldForwardProp:Dt.A})({position:"relative",display:"flex"}),wx=(0,At.Ay)(xx)({transform:"scale(1)"}),Ex=(0,At.Ay)(bx)((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest})},n.checked&&{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})})}));const Sx=function(e){const{checked:t=!1,classes:n={},fontSize:i}=e,r=(0,ze.A)({},e,{checked:t});return(0,We.jsxs)(_x,{className:n.root,ownerState:r,children:[(0,We.jsx)(wx,{fontSize:i,className:n.background,ownerState:r}),(0,We.jsx)(Ex,{fontSize:i,className:n.dot,ownerState:r})]})};var Cx=i(6593);function Mx(e){return(0,Et.Ay)("MuiRadio",e)}const Tx=(0,wt.A)("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Rx=["checked","checkedIcon","color","icon","name","onChange","size","className"],Ix=(0,At.Ay)(Ax,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"medium"!==n.size&&t[`size${(0,xt.A)(n.size)}`],t[`color${(0,xt.A)(n.color)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({color:(t.vars||t).palette.text.secondary},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${"default"===n.color?t.vars.palette.action.activeChannel:t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)("default"===n.color?t.palette.action.active:t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{[`&.${Tx.checked}`]:{color:(t.vars||t).palette[n.color].main}},{[`&.${Tx.disabled}`]:{color:(t.vars||t).palette.action.disabled}})}));const Px=(0,We.jsx)(Sx,{checked:!0}),Bx=(0,We.jsx)(Sx,{}),Lx=s.forwardRef((function(e,t){var n,i;const r=(0,st.b)({props:e,name:"MuiRadio"}),{checked:o,checkedIcon:a=Px,color:l="primary",icon:c=Bx,name:u,onChange:h,size:d="medium",className:p}=r,f=(0,je.A)(r,Rx),m=(0,ze.A)({},r,{color:l,size:d}),g=(e=>{const{classes:t,color:n,size:i}=e,r={root:["root",`color${(0,xt.A)(n)}`,"medium"!==i&&`size${(0,xt.A)(i)}`]};return(0,ze.A)({},t,(0,yt.A)(r,Mx,t))})(m),v=s.useContext(ox);let y=o;const A=(0,Cx.A)(h,v&&v.onChange);let x=u;var b,_;return v&&("undefined"===typeof y&&(b=v.value,y="object"===typeof(_=r.value)&&null!==_?b===_:String(b)===String(_)),"undefined"===typeof x&&(x=v.name)),(0,We.jsx)(Ix,(0,ze.A)({type:"radio",icon:s.cloneElement(c,{fontSize:null!=(n=Bx.props.fontSize)?n:d}),checkedIcon:s.cloneElement(a,{fontSize:null!=(i=Px.props.fontSize)?i:d}),ownerState:m,classes:g,name:x,checked:y,onChange:A,ref:t,className:(0,vt.A)(g.root,p)},f))})),Nx=()=>{const e=oe(),{register:t}=sl(),[n,i]=(0,s.useState)(""),[r,o]=(0,s.useState)(!1),[a,l]=(0,s.useState)("student"),[c,u]=(0,s.useState)({email:"",password:"",confirmPassword:"",name:"",college:"",major:"",graduationYear:"",company:"",position:"",companyWebsite:""}),h=e=>{const{name:t,value:n}=e.target;u((e=>({...e,[t]:n})))};return(0,We.jsx)(Zn,{maxWidth:"sm",sx:{mt:4,mb:4},children:(0,We.jsxs)(Tt,{elevation:3,sx:{p:4},children:[(0,We.jsx)(Ln,{variant:"h4",component:"h1",gutterBottom:!0,align:"center",children:"Create Account"}),n&&(0,We.jsx)(MA,{severity:"error",sx:{mb:2},children:n}),(0,We.jsx)("form",{onSubmit:async n=>{if(n.preventDefault(),c.password!==c.confirmPassword)return i("Passwords do not match");try{i(""),o(!0);const n={email:c.email,password:c.password,name:c.name,role:a};"student"===a?(n.college=c.college,n.major=c.major,n.graduationYear=c.graduationYear):(n.company=c.company,n.position=c.position,n.companyWebsite=c.companyWebsite),await t(n),e("/profile")}catch(l){var r,s;i((null===(r=l.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||"Failed to create an account")}finally{o(!1)}},children:(0,We.jsxs)(Xl,{container:!0,spacing:2,children:[(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(dy,{component:"fieldset",children:[(0,We.jsx)(ry,{component:"legend",children:"Account Type"}),(0,We.jsxs)(lx,{row:!0,name:"role",value:a,onChange:e=>{l(e.target.value)},children:[(0,We.jsx)(fx,{value:"student",control:(0,We.jsx)(Lx,{}),label:"Student"}),(0,We.jsx)(fx,{value:"recruiter",control:(0,We.jsx)(Lx,{}),label:"Recruiter"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Full Name",name:"name",value:c.name,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:c.email,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Password",name:"password",type:"password",value:c.password,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:"password",value:c.confirmPassword,onChange:h,required:!0})}),"student"===a&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"College/University",name:"college",value:c.college,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Major",name:"major",value:c.major,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Graduation Year",name:"graduationYear",type:"number",value:c.graduationYear,onChange:h,required:!0,InputProps:{inputProps:{min:(new Date).getFullYear()}}})})]}),"recruiter"===a&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Company Name",name:"company",value:c.company,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Position",name:"position",value:c.position,onChange:h,required:!0})}),(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Company Website",name:"companyWebsite",type:"url",value:c.companyWebsite,onChange:h,required:!0})})]}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,We.jsx)(Cn,{variant:"outlined",onClick:()=>e("/login"),children:"Already have an account?"}),(0,We.jsx)(Cn,{type:"submit",variant:"contained",color:"primary",disabled:r,children:"Register"})]})})]})})]})})},Dx=(0,ji.A)((0,We.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");function kx(e){return(0,Et.Ay)("MuiChip",e)}const Ox=(0,wt.A)("MuiChip",["root","sizeSmall","sizeMedium","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Ux=["avatar","className","clickable","color","component","deleteIcon","disabled","icon","label","onClick","onDelete","onKeyDown","onKeyUp","size","variant","tabIndex","skipFocusWhenDisabled"],Fx=(0,At.Ay)("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{color:i,iconColor:r,clickable:o,onDelete:s,size:a,variant:l}=n;return[{[`& .${Ox.avatar}`]:t.avatar},{[`& .${Ox.avatar}`]:t[`avatar${(0,xt.A)(a)}`]},{[`& .${Ox.avatar}`]:t[`avatarColor${(0,xt.A)(i)}`]},{[`& .${Ox.icon}`]:t.icon},{[`& .${Ox.icon}`]:t[`icon${(0,xt.A)(a)}`]},{[`& .${Ox.icon}`]:t[`iconColor${(0,xt.A)(r)}`]},{[`& .${Ox.deleteIcon}`]:t.deleteIcon},{[`& .${Ox.deleteIcon}`]:t[`deleteIcon${(0,xt.A)(a)}`]},{[`& .${Ox.deleteIcon}`]:t[`deleteIconColor${(0,xt.A)(i)}`]},{[`& .${Ox.deleteIcon}`]:t[`deleteIcon${(0,xt.A)(l)}Color${(0,xt.A)(i)}`]},t.root,t[`size${(0,xt.A)(a)}`],t[`color${(0,xt.A)(i)}`],o&&t.clickable,o&&"default"!==i&&t[`clickableColor${(0,xt.A)(i)})`],s&&t.deletable,s&&"default"!==i&&t[`deletableColor${(0,xt.A)(i)}`],t[l],t[`${l}${(0,xt.A)(i)}`]]}})((e=>{let{theme:t,ownerState:n}=e;const i="light"===t.palette.mode?t.palette.grey[700]:t.palette.grey[300];return(0,ze.A)({maxWidth:"100%",fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.action.selected,borderRadius:16,whiteSpace:"nowrap",transition:t.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${Ox.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${Ox.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:t.vars?t.vars.palette.Chip.defaultAvatarColor:i,fontSize:t.typography.pxToRem(12)},[`& .${Ox.avatarColorPrimary}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.dark},[`& .${Ox.avatarColorSecondary}`]:{color:(t.vars||t).palette.secondary.contrastText,backgroundColor:(t.vars||t).palette.secondary.dark},[`& .${Ox.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:t.typography.pxToRem(10)},[`& .${Ox.icon}`]:(0,ze.A)({marginLeft:5,marginRight:-6},"small"===n.size&&{fontSize:18,marginLeft:4,marginRight:-4},n.iconColor===n.color&&(0,ze.A)({color:t.vars?t.vars.palette.Chip.defaultIconColor:i},"default"!==n.color&&{color:"inherit"})),[`& .${Ox.deleteIcon}`]:(0,ze.A)({WebkitTapHighlightColor:"transparent",color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.26)`:(0,bt.X4)(t.palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.4)`:(0,bt.X4)(t.palette.text.primary,.4)}},"small"===n.size&&{fontSize:16,marginRight:4,marginLeft:-4},"default"!==n.color&&{color:t.vars?`rgba(${t.vars.palette[n.color].contrastTextChannel} / 0.7)`:(0,bt.X4)(t.palette[n.color].contrastText,.7),"&:hover, &:active":{color:(t.vars||t).palette[n.color].contrastText}})},"small"===n.size&&{height:24},"default"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].main,color:(t.vars||t).palette[n.color].contrastText},n.onDelete&&{[`&.${Ox.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,bt.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},n.onDelete&&"default"!==n.color&&{[`&.${Ox.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n.color].dark}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},n.clickable&&{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,bt.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity)},[`&.${Ox.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,bt.X4)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},"&:active":{boxShadow:(t.vars||t).shadows[1]}},n.clickable&&"default"!==n.color&&{[`&:hover, &.${Ox.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n.color].dark}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({},"outlined"===n.variant&&{backgroundColor:"transparent",border:t.vars?`1px solid ${t.vars.palette.Chip.defaultBorder}`:`1px solid ${"light"===t.palette.mode?t.palette.grey[400]:t.palette.grey[700]}`,[`&.${Ox.clickable}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${Ox.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`& .${Ox.avatar}`]:{marginLeft:4},[`& .${Ox.avatarSmall}`]:{marginLeft:2},[`& .${Ox.icon}`]:{marginLeft:4},[`& .${Ox.iconSmall}`]:{marginLeft:2},[`& .${Ox.deleteIcon}`]:{marginRight:5},[`& .${Ox.deleteIconSmall}`]:{marginRight:3}},"outlined"===n.variant&&"default"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / 0.7)`:(0,bt.X4)(t.palette[n.color].main,.7)}`,[`&.${Ox.clickable}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity)},[`&.${Ox.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.focusOpacity})`:(0,bt.X4)(t.palette[n.color].main,t.palette.action.focusOpacity)},[`& .${Ox.deleteIcon}`]:{color:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / 0.7)`:(0,bt.X4)(t.palette[n.color].main,.7),"&:hover, &:active":{color:(t.vars||t).palette[n.color].main}}})})),zx=(0,At.Ay)("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,t)=>{const{ownerState:n}=e,{size:i}=n;return[t.label,t[`label${(0,xt.A)(i)}`]]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap"},"outlined"===t.variant&&{paddingLeft:11,paddingRight:11},"small"===t.size&&{paddingLeft:8,paddingRight:8},"small"===t.size&&"outlined"===t.variant&&{paddingLeft:7,paddingRight:7})}));function jx(e){return"Backspace"===e.key||"Delete"===e.key}const Vx=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiChip"}),{avatar:i,className:r,clickable:o,color:a="default",component:l,deleteIcon:c,disabled:u=!1,icon:h,label:d,onClick:p,onDelete:f,onKeyDown:m,onKeyUp:g,size:v="medium",variant:y="filled",tabIndex:A,skipFocusWhenDisabled:x=!1}=n,b=(0,je.A)(n,Ux),_=s.useRef(null),w=(0,kt.A)(_,t),E=e=>{e.stopPropagation(),f&&f(e)},S=!(!1===o||!p)||o,C=S||f?gn:l||"div",M=(0,ze.A)({},n,{component:C,disabled:u,size:v,color:a,iconColor:s.isValidElement(h)&&h.props.color||a,onDelete:!!f,clickable:S,variant:y}),T=(e=>{const{classes:t,disabled:n,size:i,color:r,iconColor:o,onDelete:s,clickable:a,variant:l}=e,c={root:["root",l,n&&"disabled",`size${(0,xt.A)(i)}`,`color${(0,xt.A)(r)}`,a&&"clickable",a&&`clickableColor${(0,xt.A)(r)}`,s&&"deletable",s&&`deletableColor${(0,xt.A)(r)}`,`${l}${(0,xt.A)(r)}`],label:["label",`label${(0,xt.A)(i)}`],avatar:["avatar",`avatar${(0,xt.A)(i)}`,`avatarColor${(0,xt.A)(r)}`],icon:["icon",`icon${(0,xt.A)(i)}`,`iconColor${(0,xt.A)(o)}`],deleteIcon:["deleteIcon",`deleteIcon${(0,xt.A)(i)}`,`deleteIconColor${(0,xt.A)(r)}`,`deleteIcon${(0,xt.A)(l)}Color${(0,xt.A)(r)}`]};return(0,yt.A)(c,kx,t)})(M),R=C===gn?(0,ze.A)({component:l||"div",focusVisibleClassName:T.focusVisible},f&&{disableRipple:!0}):{};let I=null;f&&(I=c&&s.isValidElement(c)?s.cloneElement(c,{className:(0,vt.A)(c.props.className,T.deleteIcon),onClick:E}):(0,We.jsx)(Dx,{className:(0,vt.A)(T.deleteIcon),onClick:E}));let P=null;i&&s.isValidElement(i)&&(P=s.cloneElement(i,{className:(0,vt.A)(T.avatar,i.props.className)}));let B=null;return h&&s.isValidElement(h)&&(B=s.cloneElement(h,{className:(0,vt.A)(T.icon,h.props.className)})),(0,We.jsxs)(Fx,(0,ze.A)({as:C,className:(0,vt.A)(T.root,r),disabled:!(!S||!u)||void 0,onClick:p,onKeyDown:e=>{e.currentTarget===e.target&&jx(e)&&e.preventDefault(),m&&m(e)},onKeyUp:e=>{e.currentTarget===e.target&&(f&&jx(e)?f(e):"Escape"===e.key&&_.current&&_.current.blur()),g&&g(e)},ref:w,tabIndex:x&&u?-1:A,ownerState:M},R,b,{children:[P||B,(0,We.jsx)(zx,{className:(0,vt.A)(T.label),ownerState:M,children:d}),I]}))}));function Gx(e){return(0,Et.Ay)("MuiDialog",e)}const Hx=(0,wt.A)("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]);const Wx=s.createContext({}),Qx=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],qx=(0,At.Ay)($r,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),Xx=(0,At.Ay)(uo,{name:"MuiDialog",slot:"Root",overridesResolver:(e,t)=>t.root})({"@media print":{position:"absolute !important"}}),$x=(0,At.Ay)("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.container,t[`scroll${(0,xt.A)(n.scroll)}`]]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({height:"100%","@media print":{height:"auto"},outline:0},"paper"===t.scroll&&{display:"flex",justifyContent:"center",alignItems:"center"},"body"===t.scroll&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})})),Yx=(0,At.Ay)(Tt,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.paper,t[`scrollPaper${(0,xt.A)(n.scroll)}`],t[`paperWidth${(0,xt.A)(String(n.maxWidth))}`],n.fullWidth&&t.paperFullWidth,n.fullScreen&&t.paperFullScreen]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},"paper"===n.scroll&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},"body"===n.scroll&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!n.maxWidth&&{maxWidth:"calc(100% - 64px)"},"xs"===n.maxWidth&&{maxWidth:"px"===t.breakpoints.unit?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${Hx.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}},n.maxWidth&&"xs"!==n.maxWidth&&{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`,[`&.${Hx.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[n.maxWidth]+64)]:{maxWidth:"calc(100% - 64px)"}}},n.fullWidth&&{width:"calc(100% - 64px)"},n.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${Hx.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})})),Kx=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiDialog"}),i=Cr(),r={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{"aria-describedby":o,"aria-labelledby":a,BackdropComponent:l,BackdropProps:c,children:u,className:h,disableEscapeKeyDown:d=!1,fullScreen:p=!1,fullWidth:f=!1,maxWidth:m="sm",onBackdropClick:g,onClick:v,onClose:y,open:A,PaperComponent:x=Tt,PaperProps:b={},scroll:_="paper",TransitionComponent:w=Wr,transitionDuration:E=r,TransitionProps:S}=n,C=(0,je.A)(n,Qx),M=(0,ze.A)({},n,{disableEscapeKeyDown:d,fullScreen:p,fullWidth:f,maxWidth:m,scroll:_}),T=(e=>{const{classes:t,scroll:n,maxWidth:i,fullWidth:r,fullScreen:o}=e,s={root:["root"],container:["container",`scroll${(0,xt.A)(n)}`],paper:["paper",`paperScroll${(0,xt.A)(n)}`,`paperWidth${(0,xt.A)(String(i))}`,r&&"paperFullWidth",o&&"paperFullScreen"]};return(0,yt.A)(s,Gx,t)})(M),R=s.useRef(),I=(0,rv.A)(a),P=s.useMemo((()=>({titleId:I})),[I]);return(0,We.jsx)(Xx,(0,ze.A)({className:(0,vt.A)(T.root,h),closeAfterTransition:!0,components:{Backdrop:qx},componentsProps:{backdrop:(0,ze.A)({transitionDuration:E,as:l},c)},disableEscapeKeyDown:d,onClose:y,open:A,ref:t,onClick:e=>{v&&v(e),R.current&&(R.current=null,g&&g(e),y&&y(e,"backdropClick"))},ownerState:M},C,{children:(0,We.jsx)(w,(0,ze.A)({appear:!0,in:A,timeout:E,role:"presentation"},S,{children:(0,We.jsx)($x,{className:(0,vt.A)(T.container),onMouseDown:e=>{R.current=e.target===e.currentTarget},ownerState:M,children:(0,We.jsx)(Yx,(0,ze.A)({as:x,elevation:24,role:"dialog","aria-describedby":o,"aria-labelledby":I},b,{className:(0,vt.A)(T.paper,b.className),ownerState:M,children:(0,We.jsx)(Wx.Provider,{value:P,children:u})}))})}))}))}));function Jx(e){return(0,Et.Ay)("MuiDialogTitle",e)}const Zx=(0,wt.A)("MuiDialogTitle",["root"]),eb=["className","id"],tb=(0,At.Ay)(Ln,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),nb=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiDialogTitle"}),{className:i,id:r}=n,o=(0,je.A)(n,eb),a=n,l=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"]},Jx,t)})(a),{titleId:c=r}=s.useContext(Wx);return(0,We.jsx)(tb,(0,ze.A)({component:"h2",className:(0,vt.A)(l.root,i),ownerState:a,ref:t,variant:"h6",id:null!=r?r:c},o))}));function ib(e){return(0,Et.Ay)("MuiDialogContent",e)}(0,wt.A)("MuiDialogContent",["root","dividers"]);const rb=["className","dividers"],ob=(0,At.Ay)("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dividers&&t.dividers]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},n.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${Zx.root} + &`]:{paddingTop:0}})})),sb=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiDialogContent"}),{className:i,dividers:r=!1}=n,o=(0,je.A)(n,rb),s=(0,ze.A)({},n,{dividers:r}),a=(e=>{const{classes:t,dividers:n}=e,i={root:["root",n&&"dividers"]};return(0,yt.A)(i,ib,t)})(s);return(0,We.jsx)(ob,(0,ze.A)({className:(0,vt.A)(a.root,i),ownerState:s,ref:t},o))}));function ab(e){return(0,Et.Ay)("MuiDialogActions",e)}(0,wt.A)("MuiDialogActions",["root","spacing"]);const lb=["className","disableSpacing"],cb=(0,At.Ay)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),ub=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiDialogActions"}),{className:i,disableSpacing:r=!1}=n,o=(0,je.A)(n,lb),s=(0,ze.A)({},n,{disableSpacing:r}),a=(e=>{const{classes:t,disableSpacing:n}=e,i={root:["root",!n&&"spacing"]};return(0,yt.A)(i,ab,t)})(s);return(0,We.jsx)(cb,(0,ze.A)({className:(0,vt.A)(a.root,i),ownerState:s,ref:t},o))}));var hb=i(1188);const db={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},pb=(0,ji.A)((0,We.jsx)("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),fb=(0,ji.A)((0,We.jsx)("path",{d:"M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"}),"StarBorder");function mb(e){return(0,Et.Ay)("MuiRating",e)}const gb=(0,wt.A)("MuiRating",["root","sizeSmall","sizeMedium","sizeLarge","readOnly","disabled","focusVisible","visuallyHidden","pristine","label","labelEmptyValueActive","icon","iconEmpty","iconFilled","iconHover","iconFocus","iconActive","decimal"]),vb=["value"],yb=["className","defaultValue","disabled","emptyIcon","emptyLabelText","getLabelText","highlightSelectedOnly","icon","IconContainerComponent","max","name","onChange","onChangeActive","onMouseLeave","onMouseMove","precision","readOnly","size","value"];function Ab(e,t){if(null==e)return e;const n=Math.round(e/t)*t;return Number(n.toFixed(function(e){const t=e.toString().split(".")[1];return t?t.length:0}(t)))}const xb=(0,At.Ay)("span",{name:"MuiRating",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${gb.visuallyHidden}`]:t.visuallyHidden},t.root,t[`size${(0,xt.A)(n.size)}`],n.readOnly&&t.readOnly]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"inline-flex",position:"relative",fontSize:t.typography.pxToRem(24),color:"#faaf00",cursor:"pointer",textAlign:"left",width:"min-content",WebkitTapHighlightColor:"transparent",[`&.${gb.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`&.${gb.focusVisible} .${gb.iconActive}`]:{outline:"1px solid #999"},[`& .${gb.visuallyHidden}`]:db},"small"===n.size&&{fontSize:t.typography.pxToRem(18)},"large"===n.size&&{fontSize:t.typography.pxToRem(30)},n.readOnly&&{pointerEvents:"none"})})),bb=(0,At.Ay)("label",{name:"MuiRating",slot:"Label",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.label,n.emptyValueFocused&&t.labelEmptyValueActive]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({cursor:"inherit"},t.emptyValueFocused&&{top:0,bottom:0,position:"absolute",outline:"1px solid #999",width:"100%"})})),_b=(0,At.Ay)("span",{name:"MuiRating",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.iconEmpty&&t.iconEmpty,n.iconFilled&&t.iconFilled,n.iconHover&&t.iconHover,n.iconFocus&&t.iconFocus,n.iconActive&&t.iconActive]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"flex",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),pointerEvents:"none"},n.iconActive&&{transform:"scale(1.2)"},n.iconEmpty&&{color:(t.vars||t).palette.action.disabled})})),wb=(0,At.Ay)("span",{name:"MuiRating",slot:"Decimal",shouldForwardProp:e=>(0,My.A)(e)&&"iconActive"!==e,overridesResolver:(e,t)=>{const{iconActive:n}=e;return[t.decimal,n&&t.iconActive]}})((e=>{let{iconActive:t}=e;return(0,ze.A)({position:"relative"},t&&{transform:"scale(1.2)"})}));function Eb(e){const t=(0,je.A)(e,vb);return(0,We.jsx)("span",(0,ze.A)({},t))}function Sb(e){const{classes:t,disabled:n,emptyIcon:i,focus:r,getLabelText:o,highlightSelectedOnly:a,hover:l,icon:c,IconContainerComponent:u,isActive:h,itemValue:d,labelProps:p,name:f,onBlur:m,onChange:g,onClick:v,onFocus:y,readOnly:A,ownerState:x,ratingValue:b,ratingValueRounded:_}=e,w=a?d===b:d<=b,E=d<=l,S=d<=r,C=d===_,M=(0,sx.A)(),T=(0,We.jsx)(_b,{as:u,value:d,className:(0,vt.A)(t.icon,w?t.iconFilled:t.iconEmpty,E&&t.iconHover,S&&t.iconFocus,h&&t.iconActive),ownerState:(0,ze.A)({},x,{iconEmpty:!w,iconFilled:w,iconHover:E,iconFocus:S,iconActive:h}),children:i&&!w?i:c});return A?(0,We.jsx)("span",(0,ze.A)({},p,{children:T})):(0,We.jsxs)(s.Fragment,{children:[(0,We.jsxs)(bb,(0,ze.A)({ownerState:(0,ze.A)({},x,{emptyValueFocused:void 0}),htmlFor:M},p,{children:[T,(0,We.jsx)("span",{className:t.visuallyHidden,children:o(d)})]})),(0,We.jsx)("input",{className:t.visuallyHidden,onFocus:y,onBlur:m,onChange:g,onClick:v,disabled:n,value:d,id:M,type:"radio",name:f,checked:C})]})}const Cb=(0,We.jsx)(pb,{fontSize:"inherit"}),Mb=(0,We.jsx)(fb,{fontSize:"inherit"});function Tb(e){return`${e} Star${1!==e?"s":""}`}const Rb=s.forwardRef((function(e,t){const n=(0,st.b)({name:"MuiRating",props:e}),{className:i,defaultValue:r=null,disabled:o=!1,emptyIcon:a=Mb,emptyLabelText:l="Empty",getLabelText:c=Tb,highlightSelectedOnly:u=!1,icon:h=Cb,IconContainerComponent:d=Eb,max:p=5,name:f,onChange:m,onChangeActive:g,onMouseLeave:v,onMouseMove:y,precision:A=1,readOnly:x=!1,size:b="medium",value:_}=n,w=(0,je.A)(n,yb),E=(0,sx.A)(f),[S,C]=(0,Ty.A)({controlled:_,default:r,name:"Rating"}),M=Ab(S,A),T=Ke(),[{hover:R,focus:I},P]=s.useState({hover:-1,focus:-1});let B=M;-1!==R&&(B=R),-1!==I&&(B=I);const{isFocusVisibleRef:L,onBlur:N,onFocus:D,ref:k}=(0,Ut.A)(),[O,U]=s.useState(!1),F=s.useRef(),z=(0,kt.A)(k,F,t),j=e=>{let t=""===e.target.value?null:parseFloat(e.target.value);-1!==R&&(t=R),C(t),m&&m(e,t)},V=e=>{0===e.clientX&&0===e.clientY||(P({hover:-1,focus:-1}),C(null),m&&parseFloat(e.target.value)===M&&m(e,null))},G=e=>{D(e),!0===L.current&&U(!0);const t=parseFloat(e.target.value);P((e=>({hover:e.hover,focus:t})))},H=e=>{if(-1!==R)return;N(e),!1===L.current&&U(!1);P((e=>({hover:e.hover,focus:-1})))},[W,Q]=s.useState(!1),q=(0,ze.A)({},n,{defaultValue:r,disabled:o,emptyIcon:a,emptyLabelText:l,emptyValueFocused:W,focusVisible:O,getLabelText:c,icon:h,IconContainerComponent:d,max:p,precision:A,readOnly:x,size:b}),X=(e=>{const{classes:t,size:n,readOnly:i,disabled:r,emptyValueFocused:o,focusVisible:s}=e,a={root:["root",`size${(0,xt.A)(n)}`,r&&"disabled",s&&"focusVisible",i&&"readOnly"],label:["label","pristine"],labelEmptyValue:[o&&"labelEmptyValueActive"],icon:["icon"],iconEmpty:["iconEmpty"],iconFilled:["iconFilled"],iconHover:["iconHover"],iconFocus:["iconFocus"],iconActive:["iconActive"],decimal:["decimal"],visuallyHidden:["visuallyHidden"]};return(0,yt.A)(a,mb,t)})(q);return(0,We.jsxs)(xb,(0,ze.A)({ref:z,onMouseMove:e=>{y&&y(e);const t=F.current,{right:n,left:i,width:r}=t.getBoundingClientRect();let o;o=T?(n-e.clientX)/r:(e.clientX-i)/r;let s=Ab(p*o+A/2,A);s=(0,hb.A)(s,A,p),P((e=>e.hover===s&&e.focus===s?e:{hover:s,focus:s})),U(!1),g&&R!==s&&g(e,s)},onMouseLeave:e=>{v&&v(e);P({hover:-1,focus:-1}),g&&-1!==R&&g(e,-1)},className:(0,vt.A)(X.root,i,x&&"MuiRating-readOnly"),ownerState:q,role:x?"img":null,"aria-label":x?c(B):null},w,{children:[Array.from(new Array(p)).map(((e,t)=>{const n=t+1,i={classes:X,disabled:o,emptyIcon:a,focus:I,getLabelText:c,highlightSelectedOnly:u,hover:R,icon:h,IconContainerComponent:d,name:E,onBlur:H,onChange:j,onClick:V,onFocus:G,ratingValue:B,ratingValueRounded:M,readOnly:x,ownerState:q},r=n===Math.ceil(B)&&(-1!==R||-1!==I);if(A<1){const e=Array.from(new Array(1/A));return(0,We.jsx)(wb,{className:(0,vt.A)(X.decimal,r&&X.iconActive),ownerState:q,iconActive:r,children:e.map(((t,r)=>{const o=Ab(n-1+(r+1)*A,A);return(0,We.jsx)(Sb,(0,ze.A)({},i,{isActive:!1,itemValue:o,labelProps:{style:e.length-1===r?{}:{width:o===B?(r+1)*A*100+"%":"0%",overflow:"hidden",position:"absolute"}}}),o)}))},n)}return(0,We.jsx)(Sb,(0,ze.A)({},i,{isActive:r,itemValue:n}),n)})),!x&&!o&&(0,We.jsxs)(bb,{className:(0,vt.A)(X.label,X.labelEmptyValue),ownerState:q,children:[(0,We.jsx)("input",{className:X.visuallyHidden,value:"",id:`${E}-empty`,type:"radio",name:E,checked:null==M,onFocus:()=>Q(!0),onBlur:()=>Q(!1),onChange:j}),(0,We.jsx)("span",{className:X.visuallyHidden,children:l})]})]}))})),Ib=(0,ji.A)([(0,We.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,We.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Pb=(0,ji.A)((0,We.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),Bb=(0,ji.A)((0,We.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 12H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Message"),Lb=(0,ji.A)((0,We.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),Nb=(0,ji.A)((0,We.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Db=(0,ji.A)((0,We.jsx)("path",{d:"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"}),"LinkedIn"),kb=(0,ji.A)((0,We.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),Ob=(0,ji.A)((0,We.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Ub=(0,ji.A)((0,We.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload"),Fb=(0,ji.A)((0,We.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");function zb(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}function jb(e,t){var n,i,r,o,s,a=new Wb(e),l=+e.value&&(a.value=e.value),c=[a];for(null==t&&(t=Vb);n=c.pop();)if(l&&(n.value=+n.data.value),(r=t(n.data))&&(s=r.length))for(n.children=new Array(s),o=s-1;o>=0;--o)c.push(i=n.children[o]=new Wb(r[o])),i.parent=n,i.depth=n.depth+1;return a.eachBefore(Hb)}function Vb(e){return e.children}function Gb(e){e.data=e.data.data}function Hb(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function Wb(e){this.data=e,this.depth=this.height=0,this.parent=null}function Qb(e,t){return e.parent===t.parent?1:2}function qb(e){var t=e.children;return t?t[0]:e.t}function Xb(e){var t=e.children;return t?t[t.length-1]:e.t}function $b(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function Yb(e,t,n){return e.a.parent===t.parent?e.a:n}function Kb(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function Jb(){var e=Qb,t=1,n=1,i=null;function r(r){var l=function(e){for(var t,n,i,r,o,s=new Kb(e,0),a=[s];t=a.pop();)if(i=t._.children)for(t.children=new Array(o=i.length),r=o-1;r>=0;--r)a.push(n=t.children[r]=new Kb(i[r],r)),n.parent=t;return(s.parent=new Kb(null,0)).children=[s],s}(r);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(s),i)r.eachBefore(a);else{var c=r,u=r,h=r;r.eachBefore((function(e){e.x<c.x&&(c=e),e.x>u.x&&(u=e),e.depth>h.depth&&(h=e)}));var d=c===u?1:e(c,u)/2,p=d-c.x,f=t/(u.x+d+p),m=n/(h.depth||1);r.eachBefore((function(e){e.x=(e.x+p)*f,e.y=e.depth*m}))}return r}function o(t){var n=t.children,i=t.parent.children,r=t.i?i[t.i-1]:null;if(n){!function(e){for(var t,n=0,i=0,r=e.children,o=r.length;--o>=0;)(t=r[o]).z+=n,t.m+=n,n+=t.s+(i+=t.c)}(t);var o=(n[0].z+n[n.length-1].z)/2;r?(t.z=r.z+e(t._,r._),t.m=t.z-o):t.z=o}else r&&(t.z=r.z+e(t._,r._));t.parent.A=function(t,n,i){if(n){for(var r,o=t,s=t,a=n,l=o.parent.children[0],c=o.m,u=s.m,h=a.m,d=l.m;a=Xb(a),o=qb(o),a&&o;)l=qb(l),(s=Xb(s)).a=t,(r=a.z+h-o.z-c+e(a._,o._))>0&&($b(Yb(a,t,i),t,r),c+=r,u+=r),h+=a.m,c+=o.m,d+=l.m,u+=s.m;a&&!Xb(s)&&(s.t=a,s.m+=h-u),o&&!qb(l)&&(l.t=o,l.m+=c-d,i=t)}return i}(t,r,t.parent.A||i[0])}function s(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function a(e){e.x*=t,e.y=e.depth*n}return r.separation=function(t){return arguments.length?(e=t,r):e},r.size=function(e){return arguments.length?(i=!1,t=+e[0],n=+e[1],r):i?null:[t,n]},r.nodeSize=function(e){return arguments.length?(i=!0,t=+e[0],n=+e[1],r):i?[t,n]:null},r}function Zb(){}function e_(e){return null==e?Zb:function(){return this.querySelector(e)}}function t_(){return[]}function n_(e){return null==e?t_:function(){return this.querySelectorAll(e)}}function i_(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}function r_(e){return function(){return this.matches(e)}}function o_(e){return function(t){return t.matches(e)}}Wb.prototype=jb.prototype={constructor:Wb,count:function(){return this.eachAfter(zb)},each:function(e){var t,n,i,r,o=this,s=[o];do{for(t=s.reverse(),s=[];o=t.pop();)if(e(o),n=o.children)for(i=0,r=n.length;i<r;++i)s.push(n[i])}while(s.length);return this},eachAfter:function(e){for(var t,n,i,r=this,o=[r],s=[];r=o.pop();)if(s.push(r),t=r.children)for(n=0,i=t.length;n<i;++n)o.push(t[n]);for(;r=s.pop();)e(r);return this},eachBefore:function(e){for(var t,n,i=this,r=[i];i=r.pop();)if(e(i),t=i.children)for(n=t.length-1;n>=0;--n)r.push(t[n]);return this},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;e=n.pop(),t=i.pop();for(;e===t;)r=e,e=n.pop(),t=i.pop();return r}(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){var e=[];return this.each((function(t){e.push(t)})),e},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return jb(this).eachBefore(Gb)}},Kb.prototype=Object.create(Wb.prototype);var s_=Array.prototype.find;function a_(){return this.firstElementChild}var l_=Array.prototype.filter;function c_(){return Array.from(this.children)}function u_(e){return new Array(e.length)}function h_(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function d_(e,t,n,i,r,o){for(var s,a=0,l=t.length,c=o.length;a<c;++a)(s=t[a])?(s.__data__=o[a],i[a]=s):n[a]=new h_(e,o[a]);for(;a<l;++a)(s=t[a])&&(r[a]=s)}function p_(e,t,n,i,r,o,s){var a,l,c,u=new Map,h=t.length,d=o.length,p=new Array(h);for(a=0;a<h;++a)(l=t[a])&&(p[a]=c=s.call(l,l.__data__,a,t)+"",u.has(c)?r[a]=l:u.set(c,l));for(a=0;a<d;++a)c=s.call(e,o[a],a,o)+"",(l=u.get(c))?(i[a]=l,l.__data__=o[a],u.delete(c)):n[a]=new h_(e,o[a]);for(a=0;a<h;++a)(l=t[a])&&u.get(p[a])===l&&(r[a]=l)}function f_(e){return e.__data__}function m_(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function g_(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}h_.prototype={constructor:h_,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var v_="http://www.w3.org/1999/xhtml";const y_={svg:"http://www.w3.org/2000/svg",xhtml:v_,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function A_(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),y_.hasOwnProperty(t)?{space:y_[t],local:e}:e}function x_(e){return function(){this.removeAttribute(e)}}function b_(e){return function(){this.removeAttributeNS(e.space,e.local)}}function __(e,t){return function(){this.setAttribute(e,t)}}function w_(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function E_(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function S_(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function C_(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function M_(e){return function(){this.style.removeProperty(e)}}function T_(e,t,n){return function(){this.style.setProperty(e,t,n)}}function R_(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function I_(e,t){return e.style.getPropertyValue(t)||C_(e).getComputedStyle(e,null).getPropertyValue(t)}function P_(e){return function(){delete this[e]}}function B_(e,t){return function(){this[e]=t}}function L_(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function N_(e){return e.trim().split(/^|\s+/)}function D_(e){return e.classList||new k_(e)}function k_(e){this._node=e,this._names=N_(e.getAttribute("class")||"")}function O_(e,t){for(var n=D_(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function U_(e,t){for(var n=D_(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function F_(e){return function(){O_(this,e)}}function z_(e){return function(){U_(this,e)}}function j_(e,t){return function(){(t.apply(this,arguments)?O_:U_)(this,e)}}function V_(){this.textContent=""}function G_(e){return function(){this.textContent=e}}function H_(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function W_(){this.innerHTML=""}function Q_(e){return function(){this.innerHTML=e}}function q_(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function X_(){this.nextSibling&&this.parentNode.appendChild(this)}function $_(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Y_(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===v_&&t.documentElement.namespaceURI===v_?t.createElement(e):t.createElementNS(n,e)}}function K_(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function J_(e){var t=A_(e);return(t.local?K_:Y_)(t)}function Z_(){return null}function ew(){var e=this.parentNode;e&&e.removeChild(this)}function tw(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function nw(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function iw(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,o=t.length;i<o;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?t.length=r:delete this.__on}}}function rw(e,t,n){return function(){var i,r=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=t);this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ow(e,t,n){var i=C_(e),r=i.CustomEvent;"function"===typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function sw(e,t){return function(){return ow(this,e,t)}}function aw(e,t){return function(){return ow(this,e,t.apply(this,arguments))}}k_.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var lw=[null];function cw(e,t){this._groups=e,this._parents=t}function uw(){return new cw([[document.documentElement]],lw)}cw.prototype=uw.prototype={constructor:cw,select:function(e){"function"!==typeof e&&(e=e_(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s,a=t[r],l=a.length,c=i[r]=new Array(l),u=0;u<l;++u)(o=a[u])&&(s=e.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),c[u]=s);return new cw(i,this._parents)},selectAll:function(e){e="function"===typeof e?i_(e):n_(e);for(var t=this._groups,n=t.length,i=[],r=[],o=0;o<n;++o)for(var s,a=t[o],l=a.length,c=0;c<l;++c)(s=a[c])&&(i.push(e.call(s,s.__data__,c,a)),r.push(s));return new cw(i,r)},selectChild:function(e){return this.select(null==e?a_:function(e){return function(){return s_.call(this.children,e)}}("function"===typeof e?e:o_(e)))},selectChildren:function(e){return this.selectAll(null==e?c_:function(e){return function(){return l_.call(this.children,e)}}("function"===typeof e?e:o_(e)))},filter:function(e){"function"!==typeof e&&(e=r_(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new cw(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,f_);var n,i=t?p_:d_,r=this._parents,o=this._groups;"function"!==typeof e&&(n=e,e=function(){return n});for(var s=o.length,a=new Array(s),l=new Array(s),c=new Array(s),u=0;u<s;++u){var h=r[u],d=o[u],p=d.length,f=m_(e.call(h,h&&h.__data__,u,r)),m=f.length,g=l[u]=new Array(m),v=a[u]=new Array(m);i(h,d,g,v,c[u]=new Array(p),f,t);for(var y,A,x=0,b=0;x<m;++x)if(y=g[x]){for(x>=b&&(b=x+1);!(A=v[b])&&++b<m;);y._next=A||null}}return(a=new cw(a,r))._enter=l,a._exit=c,a},enter:function(){return new cw(this._enter||this._groups.map(u_),this._parents)},exit:function(){return new cw(this._exit||this._groups.map(u_),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,o=this.exit();return"function"===typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(r=t(r))&&(r=r.selection()),null==n?o.remove():n(o),i&&r?i.merge(r).order():r},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var c,u=n[l],h=i[l],d=u.length,p=a[l]=new Array(d),f=0;f<d;++f)(c=u[f]||h[f])&&(p[f]=c);for(;l<r;++l)a[l]=n[l];return new cw(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],o=r.length-1,s=r[o];--o>=0;)(i=r[o])&&(s&&4^i.compareDocumentPosition(s)&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=g_);for(var n=this._groups,i=n.length,r=new Array(i),o=0;o<i;++o){for(var s,a=n[o],l=a.length,c=r[o]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(t)}return new cw(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,o=t[n],s=0,a=o.length;s<a;++s)(r=o[s])&&e.call(r,r.__data__,s,o);return this},attr:function(e,t){var n=A_(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?b_:x_:"function"===typeof t?n.local?S_:E_:n.local?w_:__)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?M_:"function"===typeof t?R_:T_)(e,t,null==n?"":n)):I_(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?P_:"function"===typeof t?L_:B_)(e,t)):this.node()[e]},classed:function(e,t){var n=N_(e+"");if(arguments.length<2){for(var i=D_(this.node()),r=-1,o=n.length;++r<o;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"===typeof t?j_:t?F_:z_)(n,t))},text:function(e){return arguments.length?this.each(null==e?V_:("function"===typeof e?H_:G_)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?W_:("function"===typeof e?q_:Q_)(e)):this.node().innerHTML},raise:function(){return this.each(X_)},lower:function(){return this.each($_)},append:function(e){var t="function"===typeof e?e:J_(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"===typeof e?e:J_(e),i=null==t?Z_:"function"===typeof t?t:e_(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(ew)},clone:function(e){return this.select(e?nw:tw)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,o=function(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}(e+""),s=o.length;if(!(arguments.length<2)){for(a=t?rw:iw,i=0;i<s;++i)this.each(a(o[i],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(i=0,l=a[c];i<s;++i)if((r=o[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"===typeof t?aw:sw)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i,r=e[t],o=0,s=r.length;o<s;++o)(i=r[o])&&(yield i)}};const hw=uw;function dw(e){return"string"===typeof e?new cw([[document.querySelector(e)]],[document.documentElement]):new cw([[e]],lw)}var pw={value:()=>{}};function fw(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new mw(i)}function mw(e){this._=e}function gw(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function vw(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=pw,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}mw.prototype=fw.prototype={constructor:mw,on:function(e,t){var n,i,r=this._,o=(i=r,(e+"").trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!i.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}}))),s=-1,a=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!==typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=o[s]).type)r[n]=vw(r[n],e.name,t);else if(null==t)for(n in r)r[n]=vw(r[n],e.name,null);return this}for(;++s<a;)if((n=(e=o[s]).type)&&(n=gw(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new mw(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),o=0;o<n;++o)r[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(i=this._[e]).length;o<n;++o)i[o].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)}};const yw=fw,Aw={passive:!1},xw={capture:!0,passive:!1};function bw(e){e.stopImmediatePropagation()}function _w(e){e.preventDefault(),e.stopImmediatePropagation()}function ww(e){var t=e.document.documentElement,n=dw(e).on("dragstart.drag",_w,xw);"onselectstart"in t?n.on("selectstart.drag",_w,xw):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ew(e,t){var n=e.document.documentElement,i=dw(e).on("dragstart.drag",null);t&&(i.on("click.drag",_w,xw),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Sw(e){return((e=Math.exp(e))+1/e)/2}const Cw=function e(t,n,i){function r(e,r){var o,s,a=e[0],l=e[1],c=e[2],u=r[0],h=r[1],d=r[2],p=u-a,f=h-l,m=p*p+f*f;if(m<1e-12)s=Math.log(d/c)/t,o=function(e){return[a+e*p,l+e*f,c*Math.exp(t*e*s)]};else{var g=Math.sqrt(m),v=(d*d-c*c+i*m)/(2*c*n*g),y=(d*d-c*c-i*m)/(2*d*n*g),A=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(y*y+1)-y);s=(x-A)/t,o=function(e){var i,r=e*s,o=Sw(A),u=c/(n*g)*(o*(i=t*r+A,((i=Math.exp(2*i))-1)/(i+1))-function(e){return((e=Math.exp(e))-1/e)/2}(A));return[a+u*p,l+u*f,c*o/Sw(t*r+A)]}}return o.duration=1e3*s*t/Math.SQRT2,o}return r.rho=function(t){var n=Math.max(.001,+t),i=n*n;return e(n,i,i*i)},r}(Math.SQRT2,2,4);function Mw(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}var Tw,Rw,Iw=0,Pw=0,Bw=0,Lw=0,Nw=0,Dw=0,kw="object"===typeof performance&&performance.now?performance:Date,Ow="object"===typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Uw(){return Nw||(Ow(Fw),Nw=kw.now()+Dw)}function Fw(){Nw=0}function zw(){this._call=this._time=this._next=null}function jw(e,t,n){var i=new zw;return i.restart(e,t,n),i}function Vw(){Nw=(Lw=kw.now())+Dw,Iw=Pw=0;try{!function(){Uw(),++Iw;for(var e,t=Tw;t;)(e=Nw-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Iw}()}finally{Iw=0,function(){var e,t,n=Tw,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Tw=t);Rw=e,Hw(i)}(),Nw=0}}function Gw(){var e=kw.now(),t=e-Lw;t>1e3&&(Dw-=t,Lw=e)}function Hw(e){Iw||(Pw&&(Pw=clearTimeout(Pw)),e-Nw>24?(e<1/0&&(Pw=setTimeout(Vw,e-kw.now()-Dw)),Bw&&(Bw=clearInterval(Bw))):(Bw||(Lw=kw.now(),Bw=setInterval(Gw,1e3)),Iw=1,Ow(Vw)))}function Ww(e,t,n){var i=new zw;return t=null==t?0:+t,i.restart((n=>{i.stop(),e(n+t)}),t,n),i}zw.prototype=jw.prototype={constructor:zw,restart:function(e,t,n){if("function"!==typeof e)throw new TypeError("callback is not a function");n=(null==n?Uw():+n)+(null==t?0:+t),this._next||Rw===this||(Rw?Rw._next=this:Tw=this,Rw=this),this._call=e,this._time=n,Hw()},stop:function(){this._call&&(this._call=null,this._time=1/0,Hw())}};var Qw=yw("start","end","cancel","interrupt"),qw=[];function Xw(e,t,n,i,r,o){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var i,r=e.__transition;function o(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)}function s(o){var c,u,h,d;if(1!==n.state)return l();for(c in r)if((d=r[c]).name===n.name){if(3===d.state)return Ww(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",e,e.__data__,d.index,d.group),delete r[c]):+c<t&&(d.state=6,d.timer.stop(),d.on.call("cancel",e,e.__data__,d.index,d.group),delete r[c])}if(Ww((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(o))})),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++u]=d);i.length=u+1}}function a(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,s=i.length;++o<s;)i[o].call(e,r);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=jw(o,0,n.time)}(e,n,{name:t,index:i,group:r,on:Qw,tween:qw,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function $w(e,t){var n=Kw(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Yw(e,t){var n=Kw(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Kw(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Jw(e,t){var n,i,r,o=e.__transition,s=!0;if(o){for(r in t=null==t?null:t+"",o)(n=o[r]).name===t?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete o[r]):s=!1;s&&delete e.__transition}}function Zw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var eE,tE=180/Math.PI,nE={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function iE(e,t,n,i,r,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,e)*tE,skewX:Math.atan(l)*tE,scaleX:s,scaleY:a}}function rE(e,t,n,i){function r(e){return e.length?e.pop()+" ":""}return function(o,s){var a=[],l=[];return o=e(o),s=e(s),function(e,i,r,o,s,a){if(e!==r||i!==o){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:Zw(e,r)},{i:l-2,x:Zw(i,o)})}else(r||o)&&s.push("translate("+r+t+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,a,l),function(e,t,n,o){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),o.push({i:n.push(r(n)+"rotate(",null,i)-2,x:Zw(e,t)})):t&&n.push(r(n)+"rotate("+t+i)}(o.rotate,s.rotate,a,l),function(e,t,n,o){e!==t?o.push({i:n.push(r(n)+"skewX(",null,i)-2,x:Zw(e,t)}):t&&n.push(r(n)+"skewX("+t+i)}(o.skewX,s.skewX,a,l),function(e,t,n,i,o,s){if(e!==n||t!==i){var a=o.push(r(o)+"scale(",null,",",null,")");s.push({i:a-4,x:Zw(e,n)},{i:a-2,x:Zw(t,i)})}else 1===n&&1===i||o.push(r(o)+"scale("+n+","+i+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,a,l),o=s=null,function(e){for(var t,n=-1,i=l.length;++n<i;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var oE=rE((function(e){const t=new("function"===typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?nE:iE(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),sE=rE((function(e){return null==e?nE:(eE||(eE=document.createElementNS("http://www.w3.org/2000/svg","g")),eE.setAttribute("transform",e),(e=eE.transform.baseVal.consolidate())?iE((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):nE)}),", ",")",")");function aE(e,t){var n,i;return function(){var r=Yw(this,e),o=r.tween;if(o!==n)for(var s=0,a=(i=n=o).length;s<a;++s)if(i[s].name===t){(i=i.slice()).splice(s,1);break}r.tween=i}}function lE(e,t,n){var i,r;if("function"!==typeof n)throw new Error;return function(){var o=Yw(this,e),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=a;break}l===c&&r.push(a)}o.tween=r}}function cE(e,t,n){var i=e._id;return e.each((function(){var e=Yw(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return Kw(e,i).value[t]}}function uE(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function hE(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function dE(){}var pE=.7,fE=1/pE,mE="\\s*([+-]?\\d+)\\s*",gE="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",vE="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yE=/^#([0-9a-f]{3,8})$/,AE=new RegExp(`^rgb\\(${mE},${mE},${mE}\\)$`),xE=new RegExp(`^rgb\\(${vE},${vE},${vE}\\)$`),bE=new RegExp(`^rgba\\(${mE},${mE},${mE},${gE}\\)$`),_E=new RegExp(`^rgba\\(${vE},${vE},${vE},${gE}\\)$`),wE=new RegExp(`^hsl\\(${gE},${vE},${vE}\\)$`),EE=new RegExp(`^hsla\\(${gE},${vE},${vE},${gE}\\)$`),SE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function CE(){return this.rgb().formatHex()}function ME(){return this.rgb().formatRgb()}function TE(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=yE.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?RE(t):3===n?new BE(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?IE(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?IE(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=AE.exec(e))?new BE(t[1],t[2],t[3],1):(t=xE.exec(e))?new BE(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=bE.exec(e))?IE(t[1],t[2],t[3],t[4]):(t=_E.exec(e))?IE(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=wE.exec(e))?UE(t[1],t[2]/100,t[3]/100,1):(t=EE.exec(e))?UE(t[1],t[2]/100,t[3]/100,t[4]):SE.hasOwnProperty(e)?RE(SE[e]):"transparent"===e?new BE(NaN,NaN,NaN,0):null}function RE(e){return new BE(e>>16&255,e>>8&255,255&e,1)}function IE(e,t,n,i){return i<=0&&(e=t=n=NaN),new BE(e,t,n,i)}function PE(e,t,n,i){return 1===arguments.length?((r=e)instanceof dE||(r=TE(r)),r?new BE((r=r.rgb()).r,r.g,r.b,r.opacity):new BE):new BE(e,t,n,null==i?1:i);var r}function BE(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function LE(){return`#${OE(this.r)}${OE(this.g)}${OE(this.b)}`}function NE(){const e=DE(this.opacity);return`${1===e?"rgb(":"rgba("}${kE(this.r)}, ${kE(this.g)}, ${kE(this.b)}${1===e?")":`, ${e})`}`}function DE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function kE(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function OE(e){return((e=kE(e))<16?"0":"")+e.toString(16)}function UE(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new zE(e,t,n,i)}function FE(e){if(e instanceof zE)return new zE(e.h,e.s,e.l,e.opacity);if(e instanceof dE||(e=TE(e)),!e)return new zE;if(e instanceof zE)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),s=NaN,a=o-r,l=(o+r)/2;return a?(s=t===o?(n-i)/a+6*(n<i):n===o?(i-t)/a+2:(t-n)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new zE(s,a,l,e.opacity)}function zE(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function jE(e){return(e=(e||0)%360)<0?e+360:e}function VE(e){return Math.max(0,Math.min(1,e||0))}function GE(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function HE(e,t,n,i,r){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*i+s*r)/6}uE(dE,TE,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:CE,formatHex:CE,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return FE(this).formatHsl()},formatRgb:ME,toString:ME}),uE(BE,PE,hE(dE,{brighter(e){return e=null==e?fE:Math.pow(fE,e),new BE(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?pE:Math.pow(pE,e),new BE(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new BE(kE(this.r),kE(this.g),kE(this.b),DE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:LE,formatHex:LE,formatHex8:function(){return`#${OE(this.r)}${OE(this.g)}${OE(this.b)}${OE(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:NE,toString:NE})),uE(zE,(function(e,t,n,i){return 1===arguments.length?FE(e):new zE(e,t,n,null==i?1:i)}),hE(dE,{brighter(e){return e=null==e?fE:Math.pow(fE,e),new zE(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?pE:Math.pow(pE,e),new zE(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new BE(GE(e>=240?e-240:e+120,r,i),GE(e,r,i),GE(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new zE(jE(this.h),VE(this.s),VE(this.l),DE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=DE(this.opacity);return`${1===e?"hsl(":"hsla("}${jE(this.h)}, ${100*VE(this.s)}%, ${100*VE(this.l)}%${1===e?")":`, ${e})`}`}}));const WE=e=>()=>e;function QE(e,t){return function(n){return e+n*t}}function qE(e){return 1===(e=+e)?XE:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):WE(isNaN(t)?n:t)}}function XE(e,t){var n=t-e;return n?QE(e,n):WE(isNaN(e)?t:e)}const $E=function e(t){var n=qE(t);function i(e,t){var i=n((e=PE(e)).r,(t=PE(t)).r),r=n(e.g,t.g),o=n(e.b,t.b),s=XE(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=r(t),e.b=o(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function YE(e){return function(t){var n,i,r=t.length,o=new Array(r),s=new Array(r),a=new Array(r);for(n=0;n<r;++n)i=PE(t[n]),o[n]=i.r||0,s[n]=i.g||0,a[n]=i.b||0;return o=e(o),s=e(s),a=e(a),i.opacity=1,function(e){return i.r=o(e),i.g=s(e),i.b=a(e),i+""}}}YE((function(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],o=e[i+1],s=i>0?e[i-1]:2*r-o,a=i<t-1?e[i+2]:2*o-r;return HE((n-i/t)*t,s,r,o,a)}})),YE((function(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],o=e[i%t],s=e[(i+1)%t],a=e[(i+2)%t];return HE((n-i/t)*t,r,o,s,a)}}));var KE=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,JE=new RegExp(KE.source,"g");function ZE(e,t){var n,i,r,o=KE.lastIndex=JE.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=KE.exec(e))&&(i=JE.exec(t));)(r=i.index)>o&&(r=t.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:Zw(n,i)})),o=JE.lastIndex;return o<t.length&&(r=t.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})}function eS(e,t){var n;return("number"===typeof t?Zw:t instanceof TE?$E:(n=TE(t))?(t=n,$E):ZE)(e,t)}function tS(e){return function(){this.removeAttribute(e)}}function nS(e){return function(){this.removeAttributeNS(e.space,e.local)}}function iS(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttribute(e);return s===o?null:s===i?r:r=t(i=s,n)}}function rS(e,t,n){var i,r,o=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===i?r:r=t(i=s,n)}}function oS(e,t,n){var i,r,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l));this.removeAttribute(e)}}function sS(e,t,n){var i,r,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===i&&a===r?o:(r=a,o=t(i=s,l));this.removeAttributeNS(e.space,e.local)}}function aS(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,r)),n}return r._value=t,r}function lS(e,t){var n,i;function r(){var r=t.apply(this,arguments);return r!==i&&(n=(i=r)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,r)),n}return r._value=t,r}function cS(e,t){return function(){$w(this,e).delay=+t.apply(this,arguments)}}function uS(e,t){return t=+t,function(){$w(this,e).delay=t}}function hS(e,t){return function(){Yw(this,e).duration=+t.apply(this,arguments)}}function dS(e,t){return t=+t,function(){Yw(this,e).duration=t}}var pS=hw.prototype.constructor;function fS(e){return function(){this.style.removeProperty(e)}}var mS=0;function gS(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function vS(){return++mS}var yS=hw.prototype;gS.prototype=function(e){return hw().transition(e)}.prototype={constructor:gS,select:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=e_(e));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a,l,c=i[s],u=c.length,h=o[s]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=e.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,Xw(h[d],t,n,d,h,Kw(a,n)));return new gS(o,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!==typeof e&&(e=n_(e));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l,c=i[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,p=e.call(l,l.__data__,h,c),f=Kw(l,n),m=0,g=p.length;m<g;++m)(d=p[m])&&Xw(d,t,n,m,p,f);o.push(p),s.push(l)}return new gS(o,s,t,n)},selectChild:yS.selectChild,selectChildren:yS.selectChildren,filter:function(e){"function"!==typeof e&&(e=r_(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var o,s=t[r],a=s.length,l=i[r]=[],c=0;c<a;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&l.push(o);return new gS(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var l,c=t[a],u=n[a],h=c.length,d=s[a]=new Array(h),p=0;p<h;++p)(l=c[p]||u[p])&&(d[p]=l);for(;a<i;++a)s[a]=t[a];return new gS(s,this._parents,this._name,this._id)},selection:function(){return new pS(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=vS(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=Kw(s,t);Xw(s,e,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new gS(i,this._parents,e,n)},call:yS.call,nodes:yS.nodes,node:yS.node,size:yS.size,empty:yS.empty,each:yS.each,on:function(e,t){var n=this._id;return arguments.length<2?Kw(this.node(),n).on.on(e):this.each(function(e,t,n){var i,r,o=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?$w:Yw;return function(){var s=o(this,e),a=s.on;a!==i&&(r=(i=a).copy()).on(t,n),s.on=r}}(n,e,t))},attr:function(e,t){var n=A_(e),i="transform"===n?sE:eS;return this.attrTween(e,"function"===typeof t?(n.local?sS:oS)(n,i,cE(this,"attr."+e,t)):null==t?(n.local?nS:tS)(n):(n.local?rS:iS)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!==typeof t)throw new Error;var i=A_(e);return this.tween(n,(i.local?aS:lS)(i,t))},style:function(e,t,n){var i="transform"===(e+="")?oE:eS;return null==t?this.styleTween(e,function(e,t){var n,i,r;return function(){var o=I_(this,e),s=(this.style.removeProperty(e),I_(this,e));return o===s?null:o===n&&s===i?r:r=t(n=o,i=s)}}(e,i)).on("end.style."+e,fS(e)):"function"===typeof t?this.styleTween(e,function(e,t,n){var i,r,o;return function(){var s=I_(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=I_(this,e)),s===l?null:s===i&&l===r?o:(r=l,o=t(i=s,a))}}(e,i,cE(this,"style."+e,t))).each(function(e,t){var n,i,r,o,s="style."+t,a="end."+s;return function(){var l=Yw(this,e),c=l.on,u=null==l.value[s]?o||(o=fS(t)):void 0;c===n&&r===u||(i=(n=c).copy()).on(a,r=u),l.on=i}}(this._id,e)):this.styleTween(e,function(e,t,n){var i,r,o=n+"";return function(){var s=I_(this,e);return s===o?null:s===i?r:r=t(i=s,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!==typeof t)throw new Error;return this.tween(i,function(e,t,n){var i,r;function o(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&function(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,o,n)),i}return o._value=t,o}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"===typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(cE(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!==typeof e)throw new Error;return this.tween(t,function(e){var t,n;function i(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i,r=Kw(this.node(),n).tween,o=0,s=r.length;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((null==t?aE:lE)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?cS:uS)(t,e)):Kw(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"===typeof e?hS:dS)(t,e)):Kw(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!==typeof t)throw new Error;return function(){Yw(this,e).ease=t}}(t,e)):Kw(this.node(),t).ease},easeVarying:function(e){if("function"!==typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!==typeof n)throw new Error;Yw(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,i=n._id,r=n.size();return new Promise((function(o,s){var a={value:s},l={value:function(){0===--r&&o()}};n.each((function(){var n=Yw(this,i),r=n.on;r!==e&&((t=(e=r).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t})),0===r&&o()}))},[Symbol.iterator]:yS[Symbol.iterator]};var AS={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function xS(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}hw.prototype.interrupt=function(e){return this.each((function(){Jw(this,e)}))},hw.prototype.transition=function(e){var t,n;e instanceof gS?(t=e._id,e=e._name):(t=vS(),(n=AS).time=Uw(),e=null==e?null:e+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s,a=i[o],l=a.length,c=0;c<l;++c)(s=a[c])&&Xw(s,e,t,c,a,n||xS(s,t));return new gS(i,this._parents,e,t)};const bS=e=>()=>e;function _S(e,t){let{sourceEvent:n,target:i,transform:r,dispatch:o}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function wS(e,t,n){this.k=e,this.x=t,this.y=n}wS.prototype={constructor:wS,scale:function(e){return 1===e?this:new wS(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new wS(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ES=new wS(1,0,0);function SS(e){for(;!e.__zoom;)if(!(e=e.parentNode))return ES;return e.__zoom}function CS(e){e.stopImmediatePropagation()}function MS(e){e.preventDefault(),e.stopImmediatePropagation()}function TS(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button}function RS(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function IS(){return this.__zoom||ES}function PS(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function BS(){return navigator.maxTouchPoints||"ontouchstart"in this}function LS(e,t,n){var i=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function NS(){var e,t,n,i=TS,r=RS,o=LS,s=PS,a=BS,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,h=Cw,d=yw("start","zoom","end"),p=0,f=10;function m(e){e.property("__zoom",IS).on("wheel.zoom",_,{passive:!1}).on("mousedown.zoom",w).on("dblclick.zoom",E).filter(a).on("touchstart.zoom",S).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new wS(t,e.x,e.y)}function v(e,t,n){var i=t[0]-n[0]*e.k,r=t[1]-n[1]*e.k;return i===e.x&&r===e.y?e:new wS(e.k,i,r)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function A(e,t,n,i){e.on("start.zoom",(function(){x(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){x(this,arguments).event(i).end()})).tween("zoom",(function(){var e=this,o=arguments,s=x(e,o).event(i),a=r.apply(e,o),l=null==n?y(a):"function"===typeof n?n.apply(e,o):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=e.__zoom,d="function"===typeof t?t.apply(e,o):t,p=h(u.invert(l).concat(c/u.k),d.invert(l).concat(c/d.k));return function(e){if(1===e)e=d;else{var t=p(e),n=c/t[2];e=new wS(n,l[0]-t[0]*n,l[1]-t[1]*n)}s.zoom(null,e)}}))}function x(e,t,n){return!n&&e.__zooming||new b(e,t)}function b(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=r.apply(e,t),this.taps=0}function _(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(i.apply(this,arguments)){var a=x(this,n).event(e),u=this.__zoom,h=Math.max(l[0],Math.min(l[1],u.k*Math.pow(2,s.apply(this,arguments)))),d=Mw(e);if(a.wheel)a.mouse[0][0]===d[0]&&a.mouse[0][1]===d[1]||(a.mouse[1]=u.invert(a.mouse[0]=d)),clearTimeout(a.wheel);else{if(u.k===h)return;a.mouse=[d,u.invert(d)],Jw(this),a.start()}MS(e),a.wheel=setTimeout((function(){a.wheel=null,a.end()}),150),a.zoom("mouse",o(v(g(u,h),a.mouse[0],a.mouse[1]),a.extent,c))}}function w(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];if(!n&&i.apply(this,arguments)){var a=e.currentTarget,l=x(this,r,!0).event(e),u=dw(e.view).on("mousemove.zoom",(function(e){if(MS(e),!l.moved){var t=e.clientX-d,n=e.clientY-f;l.moved=t*t+n*n>p}l.event(e).zoom("mouse",o(v(l.that.__zoom,l.mouse[0]=Mw(e,a),l.mouse[1]),l.extent,c))}),!0).on("mouseup.zoom",(function(e){u.on("mousemove.zoom mouseup.zoom",null),Ew(e.view,l.moved),MS(e),l.event(e).end()}),!0),h=Mw(e,a),d=e.clientX,f=e.clientY;ww(e.view),CS(e),l.mouse=[h,this.__zoom.invert(h)],Jw(this),l.start()}}function E(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(i.apply(this,arguments)){var a=this.__zoom,l=Mw(e.changedTouches?e.changedTouches[0]:e,this),h=a.invert(l),d=a.k*(e.shiftKey?.5:2),p=o(v(g(a,d),l,h),r.apply(this,n),c);MS(e),u>0?dw(this).transition().duration(u).call(A,p,l,e):dw(this).call(m.transform,p,l,e)}}function S(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];if(i.apply(this,arguments)){var a,l,c,u,h=n.touches,d=h.length,p=x(this,o,n.changedTouches.length===d).event(n);for(CS(n),l=0;l<d;++l)u=[u=Mw(c=h[l],this),this.__zoom.invert(u),c.identifier],p.touch0?p.touch1||p.touch0[2]===u[2]||(p.touch1=u,p.taps=0):(p.touch0=u,a=!0,p.taps=1+!!e);e&&(e=clearTimeout(e)),a&&(p.taps<2&&(t=u[0],e=setTimeout((function(){e=null}),500)),Jw(this),p.start())}}function C(e){if(this.__zooming){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r,s,a,l,u=x(this,n).event(e),h=e.changedTouches,d=h.length;for(MS(e),r=0;r<d;++r)a=Mw(s=h[r],this),u.touch0&&u.touch0[2]===s.identifier?u.touch0[0]=a:u.touch1&&u.touch1[2]===s.identifier&&(u.touch1[0]=a);if(s=u.that.__zoom,u.touch1){var p=u.touch0[0],f=u.touch0[1],m=u.touch1[0],y=u.touch1[1],A=(A=m[0]-p[0])*A+(A=m[1]-p[1])*A,b=(b=y[0]-f[0])*b+(b=y[1]-f[1])*b;s=g(s,Math.sqrt(A/b)),a=[(p[0]+m[0])/2,(p[1]+m[1])/2],l=[(f[0]+y[0])/2,(f[1]+y[1])/2]}else{if(!u.touch0)return;a=u.touch0[0],l=u.touch0[1]}u.zoom("touch",o(v(s,a,l),u.extent,c))}}function M(e){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];if(this.__zooming){var s,a,l=x(this,r).event(e),c=e.changedTouches,u=c.length;for(CS(e),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),s=0;s<u;++s)a=c[s],l.touch0&&l.touch0[2]===a.identifier?delete l.touch0:l.touch1&&l.touch1[2]===a.identifier&&delete l.touch1;if(l.touch1&&!l.touch0&&(l.touch0=l.touch1,delete l.touch1),l.touch0)l.touch0[1]=this.__zoom.invert(l.touch0[0]);else if(l.end(),2===l.taps&&(a=Mw(a,this),Math.hypot(t[0]-a[0],t[1]-a[1])<f)){var h=dw(this).on("dblclick.zoom");h&&h.apply(this,arguments)}}}return m.transform=function(e,t,n,i){var r=e.selection?e.selection():e;r.property("__zoom",IS),e!==r?A(e,t,n,i):r.interrupt().each((function(){x(this,arguments).event(i).start().zoom(null,"function"===typeof t?t.apply(this,arguments):t).end()}))},m.scaleBy=function(e,t,n,i){m.scaleTo(e,(function(){return this.__zoom.k*("function"===typeof t?t.apply(this,arguments):t)}),n,i)},m.scaleTo=function(e,t,n,i){m.transform(e,(function(){var e=r.apply(this,arguments),i=this.__zoom,s=null==n?y(e):"function"===typeof n?n.apply(this,arguments):n,a=i.invert(s),l="function"===typeof t?t.apply(this,arguments):t;return o(v(g(i,l),s,a),e,c)}),n,i)},m.translateBy=function(e,t,n,i){m.transform(e,(function(){return o(this.__zoom.translate("function"===typeof t?t.apply(this,arguments):t,"function"===typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,i)},m.translateTo=function(e,t,n,i,s){m.transform(e,(function(){var e=r.apply(this,arguments),s=this.__zoom,a=null==i?y(e):"function"===typeof i?i.apply(this,arguments):i;return o(ES.translate(a[0],a[1]).scale(s.k).translate("function"===typeof t?-t.apply(this,arguments):-t,"function"===typeof n?-n.apply(this,arguments):-n),e,c)}),i,s)},b.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=dw(this.that).datum();d.call(e,this.that,new _S(e,{sourceEvent:this.sourceEvent,target:m,type:e,transform:this.that.__zoom,dispatch:d}),t)}},m.wheelDelta=function(e){return arguments.length?(s="function"===typeof e?e:bS(+e),m):s},m.filter=function(e){return arguments.length?(i="function"===typeof e?e:bS(!!e),m):i},m.touchable=function(e){return arguments.length?(a="function"===typeof e?e:bS(!!e),m):a},m.extent=function(e){return arguments.length?(r="function"===typeof e?e:bS([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):r},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(e){return arguments.length?(o=e,m):o},m.duration=function(e){return arguments.length?(u=+e,m):u},m.interpolate=function(e){return arguments.length?(h=e,m):h},m.on=function(){var e=d.on.apply(d,arguments);return e===d?m:e},m.clickDistance=function(e){return arguments.length?(p=(e=+e)*e,m):Math.sqrt(p)},m.tapDistance=function(e){return arguments.length?(f=+e,m):f},m}SS.prototype=wS.prototype;var DS=Object.prototype.hasOwnProperty;function kS(e,t){var n,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((i=e.length)===t.length)for(;i--&&kS(e[i],t[i]););return-1===i}if(!n||"object"===typeof e){for(n in i=0,e){if(DS.call(e,n)&&++i&&!DS.call(t,n))return!1;if(!(n in t)||!kS(e[n],t[n]))return!1}return Object.keys(t).length===i}}return e!==e&&t!==t}var OS,US=i(224),FS=new Uint8Array(16);function zS(){if(!OS&&!(OS="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return OS(FS)}const jS=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const VS=function(e){return"string"===typeof e&&jS.test(e)};for(var GS=[],HS=0;HS<256;++HS)GS.push((HS+256).toString(16).substr(1));const WS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(GS[e[t+0]]+GS[e[t+1]]+GS[e[t+2]]+GS[e[t+3]]+"-"+GS[e[t+4]]+GS[e[t+5]]+"-"+GS[e[t+6]]+GS[e[t+7]]+"-"+GS[e[t+8]]+GS[e[t+9]]+"-"+GS[e[t+10]]+GS[e[t+11]]+GS[e[t+12]]+GS[e[t+13]]+GS[e[t+14]]+GS[e[t+15]]).toLowerCase();if(!VS(n))throw TypeError("Stringified UUID is invalid");return n};const QS=function(e,t,n){var i=(e=e||{}).random||(e.rng||zS)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return WS(i)};var qS=i(1509);const XS=e=>e.enableLegacyTransitions?s.createElement(qS.TransitionGroup,{component:e.component,className:e.className,transform:e.transform},e.children):s.createElement("g",{className:e.className,transform:e.transform},e.children),$S={textAnchor:"start",x:40},YS={x:40,dy:"1.2em"},KS=e=>{let{nodeDatum:t,toggleNode:n,onNodeClick:i,onNodeMouseOver:r,onNodeMouseOut:o}=e;return s.createElement(s.Fragment,null,s.createElement("circle",{r:15,onClick:e=>{n(),i(e)},onMouseOver:r,onMouseOut:o}),s.createElement("g",{className:"rd3t-label"},s.createElement("text",Object.assign({className:"rd3t-label__title"},$S),t.name),s.createElement("text",{className:"rd3t-label__attributes"},t.attributes&&Object.entries(t.attributes).map(((e,t)=>{let[n,i]=e;return s.createElement("tspan",Object.assign({key:`${n}-${t}`},YS),n,": ","boolean"===typeof i?i.toString():i)})))))};class JS extends s.Component{constructor(){super(...arguments),this.nodeRef=null,this.state={transform:this.setTransform(this.props.position,this.props.parent,this.props.orientation,!0),initialStyle:{opacity:0},wasClicked:!1},this.shouldNodeTransform=(e,t,n,i)=>t.subscriptions!==e.subscriptions||t.position.x!==e.position.x||t.position.y!==e.position.y||t.orientation!==e.orientation||i.wasClicked!==n.wasClicked,this.renderNodeElement=()=>{const{data:e,hierarchyPointNode:t,renderCustomNodeElement:n}=this.props;return("function"===typeof n?n:KS)({hierarchyPointNode:t,nodeDatum:e,toggleNode:this.handleNodeToggle,onNodeClick:this.handleOnClick,onNodeMouseOver:this.handleOnMouseOver,onNodeMouseOut:this.handleOnMouseOut,addChildren:this.handleAddChildren})},this.handleNodeToggle=()=>{this.setState({wasClicked:!0}),this.props.onNodeToggle(this.props.data.__rd3t.id)},this.handleOnClick=e=>{this.setState({wasClicked:!0}),this.props.onNodeClick(this.props.hierarchyPointNode,e)},this.handleOnMouseOver=e=>{this.props.onNodeMouseOver(this.props.hierarchyPointNode,e)},this.handleOnMouseOut=e=>{this.props.onNodeMouseOut(this.props.hierarchyPointNode,e)},this.handleAddChildren=e=>{this.props.handleAddChildrenToNode(this.props.data.__rd3t.id,e)}}componentDidMount(){this.commitTransform()}componentDidUpdate(){this.state.wasClicked&&(this.props.centerNode(this.props.hierarchyPointNode),this.setState({wasClicked:!1})),this.commitTransform()}shouldComponentUpdate(e,t){return this.shouldNodeTransform(this.props,e,this.state,t)}setTransform(e,t,n){if(arguments.length>3&&void 0!==arguments[3]&&arguments[3]){const e=null!==t&&void 0!==t,i=e?t.x:0,r=e?t.y:0;return"horizontal"===n?`translate(${r},${i})`:`translate(${i},${r})`}return"horizontal"===n?`translate(${e.y},${e.x})`:`translate(${e.x},${e.y})`}applyTransform(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};this.props.enableLegacyTransitions?dw(this.nodeRef).transition().duration(t).attr("transform",e).style("opacity",n).on("end",i):(dw(this.nodeRef).attr("transform",e).style("opacity",n),i())}commitTransform(){const{orientation:e,transitionDuration:t,position:n,parent:i}=this.props,r=this.setTransform(n,i,e);this.applyTransform(r,t)}componentWillLeave(e){const{orientation:t,transitionDuration:n,position:i,parent:r}=this.props,o=this.setTransform(i,r,t,!0);this.applyTransform(o,n,0,e)}render(){const{data:e,nodeClassName:t}=this.props;return s.createElement("g",{id:e.__rd3t.id,ref:e=>{this.nodeRef=e},style:this.state.initialStyle,className:[e.children&&e.children.length>0?"rd3t-node":"rd3t-leaf-node",t].join(" ").trim(),transform:this.state.transform},this.renderNodeElement())}}var ZS=Math.PI,eC=2*ZS,tC=1e-6,nC=eC-tC;function iC(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function rC(){return new iC}iC.prototype=rC.prototype={constructor:iC,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,o){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+o)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var o=this._x1,s=this._y1,a=n-e,l=i-t,c=o-e,u=s-t,h=c*c+u*u;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(h>tC)if(Math.abs(u*a-l*c)>tC&&r){var d=n-o,p=i-s,f=a*a+l*l,m=d*d+p*p,g=Math.sqrt(f),v=Math.sqrt(h),y=r*Math.tan((ZS-Math.acos((f+h-m)/(2*g*v)))/2),A=y/v,x=y/g;Math.abs(A-1)>tC&&(this._+="L"+(e+A*c)+","+(t+A*u)),this._+="A"+r+","+r+",0,0,"+ +(u*d>c*p)+","+(this._x1=e+x*a)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,i,r,o){e=+e,t=+t,o=!!o;var s=(n=+n)*Math.cos(i),a=n*Math.sin(i),l=e+s,c=t+a,u=1^o,h=o?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>tC||Math.abs(this._y1-c)>tC)&&(this._+="L"+l+","+c),n&&(h<0&&(h=h%eC+eC),h>nC?this._+="A"+n+","+n+",0,1,"+u+","+(e-s)+","+(t-a)+"A"+n+","+n+",0,1,"+u+","+(this._x1=l)+","+(this._y1=c):h>tC&&(this._+="A"+n+","+n+",0,"+ +(h>=ZS)+","+u+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};const oC=rC;var sC=Array.prototype.slice;function aC(e){return function(){return e}}function lC(e){return e[0]}function cC(e){return e[1]}function uC(e){return e.source}function hC(e){return e.target}function dC(e){var t=uC,n=hC,i=lC,r=cC,o=null;function s(){var s,a=sC.call(arguments),l=t.apply(this,a),c=n.apply(this,a);if(o||(o=s=oC()),e(o,+i.apply(this,(a[0]=l,a)),+r.apply(this,a),+i.apply(this,(a[0]=c,a)),+r.apply(this,a)),s)return o=null,s+""||null}return s.source=function(e){return arguments.length?(t=e,s):t},s.target=function(e){return arguments.length?(n=e,s):n},s.x=function(e){return arguments.length?(i="function"===typeof e?e:aC(+e),s):i},s.y=function(e){return arguments.length?(r="function"===typeof e?e:aC(+e),s):r},s.context=function(e){return arguments.length?(o=null==e?null:e,s):o},s}function pC(e,t,n,i,r){e.moveTo(t,n),e.bezierCurveTo(t=(t+i)/2,n,t,r,i,r)}function fC(e,t,n,i,r){e.moveTo(t,n),e.bezierCurveTo(t,n=(n+r)/2,i,n,i,r)}class mC extends s.PureComponent{constructor(){super(...arguments),this.linkRef=null,this.state={initialStyle:{opacity:0}},this.handleOnClick=e=>{this.props.onClick(this.props.linkData.source,this.props.linkData.target,e)},this.handleOnMouseOver=e=>{this.props.onMouseOver(this.props.linkData.source,this.props.linkData.target,e)},this.handleOnMouseOut=e=>{this.props.onMouseOut(this.props.linkData.source,this.props.linkData.target,e)}}componentDidMount(){this.applyOpacity(1,this.props.transitionDuration)}componentWillLeave(e){this.applyOpacity(0,this.props.transitionDuration,e)}applyOpacity(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};this.props.enableLegacyTransitions?dw(this.linkRef).transition().duration(t).style("opacity",e).on("end",n):(dw(this.linkRef).style("opacity",e),n())}drawStepPath(e,t){const{source:n,target:i}=e,r=i.y-n.y;return"horizontal"===t?`M${n.y},${n.x} H${n.y+r/2} V${i.x} H${i.y}`:`M${n.x},${n.y} V${n.y+r/2} H${i.x} V${i.y}`}drawDiagonalPath(e,t){const{source:n,target:i}=e;return"horizontal"===t?dC(pC)({source:[n.y,n.x],target:[i.y,i.x]}):dC(fC)({source:[n.x,n.y],target:[i.x,i.y]})}drawStraightPath(e,t){const{source:n,target:i}=e;return"horizontal"===t?`M${n.y},${n.x}L${i.y},${i.x}`:`M${n.x},${n.y}L${i.x},${i.y}`}drawElbowPath(e,t){return"horizontal"===t?`M${e.source.y},${e.source.x}V${e.target.x}H${e.target.y}`:`M${e.source.x},${e.source.y}V${e.target.y}H${e.target.x}`}drawPath(){const{linkData:e,orientation:t,pathFunc:n}=this.props;return"function"===typeof n?n(e,t):"elbow"===n?this.drawElbowPath(e,t):"straight"===n?this.drawStraightPath(e,t):"step"===n?this.drawStepPath(e,t):this.drawDiagonalPath(e,t)}getClassNames(){const{linkData:e,orientation:t,pathClassFunc:n}=this.props,i=["rd3t-link"];return"function"===typeof n&&i.push(n(e,t)),i.join(" ").trim()}render(){const{linkData:e}=this.props;return s.createElement("path",{ref:e=>{this.linkRef=e},style:Object.assign({},this.state.initialStyle),className:this.getClassNames(),d:this.drawPath(),onClick:this.handleOnClick,onMouseOver:this.handleOnMouseOver,onMouseOut:this.handleOnMouseOut,"data-source-id":e.source.id,"data-target-id":e.target.id})}}class gC extends s.Component{constructor(){super(...arguments),this.state={dataRef:this.props.data,data:gC.assignInternalProperties(US(this.props.data)),d3:gC.calculateD3Geometry(this.props),isTransitioning:!1,isInitialRenderForDataset:!0,dataKey:this.props.dataKey},this.internalState={targetNode:null,isTransitioning:!1},this.svgInstanceRef=`rd3t-svg-${QS()}`,this.gInstanceRef=`rd3t-g-${QS()}`,this.handleNodeToggle=e=>{const t=US(this.state.data),n=this.findNodesById(e,t,[])[0];this.props.collapsible&&!this.state.isTransitioning&&(n.__rd3t.collapsed?(gC.expandNode(n),this.props.shouldCollapseNeighborNodes&&this.collapseNeighborNodes(n,t)):gC.collapseNode(n),this.props.enableLegacyTransitions?(this.setState({data:t,isTransitioning:!0}),setTimeout((()=>this.setState({isTransitioning:!1})),this.props.transitionDuration+10)):this.setState({data:t}),this.internalState.targetNode=n)},this.handleAddChildrenToNode=(e,t)=>{const n=US(this.state.data),i=this.findNodesById(e,n,[]);if(i.length>0){const e=i[0],r=e.__rd3t.depth,o=US(t).map((e=>gC.assignInternalProperties([e],r+1)));e.children.push(...o.flat()),this.setState({data:n})}},this.handleOnNodeClickCb=(e,t)=>{const{onNodeClick:n}=this.props;n&&"function"===typeof n&&(t.persist(),n(US(e),t))},this.handleOnLinkClickCb=(e,t,n)=>{const{onLinkClick:i}=this.props;i&&"function"===typeof i&&(n.persist(),i(US(e),US(t),n))},this.handleOnNodeMouseOverCb=(e,t)=>{const{onNodeMouseOver:n}=this.props;n&&"function"===typeof n&&(t.persist(),n(US(e),t))},this.handleOnLinkMouseOverCb=(e,t,n)=>{const{onLinkMouseOver:i}=this.props;i&&"function"===typeof i&&(n.persist(),i(US(e),US(t),n))},this.handleOnNodeMouseOutCb=(e,t)=>{const{onNodeMouseOut:n}=this.props;n&&"function"===typeof n&&(t.persist(),n(US(e),t))},this.handleOnLinkMouseOutCb=(e,t,n)=>{const{onLinkMouseOut:i}=this.props;i&&"function"===typeof i&&(n.persist(),i(US(e),US(t),n))},this.centerNode=e=>{const{dimensions:t,orientation:n,zoom:i,centeringTransitionDuration:r}=this.props;if(t){const o=dw(`.${this.gInstanceRef}`),s=dw(`.${this.svgInstanceRef}`),a=this.state.d3.scale;let l,c;"horizontal"===n?(c=-e.x*a+t.height/2,l=-e.y*a+t.width/2):(l=-e.x*a+t.width/2,c=-e.y*a+t.height/2),o.transition().duration(r).attr("transform","translate("+l+","+c+")scale("+a+")"),s.call(NS().transform,ES.translate(l,c).scale(i))}},this.getNodeClassName=(e,t)=>{const{rootNodeClassName:n,branchNodeClassName:i,leafNodeClassName:r}=this.props;return null!==e&&void 0!==e?t.children?i:r:n}}static getDerivedStateFromProps(e,t){let n=null;const i=!e.dataKey||t.dataKey!==e.dataKey;e.data!==t.dataRef&&i&&(n={dataRef:e.data,data:gC.assignInternalProperties(US(e.data)),isInitialRenderForDataset:!0,dataKey:e.dataKey});const r=gC.calculateD3Geometry(e);return kS(r,t.d3)||(n=n||{},n.d3=r),n}componentDidMount(){this.bindZoomListener(this.props),this.setState({isInitialRenderForDataset:!1})}componentDidUpdate(e){this.props.data!==e.data&&this.setState({isInitialRenderForDataset:!1}),kS(this.props.translate,e.translate)&&kS(this.props.scaleExtent,e.scaleExtent)&&this.props.zoomable===e.zoomable&&this.props.draggable===e.draggable&&this.props.zoom===e.zoom&&this.props.enableLegacyTransitions===e.enableLegacyTransitions||this.bindZoomListener(this.props),"function"===typeof this.props.onUpdate&&this.props.onUpdate({node:this.internalState.targetNode?US(this.internalState.targetNode):null,zoom:this.state.d3.scale,translate:this.state.d3.translate}),this.internalState.targetNode=null}setInitialTreeDepth(e,t){e.forEach((e=>{e.data.__rd3t.collapsed=e.depth>=t}))}bindZoomListener(e){const{zoomable:t,scaleExtent:n,translate:i,zoom:r,onUpdate:o,hasInteractiveNodes:s}=e,a=dw(`.${this.svgInstanceRef}`),l=dw(`.${this.gInstanceRef}`);a.call(NS().transform,ES.translate(i.x,i.y).scale(r)),a.call(NS().scaleExtent(t?[n.min,n.max]:[r,r]).filter((e=>!s||(e.target.classList.contains(this.svgInstanceRef)||e.target.classList.contains(this.gInstanceRef)||e.shiftKey))).on("zoom",(e=>{!this.props.draggable&&["mousemove","touchmove","dblclick"].includes(e.sourceEvent.type)||(l.attr("transform",e.transform),"function"===typeof o&&(o({node:null,zoom:e.transform.k,translate:{x:e.transform.x,y:e.transform.y}}),this.state.d3.scale=e.transform.k,this.state.d3.translate={x:e.transform.x,y:e.transform.y}))})))}static assignInternalProperties(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(Array.isArray(e)?e:[e]).map((e=>{const n=e;return n.__rd3t={id:null,depth:null,collapsed:!1},n.__rd3t.id=QS(),n.__rd3t.depth=t,n.children&&n.children.length>0&&(n.children=gC.assignInternalProperties(n.children,t+1)),n}))}findNodesById(e,t,n){return n.length>0||(n=n.concat(t.filter((t=>t.__rd3t.id===e))),t.forEach((t=>{t.children&&t.children.length>0&&(n=this.findNodesById(e,t.children,n))}))),n}findNodesAtDepth(e,t,n){return n=n.concat(t.filter((t=>t.__rd3t.depth===e))),t.forEach((t=>{t.children&&t.children.length>0&&(n=this.findNodesAtDepth(e,t.children,n))})),n}static collapseNode(e){e.__rd3t.collapsed=!0,e.children&&e.children.length>0&&e.children.forEach((e=>{gC.collapseNode(e)}))}static expandNode(e){e.__rd3t.collapsed=!1}collapseNeighborNodes(e,t){this.findNodesAtDepth(e.__rd3t.depth,t,[]).filter((t=>t.__rd3t.id!==e.__rd3t.id)).forEach((e=>gC.collapseNode(e)))}generateTree(){const{initialDepth:e,depthFactor:t,separation:n,nodeSize:i,orientation:r}=this.props,{isInitialRenderForDataset:o}=this.state,s=Jb().nodeSize("horizontal"===r?[i.y,i.x]:[i.x,i.y]).separation(((e,t)=>e.parent.data.__rd3t.id===t.parent.data.__rd3t.id?n.siblings:n.nonSiblings))(jb(this.state.data[0],(e=>e.__rd3t.collapsed?null:e.children)));let a=s.descendants();const l=s.links();return void 0!==e&&o&&this.setInitialTreeDepth(a,e),t&&a.forEach((e=>{e.y=e.depth*t})),{nodes:a,links:l}}static calculateD3Geometry(e){let t;return t=e.zoom>e.scaleExtent.max?e.scaleExtent.max:e.zoom<e.scaleExtent.min?e.scaleExtent.min:e.zoom,{translate:e.translate,scale:t}}render(){const{nodes:e,links:t}=this.generateTree(),{renderCustomNodeElement:n,orientation:i,pathFunc:r,transitionDuration:o,nodeSize:a,depthFactor:l,initialDepth:c,separation:u,enableLegacyTransitions:h,svgClassName:d,pathClassFunc:p}=this.props,{translate:f,scale:m}=this.state.d3,g=Object.assign(Object.assign(Object.assign({},a),u),{depthFactor:l,initialDepth:c});return s.createElement("div",{className:"rd3t-tree-container rd3t-grabbable"},s.createElement("style",null,"\n/* Tree */\n.rd3t-tree-container {\n  width: 100%;\n  height: 100%;\n}\n\n.rd3t-grabbable {\n  cursor: move; /* fallback if grab cursor is unsupported */\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n.rd3t-grabbable:active {\n    cursor: grabbing;\n    cursor: -moz-grabbing;\n    cursor: -webkit-grabbing;\n}\n\n/* Node */\n.rd3t-node {\n  cursor: pointer;\n  fill: #777;\n  stroke: #000;\n  stroke-width: 2;\n}\n\n.rd3t-leaf-node {\n  cursor: pointer;\n  fill: transparent;\n  stroke: #000;\n  stroke-width: 1;\n}\n\n.rd3t-label__title {\n  fill: #000;\n  stroke: none;\n  font-weight: bolder;\n}\n\n.rd3t-label__attributes {\n  fill: #777;\n  stroke: none;\n  font-weight: bolder;\n  font-size: smaller;\n}\n\n/* Link */\n.rd3t-link {\n  fill: none;\n  stroke: #000;\n}\n"),s.createElement("svg",{className:`rd3t-svg ${this.svgInstanceRef} ${d}`,width:"100%",height:"100%"},s.createElement(XS,{enableLegacyTransitions:h,component:"g",className:`rd3t-g ${this.gInstanceRef}`,transform:`translate(${f.x},${f.y}) scale(${m})`},t.map(((e,t)=>s.createElement(mC,{key:"link-"+t,orientation:i,pathFunc:r,pathClassFunc:p,linkData:e,onClick:this.handleOnLinkClickCb,onMouseOver:this.handleOnLinkMouseOverCb,onMouseOut:this.handleOnLinkMouseOutCb,enableLegacyTransitions:h,transitionDuration:o}))),e.map(((e,t)=>{const{data:r,x:l,y:c,parent:u}=e;return s.createElement(JS,{key:"node-"+t,data:r,position:{x:l,y:c},hierarchyPointNode:e,parent:u,nodeClassName:this.getNodeClassName(u,r),renderCustomNodeElement:n,nodeSize:a,orientation:i,enableLegacyTransitions:h,transitionDuration:o,onNodeToggle:this.handleNodeToggle,onNodeClick:this.handleOnNodeClickCb,onNodeMouseOver:this.handleOnNodeMouseOverCb,onNodeMouseOut:this.handleOnNodeMouseOutCb,handleAddChildrenToNode:this.handleAddChildrenToNode,subscriptions:g,centerNode:this.centerNode})})))))}}gC.defaultProps={onNodeClick:void 0,onNodeMouseOver:void 0,onNodeMouseOut:void 0,onLinkClick:void 0,onLinkMouseOver:void 0,onLinkMouseOut:void 0,onUpdate:void 0,orientation:"horizontal",translate:{x:0,y:0},pathFunc:"diagonal",pathClassFunc:void 0,transitionDuration:500,depthFactor:void 0,collapsible:!0,initialDepth:void 0,zoomable:!0,draggable:!0,zoom:1,scaleExtent:{min:.1,max:1},nodeSize:{x:140,y:140},separation:{siblings:1,nonSiblings:2},shouldCollapseNeighborNodes:!1,svgClassName:"",rootNodeClassName:"",branchNodeClassName:"",leafNodeClassName:"",renderCustomNodeElement:void 0,enableLegacyTransitions:!1,hasInteractiveNodes:!1,dimensions:void 0,centeringTransitionDuration:800,dataKey:void 0};function vC(e,t,n){return t=function(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||xC(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AC(e){return function(e){if(Array.isArray(e))return bC(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||xC(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xC(e,t){if(e){if("string"===typeof e)return bC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bC(e,t):void 0}}function bC(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function wC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||SC(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function EC(e){return function(e){if(Array.isArray(e))return _C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||SC(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SC(e,t){if(e){if("string"==typeof e)return _C(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_C(e,t):void 0}}function CC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.wrapperElementType,i=void 0===n?"div":n,r=t.nodeMapper,o=void 0===r?function(e){return e}:r,a=t.methodNames,l=void 0===a?[]:a,c=t.initPropNames,u=void 0===c?[]:c;return(0,s.forwardRef)((function(t,n){var r=(0,s.useRef)(),a=(0,s.useMemo)((function(){var n=Object.fromEntries(u.filter((function(e){return t.hasOwnProperty(e)})).map((function(e){return[e,t[e]]})));return e(n)}),[]);MC((function(){a(o(r.current))}),s.useLayoutEffect),MC((function(){return a._destructor instanceof Function?a._destructor:void 0}));var c=(0,s.useCallback)((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return a[e]instanceof Function?a[e].apply(a,n):void 0}),[a]),h=(0,s.useRef)({});return Object.keys(function(e,t){var n=new Set(t);return Object.assign.apply(Object,[{}].concat(AC(Object.entries(e).filter((function(e){var t=yC(e,1)[0];return!n.has(t)})).map((function(e){var t=yC(e,2);return vC({},t[0],t[1])})))))}(t,[].concat(EC(l),EC(u)))).filter((function(e){return h.current[e]!==t[e]})).forEach((function(e){return c(e,t[e])})),h.current=t,(0,s.useImperativeHandle)(n,(function(){return Object.fromEntries(l.map((function(e){return[e,function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return c.apply(void 0,[e].concat(n))}]})))}),[c]),s.createElement(i,{ref:r})}))}function MC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.useEffect,n=(0,s.useRef)(),i=(0,s.useRef)(!1),r=(0,s.useRef)(!1),o=wC((0,s.useState)(0),2);o[0];var a=o[1];i.current&&(r.current=!0),t((function(){return i.current||(n.current=e(),i.current=!0),a((function(e){return e+1})),function(){r.current&&n.current&&n.current()}}),[])}const TC="173",RC={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},IC={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},PC=0,BC=1,LC=2,NC=3,DC=0,kC=1,OC=2,UC=3,FC=0,zC=1,jC=2,VC=0,GC=1,HC=2,WC=3,QC=4,qC=5,XC=100,$C=101,YC=102,KC=103,JC=104,ZC=200,eM=201,tM=202,nM=203,iM=204,rM=205,oM=206,sM=207,aM=208,lM=209,cM=210,uM=211,hM=212,dM=213,pM=214,fM=0,mM=1,gM=2,vM=3,yM=4,AM=5,xM=6,bM=7,_M=0,wM=1,EM=2,SM=0,CM=1,MM=2,TM=3,RM=4,IM=5,PM=6,BM=7,LM="attached",NM="detached",DM=300,kM=301,OM=302,UM=303,FM=304,zM=306,jM=1e3,VM=1001,GM=1002,HM=1003,WM=1004,QM=1004,qM=1005,XM=1005,$M=1006,YM=1007,KM=1007,JM=1008,ZM=1008,eT=1009,tT=1010,nT=1011,iT=1012,rT=1013,oT=1014,sT=1015,aT=1016,lT=1017,cT=1018,uT=1020,hT=35902,dT=1021,pT=1022,fT=1023,mT=1024,gT=1025,vT=1026,yT=1027,AT=1028,xT=1029,bT=1030,_T=1031,wT=1032,ET=1033,ST=33776,CT=33777,MT=33778,TT=33779,RT=35840,IT=35841,PT=35842,BT=35843,LT=36196,NT=37492,DT=37496,kT=37808,OT=37809,UT=37810,FT=37811,zT=37812,jT=37813,VT=37814,GT=37815,HT=37816,WT=37817,QT=37818,qT=37819,XT=37820,$T=37821,YT=36492,KT=36494,JT=36495,ZT=36283,eR=36284,tR=36285,nR=36286,iR=2200,rR=2201,oR=2202,sR=2300,aR=2301,lR=2302,cR=2400,uR=2401,hR=2402,dR=2500,pR=2501,fR=0,mR=1,gR=2,vR=3200,yR=3201,AR=3202,xR=3203,bR=0,_R=1,wR="",ER="srgb",SR="srgb-linear",CR="linear",MR="srgb",TR=0,RR=7680,IR=7681,PR=7682,BR=7683,LR=34055,NR=34056,DR=5386,kR=512,OR=513,UR=514,FR=515,zR=516,jR=517,VR=518,GR=519,HR=512,WR=513,QR=514,qR=515,XR=516,$R=517,YR=518,KR=519,JR=35044,ZR=35048,eI=35040,tI=35045,nI=35049,iI=35041,rI=35046,oI=35050,sI=35042,aI="100",lI="300 es",cI=2e3,uI=2001,hI={COMPUTE:"compute",RENDER:"render"};class dI{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const i=n[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,i=t.length;n<i;n++)t[n].call(this,e);e.target=null}}}const pI=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let fI=1234567;const mI=Math.PI/180,gI=180/Math.PI;function vI(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(pI[255&e]+pI[e>>8&255]+pI[e>>16&255]+pI[e>>24&255]+"-"+pI[255&t]+pI[t>>8&255]+"-"+pI[t>>16&15|64]+pI[t>>24&255]+"-"+pI[63&n|128]+pI[n>>8&255]+"-"+pI[n>>16&255]+pI[n>>24&255]+pI[255&i]+pI[i>>8&255]+pI[i>>16&255]+pI[i>>24&255]).toLowerCase()}function yI(e,t,n){return Math.max(t,Math.min(n,e))}function AI(e,t){return(e%t+t)%t}function xI(e,t,n){return(1-n)*e+n*t}function bI(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function _I(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const wI={DEG2RAD:mI,RAD2DEG:gI,generateUUID:vI,clamp:yI,euclideanModulo:AI,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:xI,damp:function(e,t,n,i){return xI(e,t,1-Math.exp(-n*i))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(AI(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(fI=e);let t=fI+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*mI},radToDeg:function(e){return e*gI},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+i)/2),u=s((t+i)/2),h=o((t-i)/2),d=s((t-i)/2),p=o((i-t)/2),f=s((i-t)/2);switch(r){case"XYX":e.set(a*u,l*h,l*d,a*c);break;case"YZY":e.set(l*d,a*u,l*h,a*c);break;case"ZXZ":e.set(l*h,l*d,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:_I,denormalize:bI};class EI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;EI.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=yI(this.x,e.x,t.x),this.y=yI(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=yI(this.x,e,t),this.y=yI(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(yI(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(yI(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class SI{constructor(e,t,n,i,r,o,s,a,l){SI.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l)}set(e,t,n,i,r,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],A=i[7],x=i[2],b=i[5],_=i[8];return r[0]=o*f+s*v+a*x,r[3]=o*m+s*y+a*b,r[6]=o*g+s*A+a*_,r[1]=l*f+c*v+u*x,r[4]=l*m+c*y+u*b,r[7]=l*g+c*A+u*_,r[2]=h*f+d*v+p*x,r[5]=h*m+d*y+p*b,r[8]=h*g+d*A+p*_,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*r*c+n*s*a+i*r*l-i*o*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*r,d=l*r-o*a,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(s*n-i*o)*f,e[3]=h*f,e[4]=(c*t-i*a)*f,e[5]=(i*r-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,o,s){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-i*l,i*a,-i*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(CI.makeScale(e,t)),this}rotate(e){return this.premultiply(CI.makeRotation(-e)),this}translate(e,t){return this.premultiply(CI.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const CI=new SI;function MI(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const TI={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function RI(e,t){return new TI[e](t)}function II(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function PI(){const e=II("canvas");return e.style.display="block",e}const BI={};function LI(e){e in BI||(BI[e]=!0,console.warn(e))}const NI=(new SI).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),DI=(new SI).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function kI(){const e={enabled:!0,workingColorSpace:SR,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===MR&&(e.r=UI(e.r),e.g=UI(e.g),e.b=UI(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===MR&&(e.r=FI(e.r),e.g=FI(e.g),e.b=FI(e.b)),e):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===wR?CR:this.spaces[e].transfer},getLuminanceCoefficients:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return e.define({[SR]:{primaries:t,whitePoint:i,transfer:CR,toXYZ:NI,fromXYZ:DI,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:ER},outputColorSpaceConfig:{drawingBufferColorSpace:ER}},[ER]:{primaries:t,whitePoint:i,transfer:MR,toXYZ:NI,fromXYZ:DI,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:ER}}}),e}const OI=kI();function UI(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function FI(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let zI;class jI{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"===typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===zI&&(zI=II("canvas")),zI.width=e.width,zI.height=e.height;const n=zI.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=zI}return t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=II("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*UI(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*UI(t[e]/255)):t[e]=UI(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let VI=0;class GI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:VI++}),this.uuid=vI(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(HI(i[t].image)):e.push(HI(i[t]))}else e=HI(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function HI(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?jI.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let WI=0;class QI extends dI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:QI.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:QI.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:VM,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:VM,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$M,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:JM,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:fT,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:eT,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:QI.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:wR;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:WI++}),this.uuid=vI(),this.name="",this.source=new GI(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new EI(0,0),this.repeat=new EI(1,1),this.center=new EI(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new SI,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==DM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case jM:e.x=e.x-Math.floor(e.x);break;case VM:e.x=e.x<0?0:1;break;case GM:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case jM:e.y=e.y-Math.floor(e.y);break;case VM:e.y=e.y<0?0:1;break;case GM:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}QI.DEFAULT_IMAGE=null,QI.DEFAULT_MAPPING=DM,QI.DEFAULT_ANISOTROPY=1;class qI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;qI.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,y=(c+h)/4,A=(u+f)/4,x=(p+m)/4;return e>a&&e>v?e<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=A/n):a>v?a<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=y/i,r=x/i):v<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=A/r,i=x/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(u-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=yI(this.x,e.x,t.x),this.y=yI(this.y,e.y,t.y),this.z=yI(this.z,e.z,t.z),this.w=yI(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=yI(this.x,e,t),this.y=yI(this.y,e,t),this.z=yI(this.z,e,t),this.w=yI(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(yI(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class XI extends dI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new qI(0,0,e,t),this.scissorTest=!1,this.viewport=new qI(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:$M,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new QI(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let s=0;s<o;s++)this.textures[s]=r.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,i=e.textures.length;n<i;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new GI(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $I extends XI{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class YI extends QI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=HM,this.minFilter=HM,this.wrapR=VM,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class KI extends $I{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new YI(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class JI extends QI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=HM,this.minFilter=HM,this.wrapR=VM,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ZI extends $I{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new JI(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class eP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,o,s){let a=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[o+0],d=r[o+1],p=r[o+2],f=r[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),o=Math.atan2(r,t*n);e=Math.sin(e*o)/r,s=Math.sin(s*o)/r}const r=s*n;if(a=a*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,o){const s=n[i],a=n[i+1],l=n[i+2],c=n[i+3],u=r[o],h=r[o+1],d=r[o+2],p=r[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=e._x,i=e._y,r=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=a(n/2),d=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(r-l)*e,this._z=(o-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-i)/e,this._x=(r+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yI(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+i*l-r*a,this._y=i*c+o*a+r*s-n*l,this._z=r*c+o*l+n*a-i*s,this._w=o*c-n*s-i*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class tP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;tP.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(iP.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(iP.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=2*(o*i-s*n),c=2*(s*t-r*i),u=2*(r*n-o*t);return this.x=t+a*l+o*u-s*c,this.y=n+a*c+s*l-r*u,this.z=i+a*u+r*c-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=yI(this.x,e.x,t.x),this.y=yI(this.y,e.y,t.y),this.z=yI(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=yI(this.x,e,t),this.y=yI(this.y,e,t),this.z=yI(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(yI(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return nP.copy(this).projectOnVector(e),this.sub(nP)}reflect(e){return this.sub(nP.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(yI(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const nP=new tP,iP=new eP;class rP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(sP.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(sP.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=sP.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,sP):sP.fromBufferAttribute(i,t),sP.applyMatrix4(e.matrixWorld),this.expandByPoint(sP);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),aP.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),aP.copy(n.boundingBox)),aP.applyMatrix4(e.matrixWorld),this.union(aP)}const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,sP),sP.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(fP),mP.subVectors(this.max,fP),lP.subVectors(e.a,fP),cP.subVectors(e.b,fP),uP.subVectors(e.c,fP),hP.subVectors(cP,lP),dP.subVectors(uP,cP),pP.subVectors(lP,uP);let t=[0,-hP.z,hP.y,0,-dP.z,dP.y,0,-pP.z,pP.y,hP.z,0,-hP.x,dP.z,0,-dP.x,pP.z,0,-pP.x,-hP.y,hP.x,0,-dP.y,dP.x,0,-pP.y,pP.x,0];return!!yP(t,lP,cP,uP,mP)&&(t=[1,0,0,0,1,0,0,0,1],!!yP(t,lP,cP,uP,mP)&&(gP.crossVectors(hP,dP),t=[gP.x,gP.y,gP.z],yP(t,lP,cP,uP,mP)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,sP).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(sP).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(oP[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),oP[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),oP[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),oP[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),oP[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),oP[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),oP[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),oP[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(oP)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const oP=[new tP,new tP,new tP,new tP,new tP,new tP,new tP,new tP],sP=new tP,aP=new rP,lP=new tP,cP=new tP,uP=new tP,hP=new tP,dP=new tP,pP=new tP,fP=new tP,mP=new tP,gP=new tP,vP=new tP;function yP(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){vP.fromArray(e,o);const s=r.x*Math.abs(vP.x)+r.y*Math.abs(vP.y)+r.z*Math.abs(vP.z),a=t.dot(vP),l=n.dot(vP),c=i.dot(vP);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const AP=new rP,xP=new tP,bP=new tP;class _P{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):AP.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;xP.subVectors(e,this.center);const t=xP.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(xP,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(bP.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(xP.copy(e.center).add(bP)),this.expandByPoint(xP.copy(e.center).sub(bP))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const wP=new tP,EP=new tP,SP=new tP,CP=new tP,MP=new tP,TP=new tP,RP=new tP;class IP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,wP)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=wP.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(wP.copy(this.origin).addScaledVector(this.direction,t),wP.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){EP.copy(e).add(t).multiplyScalar(.5),SP.copy(t).sub(e).normalize(),CP.copy(this.origin).sub(EP);const r=.5*e.distanceTo(t),o=-this.direction.dot(SP),s=CP.dot(this.direction),a=-CP.dot(SP),l=CP.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),d=h*(h+2*a)+l):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),d=-u*u+h*(h+2*a)+l);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(EP).addScaledVector(SP,h),d}intersectSphere(e,t){wP.subVectors(e.center,this.origin);const n=wP.dot(this.direction),i=wP.dot(wP)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>i?null:((s>n||n!==n)&&(n=s),(a<i||i!==i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,wP)}intersectTriangle(e,t,n,i,r){MP.subVectors(t,e),TP.subVectors(n,e),RP.crossVectors(MP,TP);let o,s=this.direction.dot(RP);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}CP.subVectors(this.origin,e);const a=o*this.direction.dot(TP.crossVectors(CP,TP));if(a<0)return null;const l=o*this.direction.dot(MP.cross(CP));if(l<0)return null;if(a+l>s)return null;const c=-o*CP.dot(RP);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class PP{constructor(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){PP.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new PP).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/BP.setFromMatrixColumn(e,0).length(),r=1/BP.setFromMatrixColumn(e,1).length(),o=1/BP.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*a,t[2]=r-e*l,t[6]=i+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-o*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=o*c,t[9]=r-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,i=s*c,r=s*u;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=a*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=o*a,n=o*l,i=s*a,r=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=o*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(NP,e,DP)}lookAt(e,t,n){const i=this.elements;return UP.subVectors(e,t),0===UP.lengthSq()&&(UP.z=1),UP.normalize(),kP.crossVectors(n,UP),0===kP.lengthSq()&&(1===Math.abs(n.z)?UP.x+=1e-4:UP.z+=1e-4,UP.normalize(),kP.crossVectors(n,UP)),kP.normalize(),OP.crossVectors(UP,kP),i[0]=kP.x,i[4]=OP.x,i[8]=UP.x,i[1]=kP.y,i[5]=OP.y,i[9]=UP.y,i[2]=kP.z,i[6]=OP.z,i[10]=UP.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],A=n[11],x=n[15],b=i[0],_=i[4],w=i[8],E=i[12],S=i[1],C=i[5],M=i[9],T=i[13],R=i[2],I=i[6],P=i[10],B=i[14],L=i[3],N=i[7],D=i[11],k=i[15];return r[0]=o*b+s*S+a*R+l*L,r[4]=o*_+s*C+a*I+l*N,r[8]=o*w+s*M+a*P+l*D,r[12]=o*E+s*T+a*B+l*k,r[1]=c*b+u*S+h*R+d*L,r[5]=c*_+u*C+h*I+d*N,r[9]=c*w+u*M+h*P+d*D,r[13]=c*E+u*T+h*B+d*k,r[2]=p*b+f*S+m*R+g*L,r[6]=p*_+f*C+m*I+g*N,r[10]=p*w+f*M+m*P+g*D,r[14]=p*E+f*T+m*B+g*k,r[3]=v*b+y*S+A*R+x*L,r[7]=v*_+y*C+A*I+x*N,r[11]=v*w+y*M+A*P+x*D,r[15]=v*E+y*T+A*B+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*a*u-i*l*u-r*s*h+n*l*h+i*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+r*o*h-i*o*d+i*l*c-r*a*c)+e[11]*(+t*l*u-t*s*d-r*o*u+n*o*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*a*u+t*s*h+i*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,y=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,A=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*v+n*y+i*A+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/b;return e[0]=v*_,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*_,e[2]=(s*m*r-f*a*r+f*i*l-n*m*l-s*i*g+n*a*g)*_,e[3]=(u*a*r-s*h*r-u*i*l+n*h*l+s*i*d-n*a*d)*_,e[4]=y*_,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*_,e[6]=(p*a*r-o*m*r-p*i*l+t*m*l+o*i*g-t*a*g)*_,e[7]=(o*h*r-c*a*r+c*i*l-t*h*l-o*i*d+t*a*d)*_,e[8]=A*_,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*_,e[10]=(o*f*r-p*s*r+p*n*l-t*f*l-o*n*g+t*s*g)*_,e[11]=(c*s*r-o*u*r-c*n*l+t*u*l+o*n*d-t*s*d)*_,e[12]=x*_,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*_,e[14]=(p*s*i-o*f*i-p*n*a+t*f*a+o*n*m-t*s*m)*_,e[15]=(o*u*i-c*s*i+c*n*a-t*u*a-o*n*h+t*s*h)*_,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,c=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,c*s+n,c*a-i*o,0,l*a-i*s,c*a+i*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,o){return this.set(1,n,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,l=r+r,c=o+o,u=s+s,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,g=s*u,v=a*l,y=a*c,A=a*u,x=n.x,b=n.y,_=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+A)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-A)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(p+y)*_,i[9]=(m-v)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=BP.set(i[0],i[1],i[2]).length();const o=BP.set(i[4],i[5],i[6]).length(),s=BP.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],LP.copy(this);const a=1/r,l=1/o,c=1/s;return LP.elements[0]*=a,LP.elements[1]*=a,LP.elements[2]*=a,LP.elements[4]*=l,LP.elements[5]*=l,LP.elements[6]*=l,LP.elements[8]*=c,LP.elements[9]*=c,LP.elements[10]*=c,t.setFromRotationMatrix(LP),n.x=r,n.y=o,n.z=s,this}makePerspective(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:cI;const a=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(s===cI)d=-(o+r)/(o-r),p=-2*o*r/(o-r);else{if(s!==uI)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-o/(o-r),p=-o*r/(o-r)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,r,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:cI;const a=this.elements,l=1/(t-e),c=1/(n-i),u=1/(o-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(s===cI)p=(o+r)*u,f=-2*u;else{if(s!==uI)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const BP=new tP,LP=new PP,NP=new tP(0,0,0),DP=new tP(1,1,1),kP=new tP,OP=new tP,UP=new tP,FP=new PP,zP=new eP;class jP{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:jP.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=e.elements,r=i[0],o=i[4],s=i[8],a=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(yI(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-yI(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(yI(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-yI(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(yI(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-yI(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return FP.makeRotationFromQuaternion(e),this.setFromRotationMatrix(FP,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return zP.setFromEuler(this),this.setFromQuaternion(zP,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}jP.DEFAULT_ORDER="XYZ";class VP{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let GP=0;const HP=new tP,WP=new eP,QP=new PP,qP=new tP,XP=new tP,$P=new tP,YP=new eP,KP=new tP(1,0,0),JP=new tP(0,1,0),ZP=new tP(0,0,1),eB={type:"added"},tB={type:"removed"},nB={type:"childadded",child:null},iB={type:"childremoved",child:null};class rB extends dI{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:GP++}),this.uuid=vI(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=rB.DEFAULT_UP.clone();const e=new tP,t=new jP,n=new eP,i=new tP(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new PP},normalMatrix:{value:new SI}}),this.matrix=new PP,this.matrixWorld=new PP,this.matrixAutoUpdate=rB.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=rB.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new VP,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return WP.setFromAxisAngle(e,t),this.quaternion.multiply(WP),this}rotateOnWorldAxis(e,t){return WP.setFromAxisAngle(e,t),this.quaternion.premultiply(WP),this}rotateX(e){return this.rotateOnAxis(KP,e)}rotateY(e){return this.rotateOnAxis(JP,e)}rotateZ(e){return this.rotateOnAxis(ZP,e)}translateOnAxis(e,t){return HP.copy(e).applyQuaternion(this.quaternion),this.position.add(HP.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(KP,e)}translateY(e){return this.translateOnAxis(JP,e)}translateZ(e){return this.translateOnAxis(ZP,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(QP.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?qP.copy(e):qP.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),XP.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?QP.lookAt(XP,qP,this.up):QP.lookAt(qP,XP,this.up),this.quaternion.setFromRotationMatrix(QP),i&&(QP.extractRotation(i.matrixWorld),WP.setFromRotationMatrix(QP),this.quaternion.premultiply(WP.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(eB),nB.child=e,this.dispatchEvent(nB),nB.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tB),iB.child=e,this.dispatchEvent(iB),iB.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),QP.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),QP.multiply(e.parent.matrixWorld)),e.applyMatrix4(QP),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(eB),nB.child=e,this.dispatchEvent(nB),nB.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(XP,e,$P),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(XP,YP,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=o(e.geometries),i=o(e.materials),r=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}rB.DEFAULT_UP=new tP(0,1,0),rB.DEFAULT_MATRIX_AUTO_UPDATE=!0,rB.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const oB=new tP,sB=new tP,aB=new tP,lB=new tP,cB=new tP,uB=new tP,hB=new tP,dB=new tP,pB=new tP,fB=new tP,mB=new qI,gB=new qI,vB=new qI;class yB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tP;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),oB.subVectors(e,t),i.cross(oB);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){oB.subVectors(i,t),sB.subVectors(n,t),aB.subVectors(e,t);const o=oB.dot(oB),s=oB.dot(sB),a=oB.dot(aB),l=sB.dot(sB),c=sB.dot(aB),u=o*l-s*s;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,lB)&&(lB.x>=0&&lB.y>=0&&lB.x+lB.y<=1)}static getInterpolation(e,t,n,i,r,o,s,a){return null===this.getBarycoord(e,t,n,i,lB)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(r,lB.x),a.addScaledVector(o,lB.y),a.addScaledVector(s,lB.z),a)}static getInterpolatedAttribute(e,t,n,i,r,o){return mB.setScalar(0),gB.setScalar(0),vB.setScalar(0),mB.fromBufferAttribute(e,t),gB.fromBufferAttribute(e,n),vB.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(mB,r.x),o.addScaledVector(gB,r.y),o.addScaledVector(vB,r.z),o}static isFrontFacing(e,t,n,i){return oB.subVectors(n,t),sB.subVectors(e,t),oB.cross(sB).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return oB.subVectors(this.c,this.b),sB.subVectors(this.a,this.b),.5*oB.cross(sB).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yB.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yB.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return yB.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return yB.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yB.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let o,s;cB.subVectors(i,n),uB.subVectors(r,n),dB.subVectors(e,n);const a=cB.dot(dB),l=uB.dot(dB);if(a<=0&&l<=0)return t.copy(n);pB.subVectors(e,i);const c=cB.dot(pB),u=uB.dot(pB);if(c>=0&&u<=c)return t.copy(i);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(cB,o);fB.subVectors(e,r);const d=cB.dot(fB),p=uB.dot(fB);if(p>=0&&d<=p)return t.copy(r);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(uB,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return hB.subVectors(r,i),s=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(hB,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(cB,o).addScaledVector(uB,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const AB={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xB={h:0,s:0,l:0},bB={h:0,s:0,l:0};function _B(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class wB{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"===typeof t?this.setHex(t):"string"===typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ER;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,OI.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:OI.workingColorSpace;return this.r=e,this.g=t,this.b=n,OI.toWorkingColorSpace(this,i),this}setHSL(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:OI.workingColorSpace;if(e=AI(e,1),t=yI(t,0,1),n=yI(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=_B(r,i,e+1/3),this.g=_B(r,i,e),this.b=_B(r,i,e-1/3)}return OI.toWorkingColorSpace(this,i),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ER;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=t[1],s=t[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,n);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,n);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=t[1],r=i.length;if(3===r)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,n);if(6===r)return this.setHex(parseInt(i,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ER;const n=AB[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=UI(e.r),this.g=UI(e.g),this.b=UI(e.b),this}copyLinearToSRGB(e){return this.r=FI(e.r),this.g=FI(e.g),this.b=FI(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ER;return OI.fromWorkingColorSpace(EB.copy(this),e),65536*Math.round(yI(255*EB.r,0,255))+256*Math.round(yI(255*EB.g,0,255))+Math.round(yI(255*EB.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ER;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:OI.workingColorSpace;OI.fromWorkingColorSpace(EB.copy(this),t);const n=EB.r,i=EB.g,r=EB.b,o=Math.max(n,i,r),s=Math.min(n,i,r);let a,l;const c=(s+o)/2;if(s===o)a=0,l=0;else{const e=o-s;switch(l=c<=.5?e/(o+s):e/(2-o-s),o){case n:a=(i-r)/e+(i<r?6:0);break;case i:a=(r-n)/e+2;break;case r:a=(n-i)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:OI.workingColorSpace;return OI.fromWorkingColorSpace(EB.copy(this),t),e.r=EB.r,e.g=EB.g,e.b=EB.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ER;OI.fromWorkingColorSpace(EB.copy(this),e);const t=EB.r,n=EB.g,i=EB.b;return e!==ER?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(xB),this.setHSL(xB.h+e,xB.s+t,xB.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(xB),e.getHSL(bB);const n=xI(xB.h,bB.h,t),i=xI(xB.s,bB.s,t),r=xI(xB.l,bB.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const EB=new wB;wB.NAMES=AB;let SB=0;class CB extends dI{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:SB++}),this.uuid=vI(),this.name="",this.type="Material",this.blending=GC,this.side=FC,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=iM,this.blendDst=rM,this.blendEquation=XC,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new wB(0,0,0),this.blendAlpha=0,this.depthFunc=vM,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=GR,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=RR,this.stencilZFail=RR,this.stencilZPass=RR,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==GC&&(n.blending=this.blending),this.side!==FC&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==iM&&(n.blendSrc=this.blendSrc),this.blendDst!==rM&&(n.blendDst=this.blendDst),this.blendEquation!==XC&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==vM&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==GR&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==RR&&(n.stencilFail=this.stencilFail),this.stencilZFail!==RR&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==RR&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MB extends CB{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new wB(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new jP,this.combine=_M,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const TB=RB();function RB(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(i[l]=0,i[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(i[l]=1024>>-e-14,i[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(i[l]=e+15<<10,i[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(i[l]=31744,i[256|l]=64512,r[l]=24,r[256|l]=24):(i[l]=31744,i[256|l]=64512,r[l]=13,r[256|l]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,o[l]=e|t}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(a[l]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:o,exponentTable:s,offsetTable:a}}function IB(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=yI(e,-65504,65504),TB.floatView[0]=e;const t=TB.uint32View[0],n=t>>23&511;return TB.baseTable[n]+((8388607&t)>>TB.shiftTable[n])}function PB(e){const t=e>>10;return TB.uint32View[0]=TB.mantissaTable[TB.offsetTable[t]+(1023&e)]+TB.exponentTable[t],TB.floatView[0]}const BB={toHalfFloat:IB,fromHalfFloat:PB},LB=new tP,NB=new EI;let DB=0;class kB{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:DB++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=JR,this.updateRanges=[],this.gpuType=sT,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)NB.fromBufferAttribute(this,t),NB.applyMatrix3(e),this.setXY(t,NB.x,NB.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)LB.fromBufferAttribute(this,t),LB.applyMatrix3(e),this.setXYZ(t,LB.x,LB.y,LB.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)LB.fromBufferAttribute(this,t),LB.applyMatrix4(e),this.setXYZ(t,LB.x,LB.y,LB.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)LB.fromBufferAttribute(this,t),LB.applyNormalMatrix(e),this.setXYZ(t,LB.x,LB.y,LB.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)LB.fromBufferAttribute(this,t),LB.transformDirection(e),this.setXYZ(t,LB.x,LB.y,LB.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=bI(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=_I(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=bI(t,this.array)),t}setX(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=bI(t,this.array)),t}setY(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=bI(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=bI(t,this.array)),t}setW(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array),i=_I(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array),i=_I(i,this.array),r=_I(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==JR&&(e.usage=this.usage),e}}class OB extends kB{constructor(e,t,n){super(new Int8Array(e),t,n)}}class UB extends kB{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class FB extends kB{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class zB extends kB{constructor(e,t,n){super(new Int16Array(e),t,n)}}class jB extends kB{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class VB extends kB{constructor(e,t,n){super(new Int32Array(e),t,n)}}class GB extends kB{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class HB extends kB{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=PB(this.array[e*this.itemSize]);return this.normalized&&(t=bI(t,this.array)),t}setX(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize]=IB(t),this}getY(e){let t=PB(this.array[e*this.itemSize+1]);return this.normalized&&(t=bI(t,this.array)),t}setY(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize+1]=IB(t),this}getZ(e){let t=PB(this.array[e*this.itemSize+2]);return this.normalized&&(t=bI(t,this.array)),t}setZ(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize+2]=IB(t),this}getW(e){let t=PB(this.array[e*this.itemSize+3]);return this.normalized&&(t=bI(t,this.array)),t}setW(e,t){return this.normalized&&(t=_I(t,this.array)),this.array[e*this.itemSize+3]=IB(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array)),this.array[e+0]=IB(t),this.array[e+1]=IB(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array),i=_I(i,this.array)),this.array[e+0]=IB(t),this.array[e+1]=IB(n),this.array[e+2]=IB(i),this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array),i=_I(i,this.array),r=_I(r,this.array)),this.array[e+0]=IB(t),this.array[e+1]=IB(n),this.array[e+2]=IB(i),this.array[e+3]=IB(r),this}}class WB extends kB{constructor(e,t,n){super(new Float32Array(e),t,n)}}let QB=0;const qB=new PP,XB=new rB,$B=new tP,YB=new rP,KB=new rP,JB=new tP;class ZB extends dI{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:QB++}),this.uuid=vI(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(MI(e)?GB:jB)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new SI).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return qB.makeRotationFromQuaternion(e),this.applyMatrix4(qB),this}rotateX(e){return qB.makeRotationX(e),this.applyMatrix4(qB),this}rotateY(e){return qB.makeRotationY(e),this.applyMatrix4(qB),this}rotateZ(e){return qB.makeRotationZ(e),this.applyMatrix4(qB),this}translate(e,t,n){return qB.makeTranslation(e,t,n),this.applyMatrix4(qB),this}scale(e,t,n){return qB.makeScale(e,t,n),this.applyMatrix4(qB),this}lookAt(e){return XB.lookAt(e),XB.updateMatrix(),this.applyMatrix4(XB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($B).negate(),this.translate($B.x,$B.y,$B.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new WB(t,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const n=e[i];t.setXYZ(i,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new rP);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new tP(-1/0,-1/0,-1/0),new tP(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];YB.setFromBufferAttribute(e),this.morphTargetsRelative?(JB.addVectors(this.boundingBox.min,YB.min),this.boundingBox.expandByPoint(JB),JB.addVectors(this.boundingBox.max,YB.max),this.boundingBox.expandByPoint(JB)):(this.boundingBox.expandByPoint(YB.min),this.boundingBox.expandByPoint(YB.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new _P);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new tP,1/0);if(e){const n=this.boundingSphere.center;if(YB.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];KB.setFromBufferAttribute(n),this.morphTargetsRelative?(JB.addVectors(YB.min,KB.min),YB.expandByPoint(JB),JB.addVectors(YB.max,KB.max),YB.expandByPoint(JB)):(YB.expandByPoint(KB.min),YB.expandByPoint(KB.max))}YB.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)JB.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(JB));if(t)for(let r=0,o=t.length;r<o;r++){const o=t[r],s=this.morphTargetsRelative;for(let t=0,r=o.count;t<r;t++)JB.fromBufferAttribute(o,t),s&&($B.fromBufferAttribute(e,t),JB.add($B)),i=Math.max(i,n.distanceToSquared(JB))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new kB(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),s=[],a=[];for(let w=0;w<n.count;w++)s[w]=new tP,a[w]=new tP;const l=new tP,c=new tP,u=new tP,h=new EI,d=new EI,p=new EI,f=new tP,m=new tP;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const o=1/(d.x*p.y-p.x*d.y);isFinite(o)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(o),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(o),s[e].add(f),s[t].add(f),s[i].add(f),a[e].add(m),a[t].add(m),a[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let w=0,E=v.length;w<E;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const y=new tP,A=new tP,x=new tP,b=new tP;function _(e){x.fromBufferAttribute(i,e),b.copy(x);const t=s[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),A.crossVectors(b,t);const n=A.dot(a[e])<0?-1:1;o.setXYZW(e,y.x,y.y,y.z,n)}for(let w=0,E=v.length;w<E;++w){const t=v[w],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)_(e.getX(i+0)),_(e.getX(i+1)),_(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new kB(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new tP,r=new tP,o=new tP,s=new tP,a=new tP,l=new tP,c=new tP,u=new tP;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)JB.fromBufferAttribute(e,t),JB.normalize(),e.setXYZ(t,JB.x,JB.y,JB.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,o=new n.constructor(t.length*i);let s=0,a=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)o[a++]=n[s++]}return new kB(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ZB,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],o=r[s];for(let t=0,r=o.length;t<r;t++){const r=e(o[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const e=o[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const t=n[a];e.data.attributes[a]=t.toJSON(e.data)}const i={};let r=!1;for(const a in this.morphAttributes){const t=this.morphAttributes[a],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[a]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,c=o.length;l<c;l++){const e=o[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const eL=new PP,tL=new IP,nL=new _P,iL=new tP,rL=new tP,oL=new tP,sL=new tP,aL=new tP,lL=new tP,cL=new tP,uL=new tP;class hL extends rB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ZB,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new MB;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){lL.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],a=r[n];0!==i&&(aL.fromBufferAttribute(a,e),o?lL.addScaledVector(aL,i):lL.addScaledVector(aL.sub(t),i))}t.add(lL)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),nL.copy(n.boundingSphere),nL.applyMatrix4(r),tL.copy(e.ray).recast(e.near),!1===nL.containsPoint(tL.origin)){if(null===tL.intersectSphere(nL,iL))return;if(tL.origin.distanceToSquared(iL)>(e.far-e.near)**2)return}eL.copy(r).invert(),tL.copy(e.ray).applyMatrix4(eL),null!==n.boundingBox&&!1===tL.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,tL)}}_computeIntersections(e,t,n){let i;const r=this.geometry,o=this.material,s=r.index,a=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==s)if(Array.isArray(o))for(let p=0,f=h.length;p<f;p++){const r=h[p],a=o[r.materialIndex];for(let o=Math.max(r.start,d.start),h=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));o<h;o+=3){i=dL(this,a,e,n,l,c,u,s.getX(o),s.getX(o+1),s.getX(o+2)),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(s.count,d.start+d.count);r<a;r+=3){i=dL(this,o,e,n,l,c,u,s.getX(r),s.getX(r+1),s.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==a)if(Array.isArray(o))for(let p=0,f=h.length;p<f;p++){const r=h[p],s=o[r.materialIndex];for(let o=Math.max(r.start,d.start),h=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));o<h;o+=3){i=dL(this,s,e,n,l,c,u,o,o+1,o+2),i&&(i.faceIndex=Math.floor(o/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),s=Math.min(a.count,d.start+d.count);r<s;r+=3){i=dL(this,o,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function dL(e,t,n,i,r,o,s,a,l,c){e.getVertexPosition(a,rL),e.getVertexPosition(l,oL),e.getVertexPosition(c,sL);const u=function(e,t,n,i,r,o,s,a){let l;if(l=t.side===zC?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,t.side===FC,a),null===l)return null;uL.copy(a),uL.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(uL);return c<n.near||c>n.far?null:{distance:c,point:uL.clone(),object:e}}(e,t,n,i,rL,oL,sL,cL);if(u){const e=new tP;yB.getBarycoord(cL,rL,oL,sL,e),r&&(u.uv=yB.getInterpolatedAttribute(r,a,l,c,e,new EI)),o&&(u.uv1=yB.getInterpolatedAttribute(o,a,l,c,e,new EI)),s&&(u.normal=yB.getInterpolatedAttribute(s,a,l,c,e,new tP),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a:a,b:l,c:c,normal:new tP,materialIndex:0};yB.getNormal(rL,oL,sL,t.normal),u.face=t,u.barycoord=e}return u}class pL extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const s=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,o,p,f,m,g,v){const y=o/m,A=p/g,x=o/2,b=p/2,_=f/2,w=m+1,E=g+1;let S=0,C=0;const M=new tP;for(let s=0;s<E;s++){const o=s*A-b;for(let a=0;a<w;a++){const h=a*y-x;M[e]=h*i,M[t]=o*r,M[n]=_,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=f>0?1:-1,c.push(M.x,M.y,M.z),u.push(a/m),u.push(1-s/g),S+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){const t=h+e+w*s,n=h+e+w*(s+1),i=h+(e+1)+w*(s+1),r=h+(e+1)+w*s;a.push(t,n,r),a.push(n,i,r),C+=6}s.addGroup(d,C,v),d+=C,h+=S}p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,i,o,2),p("x","z","y",1,-1,e,n,-t,i,o,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new WB(l,3)),this.setAttribute("normal",new WB(c,3)),this.setAttribute("uv",new WB(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pL(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function fL(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][i]=null):t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function mL(e){const t={};for(let n=0;n<e.length;n++){const i=fL(e[n]);for(const e in i)t[e]=i[e]}return t}function gL(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:OI.workingColorSpace}const vL={clone:fL,merge:mL};class yL extends CB{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fL(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class AL extends rB{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new PP,this.projectionMatrix=new PP,this.projectionMatrixInverse=new PP,this.coordinateSystem=cI}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const xL=new tP,bL=new EI,_L=new EI;class wL extends AL{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*gI*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*mI*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*gI*Math.atan(Math.tan(.5*mI*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){xL.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(xL.x,xL.y).multiplyScalar(-e/xL.z),xL.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(xL.x,xL.y).multiplyScalar(-e/xL.z)}getViewSize(e,t){return this.getViewBounds(e,bL,_L),t.subVectors(_L,bL)}setViewOffset(e,t,n,i,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*mI*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/e,t-=o.offsetY*n/s,i*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const EL=-90;class SL extends rB{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new wL(EL,1,e,t);i.layers=this.layers,this.add(i);const r=new wL(EL,1,e,t);r.layers=this.layers,this.add(r);const o=new wL(EL,1,e,t);o.layers=this.layers,this.add(o);const s=new wL(EL,1,e,t);s.layers=this.layers,this.add(s);const a=new wL(EL,1,e,t);a.layers=this.layers,this.add(a);const l=new wL(EL,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,o,s,a]=t;for(const l of t)this.remove(l);if(e===cI)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==uI)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,s,a,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,a),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class CL extends QI{constructor(e,t,n,i,r,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:kM,n,i,r,o,s,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ML extends $I{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new CL(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:$M}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new pL(5,5,5),r=new yL({name:"CubemapFromEquirect",uniforms:fL(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:zC,blending:VC});r.uniforms.tEquirect.value=t;const o=new hL(i,r),s=t.minFilter;t.minFilter===JM&&(t.minFilter=$M);return new SL(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(r)}}class TL extends rB{constructor(){super(),this.isGroup=!0,this.type="Group"}}const RL={type:"move"};class IL{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new TL,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new TL,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new tP,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new tP),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new TL,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new tP,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new tP),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const o of e.hand.values()){const e=t.getJointPose(o,n),i=this._getHandJoint(l,o);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=i.position.distanceTo(r.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(RL)))}return null!==s&&(s.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new TL;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class PL{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.isFogExp2=!0,this.name="",this.color=new wB(e),this.density=t}clone(){return new PL(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class BL{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new wB(e),this.near=t,this.far=n}clone(){return new BL(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class LL extends rB{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new jP,this.environmentIntensity=1,this.environmentRotation=new jP,this.overrideMaterial=null,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class NL{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=JR,this.updateRanges=[],this.version=0,this.uuid=vI()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=vI()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=vI()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const DL=new tP;class kL{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)DL.fromBufferAttribute(this,t),DL.applyMatrix4(e),this.setXYZ(t,DL.x,DL.y,DL.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)DL.fromBufferAttribute(this,t),DL.applyNormalMatrix(e),this.setXYZ(t,DL.x,DL.y,DL.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)DL.fromBufferAttribute(this,t),DL.transformDirection(e),this.setXYZ(t,DL.x,DL.y,DL.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=bI(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=_I(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=_I(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=_I(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=_I(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=_I(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=bI(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=bI(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=bI(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=bI(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array),i=_I(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=_I(t,this.array),n=_I(n,this.array),i=_I(i,this.array),r=_I(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new kB(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new kL(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class OL extends CB{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new wB(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let UL;const FL=new tP,zL=new tP,jL=new tP,VL=new EI,GL=new EI,HL=new PP,WL=new tP,QL=new tP,qL=new tP,XL=new EI,$L=new EI,YL=new EI;class KL extends rB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new OL;if(super(),this.isSprite=!0,this.type="Sprite",void 0===UL){UL=new ZB;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new NL(e,5);UL.setIndex([0,1,2,0,2,3]),UL.setAttribute("position",new kL(t,3,0,!1)),UL.setAttribute("uv",new kL(t,2,3,!1))}this.geometry=UL,this.material=e,this.center=new EI(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),zL.setFromMatrixScale(this.matrixWorld),HL.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),jL.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&zL.multiplyScalar(-jL.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;JL(WL.set(-.5,-.5,0),jL,o,zL,i,r),JL(QL.set(.5,-.5,0),jL,o,zL,i,r),JL(qL.set(.5,.5,0),jL,o,zL,i,r),XL.set(0,0),$L.set(1,0),YL.set(1,1);let s=e.ray.intersectTriangle(WL,QL,qL,!1,FL);if(null===s&&(JL(QL.set(-.5,.5,0),jL,o,zL,i,r),$L.set(0,1),s=e.ray.intersectTriangle(WL,qL,QL,!1,FL),null===s))return;const a=e.ray.origin.distanceTo(FL);a<e.near||a>e.far||t.push({distance:a,point:FL.clone(),uv:yB.getInterpolation(FL,WL,QL,qL,XL,$L,YL,new EI),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function JL(e,t,n,i,r,o){VL.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(GL.x=o*VL.x-r*VL.y,GL.y=r*VL.x+o*VL.y):GL.copy(VL),e.copy(t),e.x+=GL.x,e.y+=GL.y,e.applyMatrix4(HL)}const ZL=new tP,eN=new tP;class tN extends rB{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=Math.abs(t);const i=this.levels;let r;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let i=t[n].distance;if(t[n].object.visible&&(i-=i*t[n].hysteresis),e<i)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){ZL.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(ZL);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ZL.setFromMatrixPosition(e.matrixWorld),eN.setFromMatrixPosition(this.matrixWorld);const n=ZL.distanceTo(eN)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),!(n>=e))break;t[i-1].object.visible=!1,t[i].object.visible=!0}for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const nN=new tP,iN=new qI,rN=new qI,oN=new tP,sN=new PP,aN=new tP,lN=new _P,cN=new PP,uN=new IP;class hN extends hL{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=LM,this.bindMatrix=new PP,this.bindMatrixInverse=new PP,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new rP),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,aN),this.boundingBox.expandByPoint(aN)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new _P),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,aN),this.boundingSphere.expandByPoint(aN)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),lN.copy(this.boundingSphere),lN.applyMatrix4(i),!1!==e.ray.intersectsSphere(lN)&&(cN.copy(i).invert(),uN.copy(e.ray).applyMatrix4(cN),null!==this.boundingBox&&!1===uN.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,uN)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new qI,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===LM?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===NM?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;iN.fromBufferAttribute(i.attributes.skinIndex,e),rN.fromBufferAttribute(i.attributes.skinWeight,e),nN.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const e=rN.getComponent(r);if(0!==e){const i=iN.getComponent(r);sN.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(oN.copy(nN).applyMatrix4(sN),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class dN extends rB{constructor(){super(),this.isBone=!0,this.type="Bone"}}class pN extends QI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:HM,arguments.length>9&&void 0!==arguments[9]?arguments[9]:HM,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const fN=new PP,mN=new PP;class gN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=vI(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new PP)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new PP;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const i=e[r]?e[r].matrixWorld:mN;fN.multiplyMatrices(i,t[r]),fN.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}clone(){return new gN(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new pN(t,e,e,fT,sT);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new dN),this.bones.push(r),this.boneInverses.push((new PP).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const o=n[i];e.boneInverses.push(o.toArray())}return e}}class vN extends kB{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const yN=new PP,AN=new PP,xN=[],bN=new rP,_N=new PP,wN=new hL,EN=new _P;class SN extends hL{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new vN(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,_N)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new rP),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,yN),bN.copy(e.boundingBox).applyMatrix4(yN),this.boundingBox.union(bN)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new _P),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,yN),EN.copy(e.boundingSphere).applyMatrix4(yN),this.boundingSphere.union(EN)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,r=e*(n.length+1)+1;for(let o=0;o<n.length;o++)n[o]=i[r+o]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(wN.geometry=this.geometry,wN.material=this.material,void 0!==wN.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),EN.copy(this.boundingSphere),EN.applyMatrix4(n),!1!==e.ray.intersectsSphere(EN)))for(let r=0;r<i;r++){this.getMatrixAt(r,yN),AN.multiplyMatrices(n,yN),wN.matrixWorld=AN,wN.raycast(e,xN);for(let e=0,n=xN.length;e<n;e++){const n=xN[e];n.instanceId=r,n.object=this,t.push(n)}xN.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new vN(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new pN(new Float32Array(i*this.count),i,this.count,AT,sT));const r=this.morphTexture.source.data.data;let o=0;for(let l=0;l<n.length;l++)o+=n[l];const s=this.geometry.morphTargetsRelative?1:1-o,a=i*e;r[a]=s,r.set(n,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const CN=new tP,MN=new tP,TN=new SI;class RN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=CN.subVectors(n,t).cross(MN.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(CN),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||TN.getNormalMatrix(e),i=this.coplanarPoint(CN).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const IN=new _P,PN=new tP;class BN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new RN,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new RN,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new RN,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new RN,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new RN,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new RN;this.planes=[e,t,n,i,r,o]}set(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cI;const n=this.planes,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],A=i[15];if(n[0].setComponents(a-r,h-l,m-d,A-g).normalize(),n[1].setComponents(a+r,h+l,m+d,A+g).normalize(),n[2].setComponents(a+o,h+c,m+p,A+v).normalize(),n[3].setComponents(a-o,h-c,m-p,A-v).normalize(),n[4].setComponents(a-s,h-u,m-f,A-y).normalize(),t===cI)n[5].setComponents(a+s,h+u,m+f,A+y).normalize();else{if(t!==uI)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),IN.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),IN.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(IN)}intersectsSprite(e){return IN.center.set(0,0,0),IN.radius=.7071067811865476,IN.applyMatrix4(e.matrixWorld),this.intersectsSphere(IN)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(PN.x=i.normal.x>0?e.max.x:e.min.x,PN.y=i.normal.y>0?e.max.y:e.min.y,PN.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(PN)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function LN(e,t){return e-t}function NN(e,t){return e.z-t.z}function DN(e,t){return t.z-e.z}class kN{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const r=this.pool,o=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const s=r[this.index];o.push(s),this.index++,s.start=e,s.count=t,s.z=n,s.index=i}reset(){this.list.length=0,this.index=0}}const ON=new PP,UN=new wB(1,1,1),FN=new BN,zN=new rP,jN=new _P,VN=new tP,GN=new tP,HN=new tP,WN=new kN,QN=new hL,qN=[];function XN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const r=e.count;for(let o=0;o<r;o++)for(let r=0;r<i;r++)t.setComponent(o+n,r,e.getComponent(o,r))}else t.array.set(e.array,n*i);t.needsUpdate=!0}function $N(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++)t[i]=e[i]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class YN extends hL{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*t,i=arguments.length>3?arguments[3]:void 0;super(new ZB,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new pN(t,e,e,fT,sT);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new pN(t,e,e,xT,oT);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new pN(t,e,e,fT,sT);n.colorSpace=OI.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in e.attributes){const r=e.getAttribute(i),{array:o,itemSize:s,normalized:a}=r,l=new o.constructor(n*s),c=new kB(l,s,a);t.setAttribute(i,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new kB(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),r=t.getAttribute(n);if(i.itemSize!==r.itemSize||i.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new rP);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,ON),this.getBoundingBoxAt(i,zN).applyMatrix4(ON),e.union(zN)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new _P);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(!1===t[n].active)continue;const i=t[n].geometryIndex;this.getMatrixAt(n,ON),this.getBoundingSphereAt(i,jN).applyMatrix4(ON),e.union(jN)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(LN),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const i=this._matricesTexture;ON.identity().toArray(i.image.data,16*n),i.needsUpdate=!0;const r=this._colorsTexture;return r&&(UN.toArray(r.image.data,4*n),r.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const o=e.getIndex();if(null!==o&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===n?o.count:n),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let s;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(LN),s=this._availableGeometryIds.shift(),r[s]=i):(s=this._geometryCount,this._geometryCount++,r.push(i)),this.setGeometryAt(s,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,s}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=null!==n.getIndex(),r=n.getIndex(),o=t.getIndex(),s=this._geometryInfo[e];if(i&&o.count>s.reservedIndexCount||t.attributes.position.count>s.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=s.vertexStart,l=s.reservedVertexCount;s.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),i=n.getAttribute(c);XN(e,i,a);const r=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=a+t;for(let t=0;t<r;t++)i.setComponent(e,t,0)}i.needsUpdate=!0,i.addUpdateRange(a*r,l*r)}if(i){const e=s.indexStart,n=s.reservedIndexCount;s.indexCount=t.getIndex().count;for(let t=0;t<o.count;t++)r.setX(e+t,a+o.getX(t));for(let t=o.count,i=n;t<i;t++)r.setX(e+t,a);r.needsUpdate=!0,r.addUpdateRange(e,s.reservedIndexCount)}return s.start=i?s.indexStart:s.vertexStart,s.count=i?s.indexCount:s.vertexCount,s.boundingBox=null,null!==t.boundingBox&&(s.boundingBox=t.boundingBox.clone()),s.boundingSphere=null,null!==t.boundingSphere&&(s.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let i=0,r=n.length;i<r;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map(((e,t)=>t)).sort(((e,t)=>n[e].vertexStart-n[t].vertexStart)),r=this.geometry;for(let o=0,s=n.length;o<s;o++){const s=i[o],a=n[s];if(!1!==a.active){if(null!==r.index){if(a.indexStart!==t){const{indexStart:n,vertexStart:i,reservedIndexCount:o}=a,s=r.index,l=s.array,c=e-i;for(let e=n;e<n+o;e++)l[e]=l[e]+c;s.array.copyWithin(t,n,n+o),s.addUpdateRange(t,o),a.indexStart=t}t+=a.reservedIndexCount}if(a.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=a,i=r.attributes;for(const r in i){const o=i[r],{array:s,itemSize:a}=o;s.copyWithin(e*a,t*a,(t+n)*a),o.addUpdateRange(e*a,n*a)}a.vertexStart=e}e+=a.reservedVertexCount,a.start=r.index?a.indexStart:a.vertexStart,this._nextIndexStart=r.index?a.indexStart+a.reservedIndexCount:0,this._nextVertexStart=a.vertexStart+a.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingBox){const e=new rP,t=n.index,r=n.attributes.position;for(let n=i.start,o=i.start+i.count;n<o;n++){let i=n;t&&(i=t.getX(i)),e.expandByPoint(VN.fromBufferAttribute(r,i))}i.boundingBox=e}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(null===i.boundingSphere){const t=new _P;this.getBoundingBoxAt(e,zN),zN.getCenter(t.center);const r=n.index,o=n.attributes.position;let s=0;for(let e=i.start,n=i.start+i.count;e<n;e++){let n=e;r&&(n=r.getX(n)),VN.fromBufferAttribute(o,n),s=Math.max(s,t.center.distanceToSquared(VN))}t.radius=Math.sqrt(s),i.boundingSphere=t}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(LN);t[t.length-1]===n.length;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),r=new Int32Array(e);$N(this._multiDrawCounts,i),$N(this._multiDrawStarts,r),this._multiDrawCounts=i,this._multiDrawStarts=r,this._maxInstanceCount=e;const o=this._indirectTexture,s=this._matricesTexture,a=this._colorsTexture;o.dispose(),this._initIndirectTexture(),$N(o.image.data,this._indirectTexture.image.data),s.dispose(),this._initMatricesTexture(),$N(s.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),$N(a.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter((e=>e.active));if(Math.max(...n.map((e=>e.vertexStart+e.reservedVertexCount)))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index){if(Math.max(...n.map((e=>e.indexStart+e.reservedIndexCount)))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`)}const i=this.geometry;i.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new ZB,this._initializeGeometry(i));const r=this.geometry;i.index&&$N(i.index.array,r.index.array);for(const o in i.attributes)$N(i.attributes[o].array,r.attributes[o].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,r=this.matrixWorld,o=this.geometry;QN.material=this.material,QN.geometry.index=o.index,QN.geometry.attributes=o.attributes,null===QN.geometry.boundingBox&&(QN.geometry.boundingBox=new rP),null===QN.geometry.boundingSphere&&(QN.geometry.boundingSphere=new _P);for(let s=0,a=n.length;s<a;s++){if(!n[s].visible||!n[s].active)continue;const o=n[s].geometryIndex,a=i[o];QN.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(s,QN.matrixWorld).premultiply(r),this.getBoundingBoxAt(o,QN.geometry.boundingBox),this.getBoundingSphereAt(o,QN.geometry.boundingSphere),QN.raycast(e,qN);for(let e=0,n=qN.length;e<n;e++){const n=qN[e];n.object=this,n.batchId=s,t.push(n)}qN.length=0}QN.material=null,QN.geometry.index=null,QN.geometry.attributes={},QN.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map((e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null}))),this._instanceInfo=e._instanceInfo.map((e=>({...e}))),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,n,i,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=i.getIndex(),s=null===o?1:o.array.BYTES_PER_ELEMENT,a=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,h=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data;h&&(ON.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),FN.setFromProjectionMatrix(ON,e.coordinateSystem));let f=0;if(this.sortObjects){ON.copy(this.matrixWorld).invert(),VN.setFromMatrixPosition(n.matrixWorld).applyMatrix4(ON),GN.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(ON);for(let n=0,i=a.length;n<i;n++)if(a[n].visible&&a[n].active){const e=a[n].geometryIndex;this.getMatrixAt(n,ON),this.getBoundingSphereAt(e,jN).applyMatrix4(ON);let t=!1;if(h&&(t=!FN.intersectsSphere(jN)),!t){const t=u[e],i=HN.subVectors(jN.center,VN).dot(GN);WN.push(t.start,t.count,i,n)}}const e=WN.list,t=this.customSort;null===t?e.sort(r.transparent?DN:NN):t.call(this,e,n);for(let n=0,i=e.length;n<i;n++){const t=e[n];l[f]=t.start*s,c[f]=t.count,p[f]=t.index,f++}WN.reset()}else for(let m=0,g=a.length;m<g;m++)if(a[m].visible&&a[m].active){const e=a[m].geometryIndex;let t=!1;if(h&&(this.getMatrixAt(m,ON),this.getBoundingSphereAt(e,jN).applyMatrix4(ON),t=!FN.intersectsSphere(jN)),!t){const t=u[e];l[f]=t.start*s,c[f]=t.count,p[f]=m,f++}}d.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,r,o){this.onBeforeRender(e,null,i,r,o)}}class KN extends CB{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new wB(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const JN=new tP,ZN=new tP,eD=new PP,tD=new IP,nD=new _P,iD=new tP,rD=new tP;class oD extends rB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ZB,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KN;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)JN.fromBufferAttribute(t,e-1),ZN.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=JN.distanceTo(ZN);e.setAttribute("lineDistance",new WB(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),nD.copy(n.boundingSphere),nD.applyMatrix4(i),nD.radius+=r,!1===e.ray.intersectsSphere(nD))return;eD.copy(i).invert(),tD.copy(e.ray).applyMatrix4(eD);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,o.start),i=Math.min(c.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=c.getX(r),i=c.getX(r+1),o=sD(this,e,tD,a,n,i,r);o&&t.push(o)}if(this.isLineLoop){const r=c.getX(i-1),o=c.getX(n),s=sD(this,e,tD,a,r,o,i-1);s&&t.push(s)}}else{const n=Math.max(0,o.start),i=Math.min(u.count,o.start+o.count);for(let r=n,o=i-1;r<o;r+=l){const n=sD(this,e,tD,a,r,r+1,r);n&&t.push(n)}if(this.isLineLoop){const r=sD(this,e,tD,a,i-1,n,i-1);r&&t.push(r)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function sD(e,t,n,i,r,o,s){const a=e.geometry.attributes.position;JN.fromBufferAttribute(a,r),ZN.fromBufferAttribute(a,o);if(n.distanceSqToSegment(JN,ZN,iD,rD)>i)return;iD.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(iD);return l<t.near||l>t.far?void 0:{distance:l,point:rD.clone().applyMatrix4(e.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:e}}const aD=new tP,lD=new tP;class cD extends oD{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)aD.fromBufferAttribute(t,e),lD.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+aD.distanceTo(lD);e.setAttribute("lineDistance",new WB(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class uD extends oD{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class hD extends CB{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new wB(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const dD=new PP,pD=new IP,fD=new _P,mD=new tP;class gD extends rB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ZB,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hD;super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),fD.copy(n.boundingSphere),fD.applyMatrix4(i),fD.radius+=r,!1===e.ray.intersectsSphere(fD))return;dD.copy(i).invert(),pD.copy(e.ray).applyMatrix4(dD);const s=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=n.index,c=n.attributes.position;if(null!==l){for(let n=Math.max(0,o.start),r=Math.min(l.count,o.start+o.count);n<r;n++){const r=l.getX(n);mD.fromBufferAttribute(c,r),vD(mD,r,a,i,e,t,this)}}else{for(let n=Math.max(0,o.start),r=Math.min(c.count,o.start+o.count);n<r;n++)mD.fromBufferAttribute(c,n),vD(mD,n,a,i,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function vD(e,t,n,i,r,o,s){const a=pD.distanceSqToPoint(e);if(a<n){const n=new tP;pD.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:s})}}class yD extends QI{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:$M,this.magFilter=void 0!==r?r:$M,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class AD extends yD{constructor(e,t,n,i,r,o,s,a){super({},e,t,n,i,r,o,s,a),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class xD extends QI{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=HM,this.minFilter=HM,this.generateMipmaps=!1,this.needsUpdate=!0}}class bD extends QI{constructor(e,t,n,i,r,o,s,a,l,c,u,h){super(null,o,s,a,l,c,i,r,u,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class _D extends bD{constructor(e,t,n,i,r,o){super(e,t,n,r,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=VM,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class wD extends bD{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,kM),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class ED extends QI{constructor(e,t,n,i,r,o,s,a,l){super(e,t,n,i,r,o,s,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class SD extends QI{constructor(e,t,n,i,r,o,s,a,l){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:vT;if(c!==vT&&c!==yT)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===vT&&(n=oT),void 0===n&&c===yT&&(n=uT),super(null,i,r,o,s,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:HM,this.minFilter=void 0!==a?a:HM,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class CD{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let o;o=t||e*n[r-1];let s,a=0,l=r-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),s=n[i]-o,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(r-1);const c=n[i];return(i+(o-c)/(n[i+1]-c))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new EI:new tP);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new tP,i=[],r=[],o=[],s=new tP,a=new PP;for(let d=0;d<=e;d++){const t=d/e;i[d]=this.getTangentAt(t,new tP)}r[0]=new tP,o[0]=new tP;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let d=1;d<=e;d++){if(r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),s.crossVectors(i[d-1],i[d]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(yI(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(a.makeRotationAxis(s,e))}o[d].crossVectors(i[d],r[d])}if(!0===t){let t=Math.acos(yI(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),o[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class MD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI,n=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const r=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),!0!==this.aClockwise||r||(i===n?i=-n:i-=n);const o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),a=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,i=a-this.aY;s=n*e-i*t+this.aX,a=n*t+i*e+this.aY}return t.set(s,a)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class TD extends MD{constructor(e,t,n,i,r,o){super(e,t,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function RD(){let e=0,t=0,n=0,i=0;function r(r,o,s,a){e=r,t=s,n=-3*r+3*o-2*s-a,i=2*r-2*o+s+a}return{initCatmullRom:function(e,t,n,i,o){r(t,n,o*(n-e),o*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(i-t)/(s+a)+(i-n)/a;l*=s,c*=s,r(t,n,l,c)},calc:function(r){const o=r*r;return e+t*r+n*o+i*(o*r)}}}const ID=new tP,PD=new RD,BD=new RD,LD=new RD;class ND extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP,n=this.points,i=n.length,r=(i-(this.closed?0:1))*e;let o,s,a=Math.floor(r),l=r-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/i)+1)*i:0===l&&a===i-1&&(a=i-2,l=1),this.closed||a>0?o=n[(a-1)%i]:(ID.subVectors(n[0],n[1]).add(n[0]),o=ID);const c=n[a%i],u=n[(a+1)%i];if(this.closed||a+2<i?s=n[(a+2)%i]:(ID.subVectors(n[i-1],n[i-2]).add(n[i-1]),s=ID),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),PD.initNonuniformCatmullRom(o.x,c.x,u.x,s.x,t,n,i),BD.initNonuniformCatmullRom(o.y,c.y,u.y,s.y,t,n,i),LD.initNonuniformCatmullRom(o.z,c.z,u.z,s.z,t,n,i)}else"catmullrom"===this.curveType&&(PD.initCatmullRom(o.x,c.x,u.x,s.x,this.tension),BD.initCatmullRom(o.y,c.y,u.y,s.y,this.tension),LD.initCatmullRom(o.z,c.z,u.z,s.z,this.tension));return t.set(PD.calc(l),BD.calc(l),LD.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new tP).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function DD(e,t,n,i,r){const o=.5*(i-t),s=.5*(r-n),a=e*e;return(2*n-2*i+o+s)*(e*a)+(-3*n+3*i-2*o-s)*a+o*e+n}function kD(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function OD(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}class UD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new EI,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new EI,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new EI;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI,n=this.v0,i=this.v1,r=this.v2,o=this.v3;return t.set(OD(e,n.x,i.x,r.x,o.x),OD(e,n.y,i.y,r.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class FD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tP,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new tP;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP,n=this.v0,i=this.v1,r=this.v2,o=this.v3;return t.set(OD(e,n.x,i.x,r.x,o.x),OD(e,n.y,i.y,r.y,o.y),OD(e,n.z,i.z,r.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class zD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new EI,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class jD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class VD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new EI,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new EI;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI,n=this.v0,i=this.v1,r=this.v2;return t.set(kD(e,n.x,i.x,r.x),kD(e,n.y,i.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class GD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tP;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP,n=this.v0,i=this.v1,r=this.v2;return t.set(kD(e,n.x,i.x,r.x),kD(e,n.y,i.y,r.y),kD(e,n.z,i.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class HD extends CD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI,n=this.points,i=(n.length-1)*e,r=Math.floor(i),o=i-r,s=n[0===r?r:r-1],a=n[r],l=n[r>n.length-2?n.length-1:r+1],c=n[r>n.length-3?n.length-1:r+2];return t.set(DD(o,s.x,a.x,l.x,c.x),DD(o,s.y,a.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new EI).fromArray(n))}return this}}var WD=Object.freeze({__proto__:null,ArcCurve:TD,CatmullRomCurve3:ND,CubicBezierCurve:UD,CubicBezierCurve3:FD,EllipseCurve:MD,LineCurve:zD,LineCurve3:jD,QuadraticBezierCurve:VD,QuadraticBezierCurve3:GD,SplineCurve:HD});class QD extends CD{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new WD[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,o=this.curves[r],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new WD[n.type]).fromJSON(n))}return this}}class qD extends QD{constructor(e){super(),this.type="Path",this.currentPoint=new EI,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new zD(this.currentPoint.clone(),new EI(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new VD(this.currentPoint.clone(),new EI(e,t),new EI(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,o){const s=new UD(this.currentPoint.clone(),new EI(e,t),new EI(n,i),new EI(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new HD(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this}absarc(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this}ellipse(e,t,n,i,r,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,r,o,s,a),this}absellipse(e,t,n,i,r,o,s,a){const l=new MD(e,t,n,i,r,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class XD extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new EI(0,-.5),new EI(.5,0),new EI(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=yI(i,0,2*Math.PI);const r=[],o=[],s=[],a=[],l=[],c=1/t,u=new tP,h=new EI,d=new tP,p=new tP,f=new tP;let m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),a.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){const r=n+v*c*i,d=Math.sin(r),p=Math.cos(r);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*d,u.y=e[n].y,u.z=e[n].x*p,o.push(u.x,u.y,u.z),h.x=v/t,h.y=n/(e.length-1),s.push(h.x,h.y);const i=a[3*n+0]*d,r=a[3*n+1],c=a[3*n+0]*p;l.push(i,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){const n=t+v*e.length,i=n,o=n+e.length,s=n+e.length+1,a=n+1;r.push(i,o,a),r.push(s,a,o)}this.setIndex(r),this.setAttribute("position",new WB(o,3)),this.setAttribute("uv",new WB(s,2)),this.setAttribute("normal",new WB(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new XD(e.points,e.segments,e.phiStart,e.phiLength)}}class $D extends XD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;const r=new qD;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new $D(e.radius,e.length,e.capSegments,e.radialSegments)}}class YD extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],o=[],s=[],a=[],l=new tP,c=new EI;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const r=n+u/t*i;l.x=e*Math.cos(r),l.y=e*Math.sin(r),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[h]/e+1)/2,c.y=(o[h+1]/e+1)/2,a.push(c.x,c.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new WB(o,3)),this.setAttribute("normal",new WB(s,3)),this.setAttribute("uv",new WB(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YD(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class KD extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,o=new EI,f=new tP;let v=0;const y=!0===n?e:t,A=!0===n?1:-1;for(let e=1;e<=i;e++)u.push(0,m*A,0),h.push(0,A,0),d.push(.5,.5),p++;const x=p;for(let e=0;e<=i;e++){const t=e/i*a+s,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*A,f.z=y*n,u.push(f.x,f.y,f.z),h.push(0,A,0),o.x=.5*n+.5,o.y=.5*r*A+.5,d.push(o.x,o.y),p++}for(let e=0;e<i;e++){const t=r+e,i=x+e;!0===n?c.push(i,i+1,t):c.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const o=new tP,v=new tP;let y=0;const A=(t-e)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*a+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),o.set(l,A,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let n=0;n<i;n++)for(let i=0;i<r;i++){const o=f[i][n],s=f[i+1][n],a=f[i+1][n+1],l=f[i][n+1];(e>0||0!==i)&&(c.push(o,s,l),y+=3),(t>0||i!==r-1)&&(c.push(s,a,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new WB(u,3)),this.setAttribute("normal",new WB(h,3)),this.setAttribute("uv",new WB(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new KD(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class JD extends KD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}static fromJSON(e){return new JD(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ZD extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],o=[];function s(e,t,n,i){const r=i+1,o=[];for(let s=0;s<=r;s++){o[s]=[];const i=e.clone().lerp(n,s/r),a=t.clone().lerp(n,s/r),l=r-s;for(let e=0;e<=l;e++)o[s][e]=0===e&&s===r?i:i.clone().lerp(a,e/l)}for(let s=0;s<r;s++)for(let e=0;e<2*(r-s)-1;e++){const t=Math.floor(e/2);e%2===0?(a(o[s][t+1]),a(o[s+1][t]),a(o[s][t])):(a(o[s][t+1]),a(o[s+1][t+1]),a(o[s+1][t]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function c(e,t,n,i){i<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=i/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new tP,i=new tP,r=new tP;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],i),l(t[o+2],r),s(n,i,r,e)}(i),function(e){const t=new tP;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new tP;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(i,1-s)}var t;(function(){const e=new tP,t=new tP,n=new tP,i=new tP,s=new EI,a=new EI,l=new EI;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=u(i);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],i=o[e+4],r=Math.max(t,n,i),s=Math.min(t,n,i);r>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),i<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new WB(r,3)),this.setAttribute("normal",new WB(r.slice(),3)),this.setAttribute("uv",new WB(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ZD(e.vertices,e.indices,e.radius,e.details)}}class ek extends ZD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ek(e.radius,e.detail)}}const tk=new tP,nk=new tP,ik=new tP,rk=new yB;class ok extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(mI*t),o=e.getIndex(),s=e.getAttribute("position"),a=o?o.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<a;e+=3){o?(l[0]=o.getX(e),l[1]=o.getX(e+1),l[2]=o.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:a}=rk;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),a.fromBufferAttribute(s,l[2]),rk.getNormal(ik),u[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,u[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],i=u[t],o=rk[c[e]],s=rk[c[t]],a=`${n}_${i}`,p=`${i}_${n}`;p in h&&h[p]?(ik.dot(h[p].normal)<=r&&(d.push(o.x,o.y,o.z),d.push(s.x,s.y,s.z)),h[p]=null):a in h||(h[a]={index0:l[e],index1:l[t],normal:ik.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];tk.fromBufferAttribute(s,t),nk.fromBufferAttribute(s,n),d.push(tk.x,tk.y,tk.z),d.push(nk.x,nk.y,nk.z)}this.setAttribute("position",new WB(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class sk extends qD{constructor(e){super(e),this.uuid=vI(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new qD).fromJSON(n))}return this}}const ak=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,r=i?t[0]*n:e.length;let o=lk(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(i&&(o=function(e,t,n,i){const r=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*i,l=o<s-1?t[o+1]*i:e.length,c=lk(e,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ak(c));for(r.sort(mk),o=0;o<r.length;o++)n=gk(r[o],n);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return uk(o,s,n,a,l,p,0),s};function lk(e,t,n,i,r){let o,s;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(o=t;o<n;o+=i)s=Rk(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=Rk(o,e[o],e[o+1],s);return s&&wk(s,s.next)&&(Ik(s),s=s.next),s}function ck(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!wk(i,i.next)&&0!==_k(i.prev,i,i.next))i=i.next;else{if(Ik(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function uk(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=yk(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?dk(e,i,r,o):hk(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Ik(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?uk(e=pk(ck(e),t,n),t,n,i,r,o,2):2===s&&fk(e,t,n,i,r,o):uk(ck(e),t,n,i,r,o,1);break}}function hk(e){const t=e.prev,n=e,i=e.next;if(_k(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&xk(r,a,o,l,s,c,f.x,f.y)&&_k(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function dk(e,t,n,i){const r=e.prev,o=e,s=e.next;if(_k(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=yk(p,f,t,n,i),y=yk(m,g,t,n,i);let A=e.prevZ,x=e.nextZ;for(;A&&A.z>=v&&x&&x.z<=y;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==s&&xk(a,u,l,h,c,d,A.x,A.y)&&_k(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&xk(a,u,l,h,c,d,x.x,x.y)&&_k(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;A&&A.z>=v;){if(A.x>=p&&A.x<=m&&A.y>=f&&A.y<=g&&A!==r&&A!==s&&xk(a,u,l,h,c,d,A.x,A.y)&&_k(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&xk(a,u,l,h,c,d,x.x,x.y)&&_k(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function pk(e,t,n){let i=e;do{const r=i.prev,o=i.next.next;!wk(r,o)&&Ek(r,i,i.next,o)&&Mk(r,o)&&Mk(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),Ik(i),Ik(i.next),i=e=o),i=i.next}while(i!==e);return ck(i)}function fk(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&bk(s,e)){let a=Tk(s,e);return s=ck(s,s.next),a=ck(a,a.next),uk(s,t,n,i,r,o,0),void uk(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function mk(e,t){return e.x-t.x}function gk(e,t){const n=function(e,t){let n,i=t,r=-1/0;const o=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=o&&e>r&&(r=e,n=i.x<i.next.x?i:i.next,e===o))return n}i=i.next}while(i!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,h=1/0;i=n;do{o>=i.x&&i.x>=l&&o!==i.x&&xk(s<c?o:r,s,l,c,s<c?r:o,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(o-i.x),Mk(i,e)&&(u<h||u===h&&(i.x>n.x||i.x===n.x&&vk(n,i)))&&(n=i,h=u)),i=i.next}while(i!==a);return n}(e,t);if(!n)return t;const i=Tk(n,e);return ck(i,i.next),ck(n,n.next)}function vk(e,t){return _k(e.prev,e,t.prev)<0&&_k(t.next,e,e.next)<0}function yk(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ak(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function xk(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function bk(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ek(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Mk(e,t)&&Mk(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(_k(e.prev,e,t.prev)||_k(e,t.prev,t))||wk(e,t)&&_k(e.prev,e,e.next)>0&&_k(t.prev,t,t.next)>0)}function _k(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function wk(e,t){return e.x===t.x&&e.y===t.y}function Ek(e,t,n,i){const r=Ck(_k(e,t,n)),o=Ck(_k(e,t,i)),s=Ck(_k(n,i,e)),a=Ck(_k(n,i,t));return r!==o&&s!==a||(!(0!==r||!Sk(e,n,t))||(!(0!==o||!Sk(e,i,t))||(!(0!==s||!Sk(n,e,i))||!(0!==a||!Sk(n,t,i)))))}function Sk(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ck(e){return e>0?1:e<0?-1:0}function Mk(e,t){return _k(e.prev,e,e.next)<0?_k(e,t,e.next)>=0&&_k(e,e.prev,t)>=0:_k(e,t,e.prev)<0||_k(e,e.next,t)<0}function Tk(e,t){const n=new Pk(e.i,e.x,e.y),i=new Pk(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Rk(e,t,n,i){const r=new Pk(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ik(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Pk(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Bk{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return Bk.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Lk(e),Nk(n,e);let o=e.length;t.forEach(Lk);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,Nk(n,t[a]);const s=ak(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}}function Lk(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Nk(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Dk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sk([new EI(.5,.5),new EI(-.5,.5),new EI(-.5,-.5),new EI(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++){o(e[s])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:kk;let g,v,y,A,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,v=f.computeFrenetFrames(a,!1),y=new tP,A=new tP,x=new tP),c||(p=0,u=0,h=0,d=0);const _=e.extractPoints(s);let w=_.shape;const E=_.holes;if(!Bk.isClockWise(w)){w=w.reverse();for(let e=0,t=E.length;e<t;e++){const t=E[e];Bk.isClockWise(t)&&(E[e]=t.reverse())}}const S=Bk.triangulateShape(w,E),C=w;for(let t=0,n=E.length;t<n;t++){const e=E[t];w=w.concat(e)}function M(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const T=w.length,R=S.length;function I(e,t,n){let i,r,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);i=p+s*m-e.x,r=f+a*m-e.y;const g=i*i+r*r;if(g<=2)return new EI(i,r);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(i=-a,r=s,o=Math.sqrt(u)):(i=s,r=a,o=Math.sqrt(u/2))}return new EI(i/o,r/o)}const P=[];for(let t=0,n=C.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),P[t]=I(C[t],C[i],C[r]);const B=[];let L,N=P.concat();for(let t=0,n=E.length;t<n;t++){const e=E[t];L=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[t]=I(e[t],e[i],e[r]);B.push(L),N=N.concat(L)}for(let t=0;t<p;t++){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=C.length;t<r;t++){const e=M(C[t],P[t],i);O(e.x,e.y,-n)}for(let t=0,r=E.length;t<r;t++){const e=E[t];L=B[t];for(let t=0,r=e.length;t<r;t++){const r=M(e[t],L[t],i);O(r.x,r.y,-n)}}}const D=h+d;for(let t=0;t<T;t++){const e=c?M(w[t],N[t],D):w[t];b?(A.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(A).add(y),O(x.x,x.y,x.z)):O(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<T;e++){const n=c?M(w[e],N[e],D):w[e];b?(A.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(A).add(y),O(x.x,x.y,x.z)):O(n.x,n.y,l/a*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=u*Math.cos(e*Math.PI/2),i=h*Math.sin(e*Math.PI/2)+d;for(let t=0,r=C.length;t<r;t++){const e=M(C[t],P[t],i);O(e.x,e.y,l+n)}for(let t=0,r=E.length;t<r;t++){const e=E[t];L=B[t];for(let t=0,r=e.length;t<r;t++){const r=M(e[t],L[t],i);b?O(r.x,r.y+g[a-1].y,g[a-1].x+n):O(r.x,r.y,l+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=T*e,o=T*(e+1);F(t+i+n,t+r+n,t+r+o,t+i+o)}}}function O(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,r){z(e),z(t),z(r);const o=i.length/3,s=m.generateTopUV(n,i,o-3,o-2,o-1);j(s[0]),j(s[1]),j(s[2])}function F(e,t,r,o){z(e),z(t),z(o),z(t),z(r),z(o);const s=i.length/3,a=m.generateSideWallUV(n,i,s-6,s-3,s-2,s-1);j(a[0]),j(a[1]),j(a[3]),j(a[1]),j(a[2]),j(a[3])}function z(e){i.push(o[3*e+0]),i.push(o[3*e+1]),i.push(o[3*e+2])}function j(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(c){let e=0,t=T*e;for(let n=0;n<R;n++){const e=S[n];U(e[2]+t,e[1]+t,e[0]+t)}e=a+2*p,t=T*e;for(let n=0;n<R;n++){const e=S[n];U(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<R;e++){const t=S[e];U(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=S[e];U(t[0]+T*a,t[1]+T*a,t[2]+T*a)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;k(C,t),t+=C.length;for(let n=0,i=E.length;n<i;n++){const e=E[n];k(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new WB(i,3)),this.setAttribute("uv",new WB(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const i=t[e.shapes[r]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new WD[i.type]).fromJSON(i)),new Dk(n,e.options)}}const kk={generateTopUV:function(e,t,n,i,r){const o=t[3*n],s=t[3*n+1],a=t[3*i],l=t[3*i+1],c=t[3*r],u=t[3*r+1];return[new EI(o,s),new EI(a,l),new EI(c,u)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*i],u=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new EI(s,1-l),new EI(c,1-h),new EI(d,1-f),new EI(m,1-v)]:[new EI(a,1-l),new EI(u,1-h),new EI(p,1-f),new EI(g,1-v)]}};class Ok extends ZD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ok(e.radius,e.detail)}}class Uk extends ZD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Uk(e.radius,e.detail)}}class Fk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,o=t/2,s=Math.floor(n),a=Math.floor(i),l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*h-o;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/a)}}for(let g=0;g<a;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new WB(p,3)),this.setAttribute("normal",new WB(f,3)),this.setAttribute("uv",new WB(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fk(e.width,e.height,e.widthSegments,e.heightSegments)}}class zk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const s=[],a=[],l=[],c=[];let u=e;const h=(t-e)/i,d=new tP,p=new EI;for(let f=0;f<=i;f++){for(let e=0;e<=n;e++){const i=r+e/n*o;d.x=u*Math.cos(i),d.y=u*Math.sin(i),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let f=0;f<i;f++){const e=f*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,o=i+n+1,a=i+n+2,l=i+1;s.push(r,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute("position",new WB(a,3)),this.setAttribute("normal",new WB(l,3)),this.setAttribute("uv",new WB(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zk(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class jk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sk([new EI(0,.5),new EI(-.5,-.5),new EI(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(s,a,c),s+=a,a=0;function l(e){const s=i.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===Bk.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===Bk.isClockWise(e)&&(u[t]=e.reverse())}const h=Bk.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),o.push(e.x,e.y)}for(let t=0,i=h.length;t<i;t++){const e=h[t],i=e[0]+s,r=e[1]+s,o=e[2]+s;n.push(i,r,o),a+=3}}this.setIndex(n),this.setAttribute("position",new WB(i,3)),this.setAttribute("normal",new WB(r,3)),this.setAttribute("uv",new WB(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new jk(n,e.curveSegments)}}class Vk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new tP,h=new tP,d=[],p=[],f=[],m=[];for(let g=0;g<=n;g++){const d=[],v=g/n;let y=0;0===g&&0===o?y=.5/t:g===n&&a===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(i+a*r)*Math.sin(o+v*s),u.y=e*Math.cos(o+v*s),u.z=e*Math.sin(i+a*r)*Math.sin(o+v*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+y,1-v),d.push(l++)}c.push(d)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],i=c[g][e],r=c[g+1][e],s=c[g+1][e+1];(0!==g||o>0)&&d.push(t,i,s),(g!==n-1||a<Math.PI)&&d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new WB(p,3)),this.setAttribute("normal",new WB(f,3)),this.setAttribute("uv",new WB(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vk(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Gk extends ZD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gk(e.radius,e.detail)}}class Hk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],a=[],l=[],c=new tP,u=new tP,h=new tP;for(let d=0;d<=n;d++)for(let o=0;o<=i;o++){const p=o/i*r,f=d/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(o/i),l.push(d/n)}for(let d=1;d<=n;d++)for(let e=1;e<=i;e++){const t=(i+1)*d+e-1,n=(i+1)*(d-1)+e-1,r=(i+1)*(d-1)+e,s=(i+1)*d+e;o.push(t,n,s),o.push(n,r,s)}this.setIndex(o),this.setAttribute("position",new WB(s,3)),this.setAttribute("normal",new WB(a,3)),this.setAttribute("uv",new WB(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hk(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Wk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],l=[],c=[],u=new tP,h=new tP,d=new tP,p=new tP,f=new tP,m=new tP,g=new tP;for(let y=0;y<=n;++y){const s=y/n*r*Math.PI*2;v(s,r,o,e,d),v(s+.01,r,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,o=-t*Math.cos(r),s=t*Math.sin(r);u.x=d.x+(o*g.x+s*f.x),u.y=d.y+(o*g.y+s*f.y),u.z=d.z+(o*g.z+s*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/n),c.push(e/i)}}for(let y=1;y<=n;y++)for(let e=1;e<=i;e++){const t=(i+1)*(y-1)+(e-1),n=(i+1)*y+(e-1),r=(i+1)*y+e,o=(i+1)*(y-1)+e;s.push(t,n,o),s.push(n,r,o)}function v(e,t,n,i,r){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);r.x=i*(2+l)*.5*o,r.y=i*(2+l)*s*.5,r.z=i*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new WB(a,3)),this.setAttribute("normal",new WB(l,3)),this.setAttribute("uv",new WB(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wk(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Qk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new GD(new tP(-1,-1,0),new tP(-1,1,0),new tP(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new tP,a=new tP,l=new EI;let c=new tP;const u=[],h=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);const l=o.normals[r],d=o.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+r*d.x,a.y=o*l.y+r*d.y,a.z=o*l.z+r*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),o=(i+1)*e+t,s=(i+1)*(e-1)+t;p.push(n,r,s),p.push(r,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new WB(u,3)),this.setAttribute("normal",new WB(h,3)),this.setAttribute("uv",new WB(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Qk((new WD[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class qk extends ZB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new tP,r=new tP;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let l=0;l<3;l++){const a=s.getX(e+l),c=s.getX(e+(l+1)%3);i.fromBufferAttribute(o,a),r.fromBufferAttribute(o,c),!0===Xk(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let e=0,s=o.count/3;e<s;e++)for(let a=0;a<3;a++){const s=3*e+a,l=3*e+(a+1)%3;i.fromBufferAttribute(o,s),r.fromBufferAttribute(o,l),!0===Xk(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new WB(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Xk(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var $k=Object.freeze({__proto__:null,BoxGeometry:pL,CapsuleGeometry:$D,CircleGeometry:YD,ConeGeometry:JD,CylinderGeometry:KD,DodecahedronGeometry:ek,EdgesGeometry:ok,ExtrudeGeometry:Dk,IcosahedronGeometry:Ok,LatheGeometry:XD,OctahedronGeometry:Uk,PlaneGeometry:Fk,PolyhedronGeometry:ZD,RingGeometry:zk,ShapeGeometry:jk,SphereGeometry:Vk,TetrahedronGeometry:Gk,TorusGeometry:Hk,TorusKnotGeometry:Wk,TubeGeometry:Qk,WireframeGeometry:qk});class Yk extends CB{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new wB(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Kk extends yL{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Jk extends CB{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new wB(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bR,this.normalScale=new EI(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new jP,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Zk extends Jk{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new EI(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yI(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new wB(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new wB(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new wB(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!==e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!==e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class eO extends CB{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new wB(16777215),this.specular=new wB(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bR,this.normalScale=new EI(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new jP,this.combine=_M,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tO extends CB{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new wB(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bR,this.normalScale=new EI(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class nO extends CB{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bR,this.normalScale=new EI(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class iO extends CB{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new wB(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new wB(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bR,this.normalScale=new EI(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new jP,this.combine=_M,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rO extends CB{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=vR,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class oO extends CB{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class sO extends CB{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new wB(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bR,this.normalScale=new EI(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class aO extends KN{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function lO(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function cO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function uO(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function hO(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const i=n[o]*t;for(let n=0;n!==t;++n)r[s++]=e[i+n]}return r}function dO(e,t,n,i){let r=1,o=e[0];for(;void 0!==o&&void 0===o[i];)o=e[r++];if(void 0===o)return;let s=o[i];if(void 0!==s)if(Array.isArray(s))do{s=o[i],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[i],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++]}while(void 0!==o);else do{s=o[i],void 0!==s&&(t.push(o.time),n.push(s)),o=e[r++]}while(void 0!==o)}const pO={convertArray:lO,isTypedArray:cO,getKeyframeOrder:uO,sortedArray:hO,flattenJSON:dO,subclip:function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const o=e.clone();o.name=t;const s=[];for(let l=0;l<o.tracks.length;++l){const e=o.tracks[l],t=e.getValueSize(),a=[],c=[];for(let o=0;o<e.times.length;++o){const s=e.times[o]*r;if(!(s<n||s>=i)){a.push(e.times[o]);for(let n=0;n<t;++n)c.push(e.values[o*t+n])}}0!==a.length&&(e.times=lO(a,e.times.constructor),e.values=lO(c,e.values.constructor),s.push(e))}o.tracks=s;let a=1/0;for(let l=0;l<o.tracks.length;++l)a>o.tracks[l].times[0]&&(a=o.tracks[l].times[0]);for(let l=0;l<o.tracks.length;++l)o.tracks[l].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);const r=n.tracks.length,o=t/i;for(let s=0;s<r;++s){const t=n.tracks[s],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const r=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===r)continue;let a=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=t.times.length-1;let d;if(o<=t.times[0]){const e=a,n=l-a;d=t.values.slice(e,n)}else if(o>=t.times[h]){const e=h*l+a,n=e+l-a;d=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=a,i=l-a;e.evaluate(o),d=e.resultBuffer.slice(n,i)}if("quaternion"===i){(new eP).fromArray(d).normalize().conjugate().toArray(d)}const p=r.times.length;for(let e=0;e<p;++e){const t=e*u+c;if("quaternion"===i)eP.multiplyQuaternionsFlat(r.values,t,d,0,r.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)r.values[t+n]-=d[n]}}}return e.blendMode=pR,e}};class fO{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=r)break e;{const s=t[1];e<s&&(n=2,r=s);for(let o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0}}for(;n<o;){const i=n+o>>>1;e<t[i]?o=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class mO extends fO{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:cR,endingEnd:cR}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,o=e+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case uR:r=e,s=2*t-n;break;case hR:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case uR:o=e,a=2*n-t;break;case hR:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,A=d*m-d*f;for(let x=0;x!==s;++x)r[x]=g*o[c+x]+v*o[l+x]+y*o[a+x]+A*o[u+x];return r}}class gO extends fO{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(i-t),u=1-c;for(let h=0;h!==s;++h)r[h]=o[l+h]*u+o[a+h]*c;return r}}class vO extends fO{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class yO{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=lO(t,this.TimeBufferType),this.values=lO(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:lO(e.times,Array),values:lO(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new vO(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new gO(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new mO(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case sR:t=this.InterpolantFactoryMethodDiscrete;break;case aR:t=this.InterpolantFactoryMethodLinear;break;case lR:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sR;case this.InterpolantFactoryMethodLinear:return aR;case this.InterpolantFactoryMethodSmooth:return lR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const e=this.getValueSize();this.times=n.slice(r,o),this.values=this.values.slice(r*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){const t=n[s];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==o&&o>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,o),e=!1;break}o=t}if(void 0!==i&&cO(i))for(let s=0,a=i.length;s!==a;++s){const t=i[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===lR,r=e.length-1;let o=1;for(let s=1;s<r;++s){let r=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(i)r=!0;else{const e=s*n,i=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[i+s]||n!==t[o+s]){r=!0;break}}}if(r){if(s!==o){e[o]=e[s];const i=s*n,r=o*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++o}}if(r>0){e[o]=e[r];for(let e=r*n,i=o*n,s=0;s!==n;++s)t[i+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}yO.prototype.TimeBufferType=Float32Array,yO.prototype.ValueBufferType=Float32Array,yO.prototype.DefaultInterpolation=aR;class AO extends yO{constructor(e,t,n){super(e,t,n)}}AO.prototype.ValueTypeName="bool",AO.prototype.ValueBufferType=Array,AO.prototype.DefaultInterpolation=sR,AO.prototype.InterpolantFactoryMethodLinear=void 0,AO.prototype.InterpolantFactoryMethodSmooth=void 0;class xO extends yO{}xO.prototype.ValueTypeName="color";class bO extends yO{}bO.prototype.ValueTypeName="number";class _O extends fO{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let l=e*s;for(let c=l+s;l!==c;l+=4)eP.slerpFlat(r,0,o,l-s,o,l,a);return r}}class wO extends yO{InterpolantFactoryMethodLinear(e){return new _O(this.times,this.values,this.getValueSize(),e)}}wO.prototype.ValueTypeName="quaternion",wO.prototype.InterpolantFactoryMethodSmooth=void 0;class EO extends yO{constructor(e,t,n){super(e,t,n)}}EO.prototype.ValueTypeName="string",EO.prototype.ValueBufferType=Array,EO.prototype.DefaultInterpolation=sR,EO.prototype.InterpolantFactoryMethodLinear=void 0,EO.prototype.InterpolantFactoryMethodSmooth=void 0;class SO extends yO{}SO.prototype.ValueTypeName="vector";class CO{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dR;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=vI(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,s=n.length;o!==s;++o)t.push(MO(n[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(yO.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let e=[],a=[];e.push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0);const l=uO(e);e=hO(e,1,l),a=hO(a,1,l),i||0!==e[0]||(e.push(r),a.push(a[0])),o.push(new bO(".morphTargetInfluences["+t[s].name+"]",e,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const t=e[s],n=t.name.match(r);if(n&&n.length>1){const e=n[1];let r=i[e];r||(i[e]=r=[]),r.push(t)}}const o=[];for(const s in i)o.push(this.CreateFromMorphTargetSequence(s,i[s],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const o=[],s=[];dO(n,o,s,i),0!==o.length&&r.push(new e(t,o,s))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const r in t){const t=[],o=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),o.push(i.morphTarget===r?1:0)}i.push(new bO(".morphTargetInfluence["+r+"]",t,o))}a=t.length*o}else{const r=".bones["+t[c].name+"]";n(SO,r+".position",e,"pos",i),n(wO,r+".quaternion",e,"rot",i),n(SO,r+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function MO(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return bO;case"vector":case"vector2":case"vector3":case"vector4":return SO;case"color":return xO;case"quaternion":return wO;case"bool":case"boolean":return AO;case"string":return EO}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];dO(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const TO={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class RO{constructor(e,t,n){const i=this;let r,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==i.onStart&&i.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,a),s===a&&(o=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const IO=new RO;class PO{constructor(e){this.manager=void 0!==e?e:IO,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}PO.DEFAULT_MATERIAL_NAME="__DEFAULT";const BO={};class LO extends Error{constructor(e,t){super(e),this.response=t}}class NO extends PO{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=TO.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==BO[e])return void BO[e].push({onLoad:t,onProgress:n,onError:i});BO[e]=[],BO[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=BO[e],i=t.body.getReader(),r=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),o=r?parseInt(r):0,s=0!==o;let a=0;const l=new ReadableStream({start(e){!function t(){i.read().then((i=>{let{done:r,value:l}=i;if(r)e.close();else{a+=l.byteLength;const i=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(l),t()}}),(t=>{e.error(t)}))}()}});return new Response(l)}throw new LO(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{TO.add(e,t);const n=BO[e];delete BO[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=BO[e];if(void 0===n)throw this.manager.itemError(e),t;delete BO[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class DO extends PO{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new NO(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(Jbe){i?i(Jbe):console.error(Jbe),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=CO.parse(e[n]);t.push(i)}return t}}class kO extends PO{constructor(e){super(e)}load(e,t,n,i){const r=this,o=[],s=new bD,a=new NO(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const n=r.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=$M),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,i)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)c(u);else a.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=$M),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,i);return s}}class OO extends PO{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=TO.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;const s=II("img");function a(){c(),TO.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class UO extends PO{constructor(e){super(e)}load(e,t,n,i){const r=new CL;r.colorSpace=ER;const o=new OO(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){r.images[n]=e,s++,6===s&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let l=0;l<e.length;++l)a(l);return r}}class FO extends PO{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new pN,s=new NO(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(e,(function(e){let n;try{n=r.parse(e)}catch(s){if(void 0===i)return void console.error(s);i(s)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:VM,o.wrapT=void 0!==n.wrapT?n.wrapT:VM,o.magFilter=void 0!==n.magFilter?n.magFilter:$M,o.minFilter=void 0!==n.minFilter?n.minFilter:$M,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(o.colorSpace=n.colorSpace),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=JM),1===n.mipmapCount&&(o.minFilter=$M),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n)}),n,i),o}}class zO extends PO{constructor(e){super(e)}load(e,t,n,i){const r=new QI,o=new OO(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class jO extends rB{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new wB(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class VO extends jO{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(rB.DEFAULT_UP),this.updateMatrix(),this.groundColor=new wB(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const GO=new PP,HO=new tP,WO=new tP;class QO{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new EI(512,512),this.map=null,this.mapPass=null,this.matrix=new PP,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new BN,this._frameExtents=new EI(1,1),this._viewportCount=1,this._viewports=[new qI(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;HO.setFromMatrixPosition(e.matrixWorld),t.position.copy(HO),WO.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(WO),t.updateMatrixWorld(),GO.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GO),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(GO)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class qO extends QO{constructor(){super(new wL(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*gI*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class XO extends jO{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(rB.DEFAULT_UP),this.updateMatrix(),this.target=new rB,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new qO}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const $O=new PP,YO=new tP,KO=new tP;class JO extends QO{constructor(){super(new wL(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new EI(4,2),this._viewportCount=6,this._viewports=[new qI(2,1,1,1),new qI(0,1,1,1),new qI(3,1,1,1),new qI(1,1,1,1),new qI(3,0,1,1),new qI(1,0,1,1)],this._cubeDirections=[new tP(1,0,0),new tP(-1,0,0),new tP(0,0,1),new tP(0,0,-1),new tP(0,1,0),new tP(0,-1,0)],this._cubeUps=[new tP(0,1,0),new tP(0,1,0),new tP(0,1,0),new tP(0,1,0),new tP(0,0,1),new tP(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),YO.setFromMatrixPosition(e.matrixWorld),n.position.copy(YO),KO.copy(n.position),KO.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(KO),n.updateMatrixWorld(),i.makeTranslation(-YO.x,-YO.y,-YO.z),$O.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix($O)}}class ZO extends jO{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new JO}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class eU extends AL{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,o=r+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class tU extends QO{constructor(){super(new eU(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class nU extends jO{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(rB.DEFAULT_UP),this.updateMatrix(),this.target=new rB,this.shadow=new tU}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class iU extends jO{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class rU extends jO{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class oU{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new tP)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*r*1.092548),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],n*r*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*r),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],.858086*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}class sU extends jO{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new oU;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class aU extends PO{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,o=new NO(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(Jbe){i?i(Jbe):console.error(Jbe),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new wB).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(i.dispersion=e.dispersion),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const r in e.uniforms){const t=e.uniforms[r];switch(i.uniforms[r]={},t.type){case"t":i.uniforms[r].value=n(t.value);break;case"c":i.uniforms[r].value=(new wB).setHex(t.value);break;case"v2":i.uniforms[r].value=(new EI).fromArray(t.value);break;case"v3":i.uniforms[r].value=(new tP).fromArray(t.value);break;case"v4":i.uniforms[r].value=(new qI).fromArray(t.value);break;case"m3":i.uniforms[r].value=(new SI).fromArray(t.value);break;case"m4":i.uniforms[r].value=(new PP).fromArray(t.value);break;default:i.uniforms[r].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new EI).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapRotation&&i.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new EI).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return aU.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:Yk,SpriteMaterial:OL,RawShaderMaterial:Kk,ShaderMaterial:yL,PointsMaterial:hD,MeshPhysicalMaterial:Zk,MeshStandardMaterial:Jk,MeshPhongMaterial:eO,MeshToonMaterial:tO,MeshNormalMaterial:nO,MeshLambertMaterial:iO,MeshDepthMaterial:rO,MeshDistanceMaterial:oO,MeshBasicMaterial:MB,MeshMatcapMaterial:sO,LineDashedMaterial:aO,LineBasicMaterial:KN,Material:CB}[e]}}class lU{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(Jbe){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class cU extends ZB{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class uU extends PO{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new NO(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(Jbe){i?i(Jbe):console.error(Jbe),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],o=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,r=i[t],o=new Uint32Array(r).buffer;return n[t]=o,o}(e,r.buffer),s=RI(r.type,o),a=new NL(s,r.stride);return a.uuid=r.uuid,t[i]=a,a}const r=e.isInstancedBufferGeometry?new cU:new ZB,o=e.data.index;if(void 0!==o){const e=RI(o.type,o.array);r.setIndex(new kB(e,1))}const s=e.data.attributes;for(const u in s){const t=s[u];let n;if(t.isInterleavedBufferAttribute){const r=i(e.data,t.data);n=new kL(r,t.itemSize,t.offset,t.normalized)}else{const e=RI(t.type,t.array);n=new(t.isInstancedBufferAttribute?vN:kB)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),r.setAttribute(u,n)}const a=e.data.morphAttributes;if(a)for(const u in a){const t=a[u],n=[];for(let r=0,o=t.length;r<o;r++){const o=t[r];let s;if(o.isInterleavedBufferAttribute){const t=i(e.data,o.data);s=new kL(t,o.itemSize,o.offset,o.normalized)}else{const e=RI(o.type,o.array);s=new kB(e,o.itemSize,o.normalized)}void 0!==o.name&&(s.name=o.name),n.push(s)}r.morphAttributes[u]=n}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,h=l.length;u!==h;++u){const e=l[u];r.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new tP;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new _P(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class hU extends PO{constructor(e){super(e)}load(e,t,n,i){const r=this,o=""===this.path?lU.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new NO(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(a){return void 0!==i&&i(a),void console.error("THREE:ObjectLoader: Can't parse "+e+".",a.message)}const s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);r.parse(o,t)}),n,i)}async loadAsync(e,t){const n=""===this.path?lU.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new NO(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),o=JSON.parse(r),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,r,a,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in o)if(o[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,i,s,o,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),this.bindLightTargets(a),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new sk).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let r=0,o=e.length;r<o;r++){const t=(new gN).fromJSON(e[r],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new uU;for(let r=0,o=e.length;r<o;r++){let o;const s=e[r];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:s.type in $k?o=$k[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new aU;r.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];void 0===n[o.uuid]&&(n[o.uuid]=r.parse(o)),i[o.uuid]=n[o.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=CO.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function o(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:RI(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new RO(t);r=new OO(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const n=e[t],r=n.url;if(Array.isArray(r)){const e=[];for(let t=0,n=r.length;t<n;t++){const n=o(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new pN(n.data,n.width,n.height)))}i[n.uuid]=new GI(e)}else{const e=o(n.url);i[n.uuid]=new GI(e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"===typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:RI(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new OO(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.url;if(Array.isArray(o)){const e=[];for(let t=0,n=o.length;t<n;t++){const n=o[t],i=await r(n);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new pN(i.data,i.width,i.height)))}n[i.uuid]=new GI(e)}else{const e=await r(i.url);n[i.uuid]=new GI(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,o=e.length;r<o;r++){const o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const s=t[o.image],a=s.data;let l;Array.isArray(a)?(l=new CL,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new pN:new QI,a&&(l.needsUpdate=!0)),l.source=s,l.uuid=o.uuid,void 0!==o.name&&(l.name=o.name),void 0!==o.mapping&&(l.mapping=n(o.mapping,dU)),void 0!==o.channel&&(l.channel=o.channel),void 0!==o.offset&&l.offset.fromArray(o.offset),void 0!==o.repeat&&l.repeat.fromArray(o.repeat),void 0!==o.center&&l.center.fromArray(o.center),void 0!==o.rotation&&(l.rotation=o.rotation),void 0!==o.wrap&&(l.wrapS=n(o.wrap[0],pU),l.wrapT=n(o.wrap[1],pU)),void 0!==o.format&&(l.format=o.format),void 0!==o.internalFormat&&(l.internalFormat=o.internalFormat),void 0!==o.type&&(l.type=o.type),void 0!==o.colorSpace&&(l.colorSpace=o.colorSpace),void 0!==o.minFilter&&(l.minFilter=n(o.minFilter,fU)),void 0!==o.magFilter&&(l.magFilter=n(o.magFilter,fU)),void 0!==o.anisotropy&&(l.anisotropy=o.anisotropy),void 0!==o.flipY&&(l.flipY=o.flipY),void 0!==o.generateMipmaps&&(l.generateMipmaps=o.generateMipmaps),void 0!==o.premultiplyAlpha&&(l.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(l.unpackAlignment=o.unpackAlignment),void 0!==o.compareFunction&&(l.compareFunction=o.compareFunction),void 0!==o.userData&&(l.userData=o.userData),i[o.uuid]=l}return i}parseObject(e,t,n,i,r){let o,s,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":o=new LL,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new wB(e.background):o.background=u(e.background)),void 0!==e.environment&&(o.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new BL(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new PL(e.fog.color,e.fog.density)),""!==e.fog.name&&(o.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(o.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(o.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&o.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(o.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new wL(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new eU(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new iU(e.color,e.intensity);break;case"DirectionalLight":o=new nU(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new ZO(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new rU(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new XO(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new VO(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new sU).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),a=c(e.material),o=new hN(s,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),a=c(e.material),o=new hL(s,a);break;case"InstancedMesh":s=l(e.geometry),a=c(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;o=new SN(s,a,t),o.instanceMatrix=new vN(new Float32Array(n.array),16),void 0!==i&&(o.instanceColor=new vN(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":s=l(e.geometry),a=c(e.material),o=new YN(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,a),o.geometry=s,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map((e=>{const t=new rP;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const n=new _P;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:n}})),o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=u(e.matricesTexture.uuid),void 0!==e.colorsTexture&&(o._colorsTexture=u(e.colorsTexture.uuid));break;case"LOD":o=new tN;break;case"Line":o=new oD(l(e.geometry),c(e.material));break;case"LineLoop":o=new uD(l(e.geometry),c(e.material));break;case"LineSegments":o=new cD(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new gD(l(e.geometry),c(e.material));break;case"Sprite":o=new KL(c(e.material));break;case"Group":o=new TL;break;case"Bone":o=new dN;break;default:o=new rB}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.up&&o.up.fromArray(e.up),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(o.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=o.getObjectByProperty("uuid",n.object);void 0!==i&&o.addLevel(i,n.distance,n.hysteresis)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}bindLightTargets(e){e.traverse((function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);t.target=void 0!==i?i:new rB}}))}}const dU={UVMapping:DM,CubeReflectionMapping:kM,CubeRefractionMapping:OM,EquirectangularReflectionMapping:UM,EquirectangularRefractionMapping:FM,CubeUVReflectionMapping:zM},pU={RepeatWrapping:jM,ClampToEdgeWrapping:VM,MirroredRepeatWrapping:GM},fU={NearestFilter:HM,NearestMipmapNearestFilter:WM,NearestMipmapLinearFilter:qM,LinearFilter:$M,LinearMipmapNearestFilter:YM,LinearMipmapLinearFilter:JM};class mU extends PO{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=TO.get(e);if(void 0!==o)return r.manager.itemStart(e),o.then?void o.then((n=>{t&&t(n),r.manager.itemEnd(e)})).catch((e=>{i&&i(e)})):(setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o);const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;const a=fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){return TO.add(e,n),t&&t(n),r.manager.itemEnd(e),n})).catch((function(t){i&&i(t),TO.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)}));TO.add(e,a),r.manager.itemStart(e)}}let gU;class vU{static getContext(){return void 0===gU&&(gU=new(window.AudioContext||window.webkitAudioContext)),gU}static setContext(e){gU=e}}class yU extends PO{constructor(e){super(e)}load(e,t,n,i){const r=this,o=new NO(this.manager);function s(t){i?i(t):console.error(t),r.manager.itemError(e)}o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(e){try{const n=e.slice(0);vU.getContext().decodeAudioData(n,(function(e){t(e)})).catch(s)}catch(Jbe){s(Jbe)}}),n,i)}}const AU=new PP,xU=new PP,bU=new PP;class _U{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new wL,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new wL,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,bU.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,r=t.near*Math.tan(mI*t.fov*.5)/t.zoom;let o,s;xU.elements[12]=-n,AU.elements[12]=n,o=-r*t.aspect+i,s=r*t.aspect+i,bU.elements[0]=2*t.near/(s-o),bU.elements[8]=(s+o)/(s-o),this.cameraL.projectionMatrix.copy(bU),o=-r*t.aspect-i,s=r*t.aspect-i,bU.elements[0]=2*t.near/(s-o),bU.elements[8]=(s+o)/(s-o),this.cameraR.projectionMatrix.copy(bU)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(xU),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(AU)}}class wU extends wL{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class EU{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=SU(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=SU();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function SU(){return performance.now()}const CU=new tP,MU=new eP,TU=new tP,RU=new tP;class IU extends rB{constructor(){super(),this.type="AudioListener",this.context=vU.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new EU}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(CU,MU,TU),RU.set(0,0,-1).applyQuaternion(MU),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(CU.x,e),t.positionY.linearRampToValueAtTime(CU.y,e),t.positionZ.linearRampToValueAtTime(CU.z,e),t.forwardX.linearRampToValueAtTime(RU.x,e),t.forwardY.linearRampToValueAtTime(RU.y,e),t.forwardZ.linearRampToValueAtTime(RU.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(CU.x,CU.y,CU.z),t.setOrientation(RU.x,RU.y,RU.z,n.x,n.y,n.z)}}class PU extends rB{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const BU=new tP,LU=new eP,NU=new tP,DU=new tP;class kU extends PU{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(BU,LU,NU),DU.set(0,0,1).applyQuaternion(LU);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(BU.x,e),t.positionY.linearRampToValueAtTime(BU.y,e),t.positionZ.linearRampToValueAtTime(BU.z,e),t.orientationX.linearRampToValueAtTime(DU.x,e),t.orientationY.linearRampToValueAtTime(DU.y,e),t.orientationZ.linearRampToValueAtTime(DU.z,e)}else t.setPosition(BU.x,BU.y,BU.z),t.setOrientation(DU.x,DU.y,DU.z)}}class OU{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class UU{constructor(e,t,n){let i,r,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==i;++e)n[r+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){s.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){eP.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const o=this._workIndex*r;eP.multiplyQuaternionsFlat(e,o,e,t,e,n),eP.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const r=t+s;e[r]=e[r]*o+e[n+s]*i}}_lerpAdditive(e,t,n,i,r){for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]+e[n+o]*i}}}const FU="\\[\\]\\.:\\/",zU=new RegExp("["+FU+"]","g"),jU="[^"+FU+"]",VU="[^"+FU.replace("\\.","")+"]",GU=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",jU)+/(WCOD+)?/.source.replace("WCOD",VU)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jU)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jU)+"$"),HU=["material","materials","bones","map"];class WU{constructor(e,t,n){this.path=t,this.parsedPath=n||WU.parseTrackName(t),this.node=WU.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new WU.Composite(e,t,n):new WU(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(zU,"")}static parseTrackName(e){const t=GU.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==HU.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const o=n(r.children);if(o)return o}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=WU.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const o=e[i];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?s=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}WU.Composite=class{constructor(e,t,n){const i=n||WU.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},WU.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},WU.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},WU.prototype.GetterByBindingType=[WU.prototype._getValue_direct,WU.prototype._getValue_array,WU.prototype._getValue_arrayElement,WU.prototype._getValue_toArray],WU.prototype.SetterByBindingTypeAndVersioning=[[WU.prototype._setValue_direct,WU.prototype._setValue_direct_setNeedsUpdate,WU.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[WU.prototype._setValue_array,WU.prototype._setValue_array_setNeedsUpdate,WU.prototype._setValue_array_setMatrixWorldNeedsUpdate],[WU.prototype._setValue_arrayElement,WU.prototype._setValue_arrayElement_setNeedsUpdate,WU.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[WU.prototype._setValue_fromArray,WU.prototype._setValue_fromArray_setNeedsUpdate,WU.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class QU{constructor(){this.isAnimationObjectGroup=!0,this.uuid=vI(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)r[e].push(new WU(u,n[e],i[e]))}else if(d<l){s=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=r[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new WU(u,n[e],i[e])),t[a]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,l=t[a];if(void 0!==l&&l>=r){const o=r++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=s;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[o],r=t[l];t[l]=i,t[o]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<r){const s=--r,a=e[s],c=--o,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[s],r=t[c];t[l]=i,t[s]=r,t.pop()}}else{const r=--o,s=e[r];r>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);i=r.length,n[e]=i,o.push(e),s.push(t),r.push(u);for(let h=c,d=a.length;h!==d;++h){const n=a[h];u[h]=new WU(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}}class qU{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:cR,endingEnd:cR};for(let l=0;l!==o;++l){const e=r[l].createInterpolant(null);s[l]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=rR,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,o=n/i;e.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;i<0||0===n?t=0:(this._startTime=null,t=n*i)}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===pR)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulate(i,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===oR;if(0===e)return-1===r?i:o&&1===(1&r)?t-i:i;if(n===iR){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(o&&1===(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=uR,i.endingEnd=uR):(i.endingStart=e?this.zeroSlopeAtStart?uR:cR:hR,i.endingEnd=t?this.zeroSlopeAtEnd?uR:cR:hR)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=n,this}}const XU=new Float32Array(1);class $U extends dI{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let u=0;u!==r;++u){const e=i[u],r=e.name;let l=c[r];if(void 0!==l)++l.referenceCount,o[u]=l;else{if(l=o[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,r));continue}const i=t&&t._propertyBindings[u].binding.parsedPath;l=new UU(WU.create(n,r,i),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,r),o[u]=l}s[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[r],0===Object.keys(s).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new gO(new Float32Array(2),new Float32Array(2),1,XU),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let o="string"===typeof e?CO.findByName(i,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:dR),void 0!==a){const e=a.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new qU(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"===typeof e?CO.findByName(n,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==n;++l){t[l]._update(i,e,r,o)}const s=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)s[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,o=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,o._cacheIndex=r,t[r]=o,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const e=n[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const r in i){const e=i[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class YU extends XI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isRenderTarget3D=!0,this.depth=n,this.texture=new JI(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class KU extends XI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isRenderTargetArray=!0,this.depth=n,this.texture=new YI(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class JU{constructor(e){this.value=e}clone(){return new JU(void 0===this.value.clone?this.value:this.value.clone())}}let ZU=0;class eF extends dI{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ZU++}),this.name="",this.usage=JR,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}}class tF extends NL{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class nF{constructor(e,t,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const iF=new PP;class rF{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new IP(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new VP,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return iF.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(iF),this}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return sF(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(oF),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,r=e.length;i<r;i++)sF(e[i],this,n,t);return n.sort(oF),n}}function oF(e,t){return e.distance-t.distance}function sF(e,t,n,i){let r=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(r=!1)}if(!0===r&&!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)sF(i[e],t,n,!0)}}class aF{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=yI(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(yI(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class lF{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}class cF{constructor(e,t,n,i){cF.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const r=this.elements;return r[0]=e,r[2]=t,r[1]=n,r[3]=i,this}}const uF=new EI;class hF{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new EI(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new EI(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=uF.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,uF).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const dF=new tP,pF=new tP;class fF{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){dF.subVectors(e,this.start),pF.subVectors(this.end,this.start);const n=pF.dot(pF);let i=pF.dot(dF)/n;return t&&(i=yI(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const mF=new tP;class gF extends rB{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new ZB,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){const e=o/a*Math.PI*2,t=s/a*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new WB(i,3));const r=new KN({fog:!1,toneMapped:!1});this.cone=new cD(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),mF.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(mF),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const vF=new tP,yF=new PP,AF=new PP;class xF extends cD{constructor(e){const t=bF(e),n=new ZB,i=[],r=[],o=new wB(0,0,1),s=new wB(0,1,0);for(let a=0;a<t.length;a++){const e=t[a];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new WB(i,3)),n.setAttribute("color",new WB(r,3));super(n,new KN({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");AF.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const e=t[r];e.parent&&e.parent.isBone&&(yF.multiplyMatrices(AF,e.matrixWorld),vF.setFromMatrixPosition(yF),i.setXYZ(o,vF.x,vF.y,vF.z),yF.multiplyMatrices(AF,e.parent.matrixWorld),vF.setFromMatrixPosition(yF),i.setXYZ(o+1,vF.x,vF.y,vF.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function bF(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,bF(e.children[n]));return t}class _F extends hL{constructor(e,t,n){super(new Vk(t,4,2),new MB({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const wF=new tP,EF=new wB,SF=new wB;class CF extends rB{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Uk(t);i.rotateY(.5*Math.PI),this.material=new MB({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(3*r.count);i.setAttribute("color",new kB(o,3)),this.add(new hL(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");EF.copy(this.light.color),SF.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?EF:SF;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(wF.setFromMatrixPosition(this.light.matrixWorld).negate())}}class MF extends cD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new wB(n),i=new wB(i);const r=t/2,o=e/t,s=e/2,a=[],l=[];for(let u=0,h=0,d=-s;u<=t;u++,d+=o){a.push(-s,0,d,s,0,d),a.push(d,0,-s,d,0,s);const e=u===r?n:i;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const c=new ZB;c.setAttribute("position",new WB(a,3)),c.setAttribute("color",new WB(l,3));super(c,new KN({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class TF extends cD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;r=new wB(r),o=new wB(o);const s=[],a=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),i=Math.sin(n)*e,l=Math.cos(n)*e;s.push(0,0,0),s.push(i,0,l);const u=1&c?r:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?r:o,l=e-e/n*c;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),r=Math.sin(n)*l,o=Math.cos(n)*l;s.push(r,0,o),a.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),r=Math.sin(n)*l,o=Math.cos(n)*l,s.push(r,0,o),a.push(t.r,t.g,t.b)}}const l=new ZB;l.setAttribute("position",new WB(s,3)),l.setAttribute("color",new WB(a,3));super(l,new KN({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const RF=new tP,IF=new tP,PF=new tP;class BF extends rB{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new ZB;i.setAttribute("position",new WB([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new KN({fog:!1,toneMapped:!1});this.lightPlane=new oD(i,r),this.add(this.lightPlane),i=new ZB,i.setAttribute("position",new WB([0,0,0,0,0,1],3)),this.targetLine=new oD(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),RF.setFromMatrixPosition(this.light.matrixWorld),IF.setFromMatrixPosition(this.light.target.matrixWorld),PF.subVectors(IF,RF),this.lightPlane.lookAt(IF),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(IF),this.targetLine.scale.z=PF.length()}}const LF=new tP,NF=new AL;class DF extends cD{constructor(e){const t=new ZB,n=new KN({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};function s(e,t){a(e),a(t)}function a(e){i.push(0,0,0),r.push(0,0,0),void 0===o[e]&&(o[e]=[]),o[e].push(i.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new WB(i,3)),t.setAttribute("color",new WB(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new wB(16755200),c=new wB(16711680),u=new wB(43775),h=new wB(16777215),d=new wB(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,n,i,r){const o=this.geometry.getAttribute("color");o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,t.r,t.g,t.b),o.setXYZ(25,t.r,t.g,t.b),o.setXYZ(26,t.r,t.g,t.b),o.setXYZ(27,t.r,t.g,t.b),o.setXYZ(28,t.r,t.g,t.b),o.setXYZ(29,t.r,t.g,t.b),o.setXYZ(30,t.r,t.g,t.b),o.setXYZ(31,t.r,t.g,t.b),o.setXYZ(32,n.r,n.g,n.b),o.setXYZ(33,n.r,n.g,n.b),o.setXYZ(34,n.r,n.g,n.b),o.setXYZ(35,n.r,n.g,n.b),o.setXYZ(36,n.r,n.g,n.b),o.setXYZ(37,n.r,n.g,n.b),o.setXYZ(38,i.r,i.g,i.b),o.setXYZ(39,i.r,i.g,i.b),o.setXYZ(40,r.r,r.g,r.b),o.setXYZ(41,r.r,r.g,r.b),o.setXYZ(42,r.r,r.g,r.b),o.setXYZ(43,r.r,r.g,r.b),o.setXYZ(44,r.r,r.g,r.b),o.setXYZ(45,r.r,r.g,r.b),o.setXYZ(46,r.r,r.g,r.b),o.setXYZ(47,r.r,r.g,r.b),o.setXYZ(48,r.r,r.g,r.b),o.setXYZ(49,r.r,r.g,r.b),o.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;NF.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const n=this.camera.coordinateSystem===cI?-1:0;kF("c",t,e,NF,0,0,n),kF("t",t,e,NF,0,0,1),kF("n1",t,e,NF,-1,-1,n),kF("n2",t,e,NF,1,-1,n),kF("n3",t,e,NF,-1,1,n),kF("n4",t,e,NF,1,1,n),kF("f1",t,e,NF,-1,-1,1),kF("f2",t,e,NF,1,-1,1),kF("f3",t,e,NF,-1,1,1),kF("f4",t,e,NF,1,1,1),kF("u1",t,e,NF,.7,1.1,n),kF("u2",t,e,NF,-.7,1.1,n),kF("u3",t,e,NF,0,2,n),kF("cf1",t,e,NF,-1,0,1),kF("cf2",t,e,NF,1,0,1),kF("cf3",t,e,NF,0,-1,1),kF("cf4",t,e,NF,0,1,1),kF("cn1",t,e,NF,-1,0,n),kF("cn2",t,e,NF,1,0,n),kF("cn3",t,e,NF,0,-1,n),kF("cn4",t,e,NF,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function kF(e,t,n,i,r,o,s){LF.set(r,o,s).unproject(i);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],LF.x,LF.y,LF.z)}}const OF=new rP;class UF extends cD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new ZB;r.setIndex(new kB(n,1)),r.setAttribute("position",new kB(i,3)),super(r,new KN({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&OF.setFromObject(this.object),OF.isEmpty())return;const t=OF.min,n=OF.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class FF extends cD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new ZB;i.setIndex(new kB(n,1)),i.setAttribute("position",new WB([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new KN({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class zF extends oD{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,i=new ZB;i.setAttribute("position",new WB([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new KN({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new ZB;r.setAttribute("position",new WB([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new hL(r,new MB({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const jF=new tP;let VF,GF;class HF extends rB{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tP(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tP(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*r;super(),this.type="ArrowHelper",void 0===VF&&(VF=new ZB,VF.setAttribute("position",new WB([0,0,0,0,1,0],3)),GF=new KD(0,.5,1,5,1),GF.translate(0,-.5,0)),this.position.copy(t),this.line=new oD(VF,new KN({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new hL(GF,new MB({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{jF.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(jF,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class WF extends cD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new ZB;n.setAttribute("position",new WB(t,3)),n.setAttribute("color",new WB([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new KN({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new wB,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class QF{constructor(){this.type="ShapePath",this.color=new wB,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new qD,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let i=!1;for(let r=n-1,o=0;o<n;r=o++){let n=t[r],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[r],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return i}const n=Bk.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,o,s;const a=[];if(1===i.length)return o=i[0],s=new sk,s.curves=o.curves,a.push(s),a;let l=!n(i[0].getPoints());l=e?!l:l;const c=[],u=[];let h,d,p=[],f=0;u[f]=void 0,p[f]=[];for(let m=0,g=i.length;m<g;m++)o=i[m],h=o.getPoints(),r=n(h),r=e?!r:r,r?(!l&&u[f]&&f++,u[f]={s:new sk,p:h},u[f].s.curves=o.curves,l&&f++,p[f]=[]):p[f].push({h:o,p:h[0]});if(!u[0])return function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new sk;r.curves=i.curves,t.push(r)}return t}(i);if(u.length>1){let e=!1,n=0;for(let t=0,i=u.length;t<i;t++)c[t]=[];for(let i=0,r=u.length;i<r;i++){const r=p[i];for(let o=0;o<r.length;o++){const s=r[o];let a=!0;for(let r=0;r<u.length;r++)t(s.p,u[r].p)&&(i!==r&&n++,a?(a=!1,c[r].push(s)):e=!0);a&&c[i].push(s)}}n>0&&!1===e&&(p=c)}for(let m=0,g=u.length;m<g;m++){s=u[m].s,a.push(s),d=p[m];for(let e=0,t=d.length;e<t;e++)s.holes.push(d[e].h)}return a}}class qF extends dI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function XF(e,t,n,i){const r=function(e){switch(e){case eT:case tT:return{byteLength:1,components:1};case iT:case nT:case aT:return{byteLength:2,components:1};case lT:case cT:return{byteLength:2,components:4};case oT:case rT:case sT:return{byteLength:4,components:1};case hT:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(i);switch(n){case dT:case mT:return e*t;case gT:return e*t*2;case AT:case xT:return e*t/r.components*r.byteLength;case bT:case _T:return e*t*2/r.components*r.byteLength;case pT:return e*t*3/r.components*r.byteLength;case fT:case ET:return e*t*4/r.components*r.byteLength;case ST:case CT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case MT:case TT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case IT:case BT:return Math.max(e,16)*Math.max(t,8)/4;case RT:case PT:return Math.max(e,8)*Math.max(t,8)/2;case LT:case NT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case DT:case kT:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case OT:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case UT:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case FT:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case zT:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case jT:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case VT:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case GT:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case HT:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case WT:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case QT:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case qT:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case XT:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case $T:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case YT:case KT:case JT:return Math.ceil(e/4)*Math.ceil(t/4)*16;case ZT:case eR:return Math.ceil(e/4)*Math.ceil(t/4)*8;case tR:case nR:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}const $F={contain:function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e},cover:function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e},fill:function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e},getByteLength:XF};function YF(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function KF(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,o=i.byteLength,s=e.createBuffer();let a;if(e.bindBuffer(n,s),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)a=e.FLOAT;else if(i instanceof Uint16Array)a=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)a=e.SHORT;else if(i instanceof Uint32Array)a=e.UNSIGNED_INT;else if(i instanceof Int32Array)a=e.INT;else if(i instanceof Int8Array)a=e.BYTE;else if(i instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=e.UNSIGNED_BYTE}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:o}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,o=n.updateRanges;if(e.bindBuffer(i,t),0===o.length)e.bufferSubData(i,0,r);else{o.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<o.length;e++){const n=o[t],i=o[e];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++t,o[t]=i)}o.length=t+1;for(let n=0,s=o.length;n<s;n++){const t=o[n];e.bufferSubData(i,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:TC}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=TC);const JF={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ZF={common:{diffuse:{value:new wB(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new SI},alphaMap:{value:null},alphaMapTransform:{value:new SI},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new SI}},envmap:{envMap:{value:null},envMapRotation:{value:new SI},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new SI}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new SI}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new SI},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new SI},normalScale:{value:new EI(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new SI},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new SI}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new SI}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new SI}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wB(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wB(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new SI},alphaTest:{value:0},uvTransform:{value:new SI}},sprite:{diffuse:{value:new wB(16777215)},opacity:{value:1},center:{value:new EI(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new SI},alphaMap:{value:null},alphaMapTransform:{value:new SI},alphaTest:{value:0}}},ez={basic:{uniforms:mL([ZF.common,ZF.specularmap,ZF.envmap,ZF.aomap,ZF.lightmap,ZF.fog]),vertexShader:JF.meshbasic_vert,fragmentShader:JF.meshbasic_frag},lambert:{uniforms:mL([ZF.common,ZF.specularmap,ZF.envmap,ZF.aomap,ZF.lightmap,ZF.emissivemap,ZF.bumpmap,ZF.normalmap,ZF.displacementmap,ZF.fog,ZF.lights,{emissive:{value:new wB(0)}}]),vertexShader:JF.meshlambert_vert,fragmentShader:JF.meshlambert_frag},phong:{uniforms:mL([ZF.common,ZF.specularmap,ZF.envmap,ZF.aomap,ZF.lightmap,ZF.emissivemap,ZF.bumpmap,ZF.normalmap,ZF.displacementmap,ZF.fog,ZF.lights,{emissive:{value:new wB(0)},specular:{value:new wB(1118481)},shininess:{value:30}}]),vertexShader:JF.meshphong_vert,fragmentShader:JF.meshphong_frag},standard:{uniforms:mL([ZF.common,ZF.envmap,ZF.aomap,ZF.lightmap,ZF.emissivemap,ZF.bumpmap,ZF.normalmap,ZF.displacementmap,ZF.roughnessmap,ZF.metalnessmap,ZF.fog,ZF.lights,{emissive:{value:new wB(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:JF.meshphysical_vert,fragmentShader:JF.meshphysical_frag},toon:{uniforms:mL([ZF.common,ZF.aomap,ZF.lightmap,ZF.emissivemap,ZF.bumpmap,ZF.normalmap,ZF.displacementmap,ZF.gradientmap,ZF.fog,ZF.lights,{emissive:{value:new wB(0)}}]),vertexShader:JF.meshtoon_vert,fragmentShader:JF.meshtoon_frag},matcap:{uniforms:mL([ZF.common,ZF.bumpmap,ZF.normalmap,ZF.displacementmap,ZF.fog,{matcap:{value:null}}]),vertexShader:JF.meshmatcap_vert,fragmentShader:JF.meshmatcap_frag},points:{uniforms:mL([ZF.points,ZF.fog]),vertexShader:JF.points_vert,fragmentShader:JF.points_frag},dashed:{uniforms:mL([ZF.common,ZF.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:JF.linedashed_vert,fragmentShader:JF.linedashed_frag},depth:{uniforms:mL([ZF.common,ZF.displacementmap]),vertexShader:JF.depth_vert,fragmentShader:JF.depth_frag},normal:{uniforms:mL([ZF.common,ZF.bumpmap,ZF.normalmap,ZF.displacementmap,{opacity:{value:1}}]),vertexShader:JF.meshnormal_vert,fragmentShader:JF.meshnormal_frag},sprite:{uniforms:mL([ZF.sprite,ZF.fog]),vertexShader:JF.sprite_vert,fragmentShader:JF.sprite_frag},background:{uniforms:{uvTransform:{value:new SI},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:JF.background_vert,fragmentShader:JF.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new SI}},vertexShader:JF.backgroundCube_vert,fragmentShader:JF.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:JF.cube_vert,fragmentShader:JF.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:JF.equirect_vert,fragmentShader:JF.equirect_frag},distanceRGBA:{uniforms:mL([ZF.common,ZF.displacementmap,{referencePosition:{value:new tP},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:JF.distanceRGBA_vert,fragmentShader:JF.distanceRGBA_frag},shadow:{uniforms:mL([ZF.lights,ZF.fog,{color:{value:new wB(0)},opacity:{value:1}}]),vertexShader:JF.shadow_vert,fragmentShader:JF.shadow_frag}};ez.physical={uniforms:mL([ez.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new SI},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new SI},clearcoatNormalScale:{value:new EI(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new SI},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new SI},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new SI},sheen:{value:0},sheenColor:{value:new wB(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new SI},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new SI},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new SI},transmissionSamplerSize:{value:new EI},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new SI},attenuationDistance:{value:0},attenuationColor:{value:new wB(0)},specularColor:{value:new wB(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new SI},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new SI},anisotropyVector:{value:new EI},anisotropyMap:{value:null},anisotropyMapTransform:{value:new SI}}]),vertexShader:JF.meshphysical_vert,fragmentShader:JF.meshphysical_frag};const tz={r:0,b:0,g:0},nz=new jP,iz=new PP;function rz(e,t,n,i,r,o,s){const a=new wB(0);let l,c,u=!0===o?0:1,h=null,d=0,p=null;function f(e){let i=!0===e.isScene?e.background:null;if(i&&i.isTexture){i=(e.backgroundBlurriness>0?n:t).get(i)}return i}function m(t,n){t.getRGB(tz,gL(e)),i.buffers.color.setClear(tz.r,tz.g,tz.b,n,s)}return{getClearColor:function(){return a},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;a.set(e),u=t,m(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(a,u)},render:function(t){let n=!1;const r=f(t);null===r?m(a,u):r&&r.isColor&&(m(r,1),n=!0);const o=e.xr.getEnvironmentBlendMode();"additive"===o?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===o&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===zM)?(void 0===c&&(c=new hL(new pL(1e4,1e4,1e4),new yL({name:"BackgroundCubeMaterial",uniforms:fL(ez.backgroundCube.uniforms),vertexShader:ez.backgroundCube.vertexShader,fragmentShader:ez.backgroundCube.fragmentShader,side:zC,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),nz.copy(n.backgroundRotation),nz.x*=-1,nz.y*=-1,nz.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(nz.y*=-1,nz.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(iz.makeRotationFromEuler(nz)),c.material.toneMapped=OI.getTransfer(i.colorSpace)!==MR,h===i&&d===i.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new hL(new Fk(2,2),new yL({name:"BackgroundMaterial",uniforms:fL(ez.background.uniforms),vertexShader:ez.background.vertexShader,fragmentShader:ez.background.fragmentShader,side:FC,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=OI.getTransfer(i.colorSpace)!==MR,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function oz(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=c(null);let o=r,s=!1;function a(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],i=[],r=[];for(let o=0;o<n;o++)t[o]=0,i[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function u(){const e=o.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const i=o.newAttributes,r=o.enabledAttributes,s=o.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function p(){const t=o.newAttributes,n=o.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,i,r,o,s,a){!0===a?e.vertexAttribIPointer(t,n,i,o,s):e.vertexAttribPointer(t,n,i,r,o,s)}function m(){g(),s=!0,o!==r&&(o=r,a(o.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const y=function(t,n,r){const o=!0===r.wireframe;let s=i[t.id];void 0===s&&(s={},i[t.id]=s);let a=s[n.id];void 0===a&&(a={},s[n.id]=a);let l=a[o];void 0===l&&(l=c(e.createVertexArray()),a[o]=l);return l}(m,l,r);o!==y&&(o=y,a(o.object)),v=function(e,t,n,i){const r=o.attributes,s=t.attributes;let a=0;const l=n.getAttributes();for(const o in l){if(l[o].location>=0){const t=r[o];let n=s[o];if(void 0===n&&("instanceMatrix"===o&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===o&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;a++}}return o.attributesNum!==a||o.index!==i}(n,m,l,g),v&&function(e,t,n,i){const r={},s=t.attributes;let a=0;const l=n.getAttributes();for(const o in l){if(l[o].location>=0){let t=s[o];void 0===t&&("instanceMatrix"===o&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===o&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[o]=n,a++}}o.attributes=r,o.attributesNum=a,o.index=i}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||s)&&(s=!1,function(n,i,r,o){u();const s=o.attributes,a=r.getAttributes(),l=i.defaultAttributeValues;for(const c in a){const i=a[c];if(i.location>=0){let r=s[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const s=r.normalized,a=r.itemSize,l=t.get(r);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||r.gpuType===rT;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)d(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,u,s,l*p,(g+a/i.locationSize*e)*p,m)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)d(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,u,s,a*p,a/i.locationSize*e*p,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:p}}function sz(e,t,n){let i;function r(t,r,o){0!==o&&(e.drawArraysInstanced(i,t,r,o),n.update(r,i,o))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,o);let s=0;for(let t=0;t<o;t++)s+=r[t];n.update(s,i,1)},this.renderMultiDrawInstances=function(e,o,s,a){if(0===s)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],o[t],a[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,o,0,a,0,s);let t=0;for(let e=0;e<s;e++)t+=o[e]*a[e];n.update(t,i,1)}}}function az(e,t,n,i){let r;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const a=o(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:o,textureFormatReadable:function(t){return t===fT||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===aT&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==eT&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==sT&&!r)},precision:s,logarithmicDepthBuffer:l,reverseDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function lz(e){const t=this;let n=null,i=0,r=!1,o=!1;const s=new RN,a=new SI,l={value:null,needsUpdate:!1};function c(e,n,i,r){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const t=i+4*o,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==o;++n,l+=4)s.copy(e[n]).applyMatrix4(r,a),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,a,u){const h=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===h||0===h.length||o&&!p)o?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=o?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,a,t,u);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function cz(e){let t=new WeakMap;function n(e,t){return t===UM?e.mapping=kM:t===FM&&(e.mapping=OM),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping;if(o===UM||o===FM){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const o=r.image;if(o&&o.height>0){const s=new ML(o.height);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}const uz=[.125,.215,.35,.446,.526,.582],hz=20,dz=new eU,pz=new wB;let fz=null,mz=0,gz=0,vz=!1;const yz=(1+Math.sqrt(5))/2,Az=1/yz,xz=[new tP(-yz,Az,0),new tP(yz,Az,0),new tP(-Az,0,yz),new tP(Az,0,yz),new tP(0,yz,-Az),new tP(0,yz,Az),new tP(-1,1,-1),new tP(1,1,-1),new tP(-1,1,1),new tP(1,1,1)];class bz{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;fz=this._renderer.getRenderTarget(),mz=this._renderer.getActiveCubeFace(),gz=this._renderer.getActiveMipmapLevel(),vz=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Sz(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Ez(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(fz,mz,gz),this._renderer.xr.enabled=vz,e.scissorTest=!1,wz(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===kM||e.mapping===OM?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),fz=this._renderer.getRenderTarget(),mz=this._renderer.getActiveCubeFace(),gz=this._renderer.getActiveMipmapLevel(),vz=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:$M,minFilter:$M,generateMipmaps:!1,type:aT,format:fT,colorSpace:SR,depthBuffer:!1},i=_z(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_z(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const o=e-4+1+uz.length;for(let s=0;s<o;s++){const o=Math.pow(2,r);n.push(o);let a=1/o;s>e-4?a=uz[s-e+4-1]:0===s&&(a=0),i.push(a);const l=1/(o-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),A=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),y.set(h,m*p*e);const r=[e,e,e,e,e,e];A.set(r,g*p*e)}const x=new ZB;x.setAttribute("position",new kB(v,f)),x.setAttribute("uv",new kB(y,m)),x.setAttribute("faceIndex",new kB(A,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(hz),r=new tP(0,1,0),o=new yL({name:"SphericalGaussianBlur",defines:{n:hz,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Cz(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:VC,depthTest:!1,depthWrite:!1});return o}(i,e,t)}return i}_compileMaterial(e){const t=new hL(this._lodPlanes[0],e);this._renderer.compile(t,dz)}_sceneToCubeUV(e,t,n,i){const r=new wL(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(pz),a.toneMapping=SM,a.autoClear=!1;const u=new MB({name:"PMREM.Background",side:zC,depthWrite:!1,depthTest:!1}),h=new hL(new pL,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(pz),d=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(r.up.set(0,o[f],0),r.lookAt(s[f],0,0)):1===t?(r.up.set(0,0,o[f]),r.lookAt(0,s[f],0)):(r.up.set(0,o[f],0),r.lookAt(0,0,s[f]));const n=this._cubeSize;wz(i,t*n,f>2?n:0,n,n),a.setRenderTarget(i),d&&a.render(h,r),a.render(e,r)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===kM||e.mapping===OM;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Sz()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ez());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new hL(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const s=this._cubeSize;wz(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(o,dz)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=xz[(i-r-1)%xz.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new hL(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):hz;f>hz&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let A=0;A<hz;++A){const e=A/p,t=Math.exp(-e*e/2);m.push(t),0===A?g+=t:A<f&&(g+=2*t)}for(let A=0;A<m.length;A++)m[A]=m[A]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];wz(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(c,dz)}}function _z(e,t,n){const i=new $I(e,t,n);return i.texture.mapping=zM,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function wz(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Ez(){return new yL({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Cz(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:VC,depthTest:!1,depthWrite:!1})}function Sz(){return new yL({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Cz(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:VC,depthTest:!1,depthWrite:!1})}function Cz(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Mz(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,s=o===UM||o===FM,a=o===kM||o===OM;if(s||a){let o=t.get(r);const l=void 0!==o?o.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new bz(e)),o=s?n.fromEquirectangular(r,o):n.fromCubemap(r,o),o.texture.pmremVersion=r.pmremVersion,t.set(r,o),o.texture;if(void 0!==o)return o.texture;{const l=r.image;return s&&l&&l.height>0||a&&l&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)?(null===n&&(n=new bz(e)),o=s?n.fromEquirectangular(r):n.fromCubemap(r),o.texture.pmremVersion=r.pmremVersion,t.set(r,o),r.addEventListener("dispose",i),o.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Tz(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&LI("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Rz(e,t,n,i){const r={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const n in a.attributes)t.remove(a.attributes[n]);a.removeEventListener("dispose",s),delete r[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{if(void 0===r)return;{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const a=new(MI(n)?GB:jB)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const r in i)t.update(i[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Iz(e,t,n){let i,r,o;function s(t,s,a){0!==a&&(e.drawElementsInstanced(i,s,r,t*o,a),n.update(s,i,a))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,o=e.bytesPerElement},this.render=function(t,s){e.drawElements(i,s,r,t*o),n.update(s,i,1)},this.renderInstances=s,this.renderMultiDraw=function(e,o,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,o,0,r,e,0,s);let a=0;for(let t=0;t<s;t++)a+=o[t];n.update(a,i,1)},this.renderMultiDrawInstances=function(e,a,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/o,a[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(i,a,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=a[e]*c[e];n.update(t,i,1)}}}function Pz(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Bz(e,t,n){const i=new WeakMap,r=new qI;return{update:function(o,s,a){const l=o.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(s);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==s.morphAttributes.position,p=void 0!==s.morphAttributes.normal,f=void 0!==s.morphAttributes.color,m=s.morphAttributes.position||[],g=s.morphAttributes.normal||[],v=s.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let A=s.attributes.position.count*y,x=1;A>t.maxTextureSize&&(x=Math.ceil(A/t.maxTextureSize),A=t.maxTextureSize);const b=new Float32Array(A*x*4*u),_=new YI(b,A,x,u);_.type=sT,_.needsUpdate=!0;const w=4*y;for(let S=0;S<u;S++){const C=m[S],M=g[S],T=v[S],R=A*x*4*S;for(let I=0;I<C.count;I++){const P=I*w;!0===d&&(r.fromBufferAttribute(C,I),b[R+P+0]=r.x,b[R+P+1]=r.y,b[R+P+2]=r.z,b[R+P+3]=0),!0===p&&(r.fromBufferAttribute(M,I),b[R+P+4]=r.x,b[R+P+5]=r.y,b[R+P+6]=r.z,b[R+P+7]=0),!0===f&&(r.fromBufferAttribute(T,I),b[R+P+8]=r.x,b[R+P+9]=r.y,b[R+P+10]=r.z,b[R+P+11]=4===T.itemSize?r.w:1)}}function E(){_.dispose(),i.delete(s),s.removeEventListener("dispose",E)}h={count:u,texture:_,size:new EI(A,x)},i.set(s,h),s.addEventListener("dispose",E)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)a.getUniforms().setValue(e,"morphTexture",o.morphTexture,n);else{let B=0;for(let N=0;N<l.length;N++)B+=l[N];const L=s.morphTargetsRelative?1:1-B;a.getUniforms().setValue(e,"morphTargetBaseInfluence",L),a.getUniforms().setValue(e,"morphTargetInfluences",l)}a.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),a.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}class Lz{constructor(e,t,n){if(this.renderer=e,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=n,this.extensions=t,this.available=this.extensions.has("OCULUS_multiview"),this.available){const e=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(e.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var i=0;i<this.maxNumViews;i++)this.mat4[i]=new PP,this.mat3[i]=new SI}}getCameraArray(e){return e.isArrayCamera?e.cameras:(this.cameraArray[0]=e,this.cameraArray)}updateCameraProjectionMatricesUniform(e,t){for(var n=this.getCameraArray(e),i=0;i<n.length;i++)this.mat4[i].copy(n[i].projectionMatrix);t.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(e,t){for(var n=this.getCameraArray(e),i=0;i<n.length;i++)this.mat4[i].copy(n[i].matrixWorldInverse);t.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(e,t,n){for(var i=this.getCameraArray(t),r=0;r<i.length;r++)this.mat4[r].multiplyMatrices(i[r].matrixWorldInverse,e.matrixWorld),this.mat3[r].getNormalMatrix(this.mat4[r]);n.setValue(this.gl,"modelViewMatrices",this.mat4),n.setValue(this.gl,"normalMatrices",this.mat3)}}function Nz(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const a=i.render.frame,l=s.geometry,c=t.get(s,l);if(r.get(c)!==a&&(t.update(c),r.set(c,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),r.get(s)!==a&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,a))),s.isSkinnedMesh){const e=s.skeleton;r.get(e)!==a&&(e.update(),r.set(e,a))}return c},dispose:function(){r=new WeakMap}}}const Dz=new QI,kz=new SD(1,1),Oz=new YI,Uz=new JI,Fz=new CL,zz=[],jz=[],Vz=new Float32Array(16),Gz=new Float32Array(9),Hz=new Float32Array(4);function Wz(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=zz[r];if(void 0===o&&(o=new Float32Array(r),zz[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function Qz(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function qz(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Xz(e,t){let n=jz[t];void 0===n&&(n=new Int32Array(t),jz[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function $z(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Yz(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Qz(n,t))return;e.uniform2fv(this.addr,t),qz(n,t)}}function Kz(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Qz(n,t))return;e.uniform3fv(this.addr,t),qz(n,t)}}function Jz(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Qz(n,t))return;e.uniform4fv(this.addr,t),qz(n,t)}}function Zz(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Qz(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),qz(n,t)}else{if(Qz(n,i))return;Hz.set(i),e.uniformMatrix2fv(this.addr,!1,Hz),qz(n,i)}}function ej(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Qz(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),qz(n,t)}else{if(Qz(n,i))return;Gz.set(i),e.uniformMatrix3fv(this.addr,!1,Gz),qz(n,i)}}function tj(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Qz(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),qz(n,t)}else{if(Qz(n,i))return;Vz.set(i),e.uniformMatrix4fv(this.addr,!1,Vz),qz(n,i)}}function nj(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ij(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Qz(n,t))return;e.uniform2iv(this.addr,t),qz(n,t)}}function rj(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Qz(n,t))return;e.uniform3iv(this.addr,t),qz(n,t)}}function oj(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Qz(n,t))return;e.uniform4iv(this.addr,t),qz(n,t)}}function sj(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function aj(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Qz(n,t))return;e.uniform2uiv(this.addr,t),qz(n,t)}}function lj(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Qz(n,t))return;e.uniform3uiv(this.addr,t),qz(n,t)}}function cj(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Qz(n,t))return;e.uniform4uiv(this.addr,t),qz(n,t)}}function uj(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let o;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(kz.compareFunction=qR,o=kz):o=Dz,n.setTexture2D(t||o,r)}function hj(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Uz,r)}function dj(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Fz,r)}function pj(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Oz,r)}function fj(e,t){e.uniform1fv(this.addr,t)}function mj(e,t){const n=Wz(t,this.size,2);e.uniform2fv(this.addr,n)}function gj(e,t){const n=Wz(t,this.size,3);e.uniform3fv(this.addr,n)}function vj(e,t){const n=Wz(t,this.size,4);e.uniform4fv(this.addr,n)}function yj(e,t){const n=Wz(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Aj(e,t){const n=Wz(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function xj(e,t){const n=Wz(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function bj(e,t){e.uniform1iv(this.addr,t)}function _j(e,t){e.uniform2iv(this.addr,t)}function wj(e,t){e.uniform3iv(this.addr,t)}function Ej(e,t){e.uniform4iv(this.addr,t)}function Sj(e,t){e.uniform1uiv(this.addr,t)}function Cj(e,t){e.uniform2uiv(this.addr,t)}function Mj(e,t){e.uniform3uiv(this.addr,t)}function Tj(e,t){e.uniform4uiv(this.addr,t)}function Rj(e,t,n){const i=this.cache,r=t.length,o=Xz(n,r);Qz(i,o)||(e.uniform1iv(this.addr,o),qz(i,o));for(let s=0;s!==r;++s)n.setTexture2D(t[s]||Dz,o[s])}function Ij(e,t,n){const i=this.cache,r=t.length,o=Xz(n,r);Qz(i,o)||(e.uniform1iv(this.addr,o),qz(i,o));for(let s=0;s!==r;++s)n.setTexture3D(t[s]||Uz,o[s])}function Pj(e,t,n){const i=this.cache,r=t.length,o=Xz(n,r);Qz(i,o)||(e.uniform1iv(this.addr,o),qz(i,o));for(let s=0;s!==r;++s)n.setTextureCube(t[s]||Fz,o[s])}function Bj(e,t,n){const i=this.cache,r=t.length,o=Xz(n,r);Qz(i,o)||(e.uniform1iv(this.addr,o),qz(i,o));for(let s=0;s!==r;++s)n.setTexture2DArray(t[s]||Oz,o[s])}class Lj{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return $z;case 35664:return Yz;case 35665:return Kz;case 35666:return Jz;case 35674:return Zz;case 35675:return ej;case 35676:return tj;case 5124:case 35670:return nj;case 35667:case 35671:return ij;case 35668:case 35672:return rj;case 35669:case 35673:return oj;case 5125:return sj;case 36294:return aj;case 36295:return lj;case 36296:return cj;case 35678:case 36198:case 36298:case 36306:case 35682:return uj;case 35679:case 36299:case 36307:return hj;case 35680:case 36300:case 36308:case 36293:return dj;case 36289:case 36303:case 36311:case 36292:return pj}}(t.type)}}class Nj{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return fj;case 35664:return mj;case 35665:return gj;case 35666:return vj;case 35674:return yj;case 35675:return Aj;case 35676:return xj;case 5124:case 35670:return bj;case 35667:case 35671:return _j;case 35668:case 35672:return wj;case 35669:case 35673:return Ej;case 5125:return Sj;case 36294:return Cj;case 36295:return Mj;case 36296:return Tj;case 35678:case 36198:case 36298:case 36306:case 35682:return Rj;case 35679:case 36299:case 36307:return Ij;case 35680:case 36300:case 36308:case 36293:return Pj;case 36289:case 36303:case 36311:case 36292:return Bj}}(t.type)}}class Dj{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const kj=/(\w+)(\])?(\[|\.)?/g;function Oj(e,t){e.seq.push(t),e.map[t.id]=t}function Uj(e,t,n){const i=e.name,r=i.length;for(kj.lastIndex=0;;){const o=kj.exec(i),s=kj.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===r){Oj(n,void 0===c?new Lj(a,e,t):new Nj(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new Dj(a),Oj(n,e)),n=e}}}class Fj{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Uj(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function zj(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let jj=0;const Vj=new SI;function Gj(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let s=r;s<o;s++){const e=s+1;i.push(`${e===t?">":" "} ${e}: ${n[s]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function Hj(e,t){const n=function(e){OI._getMatrix(Vj,OI.workingColorSpace,e);const t=`mat3( ${Vj.elements.map((e=>e.toFixed(4)))} )`;switch(OI.getTransfer(e)){case CR:return[t,"LinearTransferOETF"];case MR:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function Wj(e,t){let n;switch(t){case CM:n="Linear";break;case MM:n="Reinhard";break;case TM:n="Cineon";break;case RM:n="ACESFilmic";break;case PM:n="AgX";break;case BM:n="Neutral";break;case IM:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Qj=new tP;function qj(){OI.getLuminanceCoefficients(Qj);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${Qj.x.toFixed(4)}, ${Qj.y.toFixed(4)}, ${Qj.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function Xj(e){return""!==e}function $j(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Yj(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Kj=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jj(e){return e.replace(Kj,eV)}const Zj=new Map;function eV(e,t){let n=JF[t];if(void 0===n){const e=Zj.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=JF[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return Jj(n)}const tV=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function nV(e){return e.replace(tV,iV)}function iV(e,t,n,i){let r="";for(let o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function rV(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function oV(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===kC?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===OC?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===UC&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case kM:case OM:t="ENVMAP_TYPE_CUBE";break;case zM:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===OM&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case _M:t="ENVMAP_BLENDING_MULTIPLY";break;case wM:t="ENVMAP_BLENDING_MIX";break;case EM:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Xj).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";const A=n.numMultiviewViews;n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Xj).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Xj).join("\n"),v.length>0&&(v+="\n")):(g=[rV(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Xj).join("\n"),v=[rV(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==SM?"#define TONE_MAPPING":"",n.toneMapping!==SM?JF.tonemapping_pars_fragment:"",n.toneMapping!==SM?Wj("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",JF.colorspace_pars_fragment,Hj("linearToOutputTexel",n.outputColorSpace),qj(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Xj).join("\n")),s=Jj(s),s=$j(s,n),s=Yj(s,n),a=Jj(a),a=$j(a,n),a=Yj(a,n),s=nV(s),a=nV(a),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===lI?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===lI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v,A>0&&(g=["#extension GL_OVR_multiview : require","layout(num_views = "+A+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n")+"\n"+g,g=g.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+A+"];","uniform mat4 projectionMatrices["+A+"];","uniform mat4 viewMatrices["+A+"];","uniform mat3 normalMatrices["+A+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),v=["#extension GL_OVR_multiview : require","#define VIEW_ID gl_ViewID_OVR"].join("\n")+"\n"+v,v=v.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+A+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n"))));const x=y+g+s,b=y+v+a,_=zj(r,r.VERTEX_SHADER,x),w=zj(r,r.FRAGMENT_SHADER,b);function E(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(_).trim(),o=r.getShaderInfoLog(w).trim();let s=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(s=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(r,m,_,w);else{const e=Gj(r,_,"vertex"),i=Gj(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==o||(a=!1);a&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:o,prefix:v}})}r.deleteShader(_),r.deleteShader(w),S=new Fj(r,m),C=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),o=i.name;let s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(r,m)}let S,C;r.attachShader(m,_),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===S&&E(this),S},this.getAttributes=function(){return void 0===C&&E(this),C};let M=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===M&&(M=r.getProgramParameter(m,37297)),M},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=jj++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this.numMultiviewViews=A,this}let sV=0;class aV{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new lV(e),t.set(e,n)),n}}class lV{constructor(e){this.id=sV++,this.code=e,this.usedTimes=0}}function cV(e,t,n,i,r,o,s){const a=new VP,l=new aV,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(o,a,u,g,v){const y=g.fog,A=v.geometry,x=o.isMeshStandardMaterial?g.environment:null,b=(o.isMeshStandardMaterial?n:t).get(o.envMap||x),_=b&&b.mapping===zM?b.image.height:null,w=f[o.type];null!==o.precision&&(p=r.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const E=A.morphAttributes.position||A.morphAttributes.normal||A.morphAttributes.color,S=void 0!==E?E.length:0;let C,M,T,R,I=0;if(void 0!==A.morphAttributes.position&&(I=1),void 0!==A.morphAttributes.normal&&(I=2),void 0!==A.morphAttributes.color&&(I=3),w){const e=ez[w];C=e.vertexShader,M=e.fragmentShader}else C=o.vertexShader,M=o.fragmentShader,l.update(o),T=l.getVertexShaderID(o),R=l.getFragmentShaderID(o);const P=e.getRenderTarget(),B=e.state.buffers.depth.getReversed(),L=P&&P.isWebGLMultiviewRenderTarget?P.numViews:0,N=!0===v.isInstancedMesh,D=!0===v.isBatchedMesh,k=!!o.map,O=!!o.matcap,U=!!b,F=!!o.aoMap,z=!!o.lightMap,j=!!o.bumpMap,V=!!o.normalMap,G=!!o.displacementMap,H=!!o.emissiveMap,W=!!o.metalnessMap,Q=!!o.roughnessMap,q=o.anisotropy>0,X=o.clearcoat>0,$=o.dispersion>0,Y=o.iridescence>0,K=o.sheen>0,J=o.transmission>0,Z=q&&!!o.anisotropyMap,ee=X&&!!o.clearcoatMap,te=X&&!!o.clearcoatNormalMap,ne=X&&!!o.clearcoatRoughnessMap,ie=Y&&!!o.iridescenceMap,re=Y&&!!o.iridescenceThicknessMap,oe=K&&!!o.sheenColorMap,se=K&&!!o.sheenRoughnessMap,ae=!!o.specularMap,le=!!o.specularColorMap,ce=!!o.specularIntensityMap,ue=J&&!!o.transmissionMap,he=J&&!!o.thicknessMap,de=!!o.gradientMap,pe=!!o.alphaMap,fe=o.alphaTest>0,me=!!o.alphaHash,ge=!!o.extensions;let ve=SM;o.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(ve=e.toneMapping));const ye={shaderID:w,shaderType:o.type,shaderName:o.name,vertexShader:C,fragmentShader:M,defines:o.defines,customVertexShaderID:T,customFragmentShaderID:R,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,batching:D,batchingColor:D&&null!==v._colorsTexture,instancing:N,instancingColor:N&&null!==v.instanceColor,instancingMorph:N&&null!==v.morphTexture,supportsVertexTextures:d,numMultiviewViews:L,outputColorSpace:null===P?e.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:SR,alphaToCoverage:!!o.alphaToCoverage,map:k,matcap:O,envMap:U,envMapMode:U&&b.mapping,envMapCubeUVHeight:_,aoMap:F,lightMap:z,bumpMap:j,normalMap:V,displacementMap:d&&G,emissiveMap:H,normalMapObjectSpace:V&&o.normalMapType===_R,normalMapTangentSpace:V&&o.normalMapType===bR,metalnessMap:W,roughnessMap:Q,anisotropy:q,anisotropyMap:Z,clearcoat:X,clearcoatMap:ee,clearcoatNormalMap:te,clearcoatRoughnessMap:ne,dispersion:$,iridescence:Y,iridescenceMap:ie,iridescenceThicknessMap:re,sheen:K,sheenColorMap:oe,sheenRoughnessMap:se,specularMap:ae,specularColorMap:le,specularIntensityMap:ce,transmission:J,transmissionMap:ue,thicknessMap:he,gradientMap:de,opaque:!1===o.transparent&&o.blending===GC&&!1===o.alphaToCoverage,alphaMap:pe,alphaTest:fe,alphaHash:me,combine:o.combine,mapUv:k&&m(o.map.channel),aoMapUv:F&&m(o.aoMap.channel),lightMapUv:z&&m(o.lightMap.channel),bumpMapUv:j&&m(o.bumpMap.channel),normalMapUv:V&&m(o.normalMap.channel),displacementMapUv:G&&m(o.displacementMap.channel),emissiveMapUv:H&&m(o.emissiveMap.channel),metalnessMapUv:W&&m(o.metalnessMap.channel),roughnessMapUv:Q&&m(o.roughnessMap.channel),anisotropyMapUv:Z&&m(o.anisotropyMap.channel),clearcoatMapUv:ee&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:te&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ne&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:ie&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:re&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:oe&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:se&&m(o.sheenRoughnessMap.channel),specularMapUv:ae&&m(o.specularMap.channel),specularColorMapUv:le&&m(o.specularColorMap.channel),specularIntensityMapUv:ce&&m(o.specularIntensityMap.channel),transmissionMapUv:ue&&m(o.transmissionMap.channel),thicknessMapUv:he&&m(o.thicknessMap.channel),alphaMapUv:pe&&m(o.alphaMap.channel),vertexTangents:!!A.attributes.tangent&&(V||q),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!A.attributes.color&&4===A.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!A.attributes.uv&&(k||pe),fog:!!y,useFog:!0===o.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:B,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==A.morphAttributes.position,morphNormals:void 0!==A.morphAttributes.normal,morphColors:void 0!==A.morphAttributes.color,morphTargetsCount:S,morphTextureStride:I,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ve,decodeVideoTexture:k&&!0===o.map.isVideoTexture&&OI.getTransfer(o.map.colorSpace)===MR,decodeVideoTextureEmissive:H&&!0===o.emissiveMap.isVideoTexture&&OI.getTransfer(o.emissiveMap.colorSpace)===MR,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===jC,flipSided:o.side===zC,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionClipCullDistance:ge&&!0===o.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ge&&!0===o.extensions.multiDraw||D)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()};return ye.vertexUv1s=c.has(1),ye.vertexUv2s=c.has(2),ye.vertexUv3s=c.has(3),c.clear(),ye},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.supportsVertexTextures&&a.enable(0);t.instancing&&a.enable(1);t.instancingColor&&a.enable(2);t.instancingMorph&&a.enable(3);t.matcap&&a.enable(4);t.envMap&&a.enable(5);t.normalMapObjectSpace&&a.enable(6);t.normalMapTangentSpace&&a.enable(7);t.clearcoat&&a.enable(8);t.iridescence&&a.enable(9);t.alphaTest&&a.enable(10);t.vertexColors&&a.enable(11);t.vertexAlphas&&a.enable(12);t.vertexUv1s&&a.enable(13);t.vertexUv2s&&a.enable(14);t.vertexUv3s&&a.enable(15);t.vertexTangents&&a.enable(16);t.anisotropy&&a.enable(17);t.alphaHash&&a.enable(18);t.batching&&a.enable(19);t.dispersion&&a.enable(20);t.batchingColor&&a.enable(21);e.push(a.mask),a.disableAll(),t.fog&&a.enable(0);t.useFog&&a.enable(1);t.flatShading&&a.enable(2);t.logarithmicDepthBuffer&&a.enable(3);t.reverseDepthBuffer&&a.enable(4);t.skinning&&a.enable(5);t.morphTargets&&a.enable(6);t.morphNormals&&a.enable(7);t.morphColors&&a.enable(8);t.premultipliedAlpha&&a.enable(9);t.shadowMapEnabled&&a.enable(10);t.doubleSided&&a.enable(11);t.flipSided&&a.enable(12);t.useDepthPacking&&a.enable(13);t.dithering&&a.enable(14);t.transmission&&a.enable(15);t.sheen&&a.enable(16);t.opaque&&a.enable(17);t.pointsUvs&&a.enable(18);t.decodeVideoTexture&&a.enable(19);t.decodeVideoTextureEmissive&&a.enable(20);t.alphaToCoverage&&a.enable(21);t.numMultiviewViews&&a.enable(21);e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=ez[t];n=vL.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=u.length;e<r;e++){const t=u[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new oV(e,n,t,o),u.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function uV(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function hV(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function dV(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function pV(){const e=[];let t=0;const n=[],i=[],r=[];function o(n,i,r,o,s,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:o,renderOrder:n.renderOrder,z:s,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=s,l.group=a),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?i.push(u):!0===s.transparent?r.push(u):n.push(u)},unshift:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?i.unshift(u):!0===s.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||hV),i.length>1&&i.sort(t||dV),r.length>1&&r.sort(t||dV)}}}function fV(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new pV,e.set(t,[r])):n>=i.length?(r=new pV,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function mV(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new tP,color:new wB};break;case"SpotLight":n={position:new tP,direction:new tP,color:new wB,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new tP,color:new wB,distance:0,decay:0};break;case"HemisphereLight":n={direction:new tP,skyColor:new wB,groundColor:new wB};break;case"RectAreaLight":n={color:new wB,position:new tP,halfWidth:new tP,halfHeight:new tP}}return e[t.id]=n,n}}}let gV=0;function vV(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function yV(e){const t=new mV,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new EI};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new EI,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let a=0;a<9;a++)i.probe.push(new tP);const r=new tP,o=new PP,s=new PP;return{setup:function(r){let o=0,s=0,a=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;r.sort(vV);for(let e=0,x=r.length;e<x;e++){const A=r[e],x=A.color,b=A.intensity,_=A.distance,w=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)o+=x.r*b,s+=x.g*b,a+=x.b*b;else if(A.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(A.sh.coefficients[e],b);y++}else if(A.isDirectionalLight){const e=t.get(A);if(e.color.copy(A.color).multiplyScalar(A.intensity),A.castShadow){const e=A.shadow,t=n.get(A);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=w,i.directionalShadowMatrix[l]=A.shadow.matrix,p++}i.directional[l]=e,l++}else if(A.isSpotLight){const e=t.get(A);e.position.setFromMatrixPosition(A.matrixWorld),e.color.copy(x).multiplyScalar(b),e.distance=_,e.coneCos=Math.cos(A.angle),e.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),e.decay=A.decay,i.spot[u]=e;const r=A.shadow;if(A.map&&(i.spotLightMap[g]=A.map,g++,r.updateMatrices(A),A.castShadow&&v++),i.spotLightMatrix[u]=r.matrix,A.castShadow){const e=n.get(A);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[u]=e,i.spotShadowMap[u]=w,m++}u++}else if(A.isRectAreaLight){const e=t.get(A);e.color.copy(x).multiplyScalar(b),e.halfWidth.set(.5*A.width,0,0),e.halfHeight.set(0,.5*A.height,0),i.rectArea[h]=e,h++}else if(A.isPointLight){const e=t.get(A);if(e.color.copy(A.color).multiplyScalar(A.intensity),e.distance=A.distance,e.decay=A.decay,A.castShadow){const e=A.shadow,t=n.get(A);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[c]=t,i.pointShadowMap[c]=w,i.pointShadowMatrix[c]=A.shadow.matrix,f++}i.point[c]=e,c++}else if(A.isHemisphereLight){const e=t.get(A);e.skyColor.copy(A.color).multiplyScalar(b),e.groundColor.copy(A.groundColor).multiplyScalar(b),i.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=ZF.LTC_FLOAT_1,i.rectAreaLTC2=ZF.LTC_FLOAT_2):(i.rectAreaLTC1=ZF.LTC_HALF_1,i.rectAreaLTC2=ZF.LTC_HALF_2)),i.ambient[0]=o,i.ambient[1]=s,i.ambient[2]=a;const A=i.hash;A.directionalLength===l&&A.pointLength===c&&A.spotLength===u&&A.rectAreaLength===h&&A.hemiLength===d&&A.numDirectionalShadows===p&&A.numPointShadows===f&&A.numSpotShadows===m&&A.numSpotMaps===g&&A.numLightProbes===y||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=y,A.directionalLength=l,A.pointLength=c,A.spotLength=u,A.rectAreaLength=h,A.hemiLength=d,A.numDirectionalShadows=p,A.numPointShadows=f,A.numSpotShadows=m,A.numSpotMaps=g,A.numLightProbes=y,i.version=gV++)},setupView:function(e,t){let n=0,a=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){const t=e[d];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(t.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=i.point[a];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),a++}else if(t.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function AV(e){const t=new yV(e),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function xV(e){let t=new WeakMap;return{get:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=t.get(n);let o;return void 0===r?(o=new AV(e),t.set(n,[o])):i>=r.length?(o=new AV(e),r.push(o)):o=r[i],o},dispose:function(){t=new WeakMap}}}function bV(e,t,n){let i=new BN;const r=new EI,o=new EI,s=new qI,a=new rO({depthPacking:yR}),l=new oO,c={},u=n.maxTextureSize,h={[FC]:zC,[zC]:FC,[jC]:jC},d=new yL({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new EI},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new ZB;f.setAttribute("position",new kB(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new hL(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=kC;let v=this.type;function y(n,i){const o=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new $I(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,p,m,null)}function A(t,n,i,r){let o=null;const s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)o=s;else if(o=!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=o.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=o.clone(),i[t]=r,n.addEventListener("dispose",b)),o=r}if(o.visible=n.visible,o.wireframe=n.wireframe,o.side=r===UC?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.map=n.map,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===i.isPointLight&&!0===o.isMeshDistanceMaterial){e.properties.get(o).light=i}return o}function x(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===UC)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=A(n,h,s,a);n.onBeforeShadow(e,n,r,o,i,t,u),e.renderBufferDirect(o,null,i,t,n,u),n.onAfterShadow(e,n,r,o,i,t,u)}}}else if(l.visible){const t=A(n,l,s,a);n.onBeforeShadow(e,n,r,o,i,t,null),e.renderBufferDirect(o,null,i,t,n,null),n.onAfterShadow(e,n,r,o,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,o,s,a)}function b(e){e.target.removeEventListener("dispose",b);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(VC),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=v!==UC&&this.type===UC,f=v===UC&&this.type!==UC;for(let m=0,g=t.length;m<g;m++){const l=t[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),o.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/h.x),r.x=o.x*h.x,c.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/h.y),r.y=o.y*h.y,c.mapSize.y=o.y)),null===c.map||!0===p||!0===f){const e=this.type!==UC?{minFilter:HM,magFilter:HM}:{};null!==c.map&&c.map.dispose(),c.map=new $I(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),c.updateMatrices(l,e),i=c.getFrustum(),x(n,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===UC&&y(c,a),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const _V={[fM]:mM,[gM]:xM,[yM]:bM,[vM]:AM,[mM]:fM,[xM]:gM,[bM]:yM,[AM]:vM};function wV(e,t){const n=new function(){let t=!1;const n=new qI;let i=null;const r=new qI(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,s,a){!0===a&&(t*=s,i*=s,o*=s),n.set(t,i,o,s),!1===r.equals(n)&&(e.clearColor(t,i,o,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,o=null,s=null;return{setReversed:function(e){if(i!==e){const e=t.get("EXT_clip_control");i?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT);const n=s;s=null,this.setClear(n)}i=e},getReversed:function(){return i},setTest:function(t){t?z(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(t){r===t||n||(e.depthMask(t),r=t)},setFunc:function(t){if(i&&(t=_V[t]),o!==t){switch(t){case fM:e.depthFunc(e.NEVER);break;case mM:e.depthFunc(e.ALWAYS);break;case gM:e.depthFunc(e.LESS);break;case vM:e.depthFunc(e.LEQUAL);break;case yM:e.depthFunc(e.EQUAL);break;case AM:e.depthFunc(e.GEQUAL);break;case xM:e.depthFunc(e.GREATER);break;case bM:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}o=t}},setLocked:function(e){n=e},setClear:function(t){s!==t&&(i&&(t=1-t),e.clearDepth(t),s=t)},reset:function(){n=!1,r=null,o=null,s=null,i=!1}}},r=new function(){let t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&o===s||(e.stencilFunc(t,n,s),i=t,r=n,o=s)},setOp:function(t,n,i){s===t&&a===n&&l===i||(e.stencilOp(t,n,i),s=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null}}},o=new WeakMap,s=new WeakMap;let a={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,A=null,x=new wB(0,0,0),b=0,_=!1,w=null,E=null,S=null,C=null,M=null;const T=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,I=0;const P=e.getParameter(e.VERSION);-1!==P.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=I>=1):-1!==P.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=I>=2);let B=null,L={};const N=e.getParameter(e.SCISSOR_BOX),D=e.getParameter(e.VIEWPORT),k=(new qI).fromArray(N),O=(new qI).fromArray(D);function U(t,n,i,r){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<i;a++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const F={};function z(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function j(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}F[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[e.TEXTURE_2D_ARRAY]=U(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),F[e.TEXTURE_3D]=U(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),z(e.DEPTH_TEST),i.setFunc(vM),W(!1),Q(BC),z(e.CULL_FACE),H(VC);const V={[XC]:e.FUNC_ADD,[$C]:e.FUNC_SUBTRACT,[YC]:e.FUNC_REVERSE_SUBTRACT};V[KC]=e.MIN,V[JC]=e.MAX;const G={[ZC]:e.ZERO,[eM]:e.ONE,[tM]:e.SRC_COLOR,[iM]:e.SRC_ALPHA,[cM]:e.SRC_ALPHA_SATURATE,[aM]:e.DST_COLOR,[oM]:e.DST_ALPHA,[nM]:e.ONE_MINUS_SRC_COLOR,[rM]:e.ONE_MINUS_SRC_ALPHA,[lM]:e.ONE_MINUS_DST_COLOR,[sM]:e.ONE_MINUS_DST_ALPHA,[uM]:e.CONSTANT_COLOR,[hM]:e.ONE_MINUS_CONSTANT_COLOR,[dM]:e.CONSTANT_ALPHA,[pM]:e.ONE_MINUS_CONSTANT_ALPHA};function H(t,n,i,r,o,s,a,l,c,u){if(t!==VC){if(!1===d&&(z(e.BLEND),d=!0),t===qC)o=o||n,s=s||i,a=a||r,n===f&&o===v||(e.blendEquationSeparate(V[n],V[o]),f=n,v=o),i===m&&r===g&&s===y&&a===A||(e.blendFuncSeparate(G[i],G[r],G[s],G[a]),m=i,g=r,y=s,A=a),!1!==l.equals(x)&&c===b||(e.blendColor(l.r,l.g,l.b,c),x.copy(l),b=c),p=t,_=!1;else if(t!==p||u!==_){if(f===XC&&v===XC||(e.blendEquation(e.FUNC_ADD),f=XC,v=XC),u)switch(t){case GC:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case HC:e.blendFunc(e.ONE,e.ONE);break;case WC:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case QC:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case GC:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case HC:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case WC:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case QC:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,A=null,x.set(0,0,0),b=0,p=t,_=u}}else!0===d&&(j(e.BLEND),d=!1)}function W(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function Q(t){t!==PC?(z(e.CULL_FACE),t!==E&&(t===BC?e.cullFace(e.BACK):t===LC?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),E=t}function q(t,n,i){t?(z(e.POLYGON_OFFSET_FILL),C===n&&M===i||(e.polygonOffset(n,i),C=n,M=i)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:z,disable:j,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=u,r=!1;if(t){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const o=t.textures;if(i.length!==o.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=o.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=o.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:H,setMaterial:function(t,o){t.side===jC?j(e.CULL_FACE):z(e.CULL_FACE);let s=t.side===zC;o&&(s=!s),W(s),t.blending===GC&&!1===t.transparent?H(VC):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite);const a=t.stencilWrite;r.setTest(a),a&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:Q,setLineWidth:function(t){t!==S&&(R&&e.lineWidth(t),S=t)},setPolygonOffset:q,setScissorTest:function(t){t?z(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+T-1),B!==t&&(e.activeTexture(t),B=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===B?e.TEXTURE0+T-1:B);let r=L[i];void 0===r&&(r={type:void 0,texture:void 0},L[i]=r),r.type===t&&r.texture===n||(B!==i&&(e.activeTexture(i),B=i),e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=L[B];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=s.get(n).get(t);o.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),o.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),i.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},B=null,L={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,A=null,x=new wB(0,0,0),b=0,_=!1,w=null,E=null,S=null,C=null,M=null,k.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),n.reset(),i.reset(),r.reset()}}}function EV(e,t,n,i,r,o,s){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=t.has("OCULUS_multiview")?t.get("OCULUS_multiview"):null,u=new EI,h=new WeakMap;let d;const p=new WeakMap;let f=[],m=!1,g=!1;try{g="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(q){}function v(e,t){return g?new OffscreenCanvas(e,t):II("canvas")}function y(e,t,n){let i=1;const r=Q(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),o=Math.floor(i*r.height);void 0===d&&(d=v(n,o));const s=t?v(n,o):d;s.width=n,s.height=o;return s.getContext("2d").drawImage(e,0,0,n,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),e}return e}function A(e){return e.generateMipmaps}function x(t){e.generateMipmap(t)}function b(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function _(n,i,r,o){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=i;if(i===e.RED&&(r===e.FLOAT&&(a=e.R32F),r===e.HALF_FLOAT&&(a=e.R16F),r===e.UNSIGNED_BYTE&&(a=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.R8UI),r===e.UNSIGNED_SHORT&&(a=e.R16UI),r===e.UNSIGNED_INT&&(a=e.R32UI),r===e.BYTE&&(a=e.R8I),r===e.SHORT&&(a=e.R16I),r===e.INT&&(a=e.R32I)),i===e.RG&&(r===e.FLOAT&&(a=e.RG32F),r===e.HALF_FLOAT&&(a=e.RG16F),r===e.UNSIGNED_BYTE&&(a=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RG8UI),r===e.UNSIGNED_SHORT&&(a=e.RG16UI),r===e.UNSIGNED_INT&&(a=e.RG32UI),r===e.BYTE&&(a=e.RG8I),r===e.SHORT&&(a=e.RG16I),r===e.INT&&(a=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RGB8UI),r===e.UNSIGNED_SHORT&&(a=e.RGB16UI),r===e.UNSIGNED_INT&&(a=e.RGB32UI),r===e.BYTE&&(a=e.RGB8I),r===e.SHORT&&(a=e.RGB16I),r===e.INT&&(a=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(a=e.RGBA16UI),r===e.UNSIGNED_INT&&(a=e.RGBA32UI),r===e.BYTE&&(a=e.RGBA8I),r===e.SHORT&&(a=e.RGBA16I),r===e.INT&&(a=e.RGBA32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(a=e.RGB9_E5),i===e.RGBA){const t=s?CR:OI.getTransfer(o);r===e.FLOAT&&(a=e.RGBA32F),r===e.HALF_FLOAT&&(a=e.RGBA16F),r===e.UNSIGNED_BYTE&&(a=t===MR?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(a=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(a=e.RGB5_A1)}return a!==e.R16F&&a!==e.R32F&&a!==e.RG16F&&a!==e.RG32F&&a!==e.RGBA16F&&a!==e.RGBA32F||t.get("EXT_color_buffer_float"),a}function w(t,n){let i;return t?null===n||n===oT||n===uT?i=e.DEPTH24_STENCIL8:n===sT?i=e.DEPTH32F_STENCIL8:n===iT&&(i=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===oT||n===uT?i=e.DEPTH_COMPONENT24:n===sT?i=e.DEPTH_COMPONENT32F:n===iT&&(i=e.DEPTH_COMPONENT16),i}function E(e,t){return!0===A(e)||e.isFramebufferTexture&&e.minFilter!==HM&&e.minFilter!==$M?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=p.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(e),0===Object.keys(r).length&&p.delete(n)}i.remove(e)}(t),t.isVideoTexture&&h.delete(t)}function C(t){const n=t.target;n.removeEventListener("dispose",C),function(t){const n=i.get(t);t.depthTexture&&(t.depthTexture.dispose(),i.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let o=0,a=r.length;o<a;o++){const t=i.get(r[o]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),i.remove(r[o])}i.remove(t)}(n)}function M(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete p.get(r)[n.__cacheKey],s.memory.textures--}let T=0;function R(t,r){const o=i.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;h.get(e)!==t&&(h.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(k(o,t,r))return}n.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+r)}function I(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?k(o,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+r)}const P={[jM]:e.REPEAT,[VM]:e.CLAMP_TO_EDGE,[GM]:e.MIRRORED_REPEAT},B={[HM]:e.NEAREST,[WM]:e.NEAREST_MIPMAP_NEAREST,[qM]:e.NEAREST_MIPMAP_LINEAR,[$M]:e.LINEAR,[YM]:e.LINEAR_MIPMAP_NEAREST,[JM]:e.LINEAR_MIPMAP_LINEAR},L={[HR]:e.NEVER,[KR]:e.ALWAYS,[WR]:e.LESS,[qR]:e.LEQUAL,[QR]:e.EQUAL,[YR]:e.GEQUAL,[XR]:e.GREATER,[$R]:e.NOTEQUAL};function N(n,o){if(o.type!==sT||!1!==t.has("OES_texture_float_linear")||o.magFilter!==$M&&o.magFilter!==YM&&o.magFilter!==qM&&o.magFilter!==JM&&o.minFilter!==$M&&o.minFilter!==YM&&o.minFilter!==qM&&o.minFilter!==JM||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,P[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,P[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,P[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,B[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,B[o.minFilter]),o.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,L[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(o.magFilter===HM)return;if(o.minFilter!==qM&&o.minFilter!==JM)return;if(o.type===sT&&!1===t.has("OES_texture_float_linear"))return;if(o.anisotropy>1||i.get(o).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy}}}function D(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const r=n.source;let o=p.get(r);void 0===o&&(o={},p.set(r,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),o[a].usedTimes++;const r=o[t.__cacheKey];void 0!==r&&(o[t.__cacheKey].usedTimes--,0===r.usedTimes&&M(n)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return i}function k(t,s,a){if(m)return s.isPendingDeferredUpload||(s.isPendingDeferredUpload=!0,f.push({textureProperties:t,texture:s,slot:a})),!1;let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const c=D(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+a);const t=OI.getPrimaries(OI.workingColorSpace),i=s.colorSpace===wR?null:OI.getPrimaries(s.colorSpace),d=s.colorSpace===wR||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=y(s.image,!1,r.maxTextureSize);p=W(s,p);const f=o.convert(s.format,s.colorSpace),m=o.convert(s.type);let g,v=_(s.internalFormat,f,m,s.colorSpace,s.isVideoTexture);N(l,s);const b=s.mipmaps,S=!0!==s.isVideoTexture,C=void 0===h.__version||!0===c,M=u.dataReady,T=E(s,p);if(s.isDepthTexture)v=w(s.format===yT,s.type),C&&(S?n.texStorage2D(e.TEXTURE_2D,1,v,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,v,p.width,p.height,0,f,m,null));else if(s.isDataTexture)if(b.length>0){S&&C&&n.texStorage2D(e.TEXTURE_2D,T,v,b[0].width,b[0].height);for(let t=0,i=b.length;t<i;t++)g=b[t],S?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,g.width,g.height,f,m,g.data):n.texImage2D(e.TEXTURE_2D,t,v,g.width,g.height,0,f,m,g.data);s.generateMipmaps=!1}else S?(C&&n.texStorage2D(e.TEXTURE_2D,T,v,p.width,p.height),M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,m,p.data)):n.texImage2D(e.TEXTURE_2D,0,v,p.width,p.height,0,f,m,p.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){S&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,v,b[0].width,b[0].height,p.depth);for(let t=0,i=b.length;t<i;t++)if(g=b[t],s.format!==fT)if(null!==f)if(S){if(M)if(s.layerUpdates.size>0){const i=XF(g.width,g.height,s.format,s.type);for(const r of s.layerUpdates){const o=g.data.subarray(r*i/g.data.BYTES_PER_ELEMENT,(r+1)*i/g.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,g.width,g.height,1,f,o)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,g.width,g.height,p.depth,f,g.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,v,g.width,g.height,p.depth,0,g.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else S?M&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,g.width,g.height,p.depth,f,m,g.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,v,g.width,g.height,p.depth,0,f,m,g.data)}else{S&&C&&n.texStorage2D(e.TEXTURE_2D,T,v,b[0].width,b[0].height);for(let t=0,i=b.length;t<i;t++)g=b[t],s.format!==fT?null!==f?S?M&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,g.width,g.height,f,g.data):n.compressedTexImage2D(e.TEXTURE_2D,t,v,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):S?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,g.width,g.height,f,m,g.data):n.texImage2D(e.TEXTURE_2D,t,v,g.width,g.height,0,f,m,g.data)}else if(s.isDataArrayTexture)if(S){if(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,v,p.width,p.height,p.depth),M)if(s.layerUpdates.size>0){const t=XF(p.width,p.height,s.format,s.type);for(const i of s.layerUpdates){const r=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,m,r)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,m,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,v,p.width,p.height,p.depth,0,f,m,p.data);else if(s.isData3DTexture)S?(C&&n.texStorage3D(e.TEXTURE_3D,T,v,p.width,p.height,p.depth),M&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,m,p.data)):n.texImage3D(e.TEXTURE_3D,0,v,p.width,p.height,p.depth,0,f,m,p.data);else if(s.isFramebufferTexture){if(C)if(S)n.texStorage2D(e.TEXTURE_2D,T,v,p.width,p.height);else{let t=p.width,i=p.height;for(let r=0;r<T;r++)n.texImage2D(e.TEXTURE_2D,r,v,t,i,0,f,m,null),t>>=1,i>>=1}}else if(b.length>0){if(S&&C){const t=Q(b[0]);n.texStorage2D(e.TEXTURE_2D,T,v,t.width,t.height)}for(let t=0,i=b.length;t<i;t++)g=b[t],S?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,m,g):n.texImage2D(e.TEXTURE_2D,t,v,f,m,g);s.generateMipmaps=!1}else if(S){if(C){const t=Q(p);n.texStorage2D(e.TEXTURE_2D,T,v,t.width,t.height)}M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,m,p)}else n.texImage2D(e.TEXTURE_2D,0,v,f,m,p);A(s)&&x(l),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}return t.__version=s.version,!0}function O(t,r,s,l,u,h){const d=o.convert(s.format,s.colorSpace),p=o.convert(s.type),f=_(s.internalFormat,d,p,s.colorSpace),m=i.get(r),g=i.get(s);if(g.__renderTarget=r,!m.__hasExternalTextures){const t=Math.max(1,r.width>>h),i=Math.max(1,r.height>>h);!0===r.isWebGLMultiviewRenderTarget?n.texStorage3D(e.TEXTURE_2D_ARRAY,0,f,r.width,r.height,r.numViews):u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,h,f,t,i,r.depth,0,d,p,null):n.texImage2D(u,h,f,t,i,0,d,p,null)}n.bindFramebuffer(e.FRAMEBUFFER,t);const v=H(r);!0===r.isWebGLMultiviewRenderTarget?v?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,g.__webglTexture,0,G(r),0,r.numViews):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,g.__webglTexture,0,0,r.numViews):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(v?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,u,g.__webglTexture,0,G(r)):e.framebufferTexture2D(e.FRAMEBUFFER,l,u,g.__webglTexture,h)),n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),!0===n.isWebGLMultiviewRenderTarget){const t=H(n),r=n.numViews,o=n.depthTexture;let s=e.DEPTH_COMPONENT24,a=e.DEPTH_ATTACHMENT;o&&o.isDepthTexture&&(o.type===sT?s=e.DEPTH_COMPONENT32F:o.type===uT&&(s=e.DEPTH24_STENCIL8,a=e.DEPTH_STENCIL_ATTACHMENT));let l=i.get(n.depthTexture).__webglTexture;void 0===l&&(l=e.createTexture(),e.bindTexture(e.TEXTURE_2D_ARRAY,l),e.texStorage3D(e.TEXTURE_2D_ARRAY,1,s,n.width,n.height,r)),t?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,a,l,0,G(n),0,r):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,a,l,0,0,r)}else if(n.depthBuffer){const i=n.depthTexture,o=i&&i.isDepthTexture?i.type:null,s=w(n.stencilBuffer,o),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=G(n);H(n)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,s,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const s=t[i],l=o.convert(s.format,s.colorSpace),c=o.convert(s.type),u=_(s.internalFormat,l,c,s.colorSpace),h=G(n);r&&!1===H(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):H(n)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function F(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const o=i.get(r.depthTexture);o.__renderTarget=r,o.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),1!=r.depthTexture.image.depth?I(r.depthTexture,0):R(r.depthTexture,0);const s=o.__webglTexture,l=G(r);if(!0===r.isWebGLMultiviewRenderTarget){const t=H(r),n=r.numViews;if(r.depthTexture.format===vT)t?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,s,0,l,0,n):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,s,0,0,n);else{if(r.depthTexture.format!==yT)throw new Error("Unknown depthTexture format");t?c.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,s,0,l,0,n):c.framebufferTextureMultiviewOVR(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,s,0,0,n)}}else if(r.depthTexture.format===vT)H(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==yT)throw new Error("Unknown depthTexture format");H(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}function z(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");F(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=e.createRenderbuffer(),U(r.__webglDepthbuffer[i],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,o=r.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,o),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,o)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),U(r.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}n.bindFramebuffer(e.FRAMEBUFFER,null)}const j=[],V=[];function G(e){return Math.min(r.maxSamples,e.samples)}function H(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function W(e,t){const n=e.colorSpace,i=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==SR&&n!==wR&&(OI.getTransfer(n)===MR?i===fT&&r===eT||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function Q(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=T;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=R,this.setTexture2DArray=I,this.setTexture3D=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?k(o,t,r):n.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,s,a){if(6!==s.image.length)return;const l=D(t,s),c=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+a);const t=OI.getPrimaries(OI.workingColorSpace),i=s.colorSpace===wR?null:OI.getPrimaries(s.colorSpace),h=s.colorSpace===wR||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=s.isCompressedTexture||s.image[0].isCompressedTexture,p=s.image[0]&&s.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=d||p?p?s.image[e].image:s.image[e]:y(s.image[e],!0,r.maxCubemapSize),f[e]=W(s,f[e]);const m=f[0],g=o.convert(s.format,s.colorSpace),v=o.convert(s.type),b=_(s.internalFormat,g,v,s.colorSpace),w=!0!==s.isVideoTexture,S=void 0===u.__version||!0===l,C=c.dataReady;let M,T=E(s,m);if(N(e.TEXTURE_CUBE_MAP,s),d){w&&S&&n.texStorage2D(e.TEXTURE_CUBE_MAP,T,b,m.width,m.height);for(let t=0;t<6;t++){M=f[t].mipmaps;for(let i=0;i<M.length;i++){const r=M[i];s.format!==fT?null!==g?w?C&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,g,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,b,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):w?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,g,v,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,b,r.width,r.height,0,g,v,r.data)}}}else{if(M=s.mipmaps,w&&S){M.length>0&&T++;const t=Q(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,T,b,t.width,t.height)}for(let t=0;t<6;t++)if(p){w?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,g,v,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,b,f[t].width,f[t].height,0,g,v,f[t].data);for(let i=0;i<M.length;i++){const r=M[i].image[t].image;w?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,g,v,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,b,r.width,r.height,0,g,v,r.data)}}else{w?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,g,v,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,b,g,v,f[t]);for(let i=0;i<M.length;i++){const r=M[i];w?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,g,v,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,b,g,v,r.image[t])}}}A(s)&&x(e.TEXTURE_CUBE_MAP),u.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(a,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,r){const o=i.get(t);void 0!==n&&O(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&z(t)},this.uploadTexture=k,this.setupRenderTarget=function(t){const r=t.texture,a=i.get(t),l=i.get(r);t.addEventListener("dispose",C);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,s.memory.textures++),u){a.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)a.__webglFramebuffer[t][n]=e.createFramebuffer()}else a.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)a.__webglFramebuffer[t]=e.createFramebuffer()}else a.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=i.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===H(t)){a.__webglMultisampledFramebuffer=e.createFramebuffer(),a.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];a.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,a.__webglColorRenderbuffer[n]);const r=o.convert(i.format,i.colorSpace),s=o.convert(i.type),l=_(i.internalFormat,r,s,i.colorSpace,!0===t.isXRRenderTarget),u=G(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,a.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(a.__webglDepthRenderbuffer=e.createRenderbuffer(),U(a.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),N(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)O(a.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else O(a.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);A(r)&&x(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,o=c.length;r<o;r++){const o=c[r],s=i.get(o);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),N(e.TEXTURE_2D,o),O(a.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),A(o)&&x(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),!0===t.isWebGLMultiviewRenderTarget&&(i=e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),N(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)O(a.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else O(a.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);A(r)&&x(i),n.unbindTexture()}(t.depthBuffer||!0===t.isWebGLMultiviewRenderTarget)&&this.setupDepthRenderbuffer(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let r=0,o=t.length;r<o;r++){const o=t[r];if(A(o)){const t=b(e),r=i.get(o).__webglTexture;n.bindTexture(t,r),x(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===H(t)){const r=t.textures,o=t.width,s=t.height;let a=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),h=r.length>1;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,s,0,0,o,s,a,e.NEAREST),!0===l&&(j.length=0,V.length=0,j.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(j.push(c),V.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,V)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,j))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const o=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthTexture=F,this.setupDepthRenderbuffer=z,this.setupFrameBufferTexture=O,this.useMultisampledRTT=H,this.runDeferredUploads=function(){const e=m;m=!1;for(const t of f)k(t.textureProperties,t.texture,t.slot),t.texture.isPendingDeferredUpload=!1;f=[],m=e},this.setDeferTextureUploads=function(e){m=e}}function SV(e,t){return{convert:function(n){let i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wR;const o=OI.getTransfer(r);if(n===eT)return e.UNSIGNED_BYTE;if(n===lT)return e.UNSIGNED_SHORT_4_4_4_4;if(n===cT)return e.UNSIGNED_SHORT_5_5_5_1;if(n===hT)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===tT)return e.BYTE;if(n===nT)return e.SHORT;if(n===iT)return e.UNSIGNED_SHORT;if(n===rT)return e.INT;if(n===oT)return e.UNSIGNED_INT;if(n===sT)return e.FLOAT;if(n===aT)return e.HALF_FLOAT;if(n===dT)return e.ALPHA;if(n===pT)return e.RGB;if(n===fT)return e.RGBA;if(n===mT)return e.LUMINANCE;if(n===gT)return e.LUMINANCE_ALPHA;if(n===vT)return e.DEPTH_COMPONENT;if(n===yT)return e.DEPTH_STENCIL;if(n===AT)return e.RED;if(n===xT)return e.RED_INTEGER;if(n===bT)return e.RG;if(n===_T)return e.RG_INTEGER;if(n===ET)return e.RGBA_INTEGER;if(n===ST||n===CT||n===MT||n===TT)if(o===MR){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===ST)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===CT)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===MT)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===TT)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===ST)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===CT)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===MT)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===TT)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===RT||n===IT||n===PT||n===BT){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===RT)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===IT)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===PT)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===BT)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===LT||n===NT||n===DT){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===LT||n===NT)return o===MR?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===DT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===kT||n===OT||n===UT||n===FT||n===zT||n===jT||n===VT||n===GT||n===HT||n===WT||n===QT||n===qT||n===XT||n===$T){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===kT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===OT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===UT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===FT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===zT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===jT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===VT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===GT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===HT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===WT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===QT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===qT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===XT)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===$T)return o===MR?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===YT||n===KT||n===JT){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===YT)return o===MR?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===KT)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===JT)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===ZT||n===eR||n===tR||n===nR){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===YT)return i.COMPRESSED_RED_RGTC1_EXT;if(n===eR)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===tR)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===nR)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===uT?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class CV extends $I{constructor(e,t,n){super(e,t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}copy(e){return super.copy(e),this.numViews=e.numViews,this}}CV.prototype.isWebGLMultiviewRenderTarget=!0;class MV{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const i=new QI;e.properties.get(i).__webglTexture=t.texture,t.depthNear===n.depthNear&&t.depthFar===n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new yL({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new hL(new Fk(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class TV extends dI{constructor(e,t,n,i){super();const r=this;let o=null,s=1;var a=null;let l=null,c="local-floor",u=1,h=null,d=null;var p=[];let f=null,m=null,g=null,v=null;const y=new MV,A=t.getContextAttributes();let x=null,b=null;const _=[],w=[],E=new EI;let S=null;const C=new wL;C.viewport=new qI;const M=new wL;M.viewport=new qI;const T=[C,M],R=new wU;let I=null,P=null;function B(e){const t=w.indexOf(e.inputSource);if(-1===t)return;const n=_[t];void 0!==n&&(n.update(e.inputSource,e.frame,h||l),n.dispatchEvent({type:e.type,data:e.inputSource}))}function L(){o.removeEventListener("select",B),o.removeEventListener("selectstart",B),o.removeEventListener("selectend",B),o.removeEventListener("squeeze",B),o.removeEventListener("squeezestart",B),o.removeEventListener("squeezeend",B),o.removeEventListener("end",L),o.removeEventListener("inputsourceschange",N);for(let e=0;e<_.length;e++){const t=w[e];null!==t&&(w[e]=null,_[e].disconnect(t))}I=null,P=null,y.reset(),e.setRenderTarget(x),g=null,m=null,f=null,o=null,b=null,F.stop(),r.isPresenting=!1,e.setPixelRatio(S),e.setSize(E.width,E.height,!1),r.dispatchEvent({type:"sessionend"})}function N(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=w.indexOf(n);i>=0&&(w[i]=null,_[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=w.indexOf(n);if(-1===i){for(let e=0;e<_.length;e++){if(e>=w.length){w.push(n),i=e;break}if(null===w[e]){w[e]=n,i=e;break}}if(-1===i)break}const r=_[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return d},this.getController=function(e){let t=_[e];return void 0===t&&(t=new IL,_[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=_[e];return void 0===t&&(t=new IL,_[e]=t),t.getGripSpace()},this.getHand=function(e){let t=_[e];return void 0===t&&(t=new IL,_[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){c=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||l},this.setReferenceSpace=function(e){h=e},this.getBaseLayer=function(){return null!==m?m:g},this.getBinding=function(){return f},this.getRenderTarget=function(){return b},this.getFrame=function(){return v},this.getSession=function(){return o},this.setSession=async function(a){if(o=a,null!==o){x=e.getRenderTarget(),o.addEventListener("select",B),o.addEventListener("selectstart",B),o.addEventListener("selectend",B),o.addEventListener("squeeze",B),o.addEventListener("squeezestart",B),o.addEventListener("squeezeend",B),o.addEventListener("end",L),o.addEventListener("inputsourceschange",N),!0!==A.xrCompatible&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(E);if("undefined"!==typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let a=null,l=null,c=null;A.depth&&(c=A.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,a=A.stencil?yT:vT,l=A.stencil?uT:oT),r.isMultiview=i&&n.has("OCULUS_multiview");const u={colorFormat:t.RGBA8,depthFormat:c,scaleFactor:s};r.isMultiview&&(u.textureType="texture-array"),f=new XRWebGLBinding(o,t),m=f.createProjectionLayer(u),o.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1);const h={format:fT,type:eT,depthTexture:new SD(m.textureWidth,m.textureHeight,l,void 0,void 0,void 0,void 0,void 0,void 0,a),stencilBuffer:A.stencil,colorSpace:e.outputColorSpace,samples:A.antialias?4:0,resolveDepthBuffer:!1===m.ignoreDepthValues};if(r.isMultiview){const e=n.get("OCULUS_multiview");this.maxNumViews=t.getParameter(e.MAX_VIEWS_OVR),b=new CV(m.textureWidth,m.textureHeight,2,h)}else b=new $I(m.textureWidth,m.textureHeight,h)}else{const n={antialias:A.antialias,alpha:!0,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:s};g=new XRWebGLLayer(o,t,n),o.updateRenderState({baseLayer:g}),e.setPixelRatio(1),e.setSize(g.framebufferWidth,g.framebufferHeight,!1),b=new $I(g.framebufferWidth,g.framebufferHeight,{format:fT,type:eT,colorSpace:e.outputColorSpace,stencilBuffer:A.stencil})}b.isXRRenderTarget=!0,this.setFoveation(u),h=null,l=await o.requestReferenceSpace(c),F.setContext(o),F.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==o)return o.environmentBlendMode},this.addLayer=function(e){window.XRWebGLBinding&&this.layersEnabled&&o&&(p.push(e),this.updateLayers())},this.removeLayer=function(e){p.splice(p.indexOf(e),1),window.XRWebGLBinding&&this.layersEnabled&&o&&this.updateLayers()},this.updateLayers=function(){var e=p.map((function(e){return e}));e.unshift(o.renderState.layers[0]),o.updateRenderState({layers:e})},this.getDepthTexture=function(){return y.getDepthTexture()};const D=new tP,k=new tP;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.setPoseTarget=function(e){void 0!==e&&(a=e)},this.updateCamera=function(e){if(null===o)return;let t=e.near,n=e.far;null!==y.texture&&(y.depthNear>0&&(t=y.depthNear),y.depthFar>0&&(n=y.depthFar)),R.near=M.near=C.near=t,R.far=M.far=C.far=n,I===R.near&&P===R.far||(o.updateRenderState({depthNear:R.near,depthFar:R.far}),I=R.near,P=R.far),C.layers.mask=2|e.layers.mask,M.layers.mask=4|e.layers.mask,R.layers.mask=C.layers.mask|M.layers.mask;const i=R.cameras;var r=a||e;const s=r.parent;O(R,s);for(let o=0;o<i.length;o++)O(i[o],s);2===i.length?function(e,t,n){D.setFromMatrixPosition(t.matrixWorld),k.setFromMatrixPosition(n.matrixWorld);const i=D.distanceTo(k),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=i/(-u+h),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+f,n=a+f,r=d-m,o=p+(i-m),u=l*a/n*t,h=c*a/n*t;e.projectionMatrix.makePerspective(r,o,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(R,C,M):R.projectionMatrix.copy(C.projectionMatrix),function(e,t,n){t.matrixWorld.decompose(t.position,t.quaternion,t.scale),null===n.parent?n.matrix.copy(t.matrixWorld):(n.matrix.copy(n.parent.matrixWorld),n.matrix.invert(),n.matrix.multiply(t.matrixWorld));n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*gI*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,R,r)},this.getCamera=function(){return R},this.getFoveation=function(){if(null!==m||null!==g)return u},this.setFoveation=function(e){u=e,null!==m&&(m.fixedFoveation=e),null!==g&&void 0!==g.fixedFoveation&&(g.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==y.texture},this.getDepthSensingMesh=function(){return y.getMesh(R)};let U=null;const F=new YF;F.setAnimationLoop((function(t,n){if(d=n.getViewerPose(h||l),v=n,null!==d){const t=d.views;null!==g&&(e.setRenderTargetFramebuffer(b,g.framebuffer),e.setRenderTarget(b));let n=!1;t.length!==R.cameras.length&&(R.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let o=null;if(null!==g)o=g.getViewport(i);else{const t=f.getViewSubImage(m,i);o=t.viewport,0===r&&(e.setRenderTargetTextures(b,t.colorTexture,m.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(b))}let s=T[r];void 0===s&&(s=new wL,s.layers.enable(r),s.viewport=new qI,T[r]=s),s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&(R.matrix.copy(s.matrix),R.matrix.decompose(R.position,R.quaternion,R.scale)),!0===n&&R.cameras.push(s)}const i=o.enabledFeatures;if(i&&i.includes("depth-sensing")&&"gpu-optimized"==o.depthUsage&&f){const n=f.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&y.init(e,n,o.renderState)}}for(let e=0;e<_.length;e++){const t=w[e],i=_[e];null!==t&&void 0!==i&&i.update(t,n,h||l)}U&&U(t,n),n.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:n}),v=null})),this.setAnimationLoop=function(e){U=e},this.dispose=function(){}}}const RV=new jP,IV=new PP;function PV(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,i.side===zC&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),i.side===zC&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),o=r.envMap,s=r.envMapRotation;o&&(e.envMap.value=o,RV.copy(s),RV.x*=-1,RV.y*=-1,RV.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&(RV.y*=-1,RV.z*=-1),e.envMapRotation.value.setFromMatrix4(IV.makeRotationFromEuler(RV)),e.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,gL(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,o,s,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===zC&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,o,s):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function BV(e,t,n,i){let r={},o={},s=[];const a=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,o=t+"_"+n;if(void 0===i[o])return i[o]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const e=i[o];if("number"===typeof r||"boolean"===typeof r){if(e!==r)return i[o]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=s.indexOf(n.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let o=0,s=t.length;o<s;o++){const e=Array.isArray(t[o])?t[o]:[t[o]];for(let t=0,r=e.length;t<r;t++){const r=e[t],o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]),s=n%i,a=s%t.boundary,l=s+a;n+=a,0!==l&&i-l<t.storage&&(n+=i-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=t.render.frame;o[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,s=i.length;r<s;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,o)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let o=0;o<n.length;o++){const s=n[o],a=c(s);"number"===typeof s||"boolean"===typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),o[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);s=[],r={},o={}}}}class LV{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=PI(),context:n=null,depth:i=!0,stencil:r=!1,alpha:o=!1,antialias:s=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:h=!1,multiviewStereo:d=!1}=e;let p;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=n.getContextAttributes().alpha}else p=o;const f=new Uint32Array(4),m=new Int32Array(4);let g=null,v=null;const y=[],A=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ER,this.toneMapping=SM,this.toneMappingExposure=1;const x=this;let b=!1,_=0,w=0,E=null,S=-1,C=null;const M=new qI,T=new qI;let R=null;const I=new wB(0);let P=0,B=t.width,L=t.height,N=1,D=null,k=null;const O=new qI(0,0,B,L),U=new qI(0,0,B,L);let F=!1;const z=new BN;let j=!1,V=!1;this.transmissionResolutionScale=1;const G=new PP,H=new PP,W=new tP,Q=new qI,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let X=!1;function $(){return null===E?N:1}let Y,K,J,Z,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,he,de,pe,fe,me,ge,ve,ye,Ae,xe,be=n;function _e(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${TC}`),t.addEventListener("webglcontextlost",Se,!1),t.addEventListener("webglcontextrestored",Ce,!1),t.addEventListener("webglcontextcreationerror",Me,!1),null===be){const t="webgl2";if(be=_e(t,e),null===be)throw _e(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(We){throw console.error("THREE.WebGLRenderer: "+We.message),We}function we(){Y=new Tz(be),Y.init(),ye=new SV(be,Y),K=new az(be,Y,e,ye),J=new wV(be,Y),K.reverseDepthBuffer&&h&&J.buffers.depth.setReversed(!0),Z=new Pz(be),ee=new uV,te=new EV(be,Y,J,ee,K,ye,Z),ne=new cz(x),ie=new Mz(x),re=new KF(be),Ae=new oz(be,re),oe=new Rz(be,re,Z,Ae),se=new Nz(be,oe,re,Z),me=new Bz(be,K,te),he=new lz(ee),ae=new cV(x,ne,ie,Y,K,Ae,he),le=new PV(x,ee),ce=new fV,ue=new xV(Y),fe=new rz(x,ne,ie,J,se,p,a),pe=new Lz(x,Y,be),de=new bV(x,se,K),xe=new BV(be,Z,K,J),ge=new sz(be,Y,Z),ve=new Iz(be,Y,Z),Z.programs=ae.programs,x.capabilities=K,x.extensions=Y,x.properties=ee,x.renderLists=ce,x.shadowMap=de,x.state=J,x.info=Z}we();const Ee=new TV(x,be);function Se(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=Z.autoReset,t=de.enabled,n=de.autoUpdate,i=de.needsUpdate,r=de.type;we(),Z.autoReset=e,de.enabled=t,de.autoUpdate=n,de.needsUpdate=i,de.type=r}function Me(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Te(e){const t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){const t=ee.get(e).programs;void 0!==t&&(t.forEach((function(e){ae.releaseProgram(e)})),e.isShaderMaterial&&ae.releaseShaderCache(e))})(e),ee.remove(e)}(t)}function Re(e,t,n){!0===e.transparent&&e.side===jC&&!1===e.forceSinglePass?(e.side=zC,e.needsUpdate=!0,Fe(e,t,n),e.side=FC,e.needsUpdate=!0,Fe(e,t,n),e.side=jC):Fe(e,t,n)}this.xr=Ee,this.getContext=function(){return be},this.getContextAttributes=function(){return be.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(e){void 0!==e&&(N=e,this.setSize(B,L,!1))},this.getSize=function(e){return e.set(B,L)},this.setSize=function(e,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ee.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(B=e,L=n,t.width=Math.floor(e*N),t.height=Math.floor(n*N),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(B*N,L*N).floor()},this.setDrawingBufferSize=function(e,n,i){B=e,L=n,N=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(M)},this.getViewport=function(e){return e.copy(O)},this.setViewport=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),J.viewport(M.copy(O).multiplyScalar(N).round())},this.getScissor=function(e){return e.copy(U)},this.setScissor=function(e,t,n,i){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,i),J.scissor(T.copy(U).multiplyScalar(N).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){J.setScissorTest(F=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return e.copy(fe.getClearColor())},this.setClearColor=function(){fe.setClearColor.apply(fe,arguments)},this.getClearAlpha=function(){return fe.getClearAlpha()},this.setClearAlpha=function(){fe.setClearAlpha.apply(fe,arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==E){const t=E.texture.format;e=t===ET||t===_T||t===xT}if(e){const e=E.texture.type,t=e===eT||e===oT||e===iT||e===uT||e===lT||e===cT,n=fe.getClearColor(),i=fe.getClearAlpha(),r=n.r,o=n.g,s=n.b;t?(f[0]=r,f[1]=o,f[2]=s,f[3]=i,be.clearBufferuiv(be.COLOR,0,f)):(m[0]=r,m[1]=o,m[2]=s,m[3]=i,be.clearBufferiv(be.COLOR,0,m))}else n|=be.COLOR_BUFFER_BIT}e&&(n|=be.DEPTH_BUFFER_BIT),t&&(n|=be.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),be.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Se,!1),t.removeEventListener("webglcontextrestored",Ce,!1),t.removeEventListener("webglcontextcreationerror",Me,!1),fe.dispose(),ce.dispose(),ue.dispose(),ee.dispose(),ne.dispose(),ie.dispose(),se.dispose(),Ae.dispose(),xe.dispose(),ae.dispose(),Ee.dispose(),Ee.removeEventListener("sessionstart",Pe),Ee.removeEventListener("sessionend",Be),Le.stop()},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=q);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=q);te.resetTextureUnits();const o=t.fog,s=i.isMeshStandardMaterial?t.environment:null,a=null===E?x.outputColorSpace:!0===E.isXRRenderTarget?E.texture.colorSpace:SR,l=(i.isMeshStandardMaterial?ie:ne).get(i.envMap||s),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=SM;i.toneMapped&&(null!==E&&!0!==E.isXRRenderTarget||(f=x.toneMapping));const m=E&&E.isWebGLMultiviewRenderTarget?E.numViews:0,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==g?g.length:0,A=ee.get(i),b=v.state.lights;if(!0===j&&(!0===V||e!==C)){const t=e===C&&i.id===S;he.setState(i,e,t)}let _=!1;i.version===A.__version?A.needsLights&&A.lightsStateVersion!==b.state.version||A.outputColorSpace!==a||r.isBatchedMesh&&!1===A.batching?_=!0:r.isBatchedMesh||!0!==A.batching?r.isBatchedMesh&&!0===A.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===A.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===A.instancing?_=!0:r.isInstancedMesh||!0!==A.instancing?r.isSkinnedMesh&&!1===A.skinning?_=!0:r.isSkinnedMesh||!0!==A.skinning?r.isInstancedMesh&&!0===A.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===A.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===A.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===A.instancingMorph&&null!==r.morphTexture||A.envMap!==l||!0===i.fog&&A.fog!==o?_=!0:void 0===A.numClippingPlanes||A.numClippingPlanes===he.numPlanes&&A.numIntersection===he.numIntersection?(A.vertexAlphas!==c||A.vertexTangents!==u||A.morphTargets!==h||A.morphNormals!==d||A.morphColors!==p||A.toneMapping!==f||A.morphTargetsCount!==y||A.numMultiviewViews!==m)&&(_=!0):_=!0:_=!0:_=!0:_=!0:(_=!0,A.__version=i.version);let w=A.currentProgram;!0===_&&(w=Fe(i,t,r));let M=!1,T=!1,R=!1;const I=w.getUniforms(),P=A.uniforms;J.useProgram(w.program)&&(M=!0,T=!0,R=!0);i.id!==S&&(S=i.id,T=!0);if(M||C!==e){if(w.numMultiviewViews>0)pe.updateCameraProjectionMatricesUniform(e,I),pe.updateCameraViewMatricesUniform(e,I);else{J.buffers.depth.getReversed()?(G.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(G),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(G),I.setValue(be,"projectionMatrix",G)):I.setValue(be,"projectionMatrix",e.projectionMatrix),I.setValue(be,"viewMatrix",e.matrixWorldInverse)}const t=I.map.cameraPosition;void 0!==t&&t.setValue(be,W.setFromMatrixPosition(e.matrixWorld)),K.logarithmicDepthBuffer&&I.setValue(be,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&I.setValue(be,"isOrthographic",!0===e.isOrthographicCamera),C!==e&&(C=e,T=!0,R=!0)}if(r.isSkinnedMesh){I.setOptional(be,r,"bindMatrix"),I.setOptional(be,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(be,"boneTexture",e.boneTexture,te))}r.isBatchedMesh&&(I.setOptional(be,r,"batchingTexture"),I.setValue(be,"batchingTexture",r._matricesTexture,te),I.setOptional(be,r,"batchingIdTexture"),I.setValue(be,"batchingIdTexture",r._indirectTexture,te),I.setOptional(be,r,"batchingColorTexture"),null!==r._colorsTexture&&I.setValue(be,"batchingColorTexture",r._colorsTexture,te));const B=n.morphAttributes;void 0===B.position&&void 0===B.normal&&void 0===B.color||me.update(r,n,w);(T||A.receiveShadow!==r.receiveShadow)&&(A.receiveShadow=r.receiveShadow,I.setValue(be,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(P.envMapIntensity.value=t.environmentIntensity);T&&(I.setValue(be,"toneMappingExposure",x.toneMappingExposure),A.needsLights&&(k=R,(D=P).ambientLightColor.needsUpdate=k,D.lightProbe.needsUpdate=k,D.directionalLights.needsUpdate=k,D.directionalLightShadows.needsUpdate=k,D.pointLights.needsUpdate=k,D.pointLightShadows.needsUpdate=k,D.spotLights.needsUpdate=k,D.spotLightShadows.needsUpdate=k,D.rectAreaLights.needsUpdate=k,D.hemisphereLights.needsUpdate=k),o&&!0===i.fog&&le.refreshFogUniforms(P,o),le.refreshMaterialUniforms(P,i,N,L,v.state.transmissionRenderTarget[e.id]),Fj.upload(be,ze(A),P,te));var D,k;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Fj.upload(be,ze(A),P,te),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&I.setValue(be,"center",r.center);w.numMultiviewViews>0?pe.updateObjectMatricesUniforms(r,e,I):(I.setValue(be,"modelViewMatrix",r.modelViewMatrix),I.setValue(be,"normalMatrix",r.normalMatrix));if(I.setValue(be,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];xe.update(n,w),xe.bind(n,w)}}return w}(e,t,n,i,r);J.setMaterial(i,s);let l=n.index,c=1;if(!0===i.wireframe){if(l=oe.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==o&&(d=Math.max(d,o.start*c),p=Math.min(p,(o.start+o.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;Ae.setup(r,i,a,n,l);let g=ge;if(null!==l&&(m=re.get(l),g=ve,g.setIndex(m)),r.isMesh)!0===i.wireframe?(J.setLineWidth(i.wireframeLinewidth*$()),g.setMode(be.LINES)):g.setMode(be.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),J.setLineWidth(e*$()),r.isLineSegments?g.setMode(be.LINES):r.isLineLoop?g.setMode(be.LINE_LOOP):g.setMode(be.LINE_STRIP)}else r.isPoints?g.setMode(be.POINTS):r.isSprite&&g.setMode(be.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)g.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))g.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,o=l?re.get(l).bytesPerElement:1,s=ee.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)s.setValue(be,"_gl_DrawID",i),g.render(e[i]/o,t[i])}else if(r.isInstancedMesh)g.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(d,f,t)}else g.render(d,f)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),v=ue.get(n),v.init(t),A.push(v),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(v.pushLight(e),e.castShadow&&v.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(v.pushLight(e),e.castShadow&&v.pushShadow(e))})),v.setupLights();const i=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const o=t[r];Re(o,n,e),i.add(o)}else Re(t,n,e),i.add(t)})),A.pop(),v=null,i},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){ee.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ie=null;function Pe(){Le.stop()}function Be(){Le.start()}const Le=new YF;function Ne(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)v.pushLight(e),e.castShadow&&v.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||z.intersectsSprite(e)){i&&Q.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=se.update(e),r=e.material;r.visible&&g.push(e,t,r,n,Q.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||z.intersectsObject(e))){const t=se.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),Q.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),Q.copy(t.boundingSphere.center)),Q.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(r)){const i=t.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r[s.materialIndex];a&&a.visible&&g.push(e,t,a,n,Q.z,s)}}else r.visible&&g.push(e,t,r,n,Q.z,null)}const r=e.children;for(let o=0,s=r.length;o<s;o++)Ne(r[o],t,n,i)}function De(e,t,n,i){const r=e.opaque,o=e.transmissive,s=e.transparent;v.setupLightsView(n),!0===j&&he.setGlobalState(x.clippingPlanes,n),i&&J.viewport(M.copy(i)),r.length>0&&Oe(r,t,n),o.length>0&&Oe(o,t,n),s.length>0&&Oe(s,t,n),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function ke(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===v.state.transmissionRenderTarget[i.id]&&(v.state.transmissionRenderTarget[i.id]=new $I(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?aT:eT,minFilter:JM,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:OI.workingColorSpace}));const o=v.state.transmissionRenderTarget[i.id],s=i.viewport||M;o.setSize(s.z*x.transmissionResolutionScale,s.w*x.transmissionResolutionScale);const a=x.getRenderTarget();x.setRenderTarget(o),x.getClearColor(I),P=x.getClearAlpha(),P<1&&x.setClearColor(16777215,.5),x.clear(),X&&fe.render(n);const l=x.toneMapping;x.toneMapping=SM;const c=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),v.setupLightsView(i),!0===j&&he.setGlobalState(x.clippingPlanes,i),Oe(e,n,i),te.updateMultisampleRenderTarget(o),te.updateRenderTargetMipmap(o),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=o.object,a=o.geometry,l=o.material,c=o.group;if(l.side===jC&&s.layers.test(i.layers)){const t=l.side;l.side=zC,l.needsUpdate=!0,Ue(s,n,i,a,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(te.updateMultisampleRenderTarget(o),te.updateRenderTargetMipmap(o))}x.setRenderTarget(a),x.setClearColor(I,P),void 0!==c&&(i.viewport=c),x.toneMapping=l}function Oe(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,l=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&Ue(s,t,n,a,l,c)}}function Ue(e,t,n,i,r,o){e.onBeforeRender(x,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(x,t,n,i,e,o),!0===r.transparent&&r.side===jC&&!1===r.forceSinglePass?(r.side=zC,r.needsUpdate=!0,x.renderBufferDirect(n,t,i,r,e,o),r.side=FC,r.needsUpdate=!0,x.renderBufferDirect(n,t,i,r,e,o),r.side=jC):x.renderBufferDirect(n,t,i,r,e,o),e.onAfterRender(x,t,n,i,r,o)}function Fe(e,t,n){!0!==t.isScene&&(t=q);const i=ee.get(e),r=v.state.lights,o=v.state.shadowsArray,s=r.state.version,a=ae.getParameters(e,r.state,o,t,n),l=ae.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ie:ne).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Te),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===s)return je(e,a),u}else a.uniforms=ae.getUniforms(e),e.onBeforeCompile(a,x),u=ae.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const h=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=he.uniform),je(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function ze(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Fj.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function je(e,t){const n=ee.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping,n.numMultiviewViews=t.numMultiviewViews}Le.setAnimationLoop((function(e){Ie&&Ie(e)})),"undefined"!==typeof self&&Le.setContext(self),this.setAnimationLoop=function(e){Ie=e,Ee.setAnimationLoop(e),null===e?Le.stop():Le.start()},Ee.addEventListener("sessionstart",Pe),Ee.addEventListener("sessionend",Be),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ee.enabled&&!0===Ee.isPresenting&&(!0===Ee.cameraAutoUpdate&&Ee.updateCamera(t),t=Ee.getCamera()),!0===e.isScene&&e.onBeforeRender(x,e,t,E),v=ue.get(e,A.length),v.init(t),A.push(v),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),z.setFromProjectionMatrix(H),V=this.localClippingEnabled,j=he.init(this.clippingPlanes,V),g=ce.get(e,y.length),g.init(),y.push(g),!0===Ee.enabled&&!0===Ee.isPresenting){const e=x.xr.getDepthSensingMesh();null!==e&&Ne(e,t,-1/0,x.sortObjects)}Ne(e,t,0,x.sortObjects),g.finish(),!0===x.sortObjects&&g.sort(D,k),X=!1===Ee.enabled||!1===Ee.isPresenting||!1===Ee.hasDepthSensing(),X&&fe.addToRenderList(g,e),this.info.render.frame++,!0===j&&he.beginShadows();const n=v.state.shadowsArray;de.render(n,e,t),!0===j&&he.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=g.opaque,r=g.transmissive;if(v.setupLights(),t.isArrayCamera){const n=t.cameras;if(r.length>0)for(let t=0,o=n.length;t<o;t++){ke(i,r,e,n[t])}if(X&&fe.render(e),Ee.enabled&&Ee.isMultiview)te.setDeferTextureUploads(!0),De(g,e,t,t.cameras[0].viewport);else for(let t=0,i=n.length;t<i;t++){const i=n[t];De(g,e,i,i.viewport)}}else r.length>0&&ke(i,r,e,t),X&&fe.render(e),De(g,e,t);null!==E&&0===w&&(te.updateMultisampleRenderTarget(E),te.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(x,e,t),Ae.resetDefaultState(),S=-1,C=null,A.pop(),A.length>0?(v=A[A.length-1],!0===j&&he.setGlobalState(x.clippingPlanes,v.state.camera)):v=null,y.pop(),g=y.length>0?y[y.length-1]:null},this.setTexture2D=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),te.setTexture2D(t,n)}}(),this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,n){ee.get(e.texture).__webglTexture=t,ee.get(e.depthTexture).__webglTexture=n;const i=ee.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||E&&E.isWebGLMultiviewRenderTarget||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=ee.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const Ve=be.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;null===e&&this.xr.isPresenting&&(e=this.xr.getRenderTarget()),E=e,_=t,w=n;let i=!0,r=null,o=!1,s=!1;if(e){const a=ee.get(e);if(void 0!==a.__useDefaultFramebuffer)J.bindFramebuffer(be.FRAMEBUFFER,null),i=!1;else if(void 0===a.__webglFramebuffer)te.setupRenderTarget(e);else if(a.__hasExternalTextures)te.rebindTextures(e,ee.get(e.texture).__webglTexture,ee.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(a.__boundDepthTexture!==t){if(null!==t&&ee.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");te.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=ee.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],o=!0):r=e.samples>0&&!1===te.useMultisampledRTT(e)?ee.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,M.copy(e.viewport),T.copy(e.scissor),R=e.scissorTest}else M.copy(O).multiplyScalar(N).floor(),T.copy(U).multiplyScalar(N).floor(),R=F;0!==n&&(r=Ve);if(J.bindFramebuffer(be.FRAMEBUFFER,r)&&i&&J.drawBuffers(e,r),J.viewport(M),J.scissor(T),J.setScissorTest(R),o){const i=ee.get(e.texture);be.framebufferTexture2D(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(s){const i=ee.get(e.texture),r=t;be.framebufferTextureLayer(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,i.__webglTexture,n,r)}else if(null!==e&&0!==n){const t=ee.get(e.texture);be.framebufferTexture2D(be.FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,t.__webglTexture,n)}S=-1},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=ee.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){J.bindFramebuffer(be.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,l=s.type;if(!K.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&be.readPixels(t,n,i,r,ye.convert(a),ye.convert(l),o)}finally{const e=null!==E?ee.get(E).__webglFramebuffer:null;J.bindFramebuffer(be.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=ee.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){const s=e.texture,l=s.format,c=s.type;if(!K.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){J.bindFramebuffer(be.FRAMEBUFFER,a);const e=be.createBuffer();be.bindBuffer(be.PIXEL_PACK_BUFFER,e),be.bufferData(be.PIXEL_PACK_BUFFER,o.byteLength,be.STREAM_READ),be.readPixels(t,n,i,r,ye.convert(l),ye.convert(c),0);const s=null!==E?ee.get(E).__webglFramebuffer:null;J.bindFramebuffer(be.FRAMEBUFFER,s);const u=be.fenceSync(be.SYNC_GPU_COMMANDS_COMPLETE,0);return be.flush(),await function(e,t,n){return new Promise((function(i,r){setTimeout((function o(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(o,n);break;default:i()}}),n)}))}(be,u,4),be.bindBuffer(be.PIXEL_PACK_BUFFER,e),be.getBufferSubData(be.PIXEL_PACK_BUFFER,0,o),be.deleteBuffer(e),be.deleteSync(u),o}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!0!==e.isTexture&&(LI("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),s=null!==t?t.x:0,a=null!==t?t.y:0;te.setTexture2D(e,0),be.copyTexSubImage2D(be.TEXTURE_2D,n,0,0,s,a,r,o),J.unbindTexture()};const Ge=be.createFramebuffer(),He=be.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,i,r,o,s,a,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;!0!==e.isTexture&&(LI("WebGLRenderer: copyTextureToTexture function signature has changed."),d=arguments[0]||null,e=arguments[1],t=arguments[2],f=arguments[3]||0,h=null),null===f&&(0!==p?(LI("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),f=p,p=0):f=0);const m=e.isCompressedTexture?e.mipmaps[f]:e.image;if(null!==h)n=h.max.x-h.min.x,i=h.max.y-h.min.y,r=h.isBox3?h.max.z-h.min.z:1,o=h.min.x,s=h.min.y,a=h.isBox3?h.min.z:0;else{const t=Math.pow(2,-p);n=Math.floor(m.width*t),i=Math.floor(m.height*t),r=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,o=0,s=0,a=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const g=ye.convert(t.format),v=ye.convert(t.type);let y;t.isData3DTexture?(te.setTexture3D(t,0),y=be.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(te.setTexture2DArray(t,0),y=be.TEXTURE_2D_ARRAY):(te.setTexture2D(t,0),y=be.TEXTURE_2D),be.pixelStorei(be.UNPACK_FLIP_Y_WEBGL,t.flipY),be.pixelStorei(be.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),be.pixelStorei(be.UNPACK_ALIGNMENT,t.unpackAlignment);const A=be.getParameter(be.UNPACK_ROW_LENGTH),x=be.getParameter(be.UNPACK_IMAGE_HEIGHT),b=be.getParameter(be.UNPACK_SKIP_PIXELS),_=be.getParameter(be.UNPACK_SKIP_ROWS),w=be.getParameter(be.UNPACK_SKIP_IMAGES);be.pixelStorei(be.UNPACK_ROW_LENGTH,m.width),be.pixelStorei(be.UNPACK_IMAGE_HEIGHT,m.height),be.pixelStorei(be.UNPACK_SKIP_PIXELS,o),be.pixelStorei(be.UNPACK_SKIP_ROWS,s),be.pixelStorei(be.UNPACK_SKIP_IMAGES,a);const E=e.isDataArrayTexture||e.isData3DTexture,S=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const h=ee.get(e),d=ee.get(t),m=ee.get(h.__renderTarget),g=ee.get(d.__renderTarget);J.bindFramebuffer(be.READ_FRAMEBUFFER,m.__webglFramebuffer),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<r;v++)E&&(be.framebufferTextureLayer(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,ee.get(e).__webglTexture,p,a+v),be.framebufferTextureLayer(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,ee.get(t).__webglTexture,f,u+v)),be.blitFramebuffer(o,s,n,i,l,c,n,i,be.DEPTH_BUFFER_BIT,be.NEAREST);J.bindFramebuffer(be.READ_FRAMEBUFFER,null),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,null)}else if(0!==p||e.isRenderTargetTexture||ee.has(e)){const h=ee.get(e),d=ee.get(t);J.bindFramebuffer(be.READ_FRAMEBUFFER,Ge),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,He);for(let e=0;e<r;e++)E?be.framebufferTextureLayer(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,h.__webglTexture,p,a+e):be.framebufferTexture2D(be.READ_FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,h.__webglTexture,p),S?be.framebufferTextureLayer(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,d.__webglTexture,f,u+e):be.framebufferTexture2D(be.DRAW_FRAMEBUFFER,be.COLOR_ATTACHMENT0,be.TEXTURE_2D,d.__webglTexture,f),0!==p?be.blitFramebuffer(o,s,n,i,l,c,n,i,be.COLOR_BUFFER_BIT,be.NEAREST):S?be.copyTexSubImage3D(y,f,l,c,u+e,o,s,n,i):be.copyTexSubImage2D(y,f,l,c,o,s,n,i);J.bindFramebuffer(be.READ_FRAMEBUFFER,null),J.bindFramebuffer(be.DRAW_FRAMEBUFFER,null)}else S?e.isDataTexture||e.isData3DTexture?be.texSubImage3D(y,f,l,c,u,n,i,r,g,v,m.data):t.isCompressedArrayTexture?be.compressedTexSubImage3D(y,f,l,c,u,n,i,r,g,m.data):be.texSubImage3D(y,f,l,c,u,n,i,r,g,v,m):e.isDataTexture?be.texSubImage2D(be.TEXTURE_2D,f,l,c,n,i,g,v,m.data):e.isCompressedTexture?be.compressedTexSubImage2D(be.TEXTURE_2D,f,l,c,m.width,m.height,g,m.data):be.texSubImage2D(be.TEXTURE_2D,f,l,c,n,i,g,v,m);be.pixelStorei(be.UNPACK_ROW_LENGTH,A),be.pixelStorei(be.UNPACK_IMAGE_HEIGHT,x),be.pixelStorei(be.UNPACK_SKIP_PIXELS,b),be.pixelStorei(be.UNPACK_SKIP_ROWS,_),be.pixelStorei(be.UNPACK_SKIP_IMAGES,w),0===f&&t.generateMipmaps&&be.generateMipmap(y),J.unbindTexture()},this.copyTextureToTexture3D=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!0!==e.isTexture&&(LI("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0),LI('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,i,r)},this.initRenderTarget=function(e){void 0===ee.get(e).__webglFramebuffer&&te.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?te.setTextureCube(e,0):e.isData3DTexture?te.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?te.setTexture2DArray(e,0):te.setTexture2D(e,0),J.unbindTexture()},this.resetState=function(){_=0,w=0,E=null,J.reset(),Ae.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return cI}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=OI._getDrawingBufferColorSpace(e),t.unpackColorSpace=OI._getUnpackColorSpace()}}var NV={8167:e=>{var t=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===t.call(e.buffer)||Array.isArray(e)}},5734:e=>{e.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},7961:(e,t)=>{t.byteLength=function(e){var t=a(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,o=a(e),s=o[0],l=o[1],c=new r(function(e,t,n){return 3*(t+n)/4-n}(0,s,l)),u=0,h=l>0?s-4:s;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===l&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===l&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,o=[],s=16383,a=0,c=i-r;a<c;a+=s)o.push(l(e,a,a+s>c?c:a+s));return 1===r?(t=e[i-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,i){for(var r,o,s=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=r)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},911:(e,t,n)=>{var i=n(9922).hp;e.exports=function(e,t){if(i.isBuffer(e)&&i.isBuffer(t)){if("function"==typeof e.equals)return e.equals(t);if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}}},9922:(e,t,n)=>{const i=n(7961),r=n(1024),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.hp=l,t.IS=50;const s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let i=a(n);const r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if($(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if($(e,ArrayBuffer)||e&&$(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&($(e,SharedArrayBuffer)||e&&$(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return l.from(i,t,n);const r=function(e){if(l.isBuffer(e)){const t=0|f(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||Y(e.length)?a(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|f(e))}function d(e){const t=e.length<0?0:0|f(e.length),n=a(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(i,l.prototype),i}function f(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||$(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return Q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return i?-1:Q(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){let i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function v(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function y(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:A(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):A(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function A(e,t,n,i,r){let o,s=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){let i=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===i?0:o-i)){if(-1===i&&(i=o),o-i+1===l)return i*s}else-1!==i&&(o-=o-i),i=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){let n=!0;for(let i=0;i<l;i++)if(c(e,o+i)!==c(t,i)){n=!1;break}if(n)return o}return-1}function x(e,t,n,i){n=Number(n)||0;const r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;const o=t.length;let s;for(i>o/2&&(i=o/2),s=0;s<i;++s){const i=parseInt(t.substr(2*s,2),16);if(Y(i))return s;e[n+s]=i}return s}function b(e,t,n,i){return X(Q(t,e.length-n),e,n,i)}function _(e,t,n,i){return X(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function w(e,t,n,i){return X(q(t),e,n,i)}function E(e,t,n,i){return X(function(e,t){let n,i,r;const o=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function S(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function C(e,t,n){n=Math.min(e.length,n);const i=[];let r=t;for(;r<n;){const t=e[r];let o=null,s=t>239?4:t>223?3:t>191?2:1;if(r+s<=n){let n,i,a,l;switch(s){case 1:t<128&&(o=t);break;case 2:n=e[r+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(o=l));break;case 3:n=e[r+1],i=e[r+2],128==(192&n)&&128==(192&i)&&(l=(15&t)<<12|(63&n)<<6|63&i,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:n=e[r+1],i=e[r+2],a=e[r+3],128==(192&n)&&128==(192&i)&&128==(192&a)&&(l=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&a,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|1023&o),i.push(o),r+=s}return function(e){const t=e.length;if(t<=M)return String.fromCharCode.apply(String,e);let n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=M));return n}(i)}l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},l.allocUnsafe=function(e){return h(e)},l.allocUnsafeSlow=function(e){return h(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if($(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),$(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const i=l.allocUnsafe(t);let r=0;for(n=0;n<e.length;++n){let t=e[n];if($(t,Uint8Array))r+t.length>i.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(i,r)}r+=t.length}return i},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.IS;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,n,i,r){if($(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;let o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0);const a=Math.min(o,s),c=this.slice(i,r),u=e.slice(t,n);for(let l=0;l<a;++l)if(c[l]!==u[l]){o=c[l],s=u[l];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}const r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":case"latin1":case"binary":return _(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const M=4096;function T(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function R(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function I(e,t,n){const i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let o=t;o<n;++o)r+=K[e[o]];return r}function P(e,t,n){const i=e.slice(t,n);let r="";for(let o=0;o<i.length-1;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function B(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,i,r,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function N(e,t,n,i,r){V(t,i,r,e,n,7);let o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function D(e,t,n,i,r){V(t,i,r,e,n,7);let o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function k(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,i,o){return t=+t,n>>>=0,o||k(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function U(e,t,n,i,o){return t=+t,n>>>=0,o||k(e,0,n,8),r.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const i=this.subarray(e,t);return Object.setPrototypeOf(i,l.prototype),i},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let i=this[e],r=1,o=0;for(;++o<t&&(r*=256);)i+=this[e+o]*r;return i},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||B(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=J((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,r=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(i)+(BigInt(r)<<BigInt(32))})),l.prototype.readBigUInt64BE=J((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=t*2**24+65536*this[++e]+256*this[++e]+this[++e],r=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)})),l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let i=this[e],r=1,o=0;for(;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||B(e,t,this.length);let i=t,r=1,o=this[e+--i];for(;i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||B(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||B(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=J((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=J((function(e){G(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const i=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||B(e,4,this.length),r.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||B(e,4,this.length),r.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||B(e,8,this.length),r.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||B(e,8,this.length),r.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||L(this,e,t,n,Math.pow(2,8*n)-1,0);let r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||L(this,e,t,n,Math.pow(2,8*n)-1,0);let r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=J((function(e){return N(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=J((function(e){return D(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}let r=0,o=1,s=0;for(this[t]=255&e;++r<n&&(o*=256);)e<0&&0===s&&0!==this[t+r-1]&&(s=1),this[t+r]=(e/o|0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){const i=Math.pow(2,8*n-1);L(this,e,t,n,i-1,-i)}let r=n-1,o=1,s=0;for(this[t+r]=255&e;--r>=0&&(o*=256);)e<0&&0===s&&0!==this[t+r+1]&&(s=1),this[t+r]=(e/o|0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=J((function(e){return N(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=J((function(e){return D(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);const r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){const t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{const o=l.isBuffer(e)?e:l.from(e,i),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=o[r%s]}return this};const F={};function z(e,t,n){F[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function j(e){let t="",n=e.length;const i="-"===e[0]?1:0;for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function V(e,t,n,i,r,o){if(e>n||e<t){const i="bigint"==typeof t?"n":"";let r;throw r=o>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(o+1)}${i}`:`>= -(2${i} ** ${8*(o+1)-1}${i}) and < 2 ** ${8*(o+1)-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new F.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,n){G(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||H(t,e.length-(n+1))}(i,r,o)}function G(e,t){if("number"!=typeof e)throw new F.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,n){if(Math.floor(e)!==e)throw G(e,n),new F.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}z("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),z("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),z("ERR_OUT_OF_RANGE",(function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>2**32?r=j(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=j(r)),r+="n"),i+=` It must be ${t}. Received ${r}`,i}),RangeError);const W=/[^+/0-9A-Za-z-_]/g;function Q(e,t){let n;t=t||1/0;const i=e.length;let r=null;const o=[];for(let s=0;s<i;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function q(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function X(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function $(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const K=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function J(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},9089:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&s[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},6492:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},963:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},8878:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))})),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(8945)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},8945:(e,t,n)=>{e.exports=function(e){function t(e){let n,r,o,s=null;function a(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];if(!a.enabled)return;const o=a,s=Number(new Date),l=s-(n||s);o.diff=l,o.prev=n,o.curr=s,n=s,i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");let c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,((e,n)=>{if("%%"===e)return"%";c++;const r=t.formatters[n];if("function"==typeof r){const t=i[c];e=r.call(o,t),i.splice(c,1),c--}return e})),t.formatArgs.call(o,i),(o.log||t.log).apply(o,i)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,n){const i=t(this.namespace+(void 0===n?":":n)+e);return i.log=this.log,i}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"==typeof e?e:"").split(/[\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&("-"===(e=i[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,i;for(n=0,i=t.skips.length;n<i;n++)if(t.skips[n].test(e))return!1;for(n=0,i=t.names.length;n<i;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(9192),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},1124:(e,t,n)=>{var i=n(6240),r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e,t,n){var o=t[n];if(null!=o){if(r.call(e,n)&&(void 0===e[n]||null===e[n]))throw new TypeError("Cannot convert undefined or null to object ("+n+")");r.call(e,n)&&i(o)?e[n]=a(Object(e[n]),t[n]):e[n]=o}}function a(e,t){if(e===t)return e;for(var n in t=Object(t))r.call(t,n)&&s(e,t,n);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(t),a=0;a<i.length;a++)o.call(t,i[a])&&s(e,t,i[a]);return e}e.exports=function(e){e=function(e){if(null==e)throw new TypeError("Sources cannot be null or undefined");return Object(e)}(e);for(var t=1;t<arguments.length;t++)a(e,arguments[t]);return e}},8480:e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},919:(e,t,n)=>{var i;i="undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},e.exports=i},1024:(e,t)=>{t.read=function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m}},2225:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},8847:e=>{e.exports=function(e){if(!e)return!1;var n=t.call(e);return"[object Function]"===n||"function"==typeof e&&"[object RegExp]"!==n||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var t=Object.prototype.toString},6240:e=>{e.exports=function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}},5651:(e,t,n)=>{var i=n(5406),r=n(4597),o=n(5734),s=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),u=" ".charCodeAt(0);function h(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function d(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function p(e,t){if(!e.chars||0===e.chars.length)return null;var n=m(e.chars,t);return n>=0?e.chars[n]:null}function f(e,t,n){if(!e.kernings||0===e.kernings.length)return 0;for(var i=e.kernings,r=0;r<i.length;r++){var o=i[r];if(o.first===t&&o.second===n)return o.amount}return 0}function m(e,t,n){for(var i=n=n||0;i<e.length;i++)if(e[i].id===t)return i;return-1}e.exports=function(e){return new h(e)},h.prototype.update=function(e){if(e=r({measure:this._measure},e),this._opt=e,this._opt.tabSize=o(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,n=e.text||"",a=e.font;this._setupSpaceGlyphs(a);var c=i.lines(n,e),u=e.width||0;t.length=0;var h=c.reduce((function(e,t){return Math.max(e,t.width,u)}),0),d=0,p=0,g=o(e.lineHeight,a.common.lineHeight),v=a.common.base,y=g-v,A=e.letterSpacing||0,x=g*c.length-y,b=function(e){return"center"===e?1:"right"===e?2:0}(this._opt.align);p-=x,this._width=h,this._height=x,this._descender=g-v,this._baseline=v,this._xHeight=function(e){for(var t=0;t<s.length;t++){var n=s[t].charCodeAt(0),i=m(e.chars,n);if(i>=0)return e.chars[i].height}return 0}(a),this._capHeight=function(e){for(var t=0;t<l.length;t++){var n=l[t].charCodeAt(0),i=m(e.chars,n);if(i>=0)return e.chars[i].height}return 0}(a),this._lineHeight=g,this._ascender=g-y-this._xHeight;var _=this;c.forEach((function(e,i){for(var r,o=e.start,s=e.end,l=e.width,c=o;c<s;c++){var u=n.charCodeAt(c),m=_.getGlyph(a,u);if(m){r&&(d+=f(a,r.id,m.id));var v=d;1===b?v+=(h-l)/2:2===b&&(v+=h-l),t.push({position:[v,p],data:m,index:c,line:i}),d+=m.xadvance+A,r=m}}p+=g,d=0})),this._linesTotal=c.length},h.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,u)||function(e){for(var t=0;t<a.length;t++){var n=a[t].charCodeAt(0),i=m(e.chars,n);if(i>=0)return e.chars[i]}return 0}(e)||e.chars[0],n=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=r(t,{x:0,y:0,xadvance:n,id:c,xoffset:0,yoffset:0,width:0,height:0})}},h.prototype.getGlyph=function(e,t){return p(e,t)||(t===c?this._fallbackTabGlyph:t===u?this._fallbackSpaceGlyph:null)},h.prototype.computeMetrics=function(e,t,n,i){var r,o=this._opt.letterSpacing||0,s=this._opt.font,a=0,l=0,c=0;if(!s.chars||0===s.chars.length)return{start:t,end:t,width:0};n=Math.min(e.length,n);for(var u=t;u<n;u++){var h,d=e.charCodeAt(u);if(h=this.getGlyph(s,d)){h.xoffset;var p=(a+=r?f(s,r.id,h.id):0)+h.xadvance+o,m=a+h.width;if(m>=i||p>=i)break;a=p,l=m,r=h}c++}return r&&(l+=r.xoffset),{start:t,end:t+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(h.prototype,e,{get:d(e),configurable:!0})}))},5751:(e,t,n)=>{var i=n(9922).hp,r=n(3558),o=function(){},s=n(1476),a=n(7034),l=n(7480),c=n(573),u=n(4597),h=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;e.exports=function(e,t){t="function"==typeof t?t:o,"string"==typeof e?e={uri:e}:e||(e={}),e.binary&&(e=function(e){if(h)return u(e,{responseType:"arraybuffer"});if(void 0===self.XMLHttpRequest)throw new Error("your browser does not support XHR loading");var t=new self.XMLHttpRequest;return t.overrideMimeType("text/plain; charset=x-user-defined"),u({xhr:t},e)}(e)),r(e,(function(n,r,u){if(n)return t(n);if(!/^2/.test(r.statusCode))return t(new Error("http status code: "+r.statusCode));if(!u)return t(new Error("no body result"));var h,d,p=!1;if(h=u,"[object ArrayBuffer]"===Object.prototype.toString.call(h)){var f=new Uint8Array(u);u=i.from(f,"binary")}c(u)&&(p=!0,"string"==typeof u&&(u=i.from(u,"binary"))),p||(i.isBuffer(u)&&(u=u.toString(e.encoding)),u=u.trim());try{var m=r.headers["content-type"];d=p?l(u):/json/.test(m)||"{"===u.charAt(0)?JSON.parse(u):/xml/.test(m)||"<"===u.charAt(0)?a(u):s(u)}catch(e){t(new Error("error parsing font "+e.message)),t=o}t(null,d)}))}},573:(e,t,n)=>{var i=n(9922).hp,r=n(911),o=i.from([66,77,70,3]);e.exports=function(e){return"string"==typeof e?"BMF"===e.substring(0,3):e.length>4&&r(e.slice(0,4),o)}},9192:e=>{var t=1e3,n=60*t,i=60*n,r=24*i,o=7*r;function s(e,t,n,i){var r=t>=1.5*n;return Math.round(e/n)+" "+i+(r?"s":"")}e.exports=function(e,a){a=a||{};var l,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var a=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*r;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===u&&isFinite(e))return a.long?(l=e,(c=Math.abs(l))>=r?s(l,c,r,"day"):c>=i?s(l,c,i,"hour"):c>=n?s(l,c,n,"minute"):c>=t?s(l,c,t,"second"):l+" ms"):function(e){var o=Math.abs(e);return o>=r?Math.round(e/r)+"d":o>=i?Math.round(e/i)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},1476:e=>{function t(e,t){if(!(e=e.replace(/\t+/g," ").trim()))return null;var i=e.indexOf(" ");if(-1===i)throw new Error("no named row at line "+t);var r=e.substring(0,i);e=(e=(e=(e=e.substring(i+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map((function(e){return e.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)}));for(var o=[],s=0;s<e.length;s++){var a=e[s];0===s?o.push({key:a[0],data:""}):s===e.length-1?o[o.length-1].data=n(a[0]):(o[o.length-1].data=n(a[0]),o.push({key:a[1],data:""}))}var l={key:r,data:{}};return o.forEach((function(e){l.data[e.key]=e.data})),l}function n(e){return e&&0!==e.length?0===e.indexOf('"')||0===e.indexOf("'")?e.substring(1,e.length-1):-1!==e.indexOf(",")?function(e){return e.split(",").map((function(e){return parseInt(e,10)}))}(e):parseInt(e,10):""}e.exports=function(e){if(!e)throw new Error("no data provided");var n={pages:[],chars:[],kernings:[]},i=(e=e.toString().trim()).split(/\r\n?|\n/g);if(0===i.length)throw new Error("no data in BMFont file");for(var r=0;r<i.length;r++){var o=t(i[r],r);if(o)if("page"===o.key){if("number"!=typeof o.data.id)throw new Error("malformed file at line "+r+" -- needs page id=N");if("string"!=typeof o.data.file)throw new Error("malformed file at line "+r+' -- needs page file="path"');n.pages[o.data.id]=o.data.file}else"chars"===o.key||"kernings"===o.key||("char"===o.key?n.chars.push(o.data):"kerning"===o.key?n.kernings.push(o.data):n[o.key]=o.data)}return n}},7480:e=>{var t=[66,77,70];function n(e,t,n){if(n>t.length-1)return 0;var r=t.readUInt8(n++),o=t.readInt32LE(n);switch(n+=4,r){case 1:e.info=function(e,t){var n={};n.size=e.readInt16LE(t);var r=e.readUInt8(t+2);return n.smooth=r>>7&1,n.unicode=r>>6&1,n.italic=r>>5&1,n.bold=r>>4&1,r>>3&1&&(n.fixedHeight=1),n.charset=e.readUInt8(t+3)||"",n.stretchH=e.readUInt16LE(t+4),n.aa=e.readUInt8(t+6),n.padding=[e.readInt8(t+7),e.readInt8(t+8),e.readInt8(t+9),e.readInt8(t+10)],n.spacing=[e.readInt8(t+11),e.readInt8(t+12)],n.outline=e.readUInt8(t+13),n.face=function(e,t){return i(e,t).toString("utf8")}(e,t+14),n}(t,n);break;case 2:e.common=function(e,t){var n={};return n.lineHeight=e.readUInt16LE(t),n.base=e.readUInt16LE(t+2),n.scaleW=e.readUInt16LE(t+4),n.scaleH=e.readUInt16LE(t+6),n.pages=e.readUInt16LE(t+8),e.readUInt8(t+10),n.packed=0,n.alphaChnl=e.readUInt8(t+11),n.redChnl=e.readUInt8(t+12),n.greenChnl=e.readUInt8(t+13),n.blueChnl=e.readUInt8(t+14),n}(t,n);break;case 3:e.pages=function(e,t,n){for(var r=[],o=i(e,t),s=o.length+1,a=n/s,l=0;l<a;l++)r[l]=e.slice(t,t+o.length).toString("utf8"),t+=s;return r}(t,n,o);break;case 4:e.chars=function(e,t,n){for(var i=[],r=n/20,o=0;o<r;o++){var s={},a=20*o;s.id=e.readUInt32LE(t+0+a),s.x=e.readUInt16LE(t+4+a),s.y=e.readUInt16LE(t+6+a),s.width=e.readUInt16LE(t+8+a),s.height=e.readUInt16LE(t+10+a),s.xoffset=e.readInt16LE(t+12+a),s.yoffset=e.readInt16LE(t+14+a),s.xadvance=e.readInt16LE(t+16+a),s.page=e.readUInt8(t+18+a),s.chnl=e.readUInt8(t+19+a),i[o]=s}return i}(t,n,o);break;case 5:e.kernings=function(e,t,n){for(var i=[],r=n/10,o=0;o<r;o++){var s={},a=10*o;s.first=e.readUInt32LE(t+0+a),s.second=e.readUInt32LE(t+4+a),s.amount=e.readInt16LE(t+8+a),i[o]=s}return i}(t,n,o)}return 5+o}function i(e,t){for(var n=t;n<e.length&&0!==e[n];n++);return e.slice(t,n)}e.exports=function(e){if(e.length<6)throw new Error("invalid buffer length for BMFont");var i=t.every((function(t,n){return e.readUInt8(n)===t}));if(!i)throw new Error("BMFont missing BMF byte header");var r=3;if(e.readUInt8(r++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var o={kernings:[],chars:[]},s=0;s<5;s++)r+=n(o,e,r);return o}},7034:(e,t,n)=>{var i=n(7829),r=n(1896),o={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function s(e){var t=function(e){for(var t=[],n=0;n<e.attributes.length;n++)t.push(e.attributes[n]);return t}(e);return t.reduce((function(e,t){var n;return e[(n=t.nodeName,o[n.toLowerCase()]||n)]=t.nodeValue,e}),{})}e.exports=function(e){e=e.toString();var t=r(e),n={pages:[],chars:[],kernings:[]};["info","common"].forEach((function(e){var r=t.getElementsByTagName(e)[0];r&&(n[e]=i(s(r)))}));var o=t.getElementsByTagName("pages")[0];if(!o)throw new Error("malformed file -- no <pages> element");for(var a=o.getElementsByTagName("page"),l=0;l<a.length;l++){var c=a[l],u=parseInt(c.getAttribute("id"),10),h=c.getAttribute("file");if(isNaN(u))throw new Error('malformed file -- page "id" attribute is NaN');if(!h)throw new Error('malformed file -- needs page "file" attribute');n.pages[parseInt(u,10)]=h}return["chars","kernings"].forEach((function(e){var r=t.getElementsByTagName(e)[0];if(r)for(var o=e.substring(0,e.length-1),a=r.getElementsByTagName(o),l=0;l<a.length;l++){var c=a[l];n[e].push(i(s(c)))}})),n}},7829:e=>{var t="chasrset";e.exports=function(e){for(var n in e=Object.assign({},e),t in e&&(e.charset=e[t],delete e[t]),e)"face"!==n&&"charset"!==n&&(e[n]="padding"===n||"spacing"===n?e[n].split(",").map((function(e){return parseInt(e,10)})):parseInt(e[n],10));return e}},3216:e=>{var t=function(e){return e.replace(/^\s+|\s+$/g,"")};e.exports=function(e){if(!e)return{};for(var n,i={},r=t(e).split("\n"),o=0;o<r.length;o++){var s=r[o],a=s.indexOf(":"),l=t(s.slice(0,a)).toLowerCase(),c=t(s.slice(a+1));void 0===i[l]?i[l]=c:(n=i[l],"[object Array]"===Object.prototype.toString.call(n)?i[l].push(c):i[l]=[i[l],c])}return i}},9035:(e,t,n)=>{var i=n(8480),r=n(8167),o=n(2225),s=[0,2,3],a=[2,1,3];e.exports=function(e,t){e&&(r(e)||o(e))||(t=e||{},e=null);for(var n="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",l="number"==typeof t.count?t.count:1,c=t.start||0,u=!1!==t.clockwise?s:a,h=u[0],d=u[1],p=u[2],f=6*l,m=e||new(i(n))(f),g=0,v=0;g<f;g+=6,v+=4){var y=g+c;m[y+0]=v+0,m[y+1]=v+1,m[y+2]=v+2,m[y+3]=v+h,m[y+4]=v+d,m[y+5]=v+p}return m}},4433:(e,t,n)=>{var i=n(5651),r=n(9035),o=n(7106),s=n(1684);e.exports=function(e){return new a(e)};class a extends THREE.BufferGeometry{constructor(e){super(),"string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}update(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=i(e);var t=!1!==e.flipY,n=e.font,s=n.common.scaleW,a=n.common.scaleH,l=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0}));this.visibleGlyphs=l;var c=o.positions(l),u=o.uvs(l,s,a,t),h=r([],{clockwise:!0,type:"uint16",count:l.length});if(this.setIndex(h),this.setAttribute("position",new THREE.BufferAttribute(c,2)),this.setAttribute("uv",new THREE.BufferAttribute(u,2)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var d=o.pages(l);this.setAttribute("page",new THREE.BufferAttribute(d,1))}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);s.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.boundingBox,t=this.attributes.position.array,n=this.attributes.position.itemSize;!t||!n||t.length<2?e.makeEmpty():s.computeBox(t,e)}}},1684:e=>{var t={min:[0,0],max:[0,0]};function n(e){var n=e.length/2;t.min[0]=e[0],t.min[1]=e[1],t.max[0]=e[0],t.max[1]=e[1];for(var i=0;i<n;i++){var r=e[2*i+0],o=e[2*i+1];t.min[0]=Math.min(r,t.min[0]),t.min[1]=Math.min(o,t.min[1]),t.max[0]=Math.max(r,t.max[0]),t.max[1]=Math.max(o,t.max[1])}}e.exports.computeBox=function(e,i){n(e),i.min.set(t.min[0],t.min[1],0),i.max.set(t.max[0],t.max[1],0)},e.exports.computeSphere=function(e,i){n(e);var r=t.min[0],o=t.min[1],s=t.max[0]-r,a=t.max[1]-o,l=Math.sqrt(s*s+a*a);i.center.set(r+s/2,o+a/2,0),i.radius=l/2}},7106:e=>{e.exports.pages=function(e){var t=new Float32Array(4*e.length*1),n=0;return e.forEach((function(e){var i=e.data.page||0;t[n++]=i,t[n++]=i,t[n++]=i,t[n++]=i})),t},e.exports.uvs=function(e,t,n,i){var r=new Float32Array(4*e.length*2),o=0;return e.forEach((function(e){var s=e.data,a=s.x+s.width,l=s.y+s.height,c=s.x/t,u=s.y/n,h=a/t,d=l/n;i&&(u=(n-s.y)/n,d=(n-l)/n),r[o++]=c,r[o++]=u,r[o++]=c,r[o++]=d,r[o++]=h,r[o++]=d,r[o++]=h,r[o++]=u})),r},e.exports.positions=function(e){var t=new Float32Array(4*e.length*2),n=0;return e.forEach((function(e){var i=e.data,r=e.position[0]+i.xoffset,o=e.position[1]+i.yoffset,s=i.width,a=i.height;t[n++]=r,t[n++]=o,t[n++]=r,t[n++]=o+a,t[n++]=r+s,t[n++]=o+a,t[n++]=r+s,t[n++]=o})),t}},5406:e=>{var t=/\n/,n=/\s/;function i(e,t,n,i){var r=e.indexOf(t,n);return-1===r||r>i?i:r}function r(e){return n.test(e)}function o(e,t,n,i){return{start:t,end:t+Math.min(i,n-t)}}e.exports=function(t,n){return e.exports.lines(t,n).map((function(e){return t.substring(e.start,e.end)})).join("\n")},e.exports.lines=function(e,n){if(0===(n=n||{}).width&&"nowrap"!==n.mode)return[];e=e||"";var s="number"==typeof n.width?n.width:Number.MAX_VALUE,a=Math.max(0,n.start||0),l="number"==typeof n.end?n.end:e.length,c=n.mode,u=n.measure||o;return"pre"===c?function(e,n,i,r,o){for(var s=[],a=i,l=i;l<r&&l<n.length;l++){var c=n.charAt(l),u=t.test(c);if(u||l===r-1){var h=e(n,a,u?l:l+1,o);s.push(h),a=l+1}}return s}(u,e,a,l,s):function(e,t,n,o,s,a){var l=[],c=s;for("nowrap"===a&&(c=Number.MAX_VALUE);n<o&&n<t.length;){for(var u=i(t,"\n",n,o);n<u&&r(t.charAt(n));)n++;var h=e(t,n,u,c),d=n+(h.end-h.start),p=d+1;if(d<u){for(;d>n&&!r(t.charAt(d));)d--;if(d===n)p>n+1&&p--,d=p;else for(p=d;d>n&&r(t.charAt(d-1));)d--}if(d>=n){var f=e(t,n,d,c);l.push(f)}n=p}return l}(u,e,a,l,s,c)}},3558:(e,t,n)=>{var i=n(919),r=n(8847),o=n(3216),s=n(4597);function a(e,t,n){var i=e;return r(t)?(n=t,"string"==typeof e&&(i={uri:e})):i=s(t,{uri:e}),i.callback=n,i}function l(e,t,n){return c(t=a(e,t,n))}function c(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,n=function(n,i,r){t||(t=!0,e.callback(n,i,r))};function i(){var e=void 0;if(e=u.response?u.response:u.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(u),v)try{e=JSON.parse(e)}catch(e){}return e}function r(e){return clearTimeout(h),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,n(e,y)}function s(){if(!c){var t;clearTimeout(h),t=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var r=y,s=null;return 0!==t?(r={body:i(),statusCode:t,method:p,headers:{},url:d,rawRequest:u},u.getAllResponseHeaders&&(r.headers=o(u.getAllResponseHeaders()))):s=new Error("Internal XMLHttpRequest Error"),n(s,r,r.body)}}var a,c,u=e.xhr||null;u||(u=e.cors||e.useXDR?new l.XDomainRequest:new l.XMLHttpRequest);var h,d=u.url=e.uri||e.url,p=u.method=e.method||"GET",f=e.body||e.data,m=u.headers=e.headers||{},g=!!e.sync,v=!1,y={body:void 0,headers:{},statusCode:0,method:p,url:d,rawRequest:u};if("json"in e&&!1!==e.json&&(v=!0,m.accept||m.Accept||(m.Accept="application/json"),"GET"!==p&&"HEAD"!==p&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),u.onreadystatechange=function(){4===u.readyState&&setTimeout(s,0)},u.onload=s,u.onerror=r,u.onprogress=function(){},u.onabort=function(){c=!0},u.ontimeout=r,u.open(p,d,!g,e.username,e.password),g||(u.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(h=setTimeout((function(){if(!c){c=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",r(e)}}),e.timeout)),u.setRequestHeader)for(a in m)m.hasOwnProperty(a)&&u.setRequestHeader(a,m[a]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(f||null),u}e.exports=l,e.exports.default=l,l.XMLHttpRequest=i.XMLHttpRequest||function(){},l.XDomainRequest="withCredentials"in new l.XMLHttpRequest?l.XMLHttpRequest:i.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],(function(e){l["delete"===e?"del":e]=function(t,n,i){return(n=a(t,n,i)).method=e.toUpperCase(),c(n)}}))},1896:e=>{e.exports=void 0!==self.DOMParser?function(e){return(new self.DOMParser).parseFromString(e,"application/xml")}:void 0!==self.ActiveXObject&&new self.ActiveXObject("Microsoft.XMLDOM")?function(e){var t=new self.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}:function(e){var t=document.createElement("div");return t.innerHTML=e,t}},4597:e=>{e.exports=function(){for(var e={},n=0;n<arguments.length;n++){var i=arguments[n];for(var r in i)t.call(i,r)&&(e[r]=i[r])}return e};var t=Object.prototype.hasOwnProperty},8132:()=>{window.aframeStats=function(e){var t=null,n=e;return{update:function(){var e;t("te").set((e=n.querySelectorAll("*"),Array.prototype.slice.call(e).filter((function(e){return e.isEntity})),e.length)),window.performance.getEntriesByName&&t("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function(){},end:function(){},attach:function(e){t=e},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}}},3729:e=>{window.glStats=function(){var e=null,t=0,n=0,i=0,r=0,o=0,s=0,a=0;function l(e,t){return function(){t.apply(this,arguments),e.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=l(WebGLRenderingContext.prototype.drawArrays,(function(){t++,arguments[0]==this.POINTS?s+=arguments[2]:o+=arguments[2]})),WebGLRenderingContext.prototype.drawElements=l(WebGLRenderingContext.prototype.drawElements,(function(){n++,r+=arguments[1]/3,o+=arguments[1]})),WebGLRenderingContext.prototype.useProgram=l(WebGLRenderingContext.prototype.useProgram,(function(){i++})),WebGLRenderingContext.prototype.bindTexture=l(WebGLRenderingContext.prototype.bindTexture,(function(){a++})),{update:function(){e("allcalls").set(t+n),e("drawElements").set(n),e("drawArrays").set(t),e("bindTexture").set(a),e("useProgram").set(i),e("glfaces").set(r),e("glvertices").set(o),e("glpoints").set(s)},start:function(){t=0,n=0,i=0,r=0,o=0,s=0,a=0},end:function(){},attach:function(t){e=t},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(e){var t=null;return{update:function(){t("renderer.info.memory.geometries").set(e.info.memory.geometries),t("renderer.info.programs").set(e.info.programs?.length??NaN),t("renderer.info.memory.textures").set(e.info.memory.textures),t("renderer.info.render.calls").set(e.info.render.calls),t("renderer.info.render.triangles").set(e.info.render.triangles),t("renderer.info.render.points").set(e.info.render.points)},start:function(){},end:function(){},attach:function(e){t=e},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var e=null,t=0,n=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),0===performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var i=Math.log(1024);function r(e){var t=Math.floor(Math.log(e)/i);return Math.round(100*e/Math.pow(1024,t))/100}return{update:function(){t=r(performance.memory.usedJSHeapSize),n=r(performance.memory.totalJSHeapSize),e("memory").set(t),e("total").set(n)},start:function(){t=0},end:function(){},attach:function(t){e=t},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},e.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},282:e=>{!function(){"performance"in window==0&&(window.performance={});var e=window.performance;if("now"in e==0){var t=Date.now();e.timing&&e.timing.navigationStart&&(t=e.timing.navigationStart),e.now=function(){return Date.now()-t}}e.mark||(e.mark=function(){}),e.measure||(e.measure=function(){})}(),window.rStats=function(e){function t(e,t){for(var n=Object.keys(e),i=0,r=n.length;i<r;i++)t(n[i])}var n=e||{},i=n.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],r=(n.CSSPath?n.CSSPath:"")+"rStats.css";(n.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",r]).forEach((function(e){var t,n;t=e,(n=document.createElement("link")).href=t,n.rel="stylesheet",n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n)})),n.values||(n.values={});var o,s,a=10,l={};function c(e,t,n){var i=n||{},r=document.createElement("canvas"),o=r.getContext("2d"),s=0,l=0,c=i.color?i.color:"#666666",u=document.createElement("canvas"),h=u.getContext("2d");u.width=1,u.height=20,h.fillStyle="#444444",h.fillRect(0,0,1,20),h.fillStyle=c,h.fillRect(0,a,1,a),h.fillStyle="#ffffff",h.globalAlpha=.5,h.fillRect(0,a,1,1),h.globalAlpha=1;var d=document.createElement("canvas"),p=d.getContext("2d");return d.width=1,d.height=20,p.fillStyle="#444444",p.fillRect(0,0,1,20),p.fillStyle="#b70000",p.fillRect(0,a,1,a),p.globalAlpha=.5,p.fillStyle="#ffffff",p.fillRect(0,a,1,1),p.globalAlpha=1,r.width=200,r.height=a,r.style.width=r.width+"px",r.style.height=r.height+"px",r.className="rs-canvas",e.appendChild(r),o.fillStyle="#444444",o.fillRect(0,0,r.width,r.height),{draw:function(e,t){(l+=.1*(e-l))>(s*=.99)&&(s=l),o.drawImage(r,1,0,r.width-1,r.height,0,0,r.width-1,r.height),t?o.drawImage(d,r.width-1,r.height-l*r.height/s-a):o.drawImage(u,r.width-1,r.height-l*r.height/s-a)}}}function u(e,n){var r=document.createElement("canvas"),o=r.getContext("2d");return r.width=200,r.height=a*n,r.style.width=r.width+"px",r.style.height=r.height+"px",r.className="rs-canvas",e.appendChild(r),o.fillStyle="#444444",o.fillRect(0,0,r.width,r.height),{draw:function(e){o.drawImage(r,1,0,r.width-1,r.height,0,0,r.width-1,r.height);var n=0;t(e,(function(t){var s=e[t]*r.height;o.fillStyle=i[t],o.fillRect(r.width-1,n,1,s),n+=s}))}}}function h(e,t){var i,r=e,o=0,a=0,l=0,u=0,h=performance.now(),d=0,p=document.createElement("div"),f=document.createElement("span"),m=document.createElement("div"),g=document.createTextNode(""),v=n?n.values[r.toLowerCase()]:null,y=new c(p,r,v),A=!1;function x(e){if(v&&v.average){u+=e,d++;var t=performance.now();t-h>=(v.avgMs||1e3)&&(l=u/d,u=0,h=t,d=0)}}function b(){i=performance.now(),n.userTimingAPI&&performance.mark(r+"-start"),A=!0}function _(){o=performance.now()-i,n.userTimingAPI&&(performance.mark(r+"-end"),A&&performance.measure(r,r+"-start",r+"-end")),x(o)}return f.className="rs-counter-id",f.textContent=v&&v.caption?v.caption:r,m.className="rs-counter-value",m.appendChild(g),p.appendChild(f),p.appendChild(m),t?t.div.appendChild(p):s.appendChild(p),i=performance.now(),{set:function(e){x(o=e)},start:b,tick:function(){_(),b()},end:_,frame:function(){var e=performance.now(),t=e-i;a++,t>1e3&&(o=v&&!1===v.interpolate?a:1e3*a/t,a=0,i=e,x(o))},value:function(){return o},draw:function(){var e=v&&v.average?l:o;g.nodeValue=Math.round(100*e)/100;var t=v&&(v.below&&o<v.below||v.over&&o>v.over);y.draw(o,t),p.className=t?"rs-counter-base alarm":"rs-counter-base"}}}function d(e){var i=e.toLowerCase();if(void 0===i&&(i="default"),l[i])return l[i];var r=null;n&&n.groups&&t(n.groups,(function(e){var t=n.groups[parseInt(e,10)];r||-1===t.values.indexOf(i.toLowerCase())||(r=t)}));var o=new h(i,r);return l[i]=o,o}function p(){t(n.plugins,(function(e){n.plugins[e].update()})),t(l,(function(e){l[e].draw()})),n&&n.fractions&&t(n.fractions,(function(e){var i=n.fractions[parseInt(e,10)],r=[],o=l[i.base.toLowerCase()];o&&(o=o.value(),t(n.fractions[e].steps,(function(t){var i=n.fractions[e].steps[parseInt(t,10)].toLowerCase(),s=l[i];s&&r.push(s.value()/o)}))),i.graph.draw(r)}))}return function(){if(n.plugins){n.values||(n.values={}),n.groups||(n.groups=[]),n.fractions||(n.fractions=[]);for(var e=0;e<n.plugins.length;e++)n.plugins[e].attach(d),t(n.plugins[e].values,(function(t){n.values[t]=n.plugins[e].values[t]})),n.groups=n.groups.concat(n.plugins[e].groups),n.fractions=n.fractions.concat(n.plugins[e].fractions)}else n.plugins={};(o=document.createElement("div")).className="rs-base",(s=document.createElement("div")).className="rs-container",s.style.height="auto",o.appendChild(s),document.body.appendChild(o),n&&(n.groups&&t(n.groups,(function(e){var t=n.groups[parseInt(e,10)],i=document.createElement("div");i.className="rs-group",t.div=i;var r=document.createElement("h1");r.textContent=t.caption,r.addEventListener("click",function(e){this.classList.toggle("hidden"),e.preventDefault()}.bind(i)),s.appendChild(r),s.appendChild(i)})),n.fractions&&t(n.fractions,(function(e){var r=n.fractions[parseInt(e,10)],o=document.createElement("div");o.className="rs-fraction";var l=document.createElement("div");l.className="rs-legend";var c=0;t(n.fractions[e].steps,(function(t){var r=document.createElement("p");r.textContent=n.fractions[e].steps[t],r.style.color=i[c],l.appendChild(r),c++})),o.appendChild(l),o.style.height=c*a+"px",r.div=o;var h=new u(o,c);r.graph=h,s.appendChild(o)})))}(),function(e){return e?d(e):{element:o,update:p}}},e.exports=window.rStats},2535:e=>{var t={base64:function(e,t){return"data:"+e+";base64,"+t},isMobile:function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch(e){return!0}},appendQueryParameter:function(e,t,n){var i=e.indexOf("?")<0?"?":"&";return e+(i+t+"=")+n},getQueryParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},isLandscapeMode:function(){return 90==window.orientation||-90==window.orientation}};e.exports=t},5928:(e,t,n)=>{var i,r=n(2535);e.exports=(i=navigator.userAgent||navigator.vendor||window.opera).match(/iPhone/i)||i.match(/iPod/i)?function(){var e=null;this.request=function(){e||(e=setInterval((function(){window.location.href="/",setTimeout(window.stop,0)}),15e3))},this.release=function(){e&&(clearInterval(e),e=null)}}:function(){var e=document.createElement("video");e.addEventListener("ended",(function(){e.play()})),this.request=function(){e.paused&&(e.src=r.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),e.play())},this.release=function(){e.pause(),e.src=""}}},8217:(e,t,n)=>{n.d(t,{A:()=>x});var i=n(963),r=n.n(i),o=n(9089),s=n.n(o),a=n(6492),l=n.n(a),c=new URL(n(9169),n.b),u=new URL(n(6085),n.b),h=new URL(n(3931),n.b),d=new URL(n(7889),n.b),p=new URL(n(6517),n.b),f=s()(r()),m=l()(c),g=l()(u),v=l()(h),y=l()(d),A=l()(p);f.push([e.id,`/* .a-fullscreen means not embedded. */\nhtml.a-fullscreen {\n  bottom: 0;\n  left: 0;\n  position: fixed;\n  right: 0;\n  top: 0;\n}\n\nhtml.a-fullscreen body {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n  padding: 0;\n  width: 100%;\n}\n\n/* Class is removed when doing <a-scene embedded>. */\nhtml.a-fullscreen .a-canvas {\n  width: 100% !important;\n  height: 100% !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  bottom: 0 !important;\n  position: fixed !important;\n}\n\nhtml:not(.a-fullscreen) .a-enter-vr,\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 5px;\n  bottom: 5px;\n}\n\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 60px;\n}\n\n/* In chrome mobile the user agent stylesheet set it to white  */\n:-webkit-full-screen {\n  background-color: transparent;\n}\n\n.a-hidden {\n  display: none !important;\n}\n\n.a-canvas {\n  height: 100%;\n  left: 0;\n  position: absolute;\n  top: 0;\n  width: 100%;\n}\n\n.a-canvas.a-grab-cursor:hover {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\ncanvas.a-canvas.a-mouse-cursor-hover:hover {\n  cursor: pointer;\n}\n\n.a-inspector-loader {\n  background-color: #ed3160;\n  position: fixed;\n  left: 3px;\n  top: 3px;\n  padding: 6px 10px;\n  color: #fff;\n  text-decoration: none;\n  font-size: 12px;\n  font-family: Roboto,sans-serif;\n  text-align: center;\n  z-index: 99999;\n  width: 204px;\n}\n\n/* Inspector loader animation */\n@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n\n.a-inspector-loader .dots span {\n  animation: dots-1 2s infinite steps(1);\n  -webkit-animation: dots-1 2s infinite steps(1);\n}\n\n.a-inspector-loader .dots span:first-child + span {\n  animation-name: dots-2;\n  -webkit-animation-name: dots-2;\n}\n\n.a-inspector-loader .dots span:first-child + span + span {\n  animation-name: dots-3;\n  -webkit-animation-name: dots-3;\n}\n\na-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\na-assets,\na-scene video,\na-scene img,\na-scene audio {\n  display: none;\n}\n\n.a-enter-vr-modal,\n.a-orientation-modal {\n  font-family: Consolas, Andale Mono, Courier New, monospace;\n}\n\n.a-enter-vr-modal a {\n  border-bottom: 1px solid #fff;\n  padding: 2px 0;\n  text-decoration: none;\n  transition: .1s color ease-in;\n}\n\n.a-enter-vr-modal a:hover {\n  background-color: #fff;\n  color: #111;\n  padding: 2px 4px;\n  position: relative;\n  left: -4px;\n}\n\n.a-enter-vr,\n.a-enter-ar {\n  font-family: sans-serif, monospace;\n  font-size: 13px;\n  width: 100%;\n  font-weight: 200;\n  line-height: 16px;\n  position: absolute;\n  right: 20px;\n  bottom: 20px;\n}\n\n.a-enter-ar.xr {\n  right: 90px;\n}\n\n.a-enter-vr-button,\n.a-enter-vr-modal,\n.a-enter-vr-modal a {\n  color: #fff;\n  user-select: none;\n  outline: none;\n}\n\n.a-enter-vr-button {\n  background: rgba(0, 0, 0, 0.35) url(${m}) 50% 50% no-repeat;\n}\n\n.a-enter-ar-button {\n  background: rgba(0, 0, 0, 0.20) url(${g}) 50% 50% no-repeat;\n}\n\n.a-enter-vr.fullscreen .a-enter-vr-button {\n  background-image: url(${v});\n}\n\n.a-enter-vr-button,\n.a-enter-ar-button {\n  background-size: 90% 90%;\n  border: 0;\n  bottom: 0;\n  cursor: pointer;\n  min-width: 58px;\n  min-height: 34px;\n  /* 1.74418604651 */\n  /*\n    In order to keep the aspect ratio when resizing\n    padding-top percentages are relative to the containing block's width.\n    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio\n  */\n  padding-right: 0;\n  padding-top: 0;\n  position: absolute;\n  right: 0;\n  transition: background-color .05s ease;\n  -webkit-transition: background-color .05s ease;\n  z-index: 9999;\n  border-radius: 8px;\n  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */\n}\n\n.a-enter-ar-button {\n  background-size: 100% 90%;\n  border-radius: 7px;\n}\n\n.a-enter-ar-button:active,\n.a-enter-ar-button:hover,\n.a-enter-vr-button:active,\n.a-enter-vr-button:hover {\n  background-color: #ef2d5e;\n}\n\n.a-enter-vr-button.resethover {\n  background-color: rgba(0, 0, 0, 0.35);\n}\n\n.a-enter-vr-modal {\n  background-color: #666;\n  border-radius: 0;\n  display: none;\n  min-height: 32px;\n  margin-right: 70px;\n  padding: 9px;\n  width: 280px;\n  right: 2%;\n  position: absolute;\n}\n\n.a-enter-vr-modal:after {\n  border-bottom: 10px solid transparent;\n  border-left: 10px solid #666;\n  border-top: 10px solid transparent;\n  display: inline-block;\n  content: '';\n  position: absolute;\n  right: -5px;\n  top: 5px;\n  width: 0;\n  height: 0;\n}\n\n.a-enter-vr-modal p,\n.a-enter-vr-modal a {\n  display: inline;\n}\n\n.a-enter-vr-modal p {\n  margin: 0;\n}\n\n.a-enter-vr-modal p:after {\n  content: ' ';\n}\n\n.a-orientation-modal {\n  background: rgba(244, 244, 244, 1) url(${y}) center no-repeat;\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-orientation-modal:after {\n  color: #666;\n  content: "Insert phone into Cardboard holder.";\n  display: block;\n  position: absolute;\n  text-align: center;\n  top: 70%;\n  transform: translateY(-70%);\n  width: 100%;\n}\n\n.a-orientation-modal button {\n  background: url(${A}) no-repeat;\n  border: none;\n  height: 50px;\n  text-indent: -9999px;\n  width: 50px;\n}\n\n.a-loader-title {\n  background-color: rgba(0, 0, 0, 0.6);\n  font-family: sans-serif, monospace;\n  text-align: center;\n  font-size: 20px;\n  height: 50px;\n  font-weight: 300;\n  line-height: 50px;\n  position: absolute;\n  right: 0px;\n  left: 0px;\n  top: 0px;\n  color: white;\n}\n\n.a-modal {\n  position: absolute;\n  background: rgba(0, 0, 0, 0.60);\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-dialog {\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 199995;\n  width: 300px;\n  height: 200px;\n  background-size: contain;\n  background-color: white;\n  font-family: sans-serif, monospace;\n  font-size: 20px;\n  border-radius: 3px;\n  padding: 6px;\n}\n\n.a-dialog-text-container {\n  width: 100%;\n  height: 70%;\n  align-self: flex-start;\n  display: flex;\n  justify-content: center;\n  align-content: center;\n  flex-direction: column;\n}\n\n.a-dialog-text {\n  display: inline-block;\n  font-weight: normal;\n  font-size: 14pt;\n  margin: 8px;\n}\n\n.a-dialog-buttons-container {\n  display: inline-flex;\n  align-self: flex-end;\n  width: 100%;\n  height: 30%;\n}\n\n.a-dialog-button {\n  cursor: pointer;\n  align-self: center;\n  opacity: 0.9;\n  height: 80%;\n  width: 50%;\n  font-size: 12pt;\n  margin: 4px;\n  border-radius: 2px;\n  text-align:center;\n  border: none;\n  display: inline-block;\n  -webkit-transition: all 0.25s ease-in-out;\n  transition: all 0.25s ease-in-out;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);\n  user-select: none;\n}\n\n.a-dialog-permission-button:hover {\n  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);\n}\n\n.a-dialog-allow-button {\n  background-color: #00ceff;\n}\n\n.a-dialog-deny-button {\n  background-color: #ff005b;\n}\n\n.a-dialog-ok-button {\n  background-color: #00ceff;\n  width: 100%;\n}\n\n.a-dom-overlay:not(.a-no-style) {\n  overflow: hidden;\n  position: absolute;\n  pointer-events: none;\n  box-sizing: border-box;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  top: 0;\n  padding: 1em;\n}\n\n.a-dom-overlay:not(.a-no-style)>* {\n  pointer-events: auto;\n}\n`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:["/* .a-fullscreen means not embedded. */\nhtml.a-fullscreen {\n  bottom: 0;\n  left: 0;\n  position: fixed;\n  right: 0;\n  top: 0;\n}\n\nhtml.a-fullscreen body {\n  height: 100%;\n  margin: 0;\n  overflow: hidden;\n  padding: 0;\n  width: 100%;\n}\n\n/* Class is removed when doing <a-scene embedded>. */\nhtml.a-fullscreen .a-canvas {\n  width: 100% !important;\n  height: 100% !important;\n  top: 0 !important;\n  left: 0 !important;\n  right: 0 !important;\n  bottom: 0 !important;\n  position: fixed !important;\n}\n\nhtml:not(.a-fullscreen) .a-enter-vr,\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 5px;\n  bottom: 5px;\n}\n\nhtml:not(.a-fullscreen) .a-enter-ar {\n  right: 60px;\n}\n\n/* In chrome mobile the user agent stylesheet set it to white  */\n:-webkit-full-screen {\n  background-color: transparent;\n}\n\n.a-hidden {\n  display: none !important;\n}\n\n.a-canvas {\n  height: 100%;\n  left: 0;\n  position: absolute;\n  top: 0;\n  width: 100%;\n}\n\n.a-canvas.a-grab-cursor:hover {\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\ncanvas.a-canvas.a-mouse-cursor-hover:hover {\n  cursor: pointer;\n}\n\n.a-inspector-loader {\n  background-color: #ed3160;\n  position: fixed;\n  left: 3px;\n  top: 3px;\n  padding: 6px 10px;\n  color: #fff;\n  text-decoration: none;\n  font-size: 12px;\n  font-family: Roboto,sans-serif;\n  text-align: center;\n  z-index: 99999;\n  width: 204px;\n}\n\n/* Inspector loader animation */\n@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }\n@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }\n@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }\n\n.a-inspector-loader .dots span {\n  animation: dots-1 2s infinite steps(1);\n  -webkit-animation: dots-1 2s infinite steps(1);\n}\n\n.a-inspector-loader .dots span:first-child + span {\n  animation-name: dots-2;\n  -webkit-animation-name: dots-2;\n}\n\n.a-inspector-loader .dots span:first-child + span + span {\n  animation-name: dots-3;\n  -webkit-animation-name: dots-3;\n}\n\na-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\na-assets,\na-scene video,\na-scene img,\na-scene audio {\n  display: none;\n}\n\n.a-enter-vr-modal,\n.a-orientation-modal {\n  font-family: Consolas, Andale Mono, Courier New, monospace;\n}\n\n.a-enter-vr-modal a {\n  border-bottom: 1px solid #fff;\n  padding: 2px 0;\n  text-decoration: none;\n  transition: .1s color ease-in;\n}\n\n.a-enter-vr-modal a:hover {\n  background-color: #fff;\n  color: #111;\n  padding: 2px 4px;\n  position: relative;\n  left: -4px;\n}\n\n.a-enter-vr,\n.a-enter-ar {\n  font-family: sans-serif, monospace;\n  font-size: 13px;\n  width: 100%;\n  font-weight: 200;\n  line-height: 16px;\n  position: absolute;\n  right: 20px;\n  bottom: 20px;\n}\n\n.a-enter-ar.xr {\n  right: 90px;\n}\n\n.a-enter-vr-button,\n.a-enter-vr-modal,\n.a-enter-vr-modal a {\n  color: #fff;\n  user-select: none;\n  outline: none;\n}\n\n.a-enter-vr-button {\n  background: rgba(0, 0, 0, 0.35) url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat;\n}\n\n.a-enter-ar-button {\n  background: rgba(0, 0, 0, 0.20) url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E\") 50% 50% no-repeat;\n}\n\n.a-enter-vr.fullscreen .a-enter-vr-button {\n  background-image: url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E\");\n}\n\n.a-enter-vr-button,\n.a-enter-ar-button {\n  background-size: 90% 90%;\n  border: 0;\n  bottom: 0;\n  cursor: pointer;\n  min-width: 58px;\n  min-height: 34px;\n  /* 1.74418604651 */\n  /*\n    In order to keep the aspect ratio when resizing\n    padding-top percentages are relative to the containing block's width.\n    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio\n  */\n  padding-right: 0;\n  padding-top: 0;\n  position: absolute;\n  right: 0;\n  transition: background-color .05s ease;\n  -webkit-transition: background-color .05s ease;\n  z-index: 9999;\n  border-radius: 8px;\n  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */\n}\n\n.a-enter-ar-button {\n  background-size: 100% 90%;\n  border-radius: 7px;\n}\n\n.a-enter-ar-button:active,\n.a-enter-ar-button:hover,\n.a-enter-vr-button:active,\n.a-enter-vr-button:hover {\n  background-color: #ef2d5e;\n}\n\n.a-enter-vr-button.resethover {\n  background-color: rgba(0, 0, 0, 0.35);\n}\n\n.a-enter-vr-modal {\n  background-color: #666;\n  border-radius: 0;\n  display: none;\n  min-height: 32px;\n  margin-right: 70px;\n  padding: 9px;\n  width: 280px;\n  right: 2%;\n  position: absolute;\n}\n\n.a-enter-vr-modal:after {\n  border-bottom: 10px solid transparent;\n  border-left: 10px solid #666;\n  border-top: 10px solid transparent;\n  display: inline-block;\n  content: '';\n  position: absolute;\n  right: -5px;\n  top: 5px;\n  width: 0;\n  height: 0;\n}\n\n.a-enter-vr-modal p,\n.a-enter-vr-modal a {\n  display: inline;\n}\n\n.a-enter-vr-modal p {\n  margin: 0;\n}\n\n.a-enter-vr-modal p:after {\n  content: ' ';\n}\n\n.a-orientation-modal {\n  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-orientation-modal:after {\n  color: #666;\n  content: \"Insert phone into Cardboard holder.\";\n  display: block;\n  position: absolute;\n  text-align: center;\n  top: 70%;\n  transform: translateY(-70%);\n  width: 100%;\n}\n\n.a-orientation-modal button {\n  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;\n  border: none;\n  height: 50px;\n  text-indent: -9999px;\n  width: 50px;\n}\n\n.a-loader-title {\n  background-color: rgba(0, 0, 0, 0.6);\n  font-family: sans-serif, monospace;\n  text-align: center;\n  font-size: 20px;\n  height: 50px;\n  font-weight: 300;\n  line-height: 50px;\n  position: absolute;\n  right: 0px;\n  left: 0px;\n  top: 0px;\n  color: white;\n}\n\n.a-modal {\n  position: absolute;\n  background: rgba(0, 0, 0, 0.60);\n  background-size: 50% 50%;\n  bottom: 0;\n  font-size: 14px;\n  font-weight: 600;\n  left: 0;\n  line-height: 20px;\n  right: 0;\n  position: fixed;\n  top: 0;\n  z-index: 9999999;\n}\n\n.a-dialog {\n  position: relative;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 199995;\n  width: 300px;\n  height: 200px;\n  background-size: contain;\n  background-color: white;\n  font-family: sans-serif, monospace;\n  font-size: 20px;\n  border-radius: 3px;\n  padding: 6px;\n}\n\n.a-dialog-text-container {\n  width: 100%;\n  height: 70%;\n  align-self: flex-start;\n  display: flex;\n  justify-content: center;\n  align-content: center;\n  flex-direction: column;\n}\n\n.a-dialog-text {\n  display: inline-block;\n  font-weight: normal;\n  font-size: 14pt;\n  margin: 8px;\n}\n\n.a-dialog-buttons-container {\n  display: inline-flex;\n  align-self: flex-end;\n  width: 100%;\n  height: 30%;\n}\n\n.a-dialog-button {\n  cursor: pointer;\n  align-self: center;\n  opacity: 0.9;\n  height: 80%;\n  width: 50%;\n  font-size: 12pt;\n  margin: 4px;\n  border-radius: 2px;\n  text-align:center;\n  border: none;\n  display: inline-block;\n  -webkit-transition: all 0.25s ease-in-out;\n  transition: all 0.25s ease-in-out;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);\n  user-select: none;\n}\n\n.a-dialog-permission-button:hover {\n  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);\n}\n\n.a-dialog-allow-button {\n  background-color: #00ceff;\n}\n\n.a-dialog-deny-button {\n  background-color: #ff005b;\n}\n\n.a-dialog-ok-button {\n  background-color: #00ceff;\n  width: 100%;\n}\n\n.a-dom-overlay:not(.a-no-style) {\n  overflow: hidden;\n  position: absolute;\n  pointer-events: none;\n  box-sizing: border-box;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  top: 0;\n  padding: 1em;\n}\n\n.a-dom-overlay:not(.a-no-style)>* {\n  pointer-events: auto;\n}\n"],sourceRoot:""}]);const x=f},2470:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(963),r=n.n(i),o=n(9089),s=n.n(o)()(r());s.push([e.id,".rs-base {\n  background-color: #333;\n  color: #fafafa;\n  border-radius: 0;\n  font: 10px monospace;\n  left: 5px;\n  line-height: 1em;\n  opacity: 0.85;\n  overflow: hidden;\n  padding: 10px;\n  position: fixed;\n  top: 5px;\n  width: 300px;\n  z-index: 10000;\n}\n\n.rs-base div.hidden {\n  display: none;\n}\n\n.rs-base h1 {\n  color: #fff;\n  cursor: pointer;\n  font-size: 1.4em;\n  font-weight: 300;\n  margin: 0 0 5px;\n  padding: 0;\n}\n\n.rs-group {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n  margin-bottom: 5px;\n}\n\n.rs-group:last-child {\n  margin-bottom: 0;\n}\n\n.rs-counter-base {\n  align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  height: 10px;\n  -webkit-justify-content: space-between;\n  justify-content: space-between;\n  margin: 2px 0;\n}\n\n.rs-counter-base.alarm {\n  color: #b70000;\n  text-shadow: 0 0 0 #b70000,\n               0 0 1px #fff,\n               0 0 1px #fff,\n               0 0 2px #fff,\n               0 0 2px #fff,\n               0 0 3px #fff,\n               0 0 3px #fff,\n               0 0 4px #fff,\n               0 0 4px #fff;\n}\n\n.rs-counter-id {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 0;\n  -webkit-order: 0;\n  order: 0;\n  width: 54px;\n}\n\n.rs-counter-value {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 1;\n  -webkit-order: 1;\n  order: 1;\n  text-align: right;\n  width: 35px;\n}\n\n.rs-canvas {\n  -webkit-box-ordinal-group: 2;\n  -webkit-order: 2;\n  order: 2;\n}\n\n@media (min-width: 480px) {\n  .rs-base {\n    left: 20px;\n    top: 20px;\n  }\n}\n","",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[".rs-base {\n  background-color: #333;\n  color: #fafafa;\n  border-radius: 0;\n  font: 10px monospace;\n  left: 5px;\n  line-height: 1em;\n  opacity: 0.85;\n  overflow: hidden;\n  padding: 10px;\n  position: fixed;\n  top: 5px;\n  width: 300px;\n  z-index: 10000;\n}\n\n.rs-base div.hidden {\n  display: none;\n}\n\n.rs-base h1 {\n  color: #fff;\n  cursor: pointer;\n  font-size: 1.4em;\n  font-weight: 300;\n  margin: 0 0 5px;\n  padding: 0;\n}\n\n.rs-group {\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n  margin-bottom: 5px;\n}\n\n.rs-group:last-child {\n  margin-bottom: 0;\n}\n\n.rs-counter-base {\n  align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  height: 10px;\n  -webkit-justify-content: space-between;\n  justify-content: space-between;\n  margin: 2px 0;\n}\n\n.rs-counter-base.alarm {\n  color: #b70000;\n  text-shadow: 0 0 0 #b70000,\n               0 0 1px #fff,\n               0 0 1px #fff,\n               0 0 2px #fff,\n               0 0 2px #fff,\n               0 0 3px #fff,\n               0 0 3px #fff,\n               0 0 4px #fff,\n               0 0 4px #fff;\n}\n\n.rs-counter-id {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 0;\n  -webkit-order: 0;\n  order: 0;\n  width: 54px;\n}\n\n.rs-counter-value {\n  font-weight: 300;\n  -webkit-box-ordinal-group: 1;\n  -webkit-order: 1;\n  order: 1;\n  text-align: right;\n  width: 35px;\n}\n\n.rs-canvas {\n  -webkit-box-ordinal-group: 2;\n  -webkit-order: 2;\n  order: 2;\n}\n\n@media (min-width: 480px) {\n  .rs-base {\n    left: 20px;\n    top: 20px;\n  }\n}\n"],sourceRoot:""}]);const a=s},7180:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var i=n(5072),r=n.n(i),o=n(7825),s=n.n(o),a=n(7659),l=n.n(a),c=n(5056),u=n.n(c),h=n(540),d=n.n(h),p=n(1113),f=n.n(p),m=n(8217),g={};g.styleTagTransform=f(),g.setAttributes=u(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=d(),r()(m.A,g);const v=m.A&&m.A.locals?m.A.locals:void 0},9379:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var i=n(5072),r=n.n(i),o=n(7825),s=n.n(o),a=n(7659),l=n.n(a),c=n(5056),u=n.n(c),h=n(540),d=n.n(h),p=n(1113),f=n.n(p),m=n(2470),g={};g.styleTagTransform=f(),g.setAttributes=u(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=d(),r()(m.A,g);const v=m.A&&m.A.locals?m.A.locals:void 0},5072:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},s=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=o[c]||0,h="".concat(c," ").concat(u);o[c]=u+1;var d=n(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}s.push(h)}return s}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=n(o[s]);t[a].references--}for(var l=i(e,r),c=0;c<o.length;c++){var u=n(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=l}}},7659:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},3931:e=>{e.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},6085:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},9169:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},6517:e=>{e.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},7889:e=>{e.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"}},DV={};function kV(e){var t=DV[e];if(void 0!==t)return t.exports;var n=DV[e]={id:e,exports:{}};return NV[e](n,n.exports,kV),n.exports}kV.m=NV,kV.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return kV.d(t,{a:t}),t},kV.d=(e,t)=>{for(var n in t)kV.o(t,n)&&!kV.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},kV.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(Jbe){if("object"==typeof window)return window}}(),kV.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),kV.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},kV.b=document.baseURI||self.location.href,kV.nc=void 0;var OV={};kV.d(OV,{A:()=>A0});var UV={};kV.r(UV),kV.d(UV,{computeMikkTSpaceTangents:()=>gH,computeMorphedAttributes:()=>CH,deepCloneAttribute:()=>AH,deinterleaveAttribute:()=>bH,deinterleaveGeometry:()=>_H,estimateBytesUsed:()=>wH,interleaveAttributes:()=>xH,mergeAttributes:()=>yH,mergeGeometries:()=>vH,mergeGroups:()=>MH,mergeVertices:()=>EH,toCreasedNormals:()=>TH,toTrianglesDrawMode:()=>SH});var FV={};kV.r(FV),kV.d(FV,{checkARSupport:()=>iq,checkHeadsetConnected:()=>nq,checkVRSupport:()=>rq,isAppleVisionPro:()=>uq,isBrowserEnvironment:()=>yq,isFirefoxReality:()=>fq,isIOS:()=>hq,isIpad:()=>cq,isLandscape:()=>vq,isMobile:()=>aq,isMobileDeviceRequestingDesktopSite:()=>dq,isMobileVR:()=>mq,isNodeEnvironment:()=>Aq,isOculusBrowser:()=>pq,isR7:()=>gq,isTablet:()=>lq,isWebXRAvailable:()=>ZQ});var zV={};kV.r(zV),kV.d(zV,{clearObject:()=>wq,createPool:()=>_q,removeUnusedKeys:()=>Eq});var jV={};kV.r(jV),kV.d(jV,{equals:()=>Pq,isCoordinate:()=>Lq,isCoordinates:()=>Bq,parse:()=>Rq,regex:()=>Mq,stringify:()=>Iq,toVector3:()=>Dq});var VV={};kV.r(VV),kV.d(VV,{getComponentProperty:()=>Uq,getComponentPropertyPath:()=>Oq,setComponentProperty:()=>Fq});var GV={};kV.r(GV),kV.d(GV,{parseUrl:()=>Wq,validateCubemapSrc:()=>Hq,validateEnvMapSrc:()=>Gq,validateSrc:()=>Vq});var HV={};kV.r(HV),kV.d(HV,{createCompatibleTexture:()=>iX,handleTextureEvents:()=>tX,isCompatibleTexture:()=>nX,setTextureProperties:()=>$q,updateDistortionMap:()=>Jq,updateEnvMap:()=>eX,updateMap:()=>Kq,updateMapMaterialFromData:()=>Yq});var WV={};kV.r(WV),kV.d(WV,{parse:()=>oX,stringify:()=>sX,toCamelCase:()=>aX});var QV={};kV.r(QV),kV.d(QV,{checkControllerPresentAndSetup:()=>pX,emitIfAxesChanged:()=>gX,findMatchingControllerWebXR:()=>mX,isControllerPresentWebXR:()=>fX,onButtonEvent:()=>vX});var qV={};kV.r(qV),kV.d(qV,{bind:()=>AX,checkHeadsetConnected:()=>xX,clone:()=>RX,coordinates:()=>jV,debounce:()=>CX,debug:()=>qQ,deepEqual:()=>BX,device:()=>FV,diff:()=>LX,entity:()=>VV,extend:()=>MX,extendDeep:()=>TX,findAllScenes:()=>FX,forceCanvasResizeSafariMobile:()=>zq,getElData:()=>kX,getUrlParameter:()=>OX,isIOS:()=>bX,isIframed:()=>UX,isMobile:()=>_X,material:()=>HV,objectPool:()=>zV,shouldCaptureKeyEvent:()=>NX,split:()=>kq,splitString:()=>DX,srcLoader:()=>GV,styleParser:()=>WV,throttle:()=>wX,throttleLeadingAndTrailing:()=>EX,throttleTick:()=>SX,trackedControls:()=>QV});var XV={};kV.r(XV),kV.d(XV,{isSingleProperty:()=>g$,parseProperties:()=>x$,parseProperty:()=>b$,process:()=>v$,processPropertyDefinition:()=>y$,stringifyProperties:()=>_$,stringifyProperty:()=>w$});var $V={};kV.r($V),kV.d($V,{Component:()=>U$,components:()=>E$,registerComponent:()=>z$,registrationOrderWarnings:()=>F$});var YV={};kV.r(YV),kV.d(YV,{System:()=>q$,registerSystem:()=>X$,systems:()=>Q$});var KV={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},JV={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},ZV=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],eG={CSS:{},springs:{}};function tG(e,t,n){return Math.min(Math.max(e,t),n)}function nG(e,t){return e.indexOf(t)>-1}function iG(e,t){return e.apply(null,t)}var rG=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,oG=/^rgb/,sG=/^hsl/,aG={arr:function(e){return Array.isArray(e)},obj:function(e){return nG(Object.prototype.toString.call(e),"Object")},pth:function(e){return aG.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||aG.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},hex:function(e){return rG.test(e)},rgb:function(e){return oG.test(e)},hsl:function(e){return sG.test(e)},col:function(e){return aG.hex(e)||aG.rgb(e)||aG.hsl(e)},key:function(e){return!KV.hasOwnProperty(e)&&!JV.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}},lG=/\(([^)]+)\)/;function cG(e){var t=lG.exec(e);return t?t[1].split(",").map((function(e){return parseFloat(e)})):[]}function uG(e,t){var n=cG(e),i=tG(aG.und(n[0])?1:n[0],.1,100),r=tG(aG.und(n[1])?100:n[1],.1,100),o=tG(aG.und(n[2])?10:n[2],.1,100),s=tG(aG.und(n[3])?0:n[3],.1,100),a=Math.sqrt(r/i),l=o/(2*Math.sqrt(r*i)),c=l<1?a*Math.sqrt(1-l*l):0,u=l<1?(l*a-s)/c:-s+a;function h(e){var n=t?t*e/1e3:e;return n=l<1?Math.exp(-n*l*a)*(1*Math.cos(c*n)+u*Math.sin(c*n)):(1+u*n)*Math.exp(-n*a),0===e||1===e?e:1-n}return t?h:function(){var t=eG.springs[e];if(t)return t;for(var n=1/6,i=0,r=0;;)if(1===h(i+=n)){if(++r>=16)break}else r=0;var o=i*n*1e3;return eG.springs[e]=o,o}}function hG(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var n=tG(e,1,10),i=tG(t,.1,2);return function(e){return 0===e||1===e?e:-n*Math.pow(2,10*(e-1))*Math.sin((e-1-i/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/i)}}function dG(e){return void 0===e&&(e=10),function(t){return Math.round(t*e)*(1/e)}}var pG=function(){var e=.1;function t(e,t){return 1-3*t+3*e}function n(e,t){return 3*t-6*e}function i(e){return 3*e}function r(e,r,o){return((t(r,o)*e+n(r,o))*e+i(r))*e}function o(e,r,o){return 3*t(r,o)*e*e+2*n(r,o)*e+i(r)}return function(t,n,i,s){if(0<=t&&t<=1&&0<=i&&i<=1){var a=new Float32Array(11);if(t!==n||i!==s)for(var l=0;l<11;++l)a[l]=r(l*e,t,i);return function(l){return t===n&&i===s||0===l||1===l?l:r(function(n){for(var s=0,l=1;10!==l&&a[l]<=n;++l)s+=e;--l;var c=s+(n-a[l])/(a[l+1]-a[l])*e,u=o(c,t,i);return u>=.001?function(e,t,n,i){for(var s=0;s<4;++s){var a=o(t,n,i);if(0===a)return t;t-=(r(t,n,i)-e)/a}return t}(n,c,t,i):0===u?c:function(e,t,n,i,o){var s,a,l=0;do{(s=r(a=t+(n-t)/2,i,o)-e)>0?n=a:t=a}while(Math.abs(s)>1e-7&&++l<10);return a}(n,s,s+e,t,i)}(l),n,s)}}}}(),fG=function(){var e=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],t={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],hG],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(e,t){return function(n){return 1-hG(e,t)(1-n)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(e,t){return function(n){return n<.5?hG(e,t)(2*n)/2:1-hG(e,t)(-2*n+2)/2}}]},n={linear:[.25,.25,.75,.75]};for(var i in t)for(var r=0,o=t[i].length;r<o;r++)n["ease"+i+e[r]]=t[i][r];return n}();function mG(e,t){if(aG.fnc(e))return e;var n=e.split("(")[0],i=fG[n],r=cG(e);switch(n){case"spring":return uG(e,t);case"cubicBezier":return iG(pG,r);case"steps":return iG(dG,r);default:return aG.fnc(i)?iG(i,r):iG(pG,i)}}function gG(e){try{return document.querySelectorAll(e)}catch(e){return}}var vG=[];function yG(e,t){for(var n=vG,i=e.length,r=arguments.length>=2?arguments[1]:void 0,o=0;o<i;o++)if(o in e){var s=e[o];t.call(r,s,o,e)&&n.push(s)}return(vG=e).length=0,n}function AG(e,t){t||(t=[]);for(var n=0,i=e.length;n<i;n++){var r=e[n];Array.isArray(r)?AG(r,t):t.push(r)}return t}function xG(e){return aG.arr(e)?e:(aG.str(e)&&(e=gG(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function bG(e,t){return e.some((function(e){return e===t}))}function _G(e){var t={};for(var n in e)t[n]=e[n];return t}function wG(e,t){var n=_G(e);for(var i in e)n[i]=t.hasOwnProperty(i)?t[i]:e[i];return n}function EG(e,t){var n=_G(e);for(var i in t)n[i]=aG.und(e[i])?t[i]:e[i];return n}var SG=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g,CG=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,MG=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,TG=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,RG=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g,IG=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function PG(e){var t=IG.exec(e);if(t)return t[2]}function BG(e,t){return aG.fnc(e)?e(t.target,t.id,t.total):e}function LG(e,t){return e.getAttribute(t)}function NG(e,t,n){if(bG([n,"deg","rad","turn"],PG(t)))return t;var i=eG.CSS[t+n];if(!aG.und(i))return i;var r=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(r),r.style.position="absolute",r.style.width=100+n;var s=100/r.offsetWidth;o.removeChild(r);var a=s*parseFloat(t);return eG.CSS[t+n]=a,a}function DG(e,t,n){if(t in e.style){var i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(i)||"0";return n?NG(e,r,n):r}}function kG(e,t){return aG.dom(e)&&!aG.inp(e)&&(LG(e,t)||aG.svg(e)&&e[t])?"attribute":aG.dom(e)&&bG(ZV,t)?"transform":aG.dom(e)&&"transform"!==t&&DG(e,t)?"css":null!=e[t]?"object":void 0}var OG=/(\w+)\(([^)]*)\)/g;function UG(e){if(aG.dom(e)){for(var t,n=e.style.transform||"",i=new Map;t=OG.exec(n);)i.set(t[1],t[2]);return i}}function FG(e,t,n,i){switch(kG(e,t)){case"transform":return function(e,t,n,i){var r=nG(t,"scale")?1:0+function(e){return nG(e,"translate")||"perspective"===e?"px":nG(e,"rotate")||nG(e,"skew")?"deg":void 0}(t),o=UG(e).get(t)||r;return n&&(n.transforms.list.set(t,o),n.transforms.last=t),i?NG(e,o,i):o}(e,t,i,n);case"css":return DG(e,t,n);case"attribute":return LG(e,t);default:return e[t]||0}}var zG=/^(\*=|\+=|-=)/;function jG(e,t){var n=zG.exec(e);if(!n)return e;var i=PG(e)||0,r=parseFloat(t),o=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return r+o+i;case"-":return r-o+i;case"*":return r*o+i}}var VG=/\s/g;function GG(e,t){if(aG.col(e))return function(e){return aG.rgb(e)?(t=e,(n=SG.exec(t))?"rgba("+n[1]+",1)":t):aG.hex(e)?function(e){var t=e.replace(CG,(function(e,t,n,i){return t+t+n+n+i+i})),n=MG.exec(t);return"rgba("+parseInt(n[1],16)+","+parseInt(n[2],16)+","+parseInt(n[3],16)+",1)"}(e):aG.hsl(e)?function(e){var t,n,i,r=TG.exec(e)||RG.exec(e),o=parseInt(r[1],10)/360,s=parseInt(r[2],10)/100,a=parseInt(r[3],10)/100,l=r[4]||1;function c(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(0==s)t=n=i=a;else{var u=a<.5?a*(1+s):a+s-a*s,h=2*a-u;t=c(h,u,o+1/3),n=c(h,u,o),i=c(h,u,o-1/3)}return"rgba("+255*t+","+255*n+","+255*i+","+l+")"}(e):void 0;var t,n}(e);var n=PG(e),i=n?e.substr(0,e.length-n.length):e;return t&&!VG.test(e)?i+t:i}function HG(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function WG(e){for(var t,n=e.points,i=0,r=0;r<n.numberOfItems;r++){var o=n.getItem(r);r>0&&(i+=HG(t,o)),t=o}return i}function QG(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*LG(e,"r")}(e);case"rect":return function(e){return 2*LG(e,"width")+2*LG(e,"height")}(e);case"line":return function(e){return HG({x:LG(e,"x1"),y:LG(e,"y1")},{x:LG(e,"x2"),y:LG(e,"y2")})}(e);case"polyline":return WG(e);case"polygon":return function(e){var t=e.points;return WG(e)+HG(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function qG(e,t){var n=t||{},i=n.el||function(e){for(var t=e.parentNode;aG.svg(t)&&(t=t.parentNode,aG.svg(t.parentNode)););return t}(e),r=i.getBoundingClientRect(),o=LG(i,"viewBox"),s=r.width,a=r.height,l=n.viewBox||(o?o.split(" "):[0,0,s,a]);return{el:i,viewBox:l,x:l[0]/1,y:l[1]/1,w:s/l[2],h:a/l[3]}}function XG(e,t){function n(n){void 0===n&&(n=0);var i=t+n>=1?t+n:0;return e.el.getPointAtLength(i)}var i=qG(e.el,e.svg),r=n(),o=n(-1),s=n(1);switch(e.property){case"x":return(r.x-i.x)*i.w;case"y":return(r.y-i.y)*i.h;case"angle":return 180*Math.atan2(s.y-o.y,s.x-o.x)/Math.PI}}var $G=/-?\d*\.?\d+/g;function YG(e,t){var n=GG(aG.pth(e)?e.totalLength:e,t)+"";return{original:n,numbers:n.match($G)?n.match($G).map(Number):[0],strings:aG.str(e)||t?n.split($G):[]}}function KG(e){return yG(e?AG(aG.arr(e)?e.map(xG):xG(e)):[],(function(e,t,n){return n.indexOf(e)===t}))}function JG(e){var t=KG(e);return t.map((function(e,n){return{target:e,id:n,total:t.length,transforms:{list:UG(e)}}}))}var ZG=/^spring/;function eH(e,t){var n=_G(t);if(ZG.test(n.easing)&&(n.duration=uG(n.easing)),aG.arr(e)){var i=e.length;2!==i||aG.obj(e[0])?aG.fnc(t.duration)||(n.duration=t.duration/i):e={value:e}}var r=aG.arr(e)?e:[e];return r.map((function(e,n){var i=aG.obj(e)&&!aG.pth(e)?e:{value:e};return aG.und(i.delay)&&(i.delay=n?0:t.delay),aG.und(i.endDelay)&&(i.endDelay=n===r.length-1?t.endDelay:0),i})).map((function(e){return EG(e,n)}))}var tH={css:function(e,t,n){return e.style[t]=n},attribute:function(e,t,n){return e.setAttribute(t,n)},object:function(e,t,n){return e[t]=n},transform:function(e,t,n,i,r){if(i.list.set(t,n),t===i.last||r){var o="";i.list.forEach((function(e,t){o+=t+"("+e+") "})),e.style.transform=o}}};function nH(e,t){for(var n=JG(e),i=0,r=n.length;i<r;i++){var o=n[i];for(var s in t){var a=BG(t[s],o),l=o.target,c=PG(a),u=FG(l,s,c,o),h=jG(GG(a,c||PG(u)),u),d=kG(l,s);tH[d](l,s,h,o.transforms,!0)}}}function iH(e,t){var n=e.length,i=function(e){return e.timelineOffset?e.timelineOffset:0},r={};return r.duration=n?Math.max.apply(Math,e.map((function(e){return i(e)+e.duration}))):t.duration,r.delay=n?Math.min.apply(Math,e.map((function(e){return i(e)+e.delay}))):t.delay,r.endDelay=n?r.duration-Math.max.apply(Math,e.map((function(e){return i(e)+e.duration-e.endDelay}))):t.endDelay,r}var rH,oH=0,sH=[],aH=[],lH=function(){function e(){rH=requestAnimationFrame(t)}function t(t){var n=sH.length;if(n){for(var i=0;i<n;){var r=sH[i];if(r.paused){var o=sH.indexOf(r);o>-1&&(sH.splice(o,1),n=sH.length)}else r.tick(t);i++}e()}else rH=cancelAnimationFrame(rH)}return e}();function cH(e){void 0===e&&(e={});var t,n=0,i=0,r=0,o=0,s=null;function a(){return window.Promise&&new Promise((function(e){return s=e}))}var l=a(),c=function(e){var t=wG(KV,e),n=wG(JV,e),i=function(e,t){var n=[],i=t.keyframes;for(var r in i&&(t=EG(function(e){for(var t=yG(AG(e.map((function(e){return Object.keys(e)}))),(function(e){return aG.key(e)})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),n={},i=function(i){var r=t[i];n[r]=e.map((function(e){var t={};for(var n in e)aG.key(n)?n==r&&(t.value=e[n]):t[n]=e[n];return t}))},r=0;r<t.length;r++)i(r);return n}(i),t)),t)aG.key(r)&&n.push({name:r,tweens:eH(t[r],e)});return n}(n,e),r=JG(e.targets),o=function(e,t){return yG(AG(e.map((function(e){return t.map((function(t){return function(e,t){var n=kG(e.target,t.name);if(n){var i=function(e,t){var n;return e.tweens.map((function(i){var r=function(e,t){var n={};for(var i in e){var r=BG(e[i],t);aG.arr(r)&&1===(r=r.map((function(e){return BG(e,t)}))).length&&(r=r[0]),n[i]=r}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(i,t),o=r.value,s=aG.arr(o)?o[1]:o,a=PG(s),l=FG(t.target,e.name,a,t),c=n?n.to.original:l,u=aG.arr(o)?o[0]:c,h=PG(u)||PG(l),d=a||h;return aG.und(s)&&(s=c),r.from=YG(u,d),r.to=YG(jG(s,u),d),r.start=n?n.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=mG(r.easing,r.duration),r.isPath=aG.pth(o),r.isColor=aG.col(r.from.original),r.isColor&&(r.round=1),n=r,r}))}(t,e),r=i[i.length-1];return{type:n,property:t.name,animatable:e,tweens:i,duration:r.end,delay:i[0].delay,endDelay:r.endDelay}}}(e,t)}))}))),(function(e){return!aG.und(e)}))}(r,i),s=iH(o,n),a=oH;return oH++,EG(t,{id:a,children:[],animatables:r,animations:o,duration:s.duration,delay:s.delay,endDelay:s.endDelay})}(e);function u(){c.reversed=!c.reversed;for(var e=0,n=t.length;e<n;e++)t[e].reversed=c.reversed}function h(e){return c.reversed?c.duration-e:e}function d(){n=0,i=h(c.currentTime)*(1/cH.speed)}function p(e,t){t&&t.seek(e-t.timelineOffset)}function f(e){for(var t=0,n=c.animations,i=n.length;t<i;){var r=n[t],o=r.animatable,s=r.tweens,a=s.length-1,l=s[a];a&&(l=yG(s,(function(t){return e<t.end}))[0]||l);for(var u=tG(e-l.start-l.delay,0,l.duration)/l.duration,h=isNaN(u)?1:l.easing(u),d=l.to.strings,p=l.round,f=[],m=l.to.numbers.length,g=void 0,v=0;v<m;v++){var y=void 0,A=l.to.numbers[v],x=l.from.numbers[v]||0;y=l.isPath?XG(l.value,h*A):x+h*(A-x),p&&(l.isColor&&v>2||(y=Math.round(y*p)/p)),f.push(y)}var b=d.length;if(b){g=d[0];for(var _=0;_<b;_++){d[_];var w=d[_+1],E=f[_];isNaN(E)||(g+=w?E+w:E+" ")}}else g=f[0];tH[r.type](o.target,r.property,g,o.transforms),r.currentValue=g,t++}}function m(e){c[e]&&!c.passThrough&&c[e](c)}function g(e){var d=c.duration,g=c.delay,v=d-c.endDelay,y=h(e);c.progress=tG(y/d*100,0,100),c.reversePlayback=y<c.currentTime,t&&function(e){if(c.reversePlayback)for(var n=o;n--;)p(e,t[n]);else for(var i=0;i<o;i++)p(e,t[i])}(y),!c.began&&c.currentTime>0&&(c.began=!0,m("begin"),m("loopBegin")),y<=g&&0!==c.currentTime&&f(0),(y>=v&&c.currentTime!==d||!d)&&f(d),y>g&&y<v?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,m("changeBegin")),m("change"),f(y)):c.changeBegan&&(c.changeCompleted=!0,c.changeBegan=!1,m("changeComplete")),c.currentTime=tG(y,0,d),c.began&&m("update"),e>=d&&(i=0,c.remaining&&!0!==c.remaining&&c.remaining--,c.remaining?(n=r,m("loopComplete"),m("loopBegin"),"alternate"===c.direction&&u()):(c.paused=!0,c.completed||(c.completed=!0,m("loopComplete"),m("complete"),"Promise"in window&&(s(),l=a()))))}return c.reset=function(){var e=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed="reverse"===e,c.remaining=c.loop,t=c.children;for(var n=o=t.length;n--;)c.children[n].reset();(c.reversed&&!0!==c.loop||"alternate"===e&&1===c.loop)&&c.remaining++,f(0)},c.set=function(e,t){return nH(e,t),c},c.tick=function(e){r=e,n||(n=r),g((r+(i-n))*cH.speed)},c.seek=function(e){g(h(e))},c.pause=function(){c.paused=!0,d()},c.play=function(){c.paused&&(c.paused=!1,sH.push(c),d(),rH||lH())},c.reverse=function(){u(),d()},c.restart=function(){c.reset(),c.play()},c.finished=l,c.reset(),c.autoplay&&c.play(),c}function uH(e,t){for(var n=t.length;n--;)bG(e,t[n].animatable.target)&&t.splice(n,1)}document.addEventListener("visibilitychange",(function(){if(document.hidden){for(var e=0,t=sH.length;e<t;e++)activeInstance[e].pause();aH=sH.slice(0),sH=[]}else for(var n=0,i=aH.length;n<i;n++)aH[n].play()})),cH.version="3.0.0",cH.speed=1,cH.running=sH,cH.remove=function(e){for(var t=KG(e),n=sH.length;n--;){var i=sH[n],r=i.animations,o=i.children;uH(t,r);for(var s=o.length;s--;){var a=o[s],l=a.animations;uH(t,l),l.length||a.children.length||o.splice(s,1)}r.length||o.length||i.pause()}},cH.get=FG,cH.set=nH,cH.convertPx=NG,cH.path=function(e,t){var n=aG.str(e)?gG(e)[0]:e,i=t||100;return function(e){return{property:e,el:n,svg:qG(n),totalLength:QG(n)*(i/100)}}},cH.setDashoffset=function(e){var t=QG(e);return e.setAttribute("stroke-dasharray",t),t},cH.stagger=function(e,t){void 0===t&&(t={});var n=t.direction||"normal",i=t.easing?mG(t.easing):null,r=t.grid,o=t.axis,s=t.from||0,a="first"===s,l="center"===s,c="last"===s,u=aG.arr(e),h=u?parseFloat(e[0]):parseFloat(e),d=u?parseFloat(e[1]):0,p=PG(u?e[1]:e)||0,f=t.start||0+(u?h:0),m=[],g=0;return function(e,t,v){if(a&&(s=0),l&&(s=(v-1)/2),c&&(s=v-1),!m.length){for(var y=0;y<v;y++){if(r){var A=l?(r[0]-1)/2:s%r[0],x=l?(r[1]-1)/2:Math.floor(s/r[0]),b=A-y%r[0],_=x-Math.floor(y/r[0]),w=Math.sqrt(b*b+_*_);"x"===o&&(w=-b),"y"===o&&(w=-_),m.push(w)}else m.push(Math.abs(s-y));g=Math.max.apply(Math,m)}i&&(m=m.map((function(e){return i(e/g)*g}))),"reverse"===n&&(m=m.map((function(e){return o?e<0?-1*e:-e:Math.abs(g-e)})))}return f+(u?(d-h)/g:h)*(Math.round(100*m[t])/100)+p}},cH.timeline=function(e){void 0===e&&(e={});var t=cH(e);return t.duration=0,t.add=function(n,i){var r=sH.indexOf(t),o=t.children;function s(e){e.passThrough=!0}r>-1&&sH.splice(r,1);for(var a=0;a<o.length;a++)s(o[a]);var l=EG(n,wG(JV,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.direction=t.direction,l.timelineOffset=aG.und(i)?c:jG(i,c),s(t),t.seek(l.timelineOffset);var u=cH(l);s(u),o.push(u);var h=iH(o,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},cH.easing=mG,cH.penner=fG,cH.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};const hH=cH,dH=n,pH=new WeakMap;class fH extends dH.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const r=new dH.FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.parse(e,t,i)}),n,i)}parse(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};this.decodeDracoFile(e,t,null,null,dH.SRGBColorSpace,n).catch(n)}decodeDracoFile(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:dH.LinearSRGBColorSpace,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>{};const s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:r};return this.decodeGeometry(e,s).then(t).catch(o)}decodeGeometry(e,t){const n=JSON.stringify(t);if(pH.has(e)){const t=pH.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,o=e.byteLength,s=this._getWorker(r,o).then((n=>(i=n,new Promise(((n,o)=>{i._callbacks[r]={resolve:n,reject:o},i.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),pH.set(e,{key:n,promise:s}),s}_createGeometry(e){const t=new dH.BufferGeometry;e.index&&t.setIndex(new dH.BufferAttribute(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],r=i.name,o=i.array,s=i.itemSize,a=new dH.BufferAttribute(o,s);"color"===r&&(this._assignVertexColorSpace(a,i.vertexColorSpace),a.normalized=o instanceof Float32Array==0),t.setAttribute(r,a)}return t}_assignVertexColorSpace(e,t){if(t!==dH.SRGBColorSpace)return;const n=new dH.Color;for(let i=0,r=e.count;i<r;i++)n.fromBufferAttribute(e,i),dH.ColorManagement.toWorkingColorSpace(n,dH.SRGBColorSpace),e.setXYZ(i,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new dH.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{n.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=mH.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function mH(){let e,t;function n(e,t,n,i,r,o){const s=o.num_components(),a=n.num_points()*s,l=a*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),u=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,o,c,l,u);const h=new r(e.HEAPF32.buffer,u,a).slice();return e._free(u),{name:i,array:h,itemSize:s}}onmessage=function(i){const r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=r.buffer,o=r.taskConfig;t.then((e=>{const t=e.draco,s=new t.Decoder;try{const e=function(e,t,i,r){const o=r.attributeIDs,s=r.attributeTypes;let a,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,l=t.DecodeArrayToMesh(i,i.byteLength,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,l=t.DecodeArrayToPointCloud(i,i.byteLength,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const u={index:null,attributes:[]};for(const h in o){const i=self[s[h]];let l,c;if(r.useUniqueIDs)c=o[h],l=t.GetAttributeByUniqueId(a,c);else{if(c=t.GetAttributeId(a,e[o[h]]),-1===c)continue;l=t.GetAttribute(a,c)}const d=n(e,t,a,h,i,l);"color"===h&&(d.vertexColorSpace=r.vertexColorSpace),u.attributes.push(d)}return c===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){const i=3*n.num_faces(),r=4*i,o=e._malloc(r);t.GetTrianglesUInt32Array(n,r,o);const s=new Uint32Array(e.HEAPF32.buffer,o,i).slice();return e._free(o),{array:s,itemSize:1}}(e,t,a)),e.destroy(a),u}(t,s,new Int8Array(i),o),a=e.attributes.map((e=>e.array.buffer));e.index&&a.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},a)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(s)}}))}}}function gH(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(e){if(e.normalized||e.isInterleavedBufferAttribute){const t=new Float32Array(e.count*e.itemSize);for(let n=0,i=0;n<e.count;n++)t[i++]=e.getX(n),t[i++]=e.getY(n),e.itemSize>2&&(t[i++]=e.getZ(n));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}const r=e.index?e.toNonIndexed():e,o=t.generateTangents(i(r.attributes.position),i(r.attributes.normal),i(r.attributes.uv));if(n)for(let s=3;s<o.length;s+=4)o[s]*=-1;return r.setAttribute("tangent",new dH.BufferAttribute(o,4)),e!==r&&e.copy(r),e}function vH(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),o={},s={},a=e[0].morphTargetsRelative,l=new dH.BufferGeometry;let c=0;for(let u=0;u<e.length;++u){const h=e[u];let d=0;if(n!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[e]&&(o[e]=[]),o[e].push(h.attributes[e]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[e]&&(s[e]=[]),s[e].push(h.morphAttributes[e])}if(t){let e;if(n)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}l.addGroup(c,e,u),c+=e}}if(n){let t=0;const n=[];for(let i=0;i<e.length;++i){const r=e[i].index;for(let e=0;e<r.count;++e)n.push(r.getX(e)+t);t+=e[i].attributes.position.count}l.setIndex(n)}for(const u in o){const e=yH(o[u]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,e)}for(const u in s){const e=s[u][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let t=0;t<e;++t){const e=[];for(let i=0;i<s[u].length;++i)e.push(s[u][i][t]);const n=yH(e);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(n)}}return l}function yH(e){let t,n,i,r=-1,o=0;for(let c=0;c<e.length;++c){const s=e[c];if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=s.normalized),i!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===r&&(r=s.gpuType),r!==s.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=s.count*n}const s=new t(o),a=new dH.BufferAttribute(s,n,i);let l=0;for(let c=0;c<e.length;++c){const t=e[c];if(t.isInterleavedBufferAttribute){const e=l/n;for(let i=0,r=t.count;i<r;i++)for(let o=0;o<n;o++){const n=t.getComponent(i,o);a.setComponent(i+e,o,n)}}else s.set(t.array,l);l+=t.count*n}return void 0!==r&&(a.gpuType=r),a}function AH(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?bH(e):e.isInstancedBufferAttribute?(new dH.InstancedBufferAttribute).copy(e):(new dH.BufferAttribute).copy(e)}function xH(e){let t,n=0,i=0;for(let c=0,u=e.length;c<u;++c){const r=e[c];if(void 0===t&&(t=r.array.constructor),t!==r.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=r.array.length,i+=r.itemSize}const r=new dH.InterleavedBuffer(new t(n),i);let o=0;const s=[],a=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let c=0,u=e.length;c<u;c++){const t=e[c],n=t.itemSize,i=t.count,u=new dH.InterleavedBufferAttribute(r,n,o,t.normalized);s.push(u),o+=n;for(let e=0;e<i;e++)for(let i=0;i<n;i++)u[l[i]](e,t[a[i]](e))}return s}function bH(e){const t=e.data.array.constructor,n=e.count,i=e.itemSize,r=e.normalized,o=new t(n*i);let s;s=e.isInstancedInterleavedBufferAttribute?new dH.InstancedBufferAttribute(o,i,r,e.meshPerAttribute):new dH.BufferAttribute(o,i,r);for(let a=0;a<n;a++)s.setX(a,e.getX(a)),i>=2&&s.setY(a,e.getY(a)),i>=3&&s.setZ(a,e.getZ(a)),i>=4&&s.setW(a,e.getW(a));return s}function _H(e){const t=e.attributes,n=e.morphTargets,i=new Map;for(const r in t){const e=t[r];e.isInterleavedBufferAttribute&&(i.has(e)||i.set(e,bH(e)),t[r]=i.get(e))}for(const r in n){const e=n[r];e.isInterleavedBufferAttribute&&(i.has(e)||i.set(e,bH(e)),n[r]=i.get(e))}}function wH(e){let t=0;for(const i in e.attributes){const n=e.getAttribute(i);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function EH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;t=Math.max(t,Number.EPSILON);const n={},i=e.getIndex(),r=e.getAttribute("position"),o=i?i.count:r.count;let s=0;const a=Object.keys(e.attributes),l={},c={},u=[],h=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"];for(let y=0,A=a.length;y<A;y++){const t=a[y],n=e.attributes[t];l[t]=new n.constructor(new n.array.constructor(n.count*n.itemSize),n.itemSize,n.normalized);const i=e.morphAttributes[t];i&&(c[t]||(c[t]=[]),i.forEach(((e,n)=>{const i=new e.array.constructor(e.count*e.itemSize);c[t][n]=new e.constructor(i,e.itemSize,e.normalized)})))}const p=.5*t,f=Math.log10(1/t),m=Math.pow(10,f),g=p*m;for(let y=0;y<o;y++){const t=i?i.getX(y):y;let r="";for(let n=0,i=a.length;n<i;n++){const i=a[n],o=e.getAttribute(i),s=o.itemSize;for(let e=0;e<s;e++)r+=~~(o[h[e]](t)*m+g)+","}if(r in n)u.push(n[r]);else{for(let n=0,i=a.length;n<i;n++){const i=a[n],r=e.getAttribute(i),o=e.morphAttributes[i],u=r.itemSize,p=l[i],f=c[i];for(let e=0;e<u;e++){const n=h[e],i=d[e];if(p[i](s,r[n](t)),o)for(let e=0,r=o.length;e<r;e++)f[e][i](s,o[e][n](t))}}n[r]=s,u.push(s),s++}}const v=e.clone();for(const y in e.attributes){const e=l[y];if(v.setAttribute(y,new e.constructor(e.array.slice(0,s*e.itemSize),e.itemSize,e.normalized)),y in c)for(let t=0;t<c[y].length;t++){const e=c[y][t];v.morphAttributes[y][t]=new e.constructor(e.array.slice(0,s*e.itemSize),e.itemSize,e.normalized)}}return v.setIndex(u),v}function SH(e,t){if(t===dH.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===dH.TriangleFanDrawMode||t===dH.TriangleStripDrawMode){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,r=[];if(t===dH.TriangleFanDrawMode)for(let e=1;e<=i;e++)r.push(n.getX(0)),r.push(n.getX(e)),r.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(r.push(n.getX(e)),r.push(n.getX(e+1)),r.push(n.getX(e+2))):(r.push(n.getX(e+2)),r.push(n.getX(e+1)),r.push(n.getX(e)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(r),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}function CH(e){const t=new dH.Vector3,n=new dH.Vector3,i=new dH.Vector3,r=new dH.Vector3,o=new dH.Vector3,s=new dH.Vector3,a=new dH.Vector3,l=new dH.Vector3,c=new dH.Vector3;function u(e,u,h,d,p,f,m,g){t.fromBufferAttribute(u,p),n.fromBufferAttribute(u,f),i.fromBufferAttribute(u,m);const v=e.morphTargetInfluences;if(h&&v){a.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let e=0,u=h.length;e<u;e++){const u=v[e],g=h[e];0!==u&&(r.fromBufferAttribute(g,p),o.fromBufferAttribute(g,f),s.fromBufferAttribute(g,m),d?(a.addScaledVector(r,u),l.addScaledVector(o,u),c.addScaledVector(s,u)):(a.addScaledVector(r.sub(t),u),l.addScaledVector(o.sub(n),u),c.addScaledVector(s.sub(i),u)))}t.add(a),n.add(l),i.add(c)}e.isSkinnedMesh&&(e.applyBoneTransform(p,t),e.applyBoneTransform(f,n),e.applyBoneTransform(m,i)),g[3*p+0]=t.x,g[3*p+1]=t.y,g[3*p+2]=t.z,g[3*f+0]=n.x,g[3*f+1]=n.y,g[3*f+2]=n.z,g[3*m+0]=i.x,g[3*m+1]=i.y,g[3*m+2]=i.z}const h=e.geometry,d=e.material;let p,f,m;const g=h.index,v=h.attributes.position,y=h.morphAttributes.position,A=h.morphTargetsRelative,x=h.attributes.normal,b=h.morphAttributes.position,_=h.groups,w=h.drawRange;let E,S,C,M,T,R,I;const P=new Float32Array(v.count*v.itemSize),B=new Float32Array(x.count*x.itemSize);if(null!==g)if(Array.isArray(d))for(E=0,C=_.length;E<C;E++)for(T=_[E],R=Math.max(T.start,w.start),I=Math.min(T.start+T.count,w.start+w.count),S=R,M=I;S<M;S+=3)p=g.getX(S),f=g.getX(S+1),m=g.getX(S+2),u(e,v,y,A,p,f,m,P),u(e,x,b,A,p,f,m,B);else for(R=Math.max(0,w.start),I=Math.min(g.count,w.start+w.count),E=R,C=I;E<C;E+=3)p=g.getX(E),f=g.getX(E+1),m=g.getX(E+2),u(e,v,y,A,p,f,m,P),u(e,x,b,A,p,f,m,B);else if(Array.isArray(d))for(E=0,C=_.length;E<C;E++)for(T=_[E],R=Math.max(T.start,w.start),I=Math.min(T.start+T.count,w.start+w.count),S=R,M=I;S<M;S+=3)p=S,f=S+1,m=S+2,u(e,v,y,A,p,f,m,P),u(e,x,b,A,p,f,m,B);else for(R=Math.max(0,w.start),I=Math.min(v.count,w.start+w.count),E=R,C=I;E<C;E+=3)p=E,f=E+1,m=E+2,u(e,v,y,A,p,f,m,P),u(e,x,b,A,p,f,m,B);return{positionAttribute:v,normalAttribute:x,morphedPositionAttribute:new dH.Float32BufferAttribute(P,3),morphedNormalAttribute:new dH.Float32BufferAttribute(B,3)}}function MH(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort(((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start)),null===e.getIndex()){const t=e.getAttribute("position"),n=[];for(let e=0;e<t.count;e+=3)n.push(e,e+1,e+2);e.setIndex(n)}const n=e.getIndex(),i=[];for(let s=0;s<t.length;s++){const e=t[s],r=e.start,o=r+e.count;for(let t=r;t<o;t++)i.push(n.getX(t))}e.dispose(),e.setIndex(i);let r=0;for(let s=0;s<t.length;s++){const e=t[s];e.start=r,r+=e.count}let o=t[0];e.groups=[o];for(let s=1;s<t.length;s++){const n=t[s];o.materialIndex===n.materialIndex?o.count+=n.count:(o=n,e.groups.push(o))}return e}function TH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/3;const n=Math.cos(t),i=100*(1+1e-10),r=[new dH.Vector3,new dH.Vector3,new dH.Vector3],o=new dH.Vector3,s=new dH.Vector3,a=new dH.Vector3,l=new dH.Vector3;function c(e){return`${~~(e.x*i)},${~~(e.y*i)},${~~(e.z*i)}`}const u=e.index?e.toNonIndexed():e,h=u.attributes.position,d={};for(let m=0,g=h.count/3;m<g;m++){const e=3*m,t=r[0].fromBufferAttribute(h,e+0),n=r[1].fromBufferAttribute(h,e+1),i=r[2].fromBufferAttribute(h,e+2);o.subVectors(i,n),s.subVectors(t,n);const a=(new dH.Vector3).crossVectors(o,s).normalize();for(let o=0;o<3;o++){const e=c(r[o]);e in d||(d[e]=[]),d[e].push(a)}}const p=new Float32Array(3*h.count),f=new dH.BufferAttribute(p,3,!1);for(let m=0,g=h.count/3;m<g;m++){const e=3*m,t=r[0].fromBufferAttribute(h,e+0),i=r[1].fromBufferAttribute(h,e+1),u=r[2].fromBufferAttribute(h,e+2);o.subVectors(u,i),s.subVectors(t,i),a.crossVectors(o,s).normalize();for(let o=0;o<3;o++){const t=d[c(r[o])];l.set(0,0,0);for(let e=0,i=t.length;e<i;e++){const i=t[e];a.dot(i)>n&&l.add(i)}l.normalize(),f.setXYZ(e+o,l.x,l.y,l.z)}}return u.setAttribute("normal",f),u}class RH extends dH.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new DH(e)})),this.register((function(e){return new kH(e)})),this.register((function(e){return new WH(e)})),this.register((function(e){return new QH(e)})),this.register((function(e){return new qH(e)})),this.register((function(e){return new UH(e)})),this.register((function(e){return new FH(e)})),this.register((function(e){return new zH(e)})),this.register((function(e){return new jH(e)})),this.register((function(e){return new NH(e)})),this.register((function(e){return new VH(e)})),this.register((function(e){return new OH(e)})),this.register((function(e){return new HH(e)})),this.register((function(e){return new GH(e)})),this.register((function(e){return new BH(e)})),this.register((function(e){return new XH(e)})),this.register((function(e){return new $H(e)}))}load(e,t,n,i){const r=this;let o;if(""!==this.resourcePath)o=this.resourcePath;else if(""!==this.path){const t=dH.LoaderUtils.extractUrlBase(e);o=dH.LoaderUtils.resolveURL(t,this.path)}else o=dH.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const s=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new dH.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{r.parse(n,o,(function(n){t(n),r.manager.itemEnd(e)}),s)}catch(e){s(e)}}),n,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let r;const o={},s={},a=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===YH){try{o[PH.KHR_BINARY_GLTF]=new KH(e)}catch(e){return void(i&&i(e))}r=JSON.parse(o[PH.KHR_BINARY_GLTF].content)}else r=JSON.parse(a.decode(e));else r=e;if(void 0===r.asset||r.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new xW(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const e=this.pluginCallbacks[c](l);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[e.name]=e,o[e.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const e=r.extensionsUsed[c],t=r.extensionsRequired||[];switch(e){case PH.KHR_MATERIALS_UNLIT:o[e]=new LH;break;case PH.KHR_DRACO_MESH_COMPRESSION:o[e]=new JH(r,this.dracoLoader);break;case PH.KHR_TEXTURE_TRANSFORM:o[e]=new ZH;break;case PH.KHR_MESH_QUANTIZATION:o[e]=new eW;break;default:t.indexOf(e)>=0&&void 0===s[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(o),l.setPlugins(s),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}function IH(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const PH={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class BH{constructor(e){this.parser=e,this.name=PH.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const r=t.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let s;const a=new dH.Color(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],dH.LinearSRGBColorSpace);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":s=new dH.DirectionalLight(a),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new dH.PointLight(a),s.distance=l;break;case"spot":s=new dH.SpotLight(a),s.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,s.angle=o.spot.outerConeAngle,s.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return s.position.set(0,0,0),fW(s,o),void 0!==o.intensity&&(s.intensity=o.intensity),s.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(s),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class LH{constructor(){this.name=PH.KHR_MATERIALS_UNLIT}getMaterialType(){return dH.MeshBasicMaterial}extendParams(e,t,n){const i=[];e.color=new dH.Color(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],dH.LinearSRGBColorSpace),e.opacity=t[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,dH.SRGBColorSpace))}return Promise.all(i)}}class NH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class DH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new dH.Vector2(e,e)}return Promise.all(r)}}class kH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class OH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class UH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new dH.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],dH.LinearSRGBColorSpace)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,dH.SRGBColorSpace)),void 0!==o.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class FH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class zH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const s=o.attenuationColor||[1,1,1];return t.attenuationColor=(new dH.Color).setRGB(s[0],s[1],s[2],dH.LinearSRGBColorSpace),Promise.all(r)}}class jH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class VH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const s=o.specularColorFactor||[1,1,1];return t.specularColor=(new dH.Color).setRGB(s[0],s[1],s[2],dH.LinearSRGBColorSpace),void 0!==o.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,dH.SRGBColorSpace)),Promise.all(r)}}class GH{constructor(e){this.parser=e,this.name=PH.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return t.bumpScale=void 0!==o.bumpFactor?o.bumpFactor:1,void 0!==o.bumpTexture&&r.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}}class HH{constructor(e){this.parser=e,this.name=PH.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dH.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&r.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class WH{constructor(e){this.parser=e,this.name=PH.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class QH{constructor(e){this.parser=e,this.name=PH.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],s=i.images[o.source];let a=n.textureLoader;if(s.uri){const e=n.options.manager.getHandler(s.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class qH{constructor(e){this.parser=e,this.name=PH.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],s=i.images[o.source];let a=n.textureLoader;if(s.uri){const e=n.options.manager.getHandler(s.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o.source,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class XH{constructor(e){this.name=PH.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,o=e.count,s=e.byteStride,a=new Uint8Array(t,n,i);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(o,s,a,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(o*s);return r.decodeGltfBuffer(new Uint8Array(t),o,s,a,e.mode,e.filter),t}))}))}return null}}class $H{constructor(e){this.name=PH.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const a of i.primitives)if(a.mode!==rW.TRIANGLES&&a.mode!==rW.TRIANGLE_STRIP&&a.mode!==rW.TRIANGLE_FAN&&void 0!==a.mode)return null;const r=n.extensions[this.name].attributes,o=[],s={};for(const a in r)o.push(this.parser.getDependency("accessor",r[a]).then((e=>(s[a]=e,s[a]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then((e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,r=[];for(const o of n){const e=new dH.Matrix4,t=new dH.Vector3,n=new dH.Quaternion,a=new dH.Vector3(1,1,1),l=new dH.InstancedMesh(o.geometry,o.material,i);for(let r=0;r<i;r++)s.TRANSLATION&&t.fromBufferAttribute(s.TRANSLATION,r),s.ROTATION&&n.fromBufferAttribute(s.ROTATION,r),s.SCALE&&a.fromBufferAttribute(s.SCALE,r),l.setMatrixAt(r,e.compose(t,n,a));for(const i in s)if("_COLOR_0"===i){const e=s[i];l.instanceColor=new dH.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&o.geometry.setAttribute(i,s[i]);dH.Object3D.prototype.copy.call(l,o),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]})))}}const YH="glTF";class KH{constructor(e){this.name=PH.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==YH)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(e,12);let o=0;for(;o<i;){const t=r.getUint32(o,!0);o+=4;const i=r.getUint32(o,!0);if(o+=4,1313821514===i){const i=new Uint8Array(e,12+o,t);this.content=n.decode(i)}else if(5130562===i){const n=12+o;this.body=e.slice(n,n+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class JH{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=PH.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},a={},l={};for(const c in o){const e=cW[c]||c.toLowerCase();s[e]=o[c]}for(const c in e.attributes){const t=cW[c]||c.toLowerCase();if(void 0!==o[c]){const i=n.accessors[e.attributes[c]],r=oW[i.componentType];l[t]=r.name,a[t]=!0===i.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t,n){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=a[t];void 0!==i&&(n.normalized=i)}t(e)}),s,l,dH.LinearSRGBColorSpace,n)}))}))}}class ZH{constructor(){this.name=PH.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class eW{constructor(){this.name=PH.KHR_MESH_QUANTIZATION}}class tW extends dH.Interpolant{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let o=0;o!==i;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,c=i-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+u;for(let A=0;A!==s;A++){const e=o[f+A+s],t=o[f+A+a]*c,n=o[p+A+s],i=o[p+A]*c;r[A]=v*e+y*t+m*n+g*i}return r}}const nW=new dH.Quaternion;class iW extends tW{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return nW.fromArray(r).normalize().toArray(r),r}}const rW={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},oW={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sW={9728:dH.NearestFilter,9729:dH.LinearFilter,9984:dH.NearestMipmapNearestFilter,9985:dH.LinearMipmapNearestFilter,9986:dH.NearestMipmapLinearFilter,9987:dH.LinearMipmapLinearFilter},aW={33071:dH.ClampToEdgeWrapping,33648:dH.MirroredRepeatWrapping,10497:dH.RepeatWrapping},lW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cW={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},uW={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},hW={CUBICSPLINE:void 0,LINEAR:dH.InterpolateLinear,STEP:dH.InterpolateDiscrete};function dW(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new dH.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:dH.FrontSide})),e.DefaultMaterial}function pW(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function fW(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function mW(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function gW(e){let t;const n=e.extensions&&e.extensions[PH.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+vW(n.attributes):e.indices+":"+vW(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,r=e.targets.length;i<r;i++)t+=":"+vW(e.targets[i]);return t}function vW(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function yW(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const AW=new dH.Matrix4;class xW{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new IH,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=-1,r=!1,o=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=n&&t?parseInt(t[1],10):-1,r=e.indexOf("Firefox")>-1,o=r?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||n&&i<17||r&&o<98?this.textureLoader=new dH.TextureLoader(this.options.manager):this.textureLoader=new dH.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new dH.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const o={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return pW(r,o,i),fW(o,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){for(const e of o.scenes)e.updateMatrixWorld();e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[i,o]of e.children.entries())r(o,t.children[i])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[PH.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,r){n.load(dH.LoaderUtils.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=lW[i.type],t=oW[i.componentType],n=!0===i.normalized,r=new t(i.count*e);return Promise.resolve(new dH.BufferAttribute(r,e,n))}const r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){const r=e[0],o=lW[i.type],s=oW[i.componentType],a=s.BYTES_PER_ELEMENT,l=a*o,c=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,p;if(u&&u!==l){const e=Math.floor(c/u),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(d=new s(r,e*u,i.count*u/a),l=new dH.InterleavedBuffer(d,u/a),t.cache.add(n,l)),p=new dH.InterleavedBufferAttribute(l,o,c%u/a,h)}else d=null===r?new s(i.count*o):new s(r,c,i.count*o),p=new dH.BufferAttribute(d,o,h);if(void 0!==i.sparse){const t=lW.SCALAR,n=oW[i.sparse.indices.componentType],a=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],a,i.sparse.count*t),u=new s(e[2],l,i.sparse.count*o);null!==r&&(p=new dH.BufferAttribute(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,i=c.length;e<i;e++){const t=c[e];if(p.setX(t,u[e*o]),o>=2&&p.setY(t,u[e*o+1]),o>=3&&p.setZ(t,u[e*o+2]),o>=4&&p.setW(t,u[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i];let o=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(o=e)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,n){const i=this,r=this.json,o=r.textures[e],s=r.images[t],a=(s.uri||s.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=o.name||s.name||"",""===t.name&&"string"==typeof s.uri&&!1===s.uri.startsWith("data:image/")&&(t.name=s.uri);const n=(r.samplers||{})[o.sampler]||{};return t.magFilter=sW[n.magFilter]||dH.LinearFilter,t.minFilter=sW[n.minFilter]||dH.LinearMipmapLinearFilter,t.wrapS=aW[n.wrapS]||dH.RepeatWrapping,t.wrapT=aW[n.wrapT]||dH.RepeatWrapping,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==dH.NearestFilter&&t.minFilter!==dH.LinearFilter,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=n.images[e],o=self.URL||self.webkitURL;let s=r.uri||"",a=!1;if(void 0!==r.bufferView)s=this.getDependency("bufferView",r.bufferView).then((function(e){a=!0;const t=new Blob([e],{type:r.mimeType});return s=o.createObjectURL(t),s}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(s).then((function(e){return new Promise((function(n,r){let o=n;!0===t.isImageBitmapLoader&&(o=function(e){const t=new dH.Texture(e);t.needsUpdate=!0,n(t)}),t.load(dH.LoaderUtils.resolveURL(e,i.path),o,void 0,r)}))})).then((function(e){var t;return!0===a&&o.revokeObjectURL(s),fW(e,r),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,n,i){const r=this;return this.getDependency("texture",n.index).then((function(o){if(!o)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((o=o.clone()).channel=n.texCoord),r.extensions[PH.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[PH.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(o);o=r.extensions[PH.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),r.associations.set(o,t)}}return void 0!==i&&(o.colorSpace=i),e[t]=o,o}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new dH.PointsMaterial,dH.Material.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new dH.LineBasicMaterial,dH.Material.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||r||o){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),r&&(t.vertexColors=!0),o&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return dH.MeshStandardMaterial}loadMaterial(e){const t=this,n=this.json,i=this.extensions,r=n.materials[e];let o;const s={},a=[];if((r.extensions||{})[PH.KHR_MATERIALS_UNLIT]){const e=i[PH.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),a.push(e.extendParams(s,r,t))}else{const n=r.pbrMetallicRoughness||{};if(s.color=new dH.Color(1,1,1),s.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;s.color.setRGB(e[0],e[1],e[2],dH.LinearSRGBColorSpace),s.opacity=e[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(s,"map",n.baseColorTexture,dH.SRGBColorSpace)),s.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,s.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(a.push(t.assignTexture(s,"metalnessMap",n.metallicRoughnessTexture)),a.push(t.assignTexture(s,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),a.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===r.doubleSided&&(s.side=dH.DoubleSide);const l=r.alphaMode||"OPAQUE";if("BLEND"===l?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,"MASK"===l&&(s.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&o!==dH.MeshBasicMaterial&&(a.push(t.assignTexture(s,"normalMap",r.normalTexture)),s.normalScale=new dH.Vector2(1,1),void 0!==r.normalTexture.scale)){const e=r.normalTexture.scale;s.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&o!==dH.MeshBasicMaterial&&(a.push(t.assignTexture(s,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(s.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&o!==dH.MeshBasicMaterial){const e=r.emissiveFactor;s.emissive=(new dH.Color).setRGB(e[0],e[1],e[2],dH.LinearSRGBColorSpace)}return void 0!==r.emissiveTexture&&o!==dH.MeshBasicMaterial&&a.push(t.assignTexture(s,"emissiveMap",r.emissiveTexture,dH.SRGBColorSpace)),Promise.all(a).then((function(){const n=new o(s);return r.name&&(n.name=r.name),fW(n,r),t.associations.set(n,{materials:e}),r.extensions&&pW(i,n,r),n}))}createUniqueName(e){const t=dH.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[PH.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return bW(n,e,t)}))}const o=[];for(let s=0,a=e.length;s<a;s++){const n=e[s],a=gW(n),l=i[a];if(l)o.push(l.promise);else{let e;e=n.extensions&&n.extensions[PH.KHR_DRACO_MESH_COMPRESSION]?r(n):bW(new dH.BufferGeometry,n,t),i[a]={primitive:n,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,i=this.extensions,r=n.meshes[e],o=r.primitives,s=[];for(let a=0,l=o.length;a<l;a++){const e=void 0===o[a].material?dW(this.cache):this.getDependency("material",o[a].material);s.push(e)}return s.push(t.loadGeometries(o)),Promise.all(s).then((function(n){const s=n.slice(0,n.length-1),a=n[n.length-1],l=[];for(let u=0,h=a.length;u<h;u++){const n=a[u],c=o[u];let h;const d=s[u];if(c.mode===rW.TRIANGLES||c.mode===rW.TRIANGLE_STRIP||c.mode===rW.TRIANGLE_FAN||void 0===c.mode)h=!0===r.isSkinnedMesh?new dH.SkinnedMesh(n,d):new dH.Mesh(n,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),c.mode===rW.TRIANGLE_STRIP?h.geometry=SH(h.geometry,dH.TriangleStripDrawMode):c.mode===rW.TRIANGLE_FAN&&(h.geometry=SH(h.geometry,dH.TriangleFanDrawMode));else if(c.mode===rW.LINES)h=new dH.LineSegments(n,d);else if(c.mode===rW.LINE_STRIP)h=new dH.Line(n,d);else if(c.mode===rW.LINE_LOOP)h=new dH.LineLoop(n,d);else{if(c.mode!==rW.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);h=new dH.Points(n,d)}Object.keys(h.geometry.morphAttributes).length>0&&mW(h,r),h.name=t.createUniqueName(r.name||"mesh_"+e),fW(h,r),c.extensions&&pW(i,h,c),t.assignFinalMaterial(h),l.push(h)}for(let i=0,r=l.length;i<r;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return r.extensions&&pW(i,l[0],r),l[0];const c=new dH.Group;r.extensions&&pW(i,c,r),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new dH.PerspectiveCamera(dH.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new dH.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),fW(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,r=t.joints.length;i<r;i++)n.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){const n=e.pop(),i=e,r=[],o=[];for(let s=0,a=i.length;s<a;s++){const e=i[s];if(e){r.push(e);const t=new dH.Matrix4;null!==n&&t.fromArray(n.array,16*s),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[s])}return new dH.Skeleton(r,o)}))}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],r=i.name?i.name:"animation_"+e,o=[],s=[],a=[],l=[],c=[];for(let u=0,h=i.channels.length;u<h;u++){const e=i.channels[u],t=i.samplers[e.sampler],n=e.target,r=n.node,h=void 0!==i.parameters?i.parameters[t.input]:t.input,d=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==n.node&&(o.push(this.getDependency("node",r)),s.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),l.push(t),c.push(n))}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(a),Promise.all(l),Promise.all(c)]).then((function(e){const t=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=[];for(let r=0,c=t.length;r<c;r++){const e=t[r],c=i[r],u=o[r],h=s[r],d=a[r];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const p=n._createAnimationTracks(e,c,u,h,d);if(p)for(let t=0;t<p.length;t++)l.push(p[t])}return new dH.AnimationClip(r,void 0,l)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),r=[],o=n.children||[];for(let a=0,l=o.length;a<l;a++)r.push(t.getDependency("node",o[a]));const s=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(r),s]).then((function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,AW)}));for(let r=0,o=n.length;r<o;r++)t.add(n[r]);return t}))}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"",s=[],a=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return a&&s.push(a),void 0!==r.camera&&s.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){s.push(e)})),this.nodeCache[e]=Promise.all(s).then((function(t){let s;if(s=!0===r.isBone?new dH.Bone:t.length>1?new dH.Group:1===t.length?t[0]:new dH.Object3D,s!==t[0])for(let e=0,n=t.length;e<n;e++)s.add(t[e]);if(r.name&&(s.userData.name=r.name,s.name=o),fW(s,r),r.extensions&&pW(n,s,r),void 0!==r.matrix){const e=new dH.Matrix4;e.fromArray(r.matrix),s.applyMatrix4(e)}else void 0!==r.translation&&s.position.fromArray(r.translation),void 0!==r.rotation&&s.quaternion.fromArray(r.rotation),void 0!==r.scale&&s.scale.fromArray(r.scale);return i.associations.has(s)||i.associations.set(s,{}),i.associations.get(s).nodes=e,s})),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,r=new dH.Group;n.name&&(r.name=i.createUniqueName(n.name)),fW(r,n),n.extensions&&pW(t,r,n);const o=n.nodes||[],s=[];for(let a=0,l=o.length;a<l;a++)s.push(i.getDependency("node",o[a]));return Promise.all(s).then((function(e){for(let t=0,n=e.length;t<n;t++)r.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[n,r]of i.associations)(n instanceof dH.Material||n instanceof dH.Texture)&&t.set(n,r);return e.traverse((e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)})),t})(r),r}))}_createAnimationTracks(e,t,n,i,r){const o=[],s=e.name?e.name:e.uuid,a=[];let l;switch(uW[r.path]===uW.weights?e.traverse((function(e){e.morphTargetInfluences&&a.push(e.name?e.name:e.uuid)})):a.push(s),uW[r.path]){case uW.weights:l=dH.NumberKeyframeTrack;break;case uW.rotation:l=dH.QuaternionKeyframeTrack;break;case uW.position:case uW.scale:l=dH.VectorKeyframeTrack;break;default:l=1===n.itemSize?dH.NumberKeyframeTrack:dH.VectorKeyframeTrack}const c=void 0!==i.interpolation?hW[i.interpolation]:dH.InterpolateLinear,u=this._getArrayFromAccessor(n);for(let h=0,d=a.length;h<d;h++){const e=new l(a[h]+"."+uW[r.path],t.array,u,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),o.push(e)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=yW(t.constructor),n=new Float32Array(t.length);for(let i=0,r=t.length;i<r;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof dH.QuaternionKeyframeTrack?iW:tW)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function bW(e,t,n){const i=t.attributes,r=[];function o(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const s in i){const t=cW[s]||s.toLowerCase();t in e.attributes||r.push(o(i[s],t))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(i)}return dH.ColorManagement.workingColorSpace!==dH.LinearSRGBColorSpace&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${dH.ColorManagement.workingColorSpace}" not supported.`),fW(e,t),function(e,t,n){const i=t.attributes,r=new dH.Box3;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new dH.Vector3(t[0],t[1],t[2]),new dH.Vector3(o[0],o[1],o[2])),e.normalized){const t=yW(oW[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new dH.Vector3,t=new dH.Vector3;for(let i=0,r=o.length;i<r;i++){const r=o[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],o=i.min,s=i.max;if(void 0!==o&&void 0!==s){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),i.normalized){const e=yW(oW[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;const s=new dH.Sphere;r.getCenter(s.center),s.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=s}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1,o=!1;for(let c=0,u=t.length;c<u;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(r=!0),void 0!==e.COLOR_0&&(o=!0),i&&r&&o)break}if(!i&&!r&&!o)return Promise.resolve(e);const s=[],a=[],l=[];for(let c=0,u=t.length;c<u;c++){const u=t[c];if(i){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;s.push(t)}if(r){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;a.push(t)}if(o){const t=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(l)]).then((function(t){const n=t[0],s=t[1],a=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=s),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}class _W{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((n=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const wW=9,EW=15,SW=16,CW=22,MW=37,TW=43,RW=76,IW=83,PW=97,BW=100,LW=103,NW=109,DW=165,kW=166,OW=1000066e3;class UW{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class FW{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}new Uint8Array([0]);const zW=[171,75,84,88,32,50,48,187,13,10,26,10];function jW(e){return(new TextDecoder).decode(e)}var VW=kV(9922).hp;let GW,HW,WW;const QW={env:{emscripten_notify_memory_growth:function(e){WW=new Uint8Array(HW.exports.memory.buffer)}}};class qW{init(){return GW||(GW="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+XW).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,QW))).then(this._init):WebAssembly.instantiate(VW.from(XW,"base64"),QW).then(this._init),GW)}_init(e){HW=e.instance,QW.env.emscripten_notify_memory_growth(0)}decode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!HW)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=HW.exports.malloc(n);WW.set(e,i),t=t||Number(HW.exports.ZSTD_findDecompressedSize(i,n));const r=HW.exports.malloc(t),o=HW.exports.ZSTD_decompress(r,t,i,n),s=WW.slice(r,r+o);return HW.exports.free(i),HW.exports.free(r),s}}const XW="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",$W=(dH.SRGBTransfer,dH.LinearTransfer,dH.LinearTransfer,new WeakMap);let YW,KW=0;class JW extends dH.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new _W,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new dH.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new dH.FileLoader(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then((e=>{let[t,n]=e;const i=JW.BasisWorker.toString(),r=["/* constants */","let _EngineFormat = "+JSON.stringify(JW.EngineFormat),"let _EngineType = "+JSON.stringify(JW.EngineType),"let _TranscoderFormat = "+JSON.stringify(JW.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(JW.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r])),this.transcoderBinary=n,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),KW>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),KW++}return this.transcoderPending}load(e,t,n,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new dH.FileLoader(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.parse(e,t,i)}),n,i)}parse(e,t,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if($W.has(e))return $W.get(e).promise.then(t).catch(n);this._createTexture(e).then((e=>t?t(e):null)).catch(n)}_createTextureFrom(e,t){const{type:n,error:i,data:{faces:r,width:o,height:s,format:a,type:l,dfdFlags:c}}=e;if("error"===n)return Promise.reject(i);let u;if(6===t.faceCount)u=new dH.CompressedCubeTexture(r,a,l);else{const e=r[0].mipmaps;u=t.layerCount>1?new dH.CompressedArrayTexture(e,o,s,t.layerCount,a,l):new dH.CompressedTexture(e,o,s,a,l)}return u.minFilter=1===r[0].mipmaps.length?dH.LinearFilter:dH.LinearMipmapLinearFilter,u.magFilter=dH.LinearFilter,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=nQ(t),u.premultiplyAlpha=!!(1&c),u}async _createTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,zW.length);if(t[0]!==zW[0]||t[1]!==zW[1]||t[2]!==zW[2]||t[3]!==zW[3]||t[4]!==zW[4]||t[5]!==zW[5]||t[6]!==zW[6]||t[7]!==zW[7]||t[8]!==zW[8]||t[9]!==zW[9]||t[10]!==zW[10]||t[11]!==zW[11])throw new Error("Missing KTX 2.0 identifier.");const n=new UW,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new FW(e,zW.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();const o=r._nextUint32();n.supercompressionScheme=r._nextUint32();const s=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),c=r._nextUint32(),u=r._nextUint64(),h=r._nextUint64(),d=new FW(e,zW.length+i,3*o*8,!0);for(let L=0;L<o;L++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const p=new FW(e,s,a,!0),f={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let L=0;L<m;L++){const e={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=p._nextInt32(),e.sampleUpper=p._nextInt32()):(e.sampleLower=p._nextUint32(),e.sampleUpper=p._nextUint32()),f.samples[L]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(f);const g=new FW(e,l,c,!0);for(;g._offset<c;){const e=g._nextUint32(),t=g._scan(e),i=jW(t);if(n.keyValue[i]=g._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){const e=jW(n.keyValue[i]);n.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}g._skip(e%4?4-e%4:0)}if(h<=0)return n;const v=new FW(e,u,h,!0),y=v._nextUint16(),A=v._nextUint16(),x=v._nextUint32(),b=v._nextUint32(),_=v._nextUint32(),w=v._nextUint32(),E=[];for(let L=0;L<o;L++)E.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});const S=u+v._offset,C=S+x,M=C+b,T=M+_,R=new Uint8Array(e.buffer,e.byteOffset+S,x),I=new Uint8Array(e.buffer,e.byteOffset+C,b),P=new Uint8Array(e.buffer,e.byteOffset+M,_),B=new Uint8Array(e.buffer,e.byteOffset+T,w);return n.globalData={endpointCount:y,selectorCount:A,imageDescs:E,endpointsData:R,selectorsData:I,tablesData:P,extendedData:B},n}(new Uint8Array(e)),i=n.vkFormat===OW&&167===n.dataFormatDescriptor[0].colorModel;if(0!==n.vkFormat&&(!i||this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===eQ[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;2===e.supercompressionScheme&&(YW||(YW=new Promise((async e=>{const t=new qW;await t.init(),e(t)}))),n=await YW);const i=[];for(let o=0;o<e.levels.length;o++){const r=Math.max(1,e.pixelWidth>>o),s=Math.max(1,e.pixelHeight>>o),a=e.pixelDepth?Math.max(1,e.pixelDepth>>o):0,l=e.levels[o];let c,u;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=n.decode(l.levelData,l.uncompressedByteLength)}u=tQ[t]===dH.FloatType?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):tQ[t]===dH.HalfFloatType?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,i.push({data:u,width:r,height:s,depth:a})}let r;if(ZW.has(eQ[t]))r=0===e.pixelDepth?new dH.DataTexture(i[0].data,e.pixelWidth,e.pixelHeight):new dH.Data3DTexture(i[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new dH.CompressedTexture(i,e.pixelWidth,e.pixelHeight),r.minFilter=1===i.length?dH.LinearFilter:dH.LinearMipmapLinearFilter,r.magFilter=dH.LinearFilter}return r.mipmaps=i,r.type=tQ[t],r.format=eQ[t],r.colorSpace=nQ(e),r.needsUpdate=!0,Promise.resolve(r)}(n);const r=t,o=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e]))).then((e=>this._createTextureFrom(e.data,n)));return $W.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),KW--,this}}JW.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},JW.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},JW.EngineFormat={RGBAFormat:dH.RGBAFormat,RGBA_ASTC_4x4_Format:dH.RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:dH.RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:dH.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:dH.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:dH.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:dH.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:dH.RGB_ETC1_Format,RGB_ETC2_Format:dH.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:dH.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:dH.RGBA_S3TC_DXT1_Format},JW.EngineType={UnsignedByteType:dH.UnsignedByteType,HalfFloatType:dH.HalfFloatType,FloatType:dH.FloatType},JW.BasisWorker=function(){let e,t,n;const i=_EngineFormat,r=_EngineType,o=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",(function(i){const o=i.data;switch(o.type){case"init":e=o.config,a=o.transcoderBinary,t=new Promise((e=>{n={wasmBinary:a,onRuntimeInitialized:e},BASIS(n)})).then((()=>{n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:i,width:a,height:h,hasAlpha:d,format:p,type:f,dfdFlags:m}=function(t){const i=new n.KTX2File(new Uint8Array(t));function o(){i.close(),i.delete()}if(!i.isValid())throw o(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let a;if(i.isUASTC())a=s.UASTC;else if(i.isETC1S())a=s.ETC1S;else{if(!i.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");a=s.UASTC_HDR}const h=i.getWidth(),d=i.getHeight(),p=i.getLayers()||1,f=i.getLevels(),m=i.getFaces(),g=i.getHasAlpha(),v=i.getDFDFlags(),{transcoderFormat:y,engineFormat:A,engineType:x}=function(t,n,i,r){const o=l[t];for(let s=0;s<o.length;s++){const a=o[s];if((!a.if||e[a.if])&&a.basisFormat.includes(t)&&!(r&&a.transcoderFormat.length<2)&&(!a.needsPowerOfTwo||c(n)&&c(i)))return{transcoderFormat:a.transcoderFormat[r?1:0],engineFormat:a.engineFormat[r?1:0],engineType:a.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(a,h,d,g);if(!h||!d||!f)throw o(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!i.startTranscoding())throw o(),new Error("THREE.KTX2Loader: .startTranscoding failed");const b=[],_=[];for(let e=0;e<m;e++){const t=[];for(let n=0;n<f;n++){const s=[];let a,l;for(let t=0;t<p;t++){const c=i.getImageLevelInfo(n,t,e);0!==e||0!==n||0!==t||c.origWidth%4==0&&c.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),f>1?(a=c.origWidth,l=c.origHeight):(a=c.width,l=c.height);let u=new Uint8Array(i.getImageTranscodedSizeInBytes(n,t,0,y));const h=i.transcodeImage(u,n,t,e,y,0,-1,-1);if(x===r.HalfFloatType&&(u=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!h)throw o(),new Error("THREE.KTX2Loader: .transcodeImage failed.");s.push(u)}const c=u(s);t.push({data:c,width:a,height:l}),_.push(c.buffer)}b.push({mipmaps:t,width:h,height:d,format:A,type:x})}return o(),{faces:b,buffers:_,width:h,height:d,hasAlpha:g,dfdFlags:v,format:A,type:x}}(o.buffer);self.postMessage({type:"transcode",id:o.id,data:{faces:t,width:a,height:h,hasAlpha:d,format:p,type:f,dfdFlags:m}},i)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}}))}var a}));const a=[{if:"astcSupported",basisFormat:[s.UASTC],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[r.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[r.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[o.BC1,o.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[r.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[r.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[o.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[r.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[r.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[s.UASTC_HDR],transcoderFormat:[o.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[r.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[s.ETC1S,s.UASTC],transcoderFormat:[o.RGBA32,o.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[r.UnsignedByteType,r.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[s.UASTC_HDR],transcoderFormat:[o.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[r.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[s.ETC1S]:a.filter((e=>e.basisFormat.includes(s.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[s.UASTC]:a.filter((e=>e.basisFormat.includes(s.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[s.UASTC_HDR]:a.filter((e=>e.basisFormat.includes(s.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function c(e){return e<=2||!(e&e-1)&&0!==e}function u(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;const n=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];n.set(t,i),i+=t.byteLength}return n}};const ZW=new Set([dH.RGBAFormat,dH.RGFormat,dH.RedFormat]),eQ={[NW]:dH.RGBAFormat,[PW]:dH.RGBAFormat,[MW]:dH.RGBAFormat,[TW]:dH.RGBAFormat,[LW]:dH.RGFormat,[IW]:dH.RGFormat,[SW]:dH.RGFormat,[CW]:dH.RGFormat,[BW]:dH.RedFormat,[RW]:dH.RedFormat,[EW]:dH.RedFormat,[wW]:dH.RedFormat,[OW]:dH.RGBA_ASTC_4x4_Format,[kW]:dH.RGBA_ASTC_6x6_Format,[DW]:dH.RGBA_ASTC_6x6_Format},tQ={[NW]:dH.FloatType,[PW]:dH.HalfFloatType,[MW]:dH.UnsignedByteType,[TW]:dH.UnsignedByteType,[LW]:dH.FloatType,[IW]:dH.HalfFloatType,[SW]:dH.UnsignedByteType,[CW]:dH.UnsignedByteType,[BW]:dH.FloatType,[RW]:dH.HalfFloatType,[EW]:dH.UnsignedByteType,[wW]:dH.UnsignedByteType,[OW]:dH.HalfFloatType,[kW]:dH.UnsignedByteType,[DW]:dH.UnsignedByteType};function nQ(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?dH.SRGBColorSpace:dH.LinearSRGBColorSpace:10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),dH.NoColorSpace)}const iQ={c:null,u:[new dH.Vector3,new dH.Vector3,new dH.Vector3],e:[]},rQ={c:null,u:[new dH.Vector3,new dH.Vector3,new dH.Vector3],e:[]},oQ=[[],[],[]],sQ=[[],[],[]],aQ=[],lQ=new dH.Vector3,cQ=new dH.Vector3,uQ=new dH.Vector3,hQ=new dH.Vector3,dQ=new dH.Vector3,pQ=new dH.Vector3,fQ=new dH.Matrix3,mQ=new dH.Box3,gQ=new dH.Matrix4,vQ=new dH.Matrix4,yQ=new dH.Ray;class AQ{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dH.Vector3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dH.Vector3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new dH.Matrix3;this.center=e,this.halfSize=t,this.rotation=n}set(e,t,n){return this.center=e,this.halfSize=t,this.rotation=n,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return(new this.constructor).copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){const n=this.halfSize;hQ.subVectors(e,this.center),this.rotation.extractBasis(lQ,cQ,uQ),t.copy(this.center);const i=dH.MathUtils.clamp(hQ.dot(lQ),-n.x,n.x);t.add(lQ.multiplyScalar(i));const r=dH.MathUtils.clamp(hQ.dot(cQ),-n.y,n.y);t.add(cQ.multiplyScalar(r));const o=dH.MathUtils.clamp(hQ.dot(uQ),-n.z,n.z);return t.add(uQ.multiplyScalar(o)),t}containsPoint(e){return hQ.subVectors(e,this.center),this.rotation.extractBasis(lQ,cQ,uQ),Math.abs(hQ.dot(lQ))<=this.halfSize.x&&Math.abs(hQ.dot(cQ))<=this.halfSize.y&&Math.abs(hQ.dot(uQ))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(xQ.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,pQ),pQ.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e){let t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;iQ.c=this.center,iQ.e[0]=this.halfSize.x,iQ.e[1]=this.halfSize.y,iQ.e[2]=this.halfSize.z,this.rotation.extractBasis(iQ.u[0],iQ.u[1],iQ.u[2]),rQ.c=e.center,rQ.e[0]=e.halfSize.x,rQ.e[1]=e.halfSize.y,rQ.e[2]=e.halfSize.z,e.rotation.extractBasis(rQ.u[0],rQ.u[1],rQ.u[2]);for(let r=0;r<3;r++)for(let e=0;e<3;e++)oQ[r][e]=iQ.u[r].dot(rQ.u[e]);hQ.subVectors(rQ.c,iQ.c),aQ[0]=hQ.dot(iQ.u[0]),aQ[1]=hQ.dot(iQ.u[1]),aQ[2]=hQ.dot(iQ.u[2]);for(let r=0;r<3;r++)for(let e=0;e<3;e++)sQ[r][e]=Math.abs(oQ[r][e])+i;for(let r=0;r<3;r++)if(t=iQ.e[r],n=rQ.e[0]*sQ[r][0]+rQ.e[1]*sQ[r][1]+rQ.e[2]*sQ[r][2],Math.abs(aQ[r])>t+n)return!1;for(let r=0;r<3;r++)if(t=iQ.e[0]*sQ[0][r]+iQ.e[1]*sQ[1][r]+iQ.e[2]*sQ[2][r],n=rQ.e[r],Math.abs(aQ[0]*oQ[0][r]+aQ[1]*oQ[1][r]+aQ[2]*oQ[2][r])>t+n)return!1;return t=iQ.e[1]*sQ[2][0]+iQ.e[2]*sQ[1][0],n=rQ.e[1]*sQ[0][2]+rQ.e[2]*sQ[0][1],!(Math.abs(aQ[2]*oQ[1][0]-aQ[1]*oQ[2][0])>t+n||(t=iQ.e[1]*sQ[2][1]+iQ.e[2]*sQ[1][1],n=rQ.e[0]*sQ[0][2]+rQ.e[2]*sQ[0][0],Math.abs(aQ[2]*oQ[1][1]-aQ[1]*oQ[2][1])>t+n||(t=iQ.e[1]*sQ[2][2]+iQ.e[2]*sQ[1][2],n=rQ.e[0]*sQ[0][1]+rQ.e[1]*sQ[0][0],Math.abs(aQ[2]*oQ[1][2]-aQ[1]*oQ[2][2])>t+n||(t=iQ.e[0]*sQ[2][0]+iQ.e[2]*sQ[0][0],n=rQ.e[1]*sQ[1][2]+rQ.e[2]*sQ[1][1],Math.abs(aQ[0]*oQ[2][0]-aQ[2]*oQ[0][0])>t+n||(t=iQ.e[0]*sQ[2][1]+iQ.e[2]*sQ[0][1],n=rQ.e[0]*sQ[1][2]+rQ.e[2]*sQ[1][0],Math.abs(aQ[0]*oQ[2][1]-aQ[2]*oQ[0][1])>t+n||(t=iQ.e[0]*sQ[2][2]+iQ.e[2]*sQ[0][2],n=rQ.e[0]*sQ[1][1]+rQ.e[1]*sQ[1][0],Math.abs(aQ[0]*oQ[2][2]-aQ[2]*oQ[0][2])>t+n||(t=iQ.e[0]*sQ[1][0]+iQ.e[1]*sQ[0][0],n=rQ.e[1]*sQ[2][2]+rQ.e[2]*sQ[2][1],Math.abs(aQ[1]*oQ[0][0]-aQ[0]*oQ[1][0])>t+n||(t=iQ.e[0]*sQ[1][1]+iQ.e[1]*sQ[0][1],n=rQ.e[0]*sQ[2][2]+rQ.e[2]*sQ[2][0],Math.abs(aQ[1]*oQ[0][1]-aQ[0]*oQ[1][1])>t+n||(t=iQ.e[0]*sQ[1][2]+iQ.e[1]*sQ[0][2],n=rQ.e[0]*sQ[2][1]+rQ.e[1]*sQ[2][0],Math.abs(aQ[1]*oQ[0][2]-aQ[0]*oQ[1][2])>t+n)))))))))}intersectsPlane(e){this.rotation.extractBasis(lQ,cQ,uQ);const t=this.halfSize.x*Math.abs(e.normal.dot(lQ))+this.halfSize.y*Math.abs(e.normal.dot(cQ))+this.halfSize.z*Math.abs(e.normal.dot(uQ)),n=e.normal.dot(this.center)-e.constant;return Math.abs(n)<=t}intersectRay(e,t){return this.getSize(dQ),mQ.setFromCenterAndSize(hQ.set(0,0,0),dQ),gQ.setFromMatrix3(this.rotation),gQ.setPosition(this.center),vQ.copy(gQ).invert(),yQ.copy(e).applyMatrix4(vQ),yQ.intersectBox(mQ,t)?t.applyMatrix4(gQ):null}intersectsRay(e){return null!==this.intersectRay(e,hQ)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){const t=e.elements;let n=hQ.set(t[0],t[1],t[2]).length();const i=hQ.set(t[4],t[5],t[6]).length(),r=hQ.set(t[8],t[9],t[10]).length();e.determinant()<0&&(n=-n),fQ.setFromMatrix4(e);const o=1/n,s=1/i,a=1/r;return fQ.elements[0]*=o,fQ.elements[1]*=o,fQ.elements[2]*=o,fQ.elements[3]*=s,fQ.elements[4]*=s,fQ.elements[5]*=s,fQ.elements[6]*=a,fQ.elements[7]*=a,fQ.elements[8]*=a,this.rotation.multiply(fQ),this.halfSize.x*=n,this.halfSize.y*=i,this.halfSize.z*=r,hQ.setFromMatrixPosition(e),this.center.add(hQ),this}}const xQ=new AQ,bQ=/^[og]\s*(.+)?/,_Q=/^mtllib /,wQ=/^usemtl /,EQ=/^usemap /,SQ=/\s+/,CQ=new dH.Vector3,MQ=new dH.Vector3,TQ=new dH.Vector3,RQ=new dH.Vector3,IQ=new dH.Vector3,PQ=new dH.Color;function BQ(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){const i=this.vertices,r=this.object.geometry.normals;CQ.fromArray(i,e),MQ.fromArray(i,t),TQ.fromArray(i,n),IQ.subVectors(TQ,MQ),RQ.subVectors(CQ,MQ),IQ.cross(RQ),IQ.normalize(),r.push(IQ.x,IQ.y,IQ.z),r.push(IQ.x,IQ.y,IQ.z),r.push(IQ.x,IQ.y,IQ.z)},addColor:function(e,t,n){const i=this.colors,r=this.object.geometry.colors;void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[n]&&r.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[n+0],i[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,r,o,s,a,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==s&&""!==s){const e=this.normals.length;u=this.parseNormalIndex(s,e),h=this.parseNormalIndex(a,e),d=this.parseNormalIndex(l,e),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==i&&""!==i){const e=this.uvs.length;u=this.parseUVIndex(i,e),h=this.parseUVIndex(r,e),d=this.parseUVIndex(o,e),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,i=e.length;n<i;n++){const i=this.parseVertexIndex(e[n],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return e.startObject("",!1),e}class LQ extends dH.Loader{constructor(e){super(e),this.materials=null}load(e,t,n,i){const r=this,o=new dH.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(r.parse(n))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}setMaterials(e){return this.materials=e,this}parse(e){const t=new BQ;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const n=e.split("\n");let i=[];for(let o=0,s=n.length;o<s;o++){const e=n[o].trimStart();if(0===e.length)continue;const r=e.charAt(0);if("#"!==r)if("v"===r){const n=e.split(SQ);switch(n[0]){case"v":t.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),n.length>=7?(PQ.setRGB(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6]),dH.SRGBColorSpace),t.colors.push(PQ.r,PQ.g,PQ.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"vt":t.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}}else if("f"===r){const n=e.slice(1).trim().split(SQ),i=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.length>0){const e=t.split("/");i.push(e)}}const r=i[0];for(let e=1,o=i.length-1;e<o;e++){const n=i[e],o=i[e+1];t.addFace(r[0],n[0],o[0],r[1],n[1],o[1],r[2],n[2],o[2])}}else if("l"===r){const n=e.substring(1).trim().split(" ");let i=[];const r=[];if(-1===e.indexOf("/"))i=n;else for(let e=0,t=n.length;e<t;e++){const t=n[e].split("/");""!==t[0]&&i.push(t[0]),""!==t[1]&&r.push(t[1])}t.addLineGeometry(i,r)}else if("p"===r){const n=e.slice(1).trim().split(" ");t.addPointGeometry(n)}else if(null!==(i=bQ.exec(e))){const e=(" "+i[0].slice(1).trim()).slice(1);t.startObject(e)}else if(wQ.test(e))t.object.startMaterial(e.substring(7).trim(),t.materialLibraries);else if(_Q.test(e))t.materialLibraries.push(e.substring(7).trim());else if(EQ.test(e))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===r){if(i=e.split(" "),i.length>1){const e=i[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const n=t.object.currentMaterial();n&&(n.smooth=t.object.smooth)}else{if("\0"===e)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+e+'"')}}t.finalize();const r=new dH.Group;if(r.materialLibraries=[].concat(t.materialLibraries),1==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let o=0,s=t.objects.length;o<s;o++){const e=t.objects[o],n=e.geometry,i=e.materials,s="Line"===n.type,a="Points"===n.type;let l=!1;if(0===n.vertices.length)continue;const c=new dH.BufferGeometry;c.setAttribute("position",new dH.Float32BufferAttribute(n.vertices,3)),n.normals.length>0&&c.setAttribute("normal",new dH.Float32BufferAttribute(n.normals,3)),n.colors.length>0&&(l=!0,c.setAttribute("color",new dH.Float32BufferAttribute(n.colors,3))),!0===n.hasUVIndices&&c.setAttribute("uv",new dH.Float32BufferAttribute(n.uvs,2));const u=[];for(let r=0,o=i.length;r<o;r++){const e=i[r],n=e.name+"_"+e.smooth+"_"+l;let o=t.materials[n];if(null!==this.materials)if(o=this.materials.create(e.name),!s||!o||o instanceof dH.LineBasicMaterial){if(a&&o&&!(o instanceof dH.PointsMaterial)){const e=new dH.PointsMaterial({size:10,sizeAttenuation:!1});dH.Material.prototype.copy.call(e,o),e.color.copy(o.color),e.map=o.map,o=e}}else{const e=new dH.LineBasicMaterial;dH.Material.prototype.copy.call(e,o),e.color.copy(o.color),o=e}void 0===o&&(o=s?new dH.LineBasicMaterial:a?new dH.PointsMaterial({size:1,sizeAttenuation:!1}):new dH.MeshPhongMaterial,o.name=e.name,o.flatShading=!e.smooth,o.vertexColors=l,t.materials[n]=o),u.push(o)}let h;if(u.length>1){for(let e=0,t=i.length;e<t;e++){const t=i[e];c.addGroup(t.groupStart,t.groupCount,e)}h=s?new dH.LineSegments(c,u):a?new dH.Points(c,u):new dH.Mesh(c,u)}else h=s?new dH.LineSegments(c,u[0]):a?new dH.Points(c,u[0]):new dH.Mesh(c,u[0]);h.name=e.name,r.add(h)}else if(t.vertices.length>0){const e=new dH.PointsMaterial({size:1,sizeAttenuation:!1}),n=new dH.BufferGeometry;n.setAttribute("position",new dH.Float32BufferAttribute(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(n.setAttribute("color",new dH.Float32BufferAttribute(t.colors,3)),e.vertexColors=!0);const i=new dH.Points(n,e);r.add(i)}return r}}class NQ extends dH.Loader{constructor(e){super(e)}load(e,t,n,i){const r=this,o=""===this.path?dH.LoaderUtils.extractUrlBase(e):this.path,s=new dH.FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(r.parse(n,o))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split("\n");let i={};const r=/\s+/,o={};for(let a=0;a<n.length;a++){let e=n[a];if(e=e.trim(),0===e.length||"#"===e.charAt(0))continue;const t=e.indexOf(" ");let s=t>=0?e.substring(0,t):e;s=s.toLowerCase();let l=t>=0?e.substring(t+1):"";if(l=l.trim(),"newmtl"===s)i={name:l},o[l]=i;else if("ka"===s||"kd"===s||"ks"===s||"ke"===s){const e=l.split(r,3);i[s]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[s]=l}const s=new DQ(this.resourcePath||t,this.materialOptions);return s.setCrossOrigin(this.crossOrigin),s.setManager(this.manager),s.setMaterials(o),s}}class DQ{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:dH.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:dH.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const i=e[n],r={};t[n]=r;for(const e in i){let t=!0,n=i[e];const o=e.toLowerCase();switch(o){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(t=!1)}t&&(r[o]=n)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],i={name:e,side:this.side};function r(e,n){if(i[e])return;const r=t.getTextureParams(n,i),o=t.loadTexture((s=t.baseUrl,"string"!=typeof(a=r.url)||""===a?"":/^https?:\/\//i.test(a)?a:s+a));var s,a;o.repeat.copy(r.scale),o.offset.copy(r.offset),o.wrapS=t.wrap,o.wrapT=t.wrap,"map"!==e&&"emissiveMap"!==e||(o.colorSpace=dH.SRGBColorSpace),i[e]=o}for(const o in n){const e=n[o];let t;if(""!==e)switch(o.toLowerCase()){case"kd":i.color=dH.ColorManagement.toWorkingColorSpace((new dH.Color).fromArray(e),dH.SRGBColorSpace);break;case"ks":i.specular=dH.ColorManagement.toWorkingColorSpace((new dH.Color).fromArray(e),dH.SRGBColorSpace);break;case"ke":i.emissive=dH.ColorManagement.toWorkingColorSpace((new dH.Color).fromArray(e),dH.SRGBColorSpace);break;case"map_kd":r("map",e);break;case"map_ks":r("specularMap",e);break;case"map_ke":r("emissiveMap",e);break;case"norm":r("normalMap",e);break;case"map_bump":case"bump":r("bumpMap",e);break;case"map_d":r("alphaMap",e),i.transparent=!0;break;case"ns":i.shininess=parseFloat(e);break;case"d":t=parseFloat(e),t<1&&(i.opacity=t,i.transparent=!0);break;case"tr":t=parseFloat(e),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(i.opacity=1-t,i.transparent=!0)}}return this.materials[e]=new dH.MeshPhongMaterial(i),this.materials[e]}getTextureParams(e,t){const n={scale:new dH.Vector2(1,1),offset:new dH.Vector2(0,0)},i=e.split(/\s+/);let r;return r=i.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),r=i.indexOf("-s"),r>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),r=i.indexOf("-o"),r>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n}loadTexture(e,t,n,i,r){const o=void 0!==this.manager?this.manager:dH.DefaultLoadingManager;let s=o.getHandler(e);null===s&&(s=new dH.TextureLoader(o)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin);const a=s.load(e,n,i,r);return void 0!==t&&(a.mapping=t),a}}class kQ{static fromCubeTexture(e){let t=0;const n=new dH.Vector3,i=new dH.Vector3,r=new dH.Color,o=[0,0,0,0,0,0,0,0,0],s=new dH.SphericalHarmonics3,a=s.coefficients;for(let c=0;c<6;c++){const s=e.image[c],l=s.width,u=s.height,h=document.createElement("canvas");h.width=l,h.height=u;const d=h.getContext("2d");d.drawImage(s,0,0,l,u);const p=d.getImageData(0,0,l,u),f=p.data,m=p.width,g=2/m;for(let v=0,y=f.length;v<y;v+=4){r.setRGB(f[v]/255,f[v+1]/255,f[v+2]/255),OQ(r,e.colorSpace);const s=v/4,l=(s%m+.5)*g-1,u=1-(Math.floor(s/m)+.5)*g;switch(c){case 0:n.set(-1,u,-l);break;case 1:n.set(1,u,l);break;case 2:n.set(-l,1,-u);break;case 3:n.set(-l,-1,u);break;case 4:n.set(-l,u,1);break;case 5:n.set(l,u,-1)}const h=n.lengthSq(),d=4/(Math.sqrt(h)*h);t+=d,i.copy(n).normalize(),dH.SphericalHarmonics3.getBasisAt(i,o);for(let e=0;e<9;e++)a[e].x+=o[e]*r.r*d,a[e].y+=o[e]*r.g*d,a[e].z+=o[e]*r.b*d}}const l=4*Math.PI/t;for(let c=0;c<9;c++)a[c].x*=l,a[c].y*=l,a[c].z*=l;return new dH.LightProbe(s)}static async fromCubeRenderTarget(e,t){const n=e.coordinateSystem===dH.WebGLCoordinateSystem?-1:1;let i=0;const r=new dH.Vector3,o=new dH.Vector3,s=new dH.Color,a=[0,0,0,0,0,0,0,0,0],l=new dH.SphericalHarmonics3,c=l.coefficients,u=t.texture.type,h=t.width;let d;e.isWebGLRenderer&&(d=u===dH.HalfFloatType?new Uint16Array(h*h*4):new Uint8Array(h*h*4));for(let f=0;f<6;f++){e.isWebGLRenderer?await e.readRenderTargetPixelsAsync(t,0,0,h,h,d,f):d=await e.readRenderTargetPixelsAsync(t,0,0,h,h,0,f);const l=2/h;for(let e=0,p=d.length;e<p;e+=4){let p,m,g;u===dH.HalfFloatType?(p=dH.DataUtils.fromHalfFloat(d[e]),m=dH.DataUtils.fromHalfFloat(d[e+1]),g=dH.DataUtils.fromHalfFloat(d[e+2])):(p=d[e]/255,m=d[e+1]/255,g=d[e+2]/255),s.setRGB(p,m,g),OQ(s,t.texture.colorSpace);const v=e/4,y=(1-(v%h+.5)*l)*n,A=1-(Math.floor(v/h)+.5)*l;switch(f){case 0:r.set(-1*n,A,y*n);break;case 1:r.set(1*n,A,-y*n);break;case 2:r.set(y,1,-A);break;case 3:r.set(y,-1,A);break;case 4:r.set(y,A,1);break;case 5:r.set(-y,A,-1)}const x=r.lengthSq(),b=4/(Math.sqrt(x)*x);i+=b,o.copy(r).normalize(),dH.SphericalHarmonics3.getBasisAt(o,a);for(let e=0;e<9;e++)c[e].x+=a[e]*s.r*b,c[e].y+=a[e]*s.g*b,c[e].z+=a[e]*s.b*b}}const p=4*Math.PI/i;for(let f=0;f<9;f++)c[f].x*=p,c[f].y*=p,c[f].z*=p;return new dH.LightProbe(l)}}function OQ(e,t){switch(t){case dH.SRGBColorSpace:e.convertSRGBToLinear();break;case dH.LinearSRGBColorSpace:case dH.NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.")}return e}var UQ=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var n,i,r,o,s=function(e){t.deviceOrientation=e},a=function(){t.screenOrientation=window.orientation||0},l=(n=new THREE.Vector3(0,0,1),i=new THREE.Euler,r=new THREE.Quaternion,o=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,s,a,l){i.set(s,t,-a,"YXZ"),e.setFromEuler(i),e.multiply(o),e.multiply(r.setFromAxisAngle(n,-l))});this.connect=function(){a(),window.addEventListener("orientationchange",a,!1),window.addEventListener("deviceorientation",s,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",a,!1),window.removeEventListener("deviceorientation",s,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var n=e.alpha?THREE.MathUtils.degToRad(e.alpha)+t.alphaOffset:0,i=e.beta?THREE.MathUtils.degToRad(e.beta):0,r=e.gamma?THREE.MathUtils.degToRad(e.gamma):0,o=t.screenOrientation?THREE.MathUtils.degToRad(t.screenOrientation):0;l(t.object.quaternion,n,i,r,o)}}},this.dispose=function(){t.disconnect()},this.connect()},FQ=globalThis.THREE={...dH};FQ.DRACOLoader=fH,FQ.GLTFLoader=RH,FQ.KTX2Loader=JW,FQ.OBJLoader=LQ,FQ.MTLLoader=NQ,FQ.OBB=AQ,FQ.BufferGeometryUtils=UV,FQ.LightProbeGenerator=kQ,FQ.DeviceOrientationControls=UQ,FQ.Cache.enabled=!0;const zQ=FQ;var jQ=window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",VQ="aframe-injected",GQ=kV(8878),HQ=kV.n(GQ),WQ={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};HQ().formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" "),this.useColors){var t;this.color=(t=function(e){var t=e.split(":");return t[t.length-1]}(this.namespace),WQ.colors&&WQ.colors[t]||null);var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(r=i))})),e.splice(r,0,n)}};var QQ=function(){try{return window.localStorage}catch(Jbe){}}();QQ&&(parseInt(QQ.logs,10)||"true"===QQ.logs)?HQ().enable("*"):HQ().enable("*:error,*:info,*:warn");const qQ=HQ();var XQ=kV(1124),$Q=kV.n(XQ),YQ=qQ("device:error"),KQ=!1,JQ=!1,ZQ=void 0!==navigator.xr;if(ZQ){var eq=function(){var e=document.querySelector("a-scene");e?e.hasLoaded?e.components["xr-mode-ui"].updateEnterInterfaces():e.addEventListener("loaded",eq):window.addEventListener("DOMContentLoaded",eq)},tq=function(e){YQ("WebXR session support error: "+e.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then((function(e){KQ=e,eq()})).catch(tq),navigator.xr.isSessionSupported("immersive-ar").then((function(e){JQ=e,eq()})).catch((function(){}))):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then((function(){KQ=!0,eq()})).catch(tq),navigator.xr.supportsSession("immersive-ar").then((function(){JQ=!0,eq()})).catch((function(){}))):YQ("WebXR has neither isSessionSupported or supportsSession?!")}function nq(){return KQ||JQ}function iq(){return JQ}function rq(){return KQ}var oq,sq,aq=(oq=!1,sq=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(sq)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(sq.substr(0,4)))&&(oq=!0),(hq()||lq()||gq())&&(oq=!0),mq()&&(oq=!1),function(){return oq});function lq(e){var t=e||window.navigator.userAgent;return/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(t)||cq()}function cq(e,t,n){var i=e||window.navigator.userAgent,r=t||window.navigator.platform,o=n||window.navigator.maxTouchPoints||0;return("iPad"===r||"MacIntel"===r)&&o>0&&/Macintosh|Intel|iPad|ipad/i.test(i)&&!window.MSStream}function uq(){var e=navigator.userAgent.includes("Macintosh"),t=5===navigator.maxTouchPoints;return e&&t&&ZQ}function hq(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function dq(){return!aq()&&!mq()&&void 0!==window.orientation}function pq(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function fq(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function mq(){return pq()||fq()||uq()}function gq(){return/R7 Build/.test(window.navigator.userAgent)}function vq(){var e=window.orientation;return gq()&&(e+=90),90===e||-90===e}var yq="undefined"==typeof process,Aq=!yq,xq=Object.freeze(Object.create(null));function bq(){return{}}function _q(e){var t=[],n=null;function i(i){var r,o;if((i=void 0===i?t.length:i)>0&&null==n&&(n=0),i>0)for(r=t.length,t.length+=Number(i),o=r;o<t.length;o++)t[o]=e();return t.length}return e=e||bq,{grow:i,pool:t,recycle:function(e){e instanceof Object&&(null!==n&&-1!==n?t[--n]=e:t[t.length]=e)},size:function(){return t.length},use:function(){var e;return null!==n&&n!==t.length||i(t.length||5),e=t[n],t[n++]=xq,wq(e),e}}}function wq(e){var t;if(e&&e.constructor===Object)for(t in e)e[t]=void 0}function Eq(e,t){var n;if(e&&e.constructor===Object)for(n in e)n in t||delete e[n]}var Sq=qQ("utils:coordinates:warn"),Cq=["x","y","z","w"],Mq=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/,Tq=/\s+/g;function Rq(e,t,n){var i,r,o,s,a,l,c,u,h=n&&"object"==typeof n?n:{};if(e&&e instanceof Object)return a=void 0===e.x?t&&t.x:e.x,l=void 0===e.y?t&&t.y:e.y,c=void 0===e.z?t&&t.z:e.z,u=void 0===e.w?t&&t.w:e.w,null!=a&&(h.x=Nq(a)),null!=l&&(h.y=Nq(l)),null!=c&&(h.z=Nq(c)),null!=u&&(h.w=Nq(u)),h;if(null==e)return"object"==typeof t?Object.assign(h,t):t;for(i=e.trim().split(Tq),s=0;s<Cq.length;s++)if(o=Cq[s],i[s])h[o]=parseFloat(i[s],10);else{if(void 0===(r=t&&t[o]))continue;h[o]=Nq(r)}return h}function Iq(e){var t;return"object"!=typeof e?e:(t=e.x+" "+e.y,null!=e.z&&(t+=" "+e.z),null!=e.w&&(t+=" "+e.w),t)}function Pq(e,t){return"object"!=typeof e||"object"!=typeof t?e===t:e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}function Bq(e){return Mq.test(e)}function Lq(e){return Sq("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),Bq(e)}function Nq(e){return null!=e&&e.constructor===String?parseFloat(e,10):e}function Dq(e){return new dH.Vector3(e.x,e.y,e.z)}var kq=function(){var e={};return function(t,n){return n in e||(e[n]={}),t in e[n]||(e[n][t]=t.split(n)),e[n][t]}}();function Oq(e,t){var n=kq(e,t=t||".");return 1===n.length?n[0]:n}function Uq(e,t,n){var i;return n=n||".",-1!==t.indexOf(n)?(i=Oq(t,n)).constructor===String?e.getAttribute(i):e.getAttribute(i[0])[i[1]]:e.getAttribute(t)}function Fq(e,t,n,i){var r;i=i||".",-1===t.indexOf(i)?e.setAttribute(t,n):(r=Oq(t,i)).constructor===String?e.setAttribute(r,n):e.setAttribute(r[0],r[1],n)}function zq(e){var t=e.style.width,n=e.style.height;e.style.width=parseInt(t,10)+1+"px",e.style.height=parseInt(n,10)+1+"px",setTimeout((function(){e.style.width=t,e.style.height=n}),200)}var jq=qQ("utils:src-loader:warn");function Vq(e,t,n){!function(e,t){var n;e.tagName?t("IMG"===e.tagName):((n=new XMLHttpRequest).open("HEAD",e),n.addEventListener("load",(function(i){var r;n.status>=200&&n.status<300?null==(r=n.getResponseHeader("Content-Type"))?Qq(e,t):r.startsWith("image")?t(!0):t(!1):Qq(e,t),n.abort()})),n.send())}(e,(function(i){i?t(e):n(e)}))}function Gq(e,t,n){var i,r,o,s="",a=[];if("string"==typeof e){for(r=0;r<5;r++)s+="(url\\((?:[^\\)]+)\\),\\s*)";function l(e){a.push(e),6===a.length&&t(a)}if(s+="(url\\((?:[^\\)]+)\\)\\s*)",o=e.match(new RegExp(s))){for(r=1;r<7;r++)Vq(Wq(o[r]),l);return}if(!e.startsWith("#"))return void Vq(Wq(e)||e,n)}if(i=e.tagName?e:function(e){try{var t=document.querySelector(e);return t||jq('No element was found matching the selector: "%s"',e),t}catch(t){return void jq('"%s" is not a valid selector',e)}}(e))return"A-CUBEMAP"===i.tagName&&i.srcs?t(i.srcs):"IMG"===i.tagName?n(i):void jq('Selector "%s" does not point to <a-cubemap> or <img>',e)}function Hq(e,t){return Gq(e,t,(function(){jq("Expected cubemap but got image")}))}function Wq(e){var t=e.match(/url\((.+)\)/);if(t)return t[1]}function Qq(e,t){var n=new Image;n.addEventListener("load",(function(){t(!0)})),n.addEventListener("error",(function(){t(!1)})),n.src=e}var qq=qQ("utils:material:warn"),Xq=new Set(["emissiveMap","envMap","map","specularMap"]);function $q(e,t){var n=t.offset||{x:0,y:0},i=t.repeat||{x:1,y:1},r=t.npot||!1,o=t.anisotropy||dH.Texture.DEFAULT_ANISOTROPY,s=e.wrapS,a=e.wrapT,l=e.magFilter,c=e.minFilter;r&&(s=dH.ClampToEdgeWrapping,a=dH.ClampToEdgeWrapping,l=dH.LinearFilter,c=dH.LinearFilter),1===i.x&&1===i.y||(s=dH.RepeatWrapping,a=dH.RepeatWrapping),e.offset.set(n.x,n.y),e.repeat.set(i.x,i.y),e.wrapS===s&&e.wrapT===a&&e.magFilter===l&&e.minFilter===c&&e.anisotropy===o||(e.wrapS=s,e.wrapT=a,e.magFilter=l,e.minFilter=c,e.anisotropy=o,e.needsUpdate=!0)}function Yq(e,t,n,i){var r=n.el,o=n.material,s=r.sceneEl.systems.renderer,a=i[t];if(n.materialSrcs||(n.materialSrcs={}),!a)return delete n.materialSrcs[e],void l(null);function l(t){o[e]!==t&&(o[e]&&o[e].dispose(),o[e]=t,o.needsUpdate=!0,tX(r,t))}a===n.materialSrcs[e]&&o[e]?$q(o[e],i):(n.materialSrcs[e]=a,a instanceof dH.Texture?l(a):r.sceneEl.systems.material.loadTextureSource(a,(function(t){if(n.materialSrcs[e]===a){var r=o[e];!r||null!==t&&nX(r,t)||(r=null),!r&&t&&(r=iX(t)),r&&(r.source!==t&&(r.source=t,r.needsUpdate=!0),Xq.has(e)&&s.applyColorCorrection(r),$q(r,i)),l(r)}})))}function Kq(e,t){return Yq("map","src",e,t)}function Jq(e,t,n){var i=e;"ambientOcclusion"===e&&(i="ao");var r={};return r.src=n[e+"Map"],r.offset=n[e+"TextureOffset"],r.repeat=n[e+"TextureRepeat"],r.wrap=n[e+"TextureWrap"],Yq(i+"Map","src",t,r)}var Zq={};function eX(e,t){var n=e.material,i=e.el,r="envMap",o=t.envMap,s=t.sphericalEnvMap,a=t.refract;if(s&&(o=s,qq("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),e.materialSrcs||(e.materialSrcs={}),!o)return delete e.materialSrcs[r],n.envMap=null,void(n.needsUpdate=!0);function l(t){e.materialSrcs[r]===o&&(n.envMap=t,n.needsUpdate=!0,tX(i,t))}e.materialSrcs[r]=o,Zq[o]?Zq[o].then(l):Zq[o]=new Promise((function(e){Gq(o,(function(t){i.sceneEl.systems.material.loadCubeMapTexture(t,(function(t){t.mapping=a?dH.CubeRefractionMapping:dH.CubeReflectionMapping,l(t),e(t)}))}),(function(t){i.sceneEl.systems.material.loadTexture(t,{src:t},(function(t){t.mapping=a?dH.EquirectangularRefractionMapping:dH.EquirectangularReflectionMapping,l(t),e(t)}))}))}))}function tX(e,t){function n(){e.emit("materialvideoloadeddata",{src:t.image,texture:t})}function i(){e.emit("materialvideoended",{src:t.image,texture:t})}t&&(e.emit("materialtextureloaded",{src:t.image,texture:t}),t.image&&"VIDEO"===t.image.tagName&&(t.image.addEventListener("loadeddata",n),t.image.addEventListener("ended",i),t.addEventListener("dispose",(function(){t.image.removeEventListener("loadeddata",n),t.image.removeEventListener("ended",i)}))))}function nX(e,t){return e.source===t&&(t.data instanceof HTMLCanvasElement?e.isCanvasTexture:t.data instanceof HTMLVideoElement?e.isVideoTexture:e.isTexture&&!e.isCanvasTexture&&!e.isVideoTexture)}function iX(e){var t;return(t=e.data instanceof HTMLCanvasElement?new dH.CanvasTexture:e.data instanceof HTMLVideoElement?new dH.VideoTexture(e.data):new dH.Texture).source=e,t.needsUpdate=!0,t}var rX=/-([a-z])/g;function oX(e,t){var n;return"string"!=typeof e?e:(n=function(e,t){var n,i,r,o,s,a;for(t=t||{},n=uX(e),i=0;i<n.length;i++)(r=n[i])&&(o=r.indexOf(":"),s=r.substr(0,o).trim(),a=r.substr(o+1).trim(),t[aX(s)]=a);return t}(e,t),n[""]?e:n)}function sX(e){return"string"==typeof e?e:function(e){var t,n=0,i=0,r="";for(t in e)n++;for(t in e)r+=t+": "+e[t],i<n-1&&(r+="; "),i++;return r}(e)}function aX(e){return e.replace(rX,hX)}var lX,cX,uX=(lX=[],cX=/url\([^)]+$/,function(e){var t,n="",i=0;for(lX.length=0;i<e.length;)-1===(t=e.indexOf(";",i))&&(t=e.length),n+=e.substring(i,t),cX.test(n)?(n+=";",i=t+1):(lX.push(n.trim()),n="",i=t+1);return lX});function hX(e){return e[1].toUpperCase()}var dX=["x","y","z","w"];function pX(e,t,n){var i,r,o=e.el;if((r=!!(i=fX(e,t,n)))===e.controllerPresent)return r;e.controllerPresent=r,r?(e.addEventListeners(),e.injectTrackedControls(i),o.emit("controllerconnected",{name:e.name,component:e})):(e.removeEventListeners(),o.emit("controllerdisconnected",{name:e.name,component:e}))}function fX(e,t,n){var i,r=e.el.sceneEl,o=r&&r.systems["tracked-controls"];return!!o&&!(!(i=o.controllers)||!i.length)&&mX(i,t,n.hand,n.index,n.iterateControllerProfiles,n.handTracking)}function mX(e,t,n,i,r,o){var s,a,l,c,u=!1;for(s=0;s<e.length;s++){if(c=(l=e[s]).profiles,o)u=l.hand;else if(r)for(a=0;a<c.length&&!(u=c[a].startsWith(t));a++);else u=c.length>0&&c[0].startsWith(t);if(u)if("right"===l.handedness||"left"===l.handedness){if(l.handedness===n)return e[s]}else if(s===i)return e[s]}}function gX(e,t,n){var i,r,o,s,a;for(r in t){for(i=t[r],o=!1,a=0;a<i.length;a++)n.detail.changed[i[a]]&&(o=!0);if(o){for(s={},a=0;a<i.length;a++)s[dX[a]]=n.detail.axis[i[a]];e.el.emit(r+"moved",s)}}}function vX(e,t,n,i){var r=(i?n.mapping[i]:n.mapping).buttons[e];n.el.emit(r+t),n.updateModel&&n.updateModel(r,t)}var yX=qQ("utils:warn");function AX(e){return e.bind.apply(e,Array.prototype.slice.call(arguments,1))}function xX(){return yX("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),nq()}function bX(){return yX("`utils.isIOS` has moved to `utils.device.isIOS`"),hq()}function _X(){return yX("`utils.isMobile has moved to `utils.device.isMobile`"),aq(arguments)}function wX(e,t,n){var i;return n&&(e=e.bind(n)),function(){var n=Date.now();(void 0===i||(void 0===i?t:n-i)>=t)&&(i=n,e.apply(null,arguments))}}function EX(e,t,n){var i,r,o;n&&(e=e.bind(n));var s=function(){i=Date.now(),e.apply(this,o),r=void 0};return function(){var n=Date.now(),a=void 0===i?t:n-i;a>=t?(clearTimeout(r),r=void 0,i=n,e.apply(null,arguments)):(r=r||setTimeout(s,t-a),o=arguments)}}function SX(e,t,n){var i;return n&&(e=e.bind(n)),function(n,r){var o=void 0===i?r:n-i;(void 0===i||o>=t)&&(i=n,e(n,o))}}function CX(e,t,n){var i;return function(){var r=this,o=arguments,s=n&&!i;clearTimeout(i),i=setTimeout((function(){i=null,n||e.apply(r,o)}),t),s&&e.apply(r,o)}}var MX=Object.assign,TX=$Q();function RX(e){return JSON.parse(JSON.stringify(e))}var IX,PX,BX=(IX=_q((function(){return[]})),function(e,t){var n,i,r,o,s,a;if(void 0===e||void 0===t||null===e||null===t||!(e&&t&&e.constructor===Object&&t.constructor===Object||e.constructor===Array&&t.constructor===Array))return e===t;for(n in i=IX.use(),r=IX.use(),i.length=0,r.length=0,e)i.push(n);for(n in t)r.push(n);if(i.length!==r.length)return IX.recycle(i),IX.recycle(r),!1;for(o=0;o<i.length;++o)if(s=e[i[o]],a=t[i[o]],"object"==typeof s||"object"==typeof a||Array.isArray(s)&&Array.isArray(a)){if(s===a)continue;if(!BX(s,a))return IX.recycle(i),IX.recycle(r),!1}else if(s!==a)return IX.recycle(i),IX.recycle(r),!1;return IX.recycle(i),IX.recycle(r),!0}),LX=(PX=[],function(e,t,n){var i,r,o,s,a,l,c;for(a in s=n||{},PX.length=0,e)PX.push(a);if(!t)return s;for(o in t)-1===PX.indexOf(o)&&PX.push(o);for(l=0;l<PX.length;l++)i=e[a=PX[l]],r=t[a],((c=i&&r&&i.constructor===Object&&r.constructor===Object)&&!BX(i,r)||!c&&i!==r)&&(s[a]=r);return s});function NX(e){return!e.metaKey&&document.activeElement===document.body}function DX(e,t){void 0===t&&(t=" ");var n=new RegExp(t,"g");return(e=(e||"").replace(n,t)).split(t)}function kX(e,t){t=t||{};var n={};return Object.keys(t).forEach((function(t){e.hasAttribute(t)&&(n[t]=e.getAttribute(t))})),n}function OX(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function UX(){return window.top!==window.self}function FX(e){for(var t=[],n=e.getElementsByTagName("*"),i=0,r=n.length;i<r;i++)n[i].isScene&&t.push(n[i]);return t}var zX,jX=[GX({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),GX({name:"mobile-web-app-capable",content:"yes"}),GX({name:"theme-color",content:"black"})],VX=[GX({name:"apple-mobile-web-app-capable",content:"yes"}),GX({name:"apple-mobile-web-app-status-bar-style",content:"black"}),(zX={rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"},{tagName:"link",attributes:zX,exists:function(){return document.querySelector('link[rel="'+zX.rel+'"]')}})];function GX(e){return{tagName:"meta",attributes:e,exists:function(){return document.querySelector('meta[name="'+e.name+'"]')}}}var HX,WX,QX,qX=kV(5928),XX=kV.n(qX),$X=WV,YX="loading-screen";function KX(e){var t=HX.hasAttribute("embedded"),n=QX(HX.canvas,t,HX.maxCanvasSize,HX.is("vr-mode"));e.aspect=n.width/n.height,e.updateProjectionMatrix(),HX.renderer.setSize(n.width,n.height,!1)}const JX=[];var ZX=HQ()("core:propertyTypes:warn"),e$={},t$=/[,> .[\]:]/,n$=/url\((.+)\)/;function i$(e,t,n,i,r,o){if(e in e$)throw new Error("Property type "+e+" is already registered.");e$[e]={default:t,parse:n||a$,stringify:i||l$,equals:r||c$,isCacheable:!1!==o}}function r$(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function o$(e){var t,n;return"string"!=typeof e?e:(n=e.match(n$))?n[1]:"#"===e.charAt(0)?(t=document.getElementById(e.substring(1)))?"CANVAS"===t.tagName||"VIDEO"===t.tagName||"IMG"===t.tagName?t:t.getAttribute("src"):void ZX('"'+e+'" asset not found.'):e}function s$(e){return e.getAttribute?e.getAttribute("id")?"#"+e.getAttribute("id"):e.getAttribute("src"):l$(e)}function a$(e){return e}function l$(e){return null===e?"null":e.toString()}function c$(e,t){return e===t}function u$(e){return parseInt(e,10)}function h$(e,t,n){return Rq(e,t,n)}function d$(e,t){if(null===e)return!0;if("object"!=typeof e)return!1;if(Object.keys(e).length!==t)return!1;var n=e.x,i=e.y,r=e.z,o=e.w;return!("number"!=typeof n||"number"!=typeof i||t>2&&"number"!=typeof r||t>3&&"number"!=typeof o)}i$("audio","",o$,s$),i$("array",[],(function(e){return Array.isArray(e)?e:e&&"string"==typeof e?e.split(",").map((function(e){return e.trim()})):[]}),(function(e){return e.join(", ")}),r$),i$("asset","",o$,s$),i$("boolean",!1,(function(e){return"false"!==e&&!1!==e})),i$("color","#FFF"),i$("int",0,u$),i$("number",0,(function(e){return parseFloat(e,10)})),i$("map","",o$,s$),i$("model","",o$,s$),i$("selector",null,(function(e){return e?"string"!=typeof e?e:"#"!==e[0]||t$.test(e)?document.querySelector(e):document.getElementById(e.substring(1)):null}),(function(e){return e.getAttribute?"#"+e.getAttribute("id"):l$(e)}),c$,!1),i$("selectorAll",null,(function(e){return e?"string"!=typeof e?e:Array.prototype.slice.call(document.querySelectorAll(e),0):null}),(function(e){return e instanceof Array?e.map((function(e){return"#"+e.getAttribute("id")})).join(", "):l$(e)}),r$,!1),i$("src","",(function(e){return ZX("`src` property type is deprecated. Use `asset` instead."),o$(e)}),s$),i$("string",""),i$("time",0,u$),i$("vec2",{x:0,y:0},h$,Iq,Pq),i$("vec3",{x:0,y:0,z:0},h$,Iq,Pq),i$("vec4",{x:0,y:0,z:0,w:1},h$,Iq,Pq);var p$=function(e,t){return("audio"!==e||"string"==typeof t)&&!("array"===e&&!Array.isArray(t))&&("asset"!==e||"string"==typeof t)&&("boolean"!==e||"boolean"==typeof t)&&("color"!==e||"string"==typeof t)&&("int"!==e||"number"==typeof t)&&("number"!==e||"number"==typeof t)&&("map"!==e||"string"==typeof t)&&("model"!==e||"string"==typeof t)&&("selector"!==e||"string"==typeof t||null===t)&&("selectorAll"!==e||"string"==typeof t||null===t)&&("src"!==e||"string"==typeof t)&&("string"!==e||"string"==typeof t)&&("time"!==e||"number"==typeof t)&&("vec2"===e?d$(t,2):"vec3"===e?d$(t,3):"vec4"!==e||d$(t,4))},f$=e$,m$=qQ("core:schema:warn");function g$(e){return"type"in e?"string"==typeof e.type:"default"in e}function v$(e,t){var n;if(g$(e))return y$(e,t);for(n in e)e[n]=y$(e[n],t);return e}function y$(e,t){var n,i,r=e.default,o=e.type;return e.type?"bool"===e.type?o="boolean":"float"===e.type&&(o="number"):o=void 0===r||"boolean"!=typeof r&&"number"!=typeof r?Array.isArray(r)?"array":"string":typeof r,(i=f$[o])||m$("Unknown property type for component `"+t+"`: "+o),n=!!e.parse,e.parse=e.parse||i.parse,e.stringify=e.stringify||i.stringify,e.equals=e.equals||i.equals,e.isCacheable=!0===e.isCacheable||i.isCacheable,e.type=o,"default"in e?n||p$(o,r)||m$("Default value `"+r+"` does not match type `"+o+"` in component `"+t+"`"):e.default=i.default,e}var A$,x$=(A$=[],function(e,t,n,i,r){var o,s,a,l;for(s in A$.length=0,n?e:t)n&&void 0===e[s]||A$.push(s);if(null===e||"object"!=typeof e)return e;for(s in e)void 0===e[s]||t[s]||r||m$("Unknown property `"+s+"` for component/system `"+i+"`.");for(o=0;o<A$.length;o++){if(a=t[s=A$[o]],l=e[s],!t[s])return;e[s]=b$(l,a)}return e});function b$(e,t,n){return null!=e&&""!==e||(e=t.default,Array.isArray(e)&&(e=e.slice())),t.parse(e,t.default,n)}function _$(e,t){var n,i,r,o,s={};for(n in e)i=t[n],"object"==typeof(o=r=e[n])&&(o=w$(r,i),i||m$("Unknown component property: "+n)),void 0!==o&&(s[n]=o);return s}function w$(e,t){return"object"!=typeof e?e:t&&null!==e?t.stringify(e):JSON.stringify(e)}var E$={},S$=b$,C$=v$,M$=g$,T$=_$,R$=w$,I$=WV,P$=qQ("core:component:warn"),B$=document.currentScript,L$=new RegExp("[A-Z]+"),N$={},D$=Object.freeze({}),k$=[],O$={get:function(e,t){return e.getComputedPropertyValue(t)},set:function(e,t,n){return t in e.schema?e.recomputeProperty(t,n):void 0!==n&&e.handleUnknownProperty(t,n),!0}},U$=function(e,t,n){var i=this;if(this.sceneOnly&&!e.isScene)throw new Error("Component `"+this.name+"` can only be applied to <a-scene>");if(n&&!this.multiple)throw new Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=e,this.id=n,this.attrName=this.name+(n?"__"+n:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=N$[this.name];var r=this.events;this.events={},function(e,t){var n;for(n in t)e.events[n]=t[n].bind(e)}(this,r),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),Eq(this.data,this.schema),this.oldData=this.objectPool.use(),Eq(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,O$)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.throttledEmitComponentChanged=EX((function(){e.emit("componentchanged",i.evtDetail,!1)}),200),this.updateProperties(t,!0)};U$.prototype={schema:{},init:function(){},events:{},update:function(e){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(e){var t=this.schema;return"string"==typeof e?e:this.isSingleProperty?R$(e,t):(e=T$(e,t),I$.stringify(e))},flushToDOM:function(e){var t=e?this.data:this.attrValue;null!=t&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(t))},updateProperties:function(e,t){var n=this.el;this.updateData(e,t),(n.hasLoaded||n.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var e,t=this.el;t.initializingComponents[this.name]||(t.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete t.initializingComponents[this.name],e=this.isObjectBased?D$:void 0,this.dataChanged=!1,this.storeOldData(),this.update(e),t.isPlaying&&this.play(),t.emit("componentinitialized",this.evtDetail,!1))},updateData:function(e,t){this.isSingleProperty?this.recomputeProperty(void 0,e):(t?(wq(this.attrValue),this.recomputeData(e),this.schemaChangeRequired=!!this.updateSchema):"string"==typeof e?I$.parse(e,this.attrValueProxy):MX(this.attrValueProxy,e),this.updateSchemaIfNeeded(e))},updateSchemaIfNeeded:function(e){if(this.schemaChangeRequired&&this.updateSchema)for(var t in k$.length=0,this.updateSchema(this.data),Eq(this.data,this.schema),this.recomputeData(e),this.schemaChangeRequired=!1,this.attrValue)void 0!==this.attrValue[t]&&-1===k$.indexOf(t)&&(t in this.schema||P$("Unknown property `"+t+"` for component `"+this.name+"`."));for(var n=0;n<k$.length;n++)P$("Unknown property `"+k$[n]+"` for component `"+this.name+"`.");k$.length=0},callUpdateHandler:function(){if(this.isPositionRotationScale||this.dataChanged){this.dataChanged=!1;var e=this.oldData;this.oldDataInUse=!0,this.update(e),e!==this.oldData&&this.objectPool.recycle(e),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(e){(this.isSingleProperty||e in this.schema)&&(e?this.attrValue[e]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(e,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(e){var t;t=MX({},E$[this.name].schema),MX(t,e),this.schema=C$(t),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(e){var t=this.el.mixinEls,n=this.attrValue&&e?this.attrValue[e]:this.attrValue;if(void 0!==n)return n;for(var i=t.length-1;i>=0;i--){var r=t[i].getAttribute(this.attrName);if(null!==r&&(!e||e in r))return e?r[e]:r}return e?this.schema[e].default:this.schema.default},recomputeProperty:function(e,t){var n=e?this.schema[e]:this.schema;if(null!=t){void 0===this.attrValue&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var i=e?this.attrValue[e]:this.attrValue;"string"==typeof(i=n.isCacheable?S$(t,n,i):t)&&(i=""===t?void 0:t),e?this.attrValue[e]=i:this.attrValue=i}this.oldDataInUse&&(this.oldData=this.objectPool.use(),Eq(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var r=e?this.oldData[e]:this.oldData,o=e?this.data[e]:this.data,s=S$(this.getComputedPropertyValue(e),n,o);return"array"!==n.type||e||(s=RX(s)),n.equals(s,r)||(this.dataChanged=!0,n.schemaChange&&(this.schemaChangeRequired=!0)),e?this.data[e]=s:this.data=s,s},handleUnknownProperty:function(e,t){void 0===this.attrValue&&(this.attrValue=this.objectPool.use()),this.attrValue[e]=t,this.deferUnknownPropertyWarnings?k$.push(e):this.silenceUnknownPropertyWarnings||P$("Unknown property `"+e+"` for component `"+this.name+"`.")},storeOldData:function(){var e;if(this.isObjectBased)if(this.isSingleProperty)this.oldData=S$(this.data,this.schema,this.oldData);else for(e in this.schema)void 0!==this.data[e]&&(this.data[e]&&"object"==typeof this.data[e]?this.oldData[e]=S$(this.data[e],this.schema[e],this.oldData[e]):this.oldData[e]=this.data[e]);else this.oldData=this.data},recomputeData:function(e){var t;if(this.isSingleProperty)this.recomputeProperty(void 0,e);else{for(t in this.schema)this.attrValueProxy[t]=void 0;e&&"object"==typeof e?MX(this.attrValueProxy,e):"string"==typeof e&&I$.parse(e,this.attrValueProxy)}},eventsAttach:function(){var e;for(e in this.eventsDetach(),this.events)this.el.addEventListener(e,this.events[e])},eventsDetach:function(){var e;for(e in this.events)this.el.removeEventListener(e,this.events[e])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}};var F$={};function z$(e,t){var n,i,r,o,s,a={};if(document.currentScript&&document.currentScript!==B$&&JX.forEach((function(t){t.hasLoaded||document.currentScript.compareDocumentPosition(t)!==Node.DOCUMENT_POSITION_FOLLOWING&&(P$("The component `"+e+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(F$[e]=!0))})),!0===L$.test(e)&&P$("The component name `"+e+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+e.toLowerCase()+"`"),-1!==e.indexOf("__"))throw new Error("The component name `"+e+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(t).forEach((function(e){a[e]={value:t[e],writable:!0}})),E$[e])throw new Error("The component `"+e+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");((n=function(e,t,n){U$.call(this,e,t,n)}).prototype=Object.create(U$.prototype,a)).name=e,n.prototype.isPositionRotationScale="position"===e||"rotation"===e||"scale"===e,n.prototype.constructor=n,n.prototype.system=YV&&Q$[e],n.prototype.play=(o=n.prototype.play,function(){var e=this.el.sceneEl,t=this.el.isPlaying&&!this.isPlaying;this.initialized&&t&&(o.call(this),this.isPlaying=!0,this.eventsAttach(),j$(this)&&e.addBehavior(this))}),n.prototype.pause=(s=n.prototype.pause,function(){var e=this.el.sceneEl;this.isPlaying&&(s.call(this),this.isPlaying=!1,this.eventsDetach(),j$(this)&&e.removeBehavior(this))}),i=MX(C$(n.prototype.schema,n.prototype.name)),n.prototype.isSingleProperty=r=M$(n.prototype.schema),n.prototype.isObjectBased=!r||r&&(V$(i.default)||V$(S$(void 0,i))),N$[e]=_q(),E$[e]={Component:n,dependencies:n.prototype.dependencies,before:n.prototype.before,after:n.prototype.after,isSingleProperty:n.prototype.isSingleProperty,isObjectBased:n.prototype.isObjectBased,multiple:n.prototype.multiple,sceneOnly:n.prototype.sceneOnly,name:e,schema:i,stringify:n.prototype.stringify};for(var l=0;l<JX.length;l++)JX[l].emit("componentregistered",{name:e},!1);return n}function j$(e){return e.tick||e.tock}function V$(e){return e&&e.constructor===Object&&!(e instanceof window.HTMLElement)}var G$=!1;function H$(){G$||(G$=!0,setTimeout((function(){document.dispatchEvent(new CustomEvent("aframeready"))})))}var W$=WV,Q$={},q$=function(e){var t=$V&&E$[this.name];this.el=e,this.sceneEl=e,t&&(t.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};function X$(e,t){var n,i,r={},o=FX(document);if(Object.keys(t).forEach((function(e){r[e]={value:t[e],writable:!0}})),Q$[e])throw new Error("The system `"+e+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if(i=function(e){q$.call(this,e)},(i.prototype=Object.create(q$.prototype,r)).name=e,i.prototype.constructor=i,i.prototype.schema=MX(v$(i.prototype.schema)),Q$[e]=i,G$)for(n=0;n<o.length;n++)o[n].initSystem(e)}q$.prototype={schema:{},init:function(){},update:function(e){},updateProperties:function(e){var t=this.data;0!==Object.keys(this.schema).length&&(this.buildData(e),this.update(t))},buildData:function(e){var t=this.schema;0!==Object.keys(t).length&&(e=e||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),g$(t)?this.data=b$(e,t):this.data=x$(W$.parse(e)||{},t,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}};var $$=qQ("core:a-node:warn"),Y$={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function K$(e){return e.tagName.toLowerCase()in Y$||e.isANode}class J$ extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isANode=!0,this.mixinEls=[]}connectedCallback(){G$?this.doConnectedCallback():document.addEventListener("aframeready",this.connectedCallback.bind(this))}doConnectedCallback(){var e;this.sceneEl=this.closestScene(),this.sceneEl||$$("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(e=this.getAttribute("mixin"))&&this.updateMixins(e)}attributeChangedCallback(e,t,n){n!==this.computedMixinStr&&("mixin"!==e||this.isMixin||this.updateMixins(n,t))}closestScene(){for(var e=this;e&&!e.isScene;)e=e.parentElement;return e}closest(e){for(var t=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,n=this;n&&!t.call(n,e);)n=n.parentElement;return n}disconnectedCallback(){this.hasLoaded=!1}load(e,t){var n,i=this;this.hasLoaded||(t=t||K$,n=this.getChildren().filter(t).map((function(e){return new Promise((function(t,n){if(e.hasLoaded)return t();e.addEventListener("loaded",t),e.addEventListener("error",n)}))})),Promise.allSettled(n).then((function(t){t.forEach((function(e){"rejected"===e.status&&$$("Rendering scene with errors on node: ",e.reason.target)})),i.isLoading=!0,i.setupMutationObserver(),e&&e(),i.isLoading=!1,i.hasLoaded=!0,i.emit("loaded-private",void 0,!1),i.emit("loaded",void 0,!1)})))}setupMutationObserver(){var e=this;new MutationObserver((function(t){var n;for(n=0;n<t.length;n++)if("attributes"===t[n].type){var i=t[n].attributeName,r=window.HTMLElement.prototype.getAttribute.call(e,i),o=t[n].oldValue;e.attributeChangedCallback(i,o,r)}})).observe(this,{attributes:!0,attributeOldValue:!0})}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(e,t){var n,i,r,o=J$.newMixinIdArray,s=J$.oldMixinIdArray,a=J$.mixinIds;for(o.length=0,s.length=0,i=e?kq(e.trim(),/\s+/):o,r=t?kq(t.trim(),/\s+/):s,a.newMixinIds=i,a.oldMixinIds=r,n=0;n<r.length;n++)-1===i.indexOf(r[n])&&this.unregisterMixin(r[n]);for(this.computedMixinStr="",this.mixinEls.length=0,n=0;n<i.length;n++)this.registerMixin(i[n]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),0===i.length&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),a}registerMixin(e){var t,n,i,r=document.getElementById(e);if(r){if(i=r.getAttribute("mixin"))for(t=kq(i.trim(),/\s+/),n=0;n<t.length;n++)this.registerMixin(t[n]);this.computedMixinStr=this.computedMixinStr+" "+r.id,this.mixinEls.push(r)}else $$("No mixin was found with id `%s`",e)}setAttribute(e,t){"mixin"===e&&this.updateMixins(t),window.HTMLElement.prototype.setAttribute.call(this,e,t)}unregisterMixin(e){var t,n=this.mixinEls;for(t=0;t<n.length;++t)if(e===n[t].id){n.splice(t,1);break}}emit(e,t,n,i){var r=J$.evtData;void 0===n&&(n=!0),r.bubbles=!!n,r.detail=t,i&&(r=MX({},i,r)),this.dispatchEvent(new CustomEvent(e,r))}}J$.evtData={},J$.newMixinIdArray=[],J$.oldMixinIdArray=[],J$.mixinIds={},customElements.define("a-node",J$);var Z$=qQ("core:a-entity:debug"),eY=qQ("core:a-entity:warn"),tY="__",nY=["position","rotation","scale","visible"],iY={once:!0};class rY extends J${constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new dH.Group,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(e,t,n){var i=this.components[e];super.attributeChangedCallback(),i&&i.justInitialized&&""===n?delete i.justInitialized:(i||null!==n)&&this.setEntityAttribute(e,t,n)}doConnectedCallback(){var e,t,n=this;super.doConnectedCallback(),t=this.sceneEl,this.addToParent(),this.isScene||(t?!(e=t.querySelector("a-assets"))||e.hasLoaded?this.load():e.addEventListener("loaded",(function(){n.load()})):this.load())}disconnectedCallback(){var e;if(this.parentEl){for(e in this.components)this.removeComponent(e,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(e){return this.object3DMap[e]}setObject3D(e,t){var n,i=this;if(!(t instanceof dH.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(n=this.getObject3D(e))&&this.object3D.remove(n),t.el=this,t.children.length&&t.traverse((function(e){e.el=i})),this.object3D.add(t),this.object3DMap[e]=t,this.emit("object3dset",{object:t,type:e})}removeObject3D(e){var t=this.getObject3D(e);t?(this.object3D.remove(t),delete this.object3DMap[e],this.emit("object3dremove",{type:e})):eY("Tried to remove `Object3D` of type:",e,"which was not defined.")}getOrCreateObject3D(e,t){var n=this.getObject3D(e);return!n&&t&&(n=new t,this.setObject3D(e,n)),eY("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),n}add(e){if(!e.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(e.object3D),this.emit("child-attached",{el:e})}addToParent(){var e=this.parentEl=this.parentNode;e&&e.add&&!this.attachedToParent&&(e.add(this),this.attachedToParent=!0)}removeFromParent(){var e=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,e.emit("child-detached",{el:this})}load(){var e=this;!this.hasLoaded&&this.parentEl&&super.load.call(this,(function(){e.parentEl&&(e.updateComponents(),(e.isScene||e.parentEl.isPlaying)&&e.play())}))}remove(e){e?this.object3D.remove(e.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var e=this.children,t=[],n=0;n<e.length;n++){var i=e[n];i instanceof rY&&t.push(i)}return t}initComponent(e,t,n){var i,r,o,s;s=(o=kq(e,tY))[0],r=o.length>2?o.slice(1).join("__"):o[1],E$[s]&&(oY(this,e)||void 0!==t||n)&&(e in this.components||(this.initComponentDependencies(s),i=new E$[s].Component(this,t,r),this.isPlaying&&i.play(),this.hasAttribute(e)||(i.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,e,"")),Z$("Component initialized: %s",e)))}initComponentDependencies(e){var t,n;if(E$[e]&&(t=E$[e].dependencies))for(n=0;n<t.length;n++)this.initComponent(t[n],window.HTMLElement.prototype.getAttribute.call(this,t[n])||void 0,!0)}removeComponent(e,t){var n;(n=this.components[e])&&(n.initialized?(n.pause(),n.remove(),t&&(n.destroy(),delete this.components[e],this.hasAttribute(e)&&window.HTMLElement.prototype.removeAttribute.call(this,e)),this.emit("componentremoved",n.evtDetail,!1)):this.addEventListener("componentinitialized",(function n(i){i.detail.name===e&&(this.removeComponent(e,t),this.removeEventListener("componentinitialized",n))})))}updateComponents(){var e,t,n,i,r,o,s=this.componentsToUpdate;if(this.hasLoaded||this.isLoading){for(n=0;n<this.mixinEls.length;n++)for(i in this.mixinEls[n].componentCache)sY(i)&&(s[i]=!0);if(this.getExtraComponents)for(i in t=this.getExtraComponents())sY(i)&&(s[i]=!0);for(n=0;n<this.attributes.length;++n)i=this.attributes[n].name,-1===nY.indexOf(i)&&sY(i)&&(s[i]=!0);for(n=0;n<nY.length;n++)i=nY[n],this.hasAttribute(i)&&this.updateComponent(i,this.getDOMAttribute(i));for(i in s)r=this.getDOMAttribute(i),e=(o=t&&t[i])?o.constructor===Object?MX(o,oX(r||{})):r||o:r,this.updateComponent(i,e),delete s[i]}}updateComponent(e,t,n){var i=this.components[e];if(i)return null!==t||oY(this,e)?void i.updateProperties(t,n):void this.removeComponent(e,!0);this.initComponent(e,t,!1)}removeAttribute(e,t){var n=this.components[e];n&&void 0===t&&this.removeComponent(e,!0),n&&void 0!==t?n.resetProperty(t):("mixin"===e&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,e))}play(){var e,t,n;if(!this.isPlaying&&(this.hasLoaded||this.isLoading)){for(n in this.isPlaying=!0,this.components)this.components[n].play();for(e=this.getChildEntities(),t=0;t<e.length;t++)e[t].play();this.emit("play")}}pause(){var e,t,n;if(this.isPlaying){for(n in this.isPlaying=!1,this.components)this.components[n].pause();for(e=this.getChildEntities(),t=0;t<e.length;t++)e[t].pause();this.emit("pause")}}setEntityAttribute(e,t,n){if(E$[e]||this.components[e])this.updateComponent(e,n);else if("mixin"===e){if(n===this.computedMixinStr)return;this.mixinUpdate(n,t)}}mixinUpdate(e,t,n){var i,r,o,s,a=rY.componentsUpdated,l=this;if(n||(t=t||this.getAttribute("mixin")),this.hasLoaded){for(o=this.updateMixins(e,t),a.length=0,s=0;s<this.mixinEls.length;s++)for(i in this.mixinEls[s].componentCache)-1===a.indexOf(i)&&(this.components[i]?this.components[i].handleMixinUpdate():this.initComponent(i,null),a.push(i));for(s=0;s<o.oldMixinIds.length;s++)if(r=document.getElementById(o.oldMixinIds[s]))for(i in r.componentCache)-1===a.indexOf(i)&&this.components[i]&&(this.getDOMAttribute(i)?this.components[i].handleMixinUpdate():this.removeComponent(i,!0))}else this.addEventListener("loaded-private",(function(){l.mixinUpdate(e,t,!0)}),iY)}setAttribute(e,t,n){var i,r,o,s,a,l=rY.singlePropUpdate;if(o=(s=e.indexOf(tY))>0?e.substring(0,s):e,!E$[o])return"mixin"===e&&this.mixinUpdate(t),void super.setAttribute.call(this,e,t);if(!this.components[e]&&this.hasAttribute(e)&&this.updateComponent(e,window.HTMLElement.prototype.getAttribute.call(this,e)),void 0!==n&&"string"==typeof t&&t.length>0&&"string"==typeof oX(t)){for(a in l)delete l[a];(i=l)[t]=n,r=!1}else i=t,r=!0===n;this.updateComponent(e,i,r),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[e].flushToDOM()}flushToDOM(e){var t,n,i,r=this.components,o=this.children;for(i in r)r[i].flushToDOM();if(e)for(n=0;n<o.length;++n)(t=o[n]).flushToDOM&&t.flushToDOM(e)}getAttribute(e){var t,n,i,r;return"position"===e?this.object3D.position:"rotation"===e?(n=dH.MathUtils.radToDeg,i=this.object3D.rotation,(r=this.rotationObj).x=n(i.x),r.y=n(i.y),r.z=n(i.z),r):"scale"===e?this.object3D.scale:"visible"===e?this.object3D.visible:(t=this.components[e])?t.data:window.HTMLElement.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var t=this.components[e];return t?t.attrValue:window.HTMLElement.prototype.getAttribute.call(this,e)}addState(e){this.is(e)||(this.states.push(e),this.emit("stateadded",e))}removeState(e){var t=this.states.indexOf(e);-1!==t&&(this.states.splice(t,1),this.emit("stateremoved",e))}is(e){return-1!==this.states.indexOf(e)}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var e;if(this.parentNode)eY("Entity can only be destroyed if detached from scenegraph.");else for(e in this.components)this.components[e].destroy()}}function oY(e,t){return!(!e.components[t]||!e.components[t].attrValue)||function(e,t){var n,i=!1;for(n=0;n<t.length&&!(i=t[n].hasAttribute(e));++n);return i}(t,e.mixinEls)}function sY(e){return-1!==e.indexOf(tY)&&(e=kq(e,tY)[0]),!!E$[e]}function aY(e){if(e.data&&"vr"===e.data.type)switch(e.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}rY.componentsUpdated=[],rY.singlePropUpdate={},customElements.define("a-entity",rY),hq()&&window.addEventListener("orientationchange",(function(){document.documentElement.style.height="initial",setTimeout((function(){document.documentElement.style.height="100%",setTimeout((function(){window.scrollTo(0,1)}),500)}),500)}));var lY=qQ("core:a-scene:warn"),cY=hq(),uY=aq(),hY=ZQ;class dY extends rY{constructor(){var e;super(),(e=this).clock=new dH.Clock,e.isIOS=cY,e.isMobile=uY,e.hasWebXR=hY,e.isAR=!1,e.isScene=!0,e.object3D=new dH.Scene,e.resize=e.resize.bind(e),e.render=e.render.bind(e),e.systems={},e.systemNames=[],e.time=e.delta=0,e.usedOfferSession=!1,e.componentOrder=[],e.behaviors={},e.hasLoaded=!1,e.isPlaying=!1,e.originalHTML=e.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var e=this,t=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),function(e){var t;function n(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||e.exitVR(),document.activeElement.blur(),document.body.focus()}(t=document.createElement("canvas")).classList.add("a-canvas"),t.dataset.aframeCanvas=!0,e.appendChild(t),document.addEventListener("fullscreenchange",n),document.addEventListener("mozfullscreenchange",n),document.addEventListener("webkitfullscreenchange",n),document.addEventListener("MSFullscreenChange",n),t.addEventListener("touchmove",(function(e){e.preventDefault()}),{passive:!1}),e.canvas=t,e.emit("render-target-loaded",{target:t}),setTimeout(e.resize.bind(e),0)}(this),this.setupRenderer(),function(e,t){QX=t;var n,i,r,o,s,a,l,c,u,h,d=(HX=e).hasAttribute(YX)?$X.parse(HX.getAttribute(YX)):void 0,p=d&&d.dotsColor||"white",f=d&&d.backgroundColor||"#24CAFF";(void 0===d||"true"===d.enabled||void 0===d.enabled)&&(n=new dH.Scene,i=new dH.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),r=new dH.MeshBasicMaterial({color:p}),o=new dH.Mesh(i,r),s=o.clone(),a=o.clone(),l=new dH.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),c=new dH.Clock,u=0,h=function(){HX.renderer.render(n,l),u=c.getElapsedTime()%4,o.visible=u>=1,s.visible=u>=2,a.visible=u>=3},n.background=new dH.Color(f),n.add(l),o.position.set(-1,0,-15),s.position.set(0,0,-15),a.position.set(1,0,-15),l.add(o),l.add(s),l.add(a),(WX=document.createElement("div")).className="a-loader-title",WX.innerHTML=document.title,WX.style.display="none",WX.setAttribute(VQ,""),HX.appendChild(WX),setTimeout((function(){HX.hasLoaded||(KX(l),WX.style.display="block",window.addEventListener("resize",(function(){KX(l)})),HX.renderer.setAnimationLoop(h))}),200))}(this,mY),this.resize(),t||this.addFullScreenStyles(),UX()&&window.addEventListener("message",aY.bind(this)),function(e){var t,n=document.head,i=n.querySelector("script"),r=[];return jX.forEach(o),e.isIOS&&VX.forEach(o),r;function o(e){e&&!e.exists()&&(t=function(e){if(e&&e.tagName){var t=document.createElement(e.tagName);return t.setAttribute(VQ,""),MX(t,e.attributes)}}(e),t&&(i?i.parentNode.insertBefore(t,i):n.appendChild(t),r.push(t)))}}(this),function(e){if(e.isMobile){var t=e.wakelock=new(XX());e.addEventListener("enter-vr",(function(){t.request()})),e.addEventListener("exit-vr",(function(){t.release()}))}}(this),this.enterVRBound=function(){e.enterVR()},this.exitVRBound=function(){e.exitVR()},window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",(function(){e.attachedCallbackPostCamera()})),this.initSystems(),this.componentOrder=pY(E$,this.componentOrder),this.addEventListener("componentregistered",(function(){e.componentOrder=pY(E$,e.componentOrder)})),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",(function(){e.enterVR()}))}attachedCallbackPostCamera(){var e=this;window.addEventListener("load",void 0),window.addEventListener("resize",(function(){e.isIOS?setTimeout(e.resize,100):e.resize()})),this.play(),JX.push(this)}initSystems(){var e;for(e in this.initSystem("camera"),Q$)"camera"!==e&&this.initSystem(e)}initSystem(e){this.systems[e]||(this.systems[e]=new Q$[e](this),this.systemNames.push(e))}disconnectedCallback(){var e=JX.indexOf(this);super.disconnectedCallback(),JX.splice(e,1),window.removeEventListener("sessionend",this.resize),this.removeFullScreenStyles(),this.renderer.dispose()}addBehavior(e){var t,n,i=this.behaviors[e.name];for(n in i||(i=this.behaviors[e.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}}),i)if(e[n]){if((t=i[n]).inUse){var r=t.markedForRemoval.indexOf(e);-1!==r&&t.markedForRemoval.splice(r,1)}-1===t.array.indexOf(e)&&t.array.push(e)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return nq()}enterAR(){var e;if(!this.hasWebXR)throw e="Failed to enter AR mode, WebXR not supported.",new Error(e);if(!iq())throw e="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(e);return this.enterVR(!0)}enterVR(e,t){var n,i=this,r=i.renderer.xr;if(t&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(i.usedOfferSession&&t)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var o=i.getAttribute("renderer");if(r.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var s=this.sceneEl.systems.webxr.sessionReferenceSpaceType;r.setReferenceSpaceType(s);var a=e?"immersive-ar":"immersive-vr";return n=this.sceneEl.systems.webxr.sessionConfiguration,new Promise((function(e,s){var c=t?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);i.usedOfferSession|=t,c(a,n).then((function(s){t&&(i.usedOfferSession=!1),r.layersEnabled=-1!==n.requiredFeatures.indexOf("layers"),r.setSession(s).then((function(){r.setFoveation(o.foveationLevel),i.xrSession=s,i.systems.renderer.setWebXRFrameRate(s),s.addEventListener("end",i.exitVRBound),l(e)}))}),(function(e){s(new Error("Failed to enter "+("immersive-ar"===a?"AR":"VR")+" mode (`requestSession`)",{cause:e}))}))}))}throw new Error("Failed to enter "+(e?"AR":"VR")+" no WebXR")}return l(),Promise.resolve();function l(t){var n;e?i.addState("ar-mode"):i.addState("vr-mode"),i.emit("enter-vr",{target:i}),!i.hasWebXR&&i.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),i.addFullScreenStyles(),i.isMobile||i.checkHeadsetConnected()||((n=i.canvas).requestFullscreen||n.webkitRequestFullscreen||n.mozRequestFullScreen||n.msRequestFullscreen).apply(n,[{navigationUI:"hide"}]),i.resize(),t&&t()}}exitVR(){var e=this,t=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(t.enabled=!1,!this.hasWebXR)throw Error("Failed to exit VR - no WebXR");this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then((function(){}),(function(){})),this.xrSession=void 0}else(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());return e.removeState("vr-mode"),e.removeState("ar-mode"),e.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),e.hasAttribute("embedded")&&e.removeFullScreenStyles(),e.resize(),e.isIOS&&zq(e.canvas),e.renderer.setPixelRatio(window.devicePixelRatio),e.emit("exit-vr",{target:e}),Promise.resolve()}getAttribute(e){var t=this.systems[e];return t?t.data:rY.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var t=this.systems[e];return t?t.data:rY.prototype.getDOMAttribute.call(this,e)}setAttribute(e,t,n){if(Q$[e]){J$.prototype.setAttribute.call(this,e,t);var i=this.systems[e];i&&i.updateProperties(t)}else rY.prototype.setAttribute.call(this,e,t,n)}removeBehavior(e){var t,n,i,r=this.behaviors[e.name];for(n in r)e[n]&&-1!==(i=(t=r[n]).array.indexOf(e))&&(t.inUse?-1===t.markedForRemoval.indexOf(e)&&t.markedForRemoval.push(e):(t.array[i]=t.array[t.array.length-1],t.array.pop()))}resize(){var e,t,n=this.camera,i=this.canvas,r=this.renderer.xr.isPresenting;e=this.renderer.xr.enabled&&r,!n||!i||this.is("vr-mode")&&(this.isMobile||e)||(t=mY(i,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),n.aspect=t.width/t.height,n.updateProjectionMatrix(),this.renderer.setSize(t.width,t.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var e,t,n,i=this;n={alpha:!0,antialias:!uY,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&((t=oX(this.getAttribute("renderer"))).precision&&(n.precision=t.precision+"p"),t.antialias&&"auto"!==t.antialias&&(n.antialias="true"===t.antialias),t.logarithmicDepthBuffer&&"auto"!==t.logarithmicDepthBuffer&&(n.logarithmicDepthBuffer="true"===t.logarithmicDepthBuffer),t.alpha&&(n.alpha="true"===t.alpha),t.stencil&&(n.stencil="true"===t.stencil),t.multiviewStereo&&(n.multiviewStereo="true"===t.multiviewStereo),this.maxCanvasSize={width:t.maxCanvasWidth?parseInt(t.maxCanvasWidth):this.maxCanvasSize.width,height:t.maxCanvasHeight?parseInt(t.maxCanvasHeight):this.maxCanvasSize.height});var r=["WebGLRenderer","WebGPURenderer"].find((function(e){return dH[e]}));(e=this.renderer=new dH[r](n)).xr.setPoseTarget||(e.xr.setPoseTarget=function(){}),e.setPixelRatio(window.devicePixelRatio),this.camera&&e.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",(function(){e.xr.setPoseTarget(i.camera.el.object3D)}))}play(){var e=this,t=this;this.renderStarted?rY.prototype.play.call(this):(this.addEventListener("loaded",(function(){var e=this.renderer;rY.prototype.play.call(this),t.renderStarted||(t.resize(),t.renderer&&(window.performance&&window.performance.mark("render-started"),window.removeEventListener("resize",KX),WX&&(WX.style.display="none"),e.setAnimationLoop(this.render),t.renderStarted=!0,t.emit("renderstart")))})),setTimeout((function(){rY.prototype.load.call(e)})))}updateComponent(e){e in Q$||rY.prototype.updateComponent.apply(this,arguments)}tick(e,t){var n,i=this.systems;for(this.callComponentBehaviors("tick",e,t),n=0;n<this.systemNames.length;n++)i[this.systemNames[n]].tick&&i[this.systemNames[n]].tick(e,t)}tock(e,t,n){var i,r=this.systems;for(this.callComponentBehaviors("tock",e,t),i=0;i<this.systemNames.length;i++)r[this.systemNames[i]].tock&&r[this.systemNames[i]].tock(e,t,n)}render(e,t){var n=this.renderer;this.frame=t,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var i=null;if(this.is("ar-mode")&&(i=this.object3D.background,this.object3D.background=null),n.render(this.object3D,this.camera),i&&(this.object3D.background=i),this.isPlaying){var r=n.xr.isPresenting?n.xr.getCamera():this.camera;this.tock(this.time,this.delta,r)}}callComponentBehaviors(e,t,n){for(var i,r=0;r<this.componentOrder.length;r++){var o=this.behaviors[this.componentOrder[r]];if(o){var s=o[e];for(s.inUse=!0,i=0;i<s.array.length;i++)s.array[i].isPlaying&&s.array[i][e](t,n);for(s.inUse=!1,i=0;i<s.markedForRemoval.length;i++)this.removeBehavior(s.markedForRemoval[i]);s.markedForRemoval.length=0}}}}function pY(e,t){var n,i,r={},o=t||[];for(i in o.length=0,e){var s=e[i];if(void 0!==s){var a=s.before?s.before.slice(0):[],l=s.after?s.after.slice(0):[];r[i]={before:a,after:l,visited:!1,done:!1}}}for(i in r)for(n=0;n<r[i].before.length;n++){var c=r[i].before[n];c in r?r[c].after.push(i):lY("Invalid ordering constraint, no component named `"+c+"` referenced by `"+i+"`")}function u(e){if(e in r&&!r[e].done)if(r[e].visited)lY("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");else{r[e].visited=!0;for(var t=0;t<r[e].after.length;t++){var n=r[e].after[t];n in r||lY("Invalid before/after constraint, no component named `"+n+"` referenced in `"+e+"`"),u(n)}r[e].done=!0,o.push(e)}}for(i in r)r[i].done||u(i);return o}function fY(e,t){var n,i=window.devicePixelRatio;return!t||-1===t.width&&-1===t.height||e.width*i<t.width&&e.height*i<t.height||(n=e.width/e.height,e.width*i>t.width&&-1!==t.width&&(e.width=Math.round(t.width/i),e.height=Math.round(t.width/n/i)),e.height*i>t.height&&-1!==t.height&&(e.height=Math.round(t.height/i),e.width=Math.round(t.height*n/i))),e}function mY(e,t,n,i){return e.parentElement?t?fY({height:e.parentElement.offsetHeight,width:e.parentElement.offsetWidth},n):function(e,t){var n;return n={height:document.body.offsetHeight,width:document.body.offsetWidth},t?n:fY(n,e)}(n,i):{height:0,width:0}}customElements.define("a-scene",dY);var gY=v$,vY={},yY=[],AY=function(){};function xY(e,t){var n,i={};if(Object.keys(t).forEach((function(e){i[e]={value:t[e],writable:!0}})),vY[e])throw new Error("The geometry `"+e+"` has been already registered");return((n=function(){AY.call(this)}).prototype=Object.create(AY.prototype,i)).name=e,n.prototype.constructor=n,vY[e]={Geometry:n,schema:gY(n.prototype.schema)},yY.push(e),n}AY.prototype={schema:{},init:function(e){return this.geometry=new dH.BufferGeometry,this.geometry},update:function(e){}};var bY=qQ,_Y=Fq,wY=bY("extras:primitives:debug"),EY=bY("extras:primitives:warn"),SY=bY("extras:primitives:error"),CY={};function MY(e,t){if(e=e.toLowerCase(),!Y$[e]){Y$[e]=!0,wY("Registering <%s>",e),t.defaultAttributes&&EY("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var n=t.mappings||{},i=class extends rY{constructor(){super(),this.defaultComponentsFromPrimitive=t.defaultComponents||t.defaultAttributes||{},this.deprecated=t.deprecated||null,this.deprecatedMappings=t.deprecatedMappings||{},this.mappings=n,t.deprecated&&console.warn(t.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var e=this.mappings,t=this;Object.keys(e).forEach((function(n){var i;n!==n.toLowerCase()&&EY("Mapping keys should be specified in lower case. The mapping key "+n+" may not be recognized"),E$[n]&&(i=e[n].replace(".","-"),e[i]=e[n],delete e[n],console.warn("The primitive "+t.tagName.toLowerCase()+" has a mapping collision. The attribute "+n+" has the same name as a registered component and has been renamed to "+i))}))}getExtraComponents(){var e,t,n,i,r,o=this;for(t=RX(this.defaultComponentsFromPrimitive),(r=this.getAttribute("mixin"))&&(r=kq(r.trim(),/\s+/)).forEach((function(e){var n,r,c=document.getElementById(e);if(c){var u=c.rawAttributeCache,h=c.componentCache;for(var d in u){if(i=o.mappings[d])return void TY(i,u[d],t);d in h&&(t[d]=(n=t[d],r=h[d],s(n)?a(r):s(r)?a(n):l(n)&&l(r)?TX(n,r):a(r)))}}})),n=0;n<this.attributes.length;n++)e=this.attributes[n],(i=this.mappings[e.name])&&TY(i,e.value,t);return t;function s(e){return void 0===e}function a(e){return l(e)?TX({},e):e}function l(e){return null!==e&&e.constructor===Object}}attributeChangedCallback(e,t,n){var i=this.mappings[e];e in this.deprecatedMappings&&console.warn(this.deprecatedMappings[e]),e&&i?_Y(this,i,n):super.attributeChangedCallback(e,t,n)}};return customElements.define(e,i),i.mappings=n,CY[e]=i,i}SY("Trying to register primitive "+e+" that has been already previously registered")}function TY(e,t,n){var i=Oq(e);i.constructor===Array?(n[i[0]]=n[i[0]]||{},n[i[0]][i[1]]=t.trim()):n[i]=t.trim()}var RY={},IY=[],PY={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},BY=function(){};function LY(e,t){var n,i={};if(Object.keys(t).forEach((function(e){i[e]={value:t[e],writable:!0}})),RY[e])throw new Error("The shader "+e+" has already been registered");return((n=function(){BY.call(this)}).prototype=Object.create(BY.prototype,i)).name=e,n.prototype.constructor=n,RY[e]={Shader:n,schema:v$(n.prototype.schema)},IY.push(e),n}BY.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(e){return this.uniforms=this.initUniforms(),this.material=new(this.raw?dH.RawShaderMaterial:dH.ShaderMaterial)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?dH.GLSL3:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var e,t,n=this.schema,i={};for(e in n)"uniform"===n[e].is&&(t=PY[n[e].type],i[e]={type:t,value:void 0});return i},update:function(e){var t,n,i=this.schema,r=this.uniforms;for(t in e)if(i[t]&&"uniform"===i[t].is)if("map"!==i[t].type)r[t].value=this.parseValue(i[t].type,e[t]),r[t].needsUpdate=!0;else{if(!r[t]||r[t].value===e[t])continue;n="_texture_"+t,this.setMapOnTextureLoad(r,t,n),Yq(n,t,this,e)}},parseValue:function(e,t){var n;switch(e){case"vec2":return new dH.Vector2(t.x,t.y);case"vec3":return new dH.Vector3(t.x,t.y,t.z);case"vec4":return new dH.Vector4(t.x,t.y,t.z,t.w);case"color":return n=new dH.Color(t),new dH.Vector3(n.r,n.g,n.b);default:return t}},setMapOnTextureLoad:function(e,t,n){var i=this;this.el.addEventListener("materialtextureloaded",(function(){e[t].value=i.material[n],e[t].needsUpdate=!0}))}};var NY=new dH.FileLoader,DY=qQ("core:a-assets:warn");function kY(e){if(e.hasAttribute("autoplay")||"auto"===e.getAttribute("preload"))return new Promise((function(t,n){if(4===e.readyState)return t();if(e.error)return n();function i(){for(var n=0,i=0;i<e.buffered.length;i++)n+=e.buffered.end(i)-e.buffered.start(i);n>=e.duration&&("VIDEO"===e.tagName&&dH.Cache.add(e.getAttribute("src"),e),t())}e.addEventListener("loadeddata",i,!1),e.addEventListener("progress",i,!1),e.addEventListener("error",n,!1)}))}function OY(e){var t=function(e){var t,n,i;if(e.hasAttribute("crossorigin"))return e;if(null!==(t=e.getAttribute("src"))){if(-1===t.indexOf("://"))return e;if((i=(n=t).indexOf("://")>-1?n.split("/")[2]:n.split("/")[0]).substring(0,i.indexOf(":"))===window.location.host)return e}return DY('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',t),e.crossOrigin="anonymous",e.cloneNode(!0)}(e);return t.tagName&&"video"===t.tagName.toLowerCase()&&(t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline","")),t!==e&&(e.parentNode.appendChild(t),e.parentNode.removeChild(e)),t}customElements.define("a-assets",class extends J${constructor(){super(),this.isAssets=!0,this.fileLoader=NY,this.timeout=null}doConnectedCallback(){var e,t,n,i,r,o,s=this,a=[];if(super.doConnectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(r=this.querySelectorAll("img"),e=0;e<r.length;e++)i=OY(r[e]),a.push(new Promise((function(t,n){dH.Cache.add(r[e].getAttribute("src"),i),i.complete?t():(i.onload=t,i.onerror=n)})));for(n=this.querySelectorAll("audio, video"),e=0;e<n.length;e++)(t=OY(n[e])).src||t.srcObject||DY("Audio/video asset has neither `src` nor `srcObject` attributes."),a.push(kY(t));this.getChildren().forEach((function(e){e.isAssetItem&&e.hasAttribute("src")&&a.push(new Promise((function(t,n){if(e.hasLoaded)return t();e.addEventListener("loaded",t),e.addEventListener("error",n)})))})),Promise.allSettled(a).then((function(){null!==s.timeout&&s.load()})),o=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout((function(){s.hasLoaded||(DY("Asset loading timed out in",o,"ms"),s.timeout=null,s.emit("timeout"),s.load())}),o)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,(function(){return!1}))}}),customElements.define("a-asset-item",class extends J${constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var e=this,t=this.getAttribute("src");NY.setResponseType(this.getAttribute("response-type")||function(e){var t=function(e){var t=document.createElement("a");t.href=e;var n=t.search.replace(/^\?/,""),i=e.replace(n,"").replace("?","");return i.substring(i.lastIndexOf("/")+1)}(e),n=t.lastIndexOf(".");return n>=0&&".glb"===t.slice(n,e.search(/\?|#|$/))?"arraybuffer":"text"}(t)),NY.load(t,(function(t){e.data=t,J$.prototype.load.call(e)}),(function(t){e.emit("progress",{loadedBytes:t.loaded,totalBytes:t.total,xhr:t})}),(function(t){e.emit("error",{xhr:t},!1)}))}});var UY=qQ("core:cubemap:warn");class FY extends HTMLElement{constructor(e){return super(e)}onReadyStateChange(){"complete"===document.readyState&&this.doConnectedCallback()}connectedCallback(){"complete"===document.readyState?FY.prototype.doConnectedCallback.call(this):document.addEventListener("readystatechange",this.onReadyStateChange.bind(this))}doConnectedCallback(){this.srcs=this.validate()}validate(){var e,t=this.querySelectorAll("[src]"),n=[];if(6===t.length){for(e=0;e<t.length;e++)"IMG"===t[e].tagName?n.push(t[e]):n.push(t[e].getAttribute("src"));return n}UY("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",FY),customElements.define("a-mixin",class extends J${constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(e,t,n){super.attributeChangedCallback(),this.cacheAttribute(e,n),this.updateEntities()}setAttribute(e,t){window.HTMLElement.prototype.setAttribute.call(this,e,t),this.cacheAttribute(e,t)}cacheAttribute(e,t){var n,i;i=kq(e,"__")[0],n=E$[i],void 0===t&&(t=window.HTMLElement.prototype.getAttribute.call(this,e)),this.rawAttributeCache[e]=t,n&&(this.componentCache[e]=this.parseComponentAttrValue(n,t))}parseComponentAttrValue(e,t){var n;return"string"!=typeof t?t:(e.isSingleProperty?"string"==typeof(n=e.schema.parse(t))&&(n=t):n=oX(t),n)}getAttribute(e){return this.componentCache[e]||window.HTMLElement.prototype.getAttribute.call(this,e)}cacheAttributes(){var e,t,n=this.attributes;for(t=0;t<n.length;t++)e=n[t].name,this.cacheAttribute(e)}updateEntities(){var e,t,n;if(this.sceneEl)for(t=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),n=0;n<t.length;n++)(e=t[n]).hasLoaded&&!e.isMixin&&e.mixinUpdate(this.id)}});const zY="1.7.0";var jY=new dH.Color,VY=new dH.Color,GY=Uq,HY=Fq,WY={},QY="color",qY="rotation",XY="components";function $Y(e){e.x=dH.MathUtils.degToRad(e.x),e.y=dH.MathUtils.degToRad(e.y),e.z=dH.MathUtils.degToRad(e.z)}function YY(e,t,n){var i;for(i=0;i<t.length;i++)e.addEventListener(t[i],n)}function KY(e,t,n){var i;for(i=0;i<t.length;i++)e.removeEventListener(t[i],n)}function JY(e,t){var n,i,r;for(i=eK(t),r=e,n=0;n<i.length;n++)r=r[i[n]];if(void 0===r)throw console.log(e),new Error("[animation] property ("+t+") could not be found");return r}function ZY(e,t,n,i){var r,o,s,a;for(t.startsWith("object3D.rotation")&&(n=dH.MathUtils.degToRad(n)),o=eK(t),a=e,r=0;r<o.length-1;r++)a=a[o[r]];s=o[o.length-1],i!==QY?a[s]=n:"r"in a[s]?(a[s].r=n.r,a[s].g=n.g,a[s].b=n.b):(a[s].x=n.r,a[s].y=n.g,a[s].z=n.b)}function eK(e){return e in WY||(WY[e]=e.split(".")),WY[e]}function tK(e){return e.isRawProperty||e.property.startsWith(XY)||e.property.startsWith("object3D")}z$("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&parseInt(e,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var e=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){e.animationIsPlaying=!1,e.el.emit("animationcomplete",e.eventDetail,!1),e.id&&e.el.emit("animationcomplete__"+e.id,e.eventDetail,!1)}}},update:function(e){var t=this.config,n=this.data;this.animationIsPlaying=!1,this.data.enabled&&n.property&&(t.autoplay=!1,t.direction=n.dir,t.duration=n.dur,t.easing=n.easing,t.elasticity=n.elasticity,t.loop=n.loop,t.round=n.round,this.createAndStartAnimation())},tick:function(e,t){this.animationIsPlaying&&(this.time+=t,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var e=this.data;this.updateConfig(),this.animationIsPlaying=!1,this.animation=hH(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!e.autoplay||e.startEvents&&e.startEvents.length||(e.delay?setTimeout(this.beginAnimation,e.delay):this.beginAnimation())},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){this.data.enabled&&(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=hH(this.config),this.data.delay?setTimeout(this.beginAnimation,this.data.delay):this.beginAnimation())},updateConfigForRawColor:function(){var e,t,n,i=this.config,r=this.data,o=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(t in e=""===r.from?JY(o,r.property):r.from,n=r.to,this.setColorConfig(e,n),e=this.fromColor,n=this.toColor,this.targetsArray.length=0,this.targetsArray.push(e),i.targets=this.targetsArray,n)i[t]=n[t];var s;i.update=(s={},function(e){var t;(t=e.animatables[0].target).r===s.r&&t.g===s.g&&t.b===s.b||ZY(o,r.property,t,r.type)})}},updateConfigForDefault:function(){var e,t,n,i,r=this.config,o=this.data,s=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(e=""===o.from?tK(o)?JY(s,o.property):GY(s,o.property):o.from,n=o.to,isNaN(e||n)?(e=e?e.toString():e,n=n?n.toString():n):(e=parseFloat(e),n=parseFloat(n)),(t="true"===o.to||"false"===o.to||!0===o.to||!1===o.to)&&(e="true"===o.from||!0===o.from?1:0,n="true"===o.to||!0===o.to?1:0),this.targets.aframeProperty=e,r.targets=this.targets,r.aframeProperty=n,r.update=function(e){var n;(n=e.animatables[0].target.aframeProperty)!==i&&(i=n,t&&(n=n>=1),tK(o)?ZY(s,o.property,n,o.type):HY(s,o.property,n))})},updateConfigForVector:function(){var e,t,n,i,r=this.config,o=this.data,s=this.el,a=eK(o.property),l="object3D"===a[0]?a[1]:a[0];for(e in t=""!==o.from?Rq(o.from):GY(s,l),n=Rq(o.to),l===qY&&($Y(t),$Y(n)),this.targetsArray.length=0,this.targetsArray.push(t),r.targets=this.targetsArray,n)r[e]=n[e];r.update="position"!==l&&l!==qY&&"scale"!==l?function(){var e={};return function(t){var n=t.animatables[0].target;n.x===e.x&&n.y===e.y&&n.z===e.z||(e.x=n.x,e.y=n.y,e.z=n.z,HY(s,o.property,n))}}():(i={},function(e){var t=e.animatables[0].target;t.x===i.x&&t.y===i.y&&t.z===i.z||(i.x=t.x,i.y=t.y,i.z=t.z,s.object3D[l].set(t.x,t.y,t.z))})},updateConfig:function(){var e;e=function(e,t){var n,i,r,o;return"object3D"!==(r=t.split("."))[0]||r[2]||"position"!==r[1]&&"rotation"!==r[1]&&"scale"!==r[1]?(i=r[0],o=r[1],(n=e.components[i]||E$[i])?o&&!n.schema[o]?null:o?n.schema[o].type:n.schema.type:null):"vec3"}(this.el,this.data.property),tK(this.data)&&this.data.type===QY?this.updateConfigForRawColor():"vec2"===e||"vec3"===e||"vec4"===e?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(e){var t,n=this.data,i=this.el,r=this;return""===n.from&&!!n.property.startsWith(XY)&&(t=eK(n.property)[1],!i.components[t]&&(i.addEventListener("componentinitialized",(function n(o){o.detail.name===t&&(e(),r.animation=hH(r.config),i.removeEventListener("componentinitialized",n))})),!0))},stopRelatedAnimations:function(){var e,t;for(t in this.el.components)e=this.el.components[t],t!==this.attrName&&"animation"===e.name&&e.animationIsPlaying&&e.data.property===this.data.property&&(e.animationIsPlaying=!1)},addEventListeners:function(){var e=this.data,t=this.el;YY(t,e.startEvents,this.onStartEvent),YY(t,e.pauseEvents,this.pauseAnimation),YY(t,e.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var e=this.data,t=this.el;KY(t,e.startEvents,this.onStartEvent),KY(t,e.pauseEvents,this.pauseAnimation),KY(t,e.resumeEvents,this.resumeAnimation)},setColorConfig:function(e,t){jY.set(e),VY.set(t),e=this.fromColor,t=this.toColor,e.r=jY.r,e.g=jY.g,e.b=jY.b,t.r=VY.r,t.g=VY.g,t.b=VY.b}});var nK=qQ("components:anchored:warn");z$("anchored",{schema:{persistent:{default:!1}},init:function(){var e=this.el.sceneEl.getAttribute("webxr"),t=e.optionalFeatures;-1===t.indexOf("anchors")&&(t.push("anchors"),this.el.sceneEl.setAttribute("webxr",e)),this.auxQuaternion=new dH.Quaternion,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var e,t,n,i=this.el.sceneEl,r=i.renderer.xr,o=this.el.object3D;(i.is("ar-mode")||i.is("vr-mode"))&&(!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(e=i.frame,t=r.getReferenceSpace(),n=e.getPose(this.anchor.anchorSpace,t),o.position.copy(n.transform.position),o.quaternion.copy(n.transform.orientation)))},createAnchor:async function(e,t){var n,i,r,o,s=this.el.sceneEl,a=s.renderer.xr,l=this.el.object3D;e=e||l.position,t=t||this.auxQuaternion.setFromEuler(l.rotation),function(e){var t=e.renderer.xr.getSession();return t&&t.restorePersistentAnchor}(s)?(this.anchor&&this.deleteAnchor(),n=s.frame,i=a.getReferenceSpace(),r=new XRRigidTransform({x:e.x,y:e.y,z:e.z},{x:t.x,y:t.y,z:t.z,w:t.w}),this.requestAnchorPending=!1,o=await n.createAnchor(r,i),this.data.persistent&&(this.el.id?(this.persistentHandle=await o.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):nK("The anchor won't be persisted because the entity has no assigned id.")),s.object3D.attach(this.el.object3D),this.anchor=o):nK("This browser doesn't support the WebXR anchors module")},restorePersistentAnchor:async function(){var e,t=this.el.sceneEl.renderer.xr.getSession(),n=t.persistentAnchors;if(this.requestPersistentAnchorPending=!1,!this.el.id)return nK("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),void(this.requestAnchorPending=!0);if(n){e=localStorage.getItem(this.el.id);for(var i=0;i<n.length;++i)if(e===n[i]){this.anchor=await t.restorePersistentAnchor(n[i]),this.anchor&&(this.persistentHandle=n[i]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var e,t=this.anchor;t&&(e=this.el.sceneEl.renderer.xr.getSession(),t.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&e.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}}),z$("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var e,t=this.el;e=this.camera=new dH.PerspectiveCamera,t.setObject3D("camera",e)},update:function(e){var t=this.data,n=this.camera;n.aspect=t.aspect||window.innerWidth/window.innerHeight,n.far=t.far,n.fov=t.fov,n.near=t.near,n.zoom=t.zoom,n.updateProjectionMatrix(),this.updateActiveCamera(e),this.updateSpectatorCamera(e)},updateActiveCamera:function(e){var t=this.data,n=this.el,i=this.system;e&&e.active===t.active||t.spectator||(t.active&&i.activeCameraEl!==n?i.setActiveCamera(n):t.active||i.activeCameraEl!==n||i.disableActiveCamera())},updateSpectatorCamera:function(e){var t=this.data,n=this.el,i=this.system;e&&e.spectator===t.spectator||(t.spectator&&i.spectatorCameraEl!==n?i.setSpectatorCamera(n):t.spectator||i.spectatorCameraEl!==n||i.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}});var iK,rK,oK,sK,aK="click",lK="mouseup",cK="cursor-fusing",uK="cursor-hovering",hK="cursor-hovered",dK={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},pK={DOWN:["selectstart"],UP:["selectend"]},fK="a-mouse-cursor-hover",mK=(z$("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:aq()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var e=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=CX((function(){e.canvasBounds=e.el.sceneEl.canvas.getBoundingClientRect()}),500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(e){var t=this.data.rayOrigin;t!==e.rayOrigin&&("entity"===t&&this.resetRaycaster(),this.updateMouseEventListeners(),"xrselect"!==t&&"entity"!==t||this.addWebXREventListeners(),"xrselect"!==e.rayOrigin&&"entity"!==e.rayOrigin||this.removeWebXREventListeners())},tick:function(){var e=this.el.sceneEl.frame,t=this.activeXRInput;"xrselect"===this.data.rayOrigin&&e&&t&&this.onMouseMove({frame:e,inputSource:t,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var e=this.el;e.removeState(uK),e.removeState(cK),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(hK),this.removeEventListeners()},addEventListeners:function(){var e,t=this.data,n=this.el,i=this;function r(){e=n.sceneEl.canvas,t.downEvents.length||t.upEvents.length||(dK.DOWN.forEach((function(t){e.addEventListener(t,i.onCursorDown,{passive:!1})})),dK.UP.forEach((function(t){e.addEventListener(t,i.onCursorUp,{passive:!1})})))}(e=n.sceneEl.canvas)?r():n.sceneEl.addEventListener("render-target-loaded",r),t.downEvents.forEach((function(e){n.addEventListener(e,i.onCursorDown)})),t.upEvents.forEach((function(e){n.addEventListener(e,i.onCursorUp)})),n.addEventListener("raycaster-intersection",this.onIntersection),n.addEventListener("raycaster-closest-entity-changed",this.onIntersection),n.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),n.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),n.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var e,t=this.data,n=this.el,i=this;!(e=n.sceneEl.canvas)||t.downEvents.length||t.upEvents.length||(dK.DOWN.forEach((function(t){e.removeEventListener(t,i.onCursorDown)})),dK.UP.forEach((function(t){e.removeEventListener(t,i.onCursorUp)}))),t.downEvents.forEach((function(e){n.removeEventListener(e,i.onCursorDown)})),t.upEvents.forEach((function(e){n.removeEventListener(e,i.onCursorUp)})),n.removeEventListener("raycaster-intersection",this.onIntersection),n.removeEventListener("raycaster-closest-entity-changed",this.onIntersection),n.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("touchstart",this.onMouseMove),e.removeEventListener("touchmove",this.onMouseMove),n.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),n.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds),this.removeWebXREventListeners()},updateMouseEventListeners:function(){var e,t=this.el;(e=t.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("touchmove",this.onMouseMove),t.setAttribute("raycaster","useWorldCoordinates",!1),"mouse"===this.data.rayOrigin&&(e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("touchmove",this.onMouseMove,{passive:!1}),t.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},resetRaycaster:function(){this.el.setAttribute("raycaster",{direction:(new dH.Vector3).set(0,0,-1),origin:new dH.Vector3})},addWebXREventListeners:function(){var e=this,t=this.el.sceneEl.xrSession;t&&(pK.DOWN.forEach((function(n){t.addEventListener(n,e.onCursorDown)})),pK.UP.forEach((function(n){t.addEventListener(n,e.onCursorUp)})))},removeWebXREventListeners:function(){var e=this,t=this.el.sceneEl.xrSession;t&&(pK.DOWN.forEach((function(n){t.removeEventListener(n,e.onCursorDown)})),pK.UP.forEach((function(n){t.removeEventListener(n,e.onCursorUp)})))},onMouseMove:(iK=new dH.Vector3,rK=new dH.Vector2,oK=new dH.Vector3,sK={origin:oK,direction:iK},function(e){var t,n,i,r,o,s,a,l,c,u=this.canvasBounds,h=this.el.sceneEl.camera;h.parent.updateMatrixWorld(),n=(i="touchmove"===e.type||"touchstart"===e.type?e.touches.item(0):e).clientX-u.left,r=i.clientY-u.top,rK.x=n/u.width*2-1,rK.y=-r/u.height*2+1,"xrselect"!==this.data.rayOrigin||"selectstart"!==e.type&&"fakeselectevent"!==e.type?"fakeselectout"===e.type?(iK.set(0,1,0),oK.set(0,9999,0)):h&&h.isPerspectiveCamera?(oK.setFromMatrixPosition(h.matrixWorld),iK.set(rK.x,rK.y,.5).unproject(h).sub(oK).normalize()):h&&h.isOrthographicCamera?(oK.set(rK.x,rK.y,(h.near+h.far)/(h.near-h.far)).unproject(h),iK.set(0,0,-1).transformDirection(h.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+h.type):(o=e.frame,s=e.inputSource,a=this.el.sceneEl.renderer.xr.getReferenceSpace(),(l=o.getPose(s.targetRaySpace,a))&&(c=l.transform,iK.set(0,0,-1),iK.applyQuaternion(c.orientation),oK.copy(c.position),(t=h.el.object3D.parent).localToWorld(oK),iK.transformDirection(t.matrixWorld))),this.el.setAttribute("raycaster",sK),"touchmove"===e.type&&e.preventDefault()}),onCursorDown:function(e){this.isCursorDown=!0,"mouse"===this.data.rayOrigin&&"touchstart"===e.type&&(this.onMouseMove(e),this.el.components.raycaster.checkIntersections(),e.preventDefault()),"xrselect"===this.data.rayOrigin&&"selectstart"===e.type&&(this.activeXRInput=e.inputSource,this.onMouseMove(e),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&void 0!==this.el.sceneEl.components["ar-hit-test"]&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit("mousedown",e),this.cursorDownEl=this.intersectedEl},onCursorUp:function(e){if(this.isCursorDown&&("xrselect"!==this.data.rayOrigin||this.activeXRInput===e.inputSource)){this.isCursorDown=!1;var t=this.data;this.twoWayEmit(lK,e),!0===this.reenableARHitTest&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(lK,this.intersectedEventDetail)),t.fuse&&"mouse"!==t.rayOrigin&&"xrselect"!==t.rayOrigin||!this.intersectedEl||this.cursorDownEl!==this.intersectedEl||this.twoWayEmit(aK,e),"xrselect"===t.rayOrigin&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,"touchend"===e.type&&e.preventDefault()}},onIntersection:function(e){var t,n,i,r,o=this.el;n=e.detail.els[0]===o?1:0,r=e.detail.intersections[n],(i=e.detail.els[n])&&this.intersectedEl!==i&&(this.intersectedEl&&(t=this.el.components.raycaster.getIntersection(this.intersectedEl))&&t.distance<=r.distance||(this.clearCurrentIntersection(!0),this.setIntersection(i,r)))},onIntersectionCleared:function(e){-1!==e.detail.clearedEls.indexOf(this.intersectedEl)&&this.clearCurrentIntersection()},onEnterVR:function(){var e=this.data.rayOrigin;this.clearCurrentIntersection(!0),"xrselect"!==e&&"entity"!==e||this.addWebXREventListeners()},setIntersection:function(e,t){var n=this.el,i=this.data,r=this;this.intersectedEl!==e&&(this.intersectedEl=e,n.addState(uK),e.addState(hK),this.twoWayEmit("mouseenter"),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.add(fK),0!==i.fuseTimeout&&i.fuse&&"xrselect"!==i.rayOrigin&&"mouse"!==i.rayOrigin&&(n.addState(cK),this.twoWayEmit("fusing"),this.fuseTimeout=setTimeout((function(){n.removeState(cK),r.twoWayEmit(aK)}),i.fuseTimeout)))},clearCurrentIntersection:function(e){var t,n,i=this.el;this.intersectedEl&&(this.intersectedEl.removeState(hK),i.removeState(uK),i.removeState(cK),this.twoWayEmit("mouseleave"),this.data.mouseCursorStylesEnabled&&"mouse"===this.data.rayOrigin&&this.el.sceneEl.canvas.classList.remove(fK),this.intersectedEl=null,clearTimeout(this.fuseTimeout),!0!==e&&0!==(n=this.el.components.raycaster.intersections).length&&(t=n[n[0].object.el===i?1:0])&&this.setIntersection(t.object.el,t))},twoWayEmit:function(e,t){var n,i=this.el,r=this.intersectedEl;function o(e,n){t instanceof MouseEvent?e.mouseEvent=t:"undefined"!=typeof TouchEvent&&t instanceof TouchEvent&&(e.touchEvent=t)}n=this.el.components.raycaster.getIntersection(r),this.eventDetail.intersectedEl=r,this.eventDetail.intersection=n,o(this.eventDetail),i.emit(e,this.eventDetail),r&&(this.intersectedEventDetail.intersection=n,o(this.intersectedEventDetail),r.emit(e,this.intersectedEventDetail))}}),new dH.BufferGeometry),gK=(z$("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:yY,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(e){var t,n=this.data,i=this.el,r=this.system;this.geometry&&(r.unuseGeometry(e),this.geometry=null),this.geometry=r.getOrCreateGeometry(n),(t=i.getObject3D("mesh"))?t.geometry=this.geometry:((t=new dH.Mesh).geometry=this.geometry,this.el.getAttribute("material")||(t.material=new dH.MeshStandardMaterial({color:16777215*Math.random(),metalness:0,roughness:.5})),i.setObject3D("mesh",t))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=mK,this.geometry=null},updateSchema:function(e){var t=this.oldData&&this.oldData.primitive,n=e.primitive,i=vY[n]&&vY[n].schema;if(!i)throw new Error("Unknown geometry schema `"+n+"`");t&&t===n||this.extendSchema(i)}}),"generic"),vK=(z$("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},disabled:{default:!1}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.bindMethods(),this.el.addEventListener("controllerconnected",(function(t){t.detail.name!==e.name&&(e.wasControllerConnected=!0,e.removeEventListeners(),e.removeControllersUpdateListener())}))},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data,t=e.hand?e.hand:void 0;pX(this,gK,{hand:t,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;this.el.components["tracked-controls"]?this.removeEventListeners():(e.setAttribute("tracked-controls",{hand:t.hand,idPrefix:gK,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel())},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){gX(this,this.mapping.axes,e)},initDefaultModel:function(){var e=this.modelEl=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"sphere",radius:.03}),e.setAttribute("material",{color:this.data.color}),this.el.appendChild(e),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}}),qQ("components:gltf-model:warn"));z$("gltf-model",{schema:{type:"model"},init:function(){var e=this,t=this.system.getDRACOLoader(),n=this.system.getMeshoptDecoder(),i=this.system.getKTX2Loader();this.model=null,this.loader=new RH,t&&this.loader.setDRACOLoader(t),this.ready=n?n.then((function(t){e.loader.setMeshoptDecoder(t)})):Promise.resolve(),i&&this.loader.setKTX2Loader(i)},update:function(){var e=this,t=this.el,n=this.data;n&&(this.remove(),this.ready.then((function(){e.loader.load(n,(function(n){e.model=n.scene||n.scenes[0],e.model.animations=n.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})}),void 0,(function(e){var i=e&&e.message?e.message:"Failed to load glTF model";vK(i),t.emit("model-error",{format:"gltf",src:n})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),z$("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}});var yK,AK=jQ+"controllers/oculus-hands/v4/left.glb",xK=jQ+"controllers/oculus-hands/v4/right.glb",bK=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];z$("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var e=0;e<this.jointEls.length;++e)this.jointEls[e].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var e=0;e<this.jointEls.length;++e)this.jointEls[e].object3D.visible=!1},init:function(){var e=this.el.sceneEl,t=e.getAttribute("webxr"),n=t.optionalFeatures;-1===n.indexOf("hand-tracking")&&(n.push("hand-tracking"),e.setAttribute("webxr",t)),this.wristObject3D=new dH.Object3D,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new dH.Vector3,wristRotation:new dH.Quaternion},this.indexTipPosition=new dH.Vector3,this.hasPoses=!1,this.jointPoses=new Float32Array(16*bK.length),this.jointRadii=new Float32Array(bK.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.wristObject3D.visible=!1},onChildAttached:function(e){this.addChildEntity(e.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var e=this.jointEls,t=this.skinnedMesh,n=!(1===this.data.modelOpacity);t&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=n,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var i=0;i<e.length;i++)e[i].setAttribute("material",{color:this.data.modelColor,transparent:n,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var e=this,t=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,t){var n=e.el.sceneEl.systems.webxr.sessionReferenceSpaceType;t.requestReferenceSpace(n).then((function(t){e.referenceSpace=t})).catch((function(t){throw e.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(n,"tracked-controls-webxr uses reference space "+n),t}))}},checkIfControllerPresent:function(){var e=this.data;pX(this,"",{hand:e.hand?e.hand:void 0,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var e=this.el.sceneEl,t=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,n=e.frame,i=this.el.components["tracked-controls"],r=this.referenceSpace;t&&n&&r&&i&&(this.hasPoses=!1,t.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=n.fillPoses(t.hand.values(),r,this.jointPoses)&&n.fillJointRadii(t.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:(yK=new dH.Matrix4,function(){var e=this.wristObject3D;e&&this.hasPoses&&(yK.fromArray(this.jointPoses,0),e.position.setFromMatrixPosition(yK),e.quaternion.setFromRotationMatrix(yK))}),updateHandModel:function(){this.wristObject3D.visible=!0,this.el.object3D.visible=!0,"dots"===this.data.modelStyle&&this.updateHandDotsModel(),"mesh"===this.data.modelStyle&&this.updateHandMeshModel()},getBone:function(e){for(var t=this.bones,n=0;n<t.length;n++)if(t[n].name===e)return t[n];return null},updateHandMeshModel:function(){var e=new dH.Matrix4;return function(){var t=0,n=this.jointPoses,i=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(i&&this.mesh&&(this.mesh.visible=!1,this.hasPoses))for(var r of i.hand.values()){var o=this.getBone(r.jointName);null!=o&&(this.mesh.visible=!0,e.fromArray(n,16*t),o.position.setFromMatrixPosition(e),o.quaternion.setFromRotationMatrix(e)),t++}}}(),updateHandDotsModel:function(){for(var e,t,n=this.jointPoses,i=this.jointRadii,r=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,o=0;o<r.hand.size;o++)t=(e=this.jointEls[o]).object3D,e.object3D.visible=this.hasPoses,this.hasPoses&&(t.matrix.fromArray(n,16*o),t.matrix.decompose(t.position,t.rotation,t.scale),e.setAttribute("scale",{x:i[o],y:i[o],z:i[o]}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var e=new dH.Vector3,t=new dH.Matrix4;return function(){var n=this.indexTipPosition,i=this.pinchEventDetail;if(this.hasPoses){e.setFromMatrixPosition(t.fromArray(this.jointPoses,64)),n.setFromMatrixPosition(t.fromArray(this.jointPoses,144)),i.wristRotation.setFromRotationMatrix(t.fromArray(this.jointPoses,0));var r=n.distanceTo(e);r<.015&&!1===this.isPinched&&(this.isPinched=!0,i.position.copy(n).add(e).multiplyScalar(.5),this.el.emit("pinchstarted",i)),r>.02&&!0===this.isPinched&&(this.isPinched=!1,i.position.copy(n).add(e).multiplyScalar(.5),this.el.emit("pinchended",i)),this.isPinched&&(i.position.copy(n).add(e).multiplyScalar(.5),this.el.emit("pinchmoved",i))}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{id:"",hand:t.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh?this.mesh!==e.getObject3D("mesh")&&e.setObject3D("mesh",this.mesh):this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var e,t=this.el;this.checkIfControllerPresent(),e=t.components["tracked-controls"]&&t.components["tracked-controls"].controller,this.mesh&&e&&e.hand&&e.hand instanceof XRHand&&t.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var e=this.data;"dots"===e.modelStyle&&this.initDotsModel(),"mesh"===e.modelStyle&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(0===this.jointEls.length){for(var e=0;e<bK.length;++e){var t=this.jointEl=document.createElement("a-entity");t.setAttribute("geometry",{primitive:"sphere",radius:1}),t.object3D.visible=!1,this.el.appendChild(t),this.jointEls.push(t)}this.updateModelMaterial()}},initMeshHandModel:function(){var e="left"===this.data.hand?AK:xK;this.el.setAttribute("gltf-model",e)},onModelLoaded:function(){var e=this.mesh=this.el.getObject3D("mesh").children[0],t=this.skinnedMesh=e.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=t.skeleton.bones,this.el.removeObject3D("mesh"),e.position.set(0,0,0),e.rotation.set(0,0,0),t.frustumCulled=!1,t.material=new dH.MeshStandardMaterial,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",e))},setupChildrenEntities:function(){for(var e=this.el.children,t=0;t<e.length;++t)e[t]instanceof rY&&this.addChildEntity(e[t])},addChildEntity:function(e){e instanceof rY&&this.wristObject3D.add(e.object3D)}}),z$("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var e,t=this.el,n=this.data;e="right"===n.hand?"components.hand-tracking-controls.bones.3":"components.hand-tracking-controls.bones.21",t.setAttribute("hand-tracking-controls",{hand:n.hand}),t.setAttribute("obb-collider",{trackedObject3D:e,size:.04}),this.auxMatrix=new dH.Matrix4,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded)},transferEntityOwnership:function(){for(var e,t=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),n=0;n<t.length;++n)(e=t[n].components["hand-tracking-grab-controls"])!==this&&this.grabbedEl&&this.grabbedEl===e.grabbedEl&&e.releaseGrabbedEntity();return!1},onCollisionStarted:function(e){var t=e.detail.withEl;this.collidedEl||t.getAttribute("grabbable")&&(this.collidedEl=t,this.grabbingObject3D=e.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,this.grabbedEl||(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(e){this.collidedEl&&(this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},releaseGrabbedEntity:function(){var e=this.grabbedEl;if(e){var t=e.object3D,n=t.parent,i=this.originalParent;t.applyMatrix4(n.matrixWorld),t.applyMatrix4(this.auxMatrix.copy(i.matrixWorld).invert()),n.remove(t),i.add(t),this.el.emit("grabended",{grabbedEl:e}),this.grabbedEl=void 0,this.originalParent=void 0}},grab:function(){var e=this.grabbedEl,t=e.object3D,n=t.parent;this.originalParent=n;var i=this.el.components["hand-tracking-controls"].wristObject3D;t.applyMatrix4(n.matrixWorld),t.applyMatrix4(this.auxMatrix.copy(i.matrixWorld).invert()),n.remove(t),i.add(t),this.el.emit("grabstarted",{grabbedEl:e})}});var _K={toonLeft:jQ+"controllers/hands/leftHand.glb",toonRight:jQ+"controllers/hands/rightHand.glb",lowPolyLeft:jQ+"controllers/hands/leftHandLow.glb",lowPolyRight:jQ+"controllers/hands/rightHandLow.glb",highPolyLeft:jQ+"controllers/hands/leftHandHigh.glb",highPolyRight:jQ+"controllers/hands/rightHandHigh.glb"},wK="Point",EK="Fist",SK="Thumb Up",CK={};function MK(e,t){var n;if(e)return"grip"===(n=CK[e])?n+(t?"close":"open"):"point"===n?n+(t?"up":"down"):"pointing"===n||"pistol"===n?n+(t?"start":"end"):void 0}CK[EK]="grip",CK[SK]="pistol",CK[wK]="pointing",z$("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var e=this,t=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new RH,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){e.handleButton("grip","down")},this.onGripUp=function(){e.handleButton("grip","up")},this.onTrackpadDown=function(){e.handleButton("trackpad","down")},this.onTrackpadUp=function(){e.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){e.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){e.handleButton("trackpad","touchend")},this.onTriggerDown=function(){e.handleButton("trigger","down")},this.onTriggerUp=function(){e.handleButton("trigger","up")},this.onTriggerTouchStart=function(){e.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){e.handleButton("trigger","touchend")},this.onGripTouchStart=function(){e.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){e.handleButton("grip","touchend")},this.onThumbstickDown=function(){e.handleButton("thumbstick","down")},this.onThumbstickUp=function(){e.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){e.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){e.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){e.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){e.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){e.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){e.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),t.addEventListener("controllerconnected",this.onControllerConnected),t.addEventListener("controllerdisconnected",this.onControllerDisconnected),t.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(e,t){var n=this.el.getObject3D("mesh");n&&n.mixer&&n.mixer.update(t/1e3)},onControllerConnected:function(e){var t=this.el,n=this.data.hand,i=this.el.getObject3D("mesh");t.object3D.visible=!0;var r="left"===n?Math.PI/2:-Math.PI/2,o=t.sceneEl.hasWebXR?-Math.PI/2:0;"pico-controls"===e.detail.name&&(o+=Math.PI/4),i.position.set(0,0,0),i.rotation.set(o,0,r)},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var e=this.el;e.addEventListener("gripdown",this.onGripDown),e.addEventListener("gripup",this.onGripUp),e.addEventListener("trackpaddown",this.onTrackpadDown),e.addEventListener("trackpadup",this.onTrackpadUp),e.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),e.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),e.addEventListener("triggerdown",this.onTriggerDown),e.addEventListener("triggerup",this.onTriggerUp),e.addEventListener("triggertouchstart",this.onTriggerTouchStart),e.addEventListener("triggertouchend",this.onTriggerTouchEnd),e.addEventListener("griptouchstart",this.onGripTouchStart),e.addEventListener("griptouchend",this.onGripTouchEnd),e.addEventListener("thumbstickdown",this.onThumbstickDown),e.addEventListener("thumbstickup",this.onThumbstickUp),e.addEventListener("abuttontouchstart",this.onAorXTouchStart),e.addEventListener("abuttontouchend",this.onAorXTouchEnd),e.addEventListener("bbuttontouchstart",this.onBorYTouchStart),e.addEventListener("bbuttontouchend",this.onBorYTouchEnd),e.addEventListener("xbuttontouchstart",this.onAorXTouchStart),e.addEventListener("xbuttontouchend",this.onAorXTouchEnd),e.addEventListener("ybuttontouchstart",this.onBorYTouchStart),e.addEventListener("ybuttontouchend",this.onBorYTouchEnd),e.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),e.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var e=this.el;e.removeEventListener("gripdown",this.onGripDown),e.removeEventListener("gripup",this.onGripUp),e.removeEventListener("trackpaddown",this.onTrackpadDown),e.removeEventListener("trackpadup",this.onTrackpadUp),e.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),e.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),e.removeEventListener("triggerdown",this.onTriggerDown),e.removeEventListener("triggerup",this.onTriggerUp),e.removeEventListener("triggertouchstart",this.onTriggerTouchStart),e.removeEventListener("triggertouchend",this.onTriggerTouchEnd),e.removeEventListener("griptouchstart",this.onGripTouchStart),e.removeEventListener("griptouchend",this.onGripTouchEnd),e.removeEventListener("thumbstickdown",this.onThumbstickDown),e.removeEventListener("thumbstickup",this.onThumbstickUp),e.removeEventListener("abuttontouchstart",this.onAorXTouchStart),e.removeEventListener("abuttontouchend",this.onAorXTouchEnd),e.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),e.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),e.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),e.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),e.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),e.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),e.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),e.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(e){var t,n=this.el,i=this.data.hand,r=this.data.handModelStyle,o=this.data.color,s=this;if(t={hand:i,model:!1},i!==e){var a=_K[r+i.charAt(0).toUpperCase()+i.slice(1)];this.loader.load(a,(function(e){var i=e.scene.children[0];i.mixer=new dH.AnimationMixer(i),s.clips=e.animations,n.setObject3D("mesh",i),i.traverse((function(e){e.isMesh&&(e.material.color=new dH.Color(o))})),n.setAttribute("magicleap-controls",t),n.setAttribute("vive-controls",t),n.setAttribute("meta-touch-controls",t),n.setAttribute("pico-controls",t),n.setAttribute("windows-motion-controls",t),n.setAttribute("hp-mixed-reality-controls",t)}))}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(e,t){var n,i="down"===t,r="touchstart"===t;if(0===t.indexOf("touch")){if(r===this.touchedButtons[e])return;this.touchedButtons[e]=r}else{if(i===this.pressedButtons[e])return;this.pressedButtons[e]=i}n=this.gesture,this.gesture=this.determineGesture(),this.gesture!==n&&(this.animateGesture(this.gesture,n),this.emitGestureEvents(this.gesture,n))},determineGesture:function(){var e,t,n,i=this.pressedButtons.grip,r=this.pressedButtons.surface||this.touchedButtons.surface,o=this.pressedButtons.trackpad||this.touchedButtons.trackpad,s=this.pressedButtons.trigger||this.touchedButtons.trigger,a=this.touchedButtons.AorX||this.touchedButtons.BorY;return(n=(t=this.el.components["tracked-controls"])&&t.controller)&&(n.id&&0===n.id.indexOf("OpenVR ")||n.profiles&&n.profiles[0]&&"htc-vive"===n.profiles[0])?i||s?e=EK:o&&(e=wK):i?e=r||a||o?s?EK:wK:s?SK:"Point + Thumb":s&&(e="Hold"),e},getClip:function(e){var t,n;for(n=0;n<this.clips.length;n++)if((t=this.clips[n]).name===e)return t},animateGesture:function(e,t){e?this.playAnimation(e||"Open",t,!1):this.playAnimation(t,t,!0)},emitGestureEvents:function(e,t){var n,i=this.el;t!==e&&((n=MK(t,!1))&&i.emit(n),(n=MK(e,!0))&&i.emit(n))},playAnimation:function(e,t,n){var i,r,o=this.el.getObject3D("mesh");if(o){if(i=this.getClip(e),r=o.mixer.clipAction(i),n)return r.paused=!1,void(r.timeScale=-1);if(r.clampWhenFinished=!0,r.loop=dH.LoopOnce,r.repetitions=0,r.timeScale=1,r.time=0,r.weight=1,!t)return o.mixer.stopAllAction(),void r.play();i=this.getClip(t),r.reset(),r.play(),o.mixer.clipAction(i).crossFadeTo(r,.15,!0)}}}),z$("hide-on-enter-ar",{init:function(){var e=this;this.el.sceneEl.addEventListener("enter-vr",(function(){e.el.sceneEl.is("ar-mode")&&(e.el.object3D.visible=!1)})),this.el.sceneEl.addEventListener("exit-vr",(function(){e.el.object3D.visible=!0}))}}),z$("hide-on-enter-vr",{init:function(){var e=this;this.el.sceneEl.addEventListener("enter-vr",(function(){e.el.sceneEl.is("vr-mode")&&(e.el.object3D.visible=!1)})),this.el.sceneEl.addEventListener("exit-vr",(function(){e.el.object3D.visible=!0}))}});var TK="hp-mixed-reality",RK=jQ+"controllers/hp/mixed-reality/",IK={x:0,y:0,z:.06},PK={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},BK=(z$("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var e=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(t){vX(t.detail.id,"up",e,e.data.hand)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e,e.data.hand)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e,e.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;pX(this,TK,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:TK,hand:t.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",RK+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,n=this.mapping[this.data.hand].buttons[e.detail.id];n&&("trigger"===n&&(t=e.detail.state.value,console.log("analog value of trigger press: "+t)),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){var t=e.detail.model;this.data.model&&(t.position.copy(IK),t.rotation.copy(PK),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new dH.Vector3(0,0,0)}))},onAxisMoved:function(e){gX(this,this.mapping.axes,e)}}),qQ("components:layer:warn"));function LK(e,t,n){return(t.dot(e)-t.dot(n))/t.length()}z$("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var e=this.el.sceneEl.renderer.getContext();this.quaternion=new dH.Quaternion,this.position=new dH.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=e.createFramebuffer();var t=this.el.sceneEl.getAttribute("webxr"),n=t.requiredFeatures;-1===n.indexOf("layers")&&(n.push("layers"),this.el.sceneEl.setAttribute("webxr",t)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(e){this.data.src!==e.src&&this.updateSrc()},updateSrc:function(){var e=this.data.type;this.texture=void 0,"quad"!==e?"monocubemap"!==e&&"stereocubemap"!==e||this.loadCubeMapImages():this.loadQuadImage()},loadCubeMapImages:function(){var e,t=this.xrGLFactory,n=this.el.sceneEl.frame,i=this.data.src,r=this.data.type;this.visibilityChanged=!1,this.layer&&("monocubemap"!==r&&"stereocubemap"!==r||(i.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,"monocubemap"===r?(e=t.getSubImage(this.layer,n),this.loadCubeMapImage(e.colorTexture,i,0)):(e=t.getSubImage(this.layer,n,"left"),this.loadCubeMapImage(e.colorTexture,i,0),e=t.getSubImage(this.layer,n,"right"),this.loadCubeMapImage(e.colorTexture,i,6))))},loadQuadImage:function(){var e=this.data.src,t=this;this.el.sceneEl.systems.material.loadTexture(e,{src:e},(function(n){t.el.sceneEl.renderer.initTexture(n),t.texture=n,"VIDEO"===e.tagName&&setTimeout((function(){t.textureIsVideo=!0}),1e3),t.layer&&(t.layer.height=t.data.height/2||t.texture.image.height/1e3,t.layer.width=t.data.width/2||t.texture.image.width/1e3,t.needsRedraw=!0),t.updateQuadPanel()}))},preGenerateCubeMapTextures:function(e,t){"monocubemap"===this.data.type?this.generateCubeMapTextures(e,0,t):(this.generateCubeMapTextures(e,0,t),this.generateCubeMapTextures(e,6,t))},generateCubeMapTextures:function(e,t,n){for(var i,r,o=this.data,s=this.cubeFaceSize,a=Math.min(e.width,e.height),l=[],c=0;c<6;c++){var u=document.createElement("CANVAS");u.width=u.height=s;var h=u.getContext("2d");o.rotateCubemap&&(2!==c&&3!==c||(h.save(),h.translate(s,s),h.rotate(Math.PI))),h.drawImage(e,(c+t)*a,0,a,a,0,0,s,s),h.restore(),n&&n(),l.push(u)}return o.rotateCubemap&&(i=l[0],r=l[1],l[0]=r,l[1]=i,i=l[4],r=l[5],l[4]=r,l[5]=i),n&&n(),l},loadCubeMapImage:function(e,t,n){var i,r=this.el.sceneEl.renderer.getContext();r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.bindTexture(r.TEXTURE_CUBE_MAP,e),i=!t.complete||this.loadingScreen?this.loadingScreenImages:this.generateCubeMapTextures(t,n);var o=0;i.forEach((function(e,t){r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,r.RGBA,r.UNSIGNED_BYTE,e),o=r.getError()})),0!==o&&console.log("renderingError, WebGL Error Code: "+o),r.bindTexture(r.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&this.referenceSpace&&(this.layer||!this.el.sceneEl.is("vr-mode")&&!this.el.sceneEl.is("ar-mode")||this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),(this.needsRedraw||this.layer.needsRedraw||this.textureIsVideo)&&("quad"===this.data.type&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var e=this,t=this.data.type;this.el.sceneEl.xrSession.onvisibilitychange=function(t){e.visibilityChanged="hidden"!==t.session.visibilityState},"quad"!==t?"monocubemap"!==t&&"stereocubemap"!==t||this.initCubeMapLayer():this.initQuadLayer()},initQuadLayer:function(){var e=this.el.sceneEl,t=e.renderer.getContext(),n=this.xrGLFactory=new XRWebGLBinding(e.xrSession,t);this.texture&&(this.layer=n.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),e.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var e=this.data.src,t=this.el.sceneEl,n=t.renderer.getContext(),i=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),r=this.cubeFaceSize=Math.min(i,Math.min(e.width,e.height)),o=this.xrGLFactory=new XRWebGLBinding(t.xrSession,n);this.layer=o.createCubeLayer({space:this.referenceSpace,viewPixelWidth:r,viewPixelHeight:r,layout:"monocubemap"===this.data.type?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),t.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var e=this.cubeFaceSize,t=this.loadingScreenImages=[],n=0;n<6;n++){var i=document.createElement("CANVAS");i.width=i.height=e;var r=i.getContext("2d");i.width=i.height=e,r.fillStyle="black",r.fillRect(0,0,e,e),2!==n&&3!==n&&(r.translate(e,0),r.scale(-1,1),r.fillStyle="white",r.font="30px Arial",r.fillText("Loading",e/2,e/2)),t.push(i)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(e){this.layerEnabled=e,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var e=this.quadPanelEl;this.quadPanelEl||(e=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(e)),e.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),e.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var e=this.el.sceneEl,t=this.el.sceneEl.renderer.getContext(),n=this.xrGLFactory.getSubImage(this.layer,e.frame),i=e.renderer.properties.get(this.texture).__webglTexture,r=t.getParameter(t.FRAMEBUFFER_BINDING);t.viewport(n.viewport.x,n.viewport.y,n.viewport.width,n.viewport.height),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n.colorTexture,0),function(e,t,n,i){var r=e.createFramebuffer(),o=n.viewport.x,s=n.viewport.y,a=n.viewport.x+n.viewport.width,l=n.viewport.y+n.viewport.height;"VIDEO"===i.tagName&&(e.bindTexture(e.TEXTURE_2D,t),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i.width,i.height,e.RGB,e.UNSIGNED_BYTE,i)),e.bindFramebuffer(e.READ_FRAMEBUFFER,r),e.framebufferTexture2D(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.readBuffer(e.COLOR_ATTACHMENT0),e.blitFramebuffer(0,0,i.width,i.height,o,s,a,l,e.COLOR_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.deleteFramebuffer(r)}(t,i,n,this.data.src),t.bindFramebuffer(t.FRAMEBUFFER,r)},updateTransform:function(){var e=this.el,t=this.position,n=this.quaternion;e.object3D.updateMatrixWorld(),t.setFromMatrixPosition(e.object3D.matrixWorld),n.setFromRotationMatrix(e.object3D.matrixWorld),this.layerEnabled||t.set(0,0,1e8),this.layer.transform=new XRRigidTransform(t,n)},onEnterVR:function(){var e=this.el.sceneEl,t=e.xrSession;e.hasWebXR&&XRWebGLBinding&&t?(t.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()):BK("The layer component requires WebXR and the layers API enabled")},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(e){this.referenceSpace=e}}),z$("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var e=this.config,t=this.data,n=this.el,i=this,r={hand:t.hand,model:t.model};function o(t){var r=e[t.detail.name];if(r){var o=MX({showLine:!0},r.raycaster||{});t.detail.rayOrigin&&(o.origin=t.detail.rayOrigin.origin,o.direction=t.detail.rayOrigin.direction,o.showLine=!0),t.detail.rayOrigin||!i.modelReady?n.setAttribute("raycaster",o):n.setAttribute("raycaster","showLine",!0),n.setAttribute("cursor",MX({fuse:!1},r.cursor))}}n.setAttribute("hp-mixed-reality-controls",r),n.setAttribute("magicleap-controls",r),n.setAttribute("oculus-go-controls",r),n.setAttribute("meta-touch-controls",r),n.setAttribute("pico-controls",r),n.setAttribute("valve-index-controls",r),n.setAttribute("vive-controls",r),n.setAttribute("vive-focus-controls",r),n.setAttribute("windows-motion-controls",r),n.setAttribute("generic-tracked-controller-controls",{hand:r.hand}),n.addEventListener("controllerconnected",o),n.addEventListener("controllerdisconnected",(function(t){e[t.detail.name]&&n.setAttribute("raycaster","showLine",!1)})),n.addEventListener("controllermodelready",(function(e){o(e),i.modelReady=!0}))},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"meta-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}});var NK,DK,kK,OK,UK,FK,zK,jK,VK,GK,HK=dH.MathUtils.degToRad,WK=qQ("components:light:warn"),QK=new dH.CubeTextureLoader,qK={};function XK(e,t){return!(!e||!t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}z$("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:3.14,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var e=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(e)},update:function(e){var t=this.data,n=LX(t,e),i=this.light,r=this;if(!i||"type"in n)this.setLight(this.data),this.updateShadow();else{var o=!1;Object.keys(n).forEach((function(e){var n=t[e];switch(e){case"color":i.color.set(n);break;case"groundColor":i.groundColor.set(n);break;case"angle":i.angle=HK(n);break;case"target":null===n?"spot"!==t.type&&"directional"!==t.type||(i.target=r.defaultTarget):n.hasLoaded?r.onSetTarget(n,i):n.addEventListener("loaded",r.onSetTarget.bind(r,n,i));break;case"envMap":r.updateProbeMap(t,i);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":o||(r.updateShadow(),o=!0);break;case"shadowCameraAutomatic":t.shadowCameraAutomatic?r.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(t.shadowCameraAutomatic)):r.shadowCameraAutomaticEls=[];break;default:i[e]=n}}))}},tick:(NK=new dH.Box3,DK=new dH.Vector3,kK=new dH.Vector3,OK=new dH.Matrix4,UK=new dH.Sphere,FK=new dH.Vector3,function(){if("directional"===this.data.type&&this.light.shadow&&this.light.shadow.camera instanceof dH.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var e=this.light.shadow.camera;e.getWorldDirection(DK),e.getWorldPosition(kK),OK.copy(e.matrixWorld),OK.invert(),e.near=1,e.left=1e5,e.right=-1e5,e.top=-1e5,e.bottom=1e5,this.shadowCameraAutomaticEls.forEach((function(t){NK.setFromObject(t.object3D),NK.getBoundingSphere(UK);var n,i,r,o,s,a=LK(kK,DK,UK.center),l=(n=kK,i=DK,r=UK.center,o=FK,s=LK(n,i,r),o.copy(i),o.multiplyScalar(s),o.add(r),o).applyMatrix4(OK);e.near=Math.min(-a-UK.radius-1,e.near),e.left=Math.min(-UK.radius+l.x,e.left),e.right=Math.max(UK.radius+l.x,e.right),e.top=Math.max(UK.radius+l.y,e.top),e.bottom=Math.min(-UK.radius+l.y,e.bottom)})),e.updateProjectionMatrix()}}),setLight:function(e){var t=this.el,n=this.getLight(e);n&&(this.light&&t.removeObject3D("light"),this.light=n,this.light.el=t,t.setObject3D("light",this.light),"spot"!==e.type&&"directional"!==e.type&&"hemisphere"!==e.type||t.getObject3D("light").translateY(-1),"spot"===e.type&&(t.setObject3D("light-target",this.defaultTarget),t.getObject3D("light-target").position.set(0,0,-1)),e.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(e.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var e=this.el,t=this.data,n=this.light;n.castShadow=t.castShadow;var i=e.getObject3D("cameraHelper");if(t.shadowCameraVisible&&!i?(i=new dH.CameraHelper(n.shadow.camera),e.setObject3D("cameraHelper",i)):!t.shadowCameraVisible&&i&&e.removeObject3D("cameraHelper"),!t.castShadow)return n;n.shadow.bias=t.shadowBias,n.shadow.radius=t.shadowRadius,n.shadow.mapSize.height=t.shadowMapHeight,n.shadow.mapSize.width=t.shadowMapWidth,n.shadow.camera.near=t.shadowCameraNear,n.shadow.camera.far=t.shadowCameraFar,n.shadow.camera instanceof dH.OrthographicCamera?(n.shadow.camera.top=t.shadowCameraTop,n.shadow.camera.right=t.shadowCameraRight,n.shadow.camera.bottom=t.shadowCameraBottom,n.shadow.camera.left=t.shadowCameraLeft):n.shadow.camera.fov=t.shadowCameraFov,n.shadow.camera.updateProjectionMatrix(),i&&i.update()},getLight:function(e){var t=e.angle,n=new dH.Color(e.color);n=n.getHex();var i=e.decay,r=e.distance,o=new dH.Color(e.groundColor);o=o.getHex();var s=e.intensity,a=e.type,l=e.target,c=null;switch(a.toLowerCase()){case"ambient":return new dH.AmbientLight(n,s);case"directional":return c=new dH.DirectionalLight(n,s),this.defaultTarget=c.target,l&&(l.hasLoaded?this.onSetTarget(l,c):l.addEventListener("loaded",this.onSetTarget.bind(this,l,c))),c;case"hemisphere":return new dH.HemisphereLight(n,o,s);case"point":return new dH.PointLight(n,s,r,i);case"spot":return c=new dH.SpotLight(n,s,r,HK(t),e.penumbra,i),this.defaultTarget=c.target,l&&(l.hasLoaded?this.onSetTarget(l,c):l.addEventListener("loaded",this.onSetTarget.bind(this,l,c))),c;case"probe":return c=new dH.LightProbe,this.updateProbeMap(e,c),c;default:WK("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",a)}},updateProbeMap:function(e,t){e.envMap?(void 0===qK[e.envMap]&&(qK[e.envMap]=new window.Promise((function(t){Hq(e.envMap,(function(n){QK.load(n,(function(n){var i=kQ.fromCubeTexture(n);qK[e.envMap]=i,t(i)}))}))}))),qK[e.envMap]instanceof window.Promise?qK[e.envMap].then((function(e){t.copy(e)})):qK[e.envMap]instanceof dH.LightProbe&&t.copy(qK[e.envMap])):t.copy(new dH.LightProbe)},onSetTarget:function(e,t){t.target=e.object3D},remove:function(){var e=this.el;e.removeObject3D("light"),e.getObject3D("cameraHelper")&&e.removeObject3D("cameraHelper")}}),z$("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var e,t,n=this.data;t=this.material=new dH.LineBasicMaterial({color:n.color,opacity:n.opacity,transparent:n.opacity<1,visible:n.visible}),(e=this.geometry=new dH.BufferGeometry).setAttribute("position",new dH.BufferAttribute(new Float32Array(6),3)),this.line=new dH.Line(e,t),this.el.setObject3D(this.attrName,this.line)},update:function(e){var t=this.data,n=this.geometry,i=!1,r=this.material,o=n.attributes.position.array;XK(t.start,e.start)||(o[0]=t.start.x,o[1]=t.start.y,o[2]=t.start.z,i=!0),XK(t.end,e.end)||(o[3]=t.end.x,o[4]=t.end.y,o[5]=t.end.z,i=!0),i&&(n.attributes.position.needsUpdate=!0,n.computeBoundingSphere()),r.color.setStyle(t.color),r.opacity=t.opacity,r.transparent=t.opacity<1,r.visible=t.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}}),z$("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new dH.Quaternion,this.hiddenEls=[]},update:function(e){var t,n,i=this.data,r=this.el;if(i.visualAspectEnabled){var o=this.el.getAttribute("scale");this.previewDistance=15*(o.x+o.y)/2,this.initVisualAspect(),t=i.highlighted?i.highlightedColor:i.backgroundColor,n=i.highlighted?i.highlightedColor:i.borderColor,r.setAttribute("material","backgroundColor",t),r.setAttribute("material","strokeColor",n),i.on!==e.on&&this.updateEventListener(),void 0!==e.peekMode&&i.peekMode!==e.peekMode&&this.updatePeekMode(),i.image&&e.image!==i.image&&r.setAttribute("material","pano","string"==typeof i.image?i.image:i.image.src)}},updatePeekMode:function(){var e=this.el,t=this.sphereEl;this.data.peekMode?(this.hideAll(),e.getObject3D("mesh").visible=!1,t.setAttribute("visible",!0)):(this.showAll(),e.getObject3D("mesh").visible=!0,t.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var e=this.el;e.isPlaying&&(this.removeEventListener(),e.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var e=this.data.on;e&&this.el.removeEventListener(e,this.navigate)},initVisualAspect:function(){var e,t,n,i=this.el;this.data.visualAspectEnabled&&!this.visualAspectInitialized&&(n=this.textEl=this.textEl||document.createElement("a-entity"),t=this.sphereEl=this.sphereEl||document.createElement("a-entity"),e=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),i.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),i.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double",previewDistance:this.previewDistance}),n.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),n.setAttribute("position","0 1.5 0"),i.appendChild(n),e.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),e.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back",previewDistance:this.previewDistance}),e.setAttribute("rotation","0 180 0"),e.setAttribute("position","0 0 0"),e.setAttribute("visible",!1),i.appendChild(e),t.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),t.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back",previewDistance:this.previewDistance}),t.setAttribute("visible",!1),i.appendChild(t),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var e=new dH.Vector3,t=new dH.Vector3,n=new dH.Quaternion,i=new dH.Vector3;return function(){var r,o,s=this.el,a=s.object3D,l=s.sceneEl.camera,c=this.textEl;if(this.data.visualAspectEnabled)if(a.updateMatrixWorld(),l.parent.updateMatrixWorld(),l.updateMatrixWorld(),a.matrix.decompose(t,n,i),t.setFromMatrixPosition(a.matrixWorld),e.setFromMatrixPosition(l.matrixWorld),(o=t.distanceTo(e))>1.33333*this.previewDistance)this.previousQuaternion||(this.quaternionClone.copy(n),this.previousQuaternion=this.quaternionClone),a.lookAt(e);else{if(r=this.calculateCameraPortalOrientation(),o<.5){if(!0===this.semiSphereEl.getAttribute("visible"))return;c.setAttribute("text","width",1.5),r<=0?(c.setAttribute("position","0 0 0.75"),c.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(c.setAttribute("position","0 0 -0.75"),c.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),s.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=r}else r<=0?c.setAttribute("rotation","0 180 0"):c.setAttribute("rotation","0 0 0"),c.setAttribute("text","width",5),c.setAttribute("position","0 1.5 0"),s.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(a.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var e=this.el,t=this.hiddenEls,n=this;t.length>0||e.sceneEl.object3D.traverse((function(i){i&&i.el&&i.el.hasAttribute("link-controls")||i.el&&i!==e.sceneEl.object3D&&i.el!==e&&i.el!==n.sphereEl&&i.el!==e.sceneEl.cameraEl&&!1!==i.el.getAttribute("visible")&&i.el!==n.textEl&&i.el!==n.semiSphereEl&&(i.el.setAttribute("visible",!1),t.push(i.el))}))},showAll:function(){this.hiddenEls.forEach((function(e){e.setAttribute("visible",!0)})),this.hiddenEls=[]},calculateCameraPortalOrientation:(zK=new dH.Matrix4,jK=new dH.Vector3,VK=new dH.Vector3(0,0,1),GK=new dH.Vector3(0,0,0),function(){var e=this.el,t=e.sceneEl.camera;return jK.set(0,0,0),VK.set(0,0,1),GK.set(0,0,0),e.object3D.matrixWorld.extractRotation(zK),VK.applyMatrix4(zK),e.object3D.updateMatrixWorld(),e.object3D.localToWorld(GK),t.parent.parent.updateMatrixWorld(),t.parent.updateMatrixWorld(),t.updateMatrixWorld(),t.localToWorld(jK),jK.sub(GK).normalize(),VK.normalize(),Math.sign(VK.dot(jK))}),remove:function(){this.removeEventListener()}}),LY("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"},previewDistance:{default:15,type:"float",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","uniform float previewDistance;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / previewDistance), 2.0), 0.0, 1.0));","}","}"].join("\n")});var $K="logitech-mx-ink",YK=jQ+"controllers/logitech/",KK=(z$("logitech-mx-ink-controls",{schema:{hand:{default:"left"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{left:{buttons:["front","back","none","none","none","tip"]},right:{buttons:["front","back","none","none","none","tip"]}},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(t){vX(t.detail.id,"up",e,e.data.hand)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e,e.data.hand)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e,e.data.hand)},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),e.sceneEl.removeEventListener("enter-vr",this.onEnterVR),e.sceneEl.removeEventListener("exit-vr",this.onExitVR),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.controllerObject3D;e&&(e.visible=!1),pX(this,$K,{hand:this.data.hand,iterateControllerProfiles:!0})},injectTrackedControls:function(){var e=this.el,t=this.data,n=$K;e.setAttribute("tracked-controls",{id:n,hand:t.hand,handTrackingEnabled:!1,iterateControllerProfiles:!0,orientationOffset:t.orientationOffset}),this.loadModel()},loadModel:function(){var e=this.controllerObject3D;if(this.data.model)return e?(e.visible=this.el.sceneEl.is("vr-mode"),void this.el.setObject3D("mesh",e)):void this.el.setAttribute("gltf-model",YK+"logitech-mx-ink.glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,n=this.mapping[this.data.hand].buttons[e.detail.id];n&&("trigger"===n&&(t=e.detail.state.value,console.log("analog value of trigger press: "+t)),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){e.target===this.el&&this.data.model&&(this.el.emit("controllermodelready",{name:"logitech-mx-ink-controls",model:this.data.model,rayOrigin:new dH.Vector3(0,0,0)}),this.controllerObject3D=this.el.getObject3D("mesh"),this.controllerObject3D.visible=this.el.sceneEl.is("vr-mode"))},onAxisMoved:function(e){gX(this,this.mapping.axes,e)}}),Math.PI/2),JK=(z$("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new dH.Vector3,this.hmdQuaternion=new dH.Quaternion,this.magicWindowAbsoluteEuler=new dH.Euler,this.magicWindowDeltaEuler=new dH.Euler,this.position=new dH.Vector3,this.magicWindowObject=new dH.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new dH.Vector3,rotation:new dH.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var e,t=this.data;(aq()||dq())&&(e=this.magicWindowControls=new UQ(this.magicWindowObject),"undefined"!=typeof DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission&&(e.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?e.enabled=t.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",(function(){e.enabled=t.magicWindowTrackingEnabled}))))},update:function(e){var t=this.data;t.enabled!==e.enabled&&this.updateGrabCursor(t.enabled),e&&!t.magicWindowTrackingEnabled&&e.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=t.magicWindowTrackingEnabled),e&&!t.pointerLockEnabled!==e.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(e){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new dH.Object3D,this.yawObject=new dH.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var e=this.el.sceneEl,t=e.canvas;t?(t.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),t.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),e.addEventListener("enter-vr",this.onEnterVR),e.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):e.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var e=this.el.sceneEl,t=e&&e.canvas;t&&(t.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("enter-vr",this.onEnterVR),e.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var e=this.el.object3D,t=this.pitchObject,n=this.yawObject,i=this.el.sceneEl;(i.is("vr-mode")||i.is("ar-mode"))&&i.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),e.rotation.x=this.magicWindowDeltaEuler.x+t.rotation.x,e.rotation.y=this.magicWindowDeltaEuler.y+n.rotation.y,e.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var e=this.magicWindowAbsoluteEuler,t=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),e.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),this.previousMagicWindowYaw||0===e.y||(this.previousMagicWindowYaw=e.y),this.previousMagicWindowYaw&&(t.x=e.x,t.y+=e.y-this.previousMagicWindowYaw,t.z=e.z,this.previousMagicWindowYaw=e.y))},onMouseMove:function(e){var t,n,i,r=this.pitchObject,o=this.previousMouseEvent,s=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(n=e.movementX||e.mozMovementX||0,i=e.movementY||e.mozMovementY||0):(n=e.screenX-o.screenX,i=e.screenY-o.screenY),this.previousMouseEvent.screenX=e.screenX,this.previousMouseEvent.screenY=e.screenY,t=this.data.reverseMouseDrag?1:-1,s.rotation.y+=.002*n*t,r.rotation.x+=.002*i*t,r.rotation.x=Math.max(-KK,Math.min(KK,r.rotation.x)))},onMouseDown:function(e){var t=this.el.sceneEl;if(this.data.enabled&&this.data.mouseEnabled&&(!t.is("vr-mode")&&!t.is("ar-mode")||!t.checkHeadsetConnected())&&0===e.button){var n=t&&t.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=e.screenX,this.previousMouseEvent.screenY=e.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(n.requestPointerLock?n.requestPointerLock():n.mozRequestPointerLock&&n.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(e){1!==e.touches.length||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(e){var t,n,i=this.el.sceneEl.canvas,r=this.yawObject;this.touchStarted&&this.data.touchEnabled&&(n=2*Math.PI*(e.touches[0].pageX-this.touchStart.x)/i.clientWidth,t=this.data.reverseTouchDrag?1:-1,r.rotation.y-=.5*n*t,this.touchStart={x:e.touches[0].pageX,y:e.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var e=this.el.sceneEl;e.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),e.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(e){var t=this.el.sceneEl;function n(){t.canvas.classList.add("a-grab-cursor")}function i(){t.canvas.classList.remove("a-grab-cursor")}t.canvas?e?n():i():e?t.addEventListener("render-target-loaded",n):t.addEventListener("render-target-loaded",i)},saveCameraPose:function(){var e=this.el;this.savedPose.position.copy(e.object3D.position),this.savedPose.rotation.copy(e.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var e=this.el,t=this.savedPose;this.hasSavedPose&&(e.object3D.position.copy(t.position),e.object3D.rotation.copy(t.rotation),this.hasSavedPose=!1)}}),"magicleap-one"),ZK=jQ+"controllers/magicleap/magicleap-one-controller.glb",eJ=(z$("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var e=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.previousButtonValues={},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;pX(this,JK,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:JK,hand:t.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",ZK)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,n=this.mapping.buttons[e.detail.id];n&&("trigger"===n&&(t=e.detail.state.value,console.log("analog value of trigger press: "+t)),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){e.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(e){gX(this,this.mapping.axes,e)},updateModel:function(e,t){},setButtonColor:function(e,t){}}),qQ("components:material:error"));function tJ(e,t){e.dispose(),t.unregisterMaterial(e),Object.keys(e).filter((function(t){return e[t]&&e[t].isTexture})).forEach((function(t){e[t].dispose()}))}z$("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:IY,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(e){var t=this.data;this.shader&&t.shader===e.shader||this.updateShader(t.shader),this.shader.update(this.data),this.updateMaterial(e)},updateSchema:function(e){var t,n,i,r;n=e&&e.shader,t=this.oldData&&this.oldData.shader,(i=RY[r=n||t]&&RY[r].schema)||eJ("Unknown shader schema "+r),t&&n===t||(this.extendSchema(i),this.updateBehavior())},updateBehavior:function(){var e,t,n=this.el.sceneEl,i=this.schema,r=this;function o(e,n){var i;for(i in t)t[i]=e;r.shader.update(t)}for(e in this.tick=void 0,t={},i)"time"===i[e].type&&(this.tick=o,t[e]=!0);n&&(this.tick?n.addBehavior(this):n.removeBehavior(this))},updateShader:function(e){var t,n=this.data,i=RY[e]&&RY[e].Shader;if(!i)throw new Error("Unknown shader "+e);(t=this.shader=new i).el=this.el,t.init(n),this.setMaterial(t.material),this.updateSchema(n)},updateMaterial:function(e){var t,n=this.data,i=this.material;for(t in i.alphaTest=n.alphaTest,i.depthTest=!1!==n.depthTest,i.depthWrite=!1!==n.depthWrite,i.opacity=n.opacity,i.flatShading=n.flatShading,i.side=function(e){switch(e){case"back":return dH.BackSide;case"double":return dH.DoubleSide;default:return dH.FrontSide}}(n.side),i.transparent=!1!==n.transparent||n.opacity<1,i.vertexColors=n.vertexColorsEnabled,i.visible=n.visible,i.blending=function(e){switch(e){case"none":return dH.NoBlending;case"additive":return dH.AdditiveBlending;case"subtractive":return dH.SubtractiveBlending;case"multiply":return dH.MultiplyBlending;default:return dH.NormalBlending}}(n.blending),i.dithering=n.dithering,e)break;!t||e.alphaTest===n.alphaTest&&e.side===n.side&&e.vertexColorsEnabled===n.vertexColorsEnabled||(i.needsUpdate=!0)},remove:function(){var e=new dH.MeshBasicMaterial,t=this.material,n=this.el.getObject3D("mesh");n&&(n.material=e),tJ(t,this.system)},setMaterial:function(e){var t,n=this.el,i=this.system;this.material&&tJ(this.material,i),this.material=e,i.registerMaterial(e),(t=n.getObject3D("mesh"))?t.material=e:n.addEventListener("object3dset",(function t(i){"mesh"===i.detail.type&&i.target===n&&(n.getObject3D("mesh").material=e,n.removeEventListener("object3dset",t))}))}});var nJ,iJ,rJ,oJ,sJ,aJ="oculus-touch",lJ=jQ+"controllers/oculus/oculus-touch-controller-",cJ=jQ+"controllers/meta/",uJ={left:{modelUrl:lJ+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new dH.Vector3(-.005,.036,-.037),modelPivotRotation:new dH.Euler(Math.PI/4.5,0,0)},right:{modelUrl:lJ+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new dH.Vector3(.005,.036,-.037),modelPivotRotation:new dH.Euler(Math.PI/4.5,0,0)}},hJ="oculus-touch",dJ={"oculus-touch":uJ,"oculus-touch-v2":{left:{modelUrl:lJ+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new dH.Vector3(0,-.007,-.021),modelPivotRotation:new dH.Euler(-Math.PI/4,0,0)},right:{modelUrl:lJ+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new dH.Vector3(0,-.007,-.021),modelPivotRotation:new dH.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:lJ+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new dH.Vector3(0,0,0),modelPivotRotation:new dH.Euler(0,0,0)},right:{modelUrl:lJ+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new dH.Vector3(0,0,0),modelPivotRotation:new dH.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:cJ+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new dH.Vector3(0,0,0),modelPivotRotation:new dH.Euler(0,0,0)},right:{modelUrl:cJ+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new dH.Vector3(0,0,0),modelPivotRotation:new dH.Euler(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:cJ+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new dH.Vector3(0,0,0),modelPivotRotation:new dH.Euler(0,0,0)},right:{modelUrl:cJ+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new dH.Vector3(0,0,0),modelPivotRotation:new dH.Euler(0,0,0)}}},pJ={schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]}},after:["tracked-controls"],mapping:{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonDown=function(t){vX(t.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(t){vX(t.detail.id,"up",e,e.data.hand)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e,e.data.hand)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e,e.data.hand)},this.controllerPresent=!1,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new dH.Euler},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.controllerObject3D;e&&(e.visible=!1),pX(this,aJ,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(e){var t,n=this.data;if(n.model){if(this.controllerObject3D)return this.controllerObject3D.visible=!0,void this.el.setObject3D("mesh",this.controllerObject3D);if(this.displayModel=dJ[n.controllerType]||dJ[hJ],"auto"===n.controllerType){t=hJ;for(var i=Object.keys(dJ),r=0;r<e.profiles.length;r++)if(-1!==i.indexOf(e.profiles[r])){t=e.profiles[r];break}this.displayModel=dJ[t]}var o=this.displayModel[n.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===dJ["oculus-touch-v3"]||this.displayModel===dJ["meta-quest-touch-pro"]||this.displayModel===dJ["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",o)}},injectTrackedControls:function(e){var t=this.data,n=aJ;this.el.setAttribute("tracked-controls",{id:n,hand:t.hand,handTrackingEnabled:!1,iterateControllerProfiles:!0}),this.loadModel(e)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t=this.mapping[this.data.hand].buttons[e.detail.id];if(t){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus(e);else{var n,i=this.buttonMeshes;"trigger"!==t&&"grip"!==t||(n=e.detail.state.value),i&&("trigger"===t&&i.trigger&&(i.trigger.rotation.x=this.originalXRotationTrigger-n*(Math.PI/26)),"grip"===t&&i.grip&&(n*="left"===this.data.hand?-1:1,i.grip.position.x=this.originalXPositionGrip+.004*n))}this.el.emit(t+"changed",e.detail.state)}},onButtonChangedV3orPROorPlus:function(e){var t,n=this.mapping[this.data.hand].buttons[e.detail.id],i=this.buttonObjects;i&&i[n]&&(t=e.detail.state.value,i[n].quaternion.slerpQuaternions(this.buttonRanges[n].min.quaternion,this.buttonRanges[n].max.quaternion,t),i[n].position.lerpVectors(this.buttonRanges[n].min.position,this.buttonRanges[n].max.position,t))},onModelLoaded:function(e){if(e.target===this.el&&this.data.model){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded(e);else{var t,n=this.controllerObject3D=e.detail.model;(t=this.buttonMeshes={}).grip=n.getObjectByName("buttonHand"),this.originalXPositionGrip=t.grip&&t.grip.position.x,t.trigger=n.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=t.trigger&&t.trigger.rotation.x,t.thumbstick=n.getObjectByName("stick"),t.xbutton=n.getObjectByName("buttonX"),t.abutton=n.getObjectByName("buttonA"),t.ybutton=n.getObjectByName("buttonY"),t.bbutton=n.getObjectByName("buttonB")}for(var i in this.buttonMeshes)this.buttonMeshes[i]&&fJ(this.buttonMeshes[i]);this.applyOffset(e.detail.model),this.el.emit("controllermodelready",{name:"meta-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(e){e.position.copy(this.displayModel[this.data.hand].modelPivotOffset),e.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function(e){var t=this.controllerObject3D=e.detail.model,n=this.buttonObjects={},i=this.buttonMeshes={},r=this.buttonRanges={};i.grip=t.getObjectByName("squeeze"),n.grip=t.getObjectByName("xr_standard_squeeze_pressed_value"),r.grip={min:t.getObjectByName("xr_standard_squeeze_pressed_min"),max:t.getObjectByName("xr_standard_squeeze_pressed_max")},n.grip.minX=n.grip.position.x,i.thumbstick=t.getObjectByName("thumbstick"),n.thumbstick=t.getObjectByName("xr_standard_thumbstick_pressed_value"),r.thumbstick={min:t.getObjectByName("xr_standard_thumbstick_pressed_min"),max:t.getObjectByName("xr_standard_thumbstick_pressed_max")},n.thumbstickXAxis=t.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),r.thumbstickXAxis={min:t.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:t.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},n.thumbstickYAxis=t.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),r.thumbstickYAxis={min:t.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:t.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},i.trigger=t.getObjectByName("trigger"),n.trigger=t.getObjectByName("xr_standard_trigger_pressed_value"),r.trigger={min:t.getObjectByName("xr_standard_trigger_pressed_min"),max:t.getObjectByName("xr_standard_trigger_pressed_max")},r.trigger.diff={x:Math.abs(r.trigger.max.rotation.x)-Math.abs(r.trigger.min.rotation.x),y:Math.abs(r.trigger.max.rotation.y)-Math.abs(r.trigger.min.rotation.y),z:Math.abs(r.trigger.max.rotation.z)-Math.abs(r.trigger.min.rotation.z)};var o="left"===this.data.hand?"x":"a",s="left"===this.data.hand?"y":"b",a=o+"button",l=s+"button";i[a]=t.getObjectByName(o+"_button"),n[a]=t.getObjectByName(o+"_button_pressed_value"),r[a]={min:t.getObjectByName(o+"_button_pressed_min"),max:t.getObjectByName(o+"_button_pressed_max")},i[l]=t.getObjectByName(s+"_button"),n[l]=t.getObjectByName(s+"_button_pressed_value"),r[l]={min:t.getObjectByName(s+"_button_pressed_min"),max:t.getObjectByName(s+"_button_pressed_max")}},onAxisMoved:function(e){gX(this,this.mapping[this.data.hand].axes,e)},onThumbstickMoved:function(e){if(this.buttonMeshes&&this.buttonMeshes.thumbstick)if(this.isTouchV3orPROorPlus)this.updateThumbstickTouchV3orPROorPlus(e);else for(var t in e.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[t]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[t]]-Math.PI/8*e.detail[t]*("y"===t||"right"===this.data.hand?-1:1)},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function(e){var t=(e.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,t);var n=(e.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,n)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var n,i=this.buttonMeshes;i&&i[e]&&(n="up"===t||"touchend"===t?i[e].originalColor||this.data.buttonColor:"touchstart"===t?this.data.buttonTouchColor:this.data.buttonHighlightColor,i[e].material.color.set(n))}};function fJ(e){e.traverse((function(t){var n;"Mesh"===t.type&&(n=t.material.clone(),e.originalColor=t.material.color,t.material.dispose(),t.material=n)}))}z$("oculus-touch-controls",pJ),z$("meta-touch-controls",pJ),z$("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=(new dH.Vector3).copy(this.el.object3D.scale),this.auxEuler=new dH.Euler,this.boundingBox=new dH.Box3,this.boundingBoxSize=new dH.Vector3,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var e,t=this.el,n=t.components["gltf-model"]&&t.components["gltf-model"].model;n&&(this.el.removeObject3D("mesh"),e=(new dH.Box3).setFromObject(n).getCenter(new dH.Vector3),n.position.x+=n.position.x-e.x,n.position.y+=n.position.y-e.y,n.position.z+=n.position.z-e.z,this.el.setObject3D("mesh",n))},updateCollider:function(){var e=this.el,t=this.boundingBoxSize,n=this.aabb=this.aabb||new AQ;this.obb=this.obb||new AQ,e.hasLoaded?(this.updateBoundingBox(),n.halfSize.copy(t).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()):e.addEventListener("loaded",this.updateCollider)},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var e=this.renderColliderMesh,t=this.boundingBoxSize;e?(e.geometry.dispose(),e.geometry=new dH.BoxGeometry(t.x,t.y,t.z)):this.initColliderMesh()},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var e,t,n;e=this.boundingBoxSize,t=this.renderColliderGeometry=new dH.BoxGeometry(e.x,e.y,e.z),(n=this.renderColliderMesh=new dH.Mesh(t,new dH.MeshLambertMaterial({color:65280,side:dH.DoubleSide}))).matrixAutoUpdate=!1,n.matrixWorldAutoUpdate=!1,n.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(n)},updateBoundingBox:(nJ=new dH.Vector3,iJ=new dH.Vector3,rJ=new dH.Quaternion,oJ=new dH.Quaternion,sJ=new dH.Matrix4,function(){var e=this.auxEuler,t=this.boundingBox,n=this.data.size,i=this.trackedObject3D||this.el.object3D,r=this.boundingBoxSize,o=this.data.minimumColliderDimension;if(n)return this.boundingBoxSize.x=n,this.boundingBoxSize.y=n,void(this.boundingBoxSize.z=n);e.copy(i.rotation),i.rotation.set(0,0,0),i.parent.matrixWorld.decompose(nJ,rJ,iJ),sJ.compose(nJ,oJ,iJ),i.parent.matrixWorld.copy(sJ),t.setFromObject(i,!0),t.getSize(r),r.x=r.x<o?o:r.x,r.y=r.y<o?o:r.y,r.z=r.z<o?o:r.z,i.parent.matrixWorld.compose(nJ,rJ,iJ),this.el.object3D.rotation.copy(e)}),checkTrackedObject:function(){var e,t=this.trackedObject3DPath;if(t&&t.length&&!this.trackedObject3D){e=this.el;for(var n=0;n<t.length&&(e=e[t[n]]);n++);e&&(this.trackedObject3D=e,this.updateCollider())}return this.trackedObject3D},tick:function(){var e=new dH.Vector3,t=new dH.Vector3,n=new dH.Quaternion,i=new dH.Matrix4;return function(){var r=this.obb,o=this.renderColliderMesh,s=this.checkTrackedObject()||this.el.object3D;s&&(s.updateMatrix(),s.updateMatrixWorld(!0),s.matrixWorld.decompose(e,n,t),(Math.abs(t.x-this.previousScale.x)>1e-4||Math.abs(t.y-this.previousScale.y)>1e-4||Math.abs(t.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(t),t.set(1,1,1),i.compose(e,n,t),o&&o.matrixWorld.copy(i),r.copy(this.aabb),r.applyMatrix4(i))}}()});var mJ=qQ("components:obj-model:warn"),gJ=(z$("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var e=this;this.model=null,this.objLoader=new LQ,this.mtlLoader=new NQ(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",(function(t){e.model&&"material"===t.detail.name&&e.applyMaterial()}))},update:function(){var e=this.data;e.obj&&(this.resetMesh(),this.loadObj(e.obj,e.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(e,t){var n=this,i=this.el,r=this.mtlLoader,o=this.objLoader,s=this.el.sceneEl.systems.renderer,a=t.substr(0,t.lastIndexOf("/")+1);if(t)return i.hasAttribute("material")&&mJ("Material component properties are ignored when a .MTL is provided"),r.setResourcePath(a),void r.load(t,(function(t){t.preload(),o.setMaterials(t),o.load(e,(function(e){n.model=e,n.model.traverse((function(e){if(e.isMesh){var t=e.material;t.map&&s.applyColorCorrection(t.map),t.emissiveMap&&s.applyColorCorrection(t.emissiveMap)}})),i.setObject3D("mesh",e),i.emit("model-loaded",{format:"obj",model:e})}))}));o.load(e,(function(e){n.model=e,n.applyMaterial(),i.setObject3D("mesh",e),i.emit("model-loaded",{format:"obj",model:e})}))},applyMaterial:function(){var e=this.el.components.material;e&&this.model.traverse((function(t){t instanceof dH.Mesh&&(t.material=e.material)}))}}),jQ+"controllers/oculus/go/oculus-go-controller.gltf"),vJ="oculus-go",yJ=(z$("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){pX(this,vJ,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{hand:t.hand,idPrefix:vJ}),this.data.model&&this.el.setAttribute("gltf-model",gJ)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var t,n=e.detail.model;e.target===this.el&&this.data.model&&((t=this.buttonMeshes={}).trigger=n.getObjectByName("oculus_go_button_trigger"),t.trackpad=n.getObjectByName("oculus_go_touchpad"),t.touchpad=n.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){gX(this,this.mapping.axes,e)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var n=this.buttonMeshes;if(n&&n[e]){var i;switch(t){case"down":i=this.data.buttonHighlightColor;break;case"touchstart":i=this.data.buttonTouchedColor;break;default:i=this.data.buttonColor}n[e].material.color.set(i)}}}),"pico-4"),AJ=jQ+"controllers/pico/pico4/",xJ=(z$("pico-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e,e.data.hand)},this.onButtonUp=function(t){vX(t.detail.id,"up",e,e.data.hand)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e,e.data.hand)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e,e.data.hand)},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;pX(this,yJ,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:yJ,hand:t.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",AJ+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,n=this.mapping[this.data.hand].buttons[e.detail.id];n&&("trigger"===n&&(t=e.detail.state.value,console.log("analog value of trigger press: "+t)),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){e.target===this.el&&this.data.model&&this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new dH.Vector3(0,0,0)})},onAxisMoved:function(e){gX(this,this.mapping[this.data.hand].axes,e)}}),z$("position",{schema:{type:"vec3"},update:function(){var e=this.el.object3D,t=this.data;e.position.set(t.x,t.y,t.z)},remove:function(){this.el.object3D.position.set(0,0,0)}}),qQ("components:raycaster:warn")),bJ=/^[\w\s-.,[\]#]*$/,_J={childList:!0,attributes:!0,subtree:!0},wJ="raycaster-intersected-cleared",EJ="raycaster-intersection-cleared";function SJ(e,t){var n;for(e.length=t.length,n=0;n<t.length;n++)e[n]=t[n]}z$("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new dH.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new dH.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new dH.Vector3,this.otherLineEndVec3=new dH.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(e){var t=this.data,n=this.el,i=this.raycaster;i.far=t.far,i.near=t.near,!t.showLine||t.far===e.far&&t.origin===e.origin&&t.direction===e.direction&&e.showLine||(this.unitLineEndVec3.copy(t.direction).normalize(),this.drawLine()),!t.showLine&&e.showLine&&n.removeAttribute("line"),t.objects===e.objects||bJ.test(t.objects)||xJ('[raycaster] Selector "'+t.objects+'" may not update automatically with DOM changes.'),t.objects||xJ('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),t.autoRefresh!==e.autoRefresh&&n.isPlaying&&(t.autoRefresh?this.addEventListeners():this.removeEventListeners()),e.enabled&&!t.enabled&&this.clearAllIntersections(),t.objects!==e.objects&&this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,_J),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var e,t=this.data;e=t.objects?this.el.sceneEl.querySelectorAll(t.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(e),this.dirty=!1},tock:function(e){var t=this.data,n=this.prevCheckTime;t.enabled&&(n&&e-n<t.interval||(this.prevCheckTime=e,this.checkIntersections()))},checkIntersections:function(){var e,t,n=this.clearedIntersectedEls,i=this.el,r=this.data,o=this.intersectedEls,s=this.intersections,a=this.newIntersectedEls,l=this.newIntersections,c=this.prevIntersectedEls,u=this.rawIntersections;for(this.dirty&&this.refreshObjects(),SJ(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),u.length=0,this.raycaster.intersectObjects(this.objects,!0,u),s.length=0,o.length=0,e=0;e<u.length;e++)t=u[e],r.showLine&&t.object===i.getObject3D("line")||t.object.el&&(s.push(t),o.push(t.object.el));for(l.length=0,a.length=0,e=0;e<s.length;e++)-1===c.indexOf(s[e].object.el)&&(l.push(s[e]),a.push(s[e].object.el));for(n.length=0,e=0;e<c.length;e++)-1===o.indexOf(c[e])&&(c[e].emit(wJ,this.intersectedClearedDetail),n.push(c[e]));for(n.length&&i.emit(EJ,this.intersectionClearedDetail),e=0;e<a.length;e++)a[e].emit("raycaster-intersected",this.intersectedDetail);l.length&&(this.intersectionDetail.els=a,this.intersectionDetail.intersections=l,i.emit("raycaster-intersection",this.intersectionDetail)),(0===c.length&&s.length>0||c.length>0&&0===s.length||c.length&&s.length&&c[0]!==s[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=s,i.emit("raycaster-closest-entity-changed",this.intersectionDetail)),r.showLine&&setTimeout(this.updateLine)},updateLine:function(){var e,t=this.el,n=this.intersections;n.length&&(e=n[0].object.el===t&&n[1]?n[1].distance:n[0].distance),this.drawLine(e)},getIntersection:function(e){var t,n;for(t=0;t<this.intersections.length;t++)if((n=this.intersections[t]).object.el===e)return n;return null},updateOriginDirection:function(){var e=new dH.Vector3,t=new dH.Vector3;return function(){var n=this.el,i=this.data;i.useWorldCoordinates?this.raycaster.set(i.origin,i.direction):(n.object3D.updateMatrixWorld(),t.setFromMatrixPosition(n.object3D.matrixWorld),0===i.origin.x&&0===i.origin.y&&0===i.origin.z||(t=n.object3D.localToWorld(t.copy(i.origin))),e.copy(i.direction).transformDirection(n.object3D.matrixWorld).normalize(),this.raycaster.set(t,e))}}(),drawLine:function(e){var t,n=this.data,i=this.el;t=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,void 0===e&&(e=n.far===1/0?1e3:n.far),this.lineData.start=n.origin,this.lineData.end=t.copy(this.unitLineEndVec3).multiplyScalar(e).add(n.origin),this.lineData.color=n.lineColor,this.lineData.opacity=n.lineOpacity,i.setAttribute("line",this.lineData)},flattenObject3DMaps:function(e){var t,n,i=this.objects,r=this.el.sceneEl.object3D;function o(e){return e.parent?o(e.parent):e===r}for(i.length=0,n=0;n<e.length;n++){var s=e[n];if(s.isEntity&&s.object3D&&o(s.object3D))for(t in s.object3DMap)i.push(s.getObject3D(t))}return i},clearAllIntersections:function(){var e;for(e=0;e<this.intersectedEls.length;e++)this.intersectedEls[e].emit(wJ,this.intersectedClearedDetail);SJ(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(EJ,this.intersectionClearedDetail)}});var CJ,MJ,TJ,RJ,IJ=dH.MathUtils.degToRad,PJ=(z$("rotation",{schema:{type:"vec3"},update:function(){var e=this.data;this.el.object3D.rotation.set(IJ(e.x),IJ(e.y),IJ(e.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}}),z$("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var e=this.data;this.el.object3D.scale.set(e.x,e.y,e.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}}),z$("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var e=this.data;this.updateDescendants(e.cast,e.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(e,t){var n=this.el.sceneEl;this.el.object3D.traverse((function(i){if(i instanceof dH.Mesh&&(i.castShadow=e,i.receiveShadow=t,n.hasLoaded&&i.material))for(var r=Array.isArray(i.material)?i.material:[i.material],o=0;o<r.length;o++)r[o].needsUpdate=!0}))}}),qQ("components:sound:warn")),BJ=(z$("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var e=this;this.listener=null,this.audioLoader=new dH.AudioLoader,this.pool=new dH.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){e.playSound()}},update:function(e){var t,n,i=this.data,r=i.src!==e.src;if(r){if(!i.src)return;this.setupSound()}for(t=0;t<this.pool.children.length;t++)n=this.pool.children[t],i.positional&&(n.setDistanceModel(i.distanceModel),n.setMaxDistance(i.maxDistance),n.setRefDistance(i.refDistance),n.setRolloffFactor(i.rolloffFactor)),n.setLoop(i.loop),n.setLoopStart(i.loopStart),0!==i.loopStart&&0===i.loopEnd?n.setLoopEnd(n.buffer.duration):n.setLoopEnd(i.loopEnd),n.setVolume(i.volume),n.isPaused=!1;if(i.on!==e.on&&this.updateEventListener(e.on),r){var o=this;this.loaded=!1,this.audioLoader.load(i.src,(function(e){for(t=0;t<o.pool.children.length;t++)(n=o.pool.children[t]).setBuffer(e);o.loaded=!0,dH.Cache.remove(i.src),(o.data.autoplay||o.mustPlay)&&o.playSound(o.processSound),o.el.emit("sound-loaded",o.evtDetail,!1)}))}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var e;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(e=0;e<this.pool.children.length;e++)this.pool.children[e].disconnect()}catch(e){PJ("Audio source not properly disconnected")}},updateEventListener:function(e){var t=this.el;e&&t.removeEventListener(e,this.playSoundBound),t.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var e,t,n=this.el,i=n.sceneEl,r=this;this.pool.children.length>0&&(this.stopSound(),n.removeObject3D("sound"));var o=this.listener=i.audioListener||new dH.AudioListener;for(i.audioListener=o,i.camera&&i.camera.add(o),i.addEventListener("camera-set-active",(function(e){e.detail.cameraEl.getObject3D("camera").add(o)})),this.pool=new dH.Group,e=0;e<this.data.poolSize;e++)t=this.data.positional?new dH.PositionalAudio(o):new dH.Audio(o),this.pool.add(t);for(n.setObject3D(this.attrName,this.pool),e=0;e<this.pool.children.length;e++)(t=this.pool.children[e]).onEnded=function(){this.isPlaying=!1,r.el.emit("sound-ended",r.evtDetail,!1)}},pauseSound:function(){var e,t;for(this.isPlaying=!1,e=0;e<this.pool.children.length;e++)(t=this.pool.children[e]).source&&t.source.buffer&&t.isPlaying&&!t.isPaused&&(t.isPaused=!0,t.pause())},playSound:function(e){var t,n,i;if(!this.loaded)return PJ("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,void(this.processSound=e);for(t=!1,this.isPlaying=!0,n=0;n<this.pool.children.length;n++)(i=this.pool.children[n]).isPlaying||!i.buffer||t||(e&&e(i),i.play(),i.isPaused=!1,t=!0);t?(this.mustPlay=!1,this.processSound=void 0):PJ("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el)},stopSound:function(){var e,t;for(this.isPlaying=!1,e=0;e<this.pool.children.length;e++){if(!(t=this.pool.children[e]).source||!t.source.buffer)return;t.stop()}}}),kV(4433)),LJ=kV.n(BJ),NJ=kV(5751),DJ=kV.n(NJ),kJ=qQ("components:text:error"),OJ=qQ("components:text:warn"),UJ=jQ+"fonts/",FJ={aileronsemibold:UJ+"Aileron-Semibold.fnt",dejavu:UJ+"DejaVu-sdf.fnt",exo2bold:UJ+"Exo2Bold.fnt",exo2semibold:UJ+"Exo2SemiBold.fnt",kelsonsans:UJ+"KelsonSans.fnt",monoid:UJ+"Monoid.fnt",mozillavr:UJ+"mozillavr.fnt",roboto:UJ+"Roboto-msdf.json",sourcecodepro:UJ+"SourceCodePro.fnt"},zJ=["roboto"],jJ="roboto",VJ=new function(){var e=this.cache={};this.get=function(t,n){return t in e||(e[t]=n()),e[t]}},GJ={},HJ={},WJ=/^\w+:/;function QJ(e,t,n){return e||(.5+t)*n}z$("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:jJ},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:RY},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=LJ()(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(e){var t=this.data,n=this.currentFont;HJ[t.font]?this.texture=HJ[t.font]:(this.texture=HJ[t.font]=new dH.Texture,this.texture.anisotropy=16),this.createOrUpdateMaterial(),e.font===t.font?n&&(this.updateGeometry(this.geometry,n),this.updateLayout()):this.updateFont()},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var e,t,n,i=this.data,r=this.material,o=this.shaderData;if(n=i.shader,-1!==zJ.indexOf(i.font)||i.font.indexOf("-msdf.")>=0?n="msdf":i.font in FJ&&-1===zJ.indexOf(i.font)&&(n="sdf"),e=(this.shaderObject&&this.shaderObject.name)!==n,o.alphaTest=i.alphaTest,o.color=i.color,o.map=this.texture,o.opacity=i.opacity,o.side=function(e){switch(e){case"back":return dH.FrontSide;case"double":return dH.DoubleSide;default:return dH.BackSide}}(i.side),o.transparent=i.transparent,o.negate=i.negate,!e)return this.shaderObject.update(o),r.transparent=o.transparent,void(r.side=o.side);t=function(e,t,n){var i,r;return(r=new RY[t].Shader).el=e,r.init(n),r.update(n),(i=r.material).transparent=n.transparent,{material:i,shader:r}}(this.el,n,o),this.material=t.material,this.shaderObject=t.shader,this.material.side=o.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var e,t=this.data,n=this.el,i=this.geometry,r=this;t.font||OJ("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),e=this.lookupFont(t.font||jJ)||t.font,VJ.get(e,(function(){return function(e,t){return new Promise((function(n,i){DJ()(e,(function(r,o){if(r)return kJ("Error loading font",e),void i(r);e.indexOf("/Roboto-msdf.json")>=0&&(t=30),t&&o.chars.forEach((function(e){e.yoffset+=t})),n(o)}))}))}(e,t.yOffset)})).then((function(o){var s;if(1!==o.pages.length)throw new Error("Currently only single-page bitmap fonts are supported.");GJ[e]||(o.widthFactor=GJ[o]=function(e){var t=0,n=0,i=0;return e.chars.forEach((function(e){t+=e.xadvance,e.id>=48&&e.id<=57&&(i++,n+=e.xadvance)})),i?n/i:t/e.chars.length}(o)),r.currentFont=o,s=r.getFontImageSrc(),VJ.get(s,(function(){return function(e){return new Promise((function(t,n){(new dH.ImageLoader).load(e,(function(e){t(e)}),void 0,(function(){kJ("Error loading font image",e),n(null)}))}))}(s)})).then((function(e){var s=r.texture;s&&(s.image=e,s.needsUpdate=!0,HJ[t.font]=s,r.texture=s,r.initMesh(),r.currentFont=o,r.updateGeometry(i,o),r.updateLayout(),r.mesh.visible=!0,n.emit("textfontset",{font:t.font,fontObj:o}))})).catch((function(e){kJ(e.message),kJ(e.stack)}))})).catch((function(e){kJ(e.message),kJ(e.stack)}))},initMesh:function(){this.mesh||(this.mesh=new dH.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var e=this.lookupFont(this.data.font||jJ)||this.data.font,t=this.currentFont.pages[0];return t.match(WJ)&&0!==t.indexOf("http")?e.replace(/(\.fnt)|(\.json)/,".png"):dH.LoaderUtils.extractUrlBase(e)+t},updateLayout:function(){var e,t,n,i,r,o,s,a,l,c=this.el,u=this.data,h=this.geometry,d=this.mesh;if(d&&h.layout){if(n=c.getAttribute("geometry"),i=(o=(s=u.width||n&&n.width||1)/QJ(u.wrapPixels,u.wrapCount,this.currentFont.widthFactor))*((r=h.layout).height+r.descender),n&&"plane"===n.primitive&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!n.width,this.hasExplicitGeoHeight=!!n.height),this.hasExplicitGeoWidth||c.setAttribute("geometry","width",s),this.hasExplicitGeoHeight||c.setAttribute("geometry","height",i)),"left"===(e="align"===u.anchor?u.align:u.anchor))a=0;else if("right"===e)a=-1*r.width;else{if("center"!==e)throw new TypeError("Invalid text.anchor property value",e);a=-1*r.width/2}if("bottom"===(t=u.baseline))l=0;else if("top"===t)l=-1*r.height+r.ascender;else{if("center"!==t)throw new TypeError("Invalid text.baseline property value",t);l=-1*r.height/2}d.position.x=a*o+u.xOffset,d.position.y=l*o,d.position.z=u.zOffset,d.scale.set(o,-1*o,o)}},lookupFont:function(e){return FJ[e]},updateGeometry:(CJ={},MJ={},TJ=/\\n/g,RJ=/\\t/g,function(e,t){var n=this.data;MJ.font=t,MJ.lineHeight=n.lineHeight&&isFinite(n.lineHeight)?n.lineHeight:t.common.lineHeight,MJ.text=n.value.toString().replace(TJ,"\n").replace(RJ,"\t"),MJ.width=QJ(n.wrapPixels,n.wrapCount,t.widthFactor),e.update(MX(CJ,n,MJ))})});var qJ,XJ,$J=(z$("tracked-controls",{schema:{id:{type:"string",default:""},controller:{default:-1},autoHide:{default:!0},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},iterateControllerProfiles:{default:!1}},init:function(){this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.updateController=this.updateController.bind(this)},update:function(){this.updateController()},play:function(){var e=this.el.sceneEl;this.updateController(),e.addEventListener("controllersupdated",this.updateController)},pause:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(e){return!(!this.controller||this.controller.gamepad||"none"!==e.inputSource.handedness&&e.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=mX(this.system.controllers,this.data.id,this.data.hand,this.data.controller,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller},tick:function(){var e=this.el.sceneEl,t=this.controller,n=e.frame;this.data.autoHide&&(this.el.object3D.visible=!!t),t&&e.frame&&this.system.referenceSpace&&(t.hand||(this.pose=n.getPose(t.gripSpace,this.system.referenceSpace),this.updatePose(),this.updateButtons()))},updatePose:function(){var e=this.el.object3D,t=this.pose;t&&(e.matrix.elements=t.transform.matrix,e.matrix.decompose(e.position,e.rotation,e.scale))},updateButtons:function(){var e,t,n,i=this.controller;if(i&&i.gamepad){for(n=i.gamepad,t=0;t<n.buttons.length;++t)this.buttonStates[t]||(this.buttonStates[t]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[t]||(this.buttonEventDetails[t]={id:t,state:this.buttonStates[t]}),e=n.buttons[t],this.handleButton(t,e);this.handleAxes()}},handleButton:function(e,t){return!!(this.handlePress(e,t)|this.handleTouch(e,t)|this.handleValue(e,t))&&(this.el.emit("buttonchanged",this.buttonEventDetails[e],!1),!0)},handleAxes:function(){var e,t=!1,n=this.controller.gamepad.axes,i=this.axis,r=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),e=0;e<n.length;++e)r.push(i[e]!==n[e]),r[e]&&(t=!0);if(!t)return!1;for(this.axis.splice(0,this.axis.length),e=0;e<n.length;e++)this.axis.push(n[e]);return this.el.emit("axismove",this.axisMoveEventDetail,!1),!0},handlePress:function(e,t){var n,i=this.buttonStates[e];return t.pressed!==i.pressed&&(n=t.pressed?"buttondown":"buttonup",this.el.emit(n,this.buttonEventDetails[e],!1),i.pressed=t.pressed,!0)},handleTouch:function(e,t){var n,i=this.buttonStates[e];return t.touched!==i.touched&&(n=t.touched?"touchstart":"touchend",this.el.emit(n,this.buttonEventDetails[e],!1),i.touched=t.touched,!0)},handleValue:function(e,t){var n=this.buttonStates[e];return t.value!==n.value&&(n.value=t.value,!0)}}),z$("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}}),jQ+"controllers/valve/index/valve-index-"),YJ={left:$J+"left.glb",right:$J+"right.glb"},KJ="valve",JJ={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},ZJ={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},eZ=(z$("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var e=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data,t="right"===e.hand?0:"left"===e.hand?1:2;pX(this,KJ,{index:t,iterateControllerProfiles:!0,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:KJ,controller:"right"===t.hand?1:"left"===t.hand?0:2,hand:t.hand}),this.loadModel()},loadModel:function(){var e=this.data;e.model&&this.el.setAttribute("gltf-model",""+YJ[e.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,n=this.mapping.buttons[e.detail.id],i=this.buttonMeshes;n&&("trigger"===n&&(t=e.detail.state.value,i&&i.trigger&&(i.trigger.rotation.x=this.triggerOriginalRotationX-t*(Math.PI/40))),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){var t,n=e.detail.model,i=this;e.target===this.el&&this.data.model&&((t=this.buttonMeshes={}).grip={left:n.getObjectByName("leftgrip"),right:n.getObjectByName("rightgrip")},t.menu=n.getObjectByName("menubutton"),t.system=n.getObjectByName("systembutton"),t.trackpad=n.getObjectByName("touchpad"),t.trigger=n.getObjectByName("trigger"),this.triggerOriginalRotationX=t.trigger.rotation.x,Object.keys(t).forEach((function(e){i.setButtonColor(e,i.data.buttonColor)})),n.position.copy(ZJ[this.data.hand]),n.rotation.copy(JJ[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new dH.Vector3(0,0,0)}))},onAxisMoved:function(e){gX(this,this.mapping.axes,e)},updateModel:function(e,t){var n;this.data.model&&(-1!==t.indexOf("touch")||(n="up"===t?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(e,n)))},setButtonColor:function(e,t){}}),jQ+"controllers/vive/vr_controller_vive.obj"),tZ=jQ+"controllers/vive/vr_controller_vive.mtl",nZ="htc-vive",iZ=(z$("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]},init:function(){var e=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.previousButtonValues={},this.bindMethods()},update:function(){var e=this.data;this.controllerIndex="right"===e.hand?0:"left"===e.hand?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var e=this.data;pX(this,nZ,{index:this.controllerIndex,hand:e.hand})},injectTrackedControls:function(){var e=this.el,t=this.data;e.setAttribute("tracked-controls",{idPrefix:nZ,hand:t.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("obj-model",{obj:eZ,mtl:tZ})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(e){var t,n=this.mapping.buttons[e.detail.id],i=this.buttonMeshes;n&&("trigger"===n&&(t=e.detail.state.value,i&&i.trigger&&(i.trigger.rotation.x=-t*(Math.PI/12))),this.el.emit(n+"changed",e.detail.state))},onModelLoaded:function(e){var t,n=e.detail.model,i=this;e.target===this.el&&this.data.model&&((t=this.buttonMeshes={}).grip={left:n.getObjectByName("leftgrip"),right:n.getObjectByName("rightgrip")},t.menu=n.getObjectByName("menubutton"),t.system=n.getObjectByName("systembutton"),t.trackpad=n.getObjectByName("touchpad"),t.touchpad=n.getObjectByName("touchpad"),t.trigger=n.getObjectByName("trigger"),Object.keys(t).forEach((function(e){i.setButtonColor(e,i.data.buttonColor)})),n.position.set(0,-.015,.04))},onAxisMoved:function(e){gX(this,this.mapping.axes,e)},updateModel:function(e,t){var n;this.data.model&&(-1!==t.indexOf("touch")||(n="up"===t?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(e,n)))},setButtonColor:function(e,t){var n=this.buttonMeshes;if(n)return"grip"===e?(n.grip.left.material.color.set(t),void n.grip.right.material.color.set(t)):void n[e].material.color.set(t)}}),jQ+"controllers/vive/focus-controller/focus-controller.gltf"),rZ="htc-vive-focus",oZ=(z$("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.controllerPresent=!1,this.bindMethods()},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("model-loaded",this.onModelLoaded),e.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("model-loaded",this.onModelLoaded),e.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){pX(this,rZ,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){this.el.setAttribute("tracked-controls",{idPrefix:rZ}),this.data.model&&this.el.setAttribute("gltf-model",iZ)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(e){var t,n=e.detail.model;e.target===this.el&&this.data.model&&((t=this.buttonMeshes={}).trigger=n.getObjectByName("BumperKey"),t.triggerPressed=n.getObjectByName("BumperKey_Press"),t.triggerPressed&&(t.triggerPressed.visible=!1),t.touchpad=n.getObjectByName("TouchPad"),t.touchpadPressed=n.getObjectByName("TouchPad_Press"),t.trackpad=n.getObjectByName("TouchPad"),t.trackpadPressed=n.getObjectByName("TouchPad_Press"),t.trackpadPressed&&(t.trackpadPressed.visible=!1))},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&this.el.emit(t+"changed",e.detail.state)},onAxisMoved:function(e){gX(this,this.mapping.axes,e)},updateModel:function(e,t){this.data.model&&this.updateButtonModel(e,t)},updateButtonModel:function(e,t){var n=this.buttonMeshes,i=e+"Pressed";if(n&&n[e]&&n[i]){var r;switch(t){case"down":r=this.data.buttonHighlightColor;break;case"touchstart":r=this.data.buttonTouchedColor}r&&n[i].material.color.set(r),n[i].visible=!!r,n[e].visible=!r}}}),{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}),sZ=NX,aZ=1e-5,lZ=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];z$("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new dH.Vector3,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(e,t){var n=this.data,i=this.el,r=this.velocity;(r[n.adAxis]||r[n.wsAxis]||!function(e){var t;for(t in e)return!1;return!0}(this.keys))&&(t/=1e3,this.updateVelocity(t),(r[n.adAxis]||r[n.wsAxis])&&i.object3D.position.add(this.getMovementVector(t)))},update:function(e){e.adAxis!==this.data.adAxis&&(this.velocity[e.adAxis]=0),e.wsAxis!==this.data.wsAxis&&(this.velocity[e.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(e){var t,n,i,r,o,s=this.data,a=this.keys,l=this.velocity;if(n=s.adAxis,r=s.wsAxis,e>.2)return l[n]=0,void(l[r]=0);var c=Math.pow(1/this.easing,60*e);0!==l[n]&&(l[n]=l[n]*c),0!==l[r]&&(l[r]=l[r]*c),Math.abs(l[n])<aZ&&(l[n]=0),Math.abs(l[r])<aZ&&(l[r]=0),s.enabled&&(t=s.acceleration,s.adEnabled&&(i=s.adInverted?-1:1,(a.KeyA||a.ArrowLeft)&&(l[n]-=i*t*e),(a.KeyD||a.ArrowRight)&&(l[n]+=i*t*e)),s.wsEnabled&&(o=s.wsInverted?-1:1,(a.KeyW||a.ArrowUp)&&(l[r]-=o*t*e),(a.KeyS||a.ArrowDown)&&(l[r]+=o*t*e)))},getMovementVector:(qJ=new dH.Vector3(0,0,0),XJ=new dH.Euler(0,0,0,"YXZ"),function(e){var t,n=this.el.getAttribute("rotation"),i=this.velocity;return qJ.copy(i),qJ.multiplyScalar(e),n?(t=this.data.fly?n.x:0,XJ.set(dH.MathUtils.degToRad(t),dH.MathUtils.degToRad(n.y),0),qJ.applyEuler(XJ),qJ):qJ}),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var e=Object.keys(this.keys),t=0;t<e.length;t++)delete this.keys[e[t]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(e){var t;sZ(e)&&(t=e.code||oZ[e.keyCode],-1!==lZ.indexOf(t)&&(this.keys[t]=!0))},onKeyUp:function(e){var t;t=e.code||oZ[e.keyCode],delete this.keys[t]}});var cZ,uZ,hZ,dZ=qQ("components:windows-motion-controls:debug"),pZ=qQ("components:windows-motion-controls:warn"),fZ=jQ+"controllers/microsoft/",mZ={left:"left.glb",right:"right.glb",default:"universal.glb"},gZ="windows-mixed-reality",vZ=(z$("windows-motion-controls",{schema:{hand:{default:"right"},pair:{default:0},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var e=this,t=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){vX(t.detail.id,"down",e)},this.onButtonUp=function(t){vX(t.detail.id,"up",e)},this.onButtonTouchStart=function(t){vX(t.detail.id,"touchstart",e)},this.onButtonTouchEnd=function(t){vX(t.detail.id,"touchend",e)},this.onControllerConnected=function(){e.setModelVisibility(!0)},this.onControllerDisconnected=function(){e.setModelVisibility(!1)},this.controllerPresent=!1,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new dH.Vector3,direction:new dH.Vector3(0,0,-1),createdFromMesh:!1},t.addEventListener("controllerconnected",this.onControllerConnected),t.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var e=this.el;e.addEventListener("buttonchanged",this.onButtonChanged),e.addEventListener("buttondown",this.onButtonDown),e.addEventListener("buttonup",this.onButtonUp),e.addEventListener("touchstart",this.onButtonTouchStart),e.addEventListener("touchend",this.onButtonTouchEnd),e.addEventListener("axismove",this.onAxisMoved),e.addEventListener("model-error",this.onModelError),e.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var e=this.el;e.removeEventListener("buttonchanged",this.onButtonChanged),e.removeEventListener("buttondown",this.onButtonDown),e.removeEventListener("buttonup",this.onButtonUp),e.removeEventListener("touchstart",this.onButtonTouchStart),e.removeEventListener("touchend",this.onButtonTouchEnd),e.removeEventListener("axismove",this.onAxisMoved),e.removeEventListener("model-error",this.onModelError),e.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){pX(this,gZ,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(this.data.model&&!this.rayOrigin.createdFromMesh){var e=this.createControllerModelUrl();this.loadModel(e)}else this.modelReady()},createControllerModelUrl:function(e){var t=this.data.hand;return fZ+"default/"+(mZ[t]||mZ.default)},injectTrackedControls:function(){var e=this.data;this.el.setAttribute("tracked-controls",{idPrefix:gZ,controller:e.pair,hand:e.hand}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(e){var t=this.createControllerModelUrl(!0);e.detail.src!==t?(pZ("Failed to load controller model for device, attempting to load default."),this.loadModel(t)):pZ("Failed to load default controller model.")},loadModel:function(e){this.el.setAttribute("gltf-model","url("+e+")")},onModelLoaded:function(e){var t,n,i,r,o=this.controllerModel=e.detail.model,s=this.loadedMeshInfo;if(e.target===this.el){if(dZ("Processing model"),s.buttonMeshes={},s.axisMeshes={},o){for(t=0;t<this.mapping.buttons.length;t++)(n=this.mapping.buttonMeshNames[this.mapping.buttons[t]])?(i=o.getObjectByName(n))?(r={index:t,value:a(i,"VALUE"),pressed:a(i,"PRESSED"),unpressed:a(i,"UNPRESSED")}).value&&r.pressed&&r.unpressed?s.buttonMeshes[this.mapping.buttons[t]]=r:pZ("Missing button submesh under mesh with name: "+n+"(VALUE: "+!!r.value+", PRESSED: "+!!r.pressed+", UNPRESSED:"+!!r.unpressed+")"):pZ("Missing button mesh with name: "+n):dZ("Skipping unknown button at index: "+t+" with mapped name: "+this.mapping.buttons[t]);for(t=0;t<this.mapping.axisMeshNames.length;t++)(n=this.mapping.axisMeshNames[t])?(i=o.getObjectByName(n))?(r={index:t,value:a(i,"VALUE"),min:a(i,"MIN"),max:a(i,"MAX")}).value&&r.min&&r.max?s.axisMeshes[t]=r:pZ("Missing axis submesh under mesh with name: "+n+"(VALUE: "+!!r.value+", MIN: "+!!r.min+", MAX:"+!!r.max+")"):pZ("Missing axis mesh with name: "+n):dZ("Skipping unknown axis at index: "+t);this.calculateRayOriginFromMesh(o),this.setModelVisibility()}dZ("Model load complete.")}function a(e,t){for(var n=0,i=e.children.length;n<i;n++){var r=e.children[n];if(r&&r.name===t)return r}}},calculateRayOriginFromMesh:function(){var e=new dH.Quaternion;return function(t){var n;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,n=t.getObjectByName(this.mapping.pointingPoseMeshName)){var i=t.parent;i&&(t.parent=null,t.updateMatrixWorld(!0),t.parent=i),n.getWorldPosition(this.rayOrigin.origin),n.getWorldQuaternion(e),this.rayOrigin.direction.applyQuaternion(e),i&&t.updateMatrixWorld(!0)}else dZ("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var e=new dH.Quaternion;return function(t,n){var i=this.loadedMeshInfo.axisMeshes[t];if(i){var r=i.min,o=i.max,s=i.value,a=.5*n+.5;s.setRotationFromQuaternion(e.copy(r.quaternion).slerp(o.quaternion,a)),s.position.lerpVectors(r.position,o.position,a)}}}(),lerpButtonTransform:function(){var e=new dH.Quaternion;return function(t,n){var i=this.loadedMeshInfo.buttonMeshes[t];if(i){var r=i.unpressed,o=i.pressed,s=i.value;s.setRotationFromQuaternion(e.copy(r.quaternion).slerp(o.quaternion,n)),s.position.lerpVectors(r.position,o.position,n)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(e){var t=this.mapping.buttons[e.detail.id];t&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(t,e.detail.state.value),this.el.emit(t+"changed",e.detail.state))},onAxisMoved:function(e){var t=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var n=0;n<t;n++)this.lerpAxisTransform(n,e.detail.axis[n]||0);gX(this,this.mapping.axes,e)},setModelVisibility:function(e){var t=this.el.getObject3D("mesh");this.controllerPresent&&(e=void 0!==e?e:this.modelVisible,this.modelVisible=e,t&&(t.visible=e))}}),cZ=new dH.Quaternion,uZ=new dH.Vector3,function(e,t,n){t.position.copy(e.transform.position),t.quaternion.copy(e.transform.orientation),uZ.copy(n),cZ.copy(e.transform.orientation),uZ.applyQuaternion(cZ),t.position.sub(uZ)});function yZ(e,t){this.renderer=e,this.xrHitTestSource=null,e.xr.addEventListener("sessionend",function(){this.xrHitTestSource=null}.bind(this)),e.xr.addEventListener("sessionstart",function(){this.sessionStart(t)}.bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(t)}function AZ(e){console.warn(e.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}vZ.tempFakePose={transform:{orientation:new dH.Quaternion,position:new dH.Vector3}},yZ.prototype.previousFrameAnchors=new Set,yZ.prototype.anchorToObject3D=new Map,yZ.prototype.sessionStart=function(e){this.session=this.renderer.xr.getSession(),"requestHitTestSource"in this.session?e.space?this.session.requestHitTestSource(e).then(function(e){this.xrHitTestSource=e}.bind(this)).catch(AZ):e.profile&&this.session.requestHitTestSourceForTransientInput(e).then(function(e){this.xrHitTestSource=e,this.transient=!0}.bind(this)).catch(AZ):AZ({message:"No requestHitTestSource on the session."})},yZ.prototype.anchorFromLastHitTestResult=function(e,t){var n=this.lastHitTest;if(n){var i={object3D:e,offset:t};Array.from(this.anchorToObject3D.entries()).forEach(function(t){var n=t[1].object3D,i=t[0];n===e&&(this.anchorToObject3D.delete(i),i.delete())}.bind(this)),n.createAnchor&&n.createAnchor().then(function(e){this.anchorToObject3D.set(e,i)}.bind(this)).catch((function(e){console.warn(e.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')}))}},yZ.prototype.doHit=function(e){if(this.renderer.xr.isPresenting){var t,n,i=this.renderer.xr.getReferenceSpace(),r=e.getViewerPose(i);return this.xrHitTestSource&&r?this.transient?(t=e.getHitTestResultsForTransientInput(this.xrHitTestSource)).length>0&&(n=t[0].results).length>0&&(this.lastHitTest=n[0],n[0].getPose(i)):(t=e.getHitTestResults(this.xrHitTestSource)).length>0&&(this.lastHitTest=t[0],t[0].getPose(i)):void 0}},yZ.updateAnchorPoses=function(e,t){var n=e.trackedAnchors||yZ.prototype.previousFrameAnchors;yZ.prototype.previousFrameAnchors.forEach((function(e){n.has(e)||yZ.prototype.anchorToObject3D.delete(e)})),n.forEach((function(n){var i,r,o,s;try{if(i=e.getPose(n.anchorSpace,t)){if(!(r=yZ.prototype.anchorToObject3D.get(n)))return;o=r.offset,s=r.object3D,vZ(i,s,o)}}catch(e){console.error("while updating anchor poses:",e)}})),yZ.prototype.previousFrameAnchors=n},z$("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:"data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new dH.OrthographicCamera,this.orthoCam.layers.set(21),this.textureTarget=new dH.WebGLRenderTarget(512,512,{}),this.basicMaterial=new dH.MeshBasicMaterial({color:0,side:dH.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new dH.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var e=this.el.getAttribute("webxr"),t=e.optionalFeatures;t.includes("hit-test")&&t.includes("anchors")||(t.push("hit-test"),t.push("anchors"),this.el.setAttribute("webxr",e)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",function(){this.hitTest=null}.bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",function(){if(this.el.is("ar-mode")){var e=this.el.sceneEl.renderer,t=this.session=e.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,hZ||(hZ=new Map),t.requestReferenceSpace("viewer").then(function(t){this.viewerHitTest=this.hitTest=new yZ(e,{space:t}),this.el.emit("ar-hit-test-start")}.bind(this));var n=this;this.el.sceneEl.addEventListener("controllersupdated",(function(){var t=this.xrSession&&this.xrSession.inputSources;if(t)for(var i=0;i<t.length;++i)if("tracked-pointer"===t[i].targetRayMode){n.hitTest=new yZ(e,{space:t[i].targetRaySpace}),hZ.set(t[i],n.hitTest),n.viewerHitTest&&"function"==typeof n.viewerHitTest.cancel&&(n.viewerHitTest.cancel(),n.viewerHitTest=null);break}}));var i="generic-touchscreen",r=new yZ(e,{profile:i});t.addEventListener("selectstart",function(t){if(!0===this.data.enabled){var n=t.inputSource;this.bboxMesh.visible=!0,!0===this.hasPosedOnce&&(this.el.emit("ar-hit-test-select-start",{inputSource:n,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),n.profiles[0]===i?this.hitTest=r:(this.hitTest=hZ.get(n)||new yZ(e,{space:n.targetRaySpace}),hZ.set(n,this.hitTest)))}}.bind(this)),t.addEventListener("selectend",function(e){if(this.hitTest&&!0===this.data.enabled){var t,n=e.inputSource;!0===this.hasPosedOnce&&(this.bboxMesh.visible=!1,this.data.target&&(t=this.data.target.object3D)&&(vZ.tempFakePose.transform.position.copy(this.bboxMesh.position),vZ.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),vZ(vZ.tempFakePose,t,this.bboxOffset),t.visible=!0,this.hitTest.anchorFromLastHitTestResult(t,this.bboxOffset)),this.el.emit("ar-hit-test-select",{inputSource:n,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),this.hitTest=null)}else this.hitTest=null}.bind(this))}}.bind(this)),this.bboxOffset=new dH.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){!1===this.data.enabled&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(21),this.data.target.object3D.traverse((function(e){e.layers.enable(21)}))):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var e=new dH.PlaneGeometry(1,1),t=new dH.MeshBasicMaterial({transparent:!0,color:16777215});e.rotateX(-Math.PI/2),e.rotateY(-Math.PI/2),this.bbox=new dH.Box3,this.bboxMesh=new dH.Mesh(e,t),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var e,t,n,i=this.el.sceneEl.renderer,r=i.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),t=i.getRenderTarget(),i.setRenderTarget(this.textureTarget),i.xr.enabled=!1,n=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,i.render(this.el.object3D,this.orthoCam),this.el.object3D.background=n,this.el.object3D.overrideMaterial=null,i.xr.enabled=r,i.setRenderTarget(t),i.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),e=this.context.getImageData(0,0,512,512);for(var o=0;o<262144;o++)0!==e.data[4*o+3]&&255!==e.data[4*o+3]&&(e.data[4*o+3]=128);this.context.putImageData(e,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var e,t,n=this.el.sceneEl.frame,i=this.el.sceneEl.renderer;n&&yZ.updateAnchorPoses(n,i.xr.getReferenceSpace()),this.bboxNeedsUpdate&&(this.bboxNeedsUpdate=!1,this.data.target&&"map"!==this.data.type||(this.textureCache.has(this.data.src)?t=this.textureCache.get(this.data.src):(t=(new dH.TextureLoader).load(this.data.src),this.textureCache.set(this.data.src,t)),this.bboxMesh.material.map=t,this.bboxMesh.material.needsUpdate=!0),this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),"footprint"===this.data.type&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)),this.hitTest&&(e=this.hitTest.doHit(n))&&(!0!==this.hasPosedOnce&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(e.transform.position),this.bboxMesh.quaternion.copy(e.transform.orientation))}}),z$("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var e=this.data,t=this.el.object3D;e.transparent?t.background=null:t.background=new dH.Color(e.color)},remove:function(){this.el.object3D.background=null}}),z$("debug",{schema:{default:!0},sceneOnly:!0});var xZ="a-dialog-buttons-container",bZ="a-dialog-button";function _Z(e,t){var n,i,r,o;return(n=document.createElement("div")).classList.add("a-modal"),n.setAttribute(VQ,""),(i=document.createElement("div")).className="a-dialog",i.setAttribute(VQ,""),n.appendChild(i),(r=document.createElement("div")).classList.add("a-dialog-text-container"),i.appendChild(r),(o=document.createElement("div")).classList.add("a-dialog-text"),o.innerHTML=e,r.appendChild(o),i.appendChild(t),n}z$("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var e=this;this.data.enabled&&(window.isSecureContext||this.showHTTPAlert(),"undefined"!=typeof DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission?(this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then((function(){e.el.emit("deviceorientationpermissiongranted"),e.permissionGranted=!0})).catch((function(){var t,n,i,r,o,s,a,l;e.devicePermissionDialogEl=(t=e.data.denyButtonText,n=e.data.allowButtonText,i=e.data.deviceMotionMessage,r=e.onDeviceMotionDialogAllowClicked,o=e.onDeviceMotionDialogDenyClicked,(s=document.createElement("div")).classList.add(xZ),(a=document.createElement("button")).classList.add(bZ,"a-dialog-deny-button"),a.setAttribute(VQ,""),a.innerHTML=t,s.appendChild(a),(l=document.createElement("button")).classList.add(bZ,"a-dialog-allow-button"),l.setAttribute(VQ,""),l.innerHTML=n,s.appendChild(l),l.addEventListener("click",(function(e){e.stopPropagation(),r()})),a.addEventListener("click",(function(e){e.stopPropagation(),o()})),_Z(i,s)),e.el.appendChild(e.devicePermissionDialogEl)}))):this.permissionGranted=!0)},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var e,t,n,i,r,o=this,s=(e=o.data.cancelButtonText,t=o.data.httpsMessage,n=function(){o.el.removeChild(s)},(i=document.createElement("div")).classList.add(xZ),(r=document.createElement("button")).classList.add(bZ,"a-dialog-ok-button"),r.setAttribute(VQ,""),r.innerHTML=e,i.appendChild(r),r.addEventListener("click",(function(e){e.stopPropagation(),n()})),_Z(t,i));this.el.appendChild(s)},onDeviceMotionDialogAllowClicked:function(){var e=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t?(e.el.emit("deviceorientationpermissiongranted"),e.permissionGranted=!0):e.el.emit("deviceorientationpermissionrejected"),e.remove()})).catch(console.error)}}),z$("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var e=this.el,t=e.querySelector(".a-enter-vr");!0===this.data?(t&&t.classList.add("embedded"),e.removeFullScreenStyles()):(t&&t.classList.remove("embedded"),e.addFullScreenStyles())}}),z$("inspector",{schema:{url:{default:"https://unpkg.com/aframe-inspector@"+function(){var e=zY.split(".");return e[2]="x",e.join(".")}()+"/dist/aframe-inspector.min.js"}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var e;this.firstPlay&&"false"!==(e=OX("inspector"))&&e&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(e){73===e.keyCode&&(e.ctrlKey&&e.altKey||e.getModifierState("AltGraph"))&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(e){"INJECT_AFRAME_INSPECTOR"===e.data&&this.openInspector()},openInspector:function(e){var t,n=this;AFRAME.INSPECTOR||AFRAME.inspectorInjected?AFRAME.INSPECTOR.open(e):(this.showLoader(),(t=document.createElement("script")).src=this.data.url,t.setAttribute("data-name","aframe-inspector"),t.setAttribute(VQ,""),t.onload=function(){AFRAME.INSPECTOR.open(e),n.hideLoader(),n.removeEventListeners()},t.onerror=function(){n.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(t),AFRAME.inspectorInjected=!0)},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}}),z$("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var e=this.data,t=this.el,n=this.el.object3D.fog;n&&e.type===n.name?Object.keys(this.schema).forEach((function(t){var i=e[t];"color"===t&&(i=new dH.Color(i)),n[t]=i})):t.object3D.fog=function(e){var t;return(t="exponential"===e.type?new dH.FogExp2(e.color,e.density):new dH.Fog(e.color,e.near,e.far)).name=e.type,t}(e)},remove:function(){var e=this.el;this.el.object3D.fog&&(e.object3D.fog=null)}}),z$("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(e){var t=this.el;NX(e)&&(this.data.enterVR&&70===e.keyCode&&t.enterVR(),this.data.exitVR&&27===e.keyCode&&t.exitVR())}});var wZ=qQ("components:pool:warn");z$("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var e;for(this.availableEls=[],this.usedEls=[],this.data.mixin||wZ("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||wZ("Container "+this.data.container+" not found.")),this.container=this.container||this.el,e=0;e<this.data.size;++e)this.createEntity()},update:function(e){var t=this.data;e.mixin===t.mixin&&e.size===t.size||this.initPool()},createEntity:function(){var e;(e=document.createElement("a-entity")).play=this.wrapPlay(e.play),e.setAttribute("mixin",this.data.mixin),e.object3D.visible=!1,e.pause(),this.container.appendChild(e),this.availableEls.push(e);var t=this.usedEls;e.addEventListener("loaded",(function(){-1===t.indexOf(e)&&(e.object3DParent=e.object3D.parent,e.object3D.parent.remove(e.object3D))}))},wrapPlay:function(e){var t=this.usedEls;return function(){-1!==t.indexOf(this)&&e.call(this)}},requestEntity:function(){var e;if(0===this.availableEls.length){if(!1===this.data.dynamic)return void wZ("Requested entity from empty pool: "+this.attrName);wZ("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return e=this.availableEls.shift(),this.usedEls.push(e),e.object3DParent&&(e.object3DParent.add(e.object3D),this.updateRaycasters()),e.object3D.visible=!0,e},returnEntity:function(e){var t=this.usedEls.indexOf(e);if(-1!==t)return this.usedEls.splice(t,1),this.availableEls.push(e),e.object3DParent=e.object3D.parent,e.object3D.parent.remove(e.object3D),this.updateRaycasters(),e.object3D.visible=!1,e.pause(),e;wZ("The returned entity was not previously pooled from "+this.attrName)},updateRaycasters:function(){document.querySelectorAll("[raycaster]").forEach((function(e){e.components.raycaster.setDirty()}))}}),z$("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var e=this.el.getAttribute("webxr"),t=e.requiredFeatures;-1===t.indexOf("mesh-detection")&&(t.push("mesh-detection"),this.el.setAttribute("webxr",e)),-1===t.indexOf("plane-detection")&&(t.push("plane-detection"),this.el.setAttribute("webxr",e)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var e,t,n,i=this.data,r=this.el,o=this.meshEntities,s=!1,a=[],l=this.data.filterLabels;e=(n=r.frame).detectedMeshes,t=n.detectedPlanes;for(var c=0;c<o.length;c++)o[c].present=!1;if(i.meshesEnabled)for(var u of e.values())if(!l.length||-1!==l.indexOf(u.semanticLabel)){for(c=0;c<o.length;c++)if(u===o[c].mesh){s=!0,o[c].present=!0,o[c].lastChangedTime<u.lastChangedTime&&this.updateMeshGeometry(o[c].el,u),o[c].lastChangedTime=u.lastChangedTime;break}s||a.push(u),s=!1}if(i.planesEnabled)for(u of t.values())if(!l.length||-1!==l.indexOf(u.semanticLabel)){for(c=0;c<o.length;c++)if(u===o[c].mesh){s=!0,o[c].present=!0,o[c].lastChangedTime<u.lastChangedTime&&this.updateMeshGeometry(o[c].el,u),o[c].lastChangedTime=u.lastChangedTime;break}s||a.push(u),s=!1}this.deleteMeshes(),this.createNewMeshes(a)},updateMeshes:function(){var e=new dH.Matrix4;return function(){for(var t,n,i,r=this.el,o=r.frame,s=this.meshEntities,a=r.renderer.xr.getReferenceSpace(),l=0;l<s.length;l++)i=s[l].mesh.meshSpace||s[l].mesh.planeSpace,t=o.getPose(i,a),(n=s[l].el).hasLoaded&&(e.fromArray(t.transform.matrix),e.decompose(n.object3D.position,n.object3D.quaternion,n.object3D.scale))}}(),deleteMeshes:function(){for(var e=this.meshEntities,t=[],n=0;n<e.length;n++)e[n].present?t.push(e[n]):this.el.removeChild(e[n]);this.meshEntities=t},createNewMeshes:function(e){for(var t,n=0;n<e.length;n++)t=document.createElement("a-entity"),this.meshEntities.push({mesh:e[n],el:t}),t.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(t)},initMeshGeometry:function(e){var t,n,i;if(e instanceof XRPlane){n=new dH.Shape,i=e.polygon;for(var r=0;r<i.length;++r)0===r?n.moveTo(i[r].x,i[r].z):n.lineTo(i[r].x,i[r].z);return(t=new dH.ShapeGeometry(n)).rotateX(Math.PI/2),t}return(t=new dH.BufferGeometry).setAttribute("position",new dH.BufferAttribute(e.vertices,3)),t.setIndex(new dH.BufferAttribute(e.indices,1)),t},initWorldMeshEntity:function(e){for(var t,n,i,r=e.target,o=this.meshEntities,s=0;s<o.length;s++)if(o[s].el===r){i=o[s];break}t=this.initMeshGeometry(i.mesh),n=new dH.Mesh(t,new dH.MeshBasicMaterial({color:16777215*Math.random(),side:dH.DoubleSide})),r.setObject3D("mesh",n),i.mesh instanceof XRPlane&&this.data.planeMixin?r.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&r.setAttribute("mixin",this.data.meshMixin),r.setAttribute("data-world-mesh",i.mesh.semanticLabel)},updateMeshGeometry:function(e,t){var n=e.getObject3D("mesh");n.geometry.dispose(),n.geometry=this.initMeshGeometry(t)}}),z$("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var e=this;this.cubeRenderTarget=new dH.WebGLCubeRenderTarget(16),this.cubeCamera=new dH.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new dH.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var t=this.el.getAttribute("webxr"),n=t.optionalFeatures;n.includes("light-estimation")||(n.push("light-estimation"),this.el.setAttribute("webxr",t)),this.el.addEventListener("enter-vr",(function(){e.el.is("ar-mode")&&e.el.renderer.xr.getSession().requestLightProbe&&e.startLightProbe()})),this.el.addEventListener("exit-vr",(function(){e.xrLightProbe&&e.stopLightProbe()})),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var e=this.el.renderer,t=e.xr.getSession(),n=this,i=e.getContext();if(!this.probeLight){var r=document.createElement("a-light");r.setAttribute("type","probe"),r.setAttribute("intensity",0),this.el.appendChild(r),this.probeLight=r}switch(t.preferredReflectionFormat){case"srgba8":i.getExtension("EXT_sRGB");break;case"rgba16f":i.getExtension("OES_texture_half_float")}this.glBinding=new XRWebGLBinding(t,i),i.getExtension("EXT_sRGB"),i.getExtension("OES_texture_half_float"),t.requestLightProbe().then((function(e){n.xrLightProbe=e,e.addEventListener("reflectionchange",n.updateXRCubeMap.bind(n))})).catch((function(e){console.warn("Lighting estimation not supported: "+e.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')}))},updateXRCubeMap:function(){var e=this.el.renderer,t=this.glBinding.getReflectionCubeMap(this.xrLightProbe);t&&(e.properties.get(this.lightingEstimationTexture).__webglTexture=t,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture)},tick:function(){var e=this.el.object3D,t=this.el.renderer,n=this.el.frame;if(n&&this.xrLightProbe){var i=n.getLightEstimate(this.xrLightProbe);i&&function(e,t,n,i){var r=Math.max(e.primaryLightIntensity.x,Math.max(e.primaryLightIntensity.y,e.primaryLightIntensity.z));t.sh.fromArray(e.sphericalHarmonicsCoefficients),t.intensity=3.14,n&&(n.color.setRGB(e.primaryLightIntensity.x/r,e.primaryLightIntensity.y/r,e.primaryLightIntensity.z/r),n.intensity=r,i.copy(e.primaryLightDirection))}(i,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(e.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(t,e),e.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&n&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}});var EZ=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),SZ=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join("\n"),CZ=(z$("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var e=this.el;if(!this.canvas){var t=e.renderer.getContext();t&&(this.cubeMapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new dH.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:EZ,fragmentShader:SZ,side:dH.DoubleSide}),this.quad=new dH.Mesh(new dH.PlaneGeometry(1,1),this.material),this.quad.visible=!1,this.camera=new dH.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),e.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(e,t){return new dH.WebGLRenderTarget(e,t,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:dH.LinearFilter,magFilter:dH.LinearFilter,wrapS:dH.ClampToEdgeWrapping,wrapT:dH.ClampToEdgeWrapping,format:dH.RGBAFormat,type:dH.UnsignedByteType})},resize:function(e,t){this.quad.scale.set(e,t,1),this.camera.left=-1*e/2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=-1*t/2,this.camera.updateProjectionMatrix(),this.canvas.width=e,this.canvas.height=t},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(e){var t=83===e.keyCode&&e.ctrlKey&&e.altKey;if(this.data&&t){var n=e.shiftKey?"equirectangular":"perspective";this.capture(n)}},setCapture:function(e){var t,n,i,r,o=this.el;return"perspective"===e?(this.quad.visible=!1,n=this.data.camera&&this.data.camera.components.camera.camera||o.camera,t={width:this.data.width,height:this.data.height}):(n=this.camera,r=new dH.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:dH.RGBFormat,generateMipmaps:!0,minFilter:dH.LinearMipmapLinearFilter,colorSpace:dH.SRGBColorSpace}),i=new dH.CubeCamera(o.camera.near,o.camera.far,r),o.camera.getWorldPosition(i.position),o.camera.getWorldQuaternion(i.quaternion),i.update(o.renderer,o.object3D),this.quad.material.uniforms.map.value=i.renderTarget.texture,t={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:n,size:t,projection:e}},capture:function(e){var t,n=this.el.renderer.xr.enabled,i=this.el.renderer;this.setup(),i.xr.enabled=!1,t=this.setCapture(e),this.renderCapture(t.camera,t.size,t.projection),this.saveCapture(),i.xr.enabled=n},getCanvas:function(e){var t=this.el.renderer.xr.enabled,n=this.el.renderer;this.setup();var i=this.setCapture(e);return n.xr.enabled=!1,this.renderCapture(i.camera,i.size,i.projection),n.xr.enabled=t,this.canvas},renderCapture:function(e,t,n){var i,r,o,s=this.el.renderer.autoClear,a=this.el,l=a.renderer;r=this.getRenderTarget(t.width,t.height),o=new Uint8Array(4*t.width*t.height),this.resize(t.width,t.height),l.autoClear=!0,l.clear(),l.setRenderTarget(r),l.render(a.object3D,e),l.autoClear=s,l.readRenderTargetPixels(r,0,0,t.width,t.height,o),l.setRenderTarget(null),"perspective"===n&&(o=this.flipPixelsVertically(o,t.width,t.height)),i=new ImageData(new Uint8ClampedArray(o),t.width,t.height),this.quad.visible=!1,this.ctx.putImageData(i,0,0)},flipPixelsVertically:function(e,t,n){for(var i=e.slice(0),r=0;r<t;++r)for(var o=0;o<n;++o)i[4*r+o*t*4]=e[4*r+(n-o)*t*4],i[4*r+1+o*t*4]=e[4*r+1+(n-o)*t*4],i[4*r+2+o*t*4]=e[4*r+2+(n-o)*t*4],i[4*r+3+o*t*4]=e[4*r+3+(n-o)*t*4];return i},saveCapture:function(){this.canvas.toBlob((function(e){var t="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",n=document.createElement("a"),i=URL.createObjectURL(e);n.href=i,n.setAttribute("download",t),n.innerHTML="downloading...",n.style.display="none",document.body.appendChild(n),setTimeout((function(){n.click(),document.body.removeChild(n)}),1)}),"image/png")}}),kV(282)),MZ=kV.n(CZ),TZ=(kV(3729),kV(8132),window.aframeStats),RZ="a-hidden",IZ=window.threeStats;z$("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var e=this.el;"false"!==OX("stats")&&(this.stats=function(e){var t=new IZ(e.renderer),n=new TZ(e),i=e.isMobile?[]:[t,n];return new(MZ())({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:i})}(e),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),e.addEventListener("enter-vr",this.hideBound),e.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var e=this.stats;e&&(e("rAF").tick(),e("FPS").frame(),e().update())},hide:function(){this.statsEl.classList.add(RZ)},show:function(){this.statsEl.classList.remove(RZ)}});var PZ="a-hidden";function BZ(e){e.addEventListener("touchstart",(function(){e.classList.remove("resethover")}),{passive:!0}),e.addEventListener("touchend",(function(){e.classList.add("resethover")}),{passive:!0})}z$("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var e=this,t=this.el;"false"!==OX("ui")&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),t.addEventListener("enter-vr",this.updateEnterInterfaces),t.addEventListener("exit-vr",this.updateEnterInterfaces),t.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",(function(t){"loaderReady"===t.data.type&&(e.insideLoader=!0,e.remove())})),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var e,t,n,i=this.data,r=this.el;if(!i.enabled||this.insideLoader||"false"===OX("ui"))return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(this.enterVREl||!i.enterVREnabled||"xr"!==i.XRMode&&"vr"!==i.XRMode||(i.enterVRButton?(this.enterVREl=document.querySelector(i.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=(e=this.onEnterVRButtonClick,(n=document.createElement("div")).classList.add("a-enter-vr"),n.setAttribute(VQ,""),(t=document.createElement("button")).className="a-enter-vr-button",t.setAttribute("title","Enter VR mode with a headset or fullscreen without"),t.setAttribute(VQ,""),aq()&&BZ(t),n.appendChild(t),t.addEventListener("click",(function(t){e(),t.stopPropagation()})),n),r.appendChild(this.enterVREl))),this.enterAREl||!i.enterAREnabled||"xr"!==i.XRMode&&"ar"!==i.XRMode||(i.enterARButton?(this.enterAREl=document.querySelector(i.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=function(e,t){var n,i;return(i=document.createElement("div")).classList.add("a-enter-ar"),t&&i.classList.add("xr"),i.setAttribute(VQ,""),(n=document.createElement("button")).className="a-enter-ar-button",n.setAttribute("title","Enter AR mode with a headset or handheld device."),n.setAttribute(VQ,""),aq()&&BZ(n),i.appendChild(n),n.addEventListener("click",(function(t){e(),t.stopPropagation()})),i}(this.onEnterARButtonClick,"xr"===i.XRMode),r.appendChild(this.enterAREl))),this.orientationModalEl=function(e){var t=document.createElement("div");t.className="a-orientation-modal",t.classList.add(PZ),t.setAttribute(VQ,"");var n=document.createElement("button");return n.setAttribute(VQ,""),n.innerHTML="Exit VR",n.addEventListener("click",e),t.appendChild(n),t}(this.onModalClick),r.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach((function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var e=this.el;this.enterVREl&&(e.is("vr-mode")||(e.isMobile||dq())&&!rq()?this.enterVREl.classList.add(PZ):(rq()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(PZ),e.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var e=this.el;this.enterAREl&&(e.is("vr-mode")||!iq()?this.enterAREl.classList.add(PZ):(this.enterAREl.classList.remove(PZ),e.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var e=this.el,t=this.orientationModalEl;t&&e.isMobile&&(!vq()&&e.is("vr-mode")?t.classList.remove(PZ):t.classList.add(PZ))}}),xY("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(e){this.geometry=new dH.BoxGeometry(e.width,e.height,e.depth,e.segmentsWidth,e.segmentsHeight,e.segmentsDepth)}});var LZ=dH.MathUtils.degToRad;xY("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new dH.CircleGeometry(e.radius,e.segments,LZ(e.thetaStart),LZ(e.thetaLength))}});var NZ=dH.MathUtils.degToRad;xY("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new dH.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,NZ(e.thetaStart),NZ(e.thetaLength))}});var DZ=dH.MathUtils.degToRad;xY("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new dH.CylinderGeometry(e.radius,e.radius,e.height,e.segmentsRadial,e.segmentsHeight,e.openEnded,DZ(e.thetaStart),DZ(e.thetaLength))}}),xY("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new dH.DodecahedronGeometry(e.radius,e.detail)}}),xY("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new dH.IcosahedronGeometry(e.radius,e.detail)}}),xY("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new dH.OctahedronGeometry(e.radius,e.detail)}}),xY("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(e){this.geometry=new dH.PlaneGeometry(e.width,e.height,e.segmentsWidth,e.segmentsHeight)}});var kZ=dH.MathUtils.degToRad;xY("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(e){this.geometry=new dH.RingGeometry(e.radiusInner,e.radiusOuter,e.segmentsTheta,e.segmentsPhi,kZ(e.thetaStart),kZ(e.thetaLength))}});var OZ=dH.MathUtils.degToRad;xY("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(e){this.geometry=new dH.SphereGeometry(e.radius,e.segmentsWidth,e.segmentsHeight,OZ(e.phiStart),OZ(e.phiLength),OZ(e.thetaStart),OZ(e.thetaLength))}}),xY("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(e){this.geometry=new dH.TetrahedronGeometry(e.radius,e.detail)}});var UZ=dH.MathUtils.degToRad;xY("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(e){this.geometry=new dH.TorusGeometry(e.radius,2*e.radiusTubular,e.segmentsRadial,e.segmentsTubular,UZ(e.arc))}}),xY("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(e){this.geometry=new dH.TorusKnotGeometry(e.radius,2*e.radiusTubular,e.segmentsTubular,e.segmentsRadial,e.p,e.q)}});var FZ=new dH.Quaternion,zZ=new dH.Vector3(0,0,1),jZ=new dH.Vector2,VZ=new dH.Vector2,GZ=new dH.Vector2;function HZ(e,t){return t.color.set(e.color),t.fog=e.fog,t.wireframe=e.wireframe,t.toneMapped=e.toneMapped,t.wireframeLinewidth=e.wireframeLinewidth,t}function WZ(e,t){return t.color.set(e.color),t.emissive.set(e.emissive),t.emissiveIntensity=e.emissiveIntensity,t.fog=e.fog,t.metalness=e.metalness,t.roughness=e.roughness,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,e.normalMap&&(t.normalScale=e.normalScale),e.ambientOcclusionMap&&(t.aoMapIntensity=e.ambientOcclusionMapIntensity),e.displacementMap&&(t.displacementScale=e.displacementScale,t.displacementBias=e.displacementBias),t}function QZ(e,t){switch(t.color.set(e.color),t.specular.set(e.specular),t.emissive.set(e.emissive),t.emissiveIntensity=e.emissiveIntensity,t.fog=e.fog,t.transparent=e.transparent,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,t.shininess=e.shininess,t.flatShading=e.flatShading,t.wireframe=e.wireframe,t.wireframeLinewidth=e.wireframeLinewidth,t.reflectivity=e.reflectivity,t.refractionRatio=e.refractionRatio,e.combine){case"mix":t.combine=dH.MixOperation;break;case"multiply":t.combine=dH.MultiplyOperation;break;case"add":t.combine=dH.AddOperation}return e.normalMap&&(t.normalScale=e.normalScale),e.ambientOcclusionMap&&(t.aoMapIntensity=e.ambientOcclusionMapIntensity),e.bumpMap&&(t.bumpScale=e.bumpMapScale),e.displacementMap&&(t.displacementScale=e.displacementScale,t.displacementBias=e.displacementBias),t}xY("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(e){var t,n,i,r,o,s,a,l,c;(i=new dH.Triangle).a.set(e.vertexA.x,e.vertexA.y,e.vertexA.z),i.b.set(e.vertexB.x,e.vertexB.y,e.vertexB.z),i.c.set(e.vertexC.x,e.vertexC.y,e.vertexC.z),n=i.getNormal(new dH.Vector3),FZ.setFromUnitVectors(n,zZ),r=i.a.clone().applyQuaternion(FZ),o=i.b.clone().applyQuaternion(FZ),s=i.c.clone().applyQuaternion(FZ),jZ.set(Math.min(r.x,o.x,s.x),Math.min(r.y,o.y,s.y)),VZ.set(Math.max(r.x,o.x,s.x),Math.max(r.y,o.y,s.y)),GZ.set(0,0).subVectors(VZ,jZ),r=(new dH.Vector2).subVectors(r,jZ).divide(GZ),o=(new dH.Vector2).subVectors(o,jZ).divide(GZ),s=(new dH.Vector2).subVectors(s,jZ).divide(GZ),t=this.geometry=new dH.BufferGeometry,a=[i.a.x,i.a.y,i.a.z,i.b.x,i.b.y,i.b.z,i.c.x,i.c.y,i.c.z],l=[n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z],c=[r.x,r.y,o.x,o.y,s.x,s.y],t.setAttribute("position",new dH.Float32BufferAttribute(a,3)),t.setAttribute("normal",new dH.Float32BufferAttribute(l,3)),t.setAttribute("uv",new dH.Float32BufferAttribute(c,2))}}),LY("flat",{schema:{color:{type:"color"},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(e){this.materialData={color:new dH.Color},HZ(e,this.materialData),this.material=new dH.MeshBasicMaterial(this.materialData)},update:function(e){this.updateMaterial(e),Kq(this,e)},updateMaterial:function(e){var t;for(t in HZ(e,this.materialData),this.materialData)this.material[t]=this.materialData[t]}}),LY("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(e){this.materialData={color:new dH.Color,emissive:new dH.Color},WZ(e,this.materialData),this.material=new dH.MeshStandardMaterial(this.materialData)},update:function(e){this.updateMaterial(e),Kq(this,e),Jq("normal",this,e),Jq("displacement",this,e),Jq("ambientOcclusion",this,e),Jq("metalness",this,e),Jq("roughness",this,e),eX(this,e)},updateMaterial:function(e){var t,n=this.material;for(t in WZ(e,this.materialData),this.materialData)n[t]=this.materialData[t]}}),LY("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(e){this.materialData={color:new dH.Color,specular:new dH.Color,emissive:new dH.Color},QZ(e,this.materialData),this.material=new dH.MeshPhongMaterial(this.materialData);var t=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||t.object3D.environment},set:function(e){this._envMap=e}})},update:function(e){this.updateMaterial(e),Kq(this,e),Jq("normal",this,e),Jq("displacement",this,e),Jq("ambientOcclusion",this,e),Jq("bump",this,e),eX(this,e)},updateMaterial:function(e){var t;for(t in QZ(e,this.materialData),this.materialData)this.material[t]=this.materialData[t]}}),LY("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec2 uv = vUV;","  vec4 texColor = texture(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture(map, box.xy).a, width)","      + contour(texture(map, box.zw).a, width)","      + contour(texture(map, box.xw).a, width)","      + contour(texture(map, box.zy).a, width)","    )) / 3.0;","  }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color, opacity * alpha);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join("\n"),init:function(){return this.uniforms=this.initUniforms(),dH.UniformsUtils&&(this.uniforms=dH.UniformsUtils.merge([dH.UniformsLib.fog,this.uniforms])),this.material=new dH.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}}),LY("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join("\n"),init:function(){return this.uniforms=this.initUniforms(),dH.UniformsUtils&&(this.uniforms=dH.UniformsUtils.merge([dH.UniformsLib.fog,this.uniforms])),this.material=new dH.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}}),LY("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(e){this.material=new dH.ShadowMaterial},update:function(e){this.material.opacity=e.opacity,this.material.alphaToCoverage=e.alphaToCoverage,this.material.transparent=e.transparent}});var qZ="data-aframe-default-camera";function XZ(e){var t=e.primitive,n=vY[t]&&vY[t].Geometry,i=new n;if(!n)throw new Error("Unknown geometry `"+t+"`");return i.init(e),i.geometry}X$("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var e,t,n=this.sceneEl,i=this;if(!n.camera||n.camera.el.getAttribute("camera").spectator)if((e=n.querySelectorAll("a-camera, :not(a-mixin)[camera]")).length)for(this.numUserCameras=e.length,t=0;t<e.length;t++)e[t].addEventListener("object3dset",(function(e){"camera"===e.detail.type&&i.checkUserCamera(this)})),e[t].isANode?e[t].load():e[t].addEventListener("nodeready",(function(){this.load()}));else this.createDefaultCamera();else n.emit("cameraready",{cameraEl:n.camera.el})},checkUserCamera:function(e){var t,n=this.el.sceneEl;this.numUserCamerasChecked++,this.initialCameraFound||((t=e.getAttribute("camera")).active&&!t.spectator?(this.initialCameraFound=!0,n.camera=e.getObject3D("camera"),n.emit("cameraready",{cameraEl:e})):this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera())},createDefaultCamera:function(){var e,t=this.sceneEl;(e=document.createElement("a-entity")).setAttribute("camera",{active:!0}),e.setAttribute("position",{x:0,y:1.6,z:0}),e.setAttribute("wasd-controls",""),e.setAttribute("look-controls",""),e.setAttribute(VQ,""),e.addEventListener("object3dset",(function(n){"camera"===n.detail.type&&(t.camera=n.detail.object,t.emit("cameraready",{cameraEl:e}))})),t.appendChild(e)},disableActiveCamera:function(){var e;(e=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"))[e.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(e){var t,n,i,r,o=this.activeCameraEl,s=this.sceneEl;if((r=e.getObject3D("camera"))&&e!==this.activeCameraEl){var a=s.querySelector("["+qZ+"]");for(e!==(a&&a.querySelector(":not(a-mixin)[camera]"))&&function(e){var t;e.camera&&(t=e.querySelector("["+qZ+"]"))&&e.removeChild(t)}(s),this.activeCameraEl=e,this.activeCameraEl.play(),s.camera=r,o&&o.setAttribute("camera","active",!1),n=s.querySelectorAll(":not(a-mixin)[camera]"),i=0;i<n.length;i++)(t=n[i]).isEntity&&e!==t&&(t.setAttribute("camera","active",!1),t.pause());s.emit("camera-set-active",{cameraEl:e})}},setSpectatorCamera:function(e){var t,n=this.spectatorCameraEl,i=this.sceneEl;e.getObject3D("camera")&&e!==this.spectatorCameraEl&&(n&&n.setAttribute("camera","spectator",!1),t=this.spectatorCameraEl=e,i.addEventListener("enter-vr",this.wrapRender),i.addEventListener("exit-vr",this.unwrapRender),t.setAttribute("camera","active",!1),t.play(),i.emit("camera-set-spectator",{cameraEl:e}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){this.spectatorCameraEl&&!this.originalRender&&(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(e,t){var n,i,r=this.sceneEl;n=r.renderer.xr.enabled,this.originalRender.call(r.renderer,e,t),this.spectatorCameraEl&&!r.isMobile&&n&&(i=this.spectatorCameraEl.components.camera.camera,r.renderer.xr.enabled=!1,this.originalRender.call(r.renderer,e,i),r.renderer.xr.enabled=n)}}),X$("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(e){var t,n,i=this.cache;return e.skipCache?XZ(e):(t=i[n=this.hash(e)],function(e,t){e[t]=void 0===e[t]?1:e[t]+1}(this.cacheCount,n),t||(t=XZ(e),i[n]=t,t))},unuseGeometry:function(e){var t,n=this.cache,i=this.cacheCount;e.skipCache||n[t=this.hash(e)]&&(function(e,t){e[t]--}(i,t),i[t]>0||(n[t].dispose(),delete n[t],delete i[t]))},hash:function(e){return JSON.stringify(e)}}),X$("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.7/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var e=this.data.dracoDecoderPath,t=this.data.basisTranscoderPath,n=this.data.meshoptDecoderPath;!this.dracoLoader&&e&&(this.dracoLoader=new fH,this.dracoLoader.setDecoderPath(e)),!this.ktx2Loader&&t&&(this.ktx2Loader=new JW,this.ktx2Loader.setTranscoderPath(t).detectSupport(this.el.renderer)),!this.meshoptDecoder&&n&&(this.meshoptDecoder=function(e){return new Promise((function(t,n){var i=document.createElement("script");document.body.appendChild(i),i.onload=t,i.onerror=n,i.async=!0,i.src=e}))}(n).then((function(){return window.MeshoptDecoder.ready})).then((function(){return window.MeshoptDecoder})))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}});var $Z="data-aframe-default-light",YZ=(X$("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(e){e.hasAttribute($Z)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var e,t=this.sceneEl;if(this.defaultLights){e=document.querySelectorAll("["+$Z+"]");for(var n=0;n<e.length;n++)t.removeChild(e[n]);this.defaultLights=!1}},setupDefaultLights:function(){var e,t,n=this.sceneEl;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||((e=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),e.setAttribute($Z,""),e.setAttribute(VQ,""),n.appendChild(e),(t=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:1.884,castShadow:!0}),t.setAttribute("position",{x:-.5,y:1,z:1}),t.setAttribute($Z,""),t.setAttribute(VQ,""),n.appendChild(t),this.defaultLights=!0)}}),qQ),KZ=YZ("components:texture:error"),JZ=YZ("components:texture:warn"),ZZ=new dH.ImageLoader;X$("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(e,t,n){this.loadTextureSource(e,(function(e){var i=iX(e);$q(i,t),n(i)}))},loadTextureSource:function(e,t){var n=this,i=this.sourceCache,r=this.hash(e);function o(e){i[r]=Promise.resolve(e),i[r].then(t)}i[r]?i[r].then(t):"CANVAS"!==e.tagName?o(new Promise((function(t,i){Vq(e,(function(e){n.loadImage(e,t)}),(function(e){n.loadVideo(e,t)}))}))):o(new dH.Source(e))},loadCubeMapTexture:function(e,t){var n=this,i=0,r=new dH.CubeTexture;function o(o){n.loadTextureSource(e[o],(function(e){r.images[o]=e.data,6==++i&&(r.needsUpdate=!0,t(r))}))}if(r.colorSpace=dH.SRGBColorSpace,6===e.length)for(var s=0;s<e.length;s++)o(s);else JZ("Cube map texture requires exactly 6 sources, got only %s sources",e.length)},loadImage:function(e,t){t("string"==typeof e?function(e){return new Promise((function(t,n){ZZ.load(e,(function(e){t(new dH.Source(e))}),(function(){}),(function(e){KZ("`$s` could not be fetched (Error code: %s; Response: %s)",e.status,e.statusText)}))}))}(e):new dH.Source(e))},loadVideo:function(e,t){var n;"string"!=typeof e&&function(e){e.autoplay=e.hasAttribute("autoplay")&&"false"!==e.getAttribute("autoplay"),e.controls=e.hasAttribute("controls")&&"false"!==e.getAttribute("controls"),"false"===e.getAttribute("loop")&&e.removeAttribute("loop"),"false"===e.getAttribute("preload")&&(e.preload="none"),e.crossOrigin=e.crossOrigin||"anonymous",e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline","")}(n=e),n=n||function(e){var t=document.createElement("video");return t.setAttribute("playsinline",""),t.setAttribute("webkit-playsinline",""),t.autoplay=!0,t.loop=!0,t.crossOrigin="anonymous",t.addEventListener("error",(function(){JZ("`%s` is not a valid video",e)}),!0),t.src=e,t}(e),t(new dH.Source(n))},hash:function(e){return e.tagName&&(e.id||e.src)||e},registerMaterial:function(e){this.materials[e.uuid]=e},unregisterMaterial:function(e){delete this.materials[e.uuid]}}),X$("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(e){this.colliderEls.push(e),this.data.showColliders?e.components["obb-collider"].showCollider():e.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(e){var t=this.colliderEls,n=t.indexOf(e);e.components["obb-collider"].hideCollider(),n>-1&&t.splice(n,1),0===t.length&&(this.tick=void 0)},registerCollision:function(e,t){var n=this.collisions,i=!1,r=e.obb,o=t.obb,s=e.renderColliderMesh,a=t.renderColliderMesh;s&&s.material.color.set(16711680),a&&a.material.color.set(16711680);for(var l=0;l<n.length;l++)if(n[l].componentA.obb===r&&n[l].componentB.obb===o||n[l].componentA.obb===o&&n[l].componentB.obb===r){i=!0,n[l].detected=!0;break}i||(n.push({componentA:e,componentB:t,detected:!0}),e.el.emit("obbcollisionstarted",{trackedObject3D:e.trackedObject3D,withEl:t.el}),t.el.emit("obbcollisionstarted",{trackedObject3D:t.trackedObject3D,withEl:e.el}))},resetCollisions:function(){for(var e=this.collisions,t=0;t<e.length;t++)e[t].detected=!1},clearCollisions:function(){for(var e,t,n,i,r=this.collisions,o=[],s=0;s<r.length;s++)r[s].detected?o.push(r[s]):(e=r[s].componentA,t=r[s].componentB,n=e.renderColliderMesh,i=t.renderColliderMesh,n&&n.material.color.set(65280),e.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:t.el}),i&&i.material.color.set(65280),t.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:e.el}));this.collisions=o},detectCollisions:function(){var e,t,n,i,r=this.colliderEls;if(!(r.length<2)){this.resetCollisions();for(var o=0;o<r.length;o++)if(n=r[o].components["obb-collider"],0!==(e=r[o].components["obb-collider"].obb).halfSize.x&&0!==e.halfSize.y&&0!==e.halfSize.z)for(var s=o+1;s<r.length;s++)0!==(t=(i=r[s].components["obb-collider"]).obb).halfSize.x&&0!==t.halfSize.y&&0!==t.halfSize.z&&e.intersectsOBB(t)&&this.registerCollision(n,i);this.clearCollisions()}}});var e0=qQ("components:renderer:warn");function t0(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z-t.z}function n0(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder-t.renderOrder}function i0(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:t.z-e.z}X$("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:pq()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon","AgX","neutral"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon","AgX","neutral"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var e=this.data,t=this.el,n=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),i=t.renderer;i.toneMapping=dH[n+"ToneMapping"],dH.Texture.DEFAULT_ANISOTROPY=e.anisotropy,dH.ColorManagement.enabled=e.colorManagement,i.outputColorSpace=e.colorManagement?dH.SRGBColorSpace:dH.LinearSRGBColorSpace,t.hasAttribute("antialias")&&e0('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),t.hasAttribute("logarithmicDepthBuffer")&&e0('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),i.sortObjects=!0,i.setOpaqueSort(t0)},update:function(){var e=this.data,t=this.el.renderer,n=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);t.toneMapping=dH[n+"ToneMapping"],t.toneMappingExposure=e.exposure,t.xr.setFoveation(e.foveationLevel),e.sortObjects&&e0('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),e.sortTransparentObjects?t.setTransparentSort(i0):t.setTransparentSort(n0)},applyColorCorrection:function(e){this.data.colorManagement&&e&&e.isTexture&&e.colorSpace!==dH.SRGBColorSpace&&(e.colorSpace=dH.SRGBColorSpace,e.needsUpdate=!0)},setWebXRFrameRate:function(e){var t,n=this.data,i=e.supportedFrameRates;i&&e.updateTargetFrameRate&&(t=i.includes(90)?n.highRefreshRate?90:72:n.highRefreshRate?72:60,e.updateTargetFrameRate(t).catch((function(e){console.warn("failed to set target frame rate of "+t+". Error info: "+e)})))}});var r0={basic:dH.BasicShadowMap,pcf:dH.PCFShadowMap,pcfsoft:dH.PCFSoftShadowMap};X$("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var e=this.sceneEl,t=this.data;this.shadowMapEnabled=!1,e.renderer.shadowMap.type=r0[t.type],e.renderer.shadowMap.autoUpdate=t.autoUpdate},update:function(e){e.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(e){var t=this.sceneEl,n=this.sceneEl.renderer;this.shadowMapEnabled=e;var i=this.data.enabled&&this.shadowMapEnabled;n&&i!==n.shadowMap.enabled&&(n.shadowMap.enabled=i,function(e){e.hasLoaded&&e.object3D.traverse((function(e){if(e.material)for(var t=Array.isArray(e.material)?e.material:[e.material],n=0;n<t.length;n++)t[n].needsUpdate=!0}))}(t))}}),X$("tracked-controls",{init:function(){this.controllers=[],this.onInputSourcesChange=this.onInputSourcesChange.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.el.addEventListener("enter-vr",this.onEnterVR),this.onExitVR=this.onExitVR.bind(this),this.el.addEventListener("exit-vr",this.onExitVR)},onEnterVR:function(){this.el.xrSession&&this.el.xrSession.addEventListener("inputsourceschange",this.onInputSourcesChange)},onExitVR:function(){this.referenceSpace=void 0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1)},onInputSourcesChange:function(){var e=this,t=this.el.xrSession,n=this.el.sceneEl.systems.webxr.sessionReferenceSpaceType;t.requestReferenceSpace(n).then((function(t){e.referenceSpace=t})).catch((function(t){throw e.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(n,'tracked-controls uses reference space "'+n+'".'),t})),this.controllers=t.inputSources,this.el.emit("controllersupdated",void 0,!1)}});var o0=qQ("systems:webxr:warn"),s0=(X$("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var e=this.data;this.sessionConfiguration={requiredFeatures:e.requiredFeatures,optionalFeatures:e.optionalFeatures},this.sessionReferenceSpaceType=e.referenceSpaceType,e.overlayElement&&(e.overlayElement.classList.remove("a-dom-overlay"),e.optionalFeatures.includes("dom-overlay")||(e.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",e)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:e.overlayElement},e.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(e){return"viewer"===e||"local"===e||!(!this.sessionConfiguration.requiredFeatures.includes(e)&&!this.sessionConfiguration.optionalFeatures.includes(e))},warnIfFeatureNotRequested:function(e,t){this.wasFeatureRequested(e)||o0((t?t+" ":"")+'Please add the feature "'+e+"\" to a-scene's webxr system options in requiredFeatures/optionalFeatures.")}}),{});function a0(e){var t=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();"fog"===e&&(t="material-fog"),"visible"===e&&(t="material-visible"),s0[t]="material."+e}function l0(){return{defaultComponents:{material:{}},mappings:MX({},s0)}}Object.keys(E$.material.schema).forEach(a0),Object.keys(RY.standard.schema).forEach(a0);var c0=new dH.Vector3,u0=new dH.Vector3;z$("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var e=this.data,t=this.el,n=t.object3D.parent,i=t.object3D,r=new dH.Group;c0.copy(i.position),u0.copy(i.rotation),n.remove(i),r.add(i),n.add(r),t.object3D=r,i.position.set(-1*e.x,-1*e.y,-1*e.z),r.position.set(e.x+c0.x,e.y+c0.y,e.z+c0.z),r.rotation.copy(i.rotation),i.rotation.set(0,0,0)}}),MY("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}}),MY("a-cursor",TX({},l0(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}})),MY("a-curvedimage",TX({},l0(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}})),MY("a-gltf-model",{mappings:{src:"gltf-model"}}),MY("a-image",TX({},l0(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}})),MY("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}}),MY("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}}),MY("a-obj-model",TX({},l0(),{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}));const h0={},d0=h0;function p0(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var f0,m0;yY.forEach((function(e){var t=vY[e],n=p0(e),i={};Object.keys(t.schema).forEach((function(e){i[p0(e)]="geometry."+e}));var r="a-"+n,o=MY(r,TX({},l0(),{defaultComponents:{geometry:{primitive:e}},mappings:i}));h0[r]=o})),MY("a-sky",TX({},l0(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:TX({},d0["a-sphere"].mappings)})),MY("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}}),f0={text:{anchor:"align",width:5}},m0=m0||{},Object.keys(f0).forEach((function(e){!function(e,t){var n=E$[e].schema;Object.keys(n).forEach((function(n){var i=n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();void 0!==t[i]&&(i=e+"-"+n),t[i]=e+"."+n}))}(e,m0)})),MY("a-text",TX({},null,{defaultComponents:f0,mappings:m0})),MY("a-video",TX({},l0(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}})),MY("a-videosphere",TX({},l0(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}));var g0=qQ,v0=g0("A-Frame:error"),y0=g0("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&y0("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),window.cordova||"file:"!==window.location.protocol||v0("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),yq&&(window.logs=g0,kV(7180),kV(9379)),console.log("A-Frame Version: 1.7.0 (Date 2025-02-20, Commit #ad5cef10)"),console.log("THREE Version (https://github.com/supermedium/three.js):",zQ.REVISION),window.AFRAME_ASYNC||("complete"!==document.readyState?document.addEventListener("readystatechange",(function e(){"complete"===document.readyState&&(document.removeEventListener("readystatechange",e),H$())})):H$());const A0=globalThis.AFRAME={AComponent:U$,AEntity:rY,ANode:J$,ANIME:hH,AScene:dY,components:E$,coreComponents:Object.keys(E$),geometries:vY,registerComponent:z$,registerGeometry:xY,registerPrimitive:MY,registerShader:LY,registerSystem:X$,primitives:{getMeshMixin:l0,primitives:CY},scenes:JX,schema:XV,shaders:RY,systems:Q$,emitReady:H$,THREE:zQ,utils:qV,version:zY};i(3832);var x0=i(9435);const b0=4294967296;function _0(e){return e.x}function w0(e){return e.y}function E0(e){return e.z}var S0=Math.PI*(3-Math.sqrt(5)),C0=20*Math.PI/(9+Math.sqrt(221));function M0(e,t){t=t||2;var n,i=Math.min(3,Math.max(1,Math.round(t))),r=1,o=.001,s=1-Math.pow(o,1/300),a=0,l=.6,c=new Map,u=jw(p),h=yw("tick","end"),d=function(){let e=1;return()=>(e=(1664525*e+1013904223)%b0)/b0}();function p(){f(),h.call("tick",n),r<o&&(u.stop(),h.call("end",n))}function f(t){var o,u,h=e.length;void 0===t&&(t=1);for(var d=0;d<t;++d)for(r+=(a-r)*s,c.forEach((function(e){e(r)})),o=0;o<h;++o)null==(u=e[o]).fx?u.x+=u.vx*=l:(u.x=u.fx,u.vx=0),i>1&&(null==u.fy?u.y+=u.vy*=l:(u.y=u.fy,u.vy=0)),i>2&&(null==u.fz?u.z+=u.vz*=l:(u.z=u.fz,u.vz=0));return n}function m(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),null!=t.fz&&(t.z=t.fz),isNaN(t.x)||i>1&&isNaN(t.y)||i>2&&isNaN(t.z)){var o=10*(i>2?Math.cbrt(.5+n):i>1?Math.sqrt(.5+n):n),s=n*S0,a=n*C0;1===i?t.x=o:2===i?(t.x=o*Math.cos(s),t.y=o*Math.sin(s)):(t.x=o*Math.sin(s)*Math.cos(a),t.y=o*Math.cos(s),t.z=o*Math.sin(s)*Math.sin(a))}(isNaN(t.vx)||i>1&&isNaN(t.vy)||i>2&&isNaN(t.vz))&&(t.vx=0,i>1&&(t.vy=0),i>2&&(t.vz=0))}}function g(t){return t.initialize&&t.initialize(e,d,i),t}return null==e&&(e=[]),m(),n={tick:f,restart:function(){return u.restart(p),n},stop:function(){return u.stop(),n},numDimensions:function(e){return arguments.length?(i=Math.min(3,Math.max(1,Math.round(e))),c.forEach(g),n):i},nodes:function(t){return arguments.length?(e=t,m(),c.forEach(g),n):e},alpha:function(e){return arguments.length?(r=+e,n):r},alphaMin:function(e){return arguments.length?(o=+e,n):o},alphaDecay:function(e){return arguments.length?(s=+e,n):+s},alphaTarget:function(e){return arguments.length?(a=+e,n):a},velocityDecay:function(e){return arguments.length?(l=1-e,n):1-l},randomSource:function(e){return arguments.length?(d=e,c.forEach(g),n):d},force:function(e,t){return arguments.length>1?(null==t?c.delete(e):c.set(e,g(t)),n):c.get(e)},find:function(){var t,n,r,o,s,a,l=Array.prototype.slice.call(arguments),c=l.shift()||0,u=(i>1?l.shift():null)||0,h=(i>2?l.shift():null)||0,d=l.shift()||1/0,p=0,f=e.length;for(d*=d,p=0;p<f;++p)(o=(t=c-(s=e[p]).x)*t+(n=u-(s.y||0))*n+(r=h-(s.z||0))*r)<d&&(a=s,d=o);return a},on:function(e,t){return arguments.length>1?(h.on(e,t),n):h.on(e)}}}function T0(e){return function(){return e}}function R0(e){return 1e-6*(e()-.5)}function I0(e){return e.index}function P0(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function B0(e){var t,n,i,r,o,s,a,l=I0,c=function(e){return 1/Math.min(o[e.source.index],o[e.target.index])},u=T0(30),h=1;function d(i){for(var o=0,l=e.length;o<h;++o)for(var c,u,d,p,f,m=0,g=0,v=0,y=0;m<l;++m)u=(c=e[m]).source,g=(d=c.target).x+d.vx-u.x-u.vx||R0(a),r>1&&(v=d.y+d.vy-u.y-u.vy||R0(a)),r>2&&(y=d.z+d.vz-u.z-u.vz||R0(a)),g*=p=((p=Math.sqrt(g*g+v*v+y*y))-n[m])/p*i*t[m],v*=p,y*=p,d.vx-=g*(f=s[m]),r>1&&(d.vy-=v*f),r>2&&(d.vz-=y*f),u.vx+=g*(f=1-f),r>1&&(u.vy+=v*f),r>2&&(u.vz+=y*f)}function p(){if(i){var r,a,c=i.length,u=e.length,h=new Map(i.map(((e,t)=>[l(e,t,i),e])));for(r=0,o=new Array(c);r<u;++r)(a=e[r]).index=r,"object"!==typeof a.source&&(a.source=P0(h,a.source)),"object"!==typeof a.target&&(a.target=P0(h,a.target)),o[a.source.index]=(o[a.source.index]||0)+1,o[a.target.index]=(o[a.target.index]||0)+1;for(r=0,s=new Array(u);r<u;++r)a=e[r],s[r]=o[a.source.index]/(o[a.source.index]+o[a.target.index]);t=new Array(u),f(),n=new Array(u),m()}}function f(){if(i)for(var n=0,r=e.length;n<r;++n)t[n]=+c(e[n],n,e)}function m(){if(i)for(var t=0,r=e.length;t<r;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e){i=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];a=n.find((e=>"function"===typeof e))||Math.random,r=n.find((e=>[1,2,3].includes(e)))||2,p()},d.links=function(t){return arguments.length?(e=t,p(),d):e},d.id=function(e){return arguments.length?(l=e,d):l},d.iterations=function(e){return arguments.length?(h=+e,d):h},d.strength=function(e){return arguments.length?(c="function"===typeof e?e:T0(+e),f(),d):c},d.distance=function(e){return arguments.length?(u="function"===typeof e?e:T0(+e),m(),d):u},d}function L0(e,t,n){if(isNaN(t))return e;var i,r,o,s,a,l,c=e._root,u={data:n},h=e._x0,d=e._x1;if(!c)return e._root=u,e;for(;c.length;)if((s=t>=(r=(h+d)/2))?h=r:d=r,i=c,!(c=c[a=+s]))return i[a]=u,e;if(t===(o=+e._x.call(null,c.data)))return u.next=c,i?i[a]=u:e._root=u,e;do{i=i?i[a]=new Array(2):e._root=new Array(2),(s=t>=(r=(h+d)/2))?h=r:d=r}while((a=+s)===(l=+(o>=r)));return i[l]=c,i[a]=u,e}function N0(e,t,n){this.node=e,this.x0=t,this.x1=n}function D0(e){return e[0]}function k0(e,t){var n=new O0(null==t?D0:t,NaN,NaN);return null==e?n:n.addAll(e)}function O0(e,t,n){this._x=e,this._x0=t,this._x1=n,this._root=void 0}function U0(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var F0=k0.prototype=O0.prototype;function z0(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,o,s,a,l,c,u,h,d,p=e._root,f={data:i},m=e._x0,g=e._y0,v=e._x1,y=e._y1;if(!p)return e._root=f,e;for(;p.length;)if((c=t>=(o=(m+v)/2))?m=o:v=o,(u=n>=(s=(g+y)/2))?g=s:y=s,r=p,!(p=p[h=u<<1|c]))return r[h]=f,e;if(a=+e._x.call(null,p.data),l=+e._y.call(null,p.data),t===a&&n===l)return f.next=p,r?r[h]=f:e._root=f,e;do{r=r?r[h]=new Array(4):e._root=new Array(4),(c=t>=(o=(m+v)/2))?m=o:v=o,(u=n>=(s=(g+y)/2))?g=s:y=s}while((h=u<<1|c)===(d=(l>=s)<<1|a>=o));return r[d]=p,r[h]=f,e}function j0(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function V0(e){return e[0]}function G0(e){return e[1]}function H0(e,t,n){var i=new W0(null==t?V0:t,null==n?G0:n,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function W0(e,t,n,i,r,o){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function Q0(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}F0.copy=function(){var e,t,n=new O0(this._x,this._x0,this._x1),i=this._root;if(!i)return n;if(!i.length)return n._root=U0(i),n;for(e=[{source:i,target:n._root=new Array(2)}];i=e.pop();)for(var r=0;r<2;++r)(t=i.source[r])&&(t.length?e.push({source:t,target:i.target[r]=new Array(2)}):i.target[r]=U0(t));return n},F0.add=function(e){const t=+this._x.call(null,e);return L0(this.cover(t),t,e)},F0.addAll=function(e){Array.isArray(e)||(e=Array.from(e));const t=e.length,n=new Float64Array(t);let i=1/0,r=-1/0;for(let o,s=0;s<t;++s)isNaN(o=+this._x.call(null,e[s]))||(n[s]=o,o<i&&(i=o),o>r&&(r=o));if(i>r)return this;this.cover(i).cover(r);for(let o=0;o<t;++o)L0(this,n[o],e[o]);return this},F0.cover=function(e){if(isNaN(e=+e))return this;var t=this._x0,n=this._x1;if(isNaN(t))n=(t=Math.floor(e))+1;else{for(var i,r,o=n-t||1,s=this._root;t>e||e>=n;)switch(r=+(e<t),(i=new Array(2))[r]=s,s=i,o*=2,r){case 0:n=t+o;break;case 1:t=n-o}this._root&&this._root.length&&(this._root=s)}return this._x0=t,this._x1=n,this},F0.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},F0.extent=function(e){return arguments.length?this.cover(+e[0][0]).cover(+e[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},F0.find=function(e,t){var n,i,r,o,s,a=this._x0,l=this._x1,c=[],u=this._root;for(u&&c.push(new N0(u,a,l)),null==t?t=1/0:(a=e-t,l=e+t);o=c.pop();)if(!(!(u=o.node)||(i=o.x0)>l||(r=o.x1)<a))if(u.length){var h=(i+r)/2;c.push(new N0(u[1],h,r),new N0(u[0],i,h)),(s=+(e>=h))&&(o=c[c.length-1],c[c.length-1]=c[c.length-1-s],c[c.length-1-s]=o)}else{var d=Math.abs(e-+this._x.call(null,u.data));d<t&&(t=d,a=e-d,l=e+d,n=u.data)}return n},F0.remove=function(e){if(isNaN(o=+this._x.call(null,e)))return this;var t,n,i,r,o,s,a,l,c,u=this._root,h=this._x0,d=this._x1;if(!u)return this;if(u.length)for(;;){if((a=o>=(s=(h+d)/2))?h=s:d=s,t=u,!(u=u[l=+a]))return this;if(!u.length)break;t[l+1&1]&&(n=t,c=l)}for(;u.data!==e;)if(i=u,!(u=u.next))return this;return(r=u.next)&&delete u.next,i?(r?i.next=r:delete i.next,this):t?(r?t[l]=r:delete t[l],(u=t[0]||t[1])&&u===(t[1]||t[0])&&!u.length&&(n?n[c]=u:this._root=u),this):(this._root=r,this)},F0.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},F0.root=function(){return this._root},F0.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},F0.visit=function(e){var t,n,i,r,o=[],s=this._root;for(s&&o.push(new N0(s,this._x0,this._x1));t=o.pop();)if(!e(s=t.node,i=t.x0,r=t.x1)&&s.length){var a=(i+r)/2;(n=s[1])&&o.push(new N0(n,a,r)),(n=s[0])&&o.push(new N0(n,i,a))}return this},F0.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new N0(this._root,this._x0,this._x1));t=n.pop();){var r=t.node;if(r.length){var o,s=t.x0,a=t.x1,l=(s+a)/2;(o=r[0])&&n.push(new N0(o,s,l)),(o=r[1])&&n.push(new N0(o,l,a))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.x1);return this},F0.x=function(e){return arguments.length?(this._x=e,this):this._x};var q0=H0.prototype=W0.prototype;function X0(e,t,n,i,r){if(isNaN(t)||isNaN(n)||isNaN(i))return e;var o,s,a,l,c,u,h,d,p,f,m,g,v=e._root,y={data:r},A=e._x0,x=e._y0,b=e._z0,_=e._x1,w=e._y1,E=e._z1;if(!v)return e._root=y,e;for(;v.length;)if((d=t>=(s=(A+_)/2))?A=s:_=s,(p=n>=(a=(x+w)/2))?x=a:w=a,(f=i>=(l=(b+E)/2))?b=l:E=l,o=v,!(v=v[m=f<<2|p<<1|d]))return o[m]=y,e;if(c=+e._x.call(null,v.data),u=+e._y.call(null,v.data),h=+e._z.call(null,v.data),t===c&&n===u&&i===h)return y.next=v,o?o[m]=y:e._root=y,e;do{o=o?o[m]=new Array(8):e._root=new Array(8),(d=t>=(s=(A+_)/2))?A=s:_=s,(p=n>=(a=(x+w)/2))?x=a:w=a,(f=i>=(l=(b+E)/2))?b=l:E=l}while((m=f<<2|p<<1|d)===(g=(h>=l)<<2|(u>=a)<<1|c>=s));return o[g]=v,o[m]=y,e}function $0(e,t,n,i,r,o,s){this.node=e,this.x0=t,this.y0=n,this.z0=i,this.x1=r,this.y1=o,this.z1=s}q0.copy=function(){var e,t,n=new W0(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=Q0(i),n;for(e=[{source:i,target:n._root=new Array(4)}];i=e.pop();)for(var r=0;r<4;++r)(t=i.source[r])&&(t.length?e.push({source:t,target:i.target[r]=new Array(4)}):i.target[r]=Q0(t));return n},q0.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return z0(this.cover(t,n),t,n,e)},q0.addAll=function(e){var t,n,i,r,o=e.length,s=new Array(o),a=new Array(o),l=1/0,c=1/0,u=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(r=+this._y.call(null,t))||(s[n]=i,a[n]=r,i<l&&(l=i),i>u&&(u=i),r<c&&(c=r),r>h&&(h=r));if(l>u||c>h)return this;for(this.cover(l,c).cover(u,h),n=0;n<o;++n)z0(this,s[n],a[n],e[n]);return this},q0.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,o=(i=Math.floor(t))+1;else{for(var s,a,l=r-n||1,c=this._root;n>e||e>=r||i>t||t>=o;)switch(a=(t<i)<<1|e<n,(s=new Array(4))[a]=c,c=s,l*=2,a){case 0:r=n+l,o=i+l;break;case 1:n=r-l,o=i+l;break;case 2:r=n+l,i=o-l;break;case 3:n=r-l,i=o-l}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this},q0.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},q0.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},q0.find=function(e,t,n){var i,r,o,s,a,l,c,u=this._x0,h=this._y0,d=this._x1,p=this._y1,f=[],m=this._root;for(m&&f.push(new j0(m,u,h,d,p)),null==n?n=1/0:(u=e-n,h=t-n,d=e+n,p=t+n,n*=n);l=f.pop();)if(!(!(m=l.node)||(r=l.x0)>d||(o=l.y0)>p||(s=l.x1)<u||(a=l.y1)<h))if(m.length){var g=(r+s)/2,v=(o+a)/2;f.push(new j0(m[3],g,v,s,a),new j0(m[2],r,v,g,a),new j0(m[1],g,o,s,v),new j0(m[0],r,o,g,v)),(c=(t>=v)<<1|e>=g)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-c],f[f.length-1-c]=l)}else{var y=e-+this._x.call(null,m.data),A=t-+this._y.call(null,m.data),x=y*y+A*A;if(x<n){var b=Math.sqrt(n=x);u=e-b,h=t-b,d=e+b,p=t+b,i=m.data}}return i},q0.remove=function(e){if(isNaN(o=+this._x.call(null,e))||isNaN(s=+this._y.call(null,e)))return this;var t,n,i,r,o,s,a,l,c,u,h,d,p=this._root,f=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!p)return this;if(p.length)for(;;){if((c=o>=(a=(f+g)/2))?f=a:g=a,(u=s>=(l=(m+v)/2))?m=l:v=l,t=p,!(p=p[h=u<<1|c]))return this;if(!p.length)break;(t[h+1&3]||t[h+2&3]||t[h+3&3])&&(n=t,d=h)}for(;p.data!==e;)if(i=p,!(p=p.next))return this;return(r=p.next)&&delete p.next,i?(r?i.next=r:delete i.next,this):t?(r?t[h]=r:delete t[h],(p=t[0]||t[1]||t[2]||t[3])&&p===(t[3]||t[2]||t[1]||t[0])&&!p.length&&(n?n[d]=p:this._root=p),this):(this._root=r,this)},q0.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},q0.root=function(){return this._root},q0.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},q0.visit=function(e){var t,n,i,r,o,s,a=[],l=this._root;for(l&&a.push(new j0(l,this._x0,this._y0,this._x1,this._y1));t=a.pop();)if(!e(l=t.node,i=t.x0,r=t.y0,o=t.x1,s=t.y1)&&l.length){var c=(i+o)/2,u=(r+s)/2;(n=l[3])&&a.push(new j0(n,c,u,o,s)),(n=l[2])&&a.push(new j0(n,i,u,c,s)),(n=l[1])&&a.push(new j0(n,c,r,o,u)),(n=l[0])&&a.push(new j0(n,i,r,c,u))}return this},q0.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new j0(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var r=t.node;if(r.length){var o,s=t.x0,a=t.y0,l=t.x1,c=t.y1,u=(s+l)/2,h=(a+c)/2;(o=r[0])&&n.push(new j0(o,s,a,u,h)),(o=r[1])&&n.push(new j0(o,u,a,l,h)),(o=r[2])&&n.push(new j0(o,s,h,u,c)),(o=r[3])&&n.push(new j0(o,u,h,l,c))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},q0.x=function(e){return arguments.length?(this._x=e,this):this._x},q0.y=function(e){return arguments.length?(this._y=e,this):this._y};const Y0=(e,t,n,i,r,o)=>Math.sqrt((e-i)**2+(t-r)**2+(n-o)**2);function K0(e){return e[0]}function J0(e){return e[1]}function Z0(e){return e[2]}function e1(e,t,n,i){var r=new t1(null==t?K0:t,null==n?J0:n,null==i?Z0:i,NaN,NaN,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function t1(e,t,n,i,r,o,s,a,l){this._x=e,this._y=t,this._z=n,this._x0=i,this._y0=r,this._z0=o,this._x1=s,this._y1=a,this._z1=l,this._root=void 0}function n1(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var i1=e1.prototype=t1.prototype;function r1(){var e,t,n,i,r,o,s=T0(-30),a=1,l=1/0,c=.81;function u(i){var o,s=e.length,a=(1===t?k0(e,_0):2===t?H0(e,_0,w0):3===t?e1(e,_0,w0,E0):null).visitAfter(d);for(r=i,o=0;o<s;++o)n=e[o],a.visit(p)}function h(){if(e){var t,n,i=e.length;for(o=new Array(i),t=0;t<i;++t)n=e[t],o[n.index]=+s(n,t,e)}}function d(e){var n,i,r,s,a,l,c=0,u=0,h=e.length;if(h){for(r=s=a=l=0;l<h;++l)(n=e[l])&&(i=Math.abs(n.value))&&(c+=n.value,u+=i,r+=i*(n.x||0),s+=i*(n.y||0),a+=i*(n.z||0));c*=Math.sqrt(4/h),e.x=r/u,t>1&&(e.y=s/u),t>2&&(e.z=a/u)}else{(n=e).x=n.data.x,t>1&&(n.y=n.data.y),t>2&&(n.z=n.data.z);do{c+=o[n.data.index]}while(n=n.next)}e.value=c}function p(e,s,u,h,d){if(!e.value)return!0;var p=[u,h,d][t-1],f=e.x-n.x,m=t>1?e.y-n.y:0,g=t>2?e.z-n.z:0,v=p-s,y=f*f+m*m+g*g;if(v*v/c<y)return y<l&&(0===f&&(y+=(f=R0(i))*f),t>1&&0===m&&(y+=(m=R0(i))*m),t>2&&0===g&&(y+=(g=R0(i))*g),y<a&&(y=Math.sqrt(a*y)),n.vx+=f*e.value*r/y,t>1&&(n.vy+=m*e.value*r/y),t>2&&(n.vz+=g*e.value*r/y)),!0;if(!(e.length||y>=l)){(e.data!==n||e.next)&&(0===f&&(y+=(f=R0(i))*f),t>1&&0===m&&(y+=(m=R0(i))*m),t>2&&0===g&&(y+=(g=R0(i))*g),y<a&&(y=Math.sqrt(a*y)));do{e.data!==n&&(v=o[e.data.index]*r/y,n.vx+=f*v,t>1&&(n.vy+=m*v),t>2&&(n.vz+=g*v))}while(e=e.next)}}return u.initialize=function(n){e=n;for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];i=o.find((e=>"function"===typeof e))||Math.random,t=o.find((e=>[1,2,3].includes(e)))||2,h()},u.strength=function(e){return arguments.length?(s="function"===typeof e?e:T0(+e),h(),u):s},u.distanceMin=function(e){return arguments.length?(a=e*e,u):Math.sqrt(a)},u.distanceMax=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u.theta=function(e){return arguments.length?(c=e*e,u):Math.sqrt(c)},u}function o1(e,t,n){var i,r=1;function o(){var o,s,a=i.length,l=0,c=0,u=0;for(o=0;o<a;++o)l+=(s=i[o]).x||0,c+=s.y||0,u+=s.z||0;for(l=(l/a-e)*r,c=(c/a-t)*r,u=(u/a-n)*r,o=0;o<a;++o)s=i[o],l&&(s.x-=l),c&&(s.y-=c),u&&(s.z-=u)}return null==e&&(e=0),null==t&&(t=0),null==n&&(n=0),o.initialize=function(e){i=e},o.x=function(t){return arguments.length?(e=+t,o):e},o.y=function(e){return arguments.length?(t=+e,o):t},o.z=function(e){return arguments.length?(n=+e,o):n},o.strength=function(e){return arguments.length?(r=+e,o):r},o}function s1(e,t,n,i){var r,o,s,a,l=T0(.1);function c(e){for(var l=0,c=r.length;l<c;++l){var u=r[l],h=u.x-t||1e-6,d=(u.y||0)-n||1e-6,p=(u.z||0)-i||1e-6,f=Math.sqrt(h*h+d*d+p*p),m=(a[l]-f)*s[l]*e/f;u.vx+=h*m,o>1&&(u.vy+=d*m),o>2&&(u.vz+=p*m)}}function u(){if(r){var t,n=r.length;for(s=new Array(n),a=new Array(n),t=0;t<n;++t)a[t]=+e(r[t],t,r),s[t]=isNaN(a[t])?0:+l(r[t],t,r)}}return"function"!==typeof e&&(e=T0(+e)),null==t&&(t=0),null==n&&(n=0),null==i&&(i=0),c.initialize=function(e){r=e;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];o=n.find((e=>[1,2,3].includes(e)))||2,u()},c.strength=function(e){return arguments.length?(l="function"===typeof e?e:T0(+e),u(),c):l},c.radius=function(t){return arguments.length?(e="function"===typeof t?t:T0(+t),u(),c):e},c.x=function(e){return arguments.length?(t=+e,c):t},c.y=function(e){return arguments.length?(n=+e,c):n},c.z=function(e){return arguments.length?(i=+e,c):i},c}i1.copy=function(){var e,t,n=new t1(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),i=this._root;if(!i)return n;if(!i.length)return n._root=n1(i),n;for(e=[{source:i,target:n._root=new Array(8)}];i=e.pop();)for(var r=0;r<8;++r)(t=i.source[r])&&(t.length?e.push({source:t,target:i.target[r]=new Array(8)}):i.target[r]=n1(t));return n},i1.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e),i=+this._z.call(null,e);return X0(this.cover(t,n,i),t,n,i,e)},i1.addAll=function(e){Array.isArray(e)||(e=Array.from(e));const t=e.length,n=new Float64Array(t),i=new Float64Array(t),r=new Float64Array(t);let o=1/0,s=1/0,a=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h,d,p,f,m=0;m<t;++m)isNaN(d=+this._x.call(null,h=e[m]))||isNaN(p=+this._y.call(null,h))||isNaN(f=+this._z.call(null,h))||(n[m]=d,i[m]=p,r[m]=f,d<o&&(o=d),d>l&&(l=d),p<s&&(s=p),p>c&&(c=p),f<a&&(a=f),f>u&&(u=f));if(o>l||s>c||a>u)return this;this.cover(o,s,a).cover(l,c,u);for(let h=0;h<t;++h)X0(this,n[h],i[h],r[h],e[h]);return this},i1.cover=function(e,t,n){if(isNaN(e=+e)||isNaN(t=+t)||isNaN(n=+n))return this;var i=this._x0,r=this._y0,o=this._z0,s=this._x1,a=this._y1,l=this._z1;if(isNaN(i))s=(i=Math.floor(e))+1,a=(r=Math.floor(t))+1,l=(o=Math.floor(n))+1;else{for(var c,u,h=s-i||1,d=this._root;i>e||e>=s||r>t||t>=a||o>n||n>=l;)switch(u=(n<o)<<2|(t<r)<<1|e<i,(c=new Array(8))[u]=d,d=c,h*=2,u){case 0:s=i+h,a=r+h,l=o+h;break;case 1:i=s-h,a=r+h,l=o+h;break;case 2:s=i+h,r=a-h,l=o+h;break;case 3:i=s-h,r=a-h,l=o+h;break;case 4:s=i+h,a=r+h,o=l-h;break;case 5:i=s-h,a=r+h,o=l-h;break;case 6:s=i+h,r=a-h,o=l-h;break;case 7:i=s-h,r=a-h,o=l-h}this._root&&this._root.length&&(this._root=d)}return this._x0=i,this._y0=r,this._z0=o,this._x1=s,this._y1=a,this._z1=l,this},i1.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},i1.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},i1.find=function(e,t,n,i){var r,o,s,a,l,c,u,h,d,p=this._x0,f=this._y0,m=this._z0,g=this._x1,v=this._y1,y=this._z1,A=[],x=this._root;for(x&&A.push(new $0(x,p,f,m,g,v,y)),null==i?i=1/0:(p=e-i,f=t-i,m=n-i,g=e+i,v=t+i,y=n+i,i*=i);h=A.pop();)if(!(!(x=h.node)||(o=h.x0)>g||(s=h.y0)>v||(a=h.z0)>y||(l=h.x1)<p||(c=h.y1)<f||(u=h.z1)<m))if(x.length){var b=(o+l)/2,_=(s+c)/2,w=(a+u)/2;A.push(new $0(x[7],b,_,w,l,c,u),new $0(x[6],o,_,w,b,c,u),new $0(x[5],b,s,w,l,_,u),new $0(x[4],o,s,w,b,_,u),new $0(x[3],b,_,a,l,c,w),new $0(x[2],o,_,a,b,c,w),new $0(x[1],b,s,a,l,_,w),new $0(x[0],o,s,a,b,_,w)),(d=(n>=w)<<2|(t>=_)<<1|e>=b)&&(h=A[A.length-1],A[A.length-1]=A[A.length-1-d],A[A.length-1-d]=h)}else{var E=e-+this._x.call(null,x.data),S=t-+this._y.call(null,x.data),C=n-+this._z.call(null,x.data),M=E*E+S*S+C*C;if(M<i){var T=Math.sqrt(i=M);p=e-T,f=t-T,m=n-T,g=e+T,v=t+T,y=n+T,r=x.data}}return r},i1.findAllWithinRadius=function(e,t,n,i){const r=[],o=e-i,s=t-i,a=n-i,l=e+i,c=t+i,u=n+i;return this.visit(((h,d,p,f,m,g,v)=>{if(!h.length)do{const o=h.data;Y0(e,t,n,this._x(o),this._y(o),this._z(o))<=i&&r.push(o)}while(h=h.next);return d>l||p>c||f>u||m<o||g<s||v<a})),r},i1.remove=function(e){if(isNaN(o=+this._x.call(null,e))||isNaN(s=+this._y.call(null,e))||isNaN(a=+this._z.call(null,e)))return this;var t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g=this._root,v=this._x0,y=this._y0,A=this._z0,x=this._x1,b=this._y1,_=this._z1;if(!g)return this;if(g.length)for(;;){if((h=o>=(l=(v+x)/2))?v=l:x=l,(d=s>=(c=(y+b)/2))?y=c:b=c,(p=a>=(u=(A+_)/2))?A=u:_=u,t=g,!(g=g[f=p<<2|d<<1|h]))return this;if(!g.length)break;(t[f+1&7]||t[f+2&7]||t[f+3&7]||t[f+4&7]||t[f+5&7]||t[f+6&7]||t[f+7&7])&&(n=t,m=f)}for(;g.data!==e;)if(i=g,!(g=g.next))return this;return(r=g.next)&&delete g.next,i?(r?i.next=r:delete i.next,this):t?(r?t[f]=r:delete t[f],(g=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&g===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!g.length&&(n?n[m]=g:this._root=g),this):(this._root=r,this)},i1.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},i1.root=function(){return this._root},i1.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},i1.visit=function(e){var t,n,i,r,o,s,a,l,c=[],u=this._root;for(u&&c.push(new $0(u,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=c.pop();)if(!e(u=t.node,i=t.x0,r=t.y0,o=t.z0,s=t.x1,a=t.y1,l=t.z1)&&u.length){var h=(i+s)/2,d=(r+a)/2,p=(o+l)/2;(n=u[7])&&c.push(new $0(n,h,d,p,s,a,l)),(n=u[6])&&c.push(new $0(n,i,d,p,h,a,l)),(n=u[5])&&c.push(new $0(n,h,r,p,s,d,l)),(n=u[4])&&c.push(new $0(n,i,r,p,h,d,l)),(n=u[3])&&c.push(new $0(n,h,d,o,s,a,p)),(n=u[2])&&c.push(new $0(n,i,d,o,h,a,p)),(n=u[1])&&c.push(new $0(n,h,r,o,s,d,p)),(n=u[0])&&c.push(new $0(n,i,r,o,h,d,p))}return this},i1.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new $0(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=n.pop();){var r=t.node;if(r.length){var o,s=t.x0,a=t.y0,l=t.z0,c=t.x1,u=t.y1,h=t.z1,d=(s+c)/2,p=(a+u)/2,f=(l+h)/2;(o=r[0])&&n.push(new $0(o,s,a,l,d,p,f)),(o=r[1])&&n.push(new $0(o,d,a,l,c,p,f)),(o=r[2])&&n.push(new $0(o,s,p,l,d,u,f)),(o=r[3])&&n.push(new $0(o,d,p,l,c,u,f)),(o=r[4])&&n.push(new $0(o,s,a,f,d,p,h)),(o=r[5])&&n.push(new $0(o,d,a,f,c,p,h)),(o=r[6])&&n.push(new $0(o,s,p,f,d,u,h)),(o=r[7])&&n.push(new $0(o,d,p,f,c,u,h))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.z0,t.x1,t.y1,t.z1);return this},i1.x=function(e){return arguments.length?(this._x=e,this):this._x},i1.y=function(e){return arguments.length?(this._y=e,this):this._y},i1.z=function(e){return arguments.length?(this._z=e,this):this._z};var a1=i(9896),l1=i(597);const c1=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const u1="object"==typeof global&&global&&global.Object===Object&&global;var h1="object"==typeof self&&self&&self.Object===Object&&self;const d1=u1||h1||Function("return this")();const p1=function(){return d1.Date.now()};var f1=/\s/;const m1=function(e){for(var t=e.length;t--&&f1.test(e.charAt(t)););return t};var g1=/^\s+/;const v1=function(e){return e?e.slice(0,m1(e)+1).replace(g1,""):e};const y1=d1.Symbol;var A1=Object.prototype,x1=A1.hasOwnProperty,b1=A1.toString,_1=y1?y1.toStringTag:void 0;const w1=function(e){var t=x1.call(e,_1),n=e[_1];try{e[_1]=void 0;var i=!0}catch(Jbe){}var r=b1.call(e);return i&&(t?e[_1]=n:delete e[_1]),r};var E1=Object.prototype.toString;const S1=function(e){return E1.call(e)};var C1=y1?y1.toStringTag:void 0;const M1=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":C1&&C1 in Object(e)?w1(e):S1(e)};const T1=function(e){return null!=e&&"object"==typeof e};const R1=function(e){return"symbol"==typeof e||T1(e)&&"[object Symbol]"==M1(e)};var I1=/^[-+]0x[0-9a-f]+$/i,P1=/^0b[01]+$/i,B1=/^0o[0-7]+$/i,L1=parseInt;const N1=function(e){if("number"==typeof e)return e;if(R1(e))return NaN;if(c1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=c1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=v1(e);var n=P1.test(e);return n||B1.test(e)?L1(e.slice(2),n?2:8):I1.test(e)?NaN:+e};var D1=Math.max,k1=Math.min;const O1=function(e,t,n){var i,r,o,s,a,l,c=0,u=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=i,o=r;return i=r=void 0,c=t,s=e.apply(o,n)}function f(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-c>=o}function m(){var e=p1();if(f(e))return g(e);a=setTimeout(m,function(e){var n=t-(e-l);return h?k1(n,o-(e-c)):n}(e))}function g(e){return a=void 0,d&&i?p(e):(i=r=void 0,s)}function v(){var e=p1(),n=f(e);if(i=arguments,r=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(m,t),u?p(e):s}(l);if(h)return clearTimeout(a),a=setTimeout(m,t),p(l)}return void 0===a&&(a=setTimeout(m,t)),s}return t=N1(t)||0,c1(n)&&(u=!!n.leading,o=(h="maxWait"in n)?D1(N1(n.maxWait)||0,t):o,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=r=a=void 0},v.flush=function(){return void 0===a?s:g(p1())},v};function U1(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function F1(e,t,n){return Object.defineProperty(e,"prototype",{writable:!1}),e}function z1(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return U1(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U1(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var j1=F1((function e(t,n){var i=n.default,r=void 0===i?null:i,o=n.triggerUpdate,s=void 0===o||o,a=n.onChange,l=void 0===a?function(e,t){}:a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.defaultVal=r,this.triggerUpdate=s,this.onChange=l}));function V1(e){var t=e.stateInit,n=void 0===t?function(){return{}}:t,i=e.props,r=void 0===i?{}:i,o=e.methods,s=void 0===o?{}:o,a=e.aliases,l=void 0===a?{}:a,c=e.init,u=void 0===c?function(){}:c,h=e.update,d=void 0===h?function(){}:h,p=Object.keys(r).map((function(e){return new j1(e,r[e])}));return function e(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];var o=!!(this instanceof e?this.constructor:void 0),a=o?i.shift():void 0,c=i[0],h=void 0===c?{}:c,f=Object.assign({},n instanceof Function?n(h):n,{initialised:!1}),m={};function g(e){return v(e,h),y(),g}var v=function(e,t){u.call(g,e,f,t),f.initialised=!0},y=O1((function(){f.initialised&&(d.call(g,f,m),m={})}),1);return p.forEach((function(e){g[e.name]=function(e){var t=e.name,n=e.triggerUpdate,i=void 0!==n&&n,r=e.onChange,o=void 0===r?function(e,t){}:r,s=e.defaultVal,a=void 0===s?null:s;return function(e){var n=f[t];if(!arguments.length)return n;var r=void 0===e?a:e;return f[t]=r,o.call(g,r,f,n),!m.hasOwnProperty(t)&&(m[t]=n),i&&y(),g}}(e)})),Object.keys(s).forEach((function(e){g[e]=function(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=s[e]).call.apply(t,[g,f].concat(i))}})),Object.entries(l).forEach((function(e){var t=z1(e,2),n=t[0],i=t[1];return g[n]=g[i]})),g.resetProps=function(){return p.forEach((function(e){g[e.name](e.defaultVal)})),g},g.resetProps(),f._rerender=y,o&&a&&g(a),g}}var G1=function(e){return"function"===typeof e?e:"string"===typeof e?function(t){return t[e]}:function(t){return e}};function H1(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function W1(e,t){let n;if(void 0===t)for(const i of e)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of e)null!=(r=t(r,++i,e))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Q1(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function q1(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function X1(e,t){return e.get(q1(e,t))}function $1(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function Y1(e,t,n){return e.set(q1(e,t),n),n}function K1(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,e2(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function J1(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||t2(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z1(e){return function(e){if(Array.isArray(e))return Q1(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||t2(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e2(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function t2(e,t){if(e){if("string"==typeof e)return Q1(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q1(e,t):void 0}}var n2=new WeakMap,i2=new WeakMap,r2=new WeakMap,o2=new WeakMap,s2=new WeakMap,a2=new WeakMap,l2=function(){return K1((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$1(this,n2,new Map),$1(this,i2,new Map),$1(this,r2,(function(e){return e})),$1(this,o2,(function(){return{}})),$1(this,s2,(function(){})),$1(this,a2,(function(){}))}),[{key:"getObj",value:function(e){return X1(n2,this).get(X1(r2,this).call(this,e))}},{key:"getData",value:function(e){return X1(i2,this).get(e)}},{key:"entries",value:function(){return Z1(X1(i2,this).entries()).map((function(e){var t=J1(e,2),n=t[0];return[t[1],n]}))}},{key:"id",value:function(e){return Y1(r2,this,G1(e)),this}},{key:"onCreateObj",value:function(e){return Y1(o2,this,e),this}},{key:"onUpdateObj",value:function(e){return Y1(s2,this,e),this}},{key:"onRemoveObj",value:function(e){return Y1(a2,this,e),this}},{key:"digest",value:function(e){var t=this;e.filter((function(e){return!X1(n2,t).has(X1(r2,t).call(t,e))})).forEach((function(e){var n=X1(o2,t).call(t,e);X1(n2,t).set(X1(r2,t).call(t,e),n),X1(i2,t).set(n,e)}));var n=new Map(e.map((function(e){return[X1(r2,t).call(t,e),e]})));return X1(n2,this).forEach((function(e,i){n.has(i)?X1(s2,t).call(t,e,n.get(i)):(X1(a2,t).call(t,e,i),X1(n2,t).delete(i),X1(i2,t).delete(e))})),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();class c2 extends Map{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p2;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(u2(this,e))}has(e){return super.has(u2(this,e))}set(e,t){return super.set(h2(this,e),t)}delete(e){return super.delete(d2(this,e))}}Set;function u2(e,t){let{_intern:n,_key:i}=e;const r=i(t);return n.has(r)?n.get(r):t}function h2(e,t){let{_intern:n,_key:i}=e;const r=i(t);return n.has(r)?n.get(r):(n.set(r,t),t)}function d2(e,t){let{_intern:n,_key:i}=e;const r=i(t);return n.has(r)&&(t=n.get(r),n.delete(r)),t}function p2(e){return null!==e&&"object"===typeof e?e.valueOf():e}function f2(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}const m2=Symbol("implicit");function g2(){var e=new c2,t=[],n=[],i=m2;function r(r){let o=e.get(r);if(void 0===o){if(i!==m2)return i;e.set(r,o=t.push(r)-1)}return n[o%n.length]}return r.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new c2;for(const i of n)e.has(i)||e.set(i,t.push(i)-1);return r},r.range=function(e){return arguments.length?(n=Array.from(e),r):n.slice()},r.unknown=function(e){return arguments.length?(i=e,r):i},r.copy=function(){return g2(t,n).unknown(i)},f2.apply(r,arguments),r}const v2=function(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(6*i,6*++i);return n}("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function y2(e){return y2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y2(e)}var A2=/^\s+/,x2=/\s+$/;function b2(e,t){if(t=t||{},(e=e||"")instanceof b2)return e;if(!(this instanceof b2))return new b2(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,i=null,r=null,o=null,s=!1,a=!1;"string"==typeof e&&(e=function(e){e=e.replace(A2,"").replace(x2,"").toLowerCase();var t,n=!1;if(U2[e])e=U2[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=X2.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=X2.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=X2.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=X2.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=X2.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=X2.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=X2.hex8.exec(e))return{r:G2(t[1]),g:G2(t[2]),b:G2(t[3]),a:q2(t[4]),format:n?"name":"hex8"};if(t=X2.hex6.exec(e))return{r:G2(t[1]),g:G2(t[2]),b:G2(t[3]),format:n?"name":"hex"};if(t=X2.hex4.exec(e))return{r:G2(t[1]+""+t[1]),g:G2(t[2]+""+t[2]),b:G2(t[3]+""+t[3]),a:q2(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=X2.hex3.exec(e))return{r:G2(t[1]+""+t[1]),g:G2(t[2]+""+t[2]),b:G2(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==y2(e)&&($2(e.r)&&$2(e.g)&&$2(e.b)?(l=e.r,c=e.g,u=e.b,t={r:255*j2(l,255),g:255*j2(c,255),b:255*j2(u,255)},s=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):$2(e.h)&&$2(e.s)&&$2(e.v)?(i=W2(e.s),r=W2(e.v),t=function(e,t,n){e=6*j2(e,360),t=j2(t,100),n=j2(n,100);var i=Math.floor(e),r=e-i,o=n*(1-t),s=n*(1-r*t),a=n*(1-(1-r)*t),l=i%6,c=[n,s,o,o,a,n][l],u=[a,n,n,s,o,o][l],h=[o,o,a,n,n,s][l];return{r:255*c,g:255*u,b:255*h}}(e.h,i,r),s=!0,a="hsv"):$2(e.h)&&$2(e.s)&&$2(e.l)&&(i=W2(e.s),o=W2(e.l),t=function(e,t,n){var i,r,o;function s(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=j2(e,360),t=j2(t,100),n=j2(n,100),0===t)i=r=o=n;else{var a=n<.5?n*(1+t):n+t-n*t,l=2*n-a;i=s(l,a,e+1/3),r=s(l,a,e),o=s(l,a,e-1/3)}return{r:255*i,g:255*r,b:255*o}}(e.h,i,o),s=!0,a="hsl"),e.hasOwnProperty("a")&&(n=e.a));var l,c,u;return n=z2(n),{ok:s,format:e.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function _2(e,t,n){e=j2(e,255),t=j2(t,255),n=j2(n,255);var i,r,o=Math.max(e,t,n),s=Math.min(e,t,n),a=(o+s)/2;if(o==s)i=r=0;else{var l=o-s;switch(r=a>.5?l/(2-o-s):l/(o+s),o){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{h:i,s:r,l:a}}function w2(e,t,n){e=j2(e,255),t=j2(t,255),n=j2(n,255);var i,r,o=Math.max(e,t,n),s=Math.min(e,t,n),a=o,l=o-s;if(r=0===o?0:l/o,o==s)i=0;else{switch(o){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{h:i,s:r,v:a}}function E2(e,t,n,i){var r=[H2(Math.round(e).toString(16)),H2(Math.round(t).toString(16)),H2(Math.round(n).toString(16))];return i&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function S2(e,t,n,i){return[H2(Q2(i)),H2(Math.round(e).toString(16)),H2(Math.round(t).toString(16)),H2(Math.round(n).toString(16))].join("")}function C2(e,t){t=0===t?0:t||10;var n=b2(e).toHsl();return n.s-=t/100,n.s=V2(n.s),b2(n)}function M2(e,t){t=0===t?0:t||10;var n=b2(e).toHsl();return n.s+=t/100,n.s=V2(n.s),b2(n)}function T2(e){return b2(e).desaturate(100)}function R2(e,t){t=0===t?0:t||10;var n=b2(e).toHsl();return n.l+=t/100,n.l=V2(n.l),b2(n)}function I2(e,t){t=0===t?0:t||10;var n=b2(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),b2(n)}function P2(e,t){t=0===t?0:t||10;var n=b2(e).toHsl();return n.l-=t/100,n.l=V2(n.l),b2(n)}function B2(e,t){var n=b2(e).toHsl(),i=(n.h+t)%360;return n.h=i<0?360+i:i,b2(n)}function L2(e){var t=b2(e).toHsl();return t.h=(t.h+180)%360,b2(t)}function N2(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=b2(e).toHsl(),i=[b2(e)],r=360/t,o=1;o<t;o++)i.push(b2({h:(n.h+o*r)%360,s:n.s,l:n.l}));return i}function D2(e){var t=b2(e).toHsl(),n=t.h;return[b2(e),b2({h:(n+72)%360,s:t.s,l:t.l}),b2({h:(n+216)%360,s:t.s,l:t.l})]}function k2(e,t,n){t=t||6,n=n||30;var i=b2(e).toHsl(),r=360/n,o=[b2(e)];for(i.h=(i.h-(r*t>>1)+720)%360;--t;)i.h=(i.h+r)%360,o.push(b2(i));return o}function O2(e,t){t=t||6;for(var n=b2(e).toHsv(),i=n.h,r=n.s,o=n.v,s=[],a=1/t;t--;)s.push(b2({h:i,s:r,v:o})),o=(o+a)%1;return s}b2.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,i=this.toRgb();return e=i.r/255,t=i.g/255,n=i.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=z2(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=w2(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=w2(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),i=Math.round(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+i+"%)":"hsva("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=_2(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=_2(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),i=Math.round(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return E2(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,i,r){var o=[H2(Math.round(e).toString(16)),H2(Math.round(t).toString(16)),H2(Math.round(n).toString(16)),H2(Q2(i))];if(r&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1))return o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0);return o.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*j2(this._r,255))+"%",g:Math.round(100*j2(this._g,255))+"%",b:Math.round(100*j2(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*j2(this._r,255))+"%, "+Math.round(100*j2(this._g,255))+"%, "+Math.round(100*j2(this._b,255))+"%)":"rgba("+Math.round(100*j2(this._r,255))+"%, "+Math.round(100*j2(this._g,255))+"%, "+Math.round(100*j2(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(F2[E2(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+S2(this._r,this._g,this._b,this._a),n=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var r=b2(e);n="#"+S2(r._r,r._g,r._b,r._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,i=this._a<1&&this._a>=0;return t||!i||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return b2(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(R2,arguments)},brighten:function(){return this._applyModification(I2,arguments)},darken:function(){return this._applyModification(P2,arguments)},desaturate:function(){return this._applyModification(C2,arguments)},saturate:function(){return this._applyModification(M2,arguments)},greyscale:function(){return this._applyModification(T2,arguments)},spin:function(){return this._applyModification(B2,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(k2,arguments)},complement:function(){return this._applyCombination(L2,arguments)},monochromatic:function(){return this._applyCombination(O2,arguments)},splitcomplement:function(){return this._applyCombination(D2,arguments)},triad:function(){return this._applyCombination(N2,[3])},tetrad:function(){return this._applyCombination(N2,[4])}},b2.fromRatio=function(e,t){if("object"==y2(e)){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]="a"===i?e[i]:W2(e[i]));e=n}return b2(e,t)},b2.equals=function(e,t){return!(!e||!t)&&b2(e).toRgbString()==b2(t).toRgbString()},b2.random=function(){return b2.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},b2.mix=function(e,t,n){n=0===n?0:n||50;var i=b2(e).toRgb(),r=b2(t).toRgb(),o=n/100;return b2({r:(r.r-i.r)*o+i.r,g:(r.g-i.g)*o+i.g,b:(r.b-i.b)*o+i.b,a:(r.a-i.a)*o+i.a})},b2.readability=function(e,t){var n=b2(e),i=b2(t);return(Math.max(n.getLuminance(),i.getLuminance())+.05)/(Math.min(n.getLuminance(),i.getLuminance())+.05)},b2.isReadable=function(e,t,n){var i,r,o=b2.readability(e,t);switch(r=!1,(i=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n)).level+i.size){case"AAsmall":case"AAAlarge":r=o>=4.5;break;case"AAlarge":r=o>=3;break;case"AAAsmall":r=o>=7}return r},b2.mostReadable=function(e,t,n){var i,r,o,s,a=null,l=0;r=(n=n||{}).includeFallbackColors,o=n.level,s=n.size;for(var c=0;c<t.length;c++)(i=b2.readability(e,t[c]))>l&&(l=i,a=b2(t[c]));return b2.isReadable(e,a,{level:o,size:s})||!r?a:(n.includeFallbackColors=!1,b2.mostReadable(e,["#fff","#000"],n))};var U2=b2.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},F2=b2.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(U2);function z2(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function j2(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"===typeof e&&-1!=e.indexOf("%")}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function V2(e){return Math.min(1,Math.max(0,e))}function G2(e){return parseInt(e,16)}function H2(e){return 1==e.length?"0"+e:""+e}function W2(e){return e<=1&&(e=100*e+"%"),e}function Q2(e){return Math.round(255*parseFloat(e)).toString(16)}function q2(e){return G2(e)/255}var X2=function(){var e="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",t="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+t),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+t),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+t),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function $2(e){return!!X2.CSS_UNIT.exec(e)}function Y2(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function K2(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function J2(e,t,n){return t=a3(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c3()?Reflect.construct(t,n||[],a3(e).constructor):t.apply(e,n))}function Z2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function e3(e,t){return e.get(K2(e,t))}function t3(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function n3(e,t,n){return e.set(K2(e,t),n),n}function i3(e,t,n){if(c3())return Reflect.construct.apply(null,arguments);var i=[null];return i.push.apply(i,t),new(e.bind.apply(e,i))}function r3(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,m3(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function o3(e,t,n){return(t=m3(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s3(){return s3="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=a3(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},s3.apply(null,arguments)}function a3(e){return a3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a3(e)}function l3(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h3(e,t)}function c3(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(c3=function(){return!!e})()}function u3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h3(e,t){return h3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h3(e,t)}function d3(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||v3(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p3(e,t,n,i){var r=s3(a3(e.prototype),t,n);return"function"==typeof r?function(e){return r.apply(n,e)}:r}function f3(e){return function(e){if(Array.isArray(e))return Y2(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v3(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m3(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function g3(e){return g3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g3(e)}function v3(e,t){if(e){if("string"==typeof e)return Y2(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y2(e,t):void 0}}var y3=function(e){e instanceof Array?e.forEach(y3):(e.map&&e.map.dispose(),e.dispose())},A3=function(e){e.geometry&&e.geometry.dispose(),e.material&&y3(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(A3)},x3=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),A3(t)}},b3=new WeakMap,_3=new WeakMap,w3=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.dataBindAttr,o=void 0===r?"__data":r,s=i.objBindAttr,a=void 0===s?"__threeObj":s;return Z2(this,t),o3(n=J2(this,t),"scene",void 0),t3(n,b3,void 0),t3(n,_3,void 0),n.scene=e,n3(b3,n,o),n3(_3,n,a),n.onRemoveObj((function(){})),n}return l3(t,e),r3(t,[{key:"onCreateObj",value:function(e){var n=this;return p3(t,"onCreateObj",this)([function(t){var i=e(t);return t[e3(_3,n)]=i,i[e3(b3,n)]=t,n.scene.add(i),i}]),this}},{key:"onRemoveObj",value:function(e){var n=this;return p3(t,"onRemoveObj",this)([function(i,r){var o=p3(t,"getData",n)([i]);e(i,r),n.scene.remove(i),x3(i),delete o[e3(_3,n)]}]),this}}])}(l2),E3=function(e){return isNaN(e)?parseInt(b2(e).toHex(),16):e},S3=function(e){return isNaN(e)?b2(e).getAlpha():1},C3=g2(v2);function M3(e,t,n){t&&"string"===typeof n&&e.filter((function(e){return!e[n]})).forEach((function(e){e[n]=C3(t(e))}))}var T3=window.THREE?window.THREE:{Group:x0.YJl,Mesh:x0.eaF,MeshLambertMaterial:x0.G_z,Color:x0.Q1f,BufferGeometry:x0.LoY,BufferAttribute:x0.THS,Matrix4:x0.kn4,Vector3:x0.Pq0,SphereGeometry:x0.Gu$,CylinderGeometry:x0.Ho_,TubeGeometry:x0.j6,ConeGeometry:x0.qFE,Line:x0.N1A,LineBasicMaterial:x0.mrM,QuadraticBezierCurve3:x0.CV9,CubicBezierCurve3:x0.s0K,Box3:x0.NRn},R3={graph:a1,forcelayout:l1},I3=(new T3.BufferGeometry).setAttribute?"setAttribute":"addAttribute",P3=(new T3.BufferGeometry).applyMatrix4?"applyMatrix4":"applyMatrix";var B3=function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=function(n){function i(){var n;Z2(this,i);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=J2(this,i,[].concat(o))).__kapsuleInstance=i3(e,[].concat(f3(t?[n]:[]),o)),n}return l3(i,n),r3(i)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(e()).forEach((function(e){return n.prototype[e]=function(){var t,n=(t=this.__kapsuleInstance)[e].apply(t,arguments);return n===this.__kapsuleInstance?this:n}})),n}(V1({props:{jsonUrl:{onChange:function(e,t){var n=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then((function(e){return e.json()})).then((function(e){t.fetchingJson=!1,t.onFinishLoading(e),n.graphData(e)})))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var n=t.d3ForceLayout.force("charge");function i(e,t){e.forEach((function(e){delete e[t],delete e["v".concat(t)]}))}n&&n.strength(e>2?-60:-30),e<3&&i(t.graphData.nodes,"z"),e<2&&i(t.graphData.nodes,"y")}},dagMode:{onChange:function(e,t){!e&&"d3"===t.forceEngine&&(t.graphData.nodes||[]).forEach((function(e){return e.fx=e.fy=e.fz=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,n){return void 0===n?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t="ngraph"!==e.forceEngine;return e.engineRunning&&function(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var n=G1(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach((function(i){var r=d3(i,2),o=r[0],s=r[1];if(s){var a=t?o:e.layout.getNodePosition(o[e.nodeId]),l=n(o);e.nodePositionUpdate&&e.nodePositionUpdate(l?s.children[0]:s,{x:a.x,y:a.y,z:a.z},o)&&!l||(s.position.x=a.x,s.position.y=a.y||0,s.position.z=a.z||0)}}));var i=G1(e.linkWidth),r=G1(e.linkCurvature),o=G1(e.linkCurveRotation),s=G1(e.linkThreeObjectExtend);function a(n){var i=t?n:e.layout.getLinkPosition(e.layout.graph.getLink(n.source,n.target).id),s=i[t?"source":"from"],a=i[t?"target":"to"];if(s&&a&&s.hasOwnProperty("x")&&a.hasOwnProperty("x")){var l=r(n);if(l){var c,u=new T3.Vector3(s.x,s.y||0,s.z||0),h=new T3.Vector3(a.x,a.y||0,a.z||0),d=u.distanceTo(h),p=o(n);if(d>0){var f=a.x-s.x,m=a.y-s.y||0,g=(new T3.Vector3).subVectors(h,u),v=g.clone().multiplyScalar(l).cross(0!==f||0!==m?new T3.Vector3(0,0,1):new T3.Vector3(0,1,0)).applyAxisAngle(g.normalize(),p).add((new T3.Vector3).addVectors(u,h).divideScalar(2));c=new T3.QuadraticBezierCurve3(u,v,h)}else{var y=70*l,A=-p,x=A+Math.PI/2;c=new T3.CubicBezierCurve3(u,new T3.Vector3(y*Math.cos(x),y*Math.sin(x),0).add(u),new T3.Vector3(y*Math.cos(A),y*Math.sin(A),0).add(u),h)}n.__curve=c}else n.__curve=null}}e.linkDataMapper.entries().forEach((function(n){var r=d3(n,2),o=r[0],l=r[1];if(l){var c=t?o:e.layout.getLinkPosition(e.layout.graph.getLink(o.source,o.target).id),u=c[t?"source":"from"],h=c[t?"target":"to"];if(u&&h&&u.hasOwnProperty("x")&&h.hasOwnProperty("x")){a(o);var d=s(o);if(!e.linkPositionUpdate||!e.linkPositionUpdate(d?l.children[1]:l,{start:{x:u.x,y:u.y,z:u.z},end:{x:h.x,y:h.y,z:h.z}},o)||d){var p=30,f=o.__curve,m=l.children.length?l.children[0]:l;if("Line"===m.type){if(f){var g=f.getPoints(p);m.geometry.getAttribute("position").array.length!==3*g.length&&m.geometry[I3]("position",new T3.BufferAttribute(new Float32Array(3*g.length),3)),m.geometry.setFromPoints(g)}else{var v=m.geometry.getAttribute("position");v&&v.array&&6===v.array.length||m.geometry[I3]("position",v=new T3.BufferAttribute(new Float32Array(6),3)),v.array[0]=u.x,v.array[1]=u.y||0,v.array[2]=u.z||0,v.array[3]=h.x,v.array[4]=h.y||0,v.array[5]=h.z||0,v.needsUpdate=!0}m.geometry.computeBoundingSphere()}else if("Mesh"===m.type)if(f){m.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(m.position.set(0,0,0),m.rotation.set(0,0,0),m.scale.set(1,1,1));var y=Math.ceil(10*i(o))/10/2,A=new T3.TubeGeometry(f,p,y,e.linkResolution,!1);m.geometry.dispose(),m.geometry=A}else{if(!m.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var x=Math.ceil(10*i(o))/10/2,b=new T3.CylinderGeometry(x,x,1,e.linkResolution,1,!1);b[P3]((new T3.Matrix4).makeTranslation(0,.5,0)),b[P3]((new T3.Matrix4).makeRotationX(Math.PI/2)),m.geometry.dispose(),m.geometry=b}var _=new T3.Vector3(u.x,u.y||0,u.z||0),w=new T3.Vector3(h.x,h.y||0,h.z||0),E=_.distanceTo(w);m.position.x=_.x,m.position.y=_.y,m.position.z=_.z,m.scale.z=E,m.parent.localToWorld(w),m.lookAt(w)}}}}}))}(),function(){var n=G1(e.linkDirectionalArrowRelPos),i=G1(e.linkDirectionalArrowLength),r=G1(e.nodeVal);e.arrowDataMapper.entries().forEach((function(o){var s=d3(o,2),a=s[0],l=s[1];if(l){var c=t?a:e.layout.getLinkPosition(e.layout.graph.getLink(a.source,a.target).id),u=c[t?"source":"from"],h=c[t?"target":"to"];if(u&&h&&u.hasOwnProperty("x")&&h.hasOwnProperty("x")){var d=Math.cbrt(Math.max(0,r(u)||1))*e.nodeRelSize,p=Math.cbrt(Math.max(0,r(h)||1))*e.nodeRelSize,f=i(a),m=n(a),g=a.__curve?function(e){return a.__curve.getPoint(e)}:function(e){var t=function(e,t,n,i){return t[e]+(n[e]-t[e])*i||0};return{x:t("x",u,h,e),y:t("y",u,h,e),z:t("z",u,h,e)}},v=a.__curve?a.__curve.getLength():Math.sqrt(["x","y","z"].map((function(e){return Math.pow((h[e]||0)-(u[e]||0),2)})).reduce((function(e,t){return e+t}),0)),y=d+f+(v-d-p-f)*m,A=g(y/v),x=g((y-f)/v);["x","y","z"].forEach((function(e){return l.position[e]=x[e]}));var b=i3(T3.Vector3,f3(["x","y","z"].map((function(e){return A[e]}))));l.parent.localToWorld(b),l.lookAt(b)}}}))}(),function(){var n=G1(e.linkDirectionalParticleSpeed);e.graphData.links.forEach((function(i){var r=e.particlesDataMapper.getObj(i),o=r&&r.children,s=i.__singleHopPhotonsObj&&i.__singleHopPhotonsObj.children;if(s&&s.length||o&&o.length){var a=t?i:e.layout.getLinkPosition(e.layout.graph.getLink(i.source,i.target).id),l=a[t?"source":"from"],c=a[t?"target":"to"];if(l&&c&&l.hasOwnProperty("x")&&c.hasOwnProperty("x")){var u=n(i),h=i.__curve?function(e){return i.__curve.getPoint(e)}:function(e){var t=function(e,t,n,i){return t[e]+(n[e]-t[e])*i||0};return{x:t("x",l,c,e),y:t("y",l,c,e),z:t("z",l,c,e)}};[].concat(f3(o||[]),f3(s||[])).forEach((function(e,t){var n="singleHopPhotons"===e.parent.__linkThreeObjType;if(e.hasOwnProperty("__progressRatio")||(e.__progressRatio=n?0:t/o.length),e.__progressRatio+=u,e.__progressRatio>=1){if(n)return e.parent.remove(e),void x3(e);e.__progressRatio=e.__progressRatio%1}var i=e.__progressRatio,r=h(i);["x","y","z"].forEach((function(t){return e.position[t]=r[t]}))}))}}}))}(),this},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var n=new T3.Group;n.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=n,e.graphScene.add(n)}var i=G1(e.linkDirectionalParticleWidth),r=Math.ceil(10*i(t))/10/2,o=e.linkDirectionalParticleResolution,s=new T3.SphereGeometry(r,o,o),a=G1(e.linkColor),l=G1(e.linkDirectionalParticleColor)(t)||a(t)||"#f0f0f0",c=new T3.Color(E3(l)),u=3*e.linkOpacity,h=new T3.MeshLambertMaterial({color:c,transparent:!0,opacity:u});t.__singleHopPhotonsObj.add(new T3.Mesh(s,h))}return this},getGraphBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=function e(n){var i=[];if(n.geometry){n.geometry.computeBoundingBox();var r=new T3.Box3;r.copy(n.geometry.boundingBox).applyMatrix4(n.matrixWorld),i.push(r)}return i.concat.apply(i,f3((n.children||[]).filter((function(e){return!e.hasOwnProperty("__graphObjType")||"node"===e.__graphObjType&&t(e.__data)})).map(e)))}(e.graphScene);return n.length?Object.assign.apply(Object,f3(["x","y","z"].map((function(e){return o3({},e,[H1(n,(function(t){return t.min[e]})),W1(n,(function(t){return t.max[e]}))])})))):null}},stateInit:function(){return{d3ForceLayout:M0().force("link",B0()).force("charge",r1()).force("center",o1()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new w3(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new w3(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new w3(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new w3(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var n=function(e){return e.some((function(e){return t.hasOwnProperty(e)}))};if(e.engineRunning=!1,"function"===typeof e.onUpdate&&e.onUpdate(),null!==e.nodeAutoColorBy&&n(["nodeAutoColorBy","graphData","nodeColor"])&&M3(e.graphData.nodes,G1(e.nodeAutoColorBy),e.nodeColor),null!==e.linkAutoColorBy&&n(["linkAutoColorBy","graphData","linkColor"])&&M3(e.graphData.links,G1(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var i=G1(e.nodeThreeObject),r=G1(e.nodeThreeObjectExtend),o=G1(e.nodeVal),s=G1(e.nodeColor),a=G1(e.nodeVisibility),l={},c={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj((function(t){var n,o=i(t),s=r(t);return o&&e.nodeThreeObject===o&&(o=o.clone()),o&&!s?n=o:((n=new T3.Mesh).__graphDefaultObj=!0,o&&s&&n.add(o)),n.__graphObjType="node",n})).onUpdateObj((function(t,n){if(t.__graphDefaultObj){var i=o(n)||1,r=Math.cbrt(i)*e.nodeRelSize,a=e.nodeResolution;t.geometry.type.match(/^Sphere(Buffer)?Geometry$/)&&t.geometry.parameters.radius===r&&t.geometry.parameters.widthSegments===a||(l.hasOwnProperty(i)||(l[i]=new T3.SphereGeometry(r,a,a)),t.geometry.dispose(),t.geometry=l[i]);var u=s(n),h=new T3.Color(E3(u||"#ffffaa")),d=e.nodeOpacity*S3(u);"MeshLambertMaterial"===t.material.type&&t.material.color.equals(h)&&t.material.opacity===d||(c.hasOwnProperty(u)||(c[u]=new T3.MeshLambertMaterial({color:h,transparent:!0,opacity:d})),t.material.dispose(),t.material=c[u])}})).digest(e.graphData.nodes.filter(a))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var u=G1(e.linkThreeObject),h=G1(e.linkThreeObjectExtend),d=G1(e.linkMaterial),p=G1(e.linkVisibility),f=G1(e.linkColor),m=G1(e.linkWidth),g={},v={},y={},A=e.graphData.links.filter(p);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj((function(e){var t=e.__data&&e.__data.__singleHopPhotonsObj;t&&(t.parent.remove(t),x3(t),delete e.__data.__singleHopPhotonsObj)})).onCreateObj((function(t){var n,i,r=u(t),o=h(t);if(r&&e.linkThreeObject===r&&(r=r.clone()),!r||o)if(!!m(t))n=new T3.Mesh;else{var s=new T3.BufferGeometry;s[I3]("position",new T3.BufferAttribute(new Float32Array(6),3)),n=new T3.Line(s)}return r?o?((i=new T3.Group).__graphDefaultObj=!0,i.add(n),i.add(r)):i=r:(i=n).__graphDefaultObj=!0,i.renderOrder=10,i.__graphObjType="link",i})).onUpdateObj((function(t,n){if(t.__graphDefaultObj){var i=t.children.length?t.children[0]:t,r=Math.ceil(10*m(n))/10,o=!!r;if(o){var s=r/2,a=e.linkResolution;if(!i.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||i.geometry.parameters.radiusTop!==s||i.geometry.parameters.radialSegments!==a){if(!g.hasOwnProperty(r)){var l=new T3.CylinderGeometry(s,s,1,a,1,!1);l[P3]((new T3.Matrix4).makeTranslation(0,.5,0)),l[P3]((new T3.Matrix4).makeRotationX(Math.PI/2)),g[r]=l}i.geometry.dispose(),i.geometry=g[r]}}var c=d(n);if(c)i.material=c;else{var u=f(n),h=new T3.Color(E3(u||"#f0f0f0")),p=e.linkOpacity*S3(u),A=o?"MeshLambertMaterial":"LineBasicMaterial";if(i.material.type!==A||!i.material.color.equals(h)||i.material.opacity!==p){var x=o?v:y;x.hasOwnProperty(u)||(x[u]=new T3[A]({color:h,transparent:p<1,opacity:p,depthWrite:p>=1})),i.material.dispose(),i.material=x[u]}}}})).digest(A),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var x=G1(e.linkDirectionalArrowLength),b=G1(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj((function(){var e=new T3.Mesh(void 0,new T3.MeshLambertMaterial({transparent:!0}));return e.__linkThreeObjType="arrow",e})).onUpdateObj((function(t,n){var i=x(n),r=e.linkDirectionalArrowResolution;if(!t.geometry.type.match(/^Cone(Buffer)?Geometry$/)||t.geometry.parameters.height!==i||t.geometry.parameters.radialSegments!==r){var o=new T3.ConeGeometry(.25*i,i,r);o.translate(0,i/2,0),o.rotateX(Math.PI/2),t.geometry.dispose(),t.geometry=o}var s=b(n)||f(n)||"#f0f0f0";t.material.color=new T3.Color(E3(s)),t.material.opacity=3*e.linkOpacity*S3(s)})).digest(A.filter(x))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var _=G1(e.linkDirectionalParticles),w=G1(e.linkDirectionalParticleWidth),E=G1(e.linkDirectionalParticleColor),S={},C={};e.particlesDataMapper.onCreateObj((function(){var e=new T3.Group;return e.__linkThreeObjType="photons",e.__photonDataMapper=new w3(e),e})).onUpdateObj((function(t,n){var i,r=Math.round(Math.abs(_(n))),o=!!t.children.length&&t.children[0],s=Math.ceil(10*w(n))/10/2,a=e.linkDirectionalParticleResolution;o&&o.geometry.parameters.radius===s&&o.geometry.parameters.widthSegments===a?i=o.geometry:(C.hasOwnProperty(s)||(C[s]=new T3.SphereGeometry(s,a,a)),i=C[s],o&&o.geometry.dispose());var l,c=E(n)||f(n)||"#f0f0f0",u=new T3.Color(E3(c)),h=3*e.linkOpacity;o&&o.material.color.equals(u)&&o.material.opacity===h?l=o.material:(S.hasOwnProperty(c)||(S[c]=new T3.MeshLambertMaterial({color:u,transparent:!0,opacity:h})),l=S[c],o&&o.material.dispose()),t.__photonDataMapper.id((function(e){return e.idx})).onCreateObj((function(){return new T3.Mesh(i,l)})).onUpdateObj((function(e){e.geometry=i,e.material=l})).digest(f3(new Array(r)).map((function(e,t){return{idx:t}})))})).digest(A.filter(_))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach((function(t){t.source=t[e.linkSource],t.target=t[e.linkTarget]}));var M,T="ngraph"!==e.forceEngine;if(T){(M=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var R=e.d3ForceLayout.force("link");R&&R.id((function(t){return t[e.nodeId]})).links(e.graphData.links);var I=e.dagMode&&function(e,t){var n=e.nodes,i=e.links,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.nodeFilter,s=void 0===o?function(){return!0}:o,a=r.onLoopError,l=void 0===a?function(e){throw"Invalid DAG structure! Found cycle in node path: ".concat(e.join(" -> "),".")}:a,c={};n.forEach((function(e){return c[t(e)]={data:e,out:[],depth:-1,skip:!s(e)}})),i.forEach((function(e){var n=e.source,i=e.target,r=l(n),o=l(i);if(!c.hasOwnProperty(r))throw"Missing source node with id: ".concat(r);if(!c.hasOwnProperty(o))throw"Missing target node with id: ".concat(o);var s=c[r],a=c[o];function l(e){return"object"===g3(e)?t(e):e}s.out.push(a)}));var u=[];return function e(n){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=function(){var o=n[s];if(-1!==i.indexOf(o)){var a=[].concat(f3(i.slice(i.indexOf(o))),[o]).map((function(e){return t(e.data)}));return u.some((function(e){return e.length===a.length&&e.every((function(e,t){return e===a[t]}))}))||(u.push(a),l(a)),1}r>o.depth&&(o.depth=r,e(o.out,[].concat(f3(i),[o]),r+(o.skip?0:1)))},s=0,a=n.length;s<a;s++)o()}(Object.values(c)),Object.assign.apply(Object,[{}].concat(f3(Object.entries(c).filter((function(e){return!d3(e,2)[1].skip})).map((function(e){var t=d3(e,2);return o3({},t[0],t[1].depth)})))))}(e.graphData,(function(t){return t[e.nodeId]}),{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),P=Math.max.apply(Math,f3(Object.values(I||[]))),B=e.dagLevelDistance||e.graphData.nodes.length/(P||1)*2*(-1!==["radialin","radialout"].indexOf(e.dagMode)?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var L=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach((function(e){return delete e[L]}))}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var N=["rl","td","zout"].includes(e.dagMode),D=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach((function(t){return t[D]=function(t){return(I[t[e.nodeId]]-P/2)*B*(N?-1:1)}(t)}))}e.d3ForceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(e.dagMode)?s1((function(t){var n=I[t[e.nodeId]]||-1;return("radialin"===e.dagMode?P-n:n)*B})).strength((function(t){return e.dagNodeFilter(t)?1:0})):null)}else{var k=R3.graph();e.graphData.nodes.forEach((function(t){k.addNode(t[e.nodeId])})),e.graphData.links.forEach((function(e){k.addLink(e.source,e.target)})),M=R3.forcelayout(k,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u3(Object(n),!0).forEach((function(t){o3(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u3(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({dimensions:e.numDimensions},e.ngraphPhysics)),M.graph=k}for(var O=0;O<e.warmupTicks&&!(T&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);O++)M[T?"tick":"step"]();e.layout=M,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}}),(window.THREE?window.THREE:{Group:x0.YJl}).Group,!0);if("undefined"===typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var L3=function(e){return"string"===typeof e?JSON.parse(e):e},N3=function(e){if("function"===typeof e)return e;var t=eval;try{return t("("+e+")")}catch(Jbe){}return null},D3=function(e){return isNaN(parseFloat(e))?N3(e)?N3(e):e:parseFloat(e)};function k3(e){return k3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k3(e)}function O3(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(O3=function(){return!!e})()}function U3(e){var t="function"==typeof Map?new Map:void 0;return U3=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(O3())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var r=new(e.bind.apply(e,i));return n&&zt(r,n.prototype),r}(e,arguments,k3(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),zt(n,e)},U3(e)}AFRAME.components.hasOwnProperty("forcegraph")||AFRAME.registerComponent("forcegraph",{schema:{jsonUrl:{type:"string",default:""},nodes:{parse:L3,default:[]},links:{parse:L3,default:[]},numDimensions:{type:"number",default:3},dagMode:{type:"string",default:""},dagLevelDistance:{type:"number",default:0},dagNodeFilter:{parse:N3,default:function(){return!0}},onDagError:{parse:N3,default:void 0},nodeRelSize:{type:"number",default:4},nodeId:{type:"string",default:"id"},nodeVal:{parse:D3,default:"val"},nodeResolution:{type:"number",default:8},nodeVisibility:{parse:D3,default:!0},nodeColor:{parse:D3,default:"color"},nodeAutoColorBy:{parse:D3,default:""},nodeOpacity:{type:"number",default:.75},nodeThreeObject:{parse:D3,default:null},nodeThreeObjectExtend:{parse:D3,default:!1},linkSource:{type:"string",default:"source"},linkTarget:{type:"string",default:"target"},linkVisibility:{parse:D3,default:!0},linkColor:{parse:D3,default:"color"},linkAutoColorBy:{parse:D3,default:""},linkOpacity:{type:"number",default:.2},linkWidth:{parse:D3,default:0},linkResolution:{type:"number",default:6},linkCurvature:{parse:D3,default:0},linkCurveRotation:{parse:D3,default:0},linkMaterial:{parse:D3,default:null},linkThreeObject:{parse:D3,default:null},linkThreeObjectExtend:{parse:D3,default:!1},linkPositionUpdate:{parse:N3,default:null},linkDirectionalArrowLength:{parse:D3,default:0},linkDirectionalArrowColor:{parse:D3,default:null},linkDirectionalArrowRelPos:{parse:D3,default:.5},linkDirectionalArrowResolution:{type:"number",default:8},linkDirectionalParticles:{parse:D3,default:0},linkDirectionalParticleSpeed:{parse:D3,default:.01},linkDirectionalParticleWidth:{parse:D3,default:.5},linkDirectionalParticleColor:{parse:D3,default:null},linkDirectionalParticleResolution:{type:"number",default:4},onNodeHover:{parse:N3,default:function(){}},onLinkHover:{parse:N3,default:function(){}},onNodeClick:{parse:N3,default:function(){}},onLinkClick:{parse:N3,default:function(){}},forceEngine:{type:"string",default:"d3"},d3AlphaMin:{type:"number",default:0},d3AlphaDecay:{type:"number",default:.0228},d3VelocityDecay:{type:"number",default:.4},ngraphPhysics:{parse:L3,default:null},warmupTicks:{type:"int",default:0},cooldownTicks:{type:"int",default:1e18},cooldownTime:{type:"int",default:15e3},onEngineTick:{parse:N3,default:function(){}},onEngineStop:{parse:N3,default:function(){}}},getGraphBbox:function(e){return this.forceGraph||(this.forceGraph=new B3),this.forceGraph.getGraphBbox(e)},emitParticle:function(){this.forceGraph||(this.forceGraph=new B3);var e=this.forceGraph,t=e.emitParticle.apply(e,arguments);return t===e?this:t},d3Force:function(){this.forceGraph||(this.forceGraph=new B3);var e=this.forceGraph,t=e.d3Force.apply(e,arguments);return t===e?this:t},d3ReheatSimulation:function(){return this.forceGraph&&this.forceGraph.d3ReheatSimulation(),this},refresh:function(){return this.forceGraph&&this.forceGraph.refresh(),this},init:function(){var e=this,t=this.state={};t.infoEl=document.createElement("a-text"),t.infoEl.setAttribute("position","0 -0.1 -1"),t.infoEl.setAttribute("width",1),t.infoEl.setAttribute("align","center"),t.infoEl.setAttribute("color","lavender");var n=document.querySelector("a-entity[camera], a-camera");n.appendChild(t.infoEl),t.cameraObj=n.object3D.children.filter((function(e){return"PerspectiveCamera"===e.type}))[0],this.el.sceneEl.addEventListener("camera-set-active",(function(e){t.cameraObj=e.detail.cameraEl.components.camera.camera})),this.forceGraph||(this.forceGraph=new B3),this.forceGraph.onFinishUpdate((function(){return e.el.setObject3D("forcegraphGroup",e.forceGraph)})).onLoading((function(){return t.infoEl.setAttribute("value","Loading...")})).onFinishLoading((function(){return t.infoEl.setAttribute("value","")})),this.el.addEventListener("raycaster-intersected",(function(e){return t.hoverDetail=e.detail})),this.el.addEventListener("raycaster-intersected-cleared",(function(e){return t.hoverDetail=e.detail})),this.el.addEventListener("click",(function(){return t.hoverObj&&e.data["on"+("node"===t.hoverObj.__graphObjType?"Node":"Link")+"Click"](t.hoverObj.__data)}))},remove:function(){this.state.infoEl.remove(),this.el.removeObject3D("forcegraphGroup")},update:function(e){var t=this,n=this.data,i=AFRAME.utils.diff(n,e);["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].filter((function(e){return e in i})).forEach((function(e){t.forceGraph[e](""!==n[e]?n[e]:null)})),("nodes"in i||"links"in i)&&t.forceGraph.graphData({nodes:n.nodes,links:n.links})},tick:function(e,t){for(var n=this.state,i=this.data,r=n.hoverDetail?n.hoverDetail.getIntersection?n.hoverDetail.getIntersection(this.el):n.hoverDetail.intersection||void 0:void 0,o=r?r.object:void 0;o&&!o.hasOwnProperty("__graphObjType");)o=o.parent;if(o!==n.hoverObj){var s=n.hoverObj?n.hoverObj.__graphObjType:null,a=n.hoverObj?n.hoverObj.__data:null,l=o?o.__graphObjType:null,c=o?o.__data:null;s&&s!==l&&i["on"+("node"===s?"Node":"Link")+"Hover"](null,a),l&&i["on"+("node"===l?"Node":"Link")+"Hover"](c,s===l?a:null),n.hoverObj=o}this.forceGraph.tickFrame()}});var F3=function(e){function t(t){return Ft(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return jt(t,e),t}(U3(Error));function z3(e,t){return e.substr(-t.length)===t}var j3=/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/;function V3(e){return"string"!==typeof e?e:e.match(j3)?parseFloat(e):e}var G3=function(e){return function(t,n){void 0===n&&(n="16px");var i=t,r=n;if("string"===typeof t){if(!z3(t,"px"))throw new F3(69,e,t);i=V3(t)}if("string"===typeof n){if(!z3(n,"px"))throw new F3(70,e,n);r=V3(n)}if("string"===typeof i)throw new F3(71,t,e);if("string"===typeof r)throw new F3(72,n,e);return""+i/r+e}};G3("em");G3("rem");function H3(e){return Math.round(255*e)}function W3(e,t,n){return H3(e)+","+H3(t)+","+H3(n)}function Q3(e,t,n,i){if(void 0===i&&(i=W3),0===t)return i(n,n,n);var r=(e%360+360)%360/60,o=(1-Math.abs(2*n-1))*t,s=o*(1-Math.abs(r%2-1)),a=0,l=0,c=0;r>=0&&r<1?(a=o,l=s):r>=1&&r<2?(a=s,l=o):r>=2&&r<3?(l=o,c=s):r>=3&&r<4?(l=s,c=o):r>=4&&r<5?(a=s,c=o):r>=5&&r<6&&(a=o,c=s);var u=n-o/2;return i(a+u,l+u,c+u)}var q3={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var X3=/^#[a-fA-F0-9]{6}$/,$3=/^#[a-fA-F0-9]{8}$/,Y3=/^#[a-fA-F0-9]{3}$/,K3=/^#[a-fA-F0-9]{4}$/,J3=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Z3=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,e4=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,t4=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function n4(e){if("string"!==typeof e)throw new F3(3);var t=function(e){if("string"!==typeof e)return e;var t=e.toLowerCase();return q3[t]?"#"+q3[t]:e}(e);if(t.match(X3))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match($3)){var n=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:n}}if(t.match(Y3))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(K3)){var i=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:i}}var r=J3.exec(t);if(r)return{red:parseInt(""+r[1],10),green:parseInt(""+r[2],10),blue:parseInt(""+r[3],10)};var o=Z3.exec(t.substring(0,50));if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10),alpha:parseFloat(""+o[4])>1?parseFloat(""+o[4])/100:parseFloat(""+o[4])};var s=e4.exec(t);if(s){var a="rgb("+Q3(parseInt(""+s[1],10),parseInt(""+s[2],10)/100,parseInt(""+s[3],10)/100)+")",l=J3.exec(a);if(!l)throw new F3(4,t,a);return{red:parseInt(""+l[1],10),green:parseInt(""+l[2],10),blue:parseInt(""+l[3],10)}}var c=t4.exec(t.substring(0,50));if(c){var u="rgb("+Q3(parseInt(""+c[1],10),parseInt(""+c[2],10)/100,parseInt(""+c[3],10)/100)+")",h=J3.exec(u);if(!h)throw new F3(4,t,u);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10),alpha:parseFloat(""+c[4])>1?parseFloat(""+c[4])/100:parseFloat(""+c[4])}}throw new F3(5)}function i4(e){return function(e){var t,n=e.red/255,i=e.green/255,r=e.blue/255,o=Math.max(n,i,r),s=Math.min(n,i,r),a=(o+s)/2;if(o===s)return void 0!==e.alpha?{hue:0,saturation:0,lightness:a,alpha:e.alpha}:{hue:0,saturation:0,lightness:a};var l=o-s,c=a>.5?l/(2-o-s):l/(o+s);switch(o){case n:t=(i-r)/l+(i<r?6:0);break;case i:t=(r-n)/l+2;break;default:t=(n-i)/l+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:c,lightness:a,alpha:e.alpha}:{hue:t,saturation:c,lightness:a}}(n4(e))}var r4=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function o4(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function s4(e){return o4(Math.round(255*e))}function a4(e,t,n){return r4("#"+s4(e)+s4(t)+s4(n))}function l4(e,t,n){return Q3(e,t,n,a4)}function c4(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return l4(e,t,n);if("object"===typeof e&&void 0===t&&void 0===n)return l4(e.hue,e.saturation,e.lightness);throw new F3(1)}function u4(e,t,n,i){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n&&"number"===typeof i)return i>=1?l4(e,t,n):"rgba("+Q3(e,t,n)+","+i+")";if("object"===typeof e&&void 0===t&&void 0===n&&void 0===i)return e.alpha>=1?l4(e.hue,e.saturation,e.lightness):"rgba("+Q3(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new F3(2)}function h4(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return r4("#"+o4(e)+o4(t)+o4(n));if("object"===typeof e&&void 0===t&&void 0===n)return r4("#"+o4(e.red)+o4(e.green)+o4(e.blue));throw new F3(6)}function d4(e,t,n,i){if("string"===typeof e&&"number"===typeof t){var r=n4(e);return"rgba("+r.red+","+r.green+","+r.blue+","+t+")"}if("number"===typeof e&&"number"===typeof t&&"number"===typeof n&&"number"===typeof i)return i>=1?h4(e,t,n):"rgba("+e+","+t+","+n+","+i+")";if("object"===typeof e&&void 0===t&&void 0===n&&void 0===i)return e.alpha>=1?h4(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new F3(7)}function p4(e){if("object"!==typeof e)throw new F3(8);if(function(e){return"number"===typeof e.red&&"number"===typeof e.green&&"number"===typeof e.blue&&"number"===typeof e.alpha}(e))return d4(e);if(function(e){return"number"===typeof e.red&&"number"===typeof e.green&&"number"===typeof e.blue&&("number"!==typeof e.alpha||"undefined"===typeof e.alpha)}(e))return h4(e);if(function(e){return"number"===typeof e.hue&&"number"===typeof e.saturation&&"number"===typeof e.lightness&&"number"===typeof e.alpha}(e))return u4(e);if(function(e){return"number"===typeof e.hue&&"number"===typeof e.saturation&&"number"===typeof e.lightness&&("number"!==typeof e.alpha||"undefined"===typeof e.alpha)}(e))return c4(e);throw new F3(8)}function f4(e,t,n){return function(){var i=n.concat(Array.prototype.slice.call(arguments));return i.length>=t?e.apply(this,i):f4(e,t,i)}}function m4(e){return f4(e,e.length,[])}m4((function(e,t){if("transparent"===t)return t;var n=i4(t);return p4((0,ze.A)({},n,{hue:n.hue+parseFloat(e)}))}));function g4(e,t,n){return Math.max(e,Math.min(t,n))}m4((function(e,t){if("transparent"===t)return t;var n=i4(t);return p4((0,ze.A)({},n,{lightness:g4(0,1,n.lightness-parseFloat(e))}))}));m4((function(e,t){if("transparent"===t)return t;var n=i4(t);return p4((0,ze.A)({},n,{saturation:g4(0,1,n.saturation-parseFloat(e))}))}));m4((function(e,t){if("transparent"===t)return t;var n=i4(t);return p4((0,ze.A)({},n,{lightness:g4(0,1,n.lightness+parseFloat(e))}))}));var v4=m4((function(e,t,n){if("transparent"===t)return n;if("transparent"===n)return t;if(0===e)return n;var i=n4(t),r=(0,ze.A)({},i,{alpha:"number"===typeof i.alpha?i.alpha:1}),o=n4(n),s=(0,ze.A)({},o,{alpha:"number"===typeof o.alpha?o.alpha:1}),a=r.alpha-s.alpha,l=2*parseFloat(e)-1,c=((l*a===-1?l:l+a)/(1+l*a)+1)/2,u=1-c;return d4({red:Math.floor(r.red*c+s.red*u),green:Math.floor(r.green*c+s.green*u),blue:Math.floor(r.blue*c+s.blue*u),alpha:r.alpha*parseFloat(e)+s.alpha*(1-parseFloat(e))})}));var y4=m4((function(e,t){if("transparent"===t)return t;var n=n4(t),i="number"===typeof n.alpha?n.alpha:1;return d4((0,ze.A)({},n,{alpha:g4(0,1,(100*i+100*parseFloat(e))/100)}))}));m4((function(e,t){if("transparent"===t)return t;var n=i4(t);return p4((0,ze.A)({},n,{saturation:g4(0,1,n.saturation+parseFloat(e))}))}));m4((function(e,t){return"transparent"===t?t:p4((0,ze.A)({},i4(t),{hue:parseFloat(e)}))}));m4((function(e,t){return"transparent"===t?t:p4((0,ze.A)({},i4(t),{lightness:parseFloat(e)}))}));m4((function(e,t){return"transparent"===t?t:p4((0,ze.A)({},i4(t),{saturation:parseFloat(e)}))}));m4((function(e,t){return"transparent"===t?t:v4(parseFloat(e),"rgb(0, 0, 0)",t)}));m4((function(e,t){return"transparent"===t?t:v4(parseFloat(e),"rgb(255, 255, 255)",t)}));m4((function(e,t){if("transparent"===t)return t;var n=n4(t),i="number"===typeof n.alpha?n.alpha:1;return d4((0,ze.A)({},n,{alpha:g4(0,1,+(100*i-100*parseFloat(e)).toFixed(2)/100)}))}));function A4(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function x4(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b4(Object(n),!0).forEach((function(t){x4(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b4(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w4(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||S4(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E4(e){return function(e){if(Array.isArray(e))return A4(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S4(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S4(e,t){if(e){if("string"==typeof e)return A4(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A4(e,t):void 0}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".graph-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: Sans-serif;\n  z-index: 1000;\n}");var C4=V1({props:{width:{default:window.innerWidth,triggerUpdate:!1,onChange:function(e,t){t.container&&(t.container.style.width="".concat(e,"px"))}},height:{default:window.innerHeight,triggerUpdate:!1,onChange:function(e,t){t.container&&(t.container.style.height="".concat(e,"px"))}},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},backgroundColor:{default:"#002"},showNavInfo:{default:!0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeLabel:{default:"name"},nodeDesc:{default:"desc"},onNodeHover:{},onNodeClick:{},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkLabel:{default:"name"},linkDesc:{default:"desc"},onLinkHover:{},onLinkClick:{},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:_4(_4({},Object.assign.apply(Object,[{}].concat(E4(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map((function(e){return x4({},e,(function(t){for(var n=t.forcegraph.components.forcegraph,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var s=n[e].apply(n,r);return s===n?this:s}))})))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(e,t){e.innerHTML="",t.container=document.createElement("div"),e.appendChild(t.container),t.container.style.position="relative",t.container.style.width="".concat(t.width,"px"),t.container.style.height="".concat(t.height,"px"),t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="graph-nav-info",t.navInfo.textContent="Mouse drag: look, gamepad/arrow/wasd keys: move";var n,i,r,o,s,a=document.createElement("a-scene");a.setAttribute("embedded",""),a.appendChild(t.sky=document.createElement("a-sky")),t.sky.setAttribute("radius",3e3),a.appendChild(n=document.createElement("a-entity")),n.setAttribute("position","0 0 300"),n.setAttribute("movement-controls","controls: gamepad, touch; fly: true; speed: 7"),n.appendChild(i=document.createElement("a-entity")),i.setAttribute("camera",""),i.setAttribute("position","0 0 0"),i.setAttribute("look-controls","pointerLockEnabled: false"),i.setAttribute("wasd-controls","fly: true; acceleration: 700"),i.appendChild(r=document.createElement("a-text")),r.setAttribute("position","0 -0.3 -1"),r.setAttribute("width",2),r.setAttribute("align","center"),r.setAttribute("color","lavender"),r.setAttribute("value",""),i.appendChild(o=document.createElement("a-text")),o.setAttribute("position","0 -0.4 -1"),o.setAttribute("width",1.3),o.setAttribute("align","center"),o.setAttribute("color","lavender"),o.setAttribute("value",""),t.raycasterEls=[],a.appendChild(s=document.createElement("a-entity")),s.setAttribute("cursor","rayOrigin: mouse; mouseCursorStylesEnabled: true"),s.setAttribute("raycaster","objects: [forcegraph]; interval: 100"),t.raycasterEls.push(s),["left","right"].forEach((function(e){var i;n.appendChild(i=document.createElement("a-entity")),i.setAttribute("laser-controls","hand: ".concat(e,"; model: false;")),i.setAttribute("raycaster","objects: [forcegraph]; interval: 100; lineColor: steelblue; lineOpacity: 0.85"),t.raycasterEls.push(i)})),a.appendChild(t.forcegraph=document.createElement("a-entity")),t.forcegraph.setAttribute("forcegraph",null),t.container.appendChild(a),t.forcegraph.setAttribute("forcegraph",Object.assign.apply(Object,E4(["node","link"].map((function(e){var n={node:"Node",link:"Link"}[e];return x4({},"on".concat(n,"Hover"),(function(i,s){var a=i&&G1(t["".concat(e,"Label")])(i)||"",l=i&&G1(t["".concat(e,"Desc")])(i)||"";r.setAttribute("value",a),o.setAttribute("value",l),t["on".concat(n,"Hover")]&&t["on".concat(n,"Hover")](i,s)}))})))))},update:function(e,t){if(t.hasOwnProperty("backgroundColor")){var n=n4(e.backgroundColor).alpha;void 0===n&&(n=1),e.sky.setAttribute("color",y4(1,e.backgroundColor)),e.sky.setAttribute("opacity",n)}t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none");var i=["onNodeHover","onLinkHover","onNodeClick","onLinkClick"].some((function(t){return e[t]}))||["nodeLabel","linkLabel"].some((function(t){return"name"!==e[t]}))||["nodeDesc","linkDesc"].some((function(t){return"desc"!==e[t]}));e.raycasterEls.forEach((function(e){return e.setAttribute("raycaster",i?"objects: [forcegraph]; interval: 100":"objects: __none__")}));var r=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","onNodeClick","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","onLinkClick","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],o=Object.assign.apply(Object,[{}].concat(E4(Object.entries(e).filter((function(e){var n=w4(e,2),i=n[0],o=n[1];return t.hasOwnProperty(i)&&-1!==r.indexOf(i)&&void 0!==o&&null!==o})).map((function(e){var t=w4(e,2);return x4({},t[0],t[1])}))),E4(Object.entries(e.graphData).map((function(e){var t=w4(e,2);return x4({},t[0],t[1])})))));e.forcegraph.setAttribute("forcegraph",o)}}),M4=i(5173),T4=i.n(M4);function R4(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function I4(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function B4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P4(Object(n),!0).forEach((function(t){I4(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P4(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L4(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||D4(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N4(e){return function(e){if(Array.isArray(e))return R4(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||D4(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D4(e,t){if(e){if("string"==typeof e)return R4(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R4(e,t):void 0}}var k4=V1({props:{width:{},height:{},yOffset:{default:1.5},glScale:{default:200},jsonUrl:{},graphData:{default:{nodes:[],links:[]}},numDimensions:{default:3},dagMode:{},dagLevelDistance:{},dagNodeFilter:{default:function(){return!0}},onDagError:{default:void 0},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeVisibility:{default:!0},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{default:0},linkResolution:{default:6},linkCurvature:{default:0},linkCurveRotation:{default:0},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},onNodeHover:{},onNodeClick:{},onLinkHover:{},onLinkClick:{},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228},d3VelocityDecay:{default:.4},ngraphPhysics:{},warmupTicks:{default:0},cooldownTicks:{},cooldownTime:{default:15e3},onEngineTick:{},onEngineStop:{}},methods:B4(B4({},Object.assign.apply(Object,[{}].concat(N4(["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"].map((function(e){return I4({},e,(function(t){for(var n=t.forcegraph.components.forcegraph,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var s=n[e].apply(n,r);return s===n?this:s}))})))))),{},{_destructor:function(){this.graphData({nodes:[],links:[]})}}),init:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).markerAttrs,i=void 0===n?{preset:"hiro"}:n;e.innerHTML="",t.container=document.createElement("div"),e.appendChild(t.container);var r=document.createElement("a-scene");r.setAttribute("embedded",""),r.setAttribute("vr-mode-ui","enabled: false"),r.setAttribute("arjs","debugUIEnabled: false;");var o,s=document.createElement("a-marker");Object.entries(i).forEach((function(e){var t=L4(e,2),n=t[0],i=t[1];return s.setAttribute(n,i)})),r.appendChild(s),r.appendChild(o=document.createElement("a-entity")),o.setAttribute("cursor"),o.setAttribute("raycaster","objects: [forcegraph]"),t.forcegraph=document.createElement("a-entity"),t.forcegraph.setAttribute("forcegraph",null),s.appendChild(t.forcegraph);var a=document.createElement("a-entity");a.setAttribute("camera",""),r.appendChild(a),t.container.appendChild(r)},update:function(e,t){t.hasOwnProperty("width")&&e.width&&(e.container.style.width="".concat(e.width,"px")),t.hasOwnProperty("height")&&e.height&&(e.container.style.height="".concat(e.height,"px")),t.hasOwnProperty("glScale")&&e.forcegraph.setAttribute("scale",N4(new Array(3)).map((function(){return 1/e.glScale})).join(" ")),t.hasOwnProperty("yOffset")&&e.forcegraph.setAttribute("position","0 ".concat(e.yOffset," 0"));var n=["jsonUrl","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeVisibility","nodeColor","nodeAutoColorBy","nodeOpacity","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","onNodeHover","onNodeClick","onLinkHover","onLinkClick","forceEngine","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"],i=Object.assign.apply(Object,[{}].concat(N4(Object.entries(e).filter((function(e){var i=L4(e,2),r=i[0],o=i[1];return t.hasOwnProperty(r)&&-1!==n.indexOf(r)&&void 0!==o&&null!==o})).map((function(e){var t=L4(e,2);return I4({},t[0],t[1])}))),N4(Object.entries(e.graphData).map((function(e){var t=L4(e,2);return I4({},t[0],t[1])})))));e.forcegraph.setAttribute("forcegraph",i)}});const O4=new x0.Zcv,U4=new x0.I9Y,F4=new x0.Pq0,z4=new x0.I9Y,j4=new x0.I9Y,V4=new x0.Pq0,G4=new x0.Pq0,H4=new x0.kn4,W4=new x0.Pq0,Q4=new x0.Pq0;let q4=null,X4=null;const $4=[],Y4=-1,K4=0,J4=1;class Z4 extends x0.H2z{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new x0.tBo,this.mouseButtons={LEFT:x0.kBv.PAN,MIDDLE:x0.kBv.PAN,RIGHT:x0.kBv.ROTATE},this.touches={ONE:x0.wtR.PAN},this._onPointerMove=e5.bind(this),this._onPointerDown=t5.bind(this),this._onPointerCancel=n5.bind(this),this._onContextMenu=i5.bind(this),null!==n&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();U4.x=(e.clientX-t.left)/t.width*2-1,U4.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if("touch"===e.pointerType)t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case x0.kBv.PAN:case x0.wtR.PAN:this.state=K4;break;case x0.kBv.ROTATE:case x0.wtR.ROTATE:this.state=J4;break;default:this.state=Y4}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function e5(e){const t=this.object,n=this.domElement,i=this.raycaster;if(!1!==this.enabled){if(this._updatePointer(e),i.setFromCamera(U4,t),q4)this.state===K4?i.ray.intersectPlane(O4,V4)&&q4.position.copy(V4.sub(F4).applyMatrix4(H4)):this.state===J4&&(z4.subVectors(U4,j4).multiplyScalar(this.rotateSpeed),q4.rotateOnWorldAxis(W4,z4.x),q4.rotateOnWorldAxis(Q4.normalize(),-z4.y)),this.dispatchEvent({type:"drag",object:q4}),j4.copy(U4);else if("mouse"===e.pointerType||"pen"===e.pointerType)if($4.length=0,i.setFromCamera(U4,t),i.intersectObjects(this.objects,this.recursive,$4),$4.length>0){const e=$4[0].object;O4.setFromNormalAndCoplanarPoint(t.getWorldDirection(O4.normal),G4.setFromMatrixPosition(e.matrixWorld)),X4!==e&&null!==X4&&(this.dispatchEvent({type:"hoveroff",object:X4}),n.style.cursor="auto",X4=null),X4!==e&&(this.dispatchEvent({type:"hoveron",object:e}),n.style.cursor="pointer",X4=e)}else null!==X4&&(this.dispatchEvent({type:"hoveroff",object:X4}),n.style.cursor="auto",X4=null);j4.copy(U4)}}function t5(e){const t=this.object,n=this.domElement,i=this.raycaster;!1!==this.enabled&&(this._updatePointer(e),this._updateState(e),$4.length=0,i.setFromCamera(U4,t),i.intersectObjects(this.objects,this.recursive,$4),$4.length>0&&(q4=!0===this.transformGroup?r5($4[0].object):$4[0].object,O4.setFromNormalAndCoplanarPoint(t.getWorldDirection(O4.normal),G4.setFromMatrixPosition(q4.matrixWorld)),i.ray.intersectPlane(O4,V4)&&(this.state===K4?(H4.copy(q4.parent.matrixWorld).invert(),F4.copy(V4).sub(G4.setFromMatrixPosition(q4.matrixWorld))):this.state===J4&&(W4.set(0,1,0).applyQuaternion(t.quaternion).normalize(),Q4.set(1,0,0).applyQuaternion(t.quaternion).normalize())),n.style.cursor="move",this.dispatchEvent({type:"dragstart",object:q4})),j4.copy(U4))}function n5(){!1!==this.enabled&&(q4&&(this.dispatchEvent({type:"dragend",object:q4}),q4=null),this.domElement.style.cursor=X4?"pointer":"auto",this.state=Y4)}function i5(e){!1!==this.enabled&&e.preventDefault()}function r5(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.isGroup&&(t=e),null===e.parent?t:r5(e.parent,t)}function o5(){let e=null,t=!1,n=null,i=null;function r(t,o){n(t,o),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function s5(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,o=i.byteLength,s=e.createBuffer();let a;if(e.bindBuffer(n,s),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)a=e.FLOAT;else if(i instanceof Uint16Array)a=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)a=e.SHORT;else if(i instanceof Uint32Array)a=e.UNSIGNED_INT;else if(i instanceof Int32Array)a=e.INT;else if(i instanceof Int8Array)a=e.BYTE;else if(i instanceof Uint8Array)a=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=e.UNSIGNED_BYTE}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:o}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,o=n.updateRanges;if(e.bindBuffer(i,t),0===o.length)e.bufferSubData(i,0,r);else{o.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<o.length;e++){const n=o[t],i=o[e];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++t,o[t]=i)}o.length=t+1;for(let n=0,s=o.length;n<s;n++){const t=o[n];e.bufferSubData(i,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}const a5={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},l5={common:{diffuse:{value:new x0.Q1f(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new x0.dwI},alphaMap:{value:null},alphaMapTransform:{value:new x0.dwI},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new x0.dwI}},envmap:{envMap:{value:null},envMapRotation:{value:new x0.dwI},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new x0.dwI}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new x0.dwI}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new x0.dwI},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new x0.dwI},normalScale:{value:new x0.I9Y(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new x0.dwI},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new x0.dwI}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new x0.dwI}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new x0.dwI}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new x0.Q1f(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new x0.Q1f(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new x0.dwI},alphaTest:{value:0},uvTransform:{value:new x0.dwI}},sprite:{diffuse:{value:new x0.Q1f(16777215)},opacity:{value:1},center:{value:new x0.I9Y(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new x0.dwI},alphaMap:{value:null},alphaMapTransform:{value:new x0.dwI},alphaTest:{value:0}}},c5={basic:{uniforms:(0,x0.Iit)([l5.common,l5.specularmap,l5.envmap,l5.aomap,l5.lightmap,l5.fog]),vertexShader:a5.meshbasic_vert,fragmentShader:a5.meshbasic_frag},lambert:{uniforms:(0,x0.Iit)([l5.common,l5.specularmap,l5.envmap,l5.aomap,l5.lightmap,l5.emissivemap,l5.bumpmap,l5.normalmap,l5.displacementmap,l5.fog,l5.lights,{emissive:{value:new x0.Q1f(0)}}]),vertexShader:a5.meshlambert_vert,fragmentShader:a5.meshlambert_frag},phong:{uniforms:(0,x0.Iit)([l5.common,l5.specularmap,l5.envmap,l5.aomap,l5.lightmap,l5.emissivemap,l5.bumpmap,l5.normalmap,l5.displacementmap,l5.fog,l5.lights,{emissive:{value:new x0.Q1f(0)},specular:{value:new x0.Q1f(1118481)},shininess:{value:30}}]),vertexShader:a5.meshphong_vert,fragmentShader:a5.meshphong_frag},standard:{uniforms:(0,x0.Iit)([l5.common,l5.envmap,l5.aomap,l5.lightmap,l5.emissivemap,l5.bumpmap,l5.normalmap,l5.displacementmap,l5.roughnessmap,l5.metalnessmap,l5.fog,l5.lights,{emissive:{value:new x0.Q1f(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:a5.meshphysical_vert,fragmentShader:a5.meshphysical_frag},toon:{uniforms:(0,x0.Iit)([l5.common,l5.aomap,l5.lightmap,l5.emissivemap,l5.bumpmap,l5.normalmap,l5.displacementmap,l5.gradientmap,l5.fog,l5.lights,{emissive:{value:new x0.Q1f(0)}}]),vertexShader:a5.meshtoon_vert,fragmentShader:a5.meshtoon_frag},matcap:{uniforms:(0,x0.Iit)([l5.common,l5.bumpmap,l5.normalmap,l5.displacementmap,l5.fog,{matcap:{value:null}}]),vertexShader:a5.meshmatcap_vert,fragmentShader:a5.meshmatcap_frag},points:{uniforms:(0,x0.Iit)([l5.points,l5.fog]),vertexShader:a5.points_vert,fragmentShader:a5.points_frag},dashed:{uniforms:(0,x0.Iit)([l5.common,l5.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:a5.linedashed_vert,fragmentShader:a5.linedashed_frag},depth:{uniforms:(0,x0.Iit)([l5.common,l5.displacementmap]),vertexShader:a5.depth_vert,fragmentShader:a5.depth_frag},normal:{uniforms:(0,x0.Iit)([l5.common,l5.bumpmap,l5.normalmap,l5.displacementmap,{opacity:{value:1}}]),vertexShader:a5.meshnormal_vert,fragmentShader:a5.meshnormal_frag},sprite:{uniforms:(0,x0.Iit)([l5.sprite,l5.fog]),vertexShader:a5.sprite_vert,fragmentShader:a5.sprite_frag},background:{uniforms:{uvTransform:{value:new x0.dwI},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:a5.background_vert,fragmentShader:a5.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new x0.dwI}},vertexShader:a5.backgroundCube_vert,fragmentShader:a5.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:a5.cube_vert,fragmentShader:a5.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:a5.equirect_vert,fragmentShader:a5.equirect_frag},distanceRGBA:{uniforms:(0,x0.Iit)([l5.common,l5.displacementmap,{referencePosition:{value:new x0.Pq0},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:a5.distanceRGBA_vert,fragmentShader:a5.distanceRGBA_frag},shadow:{uniforms:(0,x0.Iit)([l5.lights,l5.fog,{color:{value:new x0.Q1f(0)},opacity:{value:1}}]),vertexShader:a5.shadow_vert,fragmentShader:a5.shadow_frag}};c5.physical={uniforms:(0,x0.Iit)([c5.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new x0.dwI},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new x0.dwI},clearcoatNormalScale:{value:new x0.I9Y(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new x0.dwI},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new x0.dwI},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new x0.dwI},sheen:{value:0},sheenColor:{value:new x0.Q1f(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new x0.dwI},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new x0.dwI},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new x0.dwI},transmissionSamplerSize:{value:new x0.I9Y},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new x0.dwI},attenuationDistance:{value:0},attenuationColor:{value:new x0.Q1f(0)},specularColor:{value:new x0.Q1f(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new x0.dwI},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new x0.dwI},anisotropyVector:{value:new x0.I9Y},anisotropyMap:{value:null},anisotropyMapTransform:{value:new x0.dwI}}]),vertexShader:a5.meshphysical_vert,fragmentShader:a5.meshphysical_frag};const u5={r:0,b:0,g:0},h5=new x0.O9p,d5=new x0.kn4;function p5(e,t,n,i,r,o,s){const a=new x0.Q1f(0);let l,c,u=!0===o?0:1,h=null,d=0,p=null;function f(e){let i=!0===e.isScene?e.background:null;if(i&&i.isTexture){i=(e.backgroundBlurriness>0?n:t).get(i)}return i}function m(t,n){t.getRGB(u5,(0,x0._Ut)(e)),i.buffers.color.setClear(u5.r,u5.g,u5.b,n,s)}return{getClearColor:function(){return a},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;a.set(e),u=t,m(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(a,u)},render:function(t){let n=!1;const r=f(t);null===r?m(a,u):r&&r.isColor&&(m(r,1),n=!0);const o=e.xr.getEnvironmentBlendMode();"additive"===o?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===o&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===x0.Om)?(void 0===c&&(c=new x0.eaF(new x0.iNn(1,1,1),new x0.BKk({name:"BackgroundCubeMaterial",uniforms:(0,x0.lxW)(c5.backgroundCube.uniforms),vertexShader:c5.backgroundCube.vertexShader,fragmentShader:c5.backgroundCube.fragmentShader,side:x0.hsX,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),h5.copy(n.backgroundRotation),h5.x*=-1,h5.y*=-1,h5.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(h5.y*=-1,h5.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(d5.makeRotationFromEuler(h5)),c.material.toneMapped=x0.ppV.getTransfer(i.colorSpace)!==x0.KLL,h===i&&d===i.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new x0.eaF(new x0.bdM(2,2),new x0.BKk({name:"BackgroundMaterial",uniforms:(0,x0.lxW)(c5.background.uniforms),vertexShader:c5.background.vertexShader,fragmentShader:c5.background.fragmentShader,side:x0.hB5,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=x0.ppV.getTransfer(i.colorSpace)!==x0.KLL,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function f5(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=c(null);let o=r,s=!1;function a(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],i=[],r=[];for(let o=0;o<n;o++)t[o]=0,i[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function u(){const e=o.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const i=o.newAttributes,r=o.enabledAttributes,s=o.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function p(){const t=o.newAttributes,n=o.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,i,r,o,s,a){!0===a?e.vertexAttribIPointer(t,n,i,o,s):e.vertexAttribPointer(t,n,i,r,o,s)}function m(){g(),s=!0,o!==r&&(o=r,a(o.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const y=function(t,n,r){const o=!0===r.wireframe;let s=i[t.id];void 0===s&&(s={},i[t.id]=s);let a=s[n.id];void 0===a&&(a={},s[n.id]=a);let l=a[o];void 0===l&&(l=c(e.createVertexArray()),a[o]=l);return l}(m,l,r);o!==y&&(o=y,a(o.object)),v=function(e,t,n,i){const r=o.attributes,s=t.attributes;let a=0;const l=n.getAttributes();for(const o in l){if(l[o].location>=0){const t=r[o];let n=s[o];if(void 0===n&&("instanceMatrix"===o&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===o&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;a++}}return o.attributesNum!==a||o.index!==i}(n,m,l,g),v&&function(e,t,n,i){const r={},s=t.attributes;let a=0;const l=n.getAttributes();for(const o in l){if(l[o].location>=0){let t=s[o];void 0===t&&("instanceMatrix"===o&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===o&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[o]=n,a++}}o.attributes=r,o.attributesNum=a,o.index=i}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||s)&&(s=!1,function(n,i,r,o){u();const s=o.attributes,a=r.getAttributes(),l=i.defaultAttributeValues;for(const c in a){const i=a[c];if(i.location>=0){let r=s[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const s=r.normalized,a=r.itemSize,l=t.get(r);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||r.gpuType===x0.Yuy;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)d(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,u,s,l*p,(g+a/i.locationSize*e)*p,m)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)d(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,u,s,a*p,a/i.locationSize*e*p,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:p}}function m5(e,t,n){let i;function r(t,r,o){0!==o&&(e.drawArraysInstanced(i,t,r,o),n.update(r,i,o))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,o);let s=0;for(let t=0;t<o;t++)s+=r[t];n.update(s,i,1)},this.renderMultiDrawInstances=function(e,o,s,a){if(0===s)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],o[t],a[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,o,0,a,0,s);let t=0;for(let e=0;e<s;e++)t+=o[e]*a[e];n.update(t,i,1)}}}function g5(e,t,n,i){let r;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const a=o(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:o,textureFormatReadable:function(t){return t===x0.GWd||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===x0.ix0&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==x0.OUM&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==x0.RQf&&!r)},precision:s,logarithmicDepthBuffer:l,reverseDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function v5(e){const t=this;let n=null,i=0,r=!1,o=!1;const s=new x0.Zcv,a=new x0.dwI,l={value:null,needsUpdate:!1};function c(e,n,i,r){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==r||null===c){const t=i+4*o,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==o;++n,l+=4)s.copy(e[n]).applyMatrix4(r,a),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,a,u){const h=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===h||0===h.length||o&&!p)o?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=o?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,a,t,u);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function y5(e){let t=new WeakMap;function n(e,t){return t===x0.wfO?e.mapping=x0.hy7:t===x0.uV5&&(e.mapping=x0.xFO),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping;if(o===x0.wfO||o===x0.uV5){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const o=r.image;if(o&&o.height>0){const s=new x0.o6l(o.height);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}const A5=[.125,.215,.35,.446,.526,.582],x5=20,b5=new x0.qUd,_5=new x0.Q1f;let w5=null,E5=0,S5=0,C5=!1;const M5=(1+Math.sqrt(5))/2,T5=1/M5,R5=[new x0.Pq0(-M5,T5,0),new x0.Pq0(M5,T5,0),new x0.Pq0(-T5,0,M5),new x0.Pq0(T5,0,M5),new x0.Pq0(0,M5,-T5),new x0.Pq0(0,M5,T5),new x0.Pq0(-1,1,-1),new x0.Pq0(1,1,-1),new x0.Pq0(-1,1,1),new x0.Pq0(1,1,1)],I5=new x0.Pq0;class P5{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:o=256,position:s=I5}=r;w5=this._renderer.getRenderTarget(),E5=this._renderer.getActiveCubeFace(),S5=this._renderer.getActiveMipmapLevel(),C5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,i,a,s),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=D5(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=N5(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(w5,E5,S5),this._renderer.xr.enabled=C5,e.scissorTest=!1,L5(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===x0.hy7||e.mapping===x0.xFO?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),w5=this._renderer.getRenderTarget(),E5=this._renderer.getActiveCubeFace(),S5=this._renderer.getActiveMipmapLevel(),C5=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:x0.k6q,minFilter:x0.k6q,generateMipmaps:!1,type:x0.ix0,format:x0.GWd,colorSpace:x0.Zr2,depthBuffer:!1},i=B5(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=B5(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const o=e-4+1+A5.length;for(let s=0;s<o;s++){const o=Math.pow(2,r);n.push(o);let a=1/o;s>e-4?a=A5[s-e+4-1]:0===s&&(a=0),i.push(a);const l=1/(o-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),A=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(i,f*p*e),y.set(h,m*p*e);const r=[e,e,e,e,e,e];A.set(r,g*p*e)}const x=new x0.LoY;x.setAttribute("position",new x0.THS(v,f)),x.setAttribute("uv",new x0.THS(y,m)),x.setAttribute("faceIndex",new x0.THS(A,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(x5),r=new x0.Pq0(0,1,0),o=new x0.BKk({name:"SphericalGaussianBlur",defines:{n:x5,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:k5(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:x0.XIg,depthTest:!1,depthWrite:!1});return o}(i,e,t)}return i}_compileMaterial(e){const t=new x0.eaF(this._lodPlanes[0],e);this._renderer.compile(t,b5)}_sceneToCubeUV(e,t,n,i,r){const o=new x0.ubm(90,1,t,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(_5),l.toneMapping=x0.y_p,l.autoClear=!1;const h=new x0.V9B({name:"PMREM.Background",side:x0.hsX,depthWrite:!1,depthTest:!1}),d=new x0.eaF(new x0.iNn,h);let p=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,p=!0):(h.color.copy(_5),p=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(o.up.set(0,s[m],0),o.position.set(r.x,r.y,r.z),o.lookAt(r.x+a[m],r.y,r.z)):1===t?(o.up.set(0,0,s[m]),o.position.set(r.x,r.y,r.z),o.lookAt(r.x,r.y+a[m],r.z)):(o.up.set(0,s[m],0),o.position.set(r.x,r.y,r.z),o.lookAt(r.x,r.y,r.z+a[m]));const n=this._cubeSize;L5(i,t*n,m>2?n:0,n,n),l.setRenderTarget(i),p&&l.render(d,o),l.render(e,o)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=u,l.autoClear=c,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===x0.hy7||e.mapping===x0.xFO;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=D5()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=N5());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new x0.eaF(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const s=this._cubeSize;L5(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(o,b5)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=R5[(i-r-1)%R5.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new x0.eaF(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):x5;f>x5&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let A=0;A<x5;++A){const e=A/p,t=Math.exp(-e*e/2);m.push(t),0===A?g+=t:A<f&&(g+=2*t)}for(let A=0;A<m.length;A++)m[A]=m[A]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];L5(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(c,b5)}}function B5(e,t,n){const i=new x0.nWS(e,t,n);return i.texture.mapping=x0.Om,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function L5(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function N5(){return new x0.BKk({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:k5(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:x0.XIg,depthTest:!1,depthWrite:!1})}function D5(){return new x0.BKk({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:k5(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:x0.XIg,depthTest:!1,depthWrite:!1})}function k5(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function O5(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const o=r.mapping,s=o===x0.wfO||o===x0.uV5,a=o===x0.hy7||o===x0.xFO;if(s||a){let o=t.get(r);const l=void 0!==o?o.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new P5(e)),o=s?n.fromEquirectangular(r,o):n.fromCubemap(r,o),o.texture.pmremVersion=r.pmremVersion,t.set(r,o),o.texture;if(void 0!==o)return o.texture;{const l=r.image;return s&&l&&l.height>0||a&&l&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)?(null===n&&(n=new P5(e)),o=s?n.fromEquirectangular(r):n.fromCubemap(r),o.texture.pmremVersion=r.pmremVersion,t.set(r,o),r.addEventListener("dispose",i),o.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function U5(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&(0,x0.mcG)("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function F5(e,t,n,i){const r={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const n in a.attributes)t.remove(a.attributes[n]);a.removeEventListener("dispose",s),delete r[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],o=e[t+2];n.push(i,r,r,o,o,i)}}else{if(void 0===r)return;{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const a=new((0,x0.AQS)(n)?x0.MW4:x0.A$4)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const r in i)t.update(i[r],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function z5(e,t,n){let i,r,o;function s(t,s,a){0!==a&&(e.drawElementsInstanced(i,s,r,t*o,a),n.update(s,i,a))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,o=e.bytesPerElement},this.render=function(t,s){e.drawElements(i,s,r,t*o),n.update(s,i,1)},this.renderInstances=s,this.renderMultiDraw=function(e,o,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,o,0,r,e,0,s);let a=0;for(let t=0;t<s;t++)a+=o[t];n.update(a,i,1)},this.renderMultiDrawInstances=function(e,a,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/o,a[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(i,a,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=a[e]*c[e];n.update(t,i,1)}}}function j5(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function V5(e,t,n){const i=new WeakMap,r=new x0.IUQ;return{update:function(o,s,a){const l=o.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(s);if(void 0===h||h.count!==u){void 0!==h&&h.texture.dispose();const d=void 0!==s.morphAttributes.position,p=void 0!==s.morphAttributes.normal,f=void 0!==s.morphAttributes.color,m=s.morphAttributes.position||[],g=s.morphAttributes.normal||[],v=s.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let A=s.attributes.position.count*y,x=1;A>t.maxTextureSize&&(x=Math.ceil(A/t.maxTextureSize),A=t.maxTextureSize);const b=new Float32Array(A*x*4*u),_=new x0.rFo(b,A,x,u);_.type=x0.RQf,_.needsUpdate=!0;const w=4*y;for(let S=0;S<u;S++){const C=m[S],M=g[S],T=v[S],R=A*x*4*S;for(let I=0;I<C.count;I++){const P=I*w;!0===d&&(r.fromBufferAttribute(C,I),b[R+P+0]=r.x,b[R+P+1]=r.y,b[R+P+2]=r.z,b[R+P+3]=0),!0===p&&(r.fromBufferAttribute(M,I),b[R+P+4]=r.x,b[R+P+5]=r.y,b[R+P+6]=r.z,b[R+P+7]=0),!0===f&&(r.fromBufferAttribute(T,I),b[R+P+8]=r.x,b[R+P+9]=r.y,b[R+P+10]=r.z,b[R+P+11]=4===T.itemSize?r.w:1)}}function E(){_.dispose(),i.delete(s),s.removeEventListener("dispose",E)}h={count:u,texture:_,size:new x0.I9Y(A,x)},i.set(s,h),s.addEventListener("dispose",E)}if(!0===o.isInstancedMesh&&null!==o.morphTexture)a.getUniforms().setValue(e,"morphTexture",o.morphTexture,n);else{let B=0;for(let N=0;N<l.length;N++)B+=l[N];const L=s.morphTargetsRelative?1:1-B;a.getUniforms().setValue(e,"morphTargetBaseInfluence",L),a.getUniforms().setValue(e,"morphTargetInfluences",l)}a.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),a.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function G5(e,t,n,i){let r=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const a=i.render.frame,l=s.geometry,c=t.get(s,l);if(r.get(c)!==a&&(t.update(c),r.set(c,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),r.get(s)!==a&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,a))),s.isSkinnedMesh){const e=s.skeleton;r.get(e)!==a&&(e.update(),r.set(e,a))}return c},dispose:function(){r=new WeakMap}}}const H5=new x0.gPd,W5=new x0.VCu(1,1),Q5=new x0.rFo,q5=new x0.dYF,X5=new x0.b4q,$5=[],Y5=[],K5=new Float32Array(16),J5=new Float32Array(9),Z5=new Float32Array(4);function e6(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let o=$5[r];if(void 0===o&&(o=new Float32Array(r),$5[r]=o),0!==t){i.toArray(o,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(o,r)}return o}function t6(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function n6(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function i6(e,t){let n=Y5[t];void 0===n&&(n=new Int32Array(t),Y5[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function r6(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function o6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(t6(n,t))return;e.uniform2fv(this.addr,t),n6(n,t)}}function s6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(t6(n,t))return;e.uniform3fv(this.addr,t),n6(n,t)}}function a6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(t6(n,t))return;e.uniform4fv(this.addr,t),n6(n,t)}}function l6(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(t6(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),n6(n,t)}else{if(t6(n,i))return;Z5.set(i),e.uniformMatrix2fv(this.addr,!1,Z5),n6(n,i)}}function c6(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(t6(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),n6(n,t)}else{if(t6(n,i))return;J5.set(i),e.uniformMatrix3fv(this.addr,!1,J5),n6(n,i)}}function u6(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(t6(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),n6(n,t)}else{if(t6(n,i))return;K5.set(i),e.uniformMatrix4fv(this.addr,!1,K5),n6(n,i)}}function h6(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function d6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(t6(n,t))return;e.uniform2iv(this.addr,t),n6(n,t)}}function p6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(t6(n,t))return;e.uniform3iv(this.addr,t),n6(n,t)}}function f6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(t6(n,t))return;e.uniform4iv(this.addr,t),n6(n,t)}}function m6(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function g6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(t6(n,t))return;e.uniform2uiv(this.addr,t),n6(n,t)}}function v6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(t6(n,t))return;e.uniform3uiv(this.addr,t),n6(n,t)}}function y6(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(t6(n,t))return;e.uniform4uiv(this.addr,t),n6(n,t)}}function A6(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let o;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(W5.compareFunction=x0.TiK,o=W5):o=H5,n.setTexture2D(t||o,r)}function x6(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||q5,r)}function b6(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||X5,r)}function _6(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Q5,r)}function w6(e,t){e.uniform1fv(this.addr,t)}function E6(e,t){const n=e6(t,this.size,2);e.uniform2fv(this.addr,n)}function S6(e,t){const n=e6(t,this.size,3);e.uniform3fv(this.addr,n)}function C6(e,t){const n=e6(t,this.size,4);e.uniform4fv(this.addr,n)}function M6(e,t){const n=e6(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function T6(e,t){const n=e6(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function R6(e,t){const n=e6(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function I6(e,t){e.uniform1iv(this.addr,t)}function P6(e,t){e.uniform2iv(this.addr,t)}function B6(e,t){e.uniform3iv(this.addr,t)}function L6(e,t){e.uniform4iv(this.addr,t)}function N6(e,t){e.uniform1uiv(this.addr,t)}function D6(e,t){e.uniform2uiv(this.addr,t)}function k6(e,t){e.uniform3uiv(this.addr,t)}function O6(e,t){e.uniform4uiv(this.addr,t)}function U6(e,t,n){const i=this.cache,r=t.length,o=i6(n,r);t6(i,o)||(e.uniform1iv(this.addr,o),n6(i,o));for(let s=0;s!==r;++s)n.setTexture2D(t[s]||H5,o[s])}function F6(e,t,n){const i=this.cache,r=t.length,o=i6(n,r);t6(i,o)||(e.uniform1iv(this.addr,o),n6(i,o));for(let s=0;s!==r;++s)n.setTexture3D(t[s]||q5,o[s])}function z6(e,t,n){const i=this.cache,r=t.length,o=i6(n,r);t6(i,o)||(e.uniform1iv(this.addr,o),n6(i,o));for(let s=0;s!==r;++s)n.setTextureCube(t[s]||X5,o[s])}function j6(e,t,n){const i=this.cache,r=t.length,o=i6(n,r);t6(i,o)||(e.uniform1iv(this.addr,o),n6(i,o));for(let s=0;s!==r;++s)n.setTexture2DArray(t[s]||Q5,o[s])}class V6{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return r6;case 35664:return o6;case 35665:return s6;case 35666:return a6;case 35674:return l6;case 35675:return c6;case 35676:return u6;case 5124:case 35670:return h6;case 35667:case 35671:return d6;case 35668:case 35672:return p6;case 35669:case 35673:return f6;case 5125:return m6;case 36294:return g6;case 36295:return v6;case 36296:return y6;case 35678:case 36198:case 36298:case 36306:case 35682:return A6;case 35679:case 36299:case 36307:return x6;case 35680:case 36300:case 36308:case 36293:return b6;case 36289:case 36303:case 36311:case 36292:return _6}}(t.type)}}class G6{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return w6;case 35664:return E6;case 35665:return S6;case 35666:return C6;case 35674:return M6;case 35675:return T6;case 35676:return R6;case 5124:case 35670:return I6;case 35667:case 35671:return P6;case 35668:case 35672:return B6;case 35669:case 35673:return L6;case 5125:return N6;case 36294:return D6;case 36295:return k6;case 36296:return O6;case 35678:case 36198:case 36298:case 36306:case 35682:return U6;case 35679:case 36299:case 36307:return F6;case 35680:case 36300:case 36308:case 36293:return z6;case 36289:case 36303:case 36311:case 36292:return j6}}(t.type)}}class H6{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const o=i[r];o.setValue(e,t[o.id],n)}}}const W6=/(\w+)(\])?(\[|\.)?/g;function Q6(e,t){e.seq.push(t),e.map[t.id]=t}function q6(e,t,n){const i=e.name,r=i.length;for(W6.lastIndex=0;;){const o=W6.exec(i),s=W6.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===r){Q6(n,void 0===c?new V6(a,e,t):new G6(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new H6(a),Q6(n,e)),n=e}}}class X6{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);q6(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function $6(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let Y6=0;const K6=new x0.dwI;function J6(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let s=r;s<o;s++){const e=s+1;i.push(`${e===t?">":" "} ${e}: ${n[s]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function Z6(e,t){const n=function(e){x0.ppV._getMatrix(K6,x0.ppV.workingColorSpace,e);const t=`mat3( ${K6.elements.map((e=>e.toFixed(4)))} )`;switch(x0.ppV.getTransfer(e)){case x0.VxR:return[t,"LinearTransferOETF"];case x0.KLL:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function e8(e,t){let n;switch(t){case x0.kyO:n="Linear";break;case x0.Mjd:n="Reinhard";break;case x0.nNL:n="Cineon";break;case x0.FV:n="ACESFilmic";break;case x0.LAk:n="AgX";break;case x0.aJ8:n="Neutral";break;case x0.g7M:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const t8=new x0.Pq0;function n8(){x0.ppV.getLuminanceCoefficients(t8);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${t8.x.toFixed(4)}, ${t8.y.toFixed(4)}, ${t8.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function i8(e){return""!==e}function r8(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function o8(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const s8=/^[ \t]*#include +<([\w\d./]+)>/gm;function a8(e){return e.replace(s8,c8)}const l8=new Map;function c8(e,t){let n=a5[t];if(void 0===n){const e=l8.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=a5[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return a8(n)}const u8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function h8(e){return e.replace(u8,d8)}function d8(e,t,n,i){let r="";for(let o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function p8(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function f8(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===x0.QP0?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===x0.Wk7?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===x0.RyA&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case x0.hy7:case x0.xFO:t="ENVMAP_TYPE_CUBE";break;case x0.Om:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===x0.xFO&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case x0.caT:t="ENVMAP_BLENDING_MULTIPLY";break;case x0.KRh:t="ENVMAP_BLENDING_MIX";break;case x0.XrR:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(i8).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(o),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(i8).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(i8).join("\n"),v.length>0&&(v+="\n")):(g=[p8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(i8).join("\n"),v=[p8(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==x0.y_p?"#define TONE_MAPPING":"",n.toneMapping!==x0.y_p?a5.tonemapping_pars_fragment:"",n.toneMapping!==x0.y_p?e8("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",a5.colorspace_pars_fragment,Z6("linearToOutputTexel",n.outputColorSpace),n8(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(i8).join("\n")),s=a8(s),s=r8(s,n),s=o8(s,n),a=a8(a),a=r8(a,n),a=o8(a,n),s=h8(s),a=h8(a),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===x0.Wdf?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===x0.Wdf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const A=y+g+s,x=y+v+a,b=$6(r,r.VERTEX_SHADER,A),_=$6(r,r.FRAGMENT_SHADER,x);function w(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(b).trim(),o=r.getShaderInfoLog(_).trim();let s=!0,a=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(s=!1,"function"===typeof e.debug.onShaderError)e.debug.onShaderError(r,m,b,_);else{const e=J6(r,b,"vertex"),i=J6(r,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==o||(a=!1);a&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:o,prefix:v}})}r.deleteShader(b),r.deleteShader(_),E=new X6(r,m),S=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),o=i.name;let s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(r,m)}let E,S;r.attachShader(m,b),r.attachShader(m,_),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===E&&w(this),E},this.getAttributes=function(){return void 0===S&&w(this),S};let C=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===C&&(C=r.getProgramParameter(m,37297)),C},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Y6++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=_,this}let m8=0;class g8{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(r)&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new v8(e),t.set(e,n)),n}}class v8{constructor(e){this.id=m8++,this.code=e,this.usedTimes=0}}function y8(e,t,n,i,r,o,s){const a=new x0.zgK,l=new g8,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(o,a,u,g,v){const y=g.fog,A=v.geometry,x=o.isMeshStandardMaterial?g.environment:null,b=(o.isMeshStandardMaterial?n:t).get(o.envMap||x),_=b&&b.mapping===x0.Om?b.image.height:null,w=f[o.type];null!==o.precision&&(p=r.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const E=A.morphAttributes.position||A.morphAttributes.normal||A.morphAttributes.color,S=void 0!==E?E.length:0;let C,M,T,R,I=0;if(void 0!==A.morphAttributes.position&&(I=1),void 0!==A.morphAttributes.normal&&(I=2),void 0!==A.morphAttributes.color&&(I=3),w){const e=c5[w];C=e.vertexShader,M=e.fragmentShader}else C=o.vertexShader,M=o.fragmentShader,l.update(o),T=l.getVertexShaderID(o),R=l.getFragmentShaderID(o);const P=e.getRenderTarget(),B=e.state.buffers.depth.getReversed(),L=!0===v.isInstancedMesh,N=!0===v.isBatchedMesh,D=!!o.map,k=!!o.matcap,O=!!b,U=!!o.aoMap,F=!!o.lightMap,z=!!o.bumpMap,j=!!o.normalMap,V=!!o.displacementMap,G=!!o.emissiveMap,H=!!o.metalnessMap,W=!!o.roughnessMap,Q=o.anisotropy>0,q=o.clearcoat>0,X=o.dispersion>0,$=o.iridescence>0,Y=o.sheen>0,K=o.transmission>0,J=Q&&!!o.anisotropyMap,Z=q&&!!o.clearcoatMap,ee=q&&!!o.clearcoatNormalMap,te=q&&!!o.clearcoatRoughnessMap,ne=$&&!!o.iridescenceMap,ie=$&&!!o.iridescenceThicknessMap,re=Y&&!!o.sheenColorMap,oe=Y&&!!o.sheenRoughnessMap,se=!!o.specularMap,ae=!!o.specularColorMap,le=!!o.specularIntensityMap,ce=K&&!!o.transmissionMap,ue=K&&!!o.thicknessMap,he=!!o.gradientMap,de=!!o.alphaMap,pe=o.alphaTest>0,fe=!!o.alphaHash,me=!!o.extensions;let ge=x0.y_p;o.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(ge=e.toneMapping));const ve={shaderID:w,shaderType:o.type,shaderName:o.name,vertexShader:C,fragmentShader:M,defines:o.defines,customVertexShaderID:T,customFragmentShaderID:R,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,batching:N,batchingColor:N&&null!==v._colorsTexture,instancing:L,instancingColor:L&&null!==v.instanceColor,instancingMorph:L&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===P?e.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:x0.Zr2,alphaToCoverage:!!o.alphaToCoverage,map:D,matcap:k,envMap:O,envMapMode:O&&b.mapping,envMapCubeUVHeight:_,aoMap:U,lightMap:F,bumpMap:z,normalMap:j,displacementMap:d&&V,emissiveMap:G,normalMapObjectSpace:j&&o.normalMapType===x0.vyJ,normalMapTangentSpace:j&&o.normalMapType===x0.bI3,metalnessMap:H,roughnessMap:W,anisotropy:Q,anisotropyMap:J,clearcoat:q,clearcoatMap:Z,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:X,iridescence:$,iridescenceMap:ne,iridescenceThicknessMap:ie,sheen:Y,sheenColorMap:re,sheenRoughnessMap:oe,specularMap:se,specularColorMap:ae,specularIntensityMap:le,transmission:K,transmissionMap:ce,thicknessMap:ue,gradientMap:he,opaque:!1===o.transparent&&o.blending===x0.NTi&&!1===o.alphaToCoverage,alphaMap:de,alphaTest:pe,alphaHash:fe,combine:o.combine,mapUv:D&&m(o.map.channel),aoMapUv:U&&m(o.aoMap.channel),lightMapUv:F&&m(o.lightMap.channel),bumpMapUv:z&&m(o.bumpMap.channel),normalMapUv:j&&m(o.normalMap.channel),displacementMapUv:V&&m(o.displacementMap.channel),emissiveMapUv:G&&m(o.emissiveMap.channel),metalnessMapUv:H&&m(o.metalnessMap.channel),roughnessMapUv:W&&m(o.roughnessMap.channel),anisotropyMapUv:J&&m(o.anisotropyMap.channel),clearcoatMapUv:Z&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:ee&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:oe&&m(o.sheenRoughnessMap.channel),specularMapUv:se&&m(o.specularMap.channel),specularColorMapUv:ae&&m(o.specularColorMap.channel),specularIntensityMapUv:le&&m(o.specularIntensityMap.channel),transmissionMapUv:ce&&m(o.transmissionMap.channel),thicknessMapUv:ue&&m(o.thicknessMap.channel),alphaMapUv:de&&m(o.alphaMap.channel),vertexTangents:!!A.attributes.tangent&&(j||Q),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!A.attributes.color&&4===A.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!A.attributes.uv&&(D||de),fog:!!y,useFog:!0===o.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:B,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==A.morphAttributes.position,morphNormals:void 0!==A.morphAttributes.normal,morphColors:void 0!==A.morphAttributes.color,morphTargetsCount:S,morphTextureStride:I,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:D&&!0===o.map.isVideoTexture&&x0.ppV.getTransfer(o.map.colorSpace)===x0.KLL,decodeVideoTextureEmissive:G&&!0===o.emissiveMap.isVideoTexture&&x0.ppV.getTransfer(o.emissiveMap.colorSpace)===x0.KLL,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===x0.$EB,flipSided:o.side===x0.hsX,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionClipCullDistance:me&&!0===o.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(me&&!0===o.extensions.multiDraw||N)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()};return ve.vertexUv1s=c.has(1),ve.vertexUv2s=c.has(2),ve.vertexUv3s=c.has(3),c.clear(),ve},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.supportsVertexTextures&&a.enable(0);t.instancing&&a.enable(1);t.instancingColor&&a.enable(2);t.instancingMorph&&a.enable(3);t.matcap&&a.enable(4);t.envMap&&a.enable(5);t.normalMapObjectSpace&&a.enable(6);t.normalMapTangentSpace&&a.enable(7);t.clearcoat&&a.enable(8);t.iridescence&&a.enable(9);t.alphaTest&&a.enable(10);t.vertexColors&&a.enable(11);t.vertexAlphas&&a.enable(12);t.vertexUv1s&&a.enable(13);t.vertexUv2s&&a.enable(14);t.vertexUv3s&&a.enable(15);t.vertexTangents&&a.enable(16);t.anisotropy&&a.enable(17);t.alphaHash&&a.enable(18);t.batching&&a.enable(19);t.dispersion&&a.enable(20);t.batchingColor&&a.enable(21);e.push(a.mask),a.disableAll(),t.fog&&a.enable(0);t.useFog&&a.enable(1);t.flatShading&&a.enable(2);t.logarithmicDepthBuffer&&a.enable(3);t.reverseDepthBuffer&&a.enable(4);t.skinning&&a.enable(5);t.morphTargets&&a.enable(6);t.morphNormals&&a.enable(7);t.morphColors&&a.enable(8);t.premultipliedAlpha&&a.enable(9);t.shadowMapEnabled&&a.enable(10);t.doubleSided&&a.enable(11);t.flipSided&&a.enable(12);t.useDepthPacking&&a.enable(13);t.dithering&&a.enable(14);t.transmission&&a.enable(15);t.sheen&&a.enable(16);t.opaque&&a.enable(17);t.pointsUvs&&a.enable(18);t.decodeVideoTexture&&a.enable(19);t.decodeVideoTextureEmissive&&a.enable(20);t.alphaToCoverage&&a.enable(21);e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=c5[t];n=x0.LlO.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=u.length;e<r;e++){const t=u[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new f8(e,n,t,o),u.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function A8(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function x8(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function b8(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function _8(){const e=[];let t=0;const n=[],i=[],r=[];function o(n,i,r,o,s,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:o,renderOrder:n.renderOrder,z:s,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=s,l.group=a),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?i.push(u):!0===s.transparent?r.push(u):n.push(u)},unshift:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?i.unshift(u):!0===s.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||x8),i.length>1&&i.sort(t||b8),r.length>1&&r.sort(t||b8)}}}function w8(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new _8,e.set(t,[r])):n>=i.length?(r=new _8,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function E8(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new x0.Pq0,color:new x0.Q1f};break;case"SpotLight":n={position:new x0.Pq0,direction:new x0.Pq0,color:new x0.Q1f,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new x0.Pq0,color:new x0.Q1f,distance:0,decay:0};break;case"HemisphereLight":n={direction:new x0.Pq0,skyColor:new x0.Q1f,groundColor:new x0.Q1f};break;case"RectAreaLight":n={color:new x0.Q1f,position:new x0.Pq0,halfWidth:new x0.Pq0,halfHeight:new x0.Pq0}}return e[t.id]=n,n}}}let S8=0;function C8(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function M8(e){const t=new E8,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new x0.I9Y};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new x0.I9Y,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let a=0;a<9;a++)i.probe.push(new x0.Pq0);const r=new x0.Pq0,o=new x0.kn4,s=new x0.kn4;return{setup:function(r){let o=0,s=0,a=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;r.sort(C8);for(let e=0,x=r.length;e<x;e++){const A=r[e],x=A.color,b=A.intensity,_=A.distance,w=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)o+=x.r*b,s+=x.g*b,a+=x.b*b;else if(A.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(A.sh.coefficients[e],b);y++}else if(A.isDirectionalLight){const e=t.get(A);if(e.color.copy(A.color).multiplyScalar(A.intensity),A.castShadow){const e=A.shadow,t=n.get(A);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=w,i.directionalShadowMatrix[l]=A.shadow.matrix,p++}i.directional[l]=e,l++}else if(A.isSpotLight){const e=t.get(A);e.position.setFromMatrixPosition(A.matrixWorld),e.color.copy(x).multiplyScalar(b),e.distance=_,e.coneCos=Math.cos(A.angle),e.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),e.decay=A.decay,i.spot[u]=e;const r=A.shadow;if(A.map&&(i.spotLightMap[g]=A.map,g++,r.updateMatrices(A),A.castShadow&&v++),i.spotLightMatrix[u]=r.matrix,A.castShadow){const e=n.get(A);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[u]=e,i.spotShadowMap[u]=w,m++}u++}else if(A.isRectAreaLight){const e=t.get(A);e.color.copy(x).multiplyScalar(b),e.halfWidth.set(.5*A.width,0,0),e.halfHeight.set(0,.5*A.height,0),i.rectArea[h]=e,h++}else if(A.isPointLight){const e=t.get(A);if(e.color.copy(A.color).multiplyScalar(A.intensity),e.distance=A.distance,e.decay=A.decay,A.castShadow){const e=A.shadow,t=n.get(A);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[c]=t,i.pointShadowMap[c]=w,i.pointShadowMatrix[c]=A.shadow.matrix,f++}i.point[c]=e,c++}else if(A.isHemisphereLight){const e=t.get(A);e.skyColor.copy(A.color).multiplyScalar(b),e.groundColor.copy(A.groundColor).multiplyScalar(b),i.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=l5.LTC_FLOAT_1,i.rectAreaLTC2=l5.LTC_FLOAT_2):(i.rectAreaLTC1=l5.LTC_HALF_1,i.rectAreaLTC2=l5.LTC_HALF_2)),i.ambient[0]=o,i.ambient[1]=s,i.ambient[2]=a;const A=i.hash;A.directionalLength===l&&A.pointLength===c&&A.spotLength===u&&A.rectAreaLength===h&&A.hemiLength===d&&A.numDirectionalShadows===p&&A.numPointShadows===f&&A.numSpotShadows===m&&A.numSpotMaps===g&&A.numLightProbes===y||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=y,A.directionalLength=l,A.pointLength=c,A.spotLength=u,A.rectAreaLength=h,A.hemiLength=d,A.numDirectionalShadows=p,A.numPointShadows=f,A.numSpotShadows=m,A.numSpotMaps=g,A.numLightProbes=y,i.version=S8++)},setupView:function(e,t){let n=0,a=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){const t=e[d];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(t.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=i.point[a];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),a++}else if(t.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function T8(e){const t=new M8(e),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function R8(e){let t=new WeakMap;return{get:function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=t.get(n);let o;return void 0===r?(o=new T8(e),t.set(n,[o])):i>=r.length?(o=new T8(e),r.push(o)):o=r[i],o},dispose:function(){t=new WeakMap}}}function I8(e,t,n){let i=new x0.PPD;const r=new x0.I9Y,o=new x0.I9Y,s=new x0.IUQ,a=new x0.CSG({depthPacking:x0.N5j}),l=new x0.aVO,c={},u=n.maxTextureSize,h={[x0.hB5]:x0.hsX,[x0.hsX]:x0.hB5,[x0.$EB]:x0.$EB},d=new x0.BKk({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new x0.I9Y},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new x0.LoY;f.setAttribute("position",new x0.THS(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new x0.eaF(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=x0.QP0;let v=this.type;function y(n,i){const o=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new x0.nWS(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,p,m,null)}function A(t,n,i,r){let o=null;const s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)o=s;else if(o=!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=o.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=o.clone(),i[t]=r,n.addEventListener("dispose",b)),o=r}if(o.visible=n.visible,o.wireframe=n.wireframe,r===x0.RyA?o.side=null!==n.shadowSide?n.shadowSide:n.side:o.side=null!==n.shadowSide?n.shadowSide:h[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.map=n.map,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===i.isPointLight&&!0===o.isMeshDistanceMaterial){e.properties.get(o).light=i}return o}function x(n,r,o,s,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===x0.RyA)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=A(n,h,s,a);n.onBeforeShadow(e,n,r,o,i,t,u),e.renderBufferDirect(o,null,i,t,n,u),n.onAfterShadow(e,n,r,o,i,t,u)}}}else if(l.visible){const t=A(n,l,s,a);n.onBeforeShadow(e,n,r,o,i,t,null),e.renderBufferDirect(o,null,i,t,n,null),n.onAfterShadow(e,n,r,o,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,o,s,a)}function b(e){e.target.removeEventListener("dispose",b);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(x0.XIg),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=v!==x0.RyA&&this.type===x0.RyA,f=v===x0.RyA&&this.type!==x0.RyA;for(let m=0,g=t.length;m<g;m++){const l=t[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),o.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(o.x=Math.floor(u/h.x),r.x=o.x*h.x,c.mapSize.x=o.x),r.y>u&&(o.y=Math.floor(u/h.y),r.y=o.y*h.y,c.mapSize.y=o.y)),null===c.map||!0===p||!0===f){const e=this.type!==x0.RyA?{minFilter:x0.hxR,magFilter:x0.hxR}:{};null!==c.map&&c.map.dispose(),c.map=new x0.nWS(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),c.updateMatrices(l,e),i=c.getFrustum(),x(n,a,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===x0.RyA&&y(c,a),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const P8={[x0.eHc]:x0.lGu,[x0.brA]:x0.K52,[x0.U3G]:x0.bw0,[x0.xSv]:x0.Gwm,[x0.lGu]:x0.eHc,[x0.K52]:x0.brA,[x0.bw0]:x0.U3G,[x0.Gwm]:x0.xSv};function B8(e,t){const n=new function(){let t=!1;const n=new x0.IUQ;let i=null;const r=new x0.IUQ(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,o,s,a){!0===a&&(t*=s,i*=s,o*=s),n.set(t,i,o,s),!1===r.equals(n)&&(e.clearColor(t,i,o,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,o=null,s=null;return{setReversed:function(e){if(i!==e){const e=t.get("EXT_clip_control");i?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT);const n=s;s=null,this.setClear(n)}i=e},getReversed:function(){return i},setTest:function(t){t?z(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(t){r===t||n||(e.depthMask(t),r=t)},setFunc:function(t){if(i&&(t=P8[t]),o!==t){switch(t){case x0.eHc:e.depthFunc(e.NEVER);break;case x0.lGu:e.depthFunc(e.ALWAYS);break;case x0.brA:e.depthFunc(e.LESS);break;case x0.xSv:e.depthFunc(e.LEQUAL);break;case x0.U3G:e.depthFunc(e.EQUAL);break;case x0.Gwm:e.depthFunc(e.GEQUAL);break;case x0.K52:e.depthFunc(e.GREATER);break;case x0.bw0:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}o=t}},setLocked:function(e){n=e},setClear:function(t){s!==t&&(i&&(t=1-t),e.clearDepth(t),s=t)},reset:function(){n=!1,r=null,o=null,s=null,i=!1}}},r=new function(){let t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?z(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&o===s||(e.stencilFunc(t,n,s),i=t,r=n,o=s)},setOp:function(t,n,i){s===t&&a===n&&l===i||(e.stencilOp(t,n,i),s=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,o=null,s=null,a=null,l=null,c=null}}},o=new WeakMap,s=new WeakMap;let a={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,A=null,x=new x0.Q1f(0,0,0),b=0,_=!1,w=null,E=null,S=null,C=null,M=null;const T=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,I=0;const P=e.getParameter(e.VERSION);-1!==P.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=I>=1):-1!==P.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=I>=2);let B=null,L={};const N=e.getParameter(e.SCISSOR_BOX),D=e.getParameter(e.VIEWPORT),k=(new x0.IUQ).fromArray(N),O=(new x0.IUQ).fromArray(D);function U(t,n,i,r){const o=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<i;a++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,o):e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);return s}const F={};function z(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function j(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}F[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[e.TEXTURE_2D_ARRAY]=U(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),F[e.TEXTURE_3D]=U(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),z(e.DEPTH_TEST),i.setFunc(x0.xSv),W(!1),Q(x0.Vb5),z(e.CULL_FACE),H(x0.XIg);const V={[x0.gO9]:e.FUNC_ADD,[x0.FXf]:e.FUNC_SUBTRACT,[x0.nST]:e.FUNC_REVERSE_SUBTRACT};V[x0.znC]=e.MIN,V[x0.$ei]=e.MAX;const G={[x0.ojh]:e.ZERO,[x0.qad]:e.ONE,[x0.f4X]:e.SRC_COLOR,[x0.ie2]:e.SRC_ALPHA,[x0.hgQ]:e.SRC_ALPHA_SATURATE,[x0.wn6]:e.DST_COLOR,[x0.hdd]:e.DST_ALPHA,[x0.LiQ]:e.ONE_MINUS_SRC_COLOR,[x0.OuU]:e.ONE_MINUS_SRC_ALPHA,[x0.aEY]:e.ONE_MINUS_DST_COLOR,[x0.Nt7]:e.ONE_MINUS_DST_ALPHA,[x0.RrE]:e.CONSTANT_COLOR,[x0.$Yl]:e.ONE_MINUS_CONSTANT_COLOR,[x0.e0p]:e.CONSTANT_ALPHA,[x0.ov9]:e.ONE_MINUS_CONSTANT_ALPHA};function H(t,n,i,r,o,s,a,l,c,u){if(t!==x0.XIg){if(!1===d&&(z(e.BLEND),d=!0),t===x0.bCz)o=o||n,s=s||i,a=a||r,n===f&&o===v||(e.blendEquationSeparate(V[n],V[o]),f=n,v=o),i===m&&r===g&&s===y&&a===A||(e.blendFuncSeparate(G[i],G[r],G[s],G[a]),m=i,g=r,y=s,A=a),!1!==l.equals(x)&&c===b||(e.blendColor(l.r,l.g,l.b,c),x.copy(l),b=c),p=t,_=!1;else if(t!==p||u!==_){if(f===x0.gO9&&v===x0.gO9||(e.blendEquation(e.FUNC_ADD),f=x0.gO9,v=x0.gO9),u)switch(t){case x0.NTi:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case x0.EZo:e.blendFunc(e.ONE,e.ONE);break;case x0.Kwu:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case x0.EdD:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case x0.NTi:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case x0.EZo:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case x0.Kwu:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case x0.EdD:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,A=null,x.set(0,0,0),b=0,p=t,_=u}}else!0===d&&(j(e.BLEND),d=!1)}function W(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function Q(t){t!==x0.WNZ?(z(e.CULL_FACE),t!==E&&(t===x0.Vb5?e.cullFace(e.BACK):t===x0.Jnc?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),E=t}function q(t,n,i){t?(z(e.POLYGON_OFFSET_FILL),C===n&&M===i||(e.polygonOffset(n,i),C=n,M=i)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:z,disable:j,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=u,r=!1;if(t){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const o=t.textures;if(i.length!==o.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=o.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=o.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:H,setMaterial:function(t,o){t.side===x0.$EB?j(e.CULL_FACE):z(e.CULL_FACE);let s=t.side===x0.hsX;o&&(s=!s),W(s),t.blending===x0.NTi&&!1===t.transparent?H(x0.XIg):H(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite);const a=t.stencilWrite;r.setTest(a),a&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?z(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:Q,setLineWidth:function(t){t!==S&&(R&&e.lineWidth(t),S=t)},setPolygonOffset:q,setScissorTest:function(t){t?z(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+T-1),B!==t&&(e.activeTexture(t),B=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===B?e.TEXTURE0+T-1:B);let r=L[i];void 0===r&&(r={type:void 0,texture:void 0},L[i]=r),r.type===t&&r.texture===n||(B!==i&&(e.activeTexture(i),B=i),e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=L[B];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=s.get(n).get(t);o.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),o.set(n,i))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),i.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},B=null,L={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,v=null,y=null,A=null,x=new x0.Q1f(0,0,0),b=0,_=!1,w=null,E=null,S=null,C=null,M=null,k.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),n.reset(),i.reset(),r.reset()}}}function L8(e,t,n,i,r,o,s){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new x0.I9Y,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(V){}function f(e,t){return p?new OffscreenCanvas(e,t):(0,x0.qq$)("canvas")}function m(e,t,n){let i=1;const r=j(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!==typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),o=Math.floor(i*r.height);void 0===h&&(h=f(n,o));const s=t?f(n,o):h;s.width=n,s.height=o;return s.getContext("2d").drawImage(e,0,0,n,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function A(n,i,r,o){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let a=i;if(i===e.RED&&(r===e.FLOAT&&(a=e.R32F),r===e.HALF_FLOAT&&(a=e.R16F),r===e.UNSIGNED_BYTE&&(a=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.R8UI),r===e.UNSIGNED_SHORT&&(a=e.R16UI),r===e.UNSIGNED_INT&&(a=e.R32UI),r===e.BYTE&&(a=e.R8I),r===e.SHORT&&(a=e.R16I),r===e.INT&&(a=e.R32I)),i===e.RG&&(r===e.FLOAT&&(a=e.RG32F),r===e.HALF_FLOAT&&(a=e.RG16F),r===e.UNSIGNED_BYTE&&(a=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RG8UI),r===e.UNSIGNED_SHORT&&(a=e.RG16UI),r===e.UNSIGNED_INT&&(a=e.RG32UI),r===e.BYTE&&(a=e.RG8I),r===e.SHORT&&(a=e.RG16I),r===e.INT&&(a=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RGB8UI),r===e.UNSIGNED_SHORT&&(a=e.RGB16UI),r===e.UNSIGNED_INT&&(a=e.RGB32UI),r===e.BYTE&&(a=e.RGB8I),r===e.SHORT&&(a=e.RGB16I),r===e.INT&&(a=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(a=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(a=e.RGBA16UI),r===e.UNSIGNED_INT&&(a=e.RGBA32UI),r===e.BYTE&&(a=e.RGBA8I),r===e.SHORT&&(a=e.RGBA16I),r===e.INT&&(a=e.RGBA32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(a=e.RGB9_E5),i===e.RGBA){const t=s?x0.VxR:x0.ppV.getTransfer(o);r===e.FLOAT&&(a=e.RGBA32F),r===e.HALF_FLOAT&&(a=e.RGBA16F),r===e.UNSIGNED_BYTE&&(a=t===x0.KLL?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(a=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(a=e.RGB5_A1)}return a!==e.R16F&&a!==e.R32F&&a!==e.RG16F&&a!==e.RG32F&&a!==e.RGBA16F&&a!==e.RGBA32F||t.get("EXT_color_buffer_float"),a}function x(t,n){let i;return t?null===n||n===x0.bkx||n===x0.V3x?i=e.DEPTH24_STENCIL8:n===x0.RQf?i=e.DEPTH32F_STENCIL8:n===x0.cHt&&(i=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===x0.bkx||n===x0.V3x?i=e.DEPTH_COMPONENT24:n===x0.RQf?i=e.DEPTH_COMPONENT32F:n===x0.cHt&&(i=e.DEPTH_COMPONENT16),i}function b(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==x0.hxR&&e.minFilter!==x0.k6q?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function _(e){const t=e.target;t.removeEventListener("dispose",_),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=d.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&E(e),0===Object.keys(r).length&&d.delete(n)}i.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=i.get(t);t.depthTexture&&(t.depthTexture.dispose(),i.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let o=0,a=r.length;o<a;o++){const t=i.get(r[o]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),i.remove(r[o])}i.remove(t)}(n)}function E(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete d.get(r)[n.__cacheKey],s.memory.textures--}let S=0;function C(t,r){const o=i.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void B(o,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+r)}const M={[x0.GJx]:e.REPEAT,[x0.ghU]:e.CLAMP_TO_EDGE,[x0.kTW]:e.MIRRORED_REPEAT},T={[x0.hxR]:e.NEAREST,[x0.pHI]:e.NEAREST_MIPMAP_NEAREST,[x0.Cfg]:e.NEAREST_MIPMAP_LINEAR,[x0.k6q]:e.LINEAR,[x0.kRr]:e.LINEAR_MIPMAP_NEAREST,[x0.$_I]:e.LINEAR_MIPMAP_LINEAR},R={[x0.amv]:e.NEVER,[x0.FFZ]:e.ALWAYS,[x0.vim]:e.LESS,[x0.TiK]:e.LEQUAL,[x0.kO0]:e.EQUAL,[x0.gWB]:e.GEQUAL,[x0.eoi]:e.GREATER,[x0.jzd]:e.NOTEQUAL};function I(n,o){if(o.type!==x0.RQf||!1!==t.has("OES_texture_float_linear")||o.magFilter!==x0.k6q&&o.magFilter!==x0.kRr&&o.magFilter!==x0.Cfg&&o.magFilter!==x0.$_I&&o.minFilter!==x0.k6q&&o.minFilter!==x0.kRr&&o.minFilter!==x0.Cfg&&o.minFilter!==x0.$_I||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,M[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,M[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,M[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,T[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,T[o.minFilter]),o.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(o.magFilter===x0.hxR)return;if(o.minFilter!==x0.Cfg&&o.minFilter!==x0.$_I)return;if(o.type===x0.RQf&&!1===t.has("OES_texture_float_linear"))return;if(o.anisotropy>1||i.get(o).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy}}}function P(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_));const r=n.source;let o=d.get(r);void 0===o&&(o={},d.set(r,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),o[a].usedTimes++;const r=o[t.__cacheKey];void 0!==r&&(o[t.__cacheKey].usedTimes--,0===r.usedTimes&&E(n)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return i}function B(t,s,a){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const c=P(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+a);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+a);const t=x0.ppV.getPrimaries(x0.ppV.workingColorSpace),i=s.colorSpace===x0.jf0?null:x0.ppV.getPrimaries(s.colorSpace),d=s.colorSpace===x0.jf0||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(s.image,!1,r.maxTextureSize);p=z(s,p);const f=o.convert(s.format,s.colorSpace),y=o.convert(s.type);let _,w=A(s.internalFormat,f,y,s.colorSpace,s.isVideoTexture);I(l,s);const E=s.mipmaps,S=!0!==s.isVideoTexture,C=void 0===h.__version||!0===c,M=u.dataReady,T=b(s,p);if(s.isDepthTexture)w=x(s.format===x0.dcC,s.type),C&&(S?n.texStorage2D(e.TEXTURE_2D,1,w,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,w,p.width,p.height,0,f,y,null));else if(s.isDataTexture)if(E.length>0){S&&C&&n.texStorage2D(e.TEXTURE_2D,T,w,E[0].width,E[0].height);for(let t=0,i=E.length;t<i;t++)_=E[t],S?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,_.width,_.height,f,y,_.data):n.texImage2D(e.TEXTURE_2D,t,w,_.width,_.height,0,f,y,_.data);s.generateMipmaps=!1}else S?(C&&n.texStorage2D(e.TEXTURE_2D,T,w,p.width,p.height),M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,y,p.data)):n.texImage2D(e.TEXTURE_2D,0,w,p.width,p.height,0,f,y,p.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){S&&C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,w,E[0].width,E[0].height,p.depth);for(let t=0,i=E.length;t<i;t++)if(_=E[t],s.format!==x0.GWd)if(null!==f)if(S){if(M)if(s.layerUpdates.size>0){const i=(0,x0.Nex)(_.width,_.height,s.format,s.type);for(const r of s.layerUpdates){const o=_.data.subarray(r*i/_.data.BYTES_PER_ELEMENT,(r+1)*i/_.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,_.width,_.height,1,f,o)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,_.width,_.height,p.depth,f,_.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,w,_.width,_.height,p.depth,0,_.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else S?M&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,_.width,_.height,p.depth,f,y,_.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,w,_.width,_.height,p.depth,0,f,y,_.data)}else{S&&C&&n.texStorage2D(e.TEXTURE_2D,T,w,E[0].width,E[0].height);for(let t=0,i=E.length;t<i;t++)_=E[t],s.format!==x0.GWd?null!==f?S?M&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,_.width,_.height,f,_.data):n.compressedTexImage2D(e.TEXTURE_2D,t,w,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):S?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,_.width,_.height,f,y,_.data):n.texImage2D(e.TEXTURE_2D,t,w,_.width,_.height,0,f,y,_.data)}else if(s.isDataArrayTexture)if(S){if(C&&n.texStorage3D(e.TEXTURE_2D_ARRAY,T,w,p.width,p.height,p.depth),M)if(s.layerUpdates.size>0){const t=(0,x0.Nex)(p.width,p.height,s.format,s.type);for(const i of s.layerUpdates){const r=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,y,r)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,w,p.width,p.height,p.depth,0,f,y,p.data);else if(s.isData3DTexture)S?(C&&n.texStorage3D(e.TEXTURE_3D,T,w,p.width,p.height,p.depth),M&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)):n.texImage3D(e.TEXTURE_3D,0,w,p.width,p.height,p.depth,0,f,y,p.data);else if(s.isFramebufferTexture){if(C)if(S)n.texStorage2D(e.TEXTURE_2D,T,w,p.width,p.height);else{let t=p.width,i=p.height;for(let r=0;r<T;r++)n.texImage2D(e.TEXTURE_2D,r,w,t,i,0,f,y,null),t>>=1,i>>=1}}else if(E.length>0){if(S&&C){const t=j(E[0]);n.texStorage2D(e.TEXTURE_2D,T,w,t.width,t.height)}for(let t=0,i=E.length;t<i;t++)_=E[t],S?M&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,y,_):n.texImage2D(e.TEXTURE_2D,t,w,f,y,_);s.generateMipmaps=!1}else if(S){if(C){const t=j(p);n.texStorage2D(e.TEXTURE_2D,T,w,t.width,t.height)}M&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,y,p)}else n.texImage2D(e.TEXTURE_2D,0,w,f,y,p);g(s)&&v(l),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function L(t,r,s,l,c,u){const h=o.convert(s.format,s.colorSpace),d=o.convert(s.type),p=A(s.internalFormat,h,d,s.colorSpace),f=i.get(r),m=i.get(s);if(m.__renderTarget=r,!f.__hasExternalTextures){const t=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,i,r.depth,0,h,d,null):n.texImage2D(c,u,p,t,i,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),F(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,m.__webglTexture,0,U(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function N(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const r=n.depthTexture,o=r&&r.isDepthTexture?r.type:null,s=x(n.stencilBuffer,o),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=U(n);F(n)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,s,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const s=t[r],l=o.convert(s.format,s.colorSpace),c=o.convert(s.type),u=A(s.internalFormat,l,c,s.colorSpace),h=U(n);i&&!1===F(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):F(n)?a.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t){const r=i.get(t),o=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const o=i.get(r.depthTexture);o.__renderTarget=r,o.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),C(r.depthTexture,0);const s=o.__webglTexture,l=U(r);if(r.depthTexture.format===x0.zdS)F(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==x0.dcC)throw new Error("Unknown depthTexture format");F(r)?a.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,t)}else if(o){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=e.createRenderbuffer(),N(r.__webglDepthbuffer[i],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,o=r.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,o),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,o)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),N(r.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}n.bindFramebuffer(e.FRAMEBUFFER,null)}const k=[],O=[];function U(e){return Math.min(r.maxSamples,e.samples)}function F(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function z(e,t){const n=e.colorSpace,i=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==x0.Zr2&&n!==x0.jf0&&(x0.ppV.getTransfer(n)===x0.KLL?i===x0.GWd&&r===x0.OUM||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function j(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!==typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=S;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=C,this.setTexture2DArray=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?B(o,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?B(o,t,r):n.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,s,a){if(6!==s.image.length)return;const l=P(t,s),c=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+a);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+a);const t=x0.ppV.getPrimaries(x0.ppV.workingColorSpace),i=s.colorSpace===x0.jf0?null:x0.ppV.getPrimaries(s.colorSpace),h=s.colorSpace===x0.jf0||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=s.isCompressedTexture||s.image[0].isCompressedTexture,p=s.image[0]&&s.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=d||p?p?s.image[e].image:s.image[e]:m(s.image[e],!0,r.maxCubemapSize),f[e]=z(s,f[e]);const y=f[0],x=o.convert(s.format,s.colorSpace),_=o.convert(s.type),w=A(s.internalFormat,x,_,s.colorSpace),E=!0!==s.isVideoTexture,S=void 0===u.__version||!0===l,C=c.dataReady;let M,T=b(s,y);if(I(e.TEXTURE_CUBE_MAP,s),d){E&&S&&n.texStorage2D(e.TEXTURE_CUBE_MAP,T,w,y.width,y.height);for(let t=0;t<6;t++){M=f[t].mipmaps;for(let i=0;i<M.length;i++){const r=M[i];s.format!==x0.GWd?null!==x?E?C&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,x,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,w,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):E?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,x,_,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,w,r.width,r.height,0,x,_,r.data)}}}else{if(M=s.mipmaps,E&&S){M.length>0&&T++;const t=j(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,T,w,t.width,t.height)}for(let t=0;t<6;t++)if(p){E?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,x,_,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,w,f[t].width,f[t].height,0,x,_,f[t].data);for(let i=0;i<M.length;i++){const r=M[i].image[t].image;E?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,x,_,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,w,r.width,r.height,0,x,_,r.data)}}else{E?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,_,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,w,x,_,f[t]);for(let i=0;i<M.length;i++){const r=M[i];E?C&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,x,_,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,w,x,_,r.image[t])}}}g(s)&&v(e.TEXTURE_CUBE_MAP),u.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(a,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,r){const o=i.get(t);void 0!==n&&L(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&D(t)},this.setupRenderTarget=function(t){const r=t.texture,a=i.get(t),l=i.get(r);t.addEventListener("dispose",w);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,s.memory.textures++),u){a.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)a.__webglFramebuffer[t][n]=e.createFramebuffer()}else a.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){a.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)a.__webglFramebuffer[t]=e.createFramebuffer()}else a.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=i.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===F(t)){a.__webglMultisampledFramebuffer=e.createFramebuffer(),a.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];a.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,a.__webglColorRenderbuffer[n]);const r=o.convert(i.format,i.colorSpace),s=o.convert(i.type),l=A(i.internalFormat,r,s,i.colorSpace,!0===t.isXRRenderTarget),u=U(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,a.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(a.__webglDepthRenderbuffer=e.createRenderbuffer(),N(a.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),I(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)L(a.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else L(a.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,o=c.length;r<o;r++){const o=c[r],s=i.get(o);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),I(e.TEXTURE_2D,o),L(a.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),g(o)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),I(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)L(a.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else L(a.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let r=0,o=t.length;r<o;r++){const o=t[r];if(g(o)){const t=y(e),r=i.get(o).__webglTexture;n.bindTexture(t,r),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===F(t)){const r=t.textures,o=t.width,s=t.height;let a=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),h=r.length>1;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,s,0,0,o,s,a,e.NEAREST),!0===l&&(k.length=0,O.length=0,k.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(k.push(c),O.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,O)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,k))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const o=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=L,this.useMultisampledRTT=F}function N8(e,t){return{convert:function(n){let i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x0.jf0;const o=x0.ppV.getTransfer(r);if(n===x0.OUM)return e.UNSIGNED_BYTE;if(n===x0.Wew)return e.UNSIGNED_SHORT_4_4_4_4;if(n===x0.gJ2)return e.UNSIGNED_SHORT_5_5_5_1;if(n===x0.Dmk)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===x0.tJf)return e.BYTE;if(n===x0.fBL)return e.SHORT;if(n===x0.cHt)return e.UNSIGNED_SHORT;if(n===x0.Yuy)return e.INT;if(n===x0.bkx)return e.UNSIGNED_INT;if(n===x0.RQf)return e.FLOAT;if(n===x0.ix0)return e.HALF_FLOAT;if(n===x0.wrO)return e.ALPHA;if(n===x0.HIg)return e.RGB;if(n===x0.GWd)return e.RGBA;if(n===x0.Kzv)return e.LUMINANCE;if(n===x0.CMB)return e.LUMINANCE_ALPHA;if(n===x0.zdS)return e.DEPTH_COMPONENT;if(n===x0.dcC)return e.DEPTH_STENCIL;if(n===x0.VT0)return e.RED;if(n===x0.ZQM)return e.RED_INTEGER;if(n===x0.paN)return e.RG;if(n===x0.TkQ)return e.RG_INTEGER;if(n===x0.c90)return e.RGBA_INTEGER;if(n===x0.IE4||n===x0.Nz6||n===x0.jR7||n===x0.BXX)if(o===x0.KLL){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===x0.IE4)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===x0.Nz6)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===x0.jR7)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===x0.BXX)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===x0.IE4)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===x0.Nz6)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===x0.jR7)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===x0.BXX)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===x0.k6Q||n===x0.kTp||n===x0.HXV||n===x0.pBf){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===x0.k6Q)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===x0.kTp)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===x0.HXV)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===x0.pBf)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===x0.CVz||n===x0.Riy||n===x0.KDk){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===x0.CVz||n===x0.Riy)return o===x0.KLL?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===x0.KDk)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===x0.qa3||n===x0.B_h||n===x0.czI||n===x0.rSH||n===x0.Qrf||n===x0.psI||n===x0.a5J||n===x0._QJ||n===x0.uB5||n===x0.lyL||n===x0.bC7||n===x0.y3Z||n===x0.ojs||n===x0.S$4){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===x0.qa3)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===x0.B_h)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===x0.czI)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===x0.rSH)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===x0.Qrf)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===x0.psI)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===x0.a5J)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===x0._QJ)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===x0.uB5)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===x0.lyL)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===x0.bC7)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===x0.y3Z)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===x0.ojs)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===x0.S$4)return o===x0.KLL?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===x0.Fn||n===x0.H23||n===x0.W9U){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===x0.Fn)return o===x0.KLL?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===x0.H23)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===x0.W9U)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===x0.Kef||n===x0.XG_||n===x0.HO_||n===x0.CWW){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===x0.Fn)return i.COMPRESSED_RED_RGTC1_EXT;if(n===x0.XG_)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===x0.HO_)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===x0.CWW)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===x0.V3x?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class D8{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const i=new x0.gPd;e.properties.get(i).__webglTexture=t.texture,t.depthNear===n.depthNear&&t.depthFar===n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new x0.BKk({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new x0.eaF(new x0.bdM(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class k8 extends x0.Qev{constructor(e,t){super();const n=this;let i=null,r=1,o=null,s="local-floor",a=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=new D8,m=t.getContextAttributes();let g=null,v=null;const y=[],A=[],x=new x0.I9Y;let b=null;const _=new x0.ubm;_.viewport=new x0.IUQ;const w=new x0.ubm;w.viewport=new x0.IUQ;const E=[_,w],S=new x0.nZQ;let C=null,M=null;function T(e){const t=A.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||o),n.dispatchEvent({type:e.type,data:e.inputSource}))}function R(){i.removeEventListener("select",T),i.removeEventListener("selectstart",T),i.removeEventListener("selectend",T),i.removeEventListener("squeeze",T),i.removeEventListener("squeezestart",T),i.removeEventListener("squeezeend",T),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",I);for(let e=0;e<y.length;e++){const t=A[e];null!==t&&(A[e]=null,y[e].disconnect(t))}C=null,M=null,f.reset(),e.setRenderTarget(g),d=null,h=null,u=null,i=null,v=null,D.stop(),n.isPresenting=!1,e.setPixelRatio(b),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=A.indexOf(n);i>=0&&(A[i]=null,y[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=A.indexOf(n);if(-1===i){for(let e=0;e<y.length;e++){if(e>=A.length){A.push(n),i=e;break}if(null===A[e]){A[e]=n,i=e;break}}if(-1===i)break}const r=y[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new x0.R3r,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new x0.R3r,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new x0.R3r,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){g=e.getRenderTarget(),i.addEventListener("select",T),i.addEventListener("selectstart",T),i.addEventListener("selectend",T),i.addEventListener("squeeze",T),i.addEventListener("squeezestart",T),i.addEventListener("squeezeend",T),i.addEventListener("end",R),i.addEventListener("inputsourceschange",I),!0!==m.xrCompatible&&await t.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(x);if("undefined"!==typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,o=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?x0.dcC:x0.zdS,o=m.stencil?x0.V3x:x0.bkx);const a={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:r};u=new XRWebGLBinding(i,t),h=u.createProjectionLayer(a),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),v=new x0.nWS(h.textureWidth,h.textureHeight,{format:x0.GWd,type:x0.OUM,depthTexture:new x0.VCu(h.textureWidth,h.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}else{const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new x0.nWS(d.framebufferWidth,d.framebufferHeight,{format:x0.GWd,type:x0.OUM,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(a),l=null,o=await i.requestReferenceSpace(s),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const P=new x0.Pq0,B=new x0.Pq0;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),S.near=w.near=_.near=t,S.far=w.far=_.far=n,C===S.near&&M===S.far||(i.updateRenderState({depthNear:S.near,depthFar:S.far}),C=S.near,M=S.far),_.layers.mask=2|e.layers.mask,w.layers.mask=4|e.layers.mask,S.layers.mask=_.layers.mask|w.layers.mask;const r=e.parent,o=S.cameras;L(S,r);for(let i=0;i<o.length;i++)L(o[i],r);2===o.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),B.setFromMatrixPosition(n.matrixWorld);const i=P.distanceTo(B),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=i/(-u+h),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+f,n=a+f,r=d-m,o=p+(i-m),u=l*a/n*t,h=c*a/n*t;e.projectionMatrix.makePerspective(r,o,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(S,_,w):S.projectionMatrix.copy(_.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*x0.a55*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,S,r)},this.getCamera=function(){return S},this.getFoveation=function(){if(null!==h||null!==d)return a},this.setFoveation=function(e){a=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(S)};let N=null;const D=new o5;D.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||o),p=r,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==S.cameras.length&&(S.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let o=null;if(null!==d)o=d.getViewport(r);else{const t=u.getViewSubImage(h,r);o=t.viewport,0===i&&(e.setRenderTargetTextures(v,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let s=E[i];void 0===s&&(s=new x0.ubm,s.layers.enable(i),s.viewport=new x0.IUQ,E[i]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(o.x,o.y,o.width,o.height),0===i&&(S.matrix.copy(s.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),!0===n&&S.cameras.push(s)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")&&"gpu-optimized"==i.depthUsage&&u){const n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,i.renderState)}}for(let e=0;e<y.length;e++){const t=A[e],n=y[e];null!==t&&void 0!==n&&n.update(t,r,l||o)}N&&N(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}const O8=new x0.O9p,U8=new x0.kn4;function F8(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,i.side===x0.hsX&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),i.side===x0.hsX&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),o=r.envMap,s=r.envMapRotation;o&&(e.envMap.value=o,O8.copy(s),O8.x*=-1,O8.y*=-1,O8.z*=-1,o.isCubeTexture&&!1===o.isRenderTargetTexture&&(O8.y*=-1,O8.z*=-1),e.envMapRotation.value.setFromMatrix4(U8.makeRotationFromEuler(O8)),e.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,(0,x0._Ut)(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,o,s,a){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===x0.hsX&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,a)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,o,s):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function z8(e,t,n,i){let r={},o={},s=[];const a=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,o=t+"_"+n;if(void 0===i[o])return i[o]="number"===typeof r||"boolean"===typeof r?r:r.clone(),!0;{const e=i[o];if("number"===typeof r||"boolean"===typeof r){if(e!==r)return i[o]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"===typeof e||"boolean"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=s.indexOf(n.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let o=0,s=t.length;o<s;o++){const e=Array.isArray(t[o])?t[o]:[t[o]];for(let t=0,r=e.length;t<r;t++){const r=e[t],o=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=o.length;e<t;e++){const t=c(o[e]),s=n%i,a=s%t.boundary,l=s+a;n+=a,0!==l&&i-l<t.storage&&(n+=i-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=t.render.frame;o[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,s=i.length;r<s;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,o)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let o=0;o<n.length;o++){const s=n[o],a=c(s);"number"===typeof s||"boolean"===typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),o[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);s=[],r={},o={}}}}const j8=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class V8{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=j8,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}getRenderObjectData(e){let t=this.renderObjects.get(e);if(void 0===t){const{geometry:n,material:i,object:r}=e;if(t={material:this.getMaterialData(i),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:r.matrixWorld.clone()},r.center&&(t.center=r.center.clone()),r.morphTargetInfluences&&(t.morphTargetInfluences=r.morphTargetInfluences.slice()),null!==e.bundle&&(t.version=e.bundle.version),t.material.transmission>0){const{width:n,height:i}=e.context;t.bufferWidth=n,t.bufferHeight=i}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const i=e[n];t[n]={version:i.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return null!==e.renderer.nodes.modelViewMatrix||null!==e.renderer.nodes.modelNormalViewMatrix}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const i=e[n];null!==i&&void 0!==i&&("object"===typeof i&&void 0!==i.clone?!0===i.isTexture?t[n]={id:i.id,version:i.version}:t[n]=i.clone():t[n]=i)}return t}equals(e){const{object:t,material:n,geometry:i}=e,r=this.getRenderObjectData(e);if(!0!==r.worldMatrix.equals(t.matrixWorld))return r.worldMatrix.copy(t.matrixWorld),!1;const o=r.material;for(const f in o){const e=o[f],t=n[f];if(void 0!==e.equals){if(!1===e.equals(t))return e.copy(t),!1}else if(!0===t.isTexture){if(e.id!==t.id||e.version!==t.version)return e.id=t.id,e.version=t.version,!1}else if(e!==t)return o[f]=t,!1}if(o.transmission>0){const{width:t,height:n}=e.context;if(r.bufferWidth!==t||r.bufferHeight!==n)return r.bufferWidth=t,r.bufferHeight=n,!1}const s=r.geometry,a=i.attributes,l=s.attributes,c=Object.keys(l),u=Object.keys(a);if(s.id!==i.id)return s.id=i.id,!1;if(c.length!==u.length)return r.geometry.attributes=this.getAttributesData(a),!1;for(const f of c){const e=l[f],t=a[f];if(void 0===t)return delete l[f],!1;if(e.version!==t.version)return e.version=t.version,!1}const h=i.index,d=s.indexVersion,p=h?h.version:null;if(d!==p)return s.indexVersion=p,!1;if(s.drawRange.start!==i.drawRange.start||s.drawRange.count!==i.drawRange.count)return s.drawRange.start=i.drawRange.start,s.drawRange.count=i.drawRange.count,!1;if(r.morphTargetInfluences){let e=!1;for(let n=0;n<r.morphTargetInfluences.length;n++)r.morphTargetInfluences[n]!==t.morphTargetInfluences[n]&&(e=!0);if(e)return!0}return r.center&&!1===r.center.equals(t.center)?(r.center.copy(t.center),!0):(null!==e.bundle&&(r.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const i=!0===e.object.static,r=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;if(i||r)return!1;return!0!==this.equals(e)}}function G8(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=3735928559^t,i=1103547991^t;if(e instanceof Array)for(let r,o=0;o<e.length;o++)r=e[o],n=Math.imul(n^r,2654435761),i=Math.imul(i^r,1597334677);else for(let r,o=0;o<e.length;o++)r=e.charCodeAt(o),n=Math.imul(n^r,2654435761),i=Math.imul(i^r,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}const H8=e=>G8(e),W8=e=>G8(e),Q8=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return G8(t)};function q8(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=[];!0===e.isNode&&(n.push(e.id),e=e.getSelf());for(const{property:i,childNode:r}of X8(e))n.push(G8(i.slice(0,-4)),r.getCacheKey(t));return G8(n)}function X8(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function*(){for(const n in e){if(!0===n.startsWith("_"))continue;const i=e[n];if(!0===Array.isArray(i))for(let e=0;e<i.length;e++){const r=i[e];r&&(!0===r.isNode||t&&"function"===typeof r.toJSON)&&(yield{property:n,index:e,childNode:r})}else if(i&&!0===i.isNode)yield{property:n,childNode:i};else if("object"===typeof i)for(const e in i){const r=i[e];r&&(!0===r.isNode||t&&"function"===typeof r.toJSON)&&(yield{property:n,index:e,childNode:r})}}}()}const $8=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Y8=new WeakMap;function K8(e){return $8.get(e)}function J8(e){if(void 0===e||null===e)return null;const t=typeof e;return!0===e.isNode?"node":"number"===t?"float":"boolean"===t?"bool":"string"===t?"string":"function"===t?"shader":!0===e.isVector2?"vec2":!0===e.isVector3?"vec3":!0===e.isVector4?"vec4":!0===e.isMatrix2?"mat2":!0===e.isMatrix3?"mat3":!0===e.isMatrix4?"mat4":!0===e.isColor?"color":e instanceof ArrayBuffer?"ArrayBuffer":null}function Z8(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=e?e.slice(-4):void 0;return 1===n.length&&("vec2"===r?n=[n[0],n[0]]:"vec3"===r?n=[n[0],n[0],n[0]]:"vec4"===r&&(n=[n[0],n[0],n[0],n[0]])),"color"===e?new x0.Q1f(...n):"vec2"===r?new x0.I9Y(...n):"vec3"===r?new x0.Pq0(...n):"vec4"===r?new x0.IUQ(...n):"mat2"===r?new x0.k_V(...n):"mat3"===r?new x0.dwI(...n):"mat4"===r?new x0.kn4(...n):"bool"===e?n[0]||!1:"float"===e||"int"===e||"uint"===e?n[0]||0:"string"===e?n[0]||"":"ArrayBuffer"===e?n9(n[0]):null}function e9(e){let t=Y8.get(e);return void 0===t&&(t={},Y8.set(e,t)),t}function t9(e){let t="";const n=new Uint8Array(e);for(let i=0;i<n.length;i++)t+=String.fromCharCode(n[i]);return btoa(t)}function n9(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0))).buffer}const i9={VERTEX:"vertex",FRAGMENT:"fragment"},r9={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},o9={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},s9=["fragment","vertex"],a9=["setup","analyze","generate"],l9=[...s9,"compute"],c9=["x","y","z","w"];let u9=0;class h9 extends x0.Qev{static get type(){return"Node"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.nodeType=e,this.updateType=r9.NONE,this.updateBeforeType=r9.NONE,this.updateAfterType=r9.NONE,this.uuid=x0.cj9.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:u9++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,r9.FRAME)}onRenderUpdate(e){return this.onUpdate(e,r9.RENDER)}onObjectUpdate(e){return this.onUpdate(e,r9.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of X8(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e=e||this.version!==this._cacheKeyVersion,!0!==e&&null!==this._cacheKey||(this._cacheKey=Q8(q8(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const i of this.getChildren())t["node"+n++]=i;return t.outputNode||null}analyze(e){if(1===e.increaseUsage(this)){const t=e.getNodeProperties(this);for(const n of Object.values(t))n&&!0===n.isNode&&n.build(e)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.getShared(e);if(this!==n)return n.build(e,t);e.addNode(this),e.addChain(this);let i=null;const r=e.getBuildStage();if("setup"===r){this.updateReference(e);const t=e.getNodeProperties(this);if(!0!==t.initialized){t.initialized=!0;const n=this.setup(e),i=n&&!0===n.isNode;for(const r of Object.values(t))r&&!0===r.isNode&&r.build(e);i&&n.build(e),t.outputNode=n}}else if("analyze"===r)this.analyze(e);else if("generate"===r){if(1===this.generate.length){const n=this.getNodeType(e),r=e.getDataFromNode(this);i=r.snippet,void 0===i?(i=this.generate(e)||"",r.snippet=i):void 0!==r.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),i=e.format(i,n,t)}else i=this.generate(e,t)||""}return e.removeChain(this),e.addSequentialNode(this),i}getSerializeChildren(){return X8(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:i,index:r,childNode:o}of t)void 0!==r?(void 0===n[i]&&(n[i]=Number.isInteger(r)?[]:{}),n[i][r]=o.toJSON(e.meta).uuid):n[i]=o.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(void 0!==e.inputNodes){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const i=[];for(const r of e.inputNodes[n])i.push(t[r]);this[n]=i}else if("object"===typeof e.inputNodes[n]){const i={};for(const r in e.inputNodes[n]){const o=e.inputNodes[n][r];i[r]=t[o]}this[n]=i}else{const i=e.inputNodes[n];this[n]=t[i]}}}toJSON(e){const{uuid:t,type:n}=this,i=void 0===e||"string"===typeof e;i&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];function o(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(void 0===r&&(r={uuid:t,type:n,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==i&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta),i){const t=o(e.textures),n=o(e.images),i=o(e.nodes);t.length>0&&(r.textures=t),n.length>0&&(r.images=n),i.length>0&&(r.nodes=i)}return r}}class d9 extends h9{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){return`${this.node.build(e)}[ ${this.indexNode.build(e,"uint")} ]`}}class p9 extends h9{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const i of this.convertTo.split("|"))null!==n&&e.getTypeLength(t)!==e.getTypeLength(i)||(n=i);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,i=this.getNodeType(e),r=n.build(e,i);return e.format(r,i,t)}}class f9 extends h9{static get type(){return"TempNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){const n=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(void 0!==i.propertyName)return e.format(i.propertyName,n,t);if("void"!==n&&"void"!==t&&this.hasDependencies(e)){const r=super.build(e,n),o=e.getVarFromNode(this,null,n),s=e.getPropertyName(o);return e.addLineFlowCode(`${s} = ${r}`,this),i.snippet=r,i.propertyName=s,e.format(i.propertyName,n,t)}}return super.build(e,t)}}class m9 extends f9{static get type(){return"JoinNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce(((t,n)=>t+e.getTypeLength(n.getNodeType(e))),0))}generate(e,t){const n=this.getNodeType(e),i=this.nodes,r=e.getComponentType(n),o=[];for(const a of i){let t=a.build(e);const n=e.getComponentType(a.getNodeType(e));n!==r&&(t=e.format(t,n,r)),o.push(t)}const s=`${e.getType(n)}( ${o.join(", ")} )`;return e.format(s,n,t)}}const g9=c9.join("");class v9 extends h9{static get type(){return"SplitNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(c9.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,i=e.getTypeLength(n.getNodeType(e));let r=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const s=n.build(e,o);r=this.components.length===i&&this.components===g9.slice(0,this.components.length)?e.format(s,o,t):e.format(`${s}.${this.components}`,this.getNodeType(e),t)}else r=n.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class y9 extends f9{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:i}=this,r=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),s=e.getTypeFromLength(n.length,o),a=i.build(e,s),l=t.build(e,r),c=e.getTypeLength(r),u=[];for(let h=0;h<c;h++){const e=c9[h];e===n[0]?(u.push(a),h+=n.length-1):u.push(l+"."+e)}return`${e.getType(r)}( ${u.join(", ")} )`}}class A9 extends f9{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,i=this.getNodeType(e),r=n.build(e),o=e.getVarFromNode(this),s=e.getPropertyName(o);e.addLineFlowCode(s+" = "+r,this);const a=e.getTypeLength(i),l=[];let c=0;for(let u=0;u<a;u++){const e=c9[u];e===t[c]?(l.push("1.0 - "+s+"."+e),c++):l.push(s+"."+e)}return`${e.getType(i)}( ${l.join(", ")} )`}}class x9 extends h9{static get type(){return"InputNode"}constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?J8(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=J8(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=t9(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Z8(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const b9=/float|u?int/;class _9 extends x9{static get type(){return"ConstNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return b9.test(n)&&b9.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class w9 extends h9{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let E9=null;const S9=new Map;function C9(e,t){if(S9.has(e))console.warn(`Redefinition of method chaining ${e}`);else{if("function"!==typeof t)throw new Error(`Node element ${e} is not a function`);S9.set(e,t)}}const M9=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),T9=e=>M9(e).split("").sort().join(""),R9={setup(e,t){const n=t.shift();return e(e7(n),...t)},get(e,t,n){if("string"===typeof t&&void 0===e[t]){if(!0!==e.isStackNode&&"assign"===t)return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return E9.assign(n,...t),n};if(S9.has(t)){const i=S9.get(t);return e.isStackNode?function(){return n.add(i(...arguments))}:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i(n,...t)}}if("self"===t)return e;if(t.endsWith("Assign")&&S9.has(t.slice(0,t.length-6))){const i=S9.get(t.slice(0,t.length-6));return e.isStackNode?function(){return n.assign(arguments.length<=0?void 0:arguments[0],i(...arguments))}:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.assign(i(n,...t))}}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return t=M9(t),Z9(new v9(n,t));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(t))return t=T9(t.slice(3).toLowerCase()),n=>Z9(new y9(e,t,n));if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(t))return t=T9(t.slice(4).toLowerCase()),()=>Z9(new A9(Z9(e),t));if("width"===t||"height"===t||"depth"===t)return"width"===t?t="x":"height"===t?t="y":"depth"===t&&(t="z"),Z9(new v9(e,t));if(!0===/^\d+$/.test(t))return Z9(new d9(n,new _9(Number(t),"uint")));if(!0===/^get$/.test(t))return e=>Z9(new w9(n,e))}return Reflect.get(e,t,n)},set:(e,t,n,i)=>"string"!==typeof t||void 0!==e[t]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(t)&&"width"!==t&&"height"!==t&&"depth"!==t&&!0!==/^\d+$/.test(t)?Reflect.set(e,t,n,i):(i[t].assign(n),!0)},I9=new WeakMap,P9=new WeakMap,B9=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;for(const n in e)e[n]=Z9(e[n],t);return e},L9=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.length;for(let i=0;i<n;i++)e[i]=Z9(e[i],t);return e},N9=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=e=>Z9(null!==i?Object.assign(e,i):e);return null===t?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r(new e(...t7(n)))}:null!==n?(n=Z9(n),function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return r(new e(t,...t7(o),n))}):function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return r(new e(t,...t7(i)))}},D9=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Z9(new e(...t7(n)))};class k9 extends h9{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,i=e.getNodeProperties(t);if(i.onceOutput)return i.onceOutput;let r=null;if(t.layout){let i=P9.get(e.constructor);void 0===i&&(i=new WeakMap,P9.set(e.constructor,i));let o=i.get(t);void 0===o&&(o=Z9(e.buildFunctionNode(t)),i.set(t,o)),e.addInclude(o),r=Z9(o.call(n))}else{const i=t.jsFunc,o=null!==n||i.length>1?i(n||[],e):i(e);r=Z9(o)}return t.once&&(i.onceOutput=r),r}getOutputNode(e){const t=e.getNodeProperties(this);return null===t.outputNode&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class O9 extends h9{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e7(e),Z9(new k9(this,e))}setup(){return this.call()}}const U9=[!1,!0],F9=[0,1,2,3],z9=[-1,-2],j9=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],V9=new Map;for(const t of U9)V9.set(t,new _9(t));const G9=new Map;for(const t of F9)G9.set(t,new _9(t,"uint"));const H9=new Map([...G9].map((e=>new _9(e.value,"int"))));for(const t of z9)H9.set(t,new _9(t,"int"));const W9=new Map([...H9].map((e=>new _9(e.value))));for(const t of j9)W9.set(t,new _9(t));for(const t of j9)W9.set(-t,new _9(-t));const Q9={bool:V9,uint:G9,ints:H9,float:W9},q9=new Map([...V9,...W9]),X9=(e,t)=>q9.has(e)?q9.get(e):!0===e.isNode?e:new _9(e,t),$9=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];if((0===i.length||!["bool","float","int","uint"].includes(e)&&i.every((e=>"object"!==typeof e)))&&(i=[Z8(e,...i)]),1===i.length&&null!==t&&t.has(i[0]))return Z9(t.get(i[0]));if(1===i.length){const t=X9(i[0],e);return(e=>{try{return e.getNodeType()}catch(t){return}})(t)===e?Z9(t):Z9(new p9(t,e))}const o=i.map((e=>X9(e)));return Z9(new m9(o,e))}},Y9=e=>"object"===typeof e&&null!==e?e.value:e,K9=e=>void 0!==e&&null!==e?e.nodeType||e.convertTo||("string"===typeof e?e:null):null;function J9(e,t){return new Proxy(new O9(e,t),R9)}const Z9=function(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=J8(e);if("node"===n){let t=I9.get(e);return void 0===t&&(t=new Proxy(e,R9),I9.set(e,t),I9.set(t,t)),t}return null===t&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?Z9(X9(e,t)):"shader"===n?r7(e):e}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},e7=function(e){return new B9(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},t7=function(e){return new L9(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)},n7=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new N9(...t)},i7=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new D9(...t)},r7=(e,t)=>{const n=new J9(e,t),i=function(){let e;for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return e7(i),e=i[0]&&i[0].isNode?[...i]:i[0],n.call(e)};return i.shaderNode=n,i.setLayout=e=>(n.setLayout(e),i),i.once=()=>(n.once=!0,i),i};C9("toGlobal",(e=>(e.global=!0,e)));const o7=e=>{E9=e},s7=()=>E9,a7=function(){return E9.If(...arguments)};function l7(e){return E9&&E9.add(e),e}C9("append",l7);const c7=new $9("color"),u7=new $9("float",Q9.float),h7=new $9("int",Q9.ints),d7=new $9("uint",Q9.uint),p7=new $9("bool",Q9.bool),f7=new $9("vec2"),m7=new $9("ivec2"),g7=new $9("uvec2"),v7=new $9("bvec2"),y7=new $9("vec3"),A7=new $9("ivec3"),x7=new $9("uvec3"),b7=new $9("bvec3"),_7=new $9("vec4"),w7=new $9("ivec4"),E7=new $9("uvec4"),S7=new $9("bvec4"),C7=new $9("mat2"),M7=new $9("mat3"),T7=new $9("mat4");C9("toColor",c7),C9("toFloat",u7),C9("toInt",h7),C9("toUint",d7),C9("toBool",p7),C9("toVec2",f7),C9("toIVec2",m7),C9("toUVec2",g7),C9("toBVec2",v7),C9("toVec3",y7),C9("toIVec3",A7),C9("toUVec3",x7),C9("toBVec3",b7),C9("toVec4",_7),C9("toIVec4",w7),C9("toUVec4",E7),C9("toBVec4",S7),C9("toMat2",C7),C9("toMat3",M7),C9("toMat4",T7);const R7=n7(d9),I7=(e,t)=>Z9(new p9(Z9(e),t));C9("element",R7),C9("convert",I7);class P7 extends f9{static get type(){return"ArrayNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const B7=function(){let e;if(1===arguments.length){const t=arguments.length<=0?void 0:arguments[0];e=new P7(null,t.length,t)}else{e=new P7(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}return Z9(e)};C9("toArray",((e,t)=>B7(Array(t).fill(e))));class L7 extends h9{static get type(){return"UniformGroupNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const N7=e=>new L7(e),D7=function(e){return new L7(e,!0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)},k7=D7("frame"),O7=D7("render"),U7=N7("object");class F7 extends x9{static get type(){return"UniformNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isUniformNode=!0,this.name="",this.groupNode=U7}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate((t=>{const i=e(t,n);void 0!==i&&(this.value=i)}),t)}generate(e,t){const n=this.getNodeType(e),i=this.getUniformHash(e);let r=e.getNodeFromHash(i);void 0===r&&(e.setHashNode(this,i),r=this);const o=r.getInputType(e),s=e.getUniformFromNode(r,o,e.shaderStage,this.name||e.context.label),a=e.getPropertyName(s);return void 0!==e.context.label&&delete e.context.label,e.format(a,n,t)}}const z7=(e,t)=>{const n=K9(t||e),i=e&&!0===e.isNode?e.node&&e.node.value||e.value:e;return Z9(new F7(i,n))};class j7 extends h9{static get type(){return"PropertyNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.name=t,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const V7=(e,t)=>Z9(new j7(e,t)),G7=(e,t)=>Z9(new j7(e,t,!0)),H7=i7(j7,"vec4","DiffuseColor"),W7=i7(j7,"vec3","EmissiveColor"),Q7=i7(j7,"float","Roughness"),q7=i7(j7,"float","Metalness"),X7=i7(j7,"float","Clearcoat"),$7=i7(j7,"float","ClearcoatRoughness"),Y7=i7(j7,"vec3","Sheen"),K7=i7(j7,"float","SheenRoughness"),J7=i7(j7,"float","Iridescence"),Z7=i7(j7,"float","IridescenceIOR"),eee=i7(j7,"float","IridescenceThickness"),tee=i7(j7,"float","AlphaT"),nee=i7(j7,"float","Anisotropy"),iee=i7(j7,"vec3","AnisotropyT"),ree=i7(j7,"vec3","AnisotropyB"),oee=i7(j7,"color","SpecularColor"),see=i7(j7,"float","SpecularF90"),aee=i7(j7,"float","Shininess"),lee=i7(j7,"vec4","Output"),cee=i7(j7,"float","dashSize"),uee=i7(j7,"float","gapSize"),hee=i7(j7,"float","IOR"),dee=i7(j7,"float","Transmission"),pee=i7(j7,"float","Thickness"),fee=i7(j7,"float","AttenuationDistance"),mee=i7(j7,"color","AttenuationColor"),gee=i7(j7,"float","Dispersion");class vee extends f9{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return c9.join("").slice(0,n)!==t.components}return!1}generate(e,t){const{targetNode:n,sourceNode:i}=this,r=this.needsSplitAssign(e),o=n.getNodeType(e),s=n.context({assign:!0}).build(e),a=i.build(e,o),l=i.getNodeType(e),c=e.getDataFromNode(this);let u;if(!0===c.initialized)"void"!==t&&(u=s);else if(r){const i=e.getVarFromNode(this,null,o),r=e.getPropertyName(i);e.addLineFlowCode(`${r} = ${a}`,this);const l=n.node.context({assign:!0}).build(e);for(let t=0;t<n.components.length;t++){const i=n.components[t];e.addLineFlowCode(`${l}.${i} = ${r}[ ${t} ]`,this)}"void"!==t&&(u=s)}else u=`${s} = ${a}`,"void"!==t&&"void"!==l||(e.addLineFlowCode(u,this),"void"!==t&&(u=s));return c.initialized=!0,e.format(u,o,t)}}const yee=n7(vee);C9("assign",yee);class Aee extends f9{static get type(){return"FunctionCallNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,i=n.getInputs(e),r=this.parameters,o=(t,n)=>{const i=n.type;let r;return r="pointer"===i?"&"+t.build(e):t.build(e,i),r};if(Array.isArray(r))for(let s=0;s<r.length;s++)t.push(o(r[s],i[s]));else for(const s of i){const e=r[s.name];if(void 0===e)throw new Error(`FunctionCallNode: Input '${s.name}' not found in FunctionNode.`);t.push(o(e,s))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const xee=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n=n.length>1||n[0]&&!0===n[0].isNode?t7(n):e7(n[0]),Z9(new Aee(Z9(e),n))};C9("call",xee);class bee extends f9{static get type(){return"OperatorNode"}constructor(e,t,n){if(super(),(arguments.length<=3?0:arguments.length-3)>0){var i;let r=new bee(e,t,n);for(let t=0;t<(arguments.length<=3?0:arguments.length-3)-1;t++)r=new bee(e,r,t+3<3||arguments.length<=t+3?void 0:arguments[t+3]);t=r,n=(i=(arguments.length<=3?0:arguments.length-3)-1+3)<3||arguments.length<=i?void 0:arguments[i]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getNodeType(e,t){const n=this.op,i=this.aNode,r=this.bNode,o=i.getNodeType(e),s="undefined"!==typeof r?r.getNodeType(e):null;if("void"===o||"void"===s)return"void";if("%"===n)return o;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return e.getIntegerType(o);if("!"===n||"=="===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("<"===n||">"===n||"<="===n||">="===n){const n=t?e.getTypeLength(t):Math.max(e.getTypeLength(o),e.getTypeLength(s));return n>1?`bvec${n}`:"bool"}if(e.isMatrix(o)){if("float"===s)return o;if(e.isVector(s))return e.getVectorFromMatrix(o);if(e.isMatrix(s))return o}else if(e.isMatrix(s)){if("float"===o)return s;if(e.isVector(o))return e.getVectorFromMatrix(s)}return e.getTypeLength(s)>e.getTypeLength(o)?s:o}generate(e,t){const n=this.op,i=this.aNode,r=this.bNode,o=this.getNodeType(e,t);let s=null,a=null;"void"!==o?(s=i.getNodeType(e),a="undefined"!==typeof r?r.getNodeType(e):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n?e.isVector(s)?a=s:s!==a&&(s=a="float"):">>"===n||"<<"===n?(s=o,a=e.changeComponentType(a,"uint")):e.isMatrix(s)?"float"===a?a="float":e.isVector(a)?a=e.getVectorFromMatrix(s):e.isMatrix(a)||(s=a=o):s=e.isMatrix(a)?"float"===s?"float":e.isVector(s)?e.getVectorFromMatrix(a):a=o:a=o):s=a=o;const l=i.build(e,s),c="undefined"!==typeof r?r.build(e,a):null,u=e.getTypeLength(t),h=e.getFunctionOperator(n);return"void"!==t?"<"===n&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",t)}( ${l}, ${c} )`,o,t):e.format(`( ${l} < ${c} )`,o,t):"<="===n&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",t)}( ${l}, ${c} )`,o,t):e.format(`( ${l} <= ${c} )`,o,t):">"===n&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",t)}( ${l}, ${c} )`,o,t):e.format(`( ${l} > ${c} )`,o,t):">="===n&&u>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",t)}( ${l}, ${c} )`,o,t):e.format(`( ${l} >= ${c} )`,o,t):"!"===n||"~"===n?e.format(`(${n}${l})`,s,t):h?e.format(`${h}( ${l}, ${c} )`,o,t):e.isMatrix(s)&&"float"===a?e.format(`( ${c} ${n} ${l} )`,o,t):"float"===s&&e.isMatrix(a)?e.format(`${l} ${n} ${c}`,o,t):e.format(`( ${l} ${n} ${c} )`,o,t):"void"!==s?h?e.format(`${h}( ${l}, ${c} )`,o,t):e.isMatrix(s)&&"float"===a?e.format(`${c} ${n} ${l}`,o,t):e.format(`${l} ${n} ${c}`,o,t):void 0}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const _ee=n7(bee,"+"),wee=n7(bee,"-"),Eee=n7(bee,"*"),See=n7(bee,"/"),Cee=n7(bee,"%"),Mee=n7(bee,"=="),Tee=n7(bee,"!="),Ree=n7(bee,"<"),Iee=n7(bee,">"),Pee=n7(bee,"<="),Bee=n7(bee,">="),Lee=n7(bee,"&&"),Nee=n7(bee,"||"),Dee=n7(bee,"!"),kee=n7(bee,"^^"),Oee=n7(bee,"&"),Uee=n7(bee,"~"),Fee=n7(bee,"|"),zee=n7(bee,"^"),jee=n7(bee,"<<"),Vee=n7(bee,">>");C9("add",_ee),C9("sub",wee),C9("mul",Eee),C9("div",See),C9("modInt",Cee),C9("equal",Mee),C9("notEqual",Tee),C9("lessThan",Ree),C9("greaterThan",Iee),C9("lessThanEqual",Pee),C9("greaterThanEqual",Bee),C9("and",Lee),C9("or",Nee),C9("not",Dee),C9("xor",kee),C9("bitAnd",Oee),C9("bitNot",Uee),C9("bitOr",Fee),C9("bitXor",zee),C9("shiftLeft",jee),C9("shiftRight",Vee);const Gee=function(){return console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),Cee(...arguments)};C9("remainder",Gee);class Hee extends f9{static get type(){return"MathNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.method=e,this.aNode=t,this.bNode=n,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(n)?0:e.getTypeLength(n),s=e.isMatrix(i)?0:e.getTypeLength(i);return r>o&&r>s?t:o>s?n:s>r?i:t}getNodeType(e){const t=this.method;return t===Hee.LENGTH||t===Hee.DISTANCE||t===Hee.DOT?"float":t===Hee.CROSS?"vec3":t===Hee.ALL?"bool":t===Hee.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===Hee.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){let n=this.method;const i=this.getNodeType(e),r=this.getInputType(e),o=this.aNode,s=this.bNode,a=this.cNode,l=e.renderer.coordinateSystem;if(n===Hee.TRANSFORM_DIRECTION){let n=o,i=s;e.isMatrix(n.getNodeType(e))?i=_7(y7(i),0):n=_7(y7(n),0);const r=Eee(n,i).xyz;return ote(r).build(e,t)}if(n===Hee.NEGATE)return e.format("( - "+o.build(e,r)+" )",i,t);if(n===Hee.ONE_MINUS)return wee(1,o).build(e,t);if(n===Hee.RECIPROCAL)return See(1,o).build(e,t);if(n===Hee.DIFFERENCE)return pte(wee(o,s)).build(e,t);{const c=[];return n===Hee.CROSS||n===Hee.MOD?c.push(o.build(e,i),s.build(e,i)):l===x0.TdN&&n===Hee.STEP?c.push(o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":r),s.build(e,r)):l===x0.TdN&&(n===Hee.MIN||n===Hee.MAX)||n===Hee.MOD?c.push(o.build(e,r),s.build(e,1===e.getTypeLength(s.getNodeType(e))?"float":r)):n===Hee.REFRACT?c.push(o.build(e,r),s.build(e,r),a.build(e,"float")):n===Hee.MIX?c.push(o.build(e,r),s.build(e,r),a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":r)):(l===x0.i7u&&n===Hee.ATAN&&null!==s&&(n="atan2"),c.push(o.build(e,r)),null!==s&&c.push(s.build(e,r)),null!==a&&c.push(a.build(e,r))),e.format(`${e.getMethod(n,i)}( ${c.join(", ")} )`,i,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Hee.ALL="all",Hee.ANY="any",Hee.RADIANS="radians",Hee.DEGREES="degrees",Hee.EXP="exp",Hee.EXP2="exp2",Hee.LOG="log",Hee.LOG2="log2",Hee.SQRT="sqrt",Hee.INVERSE_SQRT="inversesqrt",Hee.FLOOR="floor",Hee.CEIL="ceil",Hee.NORMALIZE="normalize",Hee.FRACT="fract",Hee.SIN="sin",Hee.COS="cos",Hee.TAN="tan",Hee.ASIN="asin",Hee.ACOS="acos",Hee.ATAN="atan",Hee.ABS="abs",Hee.SIGN="sign",Hee.LENGTH="length",Hee.NEGATE="negate",Hee.ONE_MINUS="oneMinus",Hee.DFDX="dFdx",Hee.DFDY="dFdy",Hee.ROUND="round",Hee.RECIPROCAL="reciprocal",Hee.TRUNC="trunc",Hee.FWIDTH="fwidth",Hee.TRANSPOSE="transpose",Hee.BITCAST="bitcast",Hee.EQUALS="equals",Hee.MIN="min",Hee.MAX="max",Hee.MOD="mod",Hee.STEP="step",Hee.REFLECT="reflect",Hee.DISTANCE="distance",Hee.DIFFERENCE="difference",Hee.DOT="dot",Hee.CROSS="cross",Hee.POW="pow",Hee.TRANSFORM_DIRECTION="transformDirection",Hee.MIX="mix",Hee.CLAMP="clamp",Hee.REFRACT="refract",Hee.SMOOTHSTEP="smoothstep",Hee.FACEFORWARD="faceforward";const Wee=u7(1e-6),Qee=u7(Math.PI),qee=(Math.PI,n7(Hee,Hee.ALL)),Xee=n7(Hee,Hee.ANY),$ee=n7(Hee,Hee.RADIANS),Yee=n7(Hee,Hee.DEGREES),Kee=n7(Hee,Hee.EXP),Jee=n7(Hee,Hee.EXP2),Zee=n7(Hee,Hee.LOG),ete=n7(Hee,Hee.LOG2),tte=n7(Hee,Hee.SQRT),nte=n7(Hee,Hee.INVERSE_SQRT),ite=n7(Hee,Hee.FLOOR),rte=n7(Hee,Hee.CEIL),ote=n7(Hee,Hee.NORMALIZE),ste=n7(Hee,Hee.FRACT),ate=n7(Hee,Hee.SIN),lte=n7(Hee,Hee.COS),cte=n7(Hee,Hee.TAN),ute=n7(Hee,Hee.ASIN),hte=n7(Hee,Hee.ACOS),dte=n7(Hee,Hee.ATAN),pte=n7(Hee,Hee.ABS),fte=n7(Hee,Hee.SIGN),mte=n7(Hee,Hee.LENGTH),gte=n7(Hee,Hee.NEGATE),vte=n7(Hee,Hee.ONE_MINUS),yte=n7(Hee,Hee.DFDX),Ate=n7(Hee,Hee.DFDY),xte=n7(Hee,Hee.ROUND),bte=n7(Hee,Hee.RECIPROCAL),_te=n7(Hee,Hee.TRUNC),wte=n7(Hee,Hee.FWIDTH),Ete=n7(Hee,Hee.TRANSPOSE),Ste=(Hee.BITCAST,n7(Hee,Hee.EQUALS)),Cte=n7(Hee,Hee.MIN),Mte=n7(Hee,Hee.MAX),Tte=n7(Hee,Hee.MOD),Rte=n7(Hee,Hee.STEP),Ite=n7(Hee,Hee.REFLECT),Pte=n7(Hee,Hee.DISTANCE),Bte=n7(Hee,Hee.DIFFERENCE),Lte=n7(Hee,Hee.DOT),Nte=n7(Hee,Hee.CROSS),Dte=n7(Hee,Hee.POW),kte=n7(Hee,Hee.POW,2),Ote=n7(Hee,Hee.POW,3),Ute=n7(Hee,Hee.POW,4),Fte=n7(Hee,Hee.TRANSFORM_DIRECTION),zte=e=>Eee(fte(e),Dte(pte(e),1/3)),jte=e=>Lte(e,e),Vte=n7(Hee,Hee.MIX),Gte=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Z9(new Hee(Hee.CLAMP,Z9(e),Z9(t),Z9(n)))},Hte=e=>Gte(e),Wte=n7(Hee,Hee.REFRACT),Qte=n7(Hee,Hee.SMOOTHSTEP),qte=n7(Hee,Hee.FACEFORWARD),Xte=r7((e=>{let[t]=e;const n=Lte(t.xy,f7(12.9898,78.233)),i=Tte(n,Qee);return ste(ate(i).mul(43758.5453))})),$te=(e,t,n)=>Vte(t,n,e),Yte=(e,t,n)=>Qte(t,n,e),Kte=(e,t)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),dte(e,t));C9("all",qee),C9("any",Xee),C9("equals",Ste),C9("radians",$ee),C9("degrees",Yee),C9("exp",Kee),C9("exp2",Jee),C9("log",Zee),C9("log2",ete),C9("sqrt",tte),C9("inverseSqrt",nte),C9("floor",ite),C9("ceil",rte),C9("normalize",ote),C9("fract",ste),C9("sin",ate),C9("cos",lte),C9("tan",cte),C9("asin",ute),C9("acos",hte),C9("atan",dte),C9("abs",pte),C9("sign",fte),C9("length",mte),C9("lengthSq",jte),C9("negate",gte),C9("oneMinus",vte),C9("dFdx",yte),C9("dFdy",Ate),C9("round",xte),C9("reciprocal",bte),C9("trunc",_te),C9("fwidth",wte),C9("atan2",Kte),C9("min",Cte),C9("max",Mte),C9("mod",Tte),C9("step",Rte),C9("reflect",Ite),C9("distance",Pte),C9("dot",Lte),C9("cross",Nte),C9("pow",Dte),C9("pow2",kte),C9("pow3",Ote),C9("pow4",Ute),C9("transformDirection",Fte),C9("mix",$te),C9("clamp",Gte),C9("refract",Wte),C9("smoothstep",Yte),C9("faceForward",qte),C9("difference",Bte),C9("saturate",Hte),C9("cbrt",zte),C9("transpose",Ete),C9("rand",Xte);class Jte extends h9{static get type(){return"ConditionalNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(void 0===t)return this.setup(e),this.getNodeType(e);const i=t.getNodeType(e);if(null!==n){const t=n.getNodeType(e);if(e.getTypeLength(t)>e.getTypeLength(i))return t}return i}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,r=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=r,null!==i&&(e.getDataFromNode(i).parentNodeBlock=r);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=n.context({nodeBlock:n}),o.elseNode=i?i.context({nodeBlock:i}):null}generate(e,t){const n=this.getNodeType(e),i=e.getDataFromNode(this);if(void 0!==i.nodeProperty)return i.nodeProperty;const{condNode:r,ifNode:o,elseNode:s}=e.getNodeProperties(this),a="void"!==t,l=a?V7(n).build(e):"";i.nodeProperty=l;const c=r.build(e,"bool");e.addFlowCode(`\n${e.tab}if ( ${c} ) {\n\n`).addFlowTab();let u=o.build(e,n);if(u&&(u=a?l+" = "+u+";":"return "+u+";"),e.removeFlowTab().addFlowCode(e.tab+"\t"+u+"\n\n"+e.tab+"}"),null!==s){e.addFlowCode(" else {\n\n").addFlowTab();let t=s.build(e,n);t&&(t=a?l+" = "+t+";":"return "+t+";"),e.removeFlowTab().addFlowCode(e.tab+"\t"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(l,n,t)}}const Zte=n7(Jte);C9("select",Zte);const ene=function(){return console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Zte(...arguments)};C9("cond",ene);class tne extends h9{static get type(){return"ContextNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(t),n}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e,t);return e.setContext(n),i}}const nne=n7(tne),ine=(e,t)=>nne(e,{label:t});C9("context",nne),C9("label",ine);class rne extends h9{static get type(){return"VarNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n}getHash(e){return this.name||super.getHash(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:i}=this,{renderer:r}=e,o=!0===r.backend.isWebGPUBackend;let s=!1,a=!1;i&&(s=e.isDeterministic(t),a=o?i:s);const l=e.getVectorType(this.getNodeType(e)),c=t.build(e,l),u=e.getVarFromNode(this,n,l,void 0,a),h=e.getPropertyName(u);let d=h;if(a)if(o)d=s?`const ${h}`:`let ${h}`;else{const n=e.getArrayCount(t);d=`const ${e.getVar(u.type,h,n)}`}return e.addLineFlowCode(`${d} = ${c}`,this),h}}const one=n7(rne),sne=function(e){return one(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null).append()},ane=function(e){return one(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!0).append()};C9("toVar",sne),C9("toConst",ane);const lne=e=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),one(e));C9("temp",lne);class cne extends h9{static get type(){return"VaryingNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(void 0===n){const i=this.name,r=this.getNodeType(e);t.varying=n=e.getVaryingFromNode(this,i,r),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation="fragment"===e.shaderStage),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e),i="fragment"===e.shaderStage&&!0===t.reassignPosition&&e.context.needsPositionReassign;if(void 0===t.propertyName||i){const r=this.getNodeType(e),o=e.getPropertyName(n,i9.VERTEX);e.flowNodeFromShaderStage(i9.VERTEX,this.node,r,o),t.propertyName=o,i?t.reassignPosition=!1:void 0===t.reassignPosition&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(n)}}const une=n7(cne),hne=e=>une(e);C9("toVarying",une),C9("toVertexStage",hne),C9("varying",(function(){return console.warn("TSL.VaryingNode: .varying() has been renamed to .toVarying()."),une(...arguments)})),C9("vertexStage",(function(){return console.warn("TSL.VaryingNode: .vertexStage() has been renamed to .toVertexStage()."),une(...arguments)}));const dne=r7((e=>{let[t]=e;const n=t.mul(.9478672986).add(.0521327014).pow(2.4),i=t.mul(.0773993808),r=t.lessThanEqual(.04045);return Vte(n,i,r)})).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),pne=r7((e=>{let[t]=e;const n=t.pow(.41666).mul(1.055).sub(.055),i=t.mul(12.92),r=t.lessThanEqual(.0031308);return Vte(n,i,r)})).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),fne="WorkingColorSpace",mne="OutputColorSpace";class gne extends f9{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===fne?x0.ppV.workingColorSpace:t===mne?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let r=t;return!1!==x0.ppV.enabled&&n!==i&&n&&i?(x0.ppV.getTransfer(n)===x0.KLL&&(r=_7(dne(r.rgb),r.a)),x0.ppV.getPrimaries(n)!==x0.ppV.getPrimaries(i)&&(r=_7(M7(x0.ppV._getMatrix(new x0.dwI,n,i)).mul(r.rgb),r.a)),x0.ppV.getTransfer(i)===x0.KLL&&(r=_7(pne(r.rgb),r.a)),r):r}}const vne=e=>Z9(new gne(Z9(e),fne,mne)),yne=e=>Z9(new gne(Z9(e),mne,fne)),Ane=(e,t)=>Z9(new gne(Z9(e),fne,t)),xne=(e,t)=>Z9(new gne(Z9(e),t,fne));C9("toOutputColorSpace",vne),C9("toWorkingColorSpace",yne),C9("workingToColorSpace",Ane),C9("colorSpaceToWorking",xne);let bne=class extends d9{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}};class _ne extends h9{static get type(){return"ReferenceBaseNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=r9.OBJECT}setGroup(e){return this.group=e,this}element(e){return Z9(new bne(this,Z9(e)))}setNodeType(e){const t=z7(null,e).getSelf();null!==this.group&&t.setGroup(this.group),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.reference;const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class wne extends _ne{static get type(){return"RendererReferenceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e,t,n),this.renderer=n,this.setGroup(O7)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}const Ene=function(e,t){return Z9(new wne(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null))};class Sne extends f9{static get type(){return"ToneMappingNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mne,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return Q8(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===x0.y_p)return t;let i=null;const r=e.renderer.library.getToneMappingFunction(n);return null!==r?i=_7(r(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),i=t),i}}const Cne=(e,t,n)=>Z9(new Sne(e,Z9(t),Z9(n))),Mne=Ene("toneMappingExposure","float");C9("toneMapping",((e,t,n)=>Cne(t,n,e)));class Tne extends x9{static get type(){return"BufferAttributeNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=i,this.usage=x0.agE,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;const t=this.getNodeType(e),n=this.value,i=e.getTypeLength(t),r=this.bufferStride||i,o=this.bufferOffset,s=!0===n.isInterleavedBuffer?n:new x0.eB$(n,r),a=new x0.eHs(s,i,o);s.setUsage(this.usage),this.attribute=a,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(n);let r=null;if("vertex"===e.shaderStage||"compute"===e.shaderStage)this.name=i,r=i;else{r=une(this).build(e,t)}return r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const Rne=function(e){return Z9(new Tne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0))},Ine=function(e){return Rne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0).setUsage(x0.Vnu)},Pne=function(e){return Rne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0).setInstanced(!0)},Bne=function(e){return Ine(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0).setInstanced(!0)};C9("toAttribute",(e=>Rne(e.value)));class Lne extends h9{static get type(){return"ComputeNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[64];super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=r9.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let i=1;i<t.length;i++)n*=t[i];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore(e){let{renderer:t}=e;t.compute(this)}generate(e){const{shaderStage:t}=e;if("compute"===t){const t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t,this)}}}const Nne=(e,t,n)=>Z9(new Lne(Z9(e),t,n));C9("compute",Nne);class Dne extends h9{static get type(){return"CacheNode"}constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];const s=this.node.build(e,...r);return e.setCache(t),s}}const kne=(e,t)=>Z9(new Dne(Z9(e),t));C9("cache",kne);class One extends h9{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const Une=n7(One);C9("bypass",Une);class Fne extends h9{static get type(){return"RemapNode"}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u7(0),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u7(1);super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=i,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:i,outHighNode:r,doClamp:o}=this;let s=e.sub(t).div(n.sub(t));return!0===o&&(s=s.clamp()),s.mul(r.sub(i)).add(i)}}const zne=n7(Fne,null,null,{doClamp:!1}),jne=n7(Fne);C9("remap",zne),C9("remapClamp",jne);class Vne extends h9{static get type(){return"ExpressionNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"void"),this.snippet=e}generate(e,t){const n=this.getNodeType(e),i=this.snippet;if("void"!==n)return e.format(`( ${i} )`,n,t);e.addLineFlowCode(i,this)}}const Gne=n7(Vne),Hne=e=>(e?Zte(e,Gne("discard")):Gne("discard")).append();C9("discard",Hne);class Wne extends f9{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup(e){let{context:t}=e,n=this.colorNode||t.color;const i=(null!==this.toneMapping?this.toneMapping:t.toneMapping)||x0.y_p,r=(null!==this.outputColorSpace?this.outputColorSpace:t.outputColorSpace)||x0.jf0;return i!==x0.y_p&&(n=n.toneMapping(i)),r!==x0.jf0&&r!==x0.ppV.workingColorSpace&&(n=n.workingToColorSpace(r)),n}}const Qne=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Z9(new Wne(Z9(e),t,n))};C9("renderOutput",Qne);class qne extends h9{static get type(){return"AttributeNode"}constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(null===t){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const i=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(!0===e.hasGeometryAttribute(t)){const i=e.geometry.getAttribute(t),r=e.getTypeFromAttribute(i),o=e.getAttribute(t,r);if("vertex"===e.shaderStage)return e.format(o.name,r,n);return une(this).build(e,n)}return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Xne=(e,t)=>Z9(new qne(e,t)),$ne=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Xne("uv"+(e>0?e:""),"vec2")};class Yne extends h9{static get type(){return"TextureSizeNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),i=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${i} )`,this.getNodeType(e),t)}}const Kne=n7(Yne);class Jne extends F7{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=r9.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&void 0!==n.width){const{width:e,height:t}=n;this.value=Math.log2(Math.max(e,t))}}}const Zne=n7(Jne);class eie extends F7{static get type(){return"TextureNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=r9.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===x0.bkx?"uvec4":this.value.type===x0.Yuy?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return $ne(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=z7(this.value.matrix)),this._matrixUniform.mul(y7(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?r9.RENDER:r9.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&!0===n.flipY||!0===n.isRenderTargetTexture||!0===n.isFramebufferTexture||!0===n.isDepthTexture)&&(t=this.sampler?t.flipY():t.setY(h7(Kne(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||!0!==n.isTexture)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let i=this.uvNode;null!==i&&!0!==e.context.forceUVContext||!e.context.getUV||(i=e.context.getUV(this)),i||(i=this.getDefaultUV()),!0===this.updateMatrix&&(i=this.getTransformedUV(i)),i=this.setupUV(e,i);let r=this.levelNode;null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=r,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,t,n,i,r,o,s,a){const l=this.value;let c;return c=i?e.generateTextureLevel(l,t,n,i,o):r?e.generateTextureBias(l,t,n,r,o):a?e.generateTextureGrad(l,t,n,a,o):s?e.generateTextureCompare(l,t,n,s,o):!1===this.sampler?e.generateTextureLoad(l,t,n,o):e.generateTexture(l,t,n,o),c}generate(e,t){const n=this.value,i=e.getNodeProperties(this),r=super.generate(e,"property");if("sampler"===t)return r+"_sampler";if(e.isReference(t))return r;{const o=e.getDataFromNode(this);let s=o.propertyName;if(void 0===s){const{uvNode:t,levelNode:n,biasNode:a,compareNode:l,depthNode:c,gradNode:u}=i,h=this.generateUV(e,t),d=n?n.build(e,"float"):null,p=a?a.build(e,"float"):null,f=c?c.build(e,"int"):null,m=l?l.build(e,"float"):null,g=u?[u[0].build(e,"vec2"),u[1].build(e,"vec2")]:null,v=e.getVarFromNode(this);s=e.getPropertyName(v);const y=this.generateSnippet(e,r,h,d,p,f,m,g);e.addLineFlowCode(`${s} = ${y}`,this),o.snippet=y,o.propertyName=s}let a=s;const l=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(a=xne(Gne(a,l),n.colorSpace).setup(e).build(e,l)),e.format(a,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Z9(e),t.referenceNode=this.getSelf(),Z9(t)}blur(e){const t=this.clone();return t.biasNode=Z9(e).mul(Zne(t)),t.referenceNode=this.getSelf(),Z9(t)}level(e){const t=this.clone();return t.levelNode=Z9(e),t.referenceNode=this.getSelf(),Z9(t)}size(e){return Kne(this,e)}bias(e){const t=this.clone();return t.biasNode=Z9(e),t.referenceNode=this.getSelf(),Z9(t)}compare(e){const t=this.clone();return t.compareNode=Z9(e),t.referenceNode=this.getSelf(),Z9(t)}grad(e,t){const n=this.clone();return n.gradNode=[Z9(e),Z9(t)],n.referenceNode=this.getSelf(),Z9(n)}depth(e){const t=this.clone();return t.depthNode=Z9(e),t.referenceNode=this.getSelf(),Z9(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;null!==t&&(t.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const tie=n7(eie),nie=function(){return tie(...arguments).setSampler(!1)};class iie extends F7{static get type(){return"BufferNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const rie=(e,t,n)=>Z9(new iie(e,t,n));class oie extends d9{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,n)}}class sie extends iie{static get type(){return"UniformArrayNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.array=e,this.elementType=null===t?J8(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=r9.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return"mat2"===e?t="mat2":!0===/mat/.test(e)?t="mat4":"i"===e.charAt(0)?t="ivec4":"u"===e.charAt(0)&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if("float"===n||"int"===n||"uint"===n)for(let i=0;i<e.length;i++){t[4*i]=e[i]}else if("color"===n)for(let i=0;i<e.length;i++){const n=4*i,r=e[i];t[n]=r.r,t[n+1]=r.g,t[n+2]=r.b||0}else if("mat2"===n)for(let i=0;i<e.length;i++){const n=4*i,r=e[i];t[n]=r.elements[0],t[n+1]=r.elements[1],t[n+2]=r.elements[2],t[n+3]=r.elements[3]}else if("mat3"===n)for(let i=0;i<e.length;i++){const n=16*i,r=e[i];t[n]=r.elements[0],t[n+1]=r.elements[1],t[n+2]=r.elements[2],t[n+4]=r.elements[3],t[n+5]=r.elements[4],t[n+6]=r.elements[5],t[n+8]=r.elements[6],t[n+9]=r.elements[7],t[n+10]=r.elements[8],t[n+15]=1}else if("mat4"===n)for(let i=0;i<e.length;i++){const n=16*i,r=e[i];for(let e=0;e<r.elements.length;e++)t[n+e]=r.elements[e]}else for(let i=0;i<e.length;i++){const n=4*i,r=e[i];t[n]=r.x,t[n+1]=r.y,t[n+2]=r.z||0,t[n+3]=r.w||0}}setup(e){const t=this.array.length,n=this.elementType;let i=Float32Array;const r=this.paddedType,o=e.getTypeLength(r);return"i"===n.charAt(0)&&(i=Int32Array),"u"===n.charAt(0)&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=r,super.setup(e)}element(e){return Z9(new oie(this,Z9(e)))}}const aie=(e,t)=>Z9(new sie(e,t)),lie=z7(0,"uint").setGroup(D7("cameraIndex")).toVarying("v_cameraIndex"),cie=z7("float").label("cameraNear").setGroup(O7).onRenderUpdate((e=>{let{camera:t}=e;return t.near})),uie=z7("float").label("cameraFar").setGroup(O7).onRenderUpdate((e=>{let{camera:t}=e;return t.far})),hie=r7((e=>{let t,{camera:n}=e;if(n.isArrayCamera&&n.cameras.length>0){const e=[];for(const t of n.cameras)e.push(t.projectionMatrix);t=aie(e).setGroup(O7).label("cameraProjectionMatrices").element(lie).toVar("cameraProjectionMatrix")}else t=z7("mat4").label("cameraProjectionMatrix").setGroup(O7).onRenderUpdate((e=>{let{camera:t}=e;return t.projectionMatrix}));return t})).once()(),die=r7((e=>{let t,{camera:n}=e;if(n.isArrayCamera&&n.cameras.length>0){const e=[];for(const t of n.cameras)e.push(t.matrixWorldInverse);t=aie(e).setGroup(O7).label("cameraViewMatrices").element(lie).toVar("cameraViewMatrix")}else t=z7("mat4").label("cameraViewMatrix").setGroup(O7).onRenderUpdate((e=>{let{camera:t}=e;return t.matrixWorldInverse}));return t})).once()(),pie=z7(new x0.Pq0).label("cameraPosition").setGroup(O7).onRenderUpdate(((e,t)=>{let{camera:n}=e;return t.value.setFromMatrixPosition(n.matrixWorld)})),fie=new x0.iyt;class mie extends h9{static get type(){return"Object3DNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.scope=e,this.object3d=t,this.updateType=r9.OBJECT,this._uniformNode=new F7(null)}getNodeType(){const e=this.scope;return e===mie.WORLD_MATRIX?"mat4":e===mie.POSITION||e===mie.VIEW_POSITION||e===mie.DIRECTION||e===mie.SCALE?"vec3":e===mie.RADIUS?"float":void 0}update(e){const t=this.object3d,n=this._uniformNode,i=this.scope;if(i===mie.WORLD_MATRIX)n.value=t.matrixWorld;else if(i===mie.POSITION)n.value=n.value||new x0.Pq0,n.value.setFromMatrixPosition(t.matrixWorld);else if(i===mie.SCALE)n.value=n.value||new x0.Pq0,n.value.setFromMatrixScale(t.matrixWorld);else if(i===mie.DIRECTION)n.value=n.value||new x0.Pq0,t.getWorldDirection(n.value);else if(i===mie.VIEW_POSITION){const i=e.camera;n.value=n.value||new x0.Pq0,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}else if(i===mie.RADIUS){const i=e.object.geometry;null===i.boundingSphere&&i.computeBoundingSphere(),fie.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),n.value=fie.radius}}generate(e){const t=this.scope;return t===mie.WORLD_MATRIX?this._uniformNode.nodeType="mat4":t===mie.POSITION||t===mie.VIEW_POSITION||t===mie.DIRECTION||t===mie.SCALE?this._uniformNode.nodeType="vec3":t===mie.RADIUS&&(this._uniformNode.nodeType="float"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}mie.WORLD_MATRIX="worldMatrix",mie.POSITION="position",mie.SCALE="scale",mie.VIEW_POSITION="viewPosition",mie.DIRECTION="direction",mie.RADIUS="radius";mie.DIRECTION,mie.WORLD_MATRIX;const gie=n7(mie,mie.POSITION);mie.SCALE,mie.VIEW_POSITION,mie.RADIUS;class vie extends mie{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const yie=i7(vie,vie.WORLD_MATRIX),Aie=z7(new x0.dwI).onObjectUpdate(((e,t)=>{let{object:n}=e;return t.value.getNormalMatrix(n.matrixWorld)})),xie=r7((e=>e.renderer.nodes.modelViewMatrix||bie)).once()().toVar("modelViewMatrix"),bie=die.mul(yie),_ie=Xne("position","vec3"),wie=_ie.toVarying("positionLocal"),Eie=_ie.toVarying("positionPrevious"),Sie=yie.mul(wie).xyz.toVarying("v_positionWorld").context({needsPositionReassign:!0}),Cie=wie.transformDirection(yie).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),Mie=r7((e=>e.context.setupPositionView()),"vec3").once()().toVarying("v_positionView").context({needsPositionReassign:!0}),Tie=Mie.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Rie extends h9{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===x0.TdN&&n.side===x0.hsX?"false":e.getFrontFacing()}}const Iie=i7(Rie),Pie=u7(Iie).mul(2).sub(1),Bie=Xne("normal","vec3"),Lie=r7((e=>!1===e.geometry.hasAttribute("normal")?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),y7(0,1,0)):Bie),"vec3").once()().toVar("normalLocal"),Nie=Mie.dFdx().cross(Mie.dFdy()).normalize().toVar("normalFlat"),Die=r7((e=>{let t;return t=!0===e.material.flatShading?Nie:une(jie(Lie),"v_normalView").normalize(),t}),"vec3").once()().toVar("normalView"),kie=une(Die.transformDirection(die),"v_normalWorld").normalize().toVar("normalWorld"),Oie=r7((e=>e.context.setupNormal().context({getUV:null})),"vec3").once()().mul(Pie).toVar("transformedNormalView"),Uie=Oie.transformDirection(die).toVar("transformedNormalWorld"),Fie=r7((e=>e.context.setupClearcoatNormal().context({getUV:null})),"vec3").once()().mul(Pie).toVar("transformedClearcoatNormalView"),zie=r7((e=>{let[t,n=yie]=e;const i=M7(n),r=t.div(y7(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2])));return i.mul(r).xyz})),jie=r7(((e,t)=>{let[n]=e;const i=t.renderer.nodes.modelNormalViewMatrix;if(null!==i)return i.transformDirection(n);const r=Aie.mul(n);return die.transformDirection(r)})),Vie=new x0.O9p,Gie=new x0.kn4,Hie=z7(0).onReference((e=>{let{material:t}=e;return t})).onObjectUpdate((e=>{let{material:t}=e;return t.refractionRatio})),Wie=z7(1).onReference((e=>{let{material:t}=e;return t})).onObjectUpdate((function(e){let{material:t,scene:n}=e;return t.envMap?t.envMapIntensity:n.environmentIntensity})),Qie=z7(new x0.kn4).onReference((function(e){return e.material})).onObjectUpdate((function(e){let{material:t,scene:n}=e;const i=null!==n.environment&&null===t.envMap?n.environmentRotation:t.envMapRotation;return i?(Vie.copy(i),Gie.makeRotationFromEuler(Vie)):Gie.identity(),Gie})),qie=Tie.negate().reflect(Oie),Xie=Tie.negate().refract(Oie,Hie),$ie=qie.transformDirection(die).toVar("reflectVector"),Yie=Xie.transformDirection(die).toVar("reflectVector");class Kie extends eie{static get type(){return"CubeTextureNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===x0.hy7?$ie:e.mapping===x0.xFO?Yie:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),y7(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.renderer.coordinateSystem!==x0.i7u&&n.isRenderTargetTexture||(t=y7(t.x.negate(),t.yz)),Qie.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const Jie=n7(Kie);class Zie extends d9{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}}class ere extends h9{static get type(){return"ReferenceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=r9.OBJECT}element(e){return Z9(new Zie(this,Z9(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;t=null!==this.count?rie(null,e,this.count):Array.isArray(this.getValueFromReference())?aie(null,e):"texture"===e?tie(null):"cubeTexture"===e?Jie(null):z7(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.reference;const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const tre=(e,t,n)=>Z9(new ere(e,t,n)),nre=(e,t,n,i)=>Z9(new ere(e,t,i,n));class ire extends ere{static get type(){return"MaterialReferenceNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}const rre=function(e,t){return Z9(new ire(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null))},ore=r7((e=>(!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents(),Xne("tangent","vec4"))))(),sre=ore.xyz.toVar("tangentLocal"),are=xie.mul(_7(sre,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),lre=e=>e.mul(ore.w).xyz,cre=une(lre(Die.cross(are)),"v_bitangentView").normalize().toVar("bitangentView"),ure=M7(are,cre,Die),hre=(()=>{let e=ree.cross(Tie);return e=e.cross(ree).normalize(),e=Vte(e,Oie,nee.mul(Q7.oneMinus()).oneMinus().pow2().pow2()).normalize(),e})(),dre=r7((e=>{const{eye_pos:t,surf_norm:n,mapN:i,uv:r}=e,o=t.dFdx(),s=t.dFdy(),a=r.dFdx(),l=r.dFdy(),c=n,u=s.cross(c),h=c.cross(o),d=u.mul(a.x).add(h.mul(l.x)),p=u.mul(a.y).add(h.mul(l.y)),f=d.dot(d).max(p.dot(p)),m=Pie.mul(f.inverseSqrt());return _ee(d.mul(i.x,m),p.mul(i.y,m),c.mul(i.z)).normalize()}));class pre extends f9{static get type(){return"NormalMapNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=x0.bI3}setup(e){const{normalMapType:t,scaleNode:n}=this;let i=this.node.mul(2).sub(1);null!==n&&(i=y7(i.xy.mul(n),i.z));let r=null;if(t===x0.vyJ)r=jie(i);else if(t===x0.bI3){r=!0===e.hasGeometryAttribute("tangent")?ure.mul(i).normalize():dre({eye_pos:Mie,surf_norm:Die,mapN:i,uv:$ne()})}return r}}const fre=n7(pre),mre=r7((e=>{let{textureNode:t,bumpScale:n}=e;const i=e=>t.cache().context({getUV:t=>e(t.uvNode||$ne()),forceUVContext:!0}),r=u7(i((e=>e)));return f7(u7(i((e=>e.add(e.dFdx())))).sub(r),u7(i((e=>e.add(e.dFdy())))).sub(r)).mul(n)})),gre=r7((e=>{const{surf_pos:t,surf_norm:n,dHdxy:i}=e,r=t.dFdx().normalize(),o=n,s=t.dFdy().normalize().cross(o),a=o.cross(r),l=r.dot(s).mul(Pie),c=l.sign().mul(i.x.mul(s).add(i.y.mul(a)));return l.abs().mul(n).sub(c).normalize()}));class vre extends f9{static get type(){return"BumpMapNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=null!==this.scaleNode?this.scaleNode:1,t=mre({textureNode:this.textureNode,bumpScale:e});return gre({surf_pos:Mie,surf_norm:Die,dHdxy:t})}}const yre=n7(vre),Are=new Map;class xre extends h9{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=Are.get(e);return void 0===n&&(n=rre(e,t),Are.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let i=null;if(n===xre.COLOR){const e=void 0!==t.color?this.getColor(n):y7();i=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(n===xre.OPACITY){const e=this.getFloat(n);i=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(n===xre.SPECULAR_STRENGTH)i=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture("specular").r:u7(1);else if(n===xre.SPECULAR_INTENSITY){const e=this.getFloat(n);i=t.specularIntensityMap&&!0===t.specularIntensityMap.isTexture?e.mul(this.getTexture(n).a):e}else if(n===xre.SPECULAR_COLOR){const e=this.getColor(n);i=t.specularColorMap&&!0===t.specularColorMap.isTexture?e.mul(this.getTexture(n).rgb):e}else if(n===xre.ROUGHNESS){const e=this.getFloat(n);i=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(n).g):e}else if(n===xre.METALNESS){const e=this.getFloat(n);i=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(n).b):e}else if(n===xre.EMISSIVE){const e=this.getFloat("emissiveIntensity"),r=this.getColor(n).mul(e);i=t.emissiveMap&&!0===t.emissiveMap.isTexture?r.mul(this.getTexture(n)):r}else if(n===xre.NORMAL)t.normalMap?(i=fre(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType):i=t.bumpMap?yre(this.getTexture("bump").r,this.getFloat("bumpScale")):Die;else if(n===xre.CLEARCOAT){const e=this.getFloat(n);i=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===xre.CLEARCOAT_ROUGHNESS){const e=this.getFloat(n);i=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===xre.CLEARCOAT_NORMAL)i=t.clearcoatNormalMap?fre(this.getTexture(n),this.getCache(n+"Scale","vec2")):Die;else if(n===xre.SHEEN){const e=this.getColor("sheenColor").mul(this.getFloat("sheen"));i=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(n===xre.SHEEN_ROUGHNESS){const e=this.getFloat(n);i=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(n).a):e,i=i.clamp(.07,1)}else if(n===xre.ANISOTROPY)if(t.anisotropyMap&&!0===t.anisotropyMap.isTexture){const e=this.getTexture(n);i=C7(ioe.x,ioe.y,ioe.y.negate(),ioe.x).mul(e.rg.mul(2).sub(f7(1)).normalize().mul(e.b))}else i=ioe;else if(n===xre.IRIDESCENCE_THICKNESS){const e=tre("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const r=tre("0","float",t.iridescenceThicknessRange);i=e.sub(r).mul(this.getTexture(n).g).add(r)}else i=e}else if(n===xre.TRANSMISSION){const e=this.getFloat(n);i=t.transmissionMap?e.mul(this.getTexture(n).r):e}else if(n===xre.THICKNESS){const e=this.getFloat(n);i=t.thicknessMap?e.mul(this.getTexture(n).g):e}else if(n===xre.IOR)i=this.getFloat(n);else if(n===xre.LIGHT_MAP)i=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===xre.AO)i=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const t=this.getNodeType(e);i=this.getCache(n,t)}return i}}xre.ALPHA_TEST="alphaTest",xre.COLOR="color",xre.OPACITY="opacity",xre.SHININESS="shininess",xre.SPECULAR="specular",xre.SPECULAR_STRENGTH="specularStrength",xre.SPECULAR_INTENSITY="specularIntensity",xre.SPECULAR_COLOR="specularColor",xre.REFLECTIVITY="reflectivity",xre.ROUGHNESS="roughness",xre.METALNESS="metalness",xre.NORMAL="normal",xre.CLEARCOAT="clearcoat",xre.CLEARCOAT_ROUGHNESS="clearcoatRoughness",xre.CLEARCOAT_NORMAL="clearcoatNormal",xre.EMISSIVE="emissive",xre.ROTATION="rotation",xre.SHEEN="sheen",xre.SHEEN_ROUGHNESS="sheenRoughness",xre.ANISOTROPY="anisotropy",xre.IRIDESCENCE="iridescence",xre.IRIDESCENCE_IOR="iridescenceIOR",xre.IRIDESCENCE_THICKNESS="iridescenceThickness",xre.IOR="ior",xre.TRANSMISSION="transmission",xre.THICKNESS="thickness",xre.ATTENUATION_DISTANCE="attenuationDistance",xre.ATTENUATION_COLOR="attenuationColor",xre.LINE_SCALE="scale",xre.LINE_DASH_SIZE="dashSize",xre.LINE_GAP_SIZE="gapSize",xre.LINE_WIDTH="linewidth",xre.LINE_DASH_OFFSET="dashOffset",xre.POINT_SIZE="size",xre.DISPERSION="dispersion",xre.LIGHT_MAP="light",xre.AO="ao";const bre=i7(xre,xre.ALPHA_TEST),_re=i7(xre,xre.COLOR),wre=i7(xre,xre.SHININESS),Ere=i7(xre,xre.EMISSIVE),Sre=i7(xre,xre.OPACITY),Cre=i7(xre,xre.SPECULAR),Mre=i7(xre,xre.SPECULAR_INTENSITY),Tre=i7(xre,xre.SPECULAR_COLOR),Rre=i7(xre,xre.SPECULAR_STRENGTH),Ire=i7(xre,xre.REFLECTIVITY),Pre=i7(xre,xre.ROUGHNESS),Bre=i7(xre,xre.METALNESS),Lre=i7(xre,xre.NORMAL),Nre=i7(xre,xre.CLEARCOAT),Dre=i7(xre,xre.CLEARCOAT_ROUGHNESS),kre=i7(xre,xre.CLEARCOAT_NORMAL),Ore=i7(xre,xre.ROTATION),Ure=i7(xre,xre.SHEEN),Fre=i7(xre,xre.SHEEN_ROUGHNESS),zre=i7(xre,xre.ANISOTROPY),jre=i7(xre,xre.IRIDESCENCE),Vre=i7(xre,xre.IRIDESCENCE_IOR),Gre=i7(xre,xre.IRIDESCENCE_THICKNESS),Hre=i7(xre,xre.TRANSMISSION),Wre=i7(xre,xre.THICKNESS),Qre=i7(xre,xre.IOR),qre=i7(xre,xre.ATTENUATION_DISTANCE),Xre=i7(xre,xre.ATTENUATION_COLOR),$re=i7(xre,xre.LINE_SCALE),Yre=i7(xre,xre.LINE_DASH_SIZE),Kre=i7(xre,xre.LINE_GAP_SIZE),Jre=(xre.LINE_WIDTH,i7(xre,xre.LINE_DASH_OFFSET)),Zre=i7(xre,xre.POINT_SIZE),eoe=i7(xre,xre.DISPERSION),toe=i7(xre,xre.LIGHT_MAP),noe=i7(xre,xre.AO),ioe=z7(new x0.I9Y).onReference((function(e){return e.material})).onRenderUpdate((function(e){let{material:t}=e;this.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation))})),roe=r7((e=>e.context.setupModelViewProjection()),"vec4").once()().toVarying("v_modelViewProjection");class ooe extends h9{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let i,r;if(n===ooe.VERTEX)i=e.getVertexIndex();else if(n===ooe.INSTANCE)i=e.getInstanceIndex();else if(n===ooe.DRAW)i=e.getDrawIndex();else if(n===ooe.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(n===ooe.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else{if(n!==ooe.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+n);i=e.getSubgroupIndex()}if("vertex"===e.shaderStage||"compute"===e.shaderStage)r=i;else{r=une(this).build(e,t)}return r}}ooe.VERTEX="vertex",ooe.INSTANCE="instance",ooe.SUBGROUP="subgroup",ooe.INVOCATION_LOCAL="invocationLocal",ooe.INVOCATION_SUBGROUP="invocationSubgroup",ooe.DRAW="draw";const soe=i7(ooe,ooe.VERTEX),aoe=i7(ooe,ooe.INSTANCE),loe=(ooe.SUBGROUP,ooe.INVOCATION_SUBGROUP,ooe.INVOCATION_LOCAL,i7(ooe,ooe.DRAW));class coe extends h9{static get type(){return"InstanceNode"}constructor(e,t,n){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=r9.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:i}=this;let{instanceMatrixNode:r,instanceColorNode:o}=this;if(null===r){if(t<=1e3)r=rie(n.array,"mat4",Math.max(t,1)).element(aoe);else{const e=new x0.LuO(n.array,16,1);this.buffer=e;const t=n.usage===x0.Vnu?Bne:Pne,i=[t(e,"vec4",16,0),t(e,"vec4",16,4),t(e,"vec4",16,8),t(e,"vec4",16,12)];r=T7(...i)}this.instanceMatrixNode=r}if(i&&null===o){const e=new x0.uWO(i.array,3),t=i.usage===x0.Vnu?Bne:Pne;this.bufferColor=e,o=y7(t(e,"vec3",3,0)),this.instanceColorNode=o}const s=r.mul(wie).xyz;if(wie.assign(s),e.hasGeometryAttribute("normal")){const e=zie(Lie,r);Lie.assign(e)}null!==this.instanceColorNode&&G7("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==x0.Vnu&&null!==this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==x0.Vnu&&null!==this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class uoe extends coe{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:i}=e;super(t,n,i),this.instancedMesh=e}}const hoe=n7(uoe);class doe extends h9{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=aoe:this.batchingIdNode=loe);const t=r7((e=>{let[t]=e;const n=h7(Kne(nie(this.batchMesh._indirectTexture),0)),i=h7(t).modInt(n),r=h7(t).div(n);return nie(this.batchMesh._indirectTexture,m7(i,r)).x})).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),n=t(h7(this.batchingIdNode)),i=this.batchMesh._matricesTexture,r=Kne(nie(i),0),o=u7(n).mul(4).toInt().toVar(),s=o.modInt(r),a=o.div(h7(r)),l=T7(nie(i,m7(s,a)),nie(i,m7(s.add(1),a)),nie(i,m7(s.add(2),a)),nie(i,m7(s.add(3),a))),c=this.batchMesh._colorsTexture;if(null!==c){const e=r7((e=>{let[t]=e;const n=Kne(nie(c),0).x,i=t,r=i.modInt(n),o=i.div(n);return nie(c,m7(r,o)).rgb})).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),t=e(n);G7("vec3","vBatchColor").assign(t)}const u=M7(l);wie.assign(l.mul(wie));const h=Lie.div(y7(u[0].dot(u[0]),u[1].dot(u[1]),u[2].dot(u[2]))),d=u.mul(h).xyz;Lie.assign(d),e.hasGeometryAttribute("tangent")&&sre.mulAssign(u)}}const poe=n7(doe),foe=new WeakMap;class moe extends h9{static get type(){return"SkinningNode"}constructor(e){let t,n,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super("void"),this.skinnedMesh=e,this.useReference=r,this.updateType=r9.OBJECT,this.skinIndexNode=Xne("skinIndex","uvec4"),this.skinWeightNode=Xne("skinWeight","vec4"),r?(t=tre("bindMatrix","mat4"),n=tre("bindMatrixInverse","mat4"),i=nre("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(t=z7(e.bindMatrix,"mat4"),n=z7(e.bindMatrixInverse,"mat4"),i=rie(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=t,this.bindMatrixInverseNode=n,this.boneMatricesNode=i,this.previousBoneMatricesNode=null}getSkinnedPosition(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.boneMatricesNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wie;const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:r,bindMatrixInverseNode:o}=this,s=e.element(n.x),a=e.element(n.y),l=e.element(n.z),c=e.element(n.w),u=r.mul(t),h=_ee(s.mul(i.x).mul(u),a.mul(i.y).mul(u),l.mul(i.z).mul(u),c.mul(i.w).mul(u));return o.mul(h).xyz}getSkinnedNormal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.boneMatricesNode,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lie;const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:r,bindMatrixInverseNode:o}=this,s=e.element(n.x),a=e.element(n.y),l=e.element(n.z),c=e.element(n.w);let u=_ee(i.x.mul(s),i.y.mul(a),i.z.mul(l),i.w.mul(c));return u=o.mul(u).mul(r),u.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return null===this.previousBoneMatricesNode&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=nre("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Eie)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||!0===e9(e.object).useVelocity}setup(e){this.needsPreviousBoneMatrices(e)&&Eie.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(wie.assign(t),e.hasGeometryAttribute("normal")){const t=this.getSkinnedNormal();Lie.assign(t),e.hasGeometryAttribute("tangent")&&sre.assign(t)}}generate(e,t){if("void"!==t)return wie.build(e,t)}update(e){const t=(this.useReference?e.object:this.skinnedMesh).skeleton;foe.get(t)!==e.frameId&&(foe.set(t,e.frameId),null!==this.previousBoneMatricesNode&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const goe=e=>Z9(new moe(e,!0));class voe extends h9{static get type(){return"LoopNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;const n={};for(let r=0,o=this.params.length-1;r<o;r++){const e=this.params[r],t=!0!==e.isNode&&e.name||this.getVarName(r),i=!0!==e.isNode&&e.type||"int";n[t]=Gne(t,i)}const i=e.addStack();return t.returnsNode=this.params[this.params.length-1](n,i,e),t.stackNode=i,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,i=t.stackNode;for(let s=0,a=n.length-1;s<a;s++){const t=n[s];let i=null,r=null,o=null,a=null,l=null,c=null;t.isNode?(a="int",o=this.getVarName(s),i="0",r=t.build(e,a),l="<"):(a=t.type||"int",o=t.name||this.getVarName(s),i=t.start,r=t.end,l=t.condition,c=t.update,"number"===typeof i?i=e.generateConst(a,i):i&&i.isNode&&(i=i.build(e,a)),"number"===typeof r?r=e.generateConst(a,r):r&&r.isNode&&(r=r.build(e,a)),void 0!==i&&void 0===r?(i+=" - 1",r="0",l=">="):void 0!==r&&void 0===i&&(i="0",l="<"),void 0===l&&(l=Number(i)>Number(r)?">=":"<"));const u={start:i,end:r,condition:l},h=u.start,d=u.end;let p="",f="",m="";c||(c="int"===a||"uint"===a?l.includes("<")?"++":"--":l.includes("<")?"+= 1.":"-= 1."),p+=e.getVar(a,o)+" = "+h,f+=o+" "+l+" "+d,m+=o+" "+c;const g=`for ( ${p}; ${f}; ${m} )`;e.addFlowCode((0===s?"\n":"")+e.tab+g+" {\n\n").addFlowTab()}const r=i.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+r);for(let s=0,a=this.params.length-1;s<a;s++)e.addFlowCode((0===s?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),o}}const yoe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Z9(new voe(t7(t,"int"))).append()},Aoe=()=>Gne("break").append(),xoe=new WeakMap,boe=new x0.IUQ,_oe=r7((e=>{let{bufferMap:t,influence:n,stride:i,width:r,depth:o,offset:s}=e;const a=h7(soe).mul(i).add(s),l=a.div(r),c=a.sub(l.mul(r));return nie(t,m7(c,l)).depth(o).mul(n)}));class woe extends h9{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=z7(1),this.updateType=r9.OBJECT}setup(e){const{geometry:t}=e,n=void 0!==t.morphAttributes.position,i=t.hasAttribute("normal")&&void 0!==t.morphAttributes.normal,r=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=void 0!==r?r.length:0,{texture:s,stride:a,size:l}=function(e){const t=void 0!==e.morphAttributes.position,n=void 0!==e.morphAttributes.normal,i=void 0!==e.morphAttributes.color,r=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,o=void 0!==r?r.length:0;let s=xoe.get(e);if(void 0===s||s.count!==o){void 0!==s&&s.texture.dispose();const a=e.morphAttributes.position||[],l=e.morphAttributes.normal||[],c=e.morphAttributes.color||[];let u=0;!0===t&&(u=1),!0===n&&(u=2),!0===i&&(u=3);let h=e.attributes.position.count*u,d=1;const p=4096;h>p&&(d=Math.ceil(h/p),h=p);const f=new Float32Array(h*d*4*o),m=new x0.rFo(f,h,d,o);m.type=x0.RQf,m.needsUpdate=!0;const g=4*u;for(let y=0;y<o;y++){const A=a[y],x=l[y],b=c[y],_=h*d*4*y;for(let w=0;w<A.count;w++){const E=w*g;!0===t&&(boe.fromBufferAttribute(A,w),f[_+E+0]=boe.x,f[_+E+1]=boe.y,f[_+E+2]=boe.z,f[_+E+3]=0),!0===n&&(boe.fromBufferAttribute(x,w),f[_+E+4]=boe.x,f[_+E+5]=boe.y,f[_+E+6]=boe.z,f[_+E+7]=0),!0===i&&(boe.fromBufferAttribute(b,w),f[_+E+8]=boe.x,f[_+E+9]=boe.y,f[_+E+10]=boe.z,f[_+E+11]=4===b.itemSize?boe.w:1)}}function v(){m.dispose(),xoe.delete(e),e.removeEventListener("dispose",v)}s={count:o,texture:m,stride:u,size:new x0.I9Y(h,d)},xoe.set(e,s),e.addEventListener("dispose",v)}return s}(t);!0===n&&wie.mulAssign(this.morphBaseInfluence),!0===i&&Lie.mulAssign(this.morphBaseInfluence);const c=h7(l.width);yoe(o,(e=>{let{i:t}=e;const r=u7(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?r.assign(nie(this.mesh.morphTexture,m7(h7(t).add(1),h7(aoe))).r):r.assign(tre("morphTargetInfluences","float").element(t).toVar()),!0===n&&wie.addAssign(_oe({bufferMap:s,influence:r,stride:a,width:c,depth:t,offset:h7(0)})),!0===i&&Lie.addAssign(_oe({bufferMap:s,influence:r,stride:a,width:c,depth:t,offset:h7(1)}))}))}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce(((e,t)=>e+t),0)}}const Eoe=n7(woe);class Soe extends h9{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Coe extends Soe{static get type(){return"AONode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Moe extends tne{static get type(){return"LightingContextNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n={directDiffuse:y7().toVar("directDiffuse"),directSpecular:y7().toVar("directSpecular"),indirectDiffuse:y7().toVar("indirectDiffuse"),indirectSpecular:y7().toVar("indirectSpecular")};return{radiance:y7().toVar("radiance"),irradiance:y7().toVar("irradiance"),iblIrradiance:y7().toVar("iblIrradiance"),ambientOcclusion:u7(1).toVar("ambientOcclusion"),reflectedLight:n,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Toe=n7(Moe);class Roe extends Soe{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let Ioe,Poe;class Boe extends h9{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===Boe.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=r9.NONE;return this.scope!==Boe.SIZE&&this.scope!==Boe.VIEWPORT||(e=r9.RENDER),this.updateType=e,e}update(e){let{renderer:t}=e;const n=t.getRenderTarget();this.scope===Boe.VIEWPORT?null!==n?Poe.copy(n.viewport):(t.getViewport(Poe),Poe.multiplyScalar(t.getPixelRatio())):null!==n?(Ioe.width=n.width,Ioe.height=n.height):t.getDrawingBufferSize(Ioe)}setup(){const e=this.scope;let t=null;return t=e===Boe.SIZE?z7(Ioe||(Ioe=new x0.I9Y)):e===Boe.VIEWPORT?z7(Poe||(Poe=new x0.IUQ)):f7(Doe.div(Noe)),t}generate(e){if(this.scope===Boe.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(Noe).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}Boe.COORDINATE="coordinate",Boe.VIEWPORT="viewport",Boe.SIZE="size",Boe.UV="uv";const Loe=i7(Boe,Boe.UV),Noe=i7(Boe,Boe.SIZE),Doe=i7(Boe,Boe.COORDINATE),koe=i7(Boe,Boe.VIEWPORT),Ooe=(koe.zw,koe.xy,new x0.I9Y);class Uoe extends eie{static get type(){return"ViewportTextureNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Loe,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new x0.Pem,n.minFilter=x0.$_I),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=r9.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(Ooe);const n=this.value;n.image.width===Ooe.width&&n.image.height===Ooe.height||(n.image.width=Ooe.width,n.image.height=Ooe.height,n.needsUpdate=!0);const i=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const Foe=n7(Uoe,null,null,{generateMipmaps:!0});let zoe=null;class joe extends Uoe{static get type(){return"ViewportDepthTextureNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Loe,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===zoe&&(zoe=new x0.VCu),super(e,t,zoe)}}const Voe=n7(joe);class Goe extends h9{static get type(){return"ViewportDepthNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Goe.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup(e){let{camera:t}=e;const{scope:n}=this,i=this.valueNode;let r=null;if(n===Goe.DEPTH_BASE)null!==i&&(r=Xoe().assign(i));else if(n===Goe.DEPTH)r=t.isPerspectiveCamera?Woe(Mie.z,cie,uie):Hoe(Mie.z,cie,uie);else if(n===Goe.LINEAR_DEPTH)if(null!==i)if(t.isPerspectiveCamera){const e=Qoe(i,cie,uie);r=Hoe(e,cie,uie)}else r=i;else r=Hoe(Mie.z,cie,uie);return r}}Goe.DEPTH_BASE="depthBase",Goe.DEPTH="depth",Goe.LINEAR_DEPTH="linearDepth";const Hoe=(e,t,n)=>e.add(t).div(t.sub(n)),Woe=(e,t,n)=>t.add(e).mul(n).div(n.sub(t).mul(e)),Qoe=(e,t,n)=>t.mul(n).div(n.sub(t).mul(e).sub(n)),qoe=(e,t,n)=>{t=t.max(1e-6).toVar();const i=ete(e.negate().div(t)),r=ete(n.div(t));return i.div(r)},Xoe=n7(Goe,Goe.DEPTH_BASE),$oe=i7(Goe,Goe.DEPTH),Yoe=n7(Goe,Goe.LINEAR_DEPTH);Voe();$oe.assign=e=>Xoe(e);const Koe=n7(class extends h9{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}});class Joe extends h9{static get type(){return"ClippingNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Joe.DEFAULT;super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Joe.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,i):this.scope===Joe.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(n,i)}setupAlphaToCoverage(e,t){return r7((()=>{const n=u7().toVar("distanceToPlane"),i=u7().toVar("distanceToGradient"),r=u7(1).toVar("clipOpacity"),o=t.length;if(!1===this.hardwareClipping&&o>0){const e=aie(t);yoe(o,(t=>{let{i:o}=t;const s=e.element(o);n.assign(Mie.dot(s.xyz).negate().add(s.w)),i.assign(n.fwidth().div(2)),r.mulAssign(Qte(i.negate(),i,n))}))}const s=e.length;if(s>0){const t=aie(e),o=u7(1).toVar("intersectionClipOpacity");yoe(s,(e=>{let{i:r}=e;const s=t.element(r);n.assign(Mie.dot(s.xyz).negate().add(s.w)),i.assign(n.fwidth().div(2)),o.mulAssign(Qte(i.negate(),i,n).oneMinus())})),r.mulAssign(o.oneMinus())}H7.a.mulAssign(r),H7.a.equal(0).discard()}))()}setupDefault(e,t){return r7((()=>{const n=t.length;if(!1===this.hardwareClipping&&n>0){const e=aie(t);yoe(n,(t=>{let{i:n}=t;const i=e.element(n);Mie.dot(i.xyz).greaterThan(i.w).discard()}))}const i=e.length;if(i>0){const t=aie(e),n=p7(!0).toVar("clipped");yoe(i,(e=>{let{i:i}=e;const r=t.element(i);n.assign(Mie.dot(r.xyz).greaterThan(r.w).and(n))})),n.discard()}}))()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),r7((()=>{const i=aie(e),r=Koe(t.getClipDistance());yoe(n,(e=>{let{i:t}=e;const n=i.element(t),o=Mie.dot(n.xyz).sub(n.w).negate();r.element(t).assign(o)}))}))()}}Joe.ALPHA_TO_COVERAGE="alphaToCoverage",Joe.DEFAULT="default",Joe.HARDWARE="hardware";const Zoe=r7((e=>{let[t]=e;return ste(Eee(1e4,ate(Eee(17,t.x).add(Eee(.1,t.y)))).mul(_ee(.1,pte(ate(Eee(13,t.y).add(t.x))))))})),ese=r7((e=>{let[t]=e;return Zoe(f7(Zoe(t.xy),t.z))})),tse=r7((e=>{let[t]=e;const n=Mte(mte(yte(t.xyz)),mte(Ate(t.xyz))),i=u7(1).div(u7(.05).mul(n)).toVar("pixScale"),r=f7(Jee(ite(ete(i))),Jee(rte(ete(i)))),o=f7(ese(ite(r.x.mul(t.xyz))),ese(ite(r.y.mul(t.xyz)))),s=ste(ete(i)),a=_ee(Eee(s.oneMinus(),o.x),Eee(s,o.y)),l=Cte(s,s.oneMinus()),c=y7(a.mul(a).div(Eee(2,l).mul(wee(1,l))),a.sub(Eee(.5,l)).div(wee(1,l)),wee(1,wee(1,a).mul(wee(1,a)).div(Eee(2,l).mul(wee(1,l))))),u=a.lessThan(l.oneMinus()).select(a.lessThan(l).select(c.x,c.y),c.z);return Gte(u,1e-6,1)})).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class nse extends x0.imn{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+q8(this)}build(e){this.setup(e)}setupObserver(e){return new V8(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const i=this.vertexNode||this.setupVertex(e);let r;e.stack.outputNode=i,this.setupHardwareClipping(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();const o=this.setupClipping(e);if(!0!==this.depthWrite&&!0!==this.depthTest||(null!==n?!0===n.depthBuffer&&this.setupDepth(e):!0===t.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);const i=this.setupLighting(e);null!==o&&e.stack.add(o);const s=_7(i,H7.a).max(0);if(r=this.setupOutput(e,s),lee.assign(r),null!==this.outputNode&&(r=this.outputNode),null!==n){const e=t.getMRT(),n=this.mrtNode;null!==e?(r=e,null!==n&&(r=e.merge(n))):null!==n&&(r=n)}}else{let t=this.fragmentNode;!0!==t.isOutputStructNode&&(t=_7(t)),r=this.setupOutput(e,t)}e.stack.outputNode=r,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let i=null;if(t.length>0||n.length>0){const t=e.renderer.samples;this.alphaToCoverage&&t>1?i=Z9(new Joe(Joe.ALPHA_TO_COVERAGE)):e.stack.add(Z9(new Joe))}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Z9(new Joe(Joe.HARDWARE))),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let i=this.depthNode;if(null===i){const e=t.getMRT();e&&e.has("depth")?i=e.get("depth"):!0===t.logarithmicDepthBuffer&&(i=n.isPerspectiveCamera?qoe(Mie.z,cie,uie):Hoe(Mie.z,cie,uie))}null!==i&&$oe.assign(i).append()}setupPositionView(){return xie.mul(wie).xyz}setupModelViewProjection(){return hie.mul(Mie)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),roe}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Eoe(t).append(),!0===t.isSkinnedMesh&&goe(t).append(),this.displacementMap){const e=rre("displacementMap","texture"),t=rre("displacementScale","float"),n=rre("displacementBias","float");wie.addAssign(Lie.normalize().mul(e.x.mul(t).add(n)))}return t.isBatchedMesh&&poe(t).append(),t.isInstancedMesh&&t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&hoe(t).append(),null!==this.positionNode&&wie.assign(this.positionNode.context({isPositionNodeInput:!0})),wie}setupDiffuseColor(e){let{object:t,geometry:n}=e,i=this.colorNode?_7(this.colorNode):_re;if(!0===this.vertexColors&&n.hasAttribute("color")&&(i=_7(i.xyz.mul(Xne("color","vec3")),i.a)),t.instanceColor){i=G7("vec3","vInstanceColor").mul(i)}if(t.isBatchedMesh&&t._colorsTexture){i=G7("vec3","vBatchColor").mul(i)}H7.assign(i);const r=this.opacityNode?u7(this.opacityNode):Sre;if(H7.a.assign(H7.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){const e=null!==this.alphaTestNode?u7(this.alphaTestNode):bre;H7.a.lessThanEqual(e).discard()}!0===this.alphaHash&&H7.a.lessThan(tse(wie)).discard(),!1===this.transparent&&this.blending===x0.NTi&&!1===this.alphaToCoverage&&H7.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?y7(0):H7.rgb}setupNormal(){return this.normalNode?y7(this.normalNode):Lre}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?rre("envMap","cubeTexture"):rre("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Roe(toe)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const i=this.setupLightMap(e);if(i&&i.isLightingNode&&t.push(i),null!==this.aoNode||e.material.aoMap){const e=null!==this.aoNode?this.aoNode:noe;t.push(new Coe(e))}let r=this.lightsNode||e.lightsNode;return t.length>0&&(r=e.renderer.lighting.createNode([...r.getLights(),...t])),r}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:i,emissiveNode:r}=this,o=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null;let s=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const t=this.setupLightingModel(e)||null;s=Toe(o,t,n,i)}else null!==n&&(s=y7(null!==i?Vte(s,n,i):n));return(r&&!0===r.isNode||t.emissive&&!0===t.emissive.isColor)&&(W7.assign(y7(r||Ere)),s=s.add(W7)),s}setupFog(e,t){const n=e.fogNode;return n&&(lee.assign(t),t=_7(n)),t}setupOutput(e,t){return!0===this.fog&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const t=e[n];void 0===this[n]&&(this[n]=t,t&&t.clone&&(this[n]=t.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,n)&&void 0!==t[n].get&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{},nodes:{}});const n=x0.imn.prototype.toJSON.call(this,e),i=X8(this);n.inputNodes={};for(const{property:o,childNode:s}of i)n.inputNodes[o]=s.toJSON(e).uuid;function r(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(t){const t=r(e.textures),i=r(e.images),o=r(e.nodes);t.length>0&&(n.textures=t),i.length>0&&(n.images=i),o.length>0&&(n.nodes=o)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const ise=new x0.mrM;class rse extends nse{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(ise),this.setValues(e)}}const ose=new x0.Fvt;class sse extends nse{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(ose),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?u7(this.offsetNode):Jre,t=this.dashScaleNode?u7(this.dashScaleNode):$re,n=this.dashSizeNode?u7(this.dashSizeNode):Yre,i=this.gapSizeNode?u7(this.gapSizeNode):Kre;cee.assign(n),uee.assign(i);const r=une(Xne("lineDistance").mul(t));(e?r.add(e):r).mod(cee.add(uee)).greaterThan(cee).discard()}}const ase=e=>Z9(e).mul(.5).add(.5),lse=new x0.qBx;class cse extends nse{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(lse),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?u7(this.opacityNode):Sre;H7.assign(xne(_7(ase(Oie),e),x0.er$))}}class use extends f9{static get type(){return"EquirectUVNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cie;super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(2*Math.PI)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return f7(t,n)}}const hse=n7(use);class dse extends x0.o6l{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r=new x0.iNn(5,5,5),o=hse(Cie),s=new nse;s.colorNode=tie(t,o,0),s.side=x0.hsX,s.blending=x0.XIg;const a=new x0.eaF(r,s),l=new x0.Z58;l.add(a),t.minFilter===x0.$_I&&(t.minFilter=x0.k6q);const c=new x0.F1T(1,10,this),u=e.getMRT();return e.setMRT(null),c.update(e,l),e.setMRT(u),t.minFilter=n,t.currentGenerateMipmaps=i,a.geometry.dispose(),a.material.dispose(),this}}const pse=new WeakMap;class fse extends f9{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Jie();const t=new x0.b4q;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=r9.RENDER}updateBefore(e){const{renderer:t,material:n}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const e=i.isTextureNode?i.value:n[i.property];if(e&&e.isTexture){const n=e.mapping;if(n===x0.wfO||n===x0.uV5){if(pse.has(e)){const t=pse.get(e);gse(t,e.mapping),this._cubeTexture=t}else{const n=e.image;if(function(e){return null!==e&&void 0!==e&&e.height>0}(n)){const i=new dse(n.height);i.fromEquirectangularTexture(t,e),gse(i.texture,e.mapping),this._cubeTexture=i.texture,pse.set(e,i.texture),e.addEventListener("dispose",mse)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function mse(e){const t=e.target;t.removeEventListener("dispose",mse);const n=pse.get(t);void 0!==n&&(pse.delete(t),n.dispose())}function gse(e,t){t===x0.wfO?e.mapping=x0.hy7:t===x0.uV5&&(e.mapping=x0.xFO)}const vse=n7(fse);class yse extends Soe{static get type(){return"BasicEnvironmentNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.envNode=e}setup(e){e.context.environment=vse(this.envNode)}}class Ase extends Soe{static get type(){return"BasicLightMapNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.lightMapNode=e}setup(e){const t=u7(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class xse{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class bse extends xse{constructor(){super()}indirect(e){let{context:t}=e;const n=t.ambientOcclusion,i=t.reflectedLight,r=t.irradianceLightMap;i.indirectDiffuse.assign(_7(0)),r?i.indirectDiffuse.addAssign(r):i.indirectDiffuse.addAssign(_7(1,1,1,0)),i.indirectDiffuse.mulAssign(n),i.indirectDiffuse.mulAssign(H7.rgb)}finish(e){const{material:t,context:n}=e,i=n.outgoingLight,r=e.context.environment;if(r)switch(t.combine){case x0.caT:i.rgb.assign(Vte(i.rgb,i.rgb.mul(r.rgb),Rre.mul(Ire)));break;case x0.KRh:i.rgb.assign(Vte(i.rgb,r.rgb,Rre.mul(Ire)));break;case x0.XrR:i.rgb.addAssign(r.rgb.mul(Rre.mul(Ire)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine)}}}const _se=new x0.V9B;class wse extends nse{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(_se),this.setValues(e)}setupNormal(){return Die}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new yse(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Ase(toe)),t}setupOutgoingLight(){return H7.rgb}setupLightingModel(){return new bse}}const Ese=r7((e=>{let{f0:t,f90:n,dotVH:i}=e;const r=i.mul(-5.55473).sub(6.98316).mul(i).exp2();return t.mul(r.oneMinus()).add(n.mul(r))})),Sse=r7((e=>e.diffuseColor.mul(1/Math.PI))),Cse=r7((e=>{let{dotNH:t}=e;return aee.mul(u7(.5)).add(1).mul(u7(1/Math.PI)).mul(t.pow(aee))})),Mse=r7((e=>{let{lightDirection:t}=e;const n=t.add(Tie).normalize(),i=Oie.dot(n).clamp(),r=Tie.dot(n).clamp(),o=Ese({f0:oee,f90:1,dotVH:r}),s=u7(.25),a=Cse({dotNH:i});return o.mul(s).mul(a)}));class Tse extends bse{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];super(),this.specular=e}direct(e){let{lightDirection:t,lightColor:n,reflectedLight:i}=e;const r=Oie.dot(t).clamp().mul(n);i.directDiffuse.addAssign(r.mul(Sse({diffuseColor:H7.rgb}))),!0===this.specular&&i.directSpecular.addAssign(r.mul(Mse({lightDirection:t})).mul(Rre))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul(Sse({diffuseColor:H7}))),i.indirectDiffuse.mulAssign(t)}}const Rse=new x0.G_z;class Ise extends nse{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Rse),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new yse(t):null}setupLightingModel(){return new Tse(!1)}}const Pse=new x0.tXL;class Bse extends nse{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Pse),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new yse(t):null}setupLightingModel(){return new Tse}setupVariants(){const e=(this.shininessNode?u7(this.shininessNode):wre).max(1e-4);aee.assign(e);const t=this.specularNode||Cre;oee.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const Lse=r7((e=>{if(!1===e.geometry.hasAttribute("normal"))return u7(0);const t=Die.dFdx().abs().max(Die.dFdy().abs());return t.x.max(t.y).max(t.z)})),Nse=r7((e=>{const{roughness:t}=e,n=Lse();let i=t.max(.0525);return i=i.add(n),i=i.min(1),i})),Dse=r7((e=>{let{alpha:t,dotNL:n,dotNV:i}=e;const r=t.pow2(),o=n.mul(r.add(r.oneMinus().mul(i.pow2())).sqrt()),s=i.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt());return See(.5,o.add(s).max(Wee))})).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),kse=r7((e=>{let{alphaT:t,alphaB:n,dotTV:i,dotBV:r,dotTL:o,dotBL:s,dotNV:a,dotNL:l}=e;const c=l.mul(y7(t.mul(i),n.mul(r),a).length()),u=a.mul(y7(t.mul(o),n.mul(s),l).length());return See(.5,c.add(u)).saturate()})).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),Ose=r7((e=>{let{alpha:t,dotNH:n}=e;const i=t.pow2(),r=n.pow2().mul(i.oneMinus()).oneMinus();return i.div(r.pow2()).mul(1/Math.PI)})).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Use=u7(1/Math.PI),Fse=r7((e=>{let{alphaT:t,alphaB:n,dotNH:i,dotTH:r,dotBH:o}=e;const s=t.mul(n),a=y7(n.mul(r),t.mul(o),s.mul(i)),l=a.dot(a),c=s.div(l);return Use.mul(s.mul(c.pow2()))})).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),zse=r7((e=>{const{lightDirection:t,f0:n,f90:i,roughness:r,f:o,USE_IRIDESCENCE:s,USE_ANISOTROPY:a}=e,l=e.normalView||Oie,c=r.pow2(),u=t.add(Tie).normalize(),h=l.dot(t).clamp(),d=l.dot(Tie).clamp(),p=l.dot(u).clamp(),f=Tie.dot(u).clamp();let m,g,v=Ese({f0:n,f90:i,dotVH:f});if(Y9(s)&&(v=J7.mix(v,o)),Y9(a)){const e=iee.dot(t),n=iee.dot(Tie),i=iee.dot(u),r=ree.dot(t),o=ree.dot(Tie),s=ree.dot(u);m=kse({alphaT:tee,alphaB:c,dotTV:n,dotBV:o,dotTL:e,dotBL:r,dotNV:d,dotNL:h}),g=Fse({alphaT:tee,alphaB:c,dotNH:p,dotTH:i,dotBH:s})}else m=Dse({alpha:c,dotNL:h,dotNV:d}),g=Ose({alpha:c,dotNH:p});return v.mul(m).mul(g)})),jse=r7((e=>{let{roughness:t,dotNV:n}=e;const i=_7(-1,-.0275,-.572,.022),r=_7(1,.0425,1.04,-.04),o=t.mul(i).add(r),s=o.x.mul(o.x).min(n.mul(-9.28).exp2()).mul(o.x).add(o.y);return f7(-1.04,1.04).mul(s).add(o.zw)})).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),Vse=r7((e=>{const{dotNV:t,specularColor:n,specularF90:i,roughness:r}=e,o=jse({dotNV:t,roughness:r});return n.mul(o.x).add(i.mul(o.y))})),Gse=r7((e=>{let{f:t,f90:n,dotVH:i}=e;const r=i.oneMinus().saturate(),o=r.mul(r),s=r.mul(o,o).clamp(0,.9999);return t.sub(y7(n).mul(s)).div(s.oneMinus())})).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Hse=r7((e=>{let{roughness:t,dotNH:n}=e;const i=t.pow2(),r=u7(1).div(i),o=n.pow2().oneMinus().max(.0078125);return u7(2).add(r).mul(o.pow(r.mul(.5))).div(2*Math.PI)})).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Wse=r7((e=>{let{dotNV:t,dotNL:n}=e;return u7(1).div(u7(4).mul(n.add(t).sub(n.mul(t))))})).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Qse=r7((e=>{let{lightDirection:t}=e;const n=t.add(Tie).normalize(),i=Oie.dot(t).clamp(),r=Oie.dot(Tie).clamp(),o=Oie.dot(n).clamp(),s=Hse({roughness:K7,dotNH:o}),a=Wse({dotNV:r,dotNL:i});return Y7.mul(s).mul(a)})),qse=r7((e=>{let{N:t,V:n,roughness:i}=e;const r=t.dot(n).saturate(),o=f7(i,r.oneMinus().sqrt());return o.assign(o.mul(.984375).add(.0078125)),o})).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Xse=r7((e=>{let{f:t}=e;const n=t.length();return Mte(n.mul(n).add(t.z).div(n.add(1)),0)})).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),$se=r7((e=>{let{v1:t,v2:n}=e;const i=t.dot(n),r=i.abs().toVar(),o=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),a=o.div(s),l=i.greaterThan(0).select(a,Mte(i.mul(i).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return t.cross(n).mul(l)})).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),Yse=r7((e=>{let{N:t,V:n,P:i,mInv:r,p0:o,p1:s,p2:a,p3:l}=e;const c=s.sub(o).toVar(),u=l.sub(o).toVar(),h=c.cross(u),d=y7().toVar();return a7(h.dot(i.sub(o)).greaterThanEqual(0),(()=>{const e=n.sub(t.mul(n.dot(t))).normalize(),c=t.cross(e).negate(),u=r.mul(M7(e,c,t).transpose()).toVar(),h=u.mul(o.sub(i)).normalize().toVar(),p=u.mul(s.sub(i)).normalize().toVar(),f=u.mul(a.sub(i)).normalize().toVar(),m=u.mul(l.sub(i)).normalize().toVar(),g=y7(0).toVar();g.addAssign($se({v1:h,v2:p})),g.addAssign($se({v1:p,v2:f})),g.addAssign($se({v1:f,v2:m})),g.addAssign($se({v1:m,v2:h})),d.assign(y7(Xse({f:g})))})),d})).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Kse=1/6,Jse=e=>Eee(Kse,Eee(e,Eee(e,e.negate().add(3)).sub(3)).add(1)),Zse=e=>Eee(Kse,Eee(e,Eee(e,Eee(3,e).sub(6))).add(4)),eae=e=>Eee(Kse,Eee(e,Eee(e,Eee(-3,e).add(3)).add(3)).add(1)),tae=e=>Eee(Kse,Dte(e,3)),nae=e=>Jse(e).add(Zse(e)),iae=e=>eae(e).add(tae(e)),rae=e=>_ee(-1,Zse(e).div(Jse(e).add(Zse(e)))),oae=e=>_ee(1,tae(e).div(eae(e).add(tae(e)))),sae=(e,t,n)=>{const i=e.uvNode,r=Eee(i,t.zw).add(.5),o=ite(r),s=ste(r),a=nae(s.x),l=iae(s.x),c=rae(s.x),u=oae(s.x),h=rae(s.y),d=oae(s.y),p=f7(o.x.add(c),o.y.add(h)).sub(.5).mul(t.xy),f=f7(o.x.add(u),o.y.add(h)).sub(.5).mul(t.xy),m=f7(o.x.add(c),o.y.add(d)).sub(.5).mul(t.xy),g=f7(o.x.add(u),o.y.add(d)).sub(.5).mul(t.xy),v=nae(s.y).mul(_ee(a.mul(e.sample(p).level(n)),l.mul(e.sample(f).level(n)))),y=iae(s.y).mul(_ee(a.mul(e.sample(m).level(n)),l.mul(e.sample(g).level(n))));return v.add(y)},aae=r7((e=>{let[t,n=u7(3)]=e;const i=f7(t.size(h7(n))),r=f7(t.size(h7(n.add(1)))),o=See(1,i),s=See(1,r),a=sae(t,_7(o,i),ite(n)),l=sae(t,_7(s,r),rte(n));return ste(n).mix(a,l)})),lae=r7((e=>{let[t,n,i,r,o]=e;const s=y7(Wte(n.negate(),ote(t),See(1,r))),a=y7(mte(o[0].xyz),mte(o[1].xyz),mte(o[2].xyz));return ote(s).mul(i.mul(a))})).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),cae=r7((e=>{let[t,n]=e;return t.mul(Gte(n.mul(2).sub(2),0,1))})).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),uae=Foe(),hae=Foe(),dae=r7(((e,t)=>{let[n,i,r]=e,{material:o}=t;const s=(o.side===x0.hsX?uae:hae).sample(n),a=ete(Noe.x).mul(cae(i,r));return aae(s,a)})),pae=r7((e=>{let[t,n,i]=e;return a7(i.notEqual(0),(()=>{const e=Zee(n).negate().div(i);return Kee(e.negate().mul(t))})),y7(1)})).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),fae=r7((e=>{let t,n,[i,r,o,s,a,l,c,u,h,d,p,f,m,g,v]=e;if(v){t=_7().toVar(),n=y7().toVar();const e=p.sub(1).mul(v.mul(.025)),a=y7(p.sub(e),p,p.add(e));yoe({start:0,end:3},(e=>{let{i:l}=e;const p=a.element(l),v=lae(i,r,f,p,u),y=c.add(v),A=d.mul(h.mul(_7(y,1))),x=f7(A.xy.div(A.w)).toVar();x.addAssign(1),x.divAssign(2),x.assign(f7(x.x,x.y.oneMinus()));const b=dae(x,o,p);t.element(l).assign(b.element(l)),t.a.addAssign(b.a),n.element(l).assign(s.element(l).mul(pae(mte(v),m,g).element(l)))})),t.a.divAssign(3)}else{const e=lae(i,r,f,p,u),a=c.add(e),l=d.mul(h.mul(_7(a,1))),v=f7(l.xy.div(l.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign(f7(v.x,v.y.oneMinus())),t=dae(v,o,p),n=s.mul(pae(mte(e),m,g))}const y=n.rgb.mul(t.rgb),A=i.dot(r).clamp(),x=y7(Vse({dotNV:A,specularColor:a,specularF90:l,roughness:o})),b=n.r.add(n.g,n.b).div(3);return _7(x.oneMinus().mul(y),t.a.oneMinus().mul(b).oneMinus())})),mae=M7(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),gae=(e,t)=>e.sub(t).div(e.add(t)).pow2(),vae=r7((e=>{let{outsideIOR:t,eta2:n,cosTheta1:i,thinFilmThickness:r,baseF0:o}=e;const s=Vte(t,n,Qte(0,.03,r)),a=t.div(s).pow2().mul(i.pow2().oneMinus()).oneMinus();a7(a.lessThan(0),(()=>y7(1)));const l=a.sqrt(),c=gae(s,t),u=Ese({f0:c,f90:1,dotVH:i}),h=u.oneMinus(),d=s.lessThan(t).select(Math.PI,0),p=u7(Math.PI).sub(d),f=(e=>{const t=e.sqrt();return y7(1).add(t).div(y7(1).sub(t))})(o.clamp(0,.9999)),m=gae(f,s.toVec3()),g=Ese({f0:m,f90:1,dotVH:l}),v=y7(f.x.lessThan(s).select(Math.PI,0),f.y.lessThan(s).select(Math.PI,0),f.z.lessThan(s).select(Math.PI,0)),y=s.mul(r,l,2),A=y7(p).add(v),x=u.mul(g).clamp(1e-5,.9999),b=x.sqrt(),_=h.pow2().mul(g).div(y7(1).sub(x)),w=u.add(_).toVar(),E=_.sub(h).toVar();return yoe({start:1,end:2,condition:"<=",name:"m"},(e=>{let{m:t}=e;E.mulAssign(b);const n=((e,t)=>{const n=e.mul(2*Math.PI*1e-9),i=y7(54856e-17,44201e-17,52481e-17),r=y7(1681e3,1795300,2208400),o=y7(43278e5,93046e5,66121e5),s=u7(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(t.x).cos()).mul(n.pow2().mul(-45282e5).exp());let a=i.mul(o.mul(2*Math.PI).sqrt()).mul(r.mul(n).add(t).cos()).mul(n.pow2().negate().mul(o).exp());return a=y7(a.x.add(s),a.y,a.z).div(1.0685e-7),mae.mul(a)})(u7(t).mul(y),u7(t).mul(A)).mul(2);w.addAssign(E.mul(n))})),w.max(y7(0))})).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),yae=r7((e=>{let{normal:t,viewDir:n,roughness:i}=e;const r=t.dot(n).saturate(),o=i.pow2(),s=Zte(i.lessThan(.25),u7(-339.2).mul(o).add(u7(161.4).mul(i)).sub(25.9),u7(-8.48).mul(o).add(u7(14.3).mul(i)).sub(9.95)),a=Zte(i.lessThan(.25),u7(44).mul(o).sub(u7(23.7).mul(i)).add(3.26),u7(1.97).mul(o).sub(u7(3.27).mul(i)).add(.72));return Zte(i.lessThan(.25),0,u7(.1).mul(i).sub(.025)).add(s.mul(r).add(a).exp()).mul(1/Math.PI).saturate()})),Aae=y7(.04),xae=u7(1);class bae extends xse{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=i,this.transmission=r,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=y7().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=y7().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=y7().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=y7().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=y7().toVar("sheenSpecularIndirect")),!0===this.iridescence){const e=Oie.dot(Tie).clamp();this.iridescenceFresnel=vae({outsideIOR:u7(1),eta2:Z7,cosTheta1:e,thinFilmThickness:eee,baseF0:oee}),this.iridescenceF0=Gse({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(!0===this.transmission){const t=Sie,n=pie.sub(Sie).normalize(),i=Uie,r=e.context;r.backdrop=fae(i,n,Q7,H7,oee,see,t,yie,die,hie,hee,pee,mee,fee,this.dispersion?gee:null),r.backdropAlpha=dee,H7.a.mulAssign(Vte(1,r.backdrop.a,dee))}super.start(e)}computeMultiscattering(e,t,n){const i=Oie.dot(Tie).clamp(),r=jse({roughness:Q7,dotNV:i}),o=(this.iridescenceF0?J7.mix(oee,this.iridescenceF0):oee).mul(r.x).add(n.mul(r.y)),s=r.x.add(r.y).oneMinus(),a=oee.add(oee.oneMinus().mul(.047619)),l=o.mul(a).div(s.mul(a).oneMinus());e.addAssign(o),t.addAssign(l.mul(s))}direct(e){let{lightDirection:t,lightColor:n,reflectedLight:i}=e;const r=Oie.dot(t).clamp().mul(n);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(Qse({lightDirection:t}))),!0===this.clearcoat){const e=Fie.dot(t).clamp().mul(n);this.clearcoatSpecularDirect.addAssign(e.mul(zse({lightDirection:t,f0:Aae,f90:xae,roughness:$7,normalView:Fie})))}i.directDiffuse.addAssign(r.mul(Sse({diffuseColor:H7.rgb}))),i.directSpecular.addAssign(r.mul(zse({lightDirection:t,f0:oee,f90:1,roughness:Q7,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea(e){let{lightColor:t,lightPosition:n,halfWidth:i,halfHeight:r,reflectedLight:o,ltc_1:s,ltc_2:a}=e;const l=n.add(i).sub(r),c=n.sub(i).sub(r),u=n.sub(i).add(r),h=n.add(i).add(r),d=Oie,p=Tie,f=Mie.toVar(),m=qse({N:d,V:p,roughness:Q7}),g=s.sample(m).toVar(),v=a.sample(m).toVar(),y=M7(y7(g.x,0,g.y),y7(0,1,0),y7(g.z,0,g.w)).toVar(),A=oee.mul(v.x).add(oee.oneMinus().mul(v.y)).toVar();o.directSpecular.addAssign(t.mul(A).mul(Yse({N:d,V:p,P:f,mInv:y,p0:l,p1:c,p2:u,p3:h}))),o.directDiffuse.addAssign(t.mul(H7).mul(Yse({N:d,V:p,P:f,mInv:M7(1,0,0,0,1,0,0,0,1),p0:l,p1:c,p2:u,p3:h})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(Sse({diffuseColor:H7})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:i}=e.context;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(n.mul(Y7,yae({normal:Oie,viewDir:Tie,roughness:K7}))),!0===this.clearcoat){const e=Fie.dot(Tie).clamp(),t=Vse({dotNV:e,specularColor:Aae,specularF90:xae,roughness:$7});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(t))}const r=y7().toVar("singleScattering"),o=y7().toVar("multiScattering"),s=n.mul(1/Math.PI);this.computeMultiscattering(r,o,see);const a=r.add(o),l=H7.mul(a.r.max(a.g).max(a.b).oneMinus());i.indirectSpecular.addAssign(t.mul(r)),i.indirectSpecular.addAssign(o.mul(s)),i.indirectDiffuse.addAssign(l.mul(s))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,i=Oie.dot(Tie).clamp().add(t),r=Q7.mul(-16).oneMinus().negate().exp2(),o=t.sub(i.pow(r).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(o)}finish(e){let{context:t}=e;const{outgoingLight:n}=t;if(!0===this.clearcoat){const e=Fie.dot(Tie).clamp(),t=Ese({dotVH:e,f0:Aae,f90:xae}),i=n.mul(X7.mul(t).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(X7));n.assign(i)}if(!0===this.sheen){const e=Y7.r.max(Y7.g).max(Y7.b).mul(.157).oneMinus(),t=n.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);n.assign(t)}}}const _ae=u7(1),wae=u7(-2),Eae=u7(.8),Sae=u7(-1),Cae=u7(.4),Mae=u7(2),Tae=u7(.305),Rae=u7(3),Iae=u7(.21),Pae=u7(4),Bae=u7(4),Lae=u7(16),Nae=r7((e=>{let[t]=e;const n=y7(pte(t)).toVar(),i=u7(-1).toVar();return a7(n.x.greaterThan(n.z),(()=>{a7(n.x.greaterThan(n.y),(()=>{i.assign(Zte(t.x.greaterThan(0),0,3))})).Else((()=>{i.assign(Zte(t.y.greaterThan(0),1,4))}))})).Else((()=>{a7(n.z.greaterThan(n.y),(()=>{i.assign(Zte(t.z.greaterThan(0),2,5))})).Else((()=>{i.assign(Zte(t.y.greaterThan(0),1,4))}))})),i})).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Dae=r7((e=>{let[t,n]=e;const i=f7().toVar();return a7(n.equal(0),(()=>{i.assign(f7(t.z,t.y).div(pte(t.x)))})).ElseIf(n.equal(1),(()=>{i.assign(f7(t.x.negate(),t.z.negate()).div(pte(t.y)))})).ElseIf(n.equal(2),(()=>{i.assign(f7(t.x.negate(),t.y).div(pte(t.z)))})).ElseIf(n.equal(3),(()=>{i.assign(f7(t.z.negate(),t.y).div(pte(t.x)))})).ElseIf(n.equal(4),(()=>{i.assign(f7(t.x.negate(),t.z).div(pte(t.y)))})).Else((()=>{i.assign(f7(t.x,t.y).div(pte(t.z)))})),Eee(.5,i.add(1))})).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),kae=r7((e=>{let[t]=e;const n=u7(0).toVar();return a7(t.greaterThanEqual(Eae),(()=>{n.assign(_ae.sub(t).mul(Sae.sub(wae)).div(_ae.sub(Eae)).add(wae))})).ElseIf(t.greaterThanEqual(Cae),(()=>{n.assign(Eae.sub(t).mul(Mae.sub(Sae)).div(Eae.sub(Cae)).add(Sae))})).ElseIf(t.greaterThanEqual(Tae),(()=>{n.assign(Cae.sub(t).mul(Rae.sub(Mae)).div(Cae.sub(Tae)).add(Mae))})).ElseIf(t.greaterThanEqual(Iae),(()=>{n.assign(Tae.sub(t).mul(Pae.sub(Rae)).div(Tae.sub(Iae)).add(Rae))})).Else((()=>{n.assign(u7(-2).mul(ete(Eee(1.16,t))))})),n})).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),Oae=r7((e=>{let[t,n]=e;const i=t.toVar();i.assign(Eee(2,i).sub(1));const r=y7(i,1).toVar();return a7(n.equal(0),(()=>{r.assign(r.zyx)})).ElseIf(n.equal(1),(()=>{r.assign(r.xzy),r.xz.mulAssign(-1)})).ElseIf(n.equal(2),(()=>{r.x.mulAssign(-1)})).ElseIf(n.equal(3),(()=>{r.assign(r.zyx),r.xz.mulAssign(-1)})).ElseIf(n.equal(4),(()=>{r.assign(r.xzy),r.xy.mulAssign(-1)})).ElseIf(n.equal(5),(()=>{r.z.mulAssign(-1)})),r})).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),Uae=r7((e=>{let[t,n,i,r,o,s]=e;const a=u7(i),l=y7(n),c=Gte(kae(a),wae,s),u=ste(c),h=ite(c),d=y7(Fae(t,l,h,r,o,s)).toVar();return a7(u.notEqual(0),(()=>{const e=y7(Fae(t,l,h.add(1),r,o,s)).toVar();d.assign(Vte(d,e,u))})),d})),Fae=r7((e=>{let[t,n,i,r,o,s]=e;const a=u7(i).toVar(),l=y7(n),c=u7(Nae(l)).toVar(),u=u7(Mte(Bae.sub(a),0)).toVar();a.assign(Mte(a,Bae));const h=u7(Jee(a)).toVar(),d=f7(Dae(l,c).mul(h.sub(2)).add(1)).toVar();return a7(c.greaterThan(2),(()=>{d.y.addAssign(h),c.subAssign(3)})),d.x.addAssign(c.mul(h)),d.x.addAssign(u.mul(Eee(3,Lae))),d.y.addAssign(Eee(4,Jee(s).sub(h))),d.x.mulAssign(r),d.y.mulAssign(o),t.sample(d).grad(f7(),f7())})),zae=r7((e=>{let{envMap:t,mipInt:n,outputDirection:i,theta:r,axis:o,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:l}=e;const c=lte(r),u=i.mul(c).add(o.cross(i).mul(ate(r))).add(o.mul(o.dot(i).mul(c.oneMinus())));return Fae(t,u,n,s,a,l)})),jae=r7((e=>{let{n:t,latitudinal:n,poleAxis:i,outputDirection:r,weights:o,samples:s,dTheta:a,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}=e;const p=y7(Zte(n,i,Nte(i,r))).toVar();a7(qee(p.equals(y7(0))),(()=>{p.assign(y7(r.z,0,r.x.negate()))})),p.assign(ote(p));const f=y7().toVar();return f.addAssign(o.element(0).mul(zae({theta:0,axis:p,outputDirection:r,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}))),yoe({start:h7(1),end:t},(e=>{let{i:t}=e;a7(t.greaterThanEqual(s),(()=>{Aoe()}));const n=u7(a.mul(u7(t))).toVar();f.addAssign(o.element(t).mul(zae({theta:n.mul(-1),axis:p,outputDirection:r,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d}))),f.addAssign(o.element(t).mul(zae({theta:n,axis:p,outputDirection:r,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d})))})),_7(f,1)})),Vae=[.125,.215,.35,.446,.526,.582],Gae=20,Hae=new x0.qUd(-1,1,1,-1,0,1),Wae=new x0.ubm(90,1),Qae=new x0.Q1f;let qae=null,Xae=0,$ae=0;const Yae=(1+Math.sqrt(5))/2,Kae=1/Yae,Jae=[new x0.Pq0(-Yae,Kae,0),new x0.Pq0(Yae,Kae,0),new x0.Pq0(-Kae,0,Yae),new x0.Pq0(Kae,0,Yae),new x0.Pq0(0,Yae,-Kae),new x0.Pq0(0,Yae,Kae),new x0.Pq0(-1,1,-1),new x0.Pq0(1,1,-1),new x0.Pq0(-1,1,1),new x0.Pq0(1,1,1)],Zae=new x0.Pq0,ele=new WeakMap,tle=[3,1,5,0,4,2],nle=Oae($ne(),Xne("faceIndex")).normalize(),ile=y7(nle.x,nle.y,nle.z);class rle{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{size:o=256,position:s=Zae,renderTarget:a=null}=r;if(this._setSize(o),!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const o=a||this._allocateTargets();return r.renderTarget=o,this.fromSceneAsync(e,t,n,i,r),o}qae=this._renderer.getRenderTarget(),Xae=this._renderer.getActiveCubeFace(),$ae=this._renderer.getActiveMipmapLevel();const l=a||this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,i,l,s),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}async fromSceneAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return!1===this._hasInitialized&&await this._renderer.init(),this.fromScene(e,t,n,i,r)}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=lle(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=cle(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===x0.hy7||e.mapping===x0.xFO?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(qae,Xae,$ae),e.scissorTest=!1,sle(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),qae=this._renderer.getRenderTarget(),Xae=this._renderer.getActiveCubeFace(),$ae=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:x0.k6q,minFilter:x0.k6q,generateMipmaps:!1,type:x0.ix0,format:x0.GWd,colorSpace:x0.Zr2},i=ole(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ole(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(e){const t=[],n=[],i=[],r=[];let o=e;const s=e-4+1+Vae.length;for(let a=0;a<s;a++){const s=Math.pow(2,o);n.push(s);let l=1/s;a>e-4?l=Vae[a-e+4-1]:0===a&&(l=0),i.push(l);const c=1/(s-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),A=new Float32Array(g*f*p),x=new Float32Array(v*f*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0],r=tle[e];y.set(i,m*f*r),A.set(d,g*f*r);const o=[r,r,r,r,r,r];x.set(o,v*f*r)}const b=new x0.LoY;b.setAttribute("position",new x0.THS(y,m)),b.setAttribute("uv",new x0.THS(A,g)),b.setAttribute("faceIndex",new x0.THS(x,v)),t.push(b),r.push(new x0.eaF(b,null)),o>4&&o--}return{lodPlanes:t,sizeLods:n,sigmas:i,lodMeshes:r}}(i)),this._blurMaterial=function(e,t,n){const i=aie(new Array(Gae).fill(0)),r=z7(new x0.Pq0(0,1,0)),o=z7(0),s=u7(Gae),a=z7(0),l=z7(1),c=tie(null),u=z7(0),h=u7(1/t),d=u7(1/n),p=u7(e),f={n:s,latitudinal:a,weights:i,poleAxis:r,outputDirection:ile,dTheta:o,samples:l,envMap:c,mipInt:u,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p},m=ale("blur");return m.fragmentNode=jae({...f,latitudinal:a.equal(1)}),ele.set(m,f),m}(i,e,t)}return i}async _compileMaterial(e){const t=new x0.eaF(this._lodPlanes[0],e);await this._renderer.compile(t,Hae)}_sceneToCubeUV(e,t,n,i,r){const o=Wae;o.near=t,o.far=n;const s=[1,1,1,1,-1,1],a=[1,-1,1,-1,1,-1],l=this._renderer,c=l.autoClear;l.getClearColor(Qae),l.autoClear=!1;let u=this._backgroundBox;if(null===u){const e=new x0.V9B({name:"PMREM.Background",side:x0.hsX,depthWrite:!1,depthTest:!1});u=new x0.eaF(new x0.iNn,e)}let h=!1;const d=e.background;d?d.isColor&&(u.material.color.copy(d),e.background=null,h=!0):(u.material.color.copy(Qae),h=!0),l.setRenderTarget(i),l.clear(),h&&l.render(u,o);for(let p=0;p<6;p++){const t=p%3;0===t?(o.up.set(0,s[p],0),o.position.set(r.x,r.y,r.z),o.lookAt(r.x+a[p],r.y,r.z)):1===t?(o.up.set(0,0,s[p]),o.position.set(r.x,r.y,r.z),o.lookAt(r.x,r.y+a[p],r.z)):(o.up.set(0,s[p],0),o.position.set(r.x,r.y,r.z),o.lookAt(r.x,r.y,r.z+a[p]));const n=this._cubeSize;sle(i,t*n,p>2?n:0,n,n),l.render(e,o)}l.autoClear=c,e.background=d}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===x0.hy7||e.mapping===x0.xFO;i?null===this._cubemapMaterial&&(this._cubemapMaterial=lle(e)):null===this._equirectMaterial&&(this._equirectMaterial=cle(e));const r=i?this._cubemapMaterial:this._equirectMaterial;r.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=r;const s=this._cubeSize;sle(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(o,Hae)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=Jae[(i-r-1)%Jae.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=this._lodMeshes[i];c.material=l;const u=ele.get(l),h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Gae;f>Gae&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let A=0;A<Gae;++A){const e=A/p,t=Math.exp(-e*e/2);m.push(t),0===A?g+=t:A<f&&(g+=2*t)}for(let A=0;A<m.length;A++)m[A]=m[A]/g;e.texture.frame=(e.texture.frame||0)+1,u.envMap.value=e.texture,u.samples.value=f,u.weights.array=m,u.latitudinal.value="latitudinal"===o?1:0,s&&(u.poleAxis.value=s);const{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;const y=this._sizeLods[i];sle(t,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(c,Hae)}}function ole(e,t,n){const i=new x0.O0B(e,t,n);return i.texture.mapping=x0.Om,i.texture.name="PMREM.cubeUv",i.texture.isPMREMTexture=!0,i.scissorTest=!0,i}function sle(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function ale(e){const t=new nse;return t.depthTest=!1,t.depthWrite=!1,t.blending=x0.XIg,t.name=`PMREM_${e}`,t}function lle(e){const t=ale("cubemap");return t.fragmentNode=Jie(e,ile),t}function cle(e){const t=ale("equirect");return t.fragmentNode=tie(e,hse(ile),0),t}const ule=new WeakMap;function hle(e,t,n){const i=function(e){let t=ule.get(e);void 0===t&&(t=new WeakMap,ule.set(e,t));return t}(t);let r=i.get(e);if((void 0!==r?r.pmremVersion:-1)!==e.pmremVersion){const t=e.image;if(e.isCubeTexture){if(!function(e){if(null===e||void 0===e)return!1;let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(t))return null;r=n.fromCubemap(e,r)}else{if(!function(e){return null!==e&&void 0!==e&&e.height>0}(t))return null;r=n.fromEquirectangular(e,r)}r.pmremVersion=e.pmremVersion,i.set(e,r)}return r.texture}class dle extends f9{static get type(){return"PMREMNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const i=new x0.gPd;i.isRenderTargetTexture=!0,this._texture=tie(i),this._width=z7(0),this._height=z7(0),this._maxMip=z7(0),this.updateBeforeType=r9.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=function(e){const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,i=this._value;n!==i.pmremVersion&&(t=!0===i.isPMREMTexture?i:hle(i,e.renderer,this._generator),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){null===this._generator&&(this._generator=new rle(e.renderer)),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this)),t=Qie.mul(y7(t.x,t.y.negate(),t.z));let n=this.levelNode;return null===n&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),Uae(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}const ple=n7(dle),fle=new WeakMap;class mle extends Soe{static get type(){return"EnvironmentNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const e=n.isTextureNode?n.value:t[n.property];let i=fle.get(e);void 0===i&&(i=ple(e),fle.set(e,i)),n=i}const i=!0===t.useAnisotropy||t.anisotropy>0?hre:Oie,r=n.context(gle(Q7,i)).mul(Wie),o=n.context(vle(Uie)).mul(Math.PI).mul(Wie),s=kne(r),a=kne(o);e.context.radiance.addAssign(s),e.context.iblIrradiance.addAssign(a);const l=e.context.lightingModel.clearcoatRadiance;if(l){const e=n.context(gle($7,Fie)).mul(Wie),t=kne(e);l.addAssign(t)}}}const gle=(e,t)=>{let n=null;return{getUV:()=>(null===n&&(n=Tie.negate().reflect(t),n=e.mul(e).mix(n,t).normalize(),n=n.transformDirection(die)),n),getTextureLevel:()=>e}},vle=e=>({getUV:()=>e,getTextureLevel:()=>u7(1)}),yle=new x0._4j;class Ale extends nse{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(yle),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return null===t&&e.environmentNode&&(t=e.environmentNode),t?new mle(t):null}setupLightingModel(){return new bae}setupSpecular(){const e=Vte(y7(.04),H7.rgb,q7);oee.assign(e),see.assign(1)}setupVariants(){const e=this.metalnessNode?u7(this.metalnessNode):Bre;q7.assign(e);let t=this.roughnessNode?u7(this.roughnessNode):Pre;t=Nse({roughness:t}),Q7.assign(t),this.setupSpecular(),H7.assign(_7(H7.rgb.mul(e.oneMinus()),H7.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const xle=new x0.uSd;class ble extends Ale{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(xle),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const e=this.iorNode?u7(this.iorNode):Qre;hee.assign(e),oee.assign(Vte(Cte(kte(hee.sub(1).div(hee.add(1))).mul(Tre),y7(1)).mul(Mre),H7.rgb,q7)),see.assign(Vte(Mre,1,q7))}setupLightingModel(){return new bae(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const e=this.clearcoatNode?u7(this.clearcoatNode):Nre,t=this.clearcoatRoughnessNode?u7(this.clearcoatRoughnessNode):Dre;X7.assign(e),$7.assign(Nse({roughness:t}))}if(this.useSheen){const e=this.sheenNode?y7(this.sheenNode):Ure,t=this.sheenRoughnessNode?u7(this.sheenRoughnessNode):Fre;Y7.assign(e),K7.assign(t)}if(this.useIridescence){const e=this.iridescenceNode?u7(this.iridescenceNode):jre,t=this.iridescenceIORNode?u7(this.iridescenceIORNode):Vre,n=this.iridescenceThicknessNode?u7(this.iridescenceThicknessNode):Gre;J7.assign(e),Z7.assign(t),eee.assign(n)}if(this.useAnisotropy){const e=(this.anisotropyNode?f7(this.anisotropyNode):zre).toVar();nee.assign(e.length()),a7(nee.equal(0),(()=>{e.assign(f7(1,0))})).Else((()=>{e.divAssign(f7(nee)),nee.assign(nee.saturate())})),tee.assign(nee.pow2().mix(Q7.pow2(),1)),iee.assign(ure[0].mul(e.x).add(ure[1].mul(e.y))),ree.assign(ure[1].mul(e.x).sub(ure[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?u7(this.transmissionNode):Hre,t=this.thicknessNode?u7(this.thicknessNode):Wre,n=this.attenuationDistanceNode?u7(this.attenuationDistanceNode):qre,i=this.attenuationColorNode?y7(this.attenuationColorNode):Xre;if(dee.assign(e),pee.assign(t),fee.assign(n),mee.assign(i),this.useDispersion){const e=this.dispersionNode?u7(this.dispersionNode):eoe;gee.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?y7(this.clearcoatNormalNode):kre}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const _le=r7((e=>{let{normal:t,lightDirection:n,builder:i}=e;const r=t.dot(n),o=f7(r.mul(.5).add(.5),0);if(i.material.gradientMap){const e=rre("gradientMap","texture").context({getUV:()=>o});return y7(e.r)}{const e=o.fwidth().mul(.5);return Vte(y7(.7),y7(1),Qte(u7(.7).sub(e.x),u7(.7).add(e.x),o.x))}}));class wle extends xse{direct(e,t){let{lightDirection:n,lightColor:i,reflectedLight:r}=e;const o=_le({normal:Bie,lightDirection:n,builder:t}).mul(i);r.directDiffuse.addAssign(o.mul(Sse({diffuseColor:H7.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul(Sse({diffuseColor:H7}))),i.indirectDiffuse.mulAssign(t)}}const Ele=new x0.Df;class Sle extends nse{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Ele),this.setValues(e)}setupLightingModel(){return new wle}}class Cle extends f9{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=y7(Tie.z,0,Tie.x.negate()).normalize(),t=Tie.cross(e);return f7(e.dot(Oie),t.dot(Oie)).mul(.495).add(.5)}}const Mle=i7(Cle),Tle=new x0.FNr;class Rle extends nse{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Tle),this.setValues(e)}setupVariants(e){const t=Mle;let n;n=e.material.matcap?rre("matcap","texture").context({getUV:()=>t}):y7(Vte(.2,.8,t.y)),H7.rgb.mulAssign(n.rgb)}}class Ile extends f9{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if("vec2"===this.getNodeType(e)){const e=t.cos(),i=t.sin();return C7(e,i,i.negate(),e).mul(n)}{const e=t,i=T7(_7(1,0,0,0),_7(0,lte(e.x),ate(e.x).negate(),0),_7(0,ate(e.x),lte(e.x),0),_7(0,0,0,1)),r=T7(_7(lte(e.y),0,ate(e.y),0),_7(0,1,0,0),_7(ate(e.y).negate(),0,lte(e.y),0),_7(0,0,0,1)),o=T7(_7(lte(e.z),ate(e.z).negate(),0,0),_7(ate(e.z),lte(e.z),0,0),_7(0,0,1,0),_7(0,0,0,1));return i.mul(r).mul(o).mul(_7(n,1)).xyz}}}const Ple=n7(Ile),Ble=new x0.RoJ;class Lle extends nse{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Ble),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,i=this.sizeAttenuation,{positionNode:r,rotationNode:o,scaleNode:s}=this,a=xie.mul(y7(r||0));let l=f7(yie[0].xyz.length(),yie[1].xyz.length());if(null!==s&&(l=l.mul(f7(s))),!1===i)if(n.isPerspectiveCamera)l=l.mul(a.z.negate());else{const e=u7(2).div(hie.element(1).element(1));l=l.mul(e.mul(2))}let c=_ie.xy;if(t.center&&!0===t.center.isVector2){const e=((e,t,n)=>Z9(new _ne(e,t,n)))("center","vec2",t);c=c.sub(e.sub(.5))}c=c.mul(l);const u=u7(o||Ore),h=Ple(c,u);return _7(a.xy.add(h),a.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Nle=new x0.BH$;class Dle extends Lle{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Nle),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return xie.mul(y7(e||wie)).xyz}setupVertex(e){const t=super.setupVertex(e);if(!0!==e.material.isNodeMaterial)return t;const{rotationNode:n,scaleNode:i,sizeNode:r}=this,o=_ie.xy.toVar(),s=koe.z.div(koe.w);if(n&&n.isNode){const e=u7(n);o.assign(Ple(o,e))}let a=null!==r?f7(r):Zre;return!0===this.sizeAttenuation&&(a=a.mul(a.div(Mie.z.negate()))),i&&i.isNode&&(a=a.mul(f7(i))),o.mulAssign(a.mul(2)),o.assign(o.div(koe.z)),o.y.assign(o.y.mul(s)),o.assign(o.mul(t.w)),t.addAssign(_7(o,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class kle extends xse{constructor(){super(),this.shadowNode=u7(1).toVar("shadowMask")}direct(e){let{shadowMask:t}=e;this.shadowNode.mulAssign(t)}finish(e){H7.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(H7.rgb)}}const Ole=new x0.q2;class Ule extends nse{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Ole),this.setValues(e)}setupLightingModel(){return new kle}}V7("vec3"),V7("vec3"),V7("vec3");class Fle{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this._animationLoop&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class zle{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let i=0;i<e.length-1;i++){const t=e[i];!1===n.has(t)&&n.set(t,new WeakMap),n=n.get(t)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return!1;return t.delete(e[e.length-1])}}let jle=0;class Vle{constructor(e,t,n,i,r,o,s,a,l,c){this.id=jle++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=i,this.material=r,this.scene=o,this.camera=s,this.lightsNode=a,this.context=l,this.geometry=i.geometry,this.version=r.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=null!==c?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(null!==this.attributes)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],i=new Set;for(const r of e){const e=r.node&&r.node.attribute?r.node.attribute:t.getAttribute(r.name);if(void 0===e)continue;n.push(e);const o=e.isInterleavedBufferAttribute?e.data:e;i.add(o)}return this.attributes=n,this.vertexBuffers=Array.from(i.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:i,drawRange:r}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),s=this.getIndex(),a=null!==s,l=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(0===l)return null;if(o.instanceCount=l,!0===e.isBatchedMesh)return o;let c=1;!0!==t.wireframe||e.isPoints||e.isLineSegments||e.isLine||e.isLineLoop||(c=2);let u=r.start*c,h=(r.start+r.count)*c;null!==i&&(u=Math.max(u,i.start*c),h=Math.min(h,(i.start+i.count)*c));const d=n.attributes.position;let p=1/0;a?p=s.count:void 0!==d&&null!==d&&(p=d.count),u=Math.max(u,0),h=Math.min(h,p);const f=h-u;return f<0||f===1/0?null:(o.vertexCount=f,o.firstVertex=u,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const i=e.attributes[n];t+=n+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[n];t+="morph-"+n+",";for(let e=0,n=i.length;e<n;e++){t+=i[e].id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const i of function(e){const t=Object.keys(e);let n=Object.getPrototypeOf(e);for(;n;){const e=Object.getOwnPropertyDescriptors(n);for(const n in e)if(void 0!==e[n]){const i=e[n];i&&"function"===typeof i.get&&t.push(n)}n=Object.getPrototypeOf(n)}return t}(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const e=t[i];let r;if(null!==e){const t=typeof e;"number"===t?r=0!==e?"1":"0":"object"===t?(r="{",e.isTexture&&(r+=e.mapping),r+="}"):r=String(e)}else r=String(e);n+=r+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",null!==e._colorsTexture&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",H8(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return!0!==this.material.isShadowPassMaterial&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=Q8(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=Q8(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Gle=[];class Hle{constructor(e,t,n,i,r,o){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=i,this.bindings=r,this.info=o,this.chainMaps={}}get(e,t,n,i,r,o,s,a){const l=this.getChainMap(a);Gle[0]=e,Gle[1]=t,Gle[2]=o,Gle[3]=r;let c=l.get(Gle);return void 0===c?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,i,r,o,s,a),l.set(Gle,c)):(c.updateClipping(s),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,n,i,r,o,s,a)):c.version=t.version)),Gle.length=0,c}getChainMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return this.chainMaps[e]||(this.chainMaps[e]=new zle)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,i,r,o,s,a,l,c,u){const h=this.getChainMap(u),d=new Vle(e,t,n,i,r,o,s,a,l,c);return d.onDispose=()=>{this.pipelines.delete(d),this.bindings.delete(d),this.nodes.delete(d),h.delete(d.getChainArray())},d}}class Wle{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Qle=1,qle=2,Xle=3,$le=4,Yle=16;class Kle extends Wle{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return void 0!==t&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(void 0===n.version)t===Qle?this.backend.createAttribute(e):t===qle?this.backend.createIndexAttribute(e):t===Xle?this.backend.createStorageAttribute(e):t===$le&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const t=this._getBufferAttribute(e);(n.version<t.version||t.usage===x0.Vnu)&&(this.backend.updateAttribute(e),n.version=t.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function Jle(e){return null!==e.index?e.index.version:e.attributes.position.version}function Zle(e){const t=[],n=e.index,i=e.attributes.position;if(null!==n){const e=n.array;for(let n=0,i=e.length;n<i;n+=3){const i=e[n+0],r=e[n+1],o=e[n+2];t.push(i,r,r,o,o,i)}}else{for(let e=0,n=i.array.length/3-1;e<n;e+=3){const n=e+0,i=e+1,r=e+2;t.push(n,i,i,r,r,n)}}const r=new((0,x0.AQS)(t)?x0.MW4:x0.A$4)(t,1);return r.version=Jle(e),r}class ece extends Wle{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&!0===this.get(t).initialized}updateForRender(e){!1===this.has(e)&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry;this.get(t).initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const i=t.index,r=e.getAttributes();null!==i&&this.attributes.delete(i);for(const e of r)this.attributes.delete(e);const o=this.wireframes.get(t);void 0!==o&&this.attributes.delete(o),t.removeEventListener("dispose",n)};t.addEventListener("dispose",n)}updateAttributes(e){const t=e.getAttributes();for(const r of t)r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute?this.updateAttribute(r,Xle):this.updateAttribute(r,Qle);const n=this.getIndex(e);null!==n&&this.updateAttribute(n,qle);const i=e.geometry.indirect;null!==i&&this.updateAttribute(i,$le)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?void 0===this.attributeCall.get(e)?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let i=t.index;if(!0===n.wireframe){const e=this.wireframes;let n=e.get(t);void 0===n?(n=Zle(t),e.set(t,n)):n.version!==Jle(t)&&(this.attributes.delete(n),n=Zle(t),e.set(t,n)),i=n}return i}}class tce{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class nce{constructor(e){this.cacheKey=e,this.usedTimes=0}}class ice extends nce{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class rce extends nce{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let oce=0;class sce{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.id=oce++,this.code=e,this.stage=t,this.name=n,this.transforms=i,this.attributes=r,this.usedTimes=0}}class ace extends Wle{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const r=i.pipeline;r&&(r.usedTimes--,r.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let s=this.programs.compute.get(o.computeShader);void 0===s&&(r&&0===r.computeProgram.usedTimes&&this._releaseProgram(r.computeProgram),s=new sce(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,s),n.createProgram(s));const a=this._getComputeCacheKey(e,s);let l=this.caches.get(a);void 0===l&&(r&&0===r.usedTimes&&this._releasePipeline(r),l=this._getComputePipeline(e,s,a,t)),l.usedTimes++,s.usedTimes++,i.version=e.version,i.pipeline=l}return i.pipeline}getForRender(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{backend:n}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const r=i.pipeline;r&&(r.usedTimes--,r.vertexProgram.usedTimes--,r.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),s=e.material?e.material.name:"";let a=this.programs.vertex.get(o.vertexShader);void 0===a&&(r&&0===r.vertexProgram.usedTimes&&this._releaseProgram(r.vertexProgram),a=new sce(o.vertexShader,"vertex",s),this.programs.vertex.set(o.vertexShader,a),n.createProgram(a));let l=this.programs.fragment.get(o.fragmentShader);void 0===l&&(r&&0===r.fragmentProgram.usedTimes&&this._releaseProgram(r.fragmentProgram),l=new sce(o.fragmentShader,"fragment",s),this.programs.fragment.set(o.fragmentShader,l),n.createProgram(l));const c=this._getRenderCacheKey(e,a,l);let u=this.caches.get(c);void 0===u?(r&&0===r.usedTimes&&this._releasePipeline(r),u=this._getRenderPipeline(e,a,l,c,t)):e.pipeline=u,u.usedTimes++,a.usedTimes++,l.usedTimes++,i.pipeline=u}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,0===t.usedTimes&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,0===t.computeProgram.usedTimes&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,0===t.vertexProgram.usedTimes&&this._releaseProgram(t.vertexProgram),0===t.fragmentProgram.usedTimes&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,i){n=n||this._getComputeCacheKey(e,t);let r=this.caches.get(n);return void 0===r&&(r=new rce(n,t),this.caches.set(n,r),this.backend.createComputePipeline(r,i)),r}_getRenderPipeline(e,t,n,i,r){i=i||this._getRenderCacheKey(e,t,n);let o=this.caches.get(i);return void 0===o&&(o=new ice(i,t,n),this.caches.set(i,o),e.pipeline=o,this.backend.createRenderPipeline(e,r)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return void 0===t.pipeline||t.version!==e.version}_needsRenderUpdate(e){return void 0===this.get(e).pipeline||this.backend.needsRenderUpdate(e)}}class lce extends Wle{constructor(e,t,n,i,r,o){super(),this.backend=e,this.textures=n,this.pipelines=r,this.attributes=i,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const e=this.get(n);void 0===e.bindGroup&&(this._init(n),this.backend.createBindings(n,t,0),e.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const e=this.get(n);void 0===e.bindGroup&&(this._init(n),this.backend.createBindings(n,t,0),e.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const e=t.attribute,n=e.isIndirectStorageBufferAttribute?$le:Xle;this.attributes.update(e,n)}}_update(e,t){const{backend:n}=this;let i=!1,r=!0,o=0,s=0;for(const a of e.bindings){if(a.isNodeUniformsGroup){if(!1===this.nodes.updateGroup(a))continue}if(a.isStorageBuffer){const e=a.attribute,t=e.isIndirectStorageBufferAttribute?$le:Xle;this.attributes.update(e,t)}if(a.isUniformBuffer){a.update()&&n.updateBinding(a)}else if(a.isSampler)a.update();else if(a.isSampledTexture){const e=this.textures.get(a.texture);a.needsBindingsUpdate(e.generation)&&(i=!0);const t=a.update(),l=a.texture;t&&this.textures.updateTexture(l);const c=n.get(l);if(void 0!==c.externalTexture||e.isDefaultTexture?r=!1:(o=10*o+l.id,s+=l.version),!0===n.isWebGPUBackend&&void 0===c.texture&&void 0===c.externalTexture&&(console.error("Bindings._update: binding should be available:",a,t,l,a.textureNode.value,i),this.textures.updateTexture(l),i=!0),!0===l.isStorageTexture){const e=this.get(l);!0===a.store?e.needsMipmap=!0:this.textures.needsMipmaps(l)&&!0===e.needsMipmap&&(this.backend.generateMipmaps(l),e.needsMipmap=!1)}}}!0===i&&this.backend.updateBindings(e,t,r?o:0,s)}}function cce(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function uce(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function hce(e){return(e.transmission>0||e.transmissionNode)&&e.side===x0.$EB&&!1===e.forceSinglePass}class dce{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,i,r,o,s){let a=this.renderItems[this.renderItemsIndex];return void 0===a?(a={id:e.id,object:e,geometry:t,material:n,groupOrder:i,renderOrder:e.renderOrder,z:r,group:o,clippingContext:s},this.renderItems[this.renderItemsIndex]=a):(a.id=e.id,a.object=e,a.geometry=t,a.material=n,a.groupOrder=i,a.renderOrder=e.renderOrder,a.z=r,a.group=o,a.clippingContext=s),this.renderItemsIndex++,a}push(e,t,n,i,r,o,s){const a=this.getNextRenderItem(e,t,n,i,r,o,s);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0?(hce(n)&&this.transparentDoublePass.push(a),this.transparent.push(a)):this.opaque.push(a)}unshift(e,t,n,i,r,o,s){const a=this.getNextRenderItem(e,t,n,i,r,o,s);!0===n.transparent||n.transmission>0?(hce(n)&&this.transparentDoublePass.unshift(a),this.transparent.unshift(a)):this.opaque.unshift(a)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||cce),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||uce),this.transparent.length>1&&this.transparent.sort(t||uce)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const t=this.renderItems[e];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.groupOrder=null,t.renderOrder=null,t.z=null,t.group=null,t.clippingContext=null}}}const pce=[];class fce{constructor(e){this.lighting=e,this.lists=new zle}get(e,t){const n=this.lists;pce[0]=e,pce[1]=t;let i=n.get(pce);return void 0===i&&(i=new dce(this.lighting,e,t),n.set(pce,i)),pce.length=0,i}dispose(){this.lists=new zle}}let mce=0;class gce{constructor(){this.id=mce++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new x0.IUQ,this.scissor=!1,this.scissorValue=new x0.IUQ,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return vce(this)}}function vce(e){const{textures:t,activeCubeFace:n}=e,i=[n];for(const r of t)i.push(r.id);return W8(i)}const yce=[],Ace=new x0.Z58,xce=new x0.i7d;class bce{constructor(){this.chainMaps={}}get(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(yce[0]=e,yce[1]=t,null===i)n="default";else{const e=i.texture.format;n=`${i.textures.length}:${e}:${i.samples}:${i.depthBuffer}:${i.stencilBuffer}`}const r=this._getChainMap(n);let o=r.get(yce);return void 0===o&&(o=new gce,r.set(yce,o)),yce.length=0,null!==i&&(o.sampleCount=0===i.samples?1:i.samples),o}getForClear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.get(Ace,xce,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new zle)}dispose(){this.chainMaps={}}}const _ce=new x0.Pq0;class wce extends Wle{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.get(e),i=0===e.samples?1:e.samples,r=n.depthTextureMips||(n.depthTextureMips={}),o=e.textures,s=this.getSize(o[0]),a=s.width>>t,l=s.height>>t;let c=e.depthTexture||r[t];const u=!0===e.depthBuffer||!0===e.stencilBuffer;let h=!1;void 0===c&&u&&(c=new x0.VCu,c.format=e.stencilBuffer?x0.dcC:x0.zdS,c.type=e.stencilBuffer?x0.V3x:x0.bkx,c.image.width=a,c.image.height=l,r[t]=c),n.width===s.width&&s.height===n.height||(h=!0,c&&(c.needsUpdate=!0,c.image.width=a,c.image.height=l)),n.width=s.width,n.height=s.height,n.textures=o,n.depthTexture=c||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==i&&(h=!0,c&&(c.needsUpdate=!0),n.sampleCount=i);const d={sampleCount:i};if(!0!==e.isXRRenderTarget){for(let e=0;e<o.length;e++){const t=o[e];h&&(t.needsUpdate=!0),this.updateTexture(t,d)}c&&this.updateTexture(c,d)}if(!0!==n.initialized){n.initialized=!0;const t=()=>{e.removeEventListener("dispose",t);for(let e=0;e<o.length;e++)this._destroyTexture(o[e]);c&&this._destroyTexture(c),this.delete(e)};e.addEventListener("dispose",t)}}updateTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.get(e);if(!0===n.initialized&&n.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,r=this.backend;if(i&&!0===n.initialized&&(r.destroySampler(e),r.destroyTexture(e)),e.isFramebufferTexture){const t=this.renderer.getRenderTarget();e.type=t?t.texture.type:x0.OUM}const{width:o,height:s,depth:a}=this.getSize(e);if(t.width=o,t.height=s,t.depth=a,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,s):1,i||!0===e.isStorageTexture)r.createSampler(e),r.createTexture(e,t),n.generation=e.version;else{if(!0!==n.initialized&&r.createSampler(e),e.version>0){const i=e.image;if(void 0===i)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===i.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const n=[];for(const t of e.images)n.push(t);t.images=n}else t.image=i;void 0!==n.isDefaultTexture&&!0!==n.isDefaultTexture||(r.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),!0===e.source.dataReady&&r.updateTexture(e,t),t.needsMipmaps&&0===e.mipmaps.length&&r.generateMipmaps(e)}}else r.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version}if(!0!==n.initialized){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const t=()=>{e.removeEventListener("dispose",t),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",t)}n.version=e.version}getSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_ce,n=e.images?e.images[0]:e.image;return n?(void 0!==n.image&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let i;return i=e.isCompressedTexture?e.mipmaps?e.mipmaps.length:1:Math.floor(Math.log2(Math.max(t,n)))+1,i}needsMipmaps(e){return this.isEnvironmentTexture(e)||!0===e.isCompressedTexture||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===x0.wfO||t===x0.uV5||t===x0.hy7||t===x0.xFO}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class Ece extends x0.Q1f{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,n),this.a=i}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.a=i,super.set(e,t,n)}copy(e){return void 0!==e.a&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class Sce extends j7{static get type(){return"ParameterNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class Cce extends h9{static get type(){return"StackNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new J9(t);return this._currentCond=Zte(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new J9(t),i=Zte(e,n);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new J9(e),this}build(e){const t=s7();o7(this);for(const o of this.nodes)o.build(e,"void");o7(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.outputNode?this.outputNode.build(e,...i):super.build(e,...i)}else(){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...arguments)}elseif(){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...arguments)}}const Mce=n7(Cce);new x0.Zcv,new x0.Pq0,new x0.Pq0,new x0.Pq0,new x0.kn4,new x0.Pq0(0,0,-1),new x0.IUQ,new x0.Pq0,new x0.Pq0,new x0.IUQ,new x0.I9Y;const Tce=new x0.O0B;Loe.flipX();Tce.depthTexture=new x0.VCu(1,1);const Rce=new x0.qUd(-1,1,1,-1,0,1);class Ice extends x0.LoY{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super();const t=!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new x0.qtW([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new x0.qtW(t,2))}}const Pce=new Ice;class Bce extends x0.eaF{constructor(){super(Pce,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.camera=Rce,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,Rce)}render(e){e.render(this,Rce)}}x0.uWO;x0.THS;const Lce=new x0.O9p,Nce=new x0.kn4;class Dce extends h9{static get type(){return"SceneNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Dce.BACKGROUND_BLURRINESS,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=null!==this.scene?this.scene:e.scene;let i;return t===Dce.BACKGROUND_BLURRINESS?i=tre("backgroundBlurriness","float",n):t===Dce.BACKGROUND_INTENSITY?i=tre("backgroundIntensity","float",n):t===Dce.BACKGROUND_ROTATION?i=z7("mat4").label("backgroundRotation").setGroup(O7).onRenderUpdate((()=>{const e=n.background;return null!==e&&e.isTexture&&e.mapping!==x0.UTZ?(Lce.copy(n.backgroundRotation),Lce.x*=-1,Lce.y*=-1,Lce.z*=-1,Nce.makeRotationFromEuler(Lce)):Nce.identity(),Nce})):console.error("THREE.SceneNode: Unknown scope:",t),i}}Dce.BACKGROUND_BLURRINESS="backgroundBlurriness",Dce.BACKGROUND_INTENSITY="backgroundIntensity",Dce.BACKGROUND_ROTATION="backgroundRotation";const kce=i7(Dce,Dce.BACKGROUND_BLURRINESS),Oce=i7(Dce,Dce.BACKGROUND_INTENSITY),Uce=i7(Dce,Dce.BACKGROUND_ROTATION);r7((e=>{let{texture:t,uv:n}=e;const i=1e-4,r=y7().toVar();return a7(n.x.lessThan(i),(()=>{r.assign(y7(1,0,0))})).ElseIf(n.y.lessThan(i),(()=>{r.assign(y7(0,1,0))})).ElseIf(n.z.lessThan(i),(()=>{r.assign(y7(0,0,1))})).ElseIf(n.x.greaterThan(.9999),(()=>{r.assign(y7(-1,0,0))})).ElseIf(n.y.greaterThan(.9999),(()=>{r.assign(y7(0,-1,0))})).ElseIf(n.z.greaterThan(.9999),(()=>{r.assign(y7(0,0,-1))})).Else((()=>{const e=.01,i=t.sample(n.add(y7(-.01,0,0))).r.sub(t.sample(n.add(y7(e,0,0))).r),o=t.sample(n.add(y7(0,-.01,0))).r.sub(t.sample(n.add(y7(0,e,0))).r),s=t.sample(n.add(y7(0,0,-.01))).r.sub(t.sample(n.add(y7(0,0,e))).r);r.assign(y7(i,o,s))})),r.normalize()}));new WeakMap;const Fce=new x0.I9Y;class zce extends eie{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class jce extends zce{static get type(){return"PassMultipleTextureNode"}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Vce extends f9{static get type(){return"PassNode"}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const r=new x0.VCu;r.isRenderTargetTexture=!0,r.name="depth";const o=new x0.O0B(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:x0.ix0,...i});o.texture.name="output",o.depthTexture=r,this.renderTarget=o,this._textures={output:o.texture,depth:r},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=z7(0),this._cameraFar=z7(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=r9.FRAME}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];if(void 0===t){t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)}return t}getPreviousTexture(e){let t=this._previousTextures[e];return void 0===t&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(void 0!==t){const n=this._textures[e],i=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"output",t=this._textureNodes[e];return void 0===t&&(t=Z9(new jce(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"output",t=this._previousTextureNodes[e];return void 0===t&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),t=Z9(new jce(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"depth",t=this._viewZNodes[e];if(void 0===t){const n=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=Qoe(this.getTextureNode(e),n,i)}return t}getLinearDepthNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"depth",t=this._linearDepthNodes[e];if(void 0===t){const n=this._cameraNear,i=this._cameraFar,r=this.getViewZNode(e);this._linearDepthNodes[e]=t=Hoe(r,n,i)}return t}setup(e){let{renderer:t}=e;return this.renderTarget.samples=void 0===this.options.samples?t.samples:this.options.samples,!0===t.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.texture.type=t.getColorBufferType(),this.scope===Vce.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let i,r;const o=t.getOutputRenderTarget();o&&!0===o.isXRRenderTarget?(r=1,i=t.xr.getCamera(),t.xr.updateCamera(i),Fce.set(o.width,o.height)):(i=this.camera,r=t.getPixelRatio(),t.getSize(Fce)),this._pixelRatio=r,this.setSize(Fce.width,Fce.height);const s=t.getRenderTarget(),a=t.getMRT(),l=i.layers.mask;this._cameraNear.value=i.near,this._cameraFar.value=i.far,null!==this._layers&&(i.layers.mask=this._layers.mask);for(const c in this._previousTextures)this.toggleTexture(c);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,i),t.setRenderTarget(s),t.setMRT(a),i.layers.mask=l}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,i=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Vce.COLOR="color",Vce.DEPTH="depth";const Gce=r7((e=>{let[t,n]=e;return t.mul(n).clamp()})).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Hce=r7((e=>{let[t,n]=e;return t=t.mul(n),t.div(t.add(1)).clamp()})).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Wce=r7((e=>{let[t,n]=e;t=t.mul(n),t=t.sub(.004).max(0);const i=t.mul(t.mul(6.2).add(.5)),r=t.mul(t.mul(6.2).add(1.7)).add(.06);return i.div(r).pow(2.2)})).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Qce=r7((e=>{let[t]=e;const n=t.mul(t.add(.0245786)).sub(90537e-9),i=t.mul(t.add(.432951).mul(.983729)).add(.238081);return n.div(i)})),qce=r7((e=>{let[t,n]=e;const i=M7(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=M7(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return t=t.mul(n).div(.6),t=i.mul(t),t=Qce(t),t=r.mul(t),t.clamp()})).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Xce=M7(y7(1.6605,-.1246,-.0182),y7(-.5876,1.1329,-.1006),y7(-.0728,-.0083,1.1187)),$ce=M7(y7(.6274,.0691,.0164),y7(.3293,.9195,.088),y7(.0433,.0113,.8956)),Yce=r7((e=>{let[t]=e;const n=y7(t).toVar(),i=y7(n.mul(n)).toVar(),r=y7(i.mul(i)).toVar();return u7(15.5).mul(r.mul(i)).sub(Eee(40.14,r.mul(n))).add(Eee(31.96,r).sub(Eee(6.868,i.mul(n))).add(Eee(.4298,i).add(Eee(.1191,n).sub(.00232))))})),Kce=r7((e=>{let[t,n]=e;const i=y7(t).toVar(),r=M7(y7(.856627153315983,.137318972929847,.11189821299995),y7(.0951212405381588,.761241990602591,.0767994186031903),y7(.0482516061458583,.101439036467562,.811302368396859)),o=M7(y7(1.1271005818144368,-.1413297634984383,-.14132976349843826),y7(-.11060664309660323,1.157823702216272,-.11060664309660294),y7(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=u7(-12.47393),a=u7(4.026069);return i.mulAssign(n),i.assign($ce.mul(i)),i.assign(r.mul(i)),i.assign(Mte(i,1e-10)),i.assign(ete(i)),i.assign(i.sub(s).div(a.sub(s))),i.assign(Gte(i,0,1)),i.assign(Yce(i)),i.assign(o.mul(i)),i.assign(Dte(Mte(y7(0),i),y7(2.2))),i.assign(Xce.mul(i)),i.assign(Gte(i,0,1)),i})).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Jce=r7((e=>{let[t,n]=e;const i=u7(.76),r=u7(.15);t=t.mul(n);const o=Cte(t.r,Cte(t.g,t.b)),s=Zte(o.lessThan(.08),o.sub(Eee(6.25,o.mul(o))),.04);t.subAssign(s);const a=Mte(t.r,Mte(t.g,t.b));a7(a.lessThan(i),(()=>t));const l=wee(1,i),c=wee(1,l.mul(l).div(a.add(l.sub(i))));t.mulAssign(c.div(a));const u=wee(1,See(1,r.mul(a.sub(c)).add(1)));return Vte(t,y7(c),u)})).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Zce extends h9{static get type(){return"CodeNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=n}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class eue extends Zce{static get type(){return"FunctionNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return void 0===n&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),i=n.name,r=n.type,o=e.getCodeFromNode(this,r);""!==i&&(o.name=i);const s=e.getPropertyName(o),a=this.getNodeFunction(e).getCode(s);return o.code=a+"\n","property"===t?s:e.format(`${s}()`,r,t)}}class tue extends Map{get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.has(e))return super.get(e);if(null!==t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];const o=t(...i);return this.set(e,o),o}}}new tue;function nue(e){let t;const n=e.context.getViewZ;return void 0!==n&&(t=n(this)),(t||Mie.z).negate()}const iue=r7(((e,t)=>{let[n,i]=e;const r=nue(t);return Qte(n,i,r)})),rue=r7(((e,t)=>{let[n]=e;const i=nue(t);return n.mul(n,i,i).negate().exp().oneMinus()})),oue=r7((e=>{let[t,n]=e;return _7(n.toFloat().mix(lee.rgb,t.toVec3()),lee.a)}));n7(class extends h9{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;!0===n.backend.isWebGLBackend?e.addFlowCode(`\t// ${t}Barrier \n`):e.addLineFlowCode(`${t}Barrier()`,this)}});class sue extends f9{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.storeNode=i}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,n=this.getNodeType(e),i=this.getInputType(e),r=this.pointerNode,o=this.valueNode,s=[];s.push(`&${r.build(e,i)}`),null!==o&&s.push(o.build(e,i));const a=`${e.getMethod(t,n)}( ${s.join(", ")} )`;if(null!==this.storeNode){const t=this.storeNode.build(e,i);e.addLineFlowCode(`${t} = ${a}`,this)}else e.addLineFlowCode(a,this)}}sue.ATOMIC_LOAD="atomicLoad",sue.ATOMIC_STORE="atomicStore",sue.ATOMIC_ADD="atomicAdd",sue.ATOMIC_SUB="atomicSub",sue.ATOMIC_MAX="atomicMax",sue.ATOMIC_MIN="atomicMin",sue.ATOMIC_AND="atomicAnd",sue.ATOMIC_OR="atomicOr",sue.ATOMIC_XOR="atomicXor";n7(sue);let aue;function lue(e){aue=aue||new WeakMap;let t=aue.get(e);return void 0===t&&aue.set(e,t={}),t}function cue(e){const t=lue(e);return t.shadowMatrix||(t.shadowMatrix=z7("mat4").setGroup(O7).onRenderUpdate((()=>(!0!==e.castShadow&&e.shadow.updateMatrices(e),e.shadow.matrix))))}function uue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sie;const n=cue(e).mul(t);return n.xyz.div(n.w)}function hue(e){const t=lue(e);return t.position||(t.position=z7(new x0.Pq0).setGroup(O7).onRenderUpdate(((t,n)=>n.value.setFromMatrixPosition(e.matrixWorld))))}function due(e){const t=lue(e);return t.targetPosition||(t.targetPosition=z7(new x0.Pq0).setGroup(O7).onRenderUpdate(((t,n)=>n.value.setFromMatrixPosition(e.target.matrixWorld))))}function pue(e){const t=lue(e);return t.viewPosition||(t.viewPosition=z7(new x0.Pq0).setGroup(O7).onRenderUpdate(((t,n)=>{let{camera:i}=t;n.value=n.value||new x0.Pq0,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)})))}const fue=e=>die.transformDirection(hue(e).sub(due(e))),mue=(e,t)=>{for(const n of t)if(n.isAnalyticLightNode&&n.light.id===e)return n;return null},gue=new WeakMap;class vue extends h9{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=y7().toVar("totalDiffuse"),this.totalSpecularNode=y7().toVar("totalSpecular"),this.outgoingLightNode=y7().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let n=0;n<t.length;n++)e.push(t[n].id);return W8(e)}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);const t=[];for(const e of this._lightNodes)t.push(e.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const n of t.nodes)n.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,i=(e=>e.sort(((e,t)=>e.id-t.id)))(this._lights),r=e.renderer.library;for(const o of i)if(o.isNode)t.push(Z9(o));else{let e=null;if(null!==n&&(e=mue(o.id,n)),null===e){const e=r.getLightNodeClass(o.constructor);if(null===e){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let n=null;gue.has(o)?n=gue.get(o):(n=Z9(new e(o)),gue.set(o,n)),t.push(n)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:i,reflectedLight:r}=e.context;i.direct({...n,lightNode:t,reflectedLight:r},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:i,reflectedLight:r}=e.context;i.directRectArea({...n,lightNode:t,reflectedLight:r},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return null===this._lightNodes&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const i=e.context,r=i.lightingModel,o=e.getDataFromNode(this);if(r){const{totalDiffuseNode:t,totalSpecularNode:s}=this;i.outgoingLight=n;const a=e.addStack();o.nodes=a.nodes,r.start(e);const{backdrop:l,backdropAlpha:c}=i,{directDiffuse:u,directSpecular:h,indirectDiffuse:d,indirectSpecular:p}=i.reflectedLight;let f=u.add(d);null!==l&&(f=y7(null!==c?c.mix(f,l):l),i.material.transparent=!0),t.assign(f),s.assign(h.add(p)),n.assign(t.add(s)),r.finish(e),n=n.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class yue extends h9{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=r9.RENDER,this.isShadowBaseNode=!0}setupShadowPosition(e){let{context:t,material:n}=e;Aue.assign(n.shadowPositionNode||t.shadowPositionWorld||Sie)}dispose(){this.updateBeforeType=r9.NONE}}const Aue=V7("vec3","shadowPositionWorld");function xue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.renderTarget=e.getRenderTarget(),t.activeCubeFace=e.getActiveCubeFace(),t.activeMipmapLevel=e.getActiveMipmapLevel(),t.renderObjectFunction=e.getRenderObjectFunction(),t.pixelRatio=e.getPixelRatio(),t.mrt=e.getMRT(),t.clearColor=e.getClearColor(t.clearColor||new x0.Q1f),t.clearAlpha=e.getClearAlpha(),t.autoClear=e.autoClear,t.scissorTest=e.getScissorTest(),t}function bue(e,t){return t=xue(e,t),e.setMRT(null),e.setRenderObjectFunction(null),e.setClearColor(0,1),e.autoClear=!0,t}function _ue(e,t){e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),e.setRenderObjectFunction(t.renderObjectFunction),e.setPixelRatio(t.pixelRatio),e.setMRT(t.mrt),e.setClearColor(t.clearColor,t.clearAlpha),e.autoClear=t.autoClear,e.setScissorTest(t.scissorTest)}function wue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial,t}function Eue(e,t){return t=wue(e,t),e.background=null,e.backgroundNode=null,e.overrideMaterial=null,t}function Sue(e,t){e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial}function Cue(e,t,n){return n=Eue(t,n=bue(e,n))}function Mue(e,t,n){_ue(e,n),Sue(t,n)}const Tue=new WeakMap,Rue=r7((e=>{let[t,n,i]=e,r=Sie.sub(t).length();return r=r.sub(n).div(i.sub(n)),r=r.saturate(),r})),Iue=e=>{let t=Tue.get(e);if(void 0===t){const n=e.isPointLight?(e=>{const t=e.shadow.camera,n=tre("near","float",t).setGroup(O7),i=tre("far","float",t).setGroup(O7),r=gie(e);return Rue(r,n,i)})(e):null;t=new nse,t.colorNode=_7(0,0,0,1),t.depthNode=n,t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.fog=!1,Tue.set(e,t)}return t},Pue=r7((e=>{let{depthTexture:t,shadowCoord:n}=e;return tie(t,n.xy).compare(n.z)})),Bue=r7((e=>{let{depthTexture:t,shadowCoord:n,shadow:i}=e;const r=(e,n)=>tie(t,e).compare(n),o=tre("mapSize","vec2",i).setGroup(O7),s=tre("radius","float",i).setGroup(O7),a=f7(1).div(o),l=a.x.negate().mul(s),c=a.y.negate().mul(s),u=a.x.mul(s),h=a.y.mul(s),d=l.div(2),p=c.div(2),f=u.div(2),m=h.div(2);return _ee(r(n.xy.add(f7(l,c)),n.z),r(n.xy.add(f7(0,c)),n.z),r(n.xy.add(f7(u,c)),n.z),r(n.xy.add(f7(d,p)),n.z),r(n.xy.add(f7(0,p)),n.z),r(n.xy.add(f7(f,p)),n.z),r(n.xy.add(f7(l,0)),n.z),r(n.xy.add(f7(d,0)),n.z),r(n.xy,n.z),r(n.xy.add(f7(f,0)),n.z),r(n.xy.add(f7(u,0)),n.z),r(n.xy.add(f7(d,m)),n.z),r(n.xy.add(f7(0,m)),n.z),r(n.xy.add(f7(f,m)),n.z),r(n.xy.add(f7(l,h)),n.z),r(n.xy.add(f7(0,h)),n.z),r(n.xy.add(f7(u,h)),n.z)).mul(1/17)})),Lue=r7((e=>{let{depthTexture:t,shadowCoord:n,shadow:i}=e;const r=(e,n)=>tie(t,e).compare(n),o=tre("mapSize","vec2",i).setGroup(O7),s=f7(1).div(o),a=s.x,l=s.y,c=n.xy,u=ste(c.mul(o).add(.5));return c.subAssign(u.mul(s)),_ee(r(c,n.z),r(c.add(f7(a,0)),n.z),r(c.add(f7(0,l)),n.z),r(c.add(s),n.z),Vte(r(c.add(f7(a.negate(),0)),n.z),r(c.add(f7(a.mul(2),0)),n.z),u.x),Vte(r(c.add(f7(a.negate(),l)),n.z),r(c.add(f7(a.mul(2),l)),n.z),u.x),Vte(r(c.add(f7(0,l.negate())),n.z),r(c.add(f7(0,l.mul(2))),n.z),u.y),Vte(r(c.add(f7(a,l.negate())),n.z),r(c.add(f7(a,l.mul(2))),n.z),u.y),Vte(Vte(r(c.add(f7(a.negate(),l.negate())),n.z),r(c.add(f7(a.mul(2),l.negate())),n.z),u.x),Vte(r(c.add(f7(a.negate(),l.mul(2))),n.z),r(c.add(f7(a.mul(2),l.mul(2))),n.z),u.x),u.y)).mul(1/9)})),Nue=r7((e=>{let{depthTexture:t,shadowCoord:n}=e;const i=u7(1).toVar(),r=tie(t).sample(n.xy).rg,o=Rte(n.z,r.x);return a7(o.notEqual(u7(1)),(()=>{const e=n.z.sub(r.x),t=Mte(0,r.y.mul(r.y));let s=t.div(t.add(e.mul(e)));s=Gte(wee(s,.3).div(.95-.3)),i.assign(Gte(Mte(o,s)))})),i})),Due=r7((e=>{let{samples:t,radius:n,size:i,shadowPass:r}=e;const o=u7(0).toVar(),s=u7(0).toVar(),a=t.lessThanEqual(u7(1)).select(u7(0),u7(2).div(t.sub(1))),l=t.lessThanEqual(u7(1)).select(u7(0),u7(-1));yoe({start:h7(0),end:h7(t),type:"int",condition:"<"},(e=>{let{i:t}=e;const c=l.add(u7(t).mul(a)),u=r.sample(_ee(Doe.xy,f7(0,c).mul(n)).div(i)).x;o.addAssign(u),s.addAssign(u.mul(u))})),o.divAssign(t),s.divAssign(t);const c=tte(s.sub(o.mul(o)));return f7(o,c)})),kue=r7((e=>{let{samples:t,radius:n,size:i,shadowPass:r}=e;const o=u7(0).toVar(),s=u7(0).toVar(),a=t.lessThanEqual(u7(1)).select(u7(0),u7(2).div(t.sub(1))),l=t.lessThanEqual(u7(1)).select(u7(0),u7(-1));yoe({start:h7(0),end:h7(t),type:"int",condition:"<"},(e=>{let{i:t}=e;const c=l.add(u7(t).mul(a)),u=r.sample(_ee(Doe.xy,f7(c,0).mul(n)).div(i));o.addAssign(u.x),s.addAssign(_ee(u.y.mul(u.y),u.x.mul(u.x)))})),o.divAssign(t),s.divAssign(t);const c=tte(s.sub(o.mul(o)));return f7(o,c)})),Oue=[Pue,Bue,Lue,Nue];let Uue;const Fue=new Bce;class zue extends yue{static get type(){return"ShadowNode"}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0}setupShadowFilter(e,t){let{filterFn:n,depthTexture:i,shadowCoord:r,shadow:o}=t;const s=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),a=n({depthTexture:i,shadowCoord:r,shadow:o});return s.select(a,u7(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:i}=e,r=tre("bias","float",n).setGroup(O7);let o,s=t;if(n.camera.isOrthographicCamera||!0!==i.logarithmicDepthBuffer)s=s.xyz.div(s.w),o=s.z,i.coordinateSystem===x0.i7u&&(o=o.mul(2).sub(1));else{const e=s.w;s=s.xy.div(e);const t=tre("near","float",n.camera).setGroup(O7),i=tre("far","float",n.camera).setGroup(O7);o=qoe(e.negate(),t,i)}return s=y7(s.x,s.y.oneMinus(),o.add(r)),s}getShadowFilterFn(e){return Oue[e]}setupShadow(e){const{renderer:t}=e,{light:n,shadow:i}=this,r=t.shadowMap.type,o=new x0.VCu(i.mapSize.width,i.mapSize.height);o.compareFunction=x0.vim;const s=e.createRenderTarget(i.mapSize.width,i.mapSize.height);if(s.depthTexture=o,i.camera.updateProjectionMatrix(),r===x0.RyA){o.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:x0.paN,type:x0.ix0}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:x0.paN,type:x0.ix0});const t=tie(o),n=tie(this.vsmShadowMapVertical.texture),r=tre("blurSamples","float",i).setGroup(O7),s=tre("radius","float",i).setGroup(O7),a=tre("mapSize","vec2",i).setGroup(O7);let l=this.vsmMaterialVertical||(this.vsmMaterialVertical=new nse);l.fragmentNode=Due({samples:r,radius:s,size:a,shadowPass:t}).context(e.getSharedContext()),l.name="VSMVertical",l=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new nse),l.fragmentNode=kue({samples:r,radius:s,size:a,shadowPass:n}).context(e.getSharedContext()),l.name="VSMHorizontal"}const a=tre("intensity","float",i).setGroup(O7),l=tre("normalBias","float",i).setGroup(O7),c=cue(n).mul(Aue.add(Uie.mul(l))),u=this.setupShadowCoord(e,c),h=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(null===h)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const d=r===x0.RyA?this.vsmShadowMapHorizontal.texture:o,p=this.setupShadowFilter(e,{filterFn:h,shadowTexture:s.texture,depthTexture:d,shadowCoord:u,shadow:i}),f=tie(s.texture,u),m=Vte(1,p.rgb.mix(f,1),a.mul(f.a)).toVar();return this.shadowMap=s,this.shadow.map=s,m}setup(e){if(!1!==e.renderer.shadowMap.enabled)return r7((()=>{let t=this._node;return this.setupShadowPosition(e),null===t&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t}))()}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:r,scene:o}=e;t.updateMatrices(i),n.setSize(t.mapSize.width,t.mapSize.height),r.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:i}=this,{renderer:r,scene:o,camera:s}=e,a=r.shadowMap.type,l=t.depthTexture.version;this._depthVersionCached=l,i.camera.layers.mask=s.layers.mask;const c=r.getRenderObjectFunction(),u=r.getMRT(),h=!!u&&u.has("velocity");Uue=Cue(r,o,Uue),o.overrideMaterial=Iue(n),r.setRenderObjectFunction((function(e,t,n,o,l,c){if(!0===e.castShadow||e.receiveShadow&&a===x0.RyA){h&&(e9(e).useVelocity=!0),e.onBeforeShadow(r,e,s,i.camera,o,t.overrideMaterial,c);for(var u=arguments.length,d=new Array(u>6?u-6:0),p=6;p<u;p++)d[p-6]=arguments[p];r.renderObject(e,t,n,o,l,c,...d),e.onAfterShadow(r,e,s,i.camera,o,t.overrideMaterial,c)}})),r.setRenderTarget(t),this.renderShadow(e),r.setRenderObjectFunction(c),!0!==n.isPointLight&&a===x0.RyA&&this.vsmPass(r),Mue(r,o,Uue)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),Fue.material=this.vsmMaterialVertical,Fue.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Fue.material=this.vsmMaterialHorizontal,Fue.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const jue=(e,t)=>Z9(new zue(e,t)),Vue=new x0.Q1f,Gue=r7((e=>{let[t,n]=e;const i=t.toVar(),r=pte(i),o=See(1,Mte(r.x,Mte(r.y,r.z)));r.mulAssign(o),i.mulAssign(o.mul(n.mul(2).oneMinus()));const s=f7(i.xy).toVar(),a=n.mul(1.5).oneMinus();return a7(r.z.greaterThanEqual(a),(()=>{a7(i.z.greaterThan(0),(()=>{s.x.assign(wee(4,i.x))}))})).ElseIf(r.x.greaterThanEqual(a),(()=>{const e=fte(i.x);s.x.assign(i.z.mul(e).add(e.mul(2)))})).ElseIf(r.y.greaterThanEqual(a),(()=>{const e=fte(i.y);s.x.assign(i.x.add(e.mul(2)).add(2)),s.y.assign(i.z.mul(e).sub(2))})),f7(.125,.25).mul(s).add(f7(.375,.75)).flipY()})).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),Hue=r7((e=>{let{depthTexture:t,bd3D:n,dp:i,texelSize:r}=e;return tie(t,Gue(n,r.y)).compare(i)})),Wue=r7((e=>{let{depthTexture:t,bd3D:n,dp:i,texelSize:r,shadow:o}=e;const s=tre("radius","float",o).setGroup(O7),a=f7(-1,1).mul(s).mul(r.y);return tie(t,Gue(n.add(a.xyy),r.y)).compare(i).add(tie(t,Gue(n.add(a.yyy),r.y)).compare(i)).add(tie(t,Gue(n.add(a.xyx),r.y)).compare(i)).add(tie(t,Gue(n.add(a.yyx),r.y)).compare(i)).add(tie(t,Gue(n,r.y)).compare(i)).add(tie(t,Gue(n.add(a.xxy),r.y)).compare(i)).add(tie(t,Gue(n.add(a.yxy),r.y)).compare(i)).add(tie(t,Gue(n.add(a.xxx),r.y)).compare(i)).add(tie(t,Gue(n.add(a.yxx),r.y)).compare(i)).mul(1/9)})),Que=r7((e=>{let{filterFn:t,depthTexture:n,shadowCoord:i,shadow:r}=e;const o=i.xyz.toVar(),s=o.length(),a=z7("float").setGroup(O7).onRenderUpdate((()=>r.camera.near)),l=z7("float").setGroup(O7).onRenderUpdate((()=>r.camera.far)),c=tre("bias","float",r).setGroup(O7),u=z7(r.mapSize).setGroup(O7),h=u7(1).toVar();return a7(s.sub(l).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),(()=>{const e=s.sub(a).div(l.sub(a)).toVar();e.addAssign(c);const i=o.normalize(),d=f7(1).div(u.mul(f7(4,2)));h.assign(t({depthTexture:n,bd3D:i,dp:e,texelSize:d,shadow:r}))})),h})),que=new x0.IUQ,Xue=new x0.I9Y,$ue=new x0.I9Y;class Yue extends zue{static get type(){return"PointShadowNode"}constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}getShadowFilterFn(e){return e===x0.bTm?Hue:Wue}setupShadowCoord(e,t){return t}setupShadowFilter(e,t){let{filterFn:n,shadowTexture:i,depthTexture:r,shadowCoord:o,shadow:s}=t;return Que({filterFn:n,shadowTexture:i,depthTexture:r,shadowCoord:o,shadow:s})}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:r,scene:o}=e,s=t.getFrameExtents();$ue.copy(t.mapSize),$ue.multiply(s),n.setSize($ue.width,$ue.height),Xue.copy(t.mapSize);const a=r.autoClear,l=r.getClearColor(Vue),c=r.getClearAlpha();r.autoClear=!1,r.setClearColor(t.clearColor,t.clearAlpha),r.clear();const u=t.getViewportCount();for(let h=0;h<u;h++){const e=t.getViewport(h),s=Xue.x*e.x,a=$ue.y-Xue.y-Xue.y*e.y;que.set(s,a,Xue.x*e.z,Xue.y*e.w),n.viewport.copy(que),t.updateMatrices(i,h),r.render(o,t.camera)}r.autoClear=a,r.setClearColor(l,c)}}const Kue=(e,t)=>Z9(new Yue(e,t));class Jue extends Soe{static get type(){return"AnalyticLightNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.light=e,this.color=new x0.Q1f,this.colorNode=e&&e.colorNode||z7(this.color).setGroup(O7),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=r9.FRAME}customCacheKey(){return Q8(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}getLightVector(e){return pue(this.light).sub(e.context.positionView||Mie)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return jue(this.light)}setupShadow(e){const{renderer:t}=e;if(!1===t.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){const t=this.light.shadow.shadowNode;let i;i=void 0!==t?Z9(t):this.setupShadowNode(e),this.shadowNode=i,this.shadowColorNode=n=this.colorNode.mul(i),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const Zue=r7((e=>{let{lightDistance:t,cutoffDistance:n,decayExponent:i}=e;const r=t.pow(i).max(.01).reciprocal();return n.greaterThan(0).select(r.mul(t.div(n).pow4().oneMinus().clamp().pow2()),r)})),ehe=e=>{let{color:t,lightVector:n,cutoffDistance:i,decayExponent:r}=e;const o=n.normalize(),s=n.length(),a=Zue({lightDistance:s,cutoffDistance:i,decayExponent:r});return{lightDirection:o,lightColor:t.mul(a)}};class the extends Jue{static get type(){return"PointLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.cutoffDistanceNode=z7(0).setGroup(O7),this.decayExponentNode=z7(2).setGroup(O7)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Kue(this.light)}setupDirect(e){return ehe({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}r7(((e,t)=>{let[n=$ne()]=e,{renderer:i,material:r}=t;const o=u7(1).toVar(),s=jte(n.mul(2).sub(1));if(r.alphaToCoverage&&i.samples>1){const e=u7(s.fwidth()).toVar();o.assign(Qte(e.oneMinus(),e.add(1),s).oneMinus())}else s.greaterThan(1).discard();return o}));const nhe=r7((e=>{let[t,n]=e;const i=t.x,r=t.y,o=t.z;let s=n.element(0).mul(.886227);return s=s.add(n.element(1).mul(1.023328).mul(r)),s=s.add(n.element(2).mul(1.023328).mul(o)),s=s.add(n.element(3).mul(1.023328).mul(i)),s=s.add(n.element(4).mul(.858086).mul(i).mul(r)),s=s.add(n.element(5).mul(.858086).mul(r).mul(o)),s=s.add(n.element(6).mul(o.mul(o).mul(.743125).sub(.247708))),s=s.add(n.element(7).mul(.858086).mul(i).mul(o)),s=s.add(n.element(8).mul(.429043).mul(Eee(i,i).sub(Eee(r,r)))),s}));const ihe=new Ece;class rhe extends Wle{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const i=this.renderer,r=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(null===r)i._clearColor.getRGB(ihe),ihe.a=i._clearColor.a;else if(!0===r.isColor)r.getRGB(ihe),ihe.a=1,o=!0;else if(!0===r.isNode){const n=this.get(e),o=r;ihe.copy(i._clearColor);let s=n.backgroundMesh;if(void 0===s){const e=nne(_7(o).mul(Oce),{getUV:()=>Uce.mul(kie),getTextureLevel:()=>kce});let t=roe;t=t.setZ(t.w);const i=new nse;i.name="Background.material",i.side=x0.hsX,i.depthTest=!1,i.depthWrite=!1,i.fog=!1,i.lights=!1,i.vertexNode=t,i.colorNode=e,n.backgroundMeshNode=e,n.backgroundMesh=s=new x0.eaF(new x0.Gu$(1,32,32),i),s.frustumCulled=!1,s.name="Background.mesh",s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)}}const a=o.getCacheKey();n.backgroundCacheKey!==a&&(n.backgroundMeshNode.node=_7(o).mul(Oce),n.backgroundMeshNode.needsUpdate=!0,s.material.needsUpdate=!0,n.backgroundCacheKey=a),t.unshift(s,s.geometry,s.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",r);const s=i.xr.getEnvironmentBlendMode();if("additive"===s?ihe.set(0,0,0,1):"alpha-blend"===s&&ihe.set(0,0,0,0),!0===i.autoClear||!0===o){const e=n.clearColorValue;e.r=ihe.r,e.g=ihe.g,e.b=ihe.b,e.a=ihe.a,!0!==i.backend.isWebGLBackend&&!0!==i.alpha||(e.r*=e.a,e.g*=e.a,e.b*=e.a),n.depthClearValue=i._clearDepth,n.stencilClearValue=i._clearStencil,n.clearColor=!0===i.autoClearColor,n.clearDepth=!0===i.autoClearDepth,n.clearStencil=!0===i.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let ohe=0;class she{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.name=e,this.bindings=t,this.index=n,this.bindingsReference=i,this.id=ohe++}}class ahe{constructor(e,t,n,i,r,o,s,a,l){let c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=c,this.nodeAttributes=i,this.bindings=r,this.updateNodes=o,this.updateBeforeNodes=s,this.updateAfterNodes=a,this.observer=l,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings){if(!0!==t.bindings[0].groupNode.shared){const n=new she(t.name,[],t.index,t);e.push(n);for(const e of t.bindings)n.bindings.push(e.clone())}else e.push(t)}return e}}class lhe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class che{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class uhe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=i}}class hhe extends uhe{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class dhe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let phe=0;class fhe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.id=phe++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return void 0===t&&null!==this.parent&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class mhe{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class ghe{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class vhe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class yhe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.I9Y),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class Ahe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.Pq0),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class xhe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.IUQ),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class bhe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.Q1f),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class _he extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.k_V),this.isMatrix2Uniform=!0,this.boundary=16,this.itemSize=4}}class whe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.dwI),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class Ehe extends ghe{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new x0.kn4),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class She extends vhe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Che extends yhe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Mhe extends Ahe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class The extends xhe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Rhe extends bhe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Ihe extends _he{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Phe extends whe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Bhe extends Ehe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const Lhe=new WeakMap,Nhe=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Dhe=e=>/e/g.test(e)?String(e).replace(/\+/g,""):(e=Number(e))+(e%1?"":".0");class khe{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=Mce(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new fhe,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=Lhe.get(this.renderer);return void 0===e&&(e=new zle,Lhe.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new x0.O0B(e,t,n)}createCubeRenderTarget(e,t){return new dse(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),i=[];let r,o=!0;for(const s of t)i.push(s),o=o&&!0!==s.groupNode.shared;return o?(r=n.get(i),void 0===r&&(r=new she(e,i,this.bindingsIndexes[e].group,i),n.set(i,r))):r=new she(e,i,this.bindingsIndexes[e].group,i),r}getBindGroupArray(e,t){const n=this.bindings[t];let i=n[e];return void 0===i&&(void 0===this.bindingsIndexes[e]&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(null===e){const t={},n=this.bindings;for(const e of l9)for(const i in n[e]){const r=n[e][i];(t[i]||(t[i]=[])).push(...r)}e=[];for(const i in t){const n=t[i],r=this._getBindGroup(i,n);e.push(r)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort(((e,t)=>e.bindings[0].groupNode.order-t.bindings[0].groupNode.order));for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){!1===this.nodes.includes(e)&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){!1===this.sequentialNodes.includes(e)&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes){e.getUpdateType()!==r9.NONE&&this.updateNodes.push(e.getSelf())}for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==r9.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==r9.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===x0.k6q||e.magFilter===x0.kRr||e.magFilter===x0.Cfg||e.magFilter===x0.$_I||e.minFilter===x0.k6q||e.minFilter===x0.kRr||e.minFilter===x0.Cfg||e.minFilter===x0.$_I}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return this.context,this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.getDataFromNode(e);return void 0===n.cache&&(n.cache=new fhe(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=void 0===t.usageCount?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.generateArrayDeclaration(e,t)+"( ";for(let r=0;r<t;r++){const o=n?n[r]:null;i+=null!==o?o.build(this,e):this.generateConst(e),r<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=[];for(const r of t){const{name:e,type:t}=r;n&&n[e]&&n[e].isNode?i.push(n[e].build(this,t)):i.push(this.generateConst(t))}return e+"( "+i.join(", ")+" )"}generateConst(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new x0.Q1f:"vec2"===e?t=new x0.I9Y:"vec3"===e?t=new x0.Pq0:"vec4"===e&&(t=new x0.IUQ)),"float"===e)return Dhe(t);if("int"===e)return`${Math.round(t)}`;if("uint"===e)return t>=0?`${Math.round(t)}u`:"0u";if("bool"===e)return t?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${Dhe(t.r)}, ${Dhe(t.g)}, ${Dhe(t.b)} )`;const n=this.getTypeLength(e),i=this.getComponentType(e),r=e=>this.generateConst(i,e);if(2===n)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)} )`;if(3===n)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)} )`;if(4===n&&"mat2"!==e)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)}, ${r(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(r).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return"color"===e?"vec3":e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,t){const n=this.attributes;for(const r of n)if(r.name===e)return r;const i=new lhe(e,t);return n.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"texture"===e||"cubeTexture"===e||"storageTexture"===e||"depthTexture"===e||"texture3D"===e}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===x0.Yuy)return"int";if(t===x0.bkx)return"uint"}return"float"}getElementType(e){return"mat2"===e?"vec2":"mat3"===e?"vec3":"mat4"===e?"vec4":this.getComponentType(e)}getComponentType(e){if("float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e)return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===t?null:"b"===t[1]?"bool":"i"===t[1]?"int":"u"===t[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e?"vec4":e}getTypeFromLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float";if(1===e)return t;let n=K8(e);const i="float"===t?"":t[0];return!0===/mat2/.test(t)&&(n=n.replace("vec","mat")),i+n}getTypeFromArray(e){return Nhe.get(e.constructor)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,i=e.itemSize,r=e.normalized;let o;return e instanceof x0.Oax||!0===r||(o=this.getTypeFromArray(n)),this.getTypeFromLength(i,o)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return null!==n?Number(n[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat2/.test(e)?4:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return"int"===t||"uint"===t?e:this.changeComponentType(e,"int")}addStack(){return this.stack=Mce(this.stack),this.stacks.push(s7()||this.stack),o7(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,o7(this.stacks.pop()),e}getDataFromNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n=null===n?e.isGlobal(this)?this.globalCache:this.cache:n;let i=n.getData(e);return void 0===i&&(i={},n.setData(e,i)),void 0===i[t]&&(i[t]={}),i[t]}getNodeProperties(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"any";const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let i=n.bufferAttribute;if(void 0===i){const r=this.uniforms.index++;i=new lhe("nodeAttribute"+r,t,e),this.bufferAttributes.push(i),n.bufferAttribute=i}return i}getStructTypeFromNode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage;const r=this.getDataFromNode(e,i,this.globalCache);let o=r.structType;if(void 0===o){const e=this.structs.index++;null===n&&(n="StructType"+e),o=new mhe(n,t),this.structs[i].push(o),r.structType=o}return o}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.getDataFromNode(e,n,this.globalCache);let o=r.uniform;if(void 0===o){const s=this.uniforms.index++;o=new che(i||"nodeUniform"+s,t,e),this.uniforms[n].push(o),r.uniform=o}return o}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getNodeType(this),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=this.getDataFromNode(e,i);let s=o.variable;if(void 0===s){const a=r?"_const":"_var",l=this.vars[i]||(this.vars[i]=[]),c=this.vars[a]||(this.vars[a]=0);null===t&&(t=(r?"nodeConst":"nodeVar")+c,this.vars[a]++);const u=this.getArrayCount(e);s=new uhe(t,n,r,u),r||l.push(s),o.variable=s}return s}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode))&&(!e.cNode||this.isDeterministic(e.cNode));if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode));if(e.isArrayNode){if(null!==e.values)for(const t of e.values)if(!this.isDeterministic(t))return!1;return!0}return!!e.isConstNode}getVaryingFromNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getNodeType(this);const i=this.getDataFromNode(e,"any");let r=i.varying;if(void 0===r){const e=this.varyings,o=e.length;null===t&&(t="nodeVarying"+o),r=new hhe(t,n),e.push(r),i.varying=r}return r}getCodeFromNode(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;const i=this.getDataFromNode(e);let r=i.code;if(void 0===r){const e=this.codes[n]||(this.codes[n]=[]),o=e.length;r=new dhe("nodeCode"+o,t),e.push(r),i.code=r}return r}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:i}=this.getDataFromNode(e);let r=!0,o=t;for(;o;){if(!0===i.get(o)){r=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(r)for(const s of n)this.addLineFlowCode(s)}addLineFlowCodeBlock(e,t,n){const i=this.getDataFromNode(e),r=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);r.push(t),o.set(n,!0)}addLineFlowCode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return""===e||(null!==t&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new eue,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let e=0;const t=Object.values(this);return{next:()=>({value:t[e],done:e++>=t.length})}}};for(const o of t.inputs)n[o.name]=new Sce(o.type,o.name);e.layout=null;const i=e.call(n),r=this.flowStagesNode(i,t.type);return e.layout=t,r}flowStagesNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.flow,i=this.vars,r=this.cache,o=this.buildStage,s=this.stack,a={code:""};this.flow=a,this.vars={},this.cache=new fhe,this.stack=Mce();for(const l of a9)this.setBuildStage(l),a.result=e.build(this,t);return a.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=i,this.cache=r,this.stack=s,this.setBuildStage(o),a}getFunctionOperator(){return null}flowChildNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=n,i}flowNodeFromShaderStage(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.shaderStage;this.setShaderStage(e);const o=this.flowChildNode(t,n);return null!==i&&(o.code+=`${this.tab+i} = ${o.result};\n`),this.flowCode[e]=this.flowCode[e]+o.code,this.setShaderStage(r),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return`${null!==n?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(void 0!==n)for(const i of n)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(void 0!==t)for(const i of t)n+=i.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(null!==t){let e=n.library.fromMaterial(t);null===e&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),e=new nse),e.build(this)}else this.addFlow("compute",e);for(const i of a9){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const e of l9){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)"generate"===i?this.flowNode(e):e.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if("float"===t||"int"===t||"uint"===t)return new She(e);if("vec2"===t||"ivec2"===t||"uvec2"===t)return new Che(e);if("vec3"===t||"ivec3"===t||"uvec3"===t)return new Mhe(e);if("vec4"===t||"ivec4"===t||"uvec4"===t)return new The(e);if("color"===t)return new Rhe(e);if("mat2"===t)return new Ihe(e);if("mat3"===t)return new Phe(e);if("mat4"===t)return new Bhe(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if((t=this.getVectorType(t))===(n=this.getVectorType(n))||null===n||this.isReference(n))return e;const i=this.getTypeLength(t),r=this.getTypeLength(n);return 16===i&&9===r?`${this.getType(n)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:9===i&&4===r?`${this.getType(n)}(${e}[0].xy, ${e}[1].xy)`:i>4||r>4||0===r?e:i===r?`${this.getType(n)}( ${e} )`:i>r?this.format(`${e}.${"xyz".slice(0,r)}`,this.getTypeFromLength(r,this.getComponentType(t)),n):4===r&&i>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:2===i?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(1===i&&r>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${x0.sPf} - Node System\n`}createNodeMaterial(){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NodeMaterial"}() instead.`)}}class Ohe{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===r9.FRAME){const{frameMap:t}=this._getMaps(this.updateBeforeMap,n);t.get(n)!==this.frameId&&!1!==e.updateBefore(this)&&t.set(n,this.frameId)}else if(t===r9.RENDER){const{renderMap:t}=this._getMaps(this.updateBeforeMap,n);t.get(n)!==this.renderId&&!1!==e.updateBefore(this)&&t.set(n,this.renderId)}else t===r9.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===r9.FRAME){const{frameMap:t}=this._getMaps(this.updateAfterMap,n);t.get(n)!==this.frameId&&!1!==e.updateAfter(this)&&t.set(n,this.frameId)}else if(t===r9.RENDER){const{renderMap:t}=this._getMaps(this.updateAfterMap,n);t.get(n)!==this.renderId&&!1!==e.updateAfter(this)&&t.set(n,this.renderId)}else t===r9.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===r9.FRAME){const{frameMap:t}=this._getMaps(this.updateMap,n);t.get(n)!==this.frameId&&!1!==e.update(this)&&t.set(n,this.frameId)}else if(t===r9.RENDER){const{renderMap:t}=this._getMaps(this.updateMap,n);t.get(n)!==this.renderId&&!1!==e.update(this)&&t.set(n,this.renderId)}else t===r9.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class Uhe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.type=e,this.name=t,this.count=n,this.qualifier=i,this.isConst=r}}Uhe.isNodeFunctionInput=!0;class Fhe extends Jue{static get type(){return"DirectionalLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}setupDirect(){const e=this.colorNode;return{lightDirection:fue(this.light),lightColor:e}}}const zhe=new x0.kn4,jhe=new x0.kn4;let Vhe=null;class Ghe extends Jue{static get type(){return"RectAreaLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.halfHeight=z7(new x0.Pq0).setGroup(O7),this.halfWidth=z7(new x0.Pq0).setGroup(O7),this.updateType=r9.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;jhe.identity(),zhe.copy(t.matrixWorld),zhe.premultiply(n),jhe.extractRotation(zhe),this.halfWidth.value.set(.5*t.width,0,0),this.halfHeight.value.set(0,.5*t.height,0),this.halfWidth.value.applyMatrix4(jhe),this.halfHeight.value.applyMatrix4(jhe)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=tie(Vhe.LTC_FLOAT_1),n=tie(Vhe.LTC_FLOAT_2)):(t=tie(Vhe.LTC_HALF_1),n=tie(Vhe.LTC_HALF_2));const{colorNode:i,light:r}=this;return{lightColor:i,lightPosition:pue(r),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Vhe=e}}class Hhe extends Jue{static get type(){return"SpotLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),this.coneCosNode=z7(0).setGroup(O7),this.penumbraCosNode=z7(0).setGroup(O7),this.cutoffDistanceNode=z7(0).setGroup(O7),this.decayExponentNode=z7(0).setGroup(O7)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:n}=this;return Qte(t,n,e)}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:i,light:r}=this,o=this.getLightVector(e),s=o.normalize(),a=s.dot(fue(r)),l=this.getSpotAttenuation(a),c=o.length(),u=Zue({lightDistance:c,cutoffDistance:n,decayExponent:i});let h=t.mul(l).mul(u);if(r.map){const t=uue(r,e.context.positionWorld),n=tie(r.map,t.xy).onRenderUpdate((()=>r.map));h=t.mul(2).sub(1).abs().lessThan(1).all().select(h.mul(n),h)}return{lightColor:h,lightDirection:s}}}class Whe extends Hhe{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let n=null;if(t&&!0===t.isTexture){const i=e.acos().mul(1/Math.PI);n=tie(t,f7(i,0),0).r}else n=super.getSpotAttenuation(e);return n}}class Qhe extends Jue{static get type(){return"AmbientLightNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}setup(e){let{context:t}=e;t.irradiance.addAssign(this.colorNode)}}class qhe extends Jue{static get type(){return"HemisphereLightNode"}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(e),this.lightPositionNode=hue(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=z7(new x0.Q1f).setGroup(O7)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:i}=this,r=Die.dot(i).mul(.5).add(.5),o=Vte(n,t,r);e.context.irradiance.addAssign(o)}}class Xhe extends Jue{static get type(){return"LightProbeNode"}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null);const e=[];for(let t=0;t<9;t++)e.push(new x0.Pq0);this.lightProbe=aie(e)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=nhe(kie,this.lightProbe);e.context.irradiance.addAssign(t)}}class $he{parseFunction(){console.warn("Abstract function.")}}class Yhe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.type=e,this.inputs=t,this.name=n,this.precision=i}getCode(){console.warn("Abstract function.")}}Yhe.isNodeFunction=!0;const Khe=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Jhe=/[a-z_0-9]+/gi,Zhe="#pragma main";class ede extends Yhe{constructor(e){const{type:t,inputs:n,name:i,precision:r,inputsCode:o,blockCode:s,headerCode:a}=(e=>{const t=(e=e.trim()).indexOf(Zhe),n=-1!==t?e.slice(t+12):e,i=n.match(Khe);if(null!==i&&5===i.length){const r=i[4],o=[];let s=null;for(;null!==(s=Jhe.exec(r));)o.push(s);const a=[];let l=0;for(;l<o.length;){const e="const"===o[l][0];!0===e&&l++;let t=o[l][0];"in"===t||"out"===t||"inout"===t?l++:t="";const n=o[l++][0];let i=Number.parseInt(o[l][0]);!1===Number.isNaN(i)?l++:i=null;const r=o[l++][0];a.push(new Uhe(n,r,i,t,e))}const c=n.substring(i[0].length),u=void 0!==i[3]?i[3]:"";return{type:i[2],inputs:a,name:u,precision:void 0!==i[1]?i[1]:"",inputsCode:r,blockCode:c,headerCode:-1!==t?e.slice(0,t):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(e);super(t,n,i,r),this.inputsCode=o,this.blockCode=s,this.headerCode=a}getCode(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.name;const n=this.blockCode;if(""!==n){const{type:i,inputsCode:r,headerCode:o,precision:s}=this;let a=`${i} ${t} ( ${r.trim()} )`;""!==s&&(a=`${s} ${a}`),e=o+a+n}else e="";return e}}class tde extends $he{parseFunction(e){return new ede(e)}}const nde=new WeakMap,ide=[],rde=[];class ode extends Wle{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new Ohe,this.nodeBuilderCache=new Map,this.callHashCache=new zle,this.groupsData=new zle,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===U7.name)return!0;if(n===O7.name){const t=this.get(e),n=this.nodeFrame.renderId;return t.renderId!==n&&(t.renderId=n,!0)}if(n===k7.name){const t=this.get(e),n=this.nodeFrame.frameId;return t.frameId!==n&&(t.frameId=n,!0)}ide[0]=t,ide[1]=e;let i=this.groupsData.get(ide);return void 0===i&&this.groupsData.set(ide,i={}),ide.length=0,i.version!==t.version&&(i.version=t.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const{nodeBuilderCache:i}=this,r=this.getForRenderCacheKey(e);if(n=i.get(r),void 0===n){const t=this.backend.createNodeBuilder(e.object,this.renderer);t.scene=e.scene,t.material=e.material,t.camera=e.camera,t.context.material=e.material,t.lightsNode=e.lightsNode,t.environmentNode=this.getEnvironmentNode(e.scene),t.fogNode=this.getFogNode(e.scene),t.clippingContext=e.clippingContext,t.build(),n=this._createNodeBuilderState(t),i.set(r,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,0===t.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),n=this._createNodeBuilderState(i),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new ahe(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){ide[0]=e,ide[1]=t;const n=this.renderer.info.calls,i=this.callHashCache.get(ide)||{};if(i.callId!==n){const r=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&rde.push(t.getCacheKey(!0)),r&&rde.push(r.getCacheKey()),o&&rde.push(o.getCacheKey()),rde.push(this.renderer.shadowMap.enabled?1:0),i.callId=n,i.cacheKey=W8(rde),this.callHashCache.set(ide,i),rde.length=0}return ide.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const i=0===e.backgroundBlurriness&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&0===t.backgroundBlurriness;if(t.background!==n||i){const r=this.getCacheNode("background",n,(()=>{if(!0===n.isCubeTexture||n.mapping===x0.wfO||n.mapping===x0.uV5||n.mapping===x0.Om){if(e.backgroundBlurriness>0||n.mapping===x0.Om)return ple(n);{let e;return e=!0===n.isCubeTexture?Jie(n):tie(n),vse(e)}}if(!0===n.isTexture)return tie(n,Loe.flipY()).setUpdateMatrix(!0);!0!==n.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",n)}),i);t.backgroundNode=r,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=r.get(t);return(void 0===o||i)&&(o=n(),r.set(t,o)),o}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const e=this.getCacheNode("fog",n,(()=>{if(n.isFogExp2){const e=tre("color","color",n).setGroup(O7),t=tre("density","float",n).setGroup(O7);return oue(e,rue(t))}if(n.isFog){const e=tre("color","color",n).setGroup(O7),t=tre("near","float",n).setGroup(O7),i=tre("far","float",n).setGroup(O7);return oue(e,iue(t,i))}console.error("THREE.Renderer: Unsupported fog configuration.",n)}));t.fogNode=e,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const e=this.getCacheNode("environment",n,(()=>!0===n.isCubeTexture?Jie(n):!0===n.isTexture?tie(n):void console.error("Nodes: Unsupported environment configuration.",n)));t.environmentNode=e,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderer,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=n,o.camera=i,o.material=r,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return nde.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),i=tie(e,Loe).renderOutput(t.toneMapping,t.currentColorSpace);return nde.set(e,n),i}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const i of n.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const i of n.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new Ohe,this.nodeBuilderCache=new Map,this.cacheLib={}}}const sde=new x0.Zcv;class ade{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new x0.dwI,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==e&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const i=e.length;for(let r=0;r<i;r++){sde.copy(e[r]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const i=t[n+r],o=sde.normal;i.x=-o.x,i.y=-o.y,i.z=-o.z,i.w=sde.constant}}updateGlobal(e,t){this.shadowPass=null!==e.overrideMaterial&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,r=i.length;let o,s;if(this.clipIntersection?(o=this.intersectionPlanes,s=e.intersectionPlanes.length):(o=this.unionPlanes,s=e.unionPlanes.length),o.length!==s+r){o.length=s+r;for(let e=0;e<r;e++)o[s+e]=new x0.IUQ;n=!0}this.projectPlanes(i,o,s),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return void 0===t&&(t=new ade(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class lde{constructor(e,t){this.bundleGroup=e,this.camera=t}}const cde=[];class ude{constructor(){this.bundles=new zle}get(e,t){const n=this.bundles;cde[0]=e,cde[1]=t;let i=n.get(cde);return void 0===i&&(i=new lde(e,t),n.set(cde,i)),cde.length=0,i}dispose(){this.bundles=new zle}}class hde{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(null!==n){t=new n;for(const n in e)t[n]=e[n]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t))console.warn(`Redefinition of node ${t}`);else{if("function"!==typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"===typeof t||"object"===typeof t)throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}}addClass(e,t,n){if(n.has(t))console.warn(`Redefinition of node ${t.name}`);else{if("function"!==typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"!==typeof t)throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}}const dde=new vue,pde=[];class fde extends zle{constructor(){super()}createNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(new vue).setLights(e)}getNode(e,t){if(e.isQuadMesh)return dde;pde[0]=e,pde[1]=t;let n=this.get(pde);return void 0===n&&(n=this.createNode(),this.set(pde,n)),pde.length=0,n}}class mde extends x0.O0B{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const gde=new x0.Pq0,vde=new x0.Pq0;class yde extends x0.Qev{constructor(e){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new x0.ubm,this._cameraL.viewport=new x0.IUQ,this._cameraR=new x0.ubm,this._cameraR.viewport=new x0.IUQ,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new x0.nZQ,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new x0.I9Y,this._onSessionEvent=xde.bind(this),this._onSessionEnd=bde.bind(this),this._onInputSourcesChange=_de.bind(this),this._onAnimationFrame=wde.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers="undefined"!==typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(e){this._foveation=e,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=e),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend,i=t.getContext();if(this._session=e,null!==e){if(!0===n.isWebGPUBackend)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),!0===this._useLayers){let n=null,r=null,o=null;t.depth&&(o=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,n=t.stencil?x0.dcC:x0.zdS,r=t.stencil?x0.V3x:x0.bkx);const s={colorFormat:i.RGBA8,depthFormat:o,scaleFactor:this._framebufferScaleFactor},a=new XRWebGLBinding(e,i),l=a.createProjectionLayer(s);this._glBinding=a,this._glProjLayer=l,e.updateRenderState({layers:[l]}),t.setPixelRatio(1),t.setSize(l.textureWidth,l.textureHeight,!1),this._xrRenderTarget=new mde(l.textureWidth,l.textureHeight,{format:x0.GWd,type:x0.OUM,colorSpace:t.outputColorSpace,depthTexture:new x0.VCu(l.textureWidth,l.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:t.stencil,resolveDepthBuffer:!1===l.ignoreDepthValues,resolveStencilBuffer:!1===l.ignoreDepthValues}),this._xrRenderTarget.hasExternalTextures=!0}else{const n={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},r=new XRWebGLLayer(e,i,n);this._glBaseLayer=r,e.updateRenderState({baseLayer:r}),t.setPixelRatio(1),t.setSize(r.framebufferWidth,r.framebufferHeight,!1),this._xrRenderTarget=new mde(r.framebufferWidth,r.framebufferHeight,{format:x0.GWd,type:x0.OUM,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:!1===r.ignoreDepthValues,resolveStencilBuffer:!1===r.ignoreDepthValues})}this.setFoveation(this.getFoveation()),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(null===t)return;const n=e.near,i=e.far,r=this._cameraXR,o=this._cameraL,s=this._cameraR;r.near=s.near=o.near=n,r.far=s.far=o.far=i,this._currentDepthNear===r.near&&this._currentDepthFar===r.far||(t.updateRenderState({depthNear:r.near,depthFar:r.far}),this._currentDepthNear=r.near,this._currentDepthFar=r.far),o.layers.mask=2|e.layers.mask,s.layers.mask=4|e.layers.mask,r.layers.mask=o.layers.mask|s.layers.mask;const a=e.parent,l=r.cameras;Ade(r,a);for(let c=0;c<l.length;c++)Ade(l[c],a);2===l.length?function(e,t,n){gde.setFromMatrixPosition(t.matrixWorld),vde.setFromMatrixPosition(n.matrixWorld);const i=gde.distanceTo(vde),r=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=i/(-u+h),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+f,n=a+f,r=d-m,o=p+(i-m),u=l*a/n*t,h=c*a/n*t;e.projectionMatrix.makePerspective(r,o,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(r,o,s):r.projectionMatrix.copy(o.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*x0.a55*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,r,a)}_getController(e){let t=this._controllers[e];return void 0===t&&(t=new x0.R3r,this._controllers[e]=t),t}}function Ade(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}function xde(e){const t=this._controllerInputSources.indexOf(e.inputSource);if(-1===t)return;const n=this._controllers[t];if(void 0!==n){const t=this.getReferenceSpace();n.update(e.inputSource,e.frame,t),n.dispatchEvent({type:e.type,data:e.inputSource})}}function bde(){const e=this._session,t=this._renderer;e.removeEventListener("select",this._onSessionEvent),e.removeEventListener("selectstart",this._onSessionEvent),e.removeEventListener("selectend",this._onSessionEvent),e.removeEventListener("squeeze",this._onSessionEvent),e.removeEventListener("squeezestart",this._onSessionEvent),e.removeEventListener("squeezeend",this._onSessionEvent),e.removeEventListener("end",this._onSessionEnd),e.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let n=0;n<this._controllers.length;n++){const e=this._controllerInputSources[n];null!==e&&(this._controllerInputSources[n]=null,this._controllers[n].disconnect(e))}this._currentDepthNear=null,this._currentDepthFar=null,t.backend.setXRTarget(null),t.setOutputRenderTarget(null),this._session=null,this._xrRenderTarget=null,this.isPresenting=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function _de(e){const t=this._controllers,n=this._controllerInputSources;for(let i=0;i<e.removed.length;i++){const r=e.removed[i],o=n.indexOf(r);o>=0&&(n[o]=null,t[o].disconnect(r))}for(let i=0;i<e.added.length;i++){const r=e.added[i];let o=n.indexOf(r);if(-1===o){for(let e=0;e<t.length;e++){if(e>=n.length){n.push(r),o=e;break}if(null===n[e]){n[e]=r,o=e;break}}if(-1===o)break}const s=t[o];s&&s.connect(r)}}function wde(e,t){if(void 0===t)return;const n=this._cameraXR,i=this._renderer,r=i.backend,o=this._glBaseLayer,s=this.getReferenceSpace(),a=t.getViewerPose(s);if(this._xrFrame=t,null!==a){const e=a.views;null!==this._glBaseLayer&&r.setXRTarget(o.framebuffer);let t=!1;e.length!==n.cameras.length&&(n.cameras.length=0,t=!0);for(let i=0;i<e.length;i++){const s=e[i];let a;if(!0===this._useLayers){const e=this._glBinding.getViewSubImage(this._glProjLayer,s);a=e.viewport,0===i&&r.setXRRenderTargetTextures(this._xrRenderTarget,e.colorTexture,this._glProjLayer.ignoreDepthValues?void 0:e.depthStencilTexture)}else a=o.getViewport(s);let l=this._cameras[i];void 0===l&&(l=new x0.ubm,l.layers.enable(i),l.viewport=new x0.IUQ,this._cameras[i]=l),l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.quaternion,l.scale),l.projectionMatrix.fromArray(s.projectionMatrix),l.projectionMatrixInverse.copy(l.projectionMatrix).invert(),l.viewport.set(a.x,a.y,a.width,a.height),0===i&&(n.matrix.copy(l.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),!0===t&&n.cameras.push(l)}i.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const e=this._controllerInputSources[l],n=this._controllers[l];null!==e&&void 0!==n&&n.update(e,t,s)}this._currentAnimationLoop&&this._currentAnimationLoop(e,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}const Ede=new x0.Z58,Sde=new x0.I9Y,Cde=new x0.IUQ,Mde=new x0.PPD,Tde=new x0.kn4,Rde=new x0.IUQ;class Ide{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:i=!0,depth:r=!0,stencil:o=!1,antialias:s=!1,samples:a=0,getFallback:l=null,colorBufferType:c=x0.ix0}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=a||!0===s?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.outputColorSpace=x0.er$,this.toneMapping=x0.y_p,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=r,this.stencil=o,this.info=new tce,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new hde,this.lighting=new fde,this._getFallback=l,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new x0.IUQ(0,0,this._width,this._height),this._scissor=new x0.IUQ(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Bce(new nse),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const u=!0===this.alpha?0:1;this._clearColor=new Ece(0,0,0,u),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=c,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:x0.QP0},this.xr=new yde(this),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,t,n)=>{await this.compileAsync(e,t);const i=this._renderLists.get(e,t),r=this._renderContexts.get(e,t,this._renderTarget),o=e.overrideMaterial||n.material,s=this._objects.get(n,o,e,t,i.lightsNode,r,r.clippingContext),{fragmentShader:a,vertexShader:l}=s.getNodeBuilderState();return{fragmentShader:a,vertexShader:l}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise((async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(i){if(null===this._getFallback)return void t(i);try{this.backend=n=this._getFallback(i),await n.init(this)}catch(i){return void t(i)}}this._nodes=new ode(this,n),this._animation=new Fle(this._nodes,this.info),this._attributes=new Kle(n),this._background=new rhe(this,this._nodes),this._geometries=new ece(this._attributes,this.info),this._textures=new wce(this,n,this.info),this._pipelines=new ace(n,this._nodes),this._bindings=new lce(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Hle(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new fce(this.lighting),this._bundles=new ude,this._renderContexts=new bce,this._animation.start(),this._initialized=!0,e(this)}))),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const i=this._nodes.nodeFrame,r=i.renderId,o=this._currentRenderContext,s=this._currentRenderObjectFunction,a=this._compilationPromises,l=!0===e.isScene?e:Ede;null===n&&(n=e);const c=this._renderTarget,u=this._renderContexts.get(n,t,c),h=this._activeMipmapLevel,d=[];this._currentRenderContext=u,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=d,i.renderId++,i.update(),u.depth=this.depth,u.stencil=this.stencil,u.clippingContext||(u.clippingContext=new ade),u.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,c);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,u.clippingContext),n!==e&&n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&p.pushLight(e)})),p.finish(),null!==c){this._textures.updateRenderTarget(c,h);const e=this._textures.get(c);u.textures=e.textures,u.depthTexture=e.depthTexture}else u.textures=null,u.depthTexture=null;this._background.update(l,p,u);const f=p.opaque,m=p.transparent,g=p.transparentDoublePass,v=p.lightsNode;!0===this.opaque&&f.length>0&&this._renderObjects(f,t,l,v),!0===this.transparent&&m.length>0&&this._renderTransparents(m,g,t,l,v),i.renderId=r,this._currentRenderContext=o,this._currentRenderObjectFunction=s,this._compilationPromises=a,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(d)}async renderAsync(e,t){!1===this._initialized&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:\n\nMessage: ${e.message}`;e.reason&&(t+=`\nReason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:i,camera:r,renderList:o}=e,s=this._currentRenderContext,a=this._bundles.get(i,r),l=this.backend.get(a);void 0===l.renderContexts&&(l.renderContexts=new Set);const c=i.version!==l.version,u=!1===l.renderContexts.has(s)||c;if(l.renderContexts.add(s),u){this.backend.beginBundle(s),(void 0===l.renderObjects||c)&&(l.renderObjects=[]),this._currentRenderBundle=a;const e=o.opaque;!0===this.opaque&&e.length>0&&this._renderObjects(e,r,t,n),this._currentRenderBundle=null,this.backend.finishBundle(s,a),l.version=i.version}else{const{renderObjects:e}=l;for(let t=0,n=e.length;t<n;t++){const n=e[t];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(s,a)}render(e,t){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,n=e!==x0.y_p,i=t!==x0.Zr2;if(!1===n&&!1===i)return null;const{width:r,height:o}=this.getDrawingBufferSize(Sde),{depth:s,stencil:a}=this;let l=this._frameBufferTarget;return null===l&&(l=new x0.O0B(r,o,{depthBuffer:s,stencilBuffer:a,type:this._colorBufferType,format:x0.GWd,colorSpace:x0.Zr2,generateMipmaps:!1,minFilter:x0.k6q,magFilter:x0.k6q,samples:this.samples}),l.isPostProcessingRenderTarget=!0,this._frameBufferTarget=l),l.depthBuffer=s,l.stencilBuffer=a,l.setSize(r,o),l.viewport.copy(this._viewport),l.scissor.copy(this._scissor),l.viewport.multiplyScalar(this._pixelRatio),l.scissor.multiplyScalar(this._pixelRatio),l.scissorTest=this._scissorTest,l}_renderScene(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!0===this._isDeviceLost)return;const i=n?this._getFrameBufferTarget():null,r=this._nodes.nodeFrame,o=r.renderId,s=this._currentRenderContext,a=this._currentRenderObjectFunction,l=!0===e.isScene?e:Ede,c=this._renderTarget||this._outputRenderTarget,u=this._activeCubeFace,h=this._activeMipmapLevel;let d;null!==i?(d=i,this.setRenderTarget(d)):d=c;const p=this._renderContexts.get(e,t,d);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,r.renderId=this.info.calls;const f=this.coordinateSystem,m=this.xr;if(t.coordinateSystem!==f&&!1===m.isPresenting&&(t.coordinateSystem=f,t.updateProjectionMatrix(),t.isArrayCamera))for(const M of t.cameras)M.coordinateSystem=f,M.updateProjectionMatrix();!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===m.enabled&&!0===m.isPresenting&&(!0===m.cameraAutoUpdate&&m.updateCamera(t),t=m.getCamera());let g=this._viewport,v=this._scissor,y=this._pixelRatio;null!==d&&(g=d.viewport,v=d.scissor,y=1),this.getDrawingBufferSize(Sde),Cde.set(0,0,Sde.width,Sde.height);const A=void 0===g.minDepth?0:g.minDepth,x=void 0===g.maxDepth?1:g.maxDepth;p.viewportValue.copy(g).multiplyScalar(y).floor(),p.viewportValue.width>>=h,p.viewportValue.height>>=h,p.viewportValue.minDepth=A,p.viewportValue.maxDepth=x,p.viewport=!1===p.viewportValue.equals(Cde),p.scissorValue.copy(v).multiplyScalar(y).floor(),p.scissor=this._scissorTest&&!1===p.scissorValue.equals(Cde),p.scissorValue.width>>=h,p.scissorValue.height>>=h,p.clippingContext||(p.clippingContext=new ade),p.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,d),Tde.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Mde.setFromProjectionMatrix(Tde,f);const b=this._renderLists.get(e,t);if(b.begin(),this._projectObject(e,t,0,b,p.clippingContext),b.finish(),!0===this.sortObjects&&b.sort(this._opaqueSort,this._transparentSort),null!==d){this._textures.updateRenderTarget(d,h);const e=this._textures.get(d);p.textures=e.textures,p.depthTexture=e.depthTexture,p.width=e.width,p.height=e.height,p.renderTarget=d,p.depth=d.depthBuffer,p.stencil=d.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=this.domElement.width,p.height=this.domElement.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=h,p.height>>=h,p.activeCubeFace=u,p.activeMipmapLevel=h,p.occlusionQueryCount=b.occlusionQueryCount,this._background.update(l,b,p),this.backend.beginRender(p);const{bundles:_,lightsNode:w,transparentDoublePass:E,transparent:S,opaque:C}=b;return _.length>0&&this._renderBundles(_,l,w),!0===this.opaque&&C.length>0&&this._renderObjects(C,t,l,w),!0===this.transparent&&S.length>0&&this._renderTransparents(S,E,t,l,w),this.backend.finishRender(p),r.renderId=o,this._currentRenderContext=s,this._currentRenderObjectFunction=a,null!==i&&(this.setRenderTarget(c,u,h),this._renderOutput(d)),l.onAfterRender(this,e,t,d),p}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setSize(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),!0===n&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,i){const r=this._scissor;e.isVector4?r.copy(e):r.set(e,t,n,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const s=this._viewport;e.isVector4?s.copy(e):s.set(e,t,n,i),s.minDepth=r,s.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const i=this._renderTarget||this._getFrameBufferTarget();let r=null;if(null!==i){this._textures.updateRenderTarget(i);const e=this._textures.get(i);r=this._renderContexts.getForClear(i),r.textures=e.textures,r.depthTexture=e.depthTexture,r.width=e.width,r.height=e.height,r.renderTarget=i,r.depth=i.depthBuffer,r.stencil=i.stencilBuffer,r.clearColorValue=this.backend.getClearColor()}this.backend.clear(e,t,n,r),null!==i&&null===this._renderTarget&&this._renderOutput(i)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];!1===this._initialized&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:x0.y_p}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:x0.Zr2}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||null===this._renderTarget}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach((e=>{null!==e&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const i=this.backend,r=this._pipelines,o=this._bindings,s=this._nodes,a=Array.isArray(e)?e:[e];if(void 0===a[0]||!0!==a[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const l of a){if(!1===r.has(l)){const e=()=>{l.removeEventListener("dispose",e),r.delete(l),o.delete(l),s.delete(l)};l.addEventListener("dispose",e);const t=l.onInitFunction;null!==t&&t.call(l,{renderer:this})}s.updateForCompute(l),o.updateForCompute(l);const t=o.getForCompute(l),n=r.getForCompute(l,t);i.compute(e,l,t,n)}i.finishCompute(e),t.renderId=n}async computeAsync(e){!1===this._initialized&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return!1===this._initialized&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"render";return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return!1===this._initialized?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){!1===this._initialized&&await this.init(),this._textures.updateTexture(e)}initTexture(e){!1===this._initialized&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!==t)if(t.isVector2)t=Rde.set(t.x,t.y,e.image.width,e.image.height).floor();else{if(!t.isVector4)return void console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");t=Rde.copy(t).floor()}else t=Rde.set(0,0,e.image.width,e.image.height);let n,i=this._currentRenderContext;null!==i?n=i.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),null!==n&&(this._textures.updateRenderTarget(n),i=this._textures.get(n))),this._textures.updateTexture(e,{renderTarget:n}),this.backend.copyFramebufferToTexture(e,i,t)}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,i,r)}async readRenderTargetPixelsAsync(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return this.backend.copyTextureToBuffer(e.textures[o],t,n,i,r,s)}_projectObject(e,t,n,i,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(r=r.getGroupContext(e));else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||Mde.intersectsSprite(e)){!0===this.sortObjects&&Rde.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Tde);const{geometry:t,material:o}=e;o.visible&&i.push(e,t,o,n,Rde.z,null,r)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||Mde.intersectsObject(e))){const{geometry:t,material:o}=e;if(!0===this.sortObjects&&(null===t.boundingSphere&&t.computeBoundingSphere(),Rde.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Tde)),Array.isArray(o)){const s=t.groups;for(let a=0,l=s.length;a<l;a++){const l=s[a],c=o[l.materialIndex];c&&c.visible&&i.push(e,t,c,n,Rde.z,l,r)}}else o.visible&&i.push(e,t,o,n,Rde.z,null,r)}if(!0===e.isBundleGroup&&void 0!==this.backend.beginBundle){const n=i;(i=this._renderLists.get(e,t)).begin(),n.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const o=e.children;for(let s=0,a=o.length;s<a;s++)this._projectObject(o[s],t,n,i,r)}_renderBundles(e,t,n){for(const i of e)this._renderBundle(i,t,n)}_renderTransparents(e,t,n,i,r){if(t.length>0){for(const{material:e}of t)e.side=x0.hsX;this._renderObjects(t,n,i,r,"backSide");for(const{material:e}of t)e.side=x0.hB5;this._renderObjects(e,n,i,r);for(const{material:e}of t)e.side=x0.$EB}else this._renderObjects(e,n,i,r)}_renderObjects(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;for(let o=0,s=e.length;o<s;o++){const{object:s,geometry:a,material:l,group:c,clippingContext:u}=e[o];this._currentRenderObjectFunction(s,n,t,a,l,c,i,u,r)}}renderObject(e,t,n,i,r,o,s){let a,l,c,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;if(e.onBeforeRender(this,t,n,i,r,o),null!==t.overrideMaterial){const e=t.overrideMaterial;r.positionNode&&r.positionNode.isNode&&(a=e.positionNode,e.positionNode=r.positionNode),e.alphaTest=r.alphaTest,e.alphaMap=r.alphaMap,e.transparent=r.transparent||r.transmission>0,e.isShadowPassMaterial&&(e.side=null===r.shadowSide?r.side:r.shadowSide,r.depthNode&&r.depthNode.isNode&&(c=e.depthNode,e.depthNode=r.depthNode),r.castShadowNode&&r.castShadowNode.isNode&&(l=e.colorNode,e.colorNode=r.castShadowNode)),r=e}!0===r.transparent&&r.side===x0.$EB&&!1===r.forceSinglePass?(r.side=x0.hsX,this._handleObjectFunction(e,r,t,n,s,o,u,"backSide"),r.side=x0.hB5,this._handleObjectFunction(e,r,t,n,s,o,u,h),r.side=x0.$EB):this._handleObjectFunction(e,r,t,n,s,o,u,h),void 0!==a&&(t.overrideMaterial.positionNode=a),void 0!==c&&(t.overrideMaterial.depthNode=c),void 0!==l&&(t.overrideMaterial.colorNode=l),e.onAfterRender(this,t,n,i,r,o)}_renderObjectDirect(e,t,n,i,r,o,s,a){const l=this._objects.get(e,t,n,i,r,this._currentRenderContext,s,a);l.drawRange=e.geometry.drawRange,l.group=o;const c=this._nodes.needsRefresh(l);if(c&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.bundleGroup}this.backend.draw(l,this.info),c&&this._nodes.updateAfter(l)}_createObjectPipeline(e,t,n,i,r,o,s,a){const l=this._objects.get(e,t,n,i,r,this._currentRenderContext,s,a);l.drawRange=e.geometry.drawRange,l.group=o,this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l),this._pipelines.getForRender(l,this._compilationPromises),this._nodes.updateAfter(l)}get compile(){return this.compileAsync}}class Pde{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}class Bde extends Pde{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return(e=this._buffer.byteLength)+(Yle-e%Yle)%Yle;var e}get buffer(){return this._buffer}update(){return!0}}class Lde extends Bde{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.isUniformBuffer=!0}}let Nde=0;class Dde extends Lde{constructor(e,t){super("UniformBuffer_"+Nde++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class kde extends Lde{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(null===e){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,n=this.uniforms.length;t<n;t++){const n=this.uniforms[t],{boundary:i,itemSize:r}=n,o=e%Yle;0!==o&&Yle-o-i<0?e+=Yle-o:o%i!==0&&(e+=o%i),n.offset=e/this.bytesPerElement,e+=r*this.bytesPerElement}return Math.ceil(e/Yle)*Yle}update(){let e=!1;for(const t of this.uniforms)!0===this.updateByType(t)&&(e=!0);return e}updateByType(e){return e.isNumberUniform?this.updateNumber(e):e.isVector2Uniform?this.updateVector2(e):e.isVector3Uniform?this.updateVector3(e):e.isVector4Uniform?this.updateVector4(e):e.isColorUniform?this.updateColor(e):e.isMatrix3Uniform?this.updateMatrix3(e):e.isMatrix4Uniform?this.updateMatrix4(e):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r]!==i){this._getBufferForType(o)[r]=n[r]=i,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r+0]!==i.x||n[r+1]!==i.y){const e=this._getBufferForType(o);e[r+0]=n[r+0]=i.x,e[r+1]=n[r+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r+0]!==i.x||n[r+1]!==i.y||n[r+2]!==i.z){const e=this._getBufferForType(o);e[r+0]=n[r+0]=i.x,e[r+1]=n[r+1]=i.y,e[r+2]=n[r+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset,o=e.getType();if(n[r+0]!==i.x||n[r+1]!==i.y||n[r+2]!==i.z||n[r+4]!==i.w){const e=this._getBufferForType(o);e[r+0]=n[r+0]=i.x,e[r+1]=n[r+1]=i.y,e[r+2]=n[r+2]=i.z,e[r+3]=n[r+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,i=e.getValue(),r=e.offset;if(n[r+0]!==i.r||n[r+1]!==i.g||n[r+2]!==i.b){const e=this.buffer;e[r+0]=n[r+0]=i.r,e[r+1]=n[r+1]=i.g,e[r+2]=n[r+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,i=e.getValue().elements,r=e.offset;if(n[r+0]!==i[0]||n[r+1]!==i[1]||n[r+2]!==i[2]||n[r+4]!==i[3]||n[r+5]!==i[4]||n[r+6]!==i[5]||n[r+8]!==i[6]||n[r+9]!==i[7]||n[r+10]!==i[8]){const e=this.buffer;e[r+0]=n[r+0]=i[0],e[r+1]=n[r+1]=i[1],e[r+2]=n[r+2]=i[2],e[r+4]=n[r+4]=i[3],e[r+5]=n[r+5]=i[4],e[r+6]=n[r+6]=i[5],e[r+8]=n[r+8]=i[6],e[r+9]=n[r+9]=i[7],e[r+10]=n[r+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,i=e.getValue().elements,r=e.offset;if(!1===function(e,t,n){for(let i=0,r=t.length;i<r;i++)if(e[n+i]!==t[i])return!1;return!0}(n,i,r)){this.buffer.set(i,r),function(e,t,n){for(let i=0,r=t.length;i<r;i++)e[n+i]=t[i]}(n,i,r),t=!0}return t}_getBufferForType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e?new Int32Array(this.buffer.buffer):"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e?new Uint32Array(this.buffer.buffer):this.buffer}}let Ode=0;class Ude extends kde{constructor(e,t){super(e),this.id=Ode++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let Fde=0;class zde extends Pde{constructor(e,t){super(e),this.id=Fde++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version&&(this.version=e.version,!0)}}class jde extends zde{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=i}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Vde extends jde{constructor(e,t,n){super(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.isSampledCubeTexture=!0}}class Gde extends jde{constructor(e,t,n){super(e,t,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null),this.isSampledTexture3D=!0}}const Hde={textureDimensions:"textureSize",equals:"equal"},Wde={low:"lowp",medium:"mediump",high:"highp"},Qde={swizzleAssign:!0,storageBuffer:!1},qde="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\n";class Xde extends khe{constructor(e,t){super(e,t,new tde),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==x0.jf0}getMethod(e){return Hde[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const r of t.inputs)i.push(this.getType(r.type)+" "+r.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {\n\n\t${n.vars}\n\n${n.code}\n\treturn ${n.result};\n\n}`}setupPBO(e){const t=e.value;if(void 0===t.pbo){const e=t.array,n=t.count*t.itemSize,{itemSize:i}=t,r=t.array.constructor.name.toLowerCase().includes("int");let o=r?x0.ZQM:x0.VT0;2===i?o=r?x0.TkQ:x0.paN:3===i?o=r?x0.VGF:x0.HIg:4===i&&(o=r?x0.c90:x0.GWd);const s={Float32Array:x0.RQf,Uint8Array:x0.OUM,Uint16Array:x0.cHt,Uint32Array:x0.bkx,Int8Array:x0.tJf,Int16Array:x0.fBL,Int32Array:x0.Yuy,Uint8ClampedArray:x0.OUM},a=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/i))));let l=Math.ceil(n/i/a);a*l*i<n&&l++;const c=a*l*i,u=new e.constructor(c);u.set(e,0),t.array=u;const h=new x0.GYF(t.array,a,l,o,s[t.array.constructor.name]||x0.RQf);h.needsUpdate=!0,h.isPBOTexture=!0;const d=new eie(h,null,null);d.setPrecision("high"),t.pboNode=d,t.pbo=d.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;return e.isNodeUniform&&!0!==e.node.isTextureNode&&!0!==e.node.isBufferNode?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,i=t.value;if(this.renderer.backend.has(i)){this.renderer.backend.get(i).pbo=i.pbo}const r=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(r);this.increaseUsage(n);const s=n.build(this,"uint"),a=this.getDataFromNode(e);let l=a.propertyName;if(void 0===l){const n=this.getVarFromNode(e);l=this.getPropertyName(n);const r=this.getDataFromNode(t);let c=r.propertySizeName;void 0===c&&(c=l+"Size",this.getVarFromNode(t,c,"uint"),this.addLineFlowCode(`${c} = uint( textureSize( ${o}, 0 ).x )`,e),r.propertySizeName=c);const{itemSize:u}=i,h="."+c9.join("").slice(0,u),d=`ivec2(${s} % ${c}, ${s} / ${c})`,p=this.generateTextureLoad(null,o,d,null,"0");let f="vec4";i.pbo.type===x0.bkx?f="uvec4":i.pbo.type===x0.Yuy&&(f="ivec4"),this.addLineFlowCode(`${l} = ${f}(${p})${h}`,e),a.propertyName=l}return l}generateTextureLoad(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0";return i?`texelFetch( ${t}, ivec3( ${n}, ${i} ), ${r} )`:`texelFetch( ${t}, ${n}, ${r} )`}generateTexture(e,t,n,i){return e.isDepthTexture?`texture( ${t}, ${n} ).x`:(i&&(n=`vec3( ${n}, ${i} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,i){return`textureLod( ${t}, ${n}, ${i} )`}generateTextureBias(e,t,n,i){return`texture( ${t}, ${n}, ${i} )`}generateTextureGrad(e,t,n,i){return`textureGrad( ${t}, ${n}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===o)return`texture( ${t}, vec3( ${n}, ${i} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const i of n)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join("\n\t")}getUniforms(e){const t=this.uniforms[e],n=[],i={};for(const o of t){let t=null,r=!1;if("texture"===o.type||"texture3D"===o.type){const e=o.node.value;let n="";!0!==e.isDataTexture&&!0!==e.isData3DTexture||(e.type===x0.bkx?n="u":e.type===x0.Yuy&&(n="i")),t="texture3D"===o.type?`${n}sampler3D ${o.name};`:e.compareFunction?`sampler2DShadow ${o.name};`:!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?`${n}sampler2DArray ${o.name};`:`${n}sampler2D ${o.name};`}else if("cubeTexture"===o.type)t=`samplerCube ${o.name};`;else if("buffer"===o.type){const e=o.node,n=this.getType(e.bufferType),i=e.bufferCount,r=i>0?i:"";t=`${e.name} {\n\t${n} ${o.name}[${r}];\n};\n`}else{t=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,r=!0}const s=o.node.precision;if(null!==s&&(t=Wde[s]+" "+t),r){t="\t"+t;const e=o.groupNode.name;(i[e]||(i[e]=[])).push(t)}else t="uniform "+t,n.push(t)}let r="";for(const o in i){const t=i[o];r+=this._getGLSLUniformStruct(e+"_"+o,t.join("\n"))+"\n"}return r+=n.join("\n"),r}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==x0.Yuy){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const i=n.array;!1===(i instanceof Uint32Array||i instanceof Int32Array)&&(t=t.slice(1))}return t}getAttributes(e){let t="";if("vertex"===e||"compute"===e){const e=this.getAttributesArray();let n=0;for(const i of e)t+=`layout( location = ${n++} ) in ${i.type} ${i.name};\n`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`\t${n.type} ${n.name};`);return t.join("\n")}getStructs(e){const t=[],n=this.structs[e],i=[];for(const r of n)if(r.output)for(const e of r.members)i.push(`layout( location = ${e.index} ) out ${e.type} ${e.name};`);else{let e="struct "+r.name+" {\n";e+=this.getStructMembers(r),e+="\n};\n",t.push(e)}return 0===i.length&&i.push("layout( location = 0 ) out vec4 fragColor;"),"\n"+i.join("\n")+"\n\n"+t.join("\n")}getVaryings(e){let t="";const n=this.varyings;if("vertex"===e||"compute"===e)for(const i of n){"compute"===e&&(i.needsInterpolation=!0);const n=this.getType(i.type);if(i.needsInterpolation){t+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""} out ${n} ${i.name};\n`}else t+=`${n} ${i.name};\n`}else if("fragment"===e)for(const i of n)if(i.needsInterpolation){const e=this.getType(i.type);t+=`${e.includes("int")||e.includes("uv")||e.includes("iv")?"flat ":""}in ${e} ${i.name};\n`}for(const i of this.builtins[e])t+=`${i};\n`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce(((e,t)=>e*t),1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;const i=this.extensions[n]||(this.extensions[n]=new Map);!1===i.has(e)&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if("vertex"===e){const t=this.renderer.backend.extensions;this.object.isBatchedMesh&&t.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(void 0!==n)for(const{name:i,behavior:r}of n.values())t.push(`#extension ${i} : ${r}`);return t.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=Qde[e];if(void 0===t){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance"}if(void 0!==n){const e=this.renderer.backend.extensions;e.has(n)&&(e.get(n),t=!0)}Qde[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const i=e[n],r=this.getPropertyName(i.attributeNode);t+=`${i.varyingName} = ${r};\n\t`}return t}_getGLSLUniformStruct(e,t){return`\nlayout( std140 ) uniform ${e} {\n${t}\n};`}_getGLSLVertexCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions\n${e.extensions}\n\n// precision\n${qde}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// attributes\n${e.attributes}\n\n// codes\n${e.codes}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// transforms\n\t${e.transforms}\n\n\t// flow\n\t${e.flow}\n\n\tgl_PointSize = 1.0;\n\n}\n`}_getGLSLFragmentCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// precision\n${qde}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// codes\n${e.codes}\n\n// structs\n${e.structs}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n="// code\n\n";n+=this.flowCode[t];const i=this.flowNodes[t],r=i[i.length-1];for(const e of i){const i=this.getFlowData(e),o=e.name;o&&(n.length>0&&(n+="\n"),n+=`\t// flow -> ${o}\n\t`),n+=`${i.code}\n\t`,e===r&&"compute"!==t&&(n+="// result\n\t","vertex"===t?(n+="gl_Position = ",n+=`${i.result};`):"fragment"===t&&(e.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${i.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=super.getUniformFromNode(e,t,n,i),o=this.getDataFromNode(e,n,this.globalCache);let s=o.uniformGPU;if(void 0===s){const i=e.groupNode,a=i.name,l=this.getBindGroupArray(a,n);if("texture"===t)s=new jde(r.name,r.node,i),l.push(s);else if("cubeTexture"===t)s=new Vde(r.name,r.node,i),l.push(s);else if("texture3D"===t)s=new Gde(r.name,r.node,i),l.push(s);else if("buffer"===t){e.name=`NodeBuffer_${e.id}`,r.name=`buffer${e.id}`;const t=new Dde(e,i);t.name=e.name,l.push(t),s=t}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let o=e[a];void 0===o&&(o=new Ude(n+"_"+a,i),e[a]=o,l.push(o)),s=this.getNodeUniform(r,t),o.addUniform(s)}o.uniformGPU=s}return r}}let $de=null,Yde=null;class Kde{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null}}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"render";if(!this.trackTimestamp)return void(0,x0.mcG)("WebGPURenderer: Timestamp tracking is disabled.");const t=this.timestampQueryPool[e];if(!t)return void(0,x0.mcG)(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return $de=$de||new x0.I9Y,this.renderer.getDrawingBufferSize($de)}setScissorTest(){}getClearColor(){const e=this.renderer;return Yde=Yde||new Ece,e.getClearColor(Yde),Yde.getRGB(Yde),Yde}getDomElement(){let e=this.domElement;return null===e&&(e=void 0!==this.parameters.canvas?this.parameters.canvas:(0,x0.lPF)(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${x0.sPf} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let Jde,Zde,epe=0;class tpe{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class npe{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:i}=n,r=e.array,o=e.usage||i.STATIC_DRAW,s=e.isInterleavedBufferAttribute?e.data:e,a=n.get(s);let l,c=a.bufferGPU;if(void 0===c&&(c=this._createBuffer(i,t,r,o),a.bufferGPU=c,a.bufferType=t,a.version=s.version),r instanceof Float32Array)l=i.FLOAT;else if(r instanceof Uint16Array)l=e.isFloat16BufferAttribute?i.HALF_FLOAT:i.UNSIGNED_SHORT;else if(r instanceof Int16Array)l=i.SHORT;else if(r instanceof Uint32Array)l=i.UNSIGNED_INT;else if(r instanceof Int32Array)l=i.INT;else if(r instanceof Int8Array)l=i.BYTE;else if(r instanceof Uint8Array)l=i.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+r);l=i.UNSIGNED_BYTE}let u={bufferGPU:c,bufferType:t,type:l,byteLength:r.byteLength,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:l===i.INT||l===i.UNSIGNED_INT||e.gpuType===x0.Yuy,id:epe++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const e=this._createBuffer(i,t,r,o);u=new tpe(u,e)}n.set(e,u)}updateAttribute(e){const t=this.backend,{gl:n}=t,i=e.array,r=e.isInterleavedBufferAttribute?e.data:e,o=t.get(r),s=o.bufferType,a=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(s,o.bufferGPU),0===a.length)n.bufferSubData(s,0,i);else{for(let e=0,t=a.length;e<t;e++){const t=a[e];n.bufferSubData(s,t.start*i.BYTES_PER_ELEMENT,i,t.start,t.count)}r.clearUpdateRanges()}n.bindBuffer(s,null),o.version=r.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);n.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:r}=t.get(i),o=e.array,s=o.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,r);const a=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,a),n.bufferData(n.COPY_WRITE_BUFFER,s,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,s),await t.utils._clientWaitAsync();const l=new e.array.constructor(o.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,a),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,l),n.deleteBuffer(a),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(e,t,n,i){const r=e.createBuffer();return e.bindBuffer(t,r),e.bufferData(t,n,i),e.bindBuffer(t,null),r}}class ipe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;Jde={[x0.gO9]:e.FUNC_ADD,[x0.FXf]:e.FUNC_SUBTRACT,[x0.nST]:e.FUNC_REVERSE_SUBTRACT},Zde={[x0.ojh]:e.ZERO,[x0.qad]:e.ONE,[x0.f4X]:e.SRC_COLOR,[x0.ie2]:e.SRC_ALPHA,[x0.hgQ]:e.SRC_ALPHA_SATURATE,[x0.wn6]:e.DST_COLOR,[x0.hdd]:e.DST_ALPHA,[x0.LiQ]:e.ONE_MINUS_SRC_COLOR,[x0.OuU]:e.ONE_MINUS_SRC_ALPHA,[x0.aEY]:e.ONE_MINUS_DST_COLOR,[x0.Nt7]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=(new x0.IUQ).fromArray(t),this.currentViewport=(new x0.IUQ).fromArray(n),this._tempVec4=new x0.IUQ}enable(e){const{enabled:t}=this;!0!==t[e]&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;!1!==t[e]&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==x0.WNZ?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===x0.Vb5?t.cullFace(t.BACK):e===x0.Jnc?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,i,r,o,s,a){const{gl:l}=this;if(e!==x0.XIg){if(!1===this.currentBlendingEnabled&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),e===x0.bCz)r=r||t,o=o||n,s=s||i,t===this.currentBlendEquation&&r===this.currentBlendEquationAlpha||(l.blendEquationSeparate(Jde[t],Jde[r]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=r),n===this.currentBlendSrc&&i===this.currentBlendDst&&o===this.currentBlendSrcAlpha&&s===this.currentBlendDstAlpha||(l.blendFuncSeparate(Zde[n],Zde[i],Zde[o],Zde[s]),this.currentBlendSrc=n,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=s),this.currentBlending=e,this.currentPremultipledAlpha=!1;else if(e!==this.currentBlending||a!==this.currentPremultipledAlpha){if(this.currentBlendEquation===x0.gO9&&this.currentBlendEquationAlpha===x0.gO9||(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=x0.gO9,this.currentBlendEquationAlpha=x0.gO9),a)switch(e){case x0.NTi:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case x0.EZo:l.blendFunc(l.ONE,l.ONE);break;case x0.Kwu:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case x0.EdD:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case x0.NTi:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case x0.EZo:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case x0.Kwu:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case x0.EdD:l.blendFunc(l.ZERO,l.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=a}}else!0===this.currentBlendingEnabled&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1)}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case x0.eHc:t.depthFunc(t.NEVER);break;case x0.lGu:t.depthFunc(t.ALWAYS);break;case x0.brA:t.depthFunc(t.LESS);break;case x0.xSv:t.depthFunc(t.LEQUAL);break;case x0.U3G:t.depthFunc(t.EQUAL);break;case x0.Gwm:t.depthFunc(t.GEQUAL);break;case x0.K52:t.depthFunc(t.GREATER);break;case x0.bw0:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,i){const r=this._tempVec4.set(e,t,n,i);if(!1===this.currentScissor.equals(r)){const{gl:e}=this;e.scissor(r.x,r.y,r.z,r.w),this.currentScissor.copy(r)}}viewport(e,t,n,i){const r=this._tempVec4.set(e,t,n,i);if(!1===this.currentViewport.equals(r)){const{gl:e}=this;e.viewport(r.x,r.y,r.z,r.w),this.currentViewport.copy(r)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){this.currentStencilFunc===e&&this.currentStencilRef===t&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){this.currentStencilFail===e&&this.currentStencilZFail===t&&this.currentStencilZPass===n||(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:i}=this;e.side===x0.$EB?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let r=e.side===x0.hsX;t&&(r=!r),this.setFlipSided(r),e.blending===x0.NTi&&!1===e.transparent?this.setBlending(x0.XIg):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n){const e=12288;for(let t=0;t<8;t++)t<n?this.enable(e+t):this.disable(e+t)}}setPolygonOffset(e,t,n){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===t&&this.currentPolygonOffsetUnits===n||(i.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e&&(this.gl.useProgram(e),this.currentProgram=e,!0)}setVertexState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.gl;return(this.currentVAO!==e||this.currentIndex!==t)&&(n.bindVertexArray(e),null!==t&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0)}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:i}=this;return i[e]!==t&&(n.bindFramebuffer(e,t),i[e]=t,e===n.DRAW_FRAMEBUFFER&&(i[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(i[n.DRAW_FRAMEBUFFER]=t),!0)}drawBuffers(e,t){const{gl:n}=this;let i=[],r=!1;if(null!==e.textures){i=this.currentDrawbuffers.get(t),void 0===i&&(i=[],this.currentDrawbuffers.set(t,i));const o=e.textures;if(i.length!==o.length||i[0]!==n.COLOR_ATTACHMENT0){for(let e=0,t=o.length;e<t;e++)i[e]=n.COLOR_ATTACHMENT0+e;i.length=o.length,r=!0}}else i[0]!==n.BACK&&(i[0]=n.BACK,r=!0);r&&n.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:i}=this;void 0===e&&(e=t.TEXTURE0+i-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:i,currentTextureSlot:r,currentBoundTextures:o,maxTextures:s}=this;void 0===n&&(n=null===r?i.TEXTURE0+s-1:r);let a=o[n];void 0===a&&(a={type:void 0,texture:void 0},o[n]=a),a.type===e&&a.texture===t||(r!==n&&(i.activeTexture(n),this.currentTextureSlot=n),i.bindTexture(e,t),a.type=e,a.texture=t)}bindBufferBase(e,t,n){const{gl:i}=this,r=`${e}-${t}`;return this.currentBoundBufferBases[r]!==n&&(i.bindBufferBase(e,t,n),this.currentBoundBufferBases[r]=n,!0)}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,i=n[t];void 0!==i&&void 0!==i.type&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class rpe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x0.jf0;const{gl:n,extensions:i}=this;let r;if(e===x0.OUM)return n.UNSIGNED_BYTE;if(e===x0.Wew)return n.UNSIGNED_SHORT_4_4_4_4;if(e===x0.gJ2)return n.UNSIGNED_SHORT_5_5_5_1;if(e===x0.Dmk)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===x0.tJf)return n.BYTE;if(e===x0.fBL)return n.SHORT;if(e===x0.cHt)return n.UNSIGNED_SHORT;if(e===x0.Yuy)return n.INT;if(e===x0.bkx)return n.UNSIGNED_INT;if(e===x0.RQf)return n.FLOAT;if(e===x0.ix0)return n.HALF_FLOAT;if(e===x0.wrO)return n.ALPHA;if(e===x0.HIg)return n.RGB;if(e===x0.GWd)return n.RGBA;if(e===x0.Kzv)return n.LUMINANCE;if(e===x0.CMB)return n.LUMINANCE_ALPHA;if(e===x0.zdS)return n.DEPTH_COMPONENT;if(e===x0.dcC)return n.DEPTH_STENCIL;if(e===x0.VT0)return n.RED;if(e===x0.ZQM)return n.RED_INTEGER;if(e===x0.paN)return n.RG;if(e===x0.TkQ)return n.RG_INTEGER;if(e===x0.c90)return n.RGBA_INTEGER;if(e===x0.IE4||e===x0.Nz6||e===x0.jR7||e===x0.BXX)if(t===x0.er$){if(r=i.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(e===x0.IE4)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===x0.Nz6)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===x0.jR7)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===x0.BXX)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=i.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(e===x0.IE4)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===x0.Nz6)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===x0.jR7)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===x0.BXX)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===x0.k6Q||e===x0.kTp||e===x0.HXV||e===x0.pBf){if(r=i.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(e===x0.k6Q)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===x0.kTp)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===x0.HXV)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===x0.pBf)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===x0.CVz||e===x0.Riy||e===x0.KDk){if(r=i.get("WEBGL_compressed_texture_etc"),null===r)return null;if(e===x0.CVz||e===x0.Riy)return t===x0.er$?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(e===x0.KDk)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(e===x0.qa3||e===x0.B_h||e===x0.czI||e===x0.rSH||e===x0.Qrf||e===x0.psI||e===x0.a5J||e===x0._QJ||e===x0.uB5||e===x0.lyL||e===x0.bC7||e===x0.y3Z||e===x0.ojs||e===x0.S$4){if(r=i.get("WEBGL_compressed_texture_astc"),null===r)return null;if(e===x0.qa3)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===x0.B_h)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===x0.czI)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===x0.rSH)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===x0.Qrf)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===x0.psI)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===x0.a5J)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===x0._QJ)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===x0.uB5)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===x0.lyL)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===x0.bC7)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===x0.y3Z)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===x0.ojs)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===x0.S$4)return t===x0.er$?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===x0.Fn){if(r=i.get("EXT_texture_compression_bptc"),null===r)return null;if(e===x0.Fn)return t===x0.er$?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===x0.Kef||e===x0.XG_||e===x0.HO_||e===x0.CWW){if(r=i.get("EXT_texture_compression_rgtc"),null===r)return null;if(e===x0.Fn)return r.COMPRESSED_RED_RGTC1_EXT;if(e===x0.XG_)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===x0.HO_)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===x0.CWW)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===x0.V3x?n.UNSIGNED_INT_24_8:void 0!==n[e]?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise(((n,i)=>{!function r(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED)return e.deleteSync(t),void i();o!==e.TIMEOUT_EXPIRED?(e.deleteSync(t),n()):requestAnimationFrame(r)}()}))}}let ope,spe,ape,lpe=!1;class cpe{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},!1===lpe&&(this._init(),lpe=!0)}_init(){const e=this.gl;ope={[x0.GJx]:e.REPEAT,[x0.ghU]:e.CLAMP_TO_EDGE,[x0.kTW]:e.MIRRORED_REPEAT},spe={[x0.hxR]:e.NEAREST,[x0.pHI]:e.NEAREST_MIPMAP_NEAREST,[x0.Cfg]:e.NEAREST_MIPMAP_LINEAR,[x0.k6q]:e.LINEAR,[x0.kRr]:e.LINEAR_MIPMAP_NEAREST,[x0.$_I]:e.LINEAR_MIPMAP_LINEAR},ape={[x0.amv]:e.NEVER,[x0.FFZ]:e.ALWAYS,[x0.vim]:e.LESS,[x0.TiK]:e.LEQUAL,[x0.kO0]:e.EQUAL,[x0.gWB]:e.GEQUAL,[x0.eoi]:e.GREATER,[x0.jzd]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return n=!0===e.isCubeTexture?t.TEXTURE_CUBE_MAP:!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:!0===e.isData3DTexture?t.TEXTURE_3D:t.TEXTURE_2D,n}getInternalFormat(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{gl:o,extensions:s}=this;if(null!==e){if(void 0!==o[e])return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let a=t;return t===o.RED&&(n===o.FLOAT&&(a=o.R32F),n===o.HALF_FLOAT&&(a=o.R16F),n===o.UNSIGNED_BYTE&&(a=o.R8),n===o.UNSIGNED_SHORT&&(a=o.R16),n===o.UNSIGNED_INT&&(a=o.R32UI),n===o.BYTE&&(a=o.R8I),n===o.SHORT&&(a=o.R16I),n===o.INT&&(a=o.R32I)),t===o.RED_INTEGER&&(n===o.UNSIGNED_BYTE&&(a=o.R8UI),n===o.UNSIGNED_SHORT&&(a=o.R16UI),n===o.UNSIGNED_INT&&(a=o.R32UI),n===o.BYTE&&(a=o.R8I),n===o.SHORT&&(a=o.R16I),n===o.INT&&(a=o.R32I)),t===o.RG&&(n===o.FLOAT&&(a=o.RG32F),n===o.HALF_FLOAT&&(a=o.RG16F),n===o.UNSIGNED_BYTE&&(a=o.RG8),n===o.UNSIGNED_SHORT&&(a=o.RG16),n===o.UNSIGNED_INT&&(a=o.RG32UI),n===o.BYTE&&(a=o.RG8I),n===o.SHORT&&(a=o.RG16I),n===o.INT&&(a=o.RG32I)),t===o.RG_INTEGER&&(n===o.UNSIGNED_BYTE&&(a=o.RG8UI),n===o.UNSIGNED_SHORT&&(a=o.RG16UI),n===o.UNSIGNED_INT&&(a=o.RG32UI),n===o.BYTE&&(a=o.RG8I),n===o.SHORT&&(a=o.RG16I),n===o.INT&&(a=o.RG32I)),t===o.RGB&&(n===o.FLOAT&&(a=o.RGB32F),n===o.HALF_FLOAT&&(a=o.RGB16F),n===o.UNSIGNED_BYTE&&(a=o.RGB8),n===o.UNSIGNED_SHORT&&(a=o.RGB16),n===o.UNSIGNED_INT&&(a=o.RGB32UI),n===o.BYTE&&(a=o.RGB8I),n===o.SHORT&&(a=o.RGB16I),n===o.INT&&(a=o.RGB32I),n===o.UNSIGNED_BYTE&&(a=i===x0.er$&&!1===r?o.SRGB8:o.RGB8),n===o.UNSIGNED_SHORT_5_6_5&&(a=o.RGB565),n===o.UNSIGNED_SHORT_5_5_5_1&&(a=o.RGB5_A1),n===o.UNSIGNED_SHORT_4_4_4_4&&(a=o.RGB4),n===o.UNSIGNED_INT_5_9_9_9_REV&&(a=o.RGB9_E5)),t===o.RGB_INTEGER&&(n===o.UNSIGNED_BYTE&&(a=o.RGB8UI),n===o.UNSIGNED_SHORT&&(a=o.RGB16UI),n===o.UNSIGNED_INT&&(a=o.RGB32UI),n===o.BYTE&&(a=o.RGB8I),n===o.SHORT&&(a=o.RGB16I),n===o.INT&&(a=o.RGB32I)),t===o.RGBA&&(n===o.FLOAT&&(a=o.RGBA32F),n===o.HALF_FLOAT&&(a=o.RGBA16F),n===o.UNSIGNED_BYTE&&(a=o.RGBA8),n===o.UNSIGNED_SHORT&&(a=o.RGBA16),n===o.UNSIGNED_INT&&(a=o.RGBA32UI),n===o.BYTE&&(a=o.RGBA8I),n===o.SHORT&&(a=o.RGBA16I),n===o.INT&&(a=o.RGBA32I),n===o.UNSIGNED_BYTE&&(a=i===x0.er$&&!1===r?o.SRGB8_ALPHA8:o.RGBA8),n===o.UNSIGNED_SHORT_4_4_4_4&&(a=o.RGBA4),n===o.UNSIGNED_SHORT_5_5_5_1&&(a=o.RGB5_A1)),t===o.RGBA_INTEGER&&(n===o.UNSIGNED_BYTE&&(a=o.RGBA8UI),n===o.UNSIGNED_SHORT&&(a=o.RGBA16UI),n===o.UNSIGNED_INT&&(a=o.RGBA32UI),n===o.BYTE&&(a=o.RGBA8I),n===o.SHORT&&(a=o.RGBA16I),n===o.INT&&(a=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(n===o.UNSIGNED_SHORT&&(a=o.DEPTH_COMPONENT16),n===o.UNSIGNED_INT&&(a=o.DEPTH_COMPONENT24),n===o.FLOAT&&(a=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&n===o.UNSIGNED_INT_24_8&&(a=o.DEPTH24_STENCIL8),a!==o.R16F&&a!==o.R32F&&a!==o.RG16F&&a!==o.RG32F&&a!==o.RGBA16F&&a!==o.RGBA32F||s.get("EXT_color_buffer_float"),a}setTextureParameters(e,t){const{gl:n,extensions:i,backend:r}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,ope[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,ope[t.wrapT]),e!==n.TEXTURE_3D&&e!==n.TEXTURE_2D_ARRAY||n.texParameteri(e,n.TEXTURE_WRAP_R,ope[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,spe[t.magFilter]);const o=void 0!==t.mipmaps&&t.mipmaps.length>0,s=t.minFilter===x0.k6q&&o?x0.$_I:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,spe[s]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,ape[t.compareFunction])),!0===i.has("EXT_texture_filter_anisotropic")){if(t.magFilter===x0.hxR)return;if(t.minFilter!==x0.Cfg&&t.minFilter!==x0.$_I)return;if(t.type===x0.RQf&&!1===i.has("OES_texture_float_linear"))return;if(t.anisotropy>1){const o=i.get("EXT_texture_filter_anisotropic");n.texParameterf(e,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,r.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:i}=this,r=this.getGLTextureType(e);let o=i[r];void 0===o&&(o=t.createTexture(),n.state.bindTexture(r,o),t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(r,t.TEXTURE_MAG_FILTER,t.NEAREST),i[r]=o),n.set(e,{textureGPU:o,glTextureType:r,isDefault:!0})}createTexture(e,t){const{gl:n,backend:i}=this,{levels:r,width:o,height:s,depth:a}=t,l=i.utils.convert(e.format,e.colorSpace),c=i.utils.convert(e.type),u=this.getInternalFormat(e.internalFormat,l,c,e.colorSpace,e.isVideoTexture),h=n.createTexture(),d=this.getGLTextureType(e);i.state.bindTexture(d,h),this.setTextureParameters(d,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,r,u,o,s,a):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,r,u,o,s,a):e.isVideoTexture||n.texStorage2D(d,r,u,o,s),i.set(e,{textureGPU:h,glTextureType:d,glFormat:l,glType:c,glInternalFormat:u})}copyBufferToTexture(e,t){const{gl:n,backend:i}=this,{textureGPU:r,glTextureType:o,glFormat:s,glType:a}=i.get(t),{width:l,height:c}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(o,r),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(o,0,0,0,l,c,s,a,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:i,height:r}=t,{textureGPU:o,glTextureType:s,glFormat:a,glType:l,glInternalFormat:c}=this.backend.get(e);if(e.isRenderTargetTexture||void 0===o)return;const u=e=>e.isDataTexture?e.image.data:"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap||e instanceof OffscreenCanvas?e:e.data;if(this.backend.state.bindTexture(s,o),this.setTextureParameters(s,e),e.isCompressedTexture){const i=e.mipmaps,r=t.image;for(let t=0;t<i.length;t++){const o=i[t];e.isCompressedArrayTexture?e.format!==n.RGBA?null!==a?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,o.width,o.height,r.depth,a,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,o.width,o.height,r.depth,a,l,o.data):null!==a?n.compressedTexSubImage2D(n.TEXTURE_2D,t,0,0,o.width,o.height,a,o.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const e=t.images;for(let t=0;t<6;t++){const o=u(e[t]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,i,r,a,l,o)}}else if(e.isDataArrayTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,e.width,e.height,e.depth,a,l,e.data)}else if(e.isData3DTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,a,l,e.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(s,0,c,a,l,t.image);else{const e=u(t.image);n.texSubImage2D(s,0,0,0,i,r,a,l,e)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:i,glTextureType:r}=n.get(e);n.state.bindTexture(r,i),t.generateMipmap(r)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const i=n.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const e in i.framebuffers)t.deleteFramebuffer(i.framebuffers[e]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let e=0;e<i.msaaRenderbuffers.length;e++)t.deleteRenderbuffer(i.msaaRenderbuffers[e]);delete i.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:i,renderTarget:r}=n.get(e);this.deallocateRenderBuffers(r),t.deleteTexture(i),n.delete(e)}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const{gl:o,backend:s}=this,{state:a}=this.backend,{textureGPU:l,glTextureType:c,glType:u,glFormat:h}=s.get(t);let d,p,f,m,g,v;null!==n?(d=n.max.x-n.min.x,p=n.max.y-n.min.y,f=n.min.x,m=n.min.y):(d=e.image.width,p=e.image.height,f=0,m=0),null!==i?(g=i.x,v=i.y):(g=0,v=0),a.bindTexture(c,l),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const y=o.getParameter(o.UNPACK_ROW_LENGTH),A=o.getParameter(o.UNPACK_IMAGE_HEIGHT),x=o.getParameter(o.UNPACK_SKIP_PIXELS),b=o.getParameter(o.UNPACK_SKIP_ROWS),_=o.getParameter(o.UNPACK_SKIP_IMAGES),w=e.isCompressedTexture?e.mipmaps[r]:e.image;if(o.pixelStorei(o.UNPACK_ROW_LENGTH,w.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,w.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,f),o.pixelStorei(o.UNPACK_SKIP_ROWS,m),e.isRenderTargetTexture||e.isDepthTexture){const n=s.get(e),i=s.get(t),r=s.get(n.renderTarget),l=s.get(i.renderTarget),c=r.framebuffers[n.cacheKey],u=l.framebuffers[i.cacheKey];a.bindFramebuffer(o.READ_FRAMEBUFFER,c),a.bindFramebuffer(o.DRAW_FRAMEBUFFER,u);let h=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(h=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(f,m,d,p,g,v,d,p,h,o.NEAREST),a.bindFramebuffer(o.READ_FRAMEBUFFER,null),a.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,r,g,v,d,p,h,u,w.data):e.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,r,g,v,w.width,w.height,h,w.data):o.texSubImage2D(o.TEXTURE_2D,r,g,v,d,p,h,u,w);o.pixelStorei(o.UNPACK_ROW_LENGTH,y),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,A),o.pixelStorei(o.UNPACK_SKIP_PIXELS,x),o.pixelStorei(o.UNPACK_SKIP_ROWS,b),o.pixelStorei(o.UNPACK_SKIP_IMAGES,_),0===r&&t.generateMipmaps&&o.generateMipmap(o.TEXTURE_2D),a.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:i}=this,{state:r}=this.backend,{textureGPU:o}=this.backend.get(e),{x:s,y:a,z:l,w:c}=n,u=!0===e.isDepthTexture||t.renderTarget&&t.renderTarget.samples>0,h=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(u){const n=0!==s||0!==a;let u,d;if(!0===e.isDepthTexture?(u=i.DEPTH_BUFFER_BIT,d=i.DEPTH_ATTACHMENT,t.stencil&&(u|=i.STENCIL_BUFFER_BIT)):(u=i.COLOR_BUFFER_BIT,d=i.COLOR_ATTACHMENT0),n){const e=this.backend.get(t.renderTarget),n=e.framebuffers[t.getCacheKey()],d=e.msaaFrameBuffer;r.bindFramebuffer(i.DRAW_FRAMEBUFFER,n),r.bindFramebuffer(i.READ_FRAMEBUFFER,d);const p=h-a-c;i.blitFramebuffer(s,p,s+l,p+c,s,p,s+l,p+c,u,i.NEAREST),r.bindFramebuffer(i.READ_FRAMEBUFFER,n),r.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,s,p,l,c),r.unbindTexture()}else{const e=i.createFramebuffer();r.bindFramebuffer(i.DRAW_FRAMEBUFFER,e),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,d,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,l,c,0,0,l,c,u,i.NEAREST),i.deleteFramebuffer(e)}}else r.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,s,h-c-a,l,c),r.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{gl:r}=this,o=t.renderTarget,{depthTexture:s,depthBuffer:a,stencilBuffer:l,width:c,height:u}=o;if(r.bindRenderbuffer(r.RENDERBUFFER,e),a&&!l){let t=r.DEPTH_COMPONENT24;if(!0===i){this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(r.RENDERBUFFER,o.samples,t,c,u)}else n>0?(s&&s.isDepthTexture&&s.type===r.FLOAT&&(t=r.DEPTH_COMPONENT32F),r.renderbufferStorageMultisample(r.RENDERBUFFER,n,t,c,u)):r.renderbufferStorage(r.RENDERBUFFER,t,c,u);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e)}else a&&l&&(n>0?r.renderbufferStorageMultisample(r.RENDERBUFFER,n,r.DEPTH24_STENCIL8,c,u):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,c,u),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,i,r,o){const{backend:s,gl:a}=this,{textureGPU:l,glFormat:c,glType:u}=this.backend.get(e),h=a.createFramebuffer();a.bindFramebuffer(a.READ_FRAMEBUFFER,h);const d=e.isCubeTexture?a.TEXTURE_CUBE_MAP_POSITIVE_X+o:a.TEXTURE_2D;a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,d,l,0);const p=this._getTypedArrayType(u),f=i*r*this._getBytesPerTexel(u,c),m=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,m),a.bufferData(a.PIXEL_PACK_BUFFER,f,a.STREAM_READ),a.readPixels(t,n,i,r,c,u,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await s.utils._clientWaitAsync();const g=new p(f/p.BYTES_PER_ELEMENT);return a.bindBuffer(a.PIXEL_PACK_BUFFER,m),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,g),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteFramebuffer(h),g}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let i=0;return e===n.UNSIGNED_BYTE&&(i=1),e!==n.UNSIGNED_SHORT_4_4_4_4&&e!==n.UNSIGNED_SHORT_5_5_5_1&&e!==n.UNSIGNED_SHORT_5_6_5&&e!==n.UNSIGNED_SHORT&&e!==n.HALF_FLOAT||(i=2),e!==n.UNSIGNED_INT&&e!==n.FLOAT||(i=4),t===n.RGBA?4*i:t===n.RGB?3*i:t===n.ALPHA?i:void 0}}class upe{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return void 0===t&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class hpe{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const dpe={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class ppe{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:i,object:r,type:o,info:s,index:a}=this;0!==a?n.drawElements(i,t,o,e):n.drawArrays(i,e,t),s.update(r,t,1)}renderInstances(e,t,n){const{gl:i,mode:r,type:o,index:s,object:a,info:l}=this;0!==n&&(0!==s?i.drawElementsInstanced(r,t,o,e,n):i.drawArraysInstanced(r,e,t,n),l.update(a,t,n))}renderMultiDraw(e,t,n){const{extensions:i,mode:r,object:o,info:s}=this;if(0===n)return;const a=i.get("WEBGL_multi_draw");if(null===a)for(let l=0;l<n;l++)this.render(e[l],t[l]);else{0!==this.index?a.multiDrawElementsWEBGL(r,t,0,this.type,e,0,n):a.multiDrawArraysWEBGL(r,e,0,t,0,n);let i=0;for(let e=0;e<n;e++)i+=t[e];s.update(o,i,1)}}renderMultiDrawInstances(e,t,n,i){const{extensions:r,mode:o,object:s,info:a}=this;if(0===n)return;const l=r.get("WEBGL_multi_draw");if(null===l)for(let c=0;c<n;c++)this.renderInstances(e[c],t[c],i[c]);else{0!==this.index?l.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,i,0,n):l.multiDrawArraysInstancedWEBGL(o,e,0,t,0,i,0,n);let r=0;for(let e=0;e<n;e++)r+=t[e]*i[e];a.update(s,r,1)}}}class fpe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class mpe extends fpe{constructor(e,t){if(super(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext)return console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),void(this.trackTimestamp=!1);this.queries=[];for(let n=0;n<this.maxQueries;n++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return(0,x0.mcG)(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null==t)return;if(null!==this.activeQuery)return;const n=this.queries[t];if(n)try{"inactive"===this.queryStates.get(t)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){console.error("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null!=t&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[n,i]of this.queryStates)if("ended"===i){const t=this.queries[n];e.push(this.resolveQuery(t))}if(0===e.length)return this.lastValue;const t=(await Promise.all(e)).reduce(((e,t)=>e+t),0);return this.lastValue=t,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,t}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise((t=>{if(this.isDisposed)return void t(this.lastValue);let n,i=!1;const r=e=>{i||(i=!0,n&&(clearTimeout(n),n=null),t(e))},o=()=>{if(this.isDisposed)r(this.lastValue);else try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void r(this.lastValue);if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE))return void(n=setTimeout(o,1));const i=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(i)/1e6)}catch(i){console.error("Error checking query:",i),t(this.lastValue)}};o()}))}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class gpe extends Kde{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this.trackTimestamp=!0===e.trackTimestamp,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=void 0!==t.context?t.context:e.domElement.getContext("webgl2",n);function r(t){t.preventDefault();const n={api:"WebGL",message:t.statusMessage||"Unknown reason",reason:null,originalEvent:t};e.onDeviceLost(n)}this._onContextLost=r,e.domElement.addEventListener("webglcontextlost",r,!1),this.gl=i,this.extensions=new upe(this),this.capabilities=new hpe(this),this.attributeUtils=new npe(this),this.textureUtils=new cpe(this),this.bufferRenderer=new ppe(this),this.state=new ipe(this),this.utils=new rpe(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return x0.TdN}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),null!==n){const t=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:t}),e.autoAllocateDepthBuffer=!1,!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided")}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new mpe(this.gl,t,2048));const n=this.timestampQueryPool[t];null!==n.allocateQueriesForContext(e)&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t,gl:n}=this,i=this.get(e);if(e.viewport?this.updateViewport(e):t.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),e.scissor){const{x:n,y:i,width:r,height:o}=e.scissorValue;t.scissor(n,e.height-o-i,r,o)}this.initTimestampQuery(e),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const r=e.occlusionQueryCount;r>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(r),i.occlusionQueryObjects=new Array(r),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,i=this.get(e),r=i.previousContext;n.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const s=e.textures;if(null!==s)for(let a=0;a<s.length;a++){const e=s[a];e.generateMipmaps&&this.generateMipmaps(e)}if(this._currentContext=r,null!==e.textures&&e.renderTarget){const i=this.get(e.renderTarget),{samples:r}=e.renderTarget;if(r>0&&!1===this._useMultisampledRTT(e.renderTarget)){const r=i.framebuffers[e.getCacheKey()],o=t.COLOR_BUFFER_BIT,s=i.msaaFrameBuffer,a=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,s),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,r);for(let n=0;n<a.length;n++)if(e.scissor){const{x:n,y:r,width:s,height:a}=e.scissorValue,l=e.height-a-r;t.blitFramebuffer(n,l,n+s,l+a,n,l,n+s,l+a,o,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray,n,l,s,a)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,i.invalidationArray)}}null!==r&&(this._setFramebuffer(r),r.viewport?this.updateViewport(r):n.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const e=new WeakSet,{gl:r}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let s=0;for(let t=0;t<n.length;t++){const o=n[t];null!==o&&(r.getQueryParameter(o,r.QUERY_RESULT_AVAILABLE)&&(0===r.getQueryParameter(o,r.QUERY_RESULT)&&e.add(i[t]),n[t]=null,r.deleteQuery(o),s++))}s<n.length?requestAnimationFrame(o):t.occluded=e};o()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:i,width:r,height:o}=e.viewportValue;t.viewport(n,e.height-o-i,r,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const{gl:o,renderer:s}=this;if(null===i){i={textures:null,clearColorValue:this.getClearColor()}}let a=0;if(e&&(a|=o.COLOR_BUFFER_BIT),t&&(a|=o.DEPTH_BUFFER_BIT),n&&(a|=o.STENCIL_BUFFER_BIT),0!==a){let l;l=i.clearColorValue?i.clearColorValue:this.getClearColor();const c=s.getClearDepth(),u=s.getClearStencil();if(t&&this.state.setDepthMask(!0),null===i.textures)o.clearColor(l.r,l.g,l.b,l.a),o.clear(a);else{if(r&&this._setFramebuffer(i),e)for(let e=0;e<i.textures.length;e++)0===e?o.clearBufferfv(o.COLOR,e,[l.r,l.g,l.b,l.a]):o.clearBufferfv(o.COLOR,e,[0,0,0,1]);t&&n?o.clearBufferfi(o.DEPTH_STENCIL,0,c,u):t?o.clearBufferfv(o.DEPTH,0,[c]):n&&o.clearBufferiv(o.STENCIL,0,[u])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,i){const{state:r,gl:o}=this;!1===this.discard&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:s,transformBuffers:a,attributes:l}=this.get(i),c=this._getVaoKey(l),u=this.vaoCache[c];void 0===u?this._createVao(l):r.setVertexState(u),r.useProgram(s),this._bindUniforms(n);const h=this._getTransformFeedback(a);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,h),o.beginTransformFeedback(o.POINTS),l[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let d=0;d<a.length;d++){const e=a[d];e.pbo&&this.textureUtils.copyBufferToTexture(e.transformBuffer,e.pbo),e.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:n,material:i,context:r,hardwareClippingPlanes:o}=e,{programGPU:s}=this.get(n),{gl:a,state:l}=this,c=this.get(r),u=e.getDrawParameters();if(null===u)return;this._bindUniforms(e.getBindings());const h=t.isMesh&&t.matrixWorld.determinant()<0;l.setMaterial(i,h,o),l.useProgram(s);const d=this.get(e);let p=d.staticVao;if(void 0===p||d.geometryId!==e.geometry.id){const t=this._getVaoKey(e.getAttributes());if(p=this.vaoCache[t],void 0===p){let t;({vaoGPU:p,staticVao:t}=this._createVao(e.getAttributes())),t&&(d.staticVao=p,d.geometryId=e.geometry.id)}}const f=e.getIndex(),m=null!==f?this.get(f).bufferGPU:null;l.setVertexState(p,m);const g=c.lastOcclusionObject;if(g!==t&&void 0!==g){if(null!==g&&!0===g.occlusionTest&&(a.endQuery(a.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),!0===t.occlusionTest){const e=a.createQuery();a.beginQuery(a.ANY_SAMPLES_PASSED,e),c.occlusionQueries[c.occlusionQueryIndex]=e,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=a.POINTS:t.isLineSegments?v.mode=a.LINES:t.isLine?v.mode=a.LINE_STRIP:t.isLineLoop?v.mode=a.LINE_LOOP:!0===i.wireframe?(l.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=a.LINES):v.mode=a.TRIANGLES;const{vertexCount:y,instanceCount:A}=u;let{firstVertex:x}=u;if(v.object=t,null!==f){x*=f.array.BYTES_PER_ELEMENT;const e=this.get(f);v.index=f.count,v.type=e.type}else v.index=0;const b=()=>{t.isBatchedMesh?null!==t._multiDrawInstances?((0,x0.mcG)("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):(0,x0.mcG)("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):A>1?v.renderInstances(x,y,A):v.render(x,y)};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const n=this.get(e.camera),i=e.camera.cameras,r=e.getBindingGroup("cameraIndex").bindings[0];if(void 0===n.indexesGPU||n.indexesGPU.length!==i.length){const e=new Uint32Array([0,0,0,0]),t=[];for(let n=0,r=i.length;n<r;n++){const i=a.createBuffer();e[0]=n,a.bindBuffer(a.UNIFORM_BUFFER,i),a.bufferData(a.UNIFORM_BUFFER,e,a.STATIC_DRAW),t.push(i)}n.indexesGPU=t}const o=this.get(r),s=this.renderer.getPixelRatio();for(let c=0,u=i.length;c<u;c++){const r=i[c];if(t.layers.test(r.layers)){const t=r.viewport,i=t.x*s,u=t.y*s,h=t.width*s,d=t.height*s;l.viewport(Math.floor(i),Math.floor(e.context.height-d-u),Math.floor(h),Math.floor(d)),l.bindBufferBase(a.UNIFORM_BUFFER,o.index,n.indexesGPU[c]),b()}}}else b()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,i,r,o){return this.textureUtils.copyTextureToBuffer(e,t,n,i,r,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new Xde(e,t)}createProgram(e){const t=this.gl,{stage:n,code:i}=e,r="fragment"===n?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(r,i),t.compileShader(r),this.set(e,{shaderGPU:r})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,i=e.pipeline,{fragmentProgram:r,vertexProgram:o}=i,s=n.createProgram(),a=this.get(r).shaderGPU,l=this.get(o).shaderGPU;if(n.attachShader(s,a),n.attachShader(s,l),n.linkProgram(s),this.set(i,{programGPU:s,fragmentShader:a,vertexShader:l}),null!==t&&this.parallel){const r=new Promise((t=>{const r=this.parallel,o=()=>{n.getProgramParameter(s,r.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),t()):requestAnimationFrame(o)};o()}));t.push(r)}else this._completeCompile(e,i)}_handleSource(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let s=r;s<o;s++){const e=s+1;i.push(`${e===t?">":" "} ${e}: ${n[s]}`)}return i.join("\n")}_getShaderErrors(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const o=/ERROR: 0:(\d+)/.exec(r);if(o){const i=parseInt(o[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+this._handleSource(e.getShaderSource(t),i)}return r}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const i=this.gl,r=i.getProgramInfoLog(e).trim();if(!1===i.getProgramParameter(e,i.LINK_STATUS))if("function"===typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(i,e,n,t);else{const o=this._getShaderErrors(i,n,"vertex"),s=this._getShaderErrors(i,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+r+"\n"+o+"\n"+s)}else""!==r&&console.warn("THREE.WebGLProgram: Program Info Log:",r)}}_completeCompile(e,t){const{state:n,gl:i}=this,r=this.get(t),{programGPU:o,fragmentShader:s,vertexShader:a}=r;!1===i.getProgramParameter(o,i.LINK_STATUS)&&this._logProgramError(o,s,a),n.useProgram(o);const l=e.getBindings();this._setupBindings(l,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:n,gl:i}=this,r={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(r);const{computeProgram:o}=e,s=i.createProgram(),a=this.get(r).shaderGPU,l=this.get(o).shaderGPU,c=o.transforms,u=[],h=[];for(let m=0;m<c.length;m++){const e=c[m];u.push(e.varyingName),h.push(e.attributeNode)}i.attachShader(s,a),i.attachShader(s,l),i.transformFeedbackVaryings(s,u,i.SEPARATE_ATTRIBS),i.linkProgram(s),!1===i.getProgramParameter(s,i.LINK_STATUS)&&this._logProgramError(s,a,l),n.useProgram(s),this._setupBindings(t,s);const d=o.attributes,p=[],f=[];for(let m=0;m<d.length;m++){const e=d[m].node.attribute;p.push(e),this.has(e)||this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER)}for(let m=0;m<h.length;m++){const e=h[m].attribute;this.has(e)||this.attributeUtils.createAttribute(e,i.ARRAY_BUFFER);const t=this.get(e);f.push(t)}this.set(e,{programGPU:s,transformBuffers:f,attributes:p})}createBindings(e,t){if(!1===this._knownBindings.has(t)){this._knownBindings.add(t);let e=0,n=0;for(const i of t){this.set(i,{textures:n,uniformBuffers:e});for(const t of i.bindings)t.isUniformBuffer&&e++,t.isSampledTexture&&n++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let i=n.uniformBuffers,r=n.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const e=o.buffer,n=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),this.set(o,{index:i++,bufferGPU:n})}else if(o.isSampledTexture){const{textureGPU:e,glTextureType:t}=this.get(o.texture);this.set(o,{index:r++,textureGPU:e,glTextureType:t})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,i=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,i,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(dpe).filter((t=>dpe[t]===e)),n=this.extensions;for(let i=0;i<t.length;i++)if(n.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.textureUtils.copyTextureToTexture(e,t,n,i,r)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let i=null;if(null!==e.textures){const r=e.renderTarget,o=this.get(r),{samples:s,depthBuffer:a,stencilBuffer:l}=r,c=!0===r.isWebGLCubeRenderTarget,u=!0===r.isRenderTarget3D,h=!0===r.isRenderTargetArray,d=!0===r.isXRRenderTarget,p=!0===d&&!0===r.hasExternalTextures;let f=o.msaaFrameBuffer,m=o.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),v=this._useMultisampledRTT(r),y=vce(e);let A;if(c?(o.cubeFramebuffers||(o.cubeFramebuffers={}),A=o.cubeFramebuffers[y]):d&&!1===p?A=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),A=o.framebuffers[y]),void 0===A){A=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,A);const i=e.textures;if(c){o.cubeFramebuffers[y]=A;const{textureGPU:e}=this.get(i[0]),n=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,e,0)}else{o.framebuffers[y]=A;for(let n=0;n<i.length;n++){const r=i[n],o=this.get(r);o.renderTarget=e.renderTarget,o.cacheKey=y;const a=t.COLOR_ATTACHMENT0+n;if(u||h){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,a,o.textureGPU,0,e)}else v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,t.TEXTURE_2D,o.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,a,t.TEXTURE_2D,o.textureGPU,0)}n.drawBuffers(e,A)}if(r.isXRRenderTarget&&!0===r.autoAllocateDepthBuffer){const n=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(n,e,0,v),o.xrDepthRenderbuffer=n}else if(null!==e.depthTexture){const n=this.get(e.depthTexture),i=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;n.renderTarget=e.renderTarget,n.cacheKey=y,v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,i,t.TEXTURE_2D,n.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,i,t.TEXTURE_2D,n.textureGPU,0)}}else if(d&&p){n.bindFramebuffer(t.FRAMEBUFFER,A);const i=this.get(e.textures[0]);v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i.textureGPU,0);const a=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===r.autoAllocateDepthBuffer){const e=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,a,t.RENDERBUFFER,e)}else{const n=this.get(e.depthTexture);v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,t.TEXTURE_2D,n.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,a,t.TEXTURE_2D,n.textureGPU,0)}}if(s>0&&!1===v){if(void 0===f){const i=[];f=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,f);const r=[],c=e.textures;for(let n=0;n<c.length;n++){if(r[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,r[n]),i.push(t.COLOR_ATTACHMENT0+n),a){const e=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;i.push(e)}const o=e.textures[n],c=this.get(o);t.renderbufferStorageMultisample(t.RENDERBUFFER,s,c.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,r[n])}if(o.msaaFrameBuffer=f,o.msaaRenderbuffers=r,void 0===m){m=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e,s),o.depthRenderbuffer=m;const n=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;i.push(n)}o.invalidationArray=i}i=o.msaaFrameBuffer}else i=A}n.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){t+=":"+this.get(e[n]).id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let i="",r=!0;t.bindVertexArray(n);for(let o=0;o<e.length;o++){const n=e[o],s=this.get(n);let a,l;i+=":"+s.id,t.bindBuffer(t.ARRAY_BUFFER,s.bufferGPU),t.enableVertexAttribArray(o),(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&(r=!1),!0===n.isInterleavedBufferAttribute?(a=n.data.stride*s.bytesPerElement,l=n.offset*s.bytesPerElement):(a=0,l=0),s.isInteger?t.vertexAttribIPointer(o,n.itemSize,s.type,a,l):t.vertexAttribPointer(o,n.itemSize,s.type,n.normalized,a,l),n.isInstancedBufferAttribute&&!n.isInterleavedBufferAttribute?t.vertexAttribDivisor(o,n.meshPerAttribute):n.isInterleavedBufferAttribute&&n.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(o,n.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[i]=n,{vaoGPU:n,staticVao:r}}_getTransformFeedback(e){let t="";for(let r=0;r<e.length;r++)t+=":"+e[r].id;let n=this.transformFeedbackCache[t];if(void 0!==n)return n;const{gl:i}=this;n=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let r=0;r<e.length;r++){const t=e[r];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,r,t.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const i of e)for(const e of i.bindings){const i=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){const r=n.getUniformBlockIndex(t,e.name);n.uniformBlockBinding(t,r,i)}else if(e.isSampledTexture){const r=n.getUniformLocation(t,e.name);n.uniform1i(r,i)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const i of e)for(const e of i.bindings){const i=this.get(e),r=i.index;e.isUniformsGroup||e.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,r,i.bufferGPU):e.isSampledTexture&&n.bindTexture(i.glTextureType,i.textureGPU,t.TEXTURE0+r)}}_useMultisampledRTT(e){return e.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==e.autoAllocateDepthBuffer}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const vpe="point-list",ype="line-list",Ape="line-strip",xpe="triangle-list",bpe="triangle-strip",_pe="never",wpe="less",Epe="equal",Spe="less-equal",Cpe="greater",Mpe="not-equal",Tpe="greater-equal",Rpe="always",Ipe="store",Ppe="load",Bpe="clear",Lpe="ccw",Npe="none",Dpe="front",kpe="back",Ope="uint16",Upe="uint32",Fpe={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},zpe="clamp-to-edge",jpe="repeat",Vpe="mirror-repeat",Gpe="linear",Hpe="nearest",Wpe="zero",Qpe="one",qpe="src",Xpe="one-minus-src",$pe="src-alpha",Ype="one-minus-src-alpha",Kpe="dst",Jpe="one-minus-dst",Zpe="dst-alpha",efe="one-minus-dst-alpha",tfe="src-alpha-saturated",nfe="constant",ife="one-minus-constant",rfe="add",ofe="subtract",sfe="reverse-subtract",afe="min",lfe="max",cfe=0,ufe=15,hfe="keep",dfe="zero",pfe="replace",ffe="invert",mfe="increment-clamp",gfe="decrement-clamp",vfe="increment-wrap",yfe="decrement-wrap",Afe="storage",xfe="read-only-storage",bfe="write-only",_fe="read-only",wfe="read-write",Efe="float",Sfe="unfilterable-float",Cfe="depth",Mfe="sint",Tfe="uint",Rfe="2d",Ife="3d",Pfe="2d",Bfe="2d-array",Lfe="cube",Nfe="3d",Dfe="all",kfe="vertex",Ofe="instance",Ufe={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class Ffe extends Pde{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class zfe extends Ffe{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class jfe extends Bde{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Vfe=0;class Gfe extends jfe{constructor(e,t){super("StorageBuffer_"+Vfe++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:o9.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Hfe extends Wle{constructor(e){super(),this.device=e;this.mipmapSampler=e.createSampler({minFilter:Gpe}),this.flipYSampler=e.createSampler({minFilter:Hpe}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(e){let t=this.transferPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:bpe,stripIndexFormat:Upe},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:bpe,stripIndexFormat:Upe},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=t.format,{width:r,height:o}=t.size,s=this.getTransferPipeline(i),a=this.getFlipYPipeline(i),l=this.device.createTexture({size:{width:r,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Pfe,baseArrayLayer:n}),u=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:Pfe,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),d=(e,t,n)=>{const i=e.getBindGroupLayout(0),r=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:t}]}),o=h.beginRenderPass({colorAttachments:[{view:n,loadOp:Bpe,storeOp:Ipe,clearValue:[0,0,0,0]}]});o.setPipeline(e),o.setBindGroup(0,r),o.draw(4,1,0,0),o.end()};d(s,c,u),d(a,u,c),this.device.queue.submit([h.finish()]),l.destroy()}generateMipmaps(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.get(e);void 0===i.useCount&&(i.useCount=0,i.layers=[]);const r=i.layers[n]||this._mipmapCreateBundles(e,t,n),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,r),this.device.queue.submit([o.finish()]),0!==i.useCount&&(i.layers[n]=r),i.useCount++}_mipmapCreateBundles(e,t,n){const i=this.getTransferPipeline(t.format),r=i.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Pfe,baseArrayLayer:n});const s=[];for(let a=1;a<t.mipLevelCount;a++){const l=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),c=e.createView({baseMipLevel:a,mipLevelCount:1,dimension:Pfe,baseArrayLayer:n}),u={colorAttachments:[{view:c,loadOp:Bpe,storeOp:Ipe,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[t.format]});h.setPipeline(i),h.setBindGroup(0,l),h.draw(4,1,0,0),s.push({renderBundles:[h.finish()],passDescriptor:u}),o=c}return s}_mipmapRunBundles(e,t){const n=t.length;for(let i=0;i<n;i++){const n=t[i],r=e.beginRenderPass(n.passDescriptor);r.executeBundles(n.renderBundles),r.end()}}}const Wfe={[x0.amv]:"never",[x0.vim]:"less",[x0.kO0]:"equal",[x0.TiK]:"less-equal",[x0.eoi]:"greater",[x0.gWB]:"greater-equal",[x0.FFZ]:"always",[x0.jzd]:"not-equal"},Qfe=[0,1,3,2,4,5];class qfe{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new x0.VCu,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,i=t.get(e),r={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};r.magFilter===Gpe&&r.minFilter===Gpe&&r.mipmapFilter===Gpe&&(r.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(r.compare=Wfe[e.compareFunction]),i.sampler=n.createSampler(r)}createDefaultTexture(e){let t;const n=Xfe(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.backend,i=n.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===t.needsMipmaps&&(t.needsMipmaps=!1),void 0===t.levels&&(t.levels=1),void 0===t.depth&&(t.depth=1);const{width:r,height:o,depth:s,levels:a}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(e),c=e.internalFormat||t.format||Xfe(e,n.device);i.format=c;const{samples:u,primarySamples:h,isMSAA:d}=n.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(p|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const f={label:e.name,size:{width:r,height:o,depthOrArrayLayers:s},mipLevelCount:a,sampleCount:h,dimension:l,format:c,usage:p};if(e.isVideoTexture){const t=e.source.data,n=new VideoFrame(t);f.size.width=n.displayWidth,f.size.height=n.displayHeight,n.close(),i.externalTexture=t}else{if(void 0===c)return console.warn("WebGPURenderer: Texture format not supported."),void this.createDefaultTexture(e);i.texture=n.device.createTexture(f)}if(d){const e=Object.assign({},f);e.label=e.label+"-msaa",e.sampleCount=u,i.msaaTexture=n.device.createTexture(e)}i.initialized=!0,i.textureDescriptorGPU=f}destroyTexture(e){const t=this.backend,n=t.get(e);void 0!==n.texture&&n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){delete this.backend.get(e).sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let e=0;e<n;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.backend,{width:i,height:r}=n.getDrawingBufferSize(),o=this.depthTexture,s=n.get(o).texture;let a,l;if(t?(a=x0.dcC,l=x0.V3x):e&&(a=x0.zdS,l=x0.bkx),void 0!==s){if(o.image.width===i&&o.image.height===r&&o.format===a&&o.type===l)return s;this.destroyTexture(o)}return o.name="depthBuffer",o.format=a,o.type=l,o.image.width=i,o.image.height=r,this.createTexture(o,{width:i,height:r}),n.get(o).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:i}=n;if(!e.isRenderTargetTexture&&void 0!==i){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,i,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let r=0;r<t.image.depth;r++)this._copyBufferToTexture(t.image,n.texture,i,r,e.flipY,r);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,i,e.flipY);else if(e.isVideoTexture){const t=e.source.data;n.externalTexture=t}else this._copyImageToTexture(t.image,n.texture,i,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,i,r,o){const s=this.backend.device,a=this.backend.get(e),l=a.texture,c=a.textureDescriptorGPU.format,u=this._getBytesPerTexel(c);let h=i*u;h=256*Math.ceil(h/256);const d=s.createBuffer({size:i*r*u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=s.createCommandEncoder();p.copyTextureToBuffer({texture:l,origin:{x:t,y:n,z:o}},{buffer:d,bytesPerRow:h},{width:i,height:r});const f=this._getTypedArrayType(c);s.queue.submit([p.finish()]),await d.mapAsync(GPUMapMode.READ);return new f(d.getMappedRange())}_isEnvironmentTexture(e){const t=e.mapping;return t===x0.wfO||t===x0.uV5||t===x0.hy7||t===x0.xFO}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new x0.gPd;n.minFilter=x0.hxR,n.magFilter=x0.hxR,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new x0.b4q;n.minFilter=x0.hxR,n.magFilter=x0.hxR,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(null===e){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,i){for(let r=0;r<6;r++){const o=e[r],s=!0===i?Qfe[r]:r;o.isDataTexture?this._copyBufferToTexture(o.image,t,n,s,i):this._copyImageToTexture(o,t,n,s,i)}}_copyImageToTexture(e,t,n,i,r){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:r},{texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new Hfe(this.backend.device)),e}_generateMipmaps(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=this.backend.device,a=e.data,l=this._getBytesPerTexel(n.format),c=e.width*l;s.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},a,{offset:e.width*e.height*l*o,bytesPerRow:c},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===r&&this._flipY(t,n,i)}_copyCompressedBufferToTexture(e,t,n){const i=this.backend.device,r=this._getBlockData(n.format),o=n.size.depthOrArrayLayers>1;for(let s=0;s<e.length;s++){const a=e[s],l=a.width,c=a.height,u=o?n.size.depthOrArrayLayers:1,h=Math.ceil(l/r.width)*r.byteLength,d=h*Math.ceil(c/r.height);for(let e=0;e<u;e++)i.queue.writeTexture({texture:t,mipLevel:s,origin:{x:0,y:0,z:e}},a.data,{offset:e*d,bytesPerRow:h,rowsPerImage:Math.ceil(c/r.height)},{width:Math.ceil(l/r.width)*r.width,height:Math.ceil(c/r.height)*r.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===Fpe.BC1RGBAUnorm||e===Fpe.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:e===Fpe.BC2RGBAUnorm||e===Fpe.BC2RGBAUnormSRGB||e===Fpe.BC3RGBAUnorm||e===Fpe.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===Fpe.BC4RUnorm||e===Fpe.BC4RSNorm?{byteLength:8,width:4,height:4}:e===Fpe.BC5RGUnorm||e===Fpe.BC5RGSnorm||e===Fpe.BC6HRGBUFloat||e===Fpe.BC6HRGBFloat||e===Fpe.BC7RGBAUnorm||e===Fpe.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===Fpe.ETC2RGB8Unorm||e===Fpe.ETC2RGB8UnormSRGB||e===Fpe.ETC2RGB8A1Unorm||e===Fpe.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:e===Fpe.ETC2RGBA8Unorm||e===Fpe.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:e===Fpe.EACR11Unorm||e===Fpe.EACR11Snorm?{byteLength:8,width:4,height:4}:e===Fpe.EACRG11Unorm||e===Fpe.EACRG11Snorm||e===Fpe.ASTC4x4Unorm||e===Fpe.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:e===Fpe.ASTC5x4Unorm||e===Fpe.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:e===Fpe.ASTC5x5Unorm||e===Fpe.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:e===Fpe.ASTC6x5Unorm||e===Fpe.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:e===Fpe.ASTC6x6Unorm||e===Fpe.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:e===Fpe.ASTC8x5Unorm||e===Fpe.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:e===Fpe.ASTC8x6Unorm||e===Fpe.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:e===Fpe.ASTC8x8Unorm||e===Fpe.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:e===Fpe.ASTC10x5Unorm||e===Fpe.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:e===Fpe.ASTC10x6Unorm||e===Fpe.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:e===Fpe.ASTC10x8Unorm||e===Fpe.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:e===Fpe.ASTC10x10Unorm||e===Fpe.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:e===Fpe.ASTC12x10Unorm||e===Fpe.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:e===Fpe.ASTC12x12Unorm||e===Fpe.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let t=zpe;return e===x0.GJx?t=jpe:e===x0.kTW&&(t=Vpe),t}_convertFilterMode(e){let t=Gpe;return e!==x0.hxR&&e!==x0.pHI&&e!==x0.Cfg||(t=Hpe),t}_getBytesPerTexel(e){return e===Fpe.R8Unorm||e===Fpe.R8Snorm||e===Fpe.R8Uint||e===Fpe.R8Sint?1:e===Fpe.R16Uint||e===Fpe.R16Sint||e===Fpe.R16Float||e===Fpe.RG8Unorm||e===Fpe.RG8Snorm||e===Fpe.RG8Uint||e===Fpe.RG8Sint?2:e===Fpe.R32Uint||e===Fpe.R32Sint||e===Fpe.R32Float||e===Fpe.RG16Uint||e===Fpe.RG16Sint||e===Fpe.RG16Float||e===Fpe.RGBA8Unorm||e===Fpe.RGBA8UnormSRGB||e===Fpe.RGBA8Snorm||e===Fpe.RGBA8Uint||e===Fpe.RGBA8Sint||e===Fpe.BGRA8Unorm||e===Fpe.BGRA8UnormSRGB||e===Fpe.RGB9E5UFloat||e===Fpe.RGB10A2Unorm||e===Fpe.RG11B10UFloat||e===Fpe.Depth32Float||e===Fpe.Depth24Plus||e===Fpe.Depth24PlusStencil8||e===Fpe.Depth32FloatStencil8?4:e===Fpe.RG32Uint||e===Fpe.RG32Sint||e===Fpe.RG32Float||e===Fpe.RGBA16Uint||e===Fpe.RGBA16Sint||e===Fpe.RGBA16Float?8:e===Fpe.RGBA32Uint||e===Fpe.RGBA32Sint||e===Fpe.RGBA32Float?16:void 0}_getTypedArrayType(e){return e===Fpe.R8Uint?Uint8Array:e===Fpe.R8Sint?Int8Array:e===Fpe.R8Unorm?Uint8Array:e===Fpe.R8Snorm?Int8Array:e===Fpe.RG8Uint?Uint8Array:e===Fpe.RG8Sint?Int8Array:e===Fpe.RG8Unorm?Uint8Array:e===Fpe.RG8Snorm?Int8Array:e===Fpe.RGBA8Uint?Uint8Array:e===Fpe.RGBA8Sint?Int8Array:e===Fpe.RGBA8Unorm?Uint8Array:e===Fpe.RGBA8Snorm?Int8Array:e===Fpe.R16Uint?Uint16Array:e===Fpe.R16Sint?Int16Array:e===Fpe.RG16Uint?Uint16Array:e===Fpe.RG16Sint?Int16Array:e===Fpe.RGBA16Uint?Uint16Array:e===Fpe.RGBA16Sint?Int16Array:e===Fpe.R16Float||e===Fpe.RG16Float||e===Fpe.RGBA16Float?Uint16Array:e===Fpe.R32Uint?Uint32Array:e===Fpe.R32Sint?Int32Array:e===Fpe.R32Float?Float32Array:e===Fpe.RG32Uint?Uint32Array:e===Fpe.RG32Sint?Int32Array:e===Fpe.RG32Float?Float32Array:e===Fpe.RGBA32Uint?Uint32Array:e===Fpe.RGBA32Sint?Int32Array:e===Fpe.RGBA32Float?Float32Array:e===Fpe.BGRA8Unorm||e===Fpe.BGRA8UnormSRGB?Uint8Array:e===Fpe.RGB10A2Unorm||e===Fpe.RGB9E5UFloat||e===Fpe.RG11B10UFloat?Uint32Array:e===Fpe.Depth32Float?Float32Array:e===Fpe.Depth24Plus||e===Fpe.Depth24PlusStencil8?Uint32Array:e===Fpe.Depth32FloatStencil8?Float32Array:void 0}_getDimension(e){let t;return t=e.isData3DTexture?Ife:Rfe,t}}function Xfe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=e.format,i=e.type,r=e.colorSpace;let o;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(n){case x0.Nz6:o=r===x0.er$?Fpe.BC1RGBAUnormSRGB:Fpe.BC1RGBAUnorm;break;case x0.jR7:o=r===x0.er$?Fpe.BC2RGBAUnormSRGB:Fpe.BC2RGBAUnorm;break;case x0.BXX:o=r===x0.er$?Fpe.BC3RGBAUnormSRGB:Fpe.BC3RGBAUnorm;break;case x0.Riy:o=r===x0.er$?Fpe.ETC2RGB8UnormSRGB:Fpe.ETC2RGB8Unorm;break;case x0.KDk:o=r===x0.er$?Fpe.ETC2RGBA8UnormSRGB:Fpe.ETC2RGBA8Unorm;break;case x0.qa3:o=r===x0.er$?Fpe.ASTC4x4UnormSRGB:Fpe.ASTC4x4Unorm;break;case x0.B_h:o=r===x0.er$?Fpe.ASTC5x4UnormSRGB:Fpe.ASTC5x4Unorm;break;case x0.czI:o=r===x0.er$?Fpe.ASTC5x5UnormSRGB:Fpe.ASTC5x5Unorm;break;case x0.rSH:o=r===x0.er$?Fpe.ASTC6x5UnormSRGB:Fpe.ASTC6x5Unorm;break;case x0.Qrf:o=r===x0.er$?Fpe.ASTC6x6UnormSRGB:Fpe.ASTC6x6Unorm;break;case x0.psI:o=r===x0.er$?Fpe.ASTC8x5UnormSRGB:Fpe.ASTC8x5Unorm;break;case x0.a5J:o=r===x0.er$?Fpe.ASTC8x6UnormSRGB:Fpe.ASTC8x6Unorm;break;case x0._QJ:o=r===x0.er$?Fpe.ASTC8x8UnormSRGB:Fpe.ASTC8x8Unorm;break;case x0.uB5:o=r===x0.er$?Fpe.ASTC10x5UnormSRGB:Fpe.ASTC10x5Unorm;break;case x0.lyL:o=r===x0.er$?Fpe.ASTC10x6UnormSRGB:Fpe.ASTC10x6Unorm;break;case x0.bC7:o=r===x0.er$?Fpe.ASTC10x8UnormSRGB:Fpe.ASTC10x8Unorm;break;case x0.y3Z:o=r===x0.er$?Fpe.ASTC10x10UnormSRGB:Fpe.ASTC10x10Unorm;break;case x0.ojs:o=r===x0.er$?Fpe.ASTC12x10UnormSRGB:Fpe.ASTC12x10Unorm;break;case x0.S$4:o=r===x0.er$?Fpe.ASTC12x12UnormSRGB:Fpe.ASTC12x12Unorm;break;case x0.GWd:o=r===x0.er$?Fpe.RGBA8UnormSRGB:Fpe.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}else switch(n){case x0.GWd:switch(i){case x0.tJf:o=Fpe.RGBA8Snorm;break;case x0.fBL:o=Fpe.RGBA16Sint;break;case x0.cHt:o=Fpe.RGBA16Uint;break;case x0.bkx:o=Fpe.RGBA32Uint;break;case x0.Yuy:o=Fpe.RGBA32Sint;break;case x0.OUM:o=r===x0.er$?Fpe.RGBA8UnormSRGB:Fpe.RGBA8Unorm;break;case x0.ix0:o=Fpe.RGBA16Float;break;case x0.RQf:o=Fpe.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",i)}break;case x0.HIg:if(i===x0.Dmk)o=Fpe.RGB9E5UFloat;else console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",i);break;case x0.VT0:switch(i){case x0.tJf:o=Fpe.R8Snorm;break;case x0.fBL:o=Fpe.R16Sint;break;case x0.cHt:o=Fpe.R16Uint;break;case x0.bkx:o=Fpe.R32Uint;break;case x0.Yuy:o=Fpe.R32Sint;break;case x0.OUM:o=Fpe.R8Unorm;break;case x0.ix0:o=Fpe.R16Float;break;case x0.RQf:o=Fpe.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",i)}break;case x0.paN:switch(i){case x0.tJf:o=Fpe.RG8Snorm;break;case x0.fBL:o=Fpe.RG16Sint;break;case x0.cHt:o=Fpe.RG16Uint;break;case x0.bkx:o=Fpe.RG32Uint;break;case x0.Yuy:o=Fpe.RG32Sint;break;case x0.OUM:o=Fpe.RG8Unorm;break;case x0.ix0:o=Fpe.RG16Float;break;case x0.RQf:o=Fpe.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",i)}break;case x0.zdS:switch(i){case x0.cHt:o=Fpe.Depth16Unorm;break;case x0.bkx:o=Fpe.Depth24Plus;break;case x0.RQf:o=Fpe.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",i)}break;case x0.dcC:switch(i){case x0.V3x:o=Fpe.Depth24PlusStencil8;break;case x0.RQf:t&&!1===t.features.has(Ufe.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=Fpe.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",i)}break;case x0.ZQM:switch(i){case x0.Yuy:o=Fpe.R32Sint;break;case x0.bkx:o=Fpe.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",i)}break;case x0.TkQ:switch(i){case x0.Yuy:o=Fpe.RG32Sint;break;case x0.bkx:o=Fpe.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",i)}break;case x0.c90:switch(i){case x0.Yuy:o=Fpe.RGBA32Sint;break;case x0.bkx:o=Fpe.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",i)}break;default:console.error("WebGPURenderer: Unsupported texture format.",n)}return o}const $fe=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Yfe=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,Kfe={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class Jfe extends Yhe{constructor(e){const{type:t,inputs:n,name:i,inputsCode:r,blockCode:o,outputType:s}=(e=>{const t=(e=e.trim()).match($fe);if(null!==t&&4===t.length){const n=t[2],i=[];let r=null;for(;null!==(r=Yfe.exec(n));)i.push({name:r[1],type:r[2]});const o=[];for(let e=0;e<i.length;e++){const{name:t,type:n}=i[e];let r=n;r.startsWith("ptr")?r="pointer":(r.startsWith("texture")&&(r=n.split("<")[0]),r=Kfe[r]),o.push(new Uhe(r,t))}const s=e.substring(t[0].length),a=t[3]||"void",l=void 0!==t[1]?t[1]:"";return{type:Kfe[a]||a,inputs:o,name:l,inputsCode:n,blockCode:s,outputType:a}}throw new Error("FunctionNode: Function is not a WGSL code.")})(e);super(t,n,i),this.inputsCode=r,this.blockCode=o,this.outputType=s}getCode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.name;const t="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Zfe extends $he{parseFunction(e){return new Jfe(e)}}const eme="undefined"!==typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},tme={[o9.READ_ONLY]:"read",[o9.WRITE_ONLY]:"write",[o9.READ_WRITE]:"read_write"},nme={[x0.GJx]:"repeat",[x0.ghU]:"clamp",[x0.kTW]:"mirror"},ime={vertex:eme?eme.VERTEX:1,fragment:eme?eme.FRAGMENT:2,compute:eme?eme.COMPUTE:4},rme={instance:!0,swizzleAssign:!1,storageBuffer:!0},ome={"^^":"tsl_xor"},sme={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},ame={},lme={tsl_xor:new Zce("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Zce("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Zce("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Zce("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Zce("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Zce("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Zce("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Zce("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Zce("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Zce("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Zce("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Zce("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Zce("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {\n\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},cme={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!==typeof navigator&&/Windows/g.test(navigator.userAgent)&&(lme.pow_float=new Zce("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),lme.pow_vec2=new Zce("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[lme.pow_float]),lme.pow_vec3=new Zce("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[lme.pow_float]),lme.pow_vec4=new Zce("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[lme.pow_float]),cme.pow_float="tsl_pow_float",cme.pow_vec2="tsl_pow_vec2",cme.pow_vec3="tsl_pow_vec3",cme.pow_vec4="tsl_pow_vec4");let ume="";!0!==("undefined"!==typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(ume+="diagnostic( off, derivative_uniformity );\n");class hme extends khe{constructor(e,t){super(e,t,new Zfe),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==x0.jf0}_generateTextureSample(e,t,n,i){return"fragment"===(arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.shaderStage)?i?`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n):this.generateTextureLod(e,t,n,i,"0")}_generateVideoSample(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.shaderStage;if("fragment"===n)return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;return"fragment"!==o&&"compute"!==o||!1!==this.isUnfilterable(e)?this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,i):this.generateTextureLod(e,t,n,r,i):`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i} )`}generateWrapFunction(e){const t=`tsl_coord_${nme[e.wrapS]}S_${nme[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=ame[t];if(void 0===n){const i=[],r=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${r} ) -> ${r} {\n\n\treturn ${r}(\n`;const s=(e,t)=>{e===x0.GJx?(i.push(lme.repeatWrapping_float),o+=`\t\ttsl_repeatWrapping_float( coord.${t} )`):e===x0.ghU?(i.push(lme.clampWrapping_float),o+=`\t\ttsl_clampWrapping_float( coord.${t} )`):e===x0.kTW?(i.push(lme.mirrorWrapping_float),o+=`\t\ttsl_mirrorWrapping_float( coord.${t} )`):(o+=`\t\tcoord.${t}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${e}" for vertex shader.`))};s(e.wrapS,"x"),o+=",\n",s(e.wrapT,"y"),e.isData3DTexture&&(o+=",\n",s(e.wrapR,"z")),o+="\n\t);\n\n}\n",ame[t]=n=new Zce(o,i)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);void 0===i.dimensionsSnippet&&(i.dimensionsSnippet={});let r=i.dimensionsSnippet[n];if(void 0===i.dimensionsSnippet[n]){let o,s;const{primarySamples:a}=this.renderer.backend.utils.getTextureSampleData(e),l=a>1;s=e.isData3DTexture?"vec3<u32>":"vec2<u32>",o=l||e.isVideoTexture||e.isStorageTexture?t:`${t}${n?`, u32( ${n} )`:""}`,r=new rne(new Vne(`textureDimensions( ${o} )`,s)),i.dimensionsSnippet[n]=r,(e.isDataArrayTexture||e.isData3DTexture)&&(i.arrayLayerCount=new rne(new Vne(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new rne(new Vne("6u","u32")))}return r.build(this)}generateFilteredTexture(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"0u";this._include("biquadraticTexture");return`tsl_biquadraticTexture( ${t}, ${this.generateWrapFunction(e)}( ${n} ), ${this.generateTextureDimension(e,t,i)}, u32( ${i} ) )`}generateTextureLod(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0u";const o=this.generateWrapFunction(e),s=this.generateTextureDimension(e,t,r),a=e.isData3DTexture?"vec3":"vec2",l=`${a}<u32>(${o}(${n}) * ${a}<f32>(${s}))`;return this.generateTextureLoad(e,t,l,i,r)}generateTextureLoad(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"0u";return!0===e.isVideoTexture||!0===e.isStorageTexture?`textureLoad( ${t}, ${n} )`:i?`textureLoad( ${t}, ${n}, ${i}, u32( ${r} ) )`:`textureLoad( ${t}, ${n}, u32( ${r} ) )`}generateTextureStore(e,t,n,i){return`textureStore( ${t}, ${n}, ${i} )`}isSampleCompare(e){return!0===e.isDepthTexture&&null!==e.compareFunction}isUnfilterable(e){return"float"!==this.getComponentTypeFromTexture(e)||!this.isAvailable("float32Filterable")&&!0===e.isDataTexture&&e.type===x0.RQf||!1===this.isSampleCompare(e)&&e.minFilter===x0.hxR&&e.magFilter===x0.hxR||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.shaderStage,o=null;return o=!0===e.isVideoTexture?this._generateVideoSample(t,n,r):this.isUnfilterable(e)?this.generateTextureLod(e,t,n,i,"0",r):this._generateTextureSample(e,t,n,i,r),o}generateTextureGrad(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===o)return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${i[0]}, ${i[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===o)return`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage,s=null;return s=!0===e.isVideoTexture?this._generateVideoSample(t,n,o):this._generateTextureSampleLevel(e,t,n,i,r,o),s}generateTextureBias(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.shaderStage;if("fragment"===o)return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;if(!0===e.isNodeVarying&&!0===e.needsInterpolation){if("vertex"===t)return`varyings.${e.name}`}else if(!0===e.isNodeUniform){const t=e.name,n=e.type;return"texture"===n||"cubeTexture"===n||"storageTexture"===n||"texture3D"===n?t:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?this.isCustomStruct(e)?t:t+".value":e.groupNode.name+"."+t}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=ome[e];return void 0!==t?(this._include(t),t):null}getNodeAccess(e,t){return"compute"!==t?o9.READ_ONLY:e.access}getStorageAccess(e,t){return tme[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=super.getUniformFromNode(e,t,n,i),o=this.getDataFromNode(e,n,this.globalCache);if(void 0===o.uniformGPU){let s;const a=e.groupNode,l=a.name,c=this.getBindGroupArray(l,n);if("texture"===t||"cubeTexture"===t||"storageTexture"===t||"texture3D"===t){let i=null;const o=this.getNodeAccess(e,n);if("texture"===t||"storageTexture"===t?i=new jde(r.name,r.node,a,o):"cubeTexture"===t?i=new Vde(r.name,r.node,a,o):"texture3D"===t&&(i=new Gde(r.name,r.node,a,o)),i.store=!0===e.isStorageTextureNode,i.setVisibility(ime[n]),"fragment"!==n&&"compute"!==n||!1!==this.isUnfilterable(e.value)||!1!==i.store)c.push(i),s=[i];else{const e=new zfe(`${r.name}_sampler`,r.node,a);e.setVisibility(ime[n]),c.push(e,i),s=[e,i]}}else if("buffer"===t||"storageBuffer"===t||"indirectStorageBuffer"===t){const o=new("buffer"===t?Dde:Gfe)(e,a);o.setVisibility(ime[n]),c.push(o),s=o,r.name=i||"NodeBuffer_"+r.id}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let i=e[l];void 0===i&&(i=new Ude(l,a),i.setVisibility(ime[n]),e[l]=i,c.push(i)),s=this.getNodeUniform(r,t),i.addUniform(s)}o.uniformGPU=s}return r}getBuiltin(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.shaderStage;const r=this.builtins[i]||(this.builtins[i]=new Map);return!1===r.has(e)&&r.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;return void 0!==this.builtins[t]&&this.builtins[t].has(e)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(o.name+" : "+this.getType(o.type));let r=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {\n${n.vars}\n${n.code}\n`;return n.result&&(r+=`\treturn ${n.result};\n`),r+="\n}\n",r}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.shaderStage;(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(void 0!==n)for(const i of n)t.push(`enable ${i};`);return t.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(void 0!==n)for(const{name:i,property:r,type:o}of n.values())t.push(`@builtin( ${i} ) ${r} : ${o}`);return t.join(",\n\t")}getScopedArray(e,t,n,i){return!1===this.scopedArrays.has(e)&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:i}),e}getScopedArrays(e){if("compute"!==e)return;const t=[];for(const{name:n,scope:i,bufferType:r,bufferCount:o}of this.scopedArrays.values()){const e=this.getType(r);t.push(`var<${i}> ${n}: array< ${e}, ${o} >;`)}return t.join("\n")}getAttributes(e){const t=[];if("compute"===e&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===e||"compute"===e){const e=this.getBuiltins("attribute");e&&t.push(e);const n=this.getAttributesArray();for(let i=0,r=n.length;i<r;i++){const e=n[i],r=e.name,o=this.getType(e.type);t.push(`@location( ${i} ) ${r} : ${o}`)}}return t.join(",\n\t")}getStructMembers(e){const t=[];for(const n of e.members){const i=e.output?"@location( "+n.index+" ) ":"";let r=this.getType(n.type);n.atomic&&(r="atomic< "+r+" >"),t.push(`\t${i+n.name} : ${r}`)}return e.output&&t.push(`\t${this.getBuiltins("output")}`),t.join(",\n")}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const e=[];for(const t of n){let n=`struct ${t.name} {\n`;n+=this.getStructMembers(t),n+="\n};",e.push(n)}t="\n"+e.join("\n\n")+"\n"}return t}getVar(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=`var ${t} : `;return i+=null!==n?this.generateArrayDeclaration(e,n):this.getType(e),i}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const i of n)t.push(`\t${this.getVar(i.type,i.name,i.count)};`);return`\n${t.join("\n")}\n`}getVaryings(e){const t=[];if("vertex"===e&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===e||"fragment"===e){const n=this.varyings,i=this.vars[e];for(let r=0;r<n.length;r++){const o=n[r];if(o.needsInterpolation){let e=`@location( ${r} )`;/^(int|uint|ivec|uvec)/.test(o.type)&&(e+=" @interpolate( flat )"),t.push(`${e} ${o.name} : ${this.getType(o.type)}`)}else"vertex"===e&&!1===i.includes(o)&&i.push(o)}}const n=this.getBuiltins(e);n&&t.push(n);const i=t.join(",\n\t");return"vertex"===e?this._getWGSLStruct("VaryingsStruct","\t"+i):i}isCustomStruct(e){return e.value.isStorageBufferAttribute&&null!==e.node.structTypeNode}getUniforms(e){const t=this.uniforms[e],n=[],i=[],r=[],o={};for(const a of t){const t=a.groupNode.name,r=this.bindingsIndexes[t];if("texture"===a.type||"cubeTexture"===a.type||"storageTexture"===a.type||"texture3D"===a.type){const t=a.node.value;let i;"fragment"!==e&&"compute"!==e||!1!==this.isUnfilterable(t)||!0===a.node.isStorageTextureNode||(this.isSampleCompare(t)?n.push(`@binding( ${r.binding++} ) @group( ${r.group} ) var ${a.name}_sampler : sampler_comparison;`):n.push(`@binding( ${r.binding++} ) @group( ${r.group} ) var ${a.name}_sampler : sampler;`));let o="";const{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(t);if(s>1&&(o="_multisampled"),!0===t.isCubeTexture)i="texture_cube<f32>";else if(!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture)i="texture_2d_array<f32>";else if(!0===t.isDepthTexture)i=`texture_depth${o}_2d`;else if(!0===t.isVideoTexture)i="texture_external";else if(!0===t.isData3DTexture)i="texture_3d<f32>";else if(!0===a.node.isStorageTextureNode){i=`texture_storage_2d<${Xfe(t)}, ${this.getStorageAccess(a.node,e)}>`}else{i=`texture${o}_2d<${this.getComponentTypeFromTexture(t).charAt(0)}32>`}n.push(`@binding( ${r.binding++} ) @group( ${r.group} ) var ${a.name} : ${i};`)}else if("buffer"===a.type||"storageBuffer"===a.type||"indirectStorageBuffer"===a.type){const t=a.node,n=this.getType(t.getNodeType(this)),o=t.bufferCount,s=o>0&&"buffer"===a.type?", "+o:"",l=t.isStorageBufferNode?`storage, ${this.getStorageAccess(t,e)}`:"uniform";if(this.isCustomStruct(a))i.push(`@binding( ${r.binding++} ) @group( ${r.group} ) var<${l}> ${a.name} : ${n};`);else{const e=`\tvalue : array< ${t.isAtomic?`atomic<${n}>`:`${n}`}${s} >`;i.push(this._getWGSLStructBinding(a.name,e,l,r.binding++,r.group))}}else{const e=this.getType(this.getVectorType(a.type)),t=a.groupNode.name;(o[t]||(o[t]={index:r.binding++,id:r.group,snippets:[]})).snippets.push(`\t${a.name} : ${e}`)}}for(const a in o){const e=o[a];r.push(this._getWGSLStructBinding(a,e.snippets.join(",\n"),"uniform",e.index,e.id))}let s=n.join("\n");return s+=i.join("\n"),s+=r.join("\n"),s}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let i="// code\n\n";i+=this.flowCode[t];const r=this.flowNodes[t],o=r[r.length-1],s=o.outputNode,a=void 0!==s&&!0===s.isOutputStructNode;for(const e of r){const r=this.getFlowData(e),l=e.name;if(l&&(i.length>0&&(i+="\n"),i+=`\t// flow -> ${l}\n`),i+=`${r.code}\n\t`,e===o&&"compute"!==t)if(i+="// result\n\n\t","vertex"===t)i+=`varyings.Vertex = ${r.result};`;else if("fragment"===t)if(a)n.returnType=s.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",i+=`return ${r.result};`;else{let e="\t@location(0) color: vec4<f32>";const t=this.getBuiltins("output");t&&(e+=",\n\t"+t),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",e),n.structs+="\nvar<private> output : OutputStruct;",i+=`output.color = ${r.result};\n\n\treturn output;`}}n.flow=i}this.shaderStage=null,null!==this.material?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==n&&(t=this._getWGSLMethod(e+"_"+n)),void 0===t&&(t=this._getWGSLMethod(e)),t||e}getType(e){return sme[e]||e}isAvailable(e){let t=rme[e];return void 0===t&&("float32Filterable"===e?t=this.renderer.hasFeature("float32-filterable"):"clipDistance"===e&&(t=this.renderer.hasFeature("clip-distances")),rme[e]=t),t}_getWGSLMethod(e){return void 0!==lme[e]&&this._include(e),cme[e]}_include(e){const t=lme[e];return t.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\nvar<private> varyings : VaryingsStruct;\n\n// codes\n${e.codes}\n\n@vertex\nfn main( ${e.attributes} ) -> VaryingsStruct {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n\treturn varyings;\n\n}\n`}_getWGSLFragmentCode(e){return`${this.getSignature()}\n// global\n${ume}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@fragment\nfn main( ${e.varyings} ) -> ${e.returnType} {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLComputeCode(e,t){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n${e.scopedArrays}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@compute @workgroup_size( ${t} )\nfn main( ${e.attributes} ) {\n\n\t// system\n\tinstanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLStruct(e,t){return`\nstruct ${e} {\n${t}\n};`}_getWGSLStructBinding(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const o=e+"Struct";return`${this._getWGSLStruct(o,t)}\n@binding( ${i} ) @group( ${r} )\nvar<${n}> ${e} : ${o};`}}class dme{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return null!==e.depthTexture?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=Fpe.Depth24PlusStencil8:e.depth&&(t=Fpe.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const e=this.backend.renderer,n=e.getRenderTarget();t=n?n.samples:e.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&null!==e.renderTarget&&!0!==e.isDepthTexture&&!0!==e.isFramebufferTexture;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return t=null!==e.textures?this.getTextureFormatGPU(e.textures[0]):this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return null!==e.textures?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){return e.isPoints?vpe:e.isLineSegments||e.isMesh&&!0===t.wireframe?ype:e.isLine?Ape:e.isMesh?xpe:void 0}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),2===t&&(t=4)),t}getSampleCountRenderContext(e){return null!==e.textures?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(void 0===e)return navigator.gpu.getPreferredCanvasFormat();if(e===x0.OUM)return Fpe.BGRA8Unorm;if(e===x0.ix0)return Fpe.RGBA16Float;throw new Error("Unsupported outputType")}}const pme=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),fme=new Map([[x0.Oax,["float16"]]]),mme=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class gme{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),i=this.backend,r=i.get(n);let o=r.buffer;if(void 0===o){const s=i.device;let a=n.array;if(!1===e.normalized)if(a.constructor===Int16Array)a=new Int32Array(a);else if(a.constructor===Uint16Array&&(a=new Uint32Array(a),t&GPUBufferUsage.INDEX))for(let e=0;e<a.length;e++)65535===a[e]&&(a[e]=4294967295);if(n.array=a,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){a=new a.constructor(4*n.count);for(let e=0;e<n.count;e++)a.set(n.array.subarray(3*e,3*e+3),4*e);n.itemSize=4,n.array=a,r._force3to4BytesAlignment=!0}const l=a.byteLength+(4-a.byteLength%4)%4;o=s.createBuffer({label:n.name,size:l,usage:t,mappedAtCreation:!0}),new a.constructor(o.getMappedRange()).set(a),o.unmap(),r.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,i=n.device,r=n.get(t),o=n.get(t).buffer;let s=t.array;if(!0===r._force3to4BytesAlignment){s=new s.constructor(4*t.count);for(let e=0;e<t.count;e++)s.set(t.array.subarray(3*e,3*e+3),4*e);t.array=s}const a=this._isTypedArray(s),l=t.updateRanges;if(0===l.length)i.queue.writeBuffer(o,0,s,0);else{const e=a?1:s.BYTES_PER_ELEMENT;for(let t=0,n=l.length;t<n;t++){const n=l[t];let a,c;if(!0===r._force3to4BytesAlignment){a=4*Math.floor(n.start/3)*e,c=4*Math.ceil(n.count/3)*e}else a=n.start*e,c=n.count*e;i.queue.writeBuffer(o,0,s,a,c)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let i=0;i<t.length;i++){const e=t[i],r=e.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(e);let s=n.get(o);if(void 0===s){let t,i;!0===e.isInterleavedBufferAttribute?(t=e.data.stride*r,i=e.data.isInstancedInterleavedBuffer?Ofe:kfe):(t=e.itemSize*r,i=e.isInstancedBufferAttribute?Ofe:kfe),!1!==e.normalized||e.array.constructor!==Int16Array&&e.array.constructor!==Uint16Array||(t=4),s={arrayStride:t,attributes:[],stepMode:i},n.set(o,s)}const a=this._getVertexFormat(e),l=!0===e.isInterleavedBufferAttribute?e.offset*r:0;s.attributes.push({shaderLocation:i,offset:l,format:a})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,i=t.get(this._getBufferAttribute(e)).buffer,r=i.size,o=n.createBuffer({label:`${e.name}_readback`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s=n.createCommandEncoder({label:`readback_encoder_${e.name}`});s.copyBufferToBuffer(i,0,o,0,r);const a=s.finish();n.queue.submit([a]),await o.mapAsync(GPUMapMode.READ);const l=o.getMappedRange(),c=new e.array.constructor(l.slice(0));return o.unmap(),c.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,i=e.array.constructor,r=e.constructor;let o;if(1===t)o=mme.get(i);else{const e=(fme.get(r)||pme.get(i))[n?1:0];if(e){const n=i.BYTES_PER_ELEMENT*t,r=4*Math.floor((n+3)/4)/i.BYTES_PER_ELEMENT;if(r%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${e}x${r}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class vme{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,i=[];let r=0;for(const o of e.bindings){const e={binding:r++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const t={};o.isStorageBuffer&&(4&o.visibility&&(o.access===o9.READ_WRITE||o.access===o9.WRITE_ONLY)?t.type=Afe:t.type=xfe),e.buffer=t}else if(o.isSampler){const t={};o.texture.isDepthTexture&&null!==o.texture.compareFunction&&(t.type="comparison"),e.sampler=t}else if(o.isSampledTexture&&o.texture.isVideoTexture)e.externalTexture={};else if(o.isSampledTexture&&o.store){const t={};t.format=this.backend.get(o.texture).texture.format;const n=o.access;t.access=n===o9.READ_WRITE?wfe:n===o9.WRITE_ONLY?bfe:_fe,e.storageTexture=t}else if(o.isSampledTexture){const n={},{primarySamples:i}=t.utils.getTextureSampleData(o.texture);if(i>1&&(n.multisampled=!0,o.texture.isDepthTexture||(n.sampleType=Sfe)),o.texture.isDepthTexture)n.sampleType=Cfe;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const e=o.texture.type;e===x0.Yuy?n.sampleType=Mfe:e===x0.bkx?n.sampleType=Tfe:e===x0.RQf&&(this.backend.hasFeature("float32-filterable")?n.sampleType=Efe:n.sampleType=Sfe)}o.isSampledCubeTexture?n.viewDimension=Lfe:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?n.viewDimension=Bfe:o.isSampledTexture3D&&(n.viewDimension=Nfe),e.texture=n}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);i.push(e)}return n.createBindGroupLayout({entries:i})}createBindings(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{backend:r,bindGroupLayoutCache:o}=this,s=r.get(e);let a,l=o.get(e.bindingsReference);void 0===l&&(l=this.createBindingsLayout(e),o.set(e.bindingsReference,l)),n>0&&(void 0===s.groups&&(s.groups=[],s.versions=[]),s.versions[n]===i&&(a=s.groups[n])),void 0===a&&(a=this.createBindGroup(e,l),n>0&&(s.groups[n]=a,s.versions[n]=i)),s.group=a,s.layout=l}updateBinding(e){const t=this.backend,n=t.device,i=e.buffer,r=t.get(e).buffer;n.queue.writeBuffer(r,0,i,0)}createBindGroupIndex(e,t){const n=this.backend.device,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,r=e[0],o=n.createBuffer({label:"bindingCameraIndex_"+r,size:16,usage:i});n.queue.writeBuffer(o,0,e,0);const s=[{binding:0,resource:{buffer:o}}];return n.createBindGroup({label:"bindGroupCameraIndex_"+r,layout:t,entries:s})}createBindGroup(e,t){const n=this.backend,i=n.device;let r=0;const o=[];for(const s of e.bindings){if(s.isUniformBuffer){const e=n.get(s);if(void 0===e.buffer){const t=s.byteLength,n=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,r=i.createBuffer({label:"bindingBuffer_"+s.name,size:t,usage:n});e.buffer=r}o.push({binding:r,resource:{buffer:e.buffer}})}else if(s.isStorageBuffer){const e=n.get(s);if(void 0===e.buffer){const t=s.attribute;e.buffer=n.get(t).buffer}o.push({binding:r,resource:{buffer:e.buffer}})}else if(s.isSampler){const e=n.get(s.texture);o.push({binding:r,resource:e.sampler})}else if(s.isSampledTexture){const e=n.get(s.texture);let t;if(void 0!==e.externalTexture)t=i.importExternalTexture({source:e.externalTexture});else{const n=s.store?1:e.texture.mipLevelCount,i=`view-${e.texture.width}-${e.texture.height}-${n}`;if(t=e[i],void 0===t){const r=Dfe;let o;o=s.isSampledCubeTexture?Lfe:s.isSampledTexture3D?Nfe:s.texture.isDataArrayTexture||s.texture.isCompressedArrayTexture?Bfe:Pfe,t=e[i]=e.texture.createView({aspect:r,dimension:o,mipLevelCount:n})}}o.push({binding:r,resource:t})}r++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class yme{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:i,geometry:r,pipeline:o}=e,{vertexProgram:s,fragmentProgram:a}=o,l=this.backend,c=l.device,u=l.utils,h=l.get(o),d=[];for(const T of e.getBindings()){const e=l.get(T);d.push(e.layout)}const p=l.attributeUtils.createShaderVertexBuffers(e);let f;!0===i.transparent&&i.blending!==x0.XIg&&(f=this._getBlending(i));let m={};!0===i.stencilWrite&&(m={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const g=this._getColorWriteMask(i),v=[];if(null!==e.context.textures){const t=e.context.textures;for(let e=0;e<t.length;e++){const n=u.getTextureFormatGPU(t[e]);v.push({format:n,blend:f,writeMask:g})}}else{const t=u.getCurrentColorFormat(e.context);v.push({format:t,blend:f,writeMask:g})}const y=l.get(s).module,A=l.get(a).module,x=this._getPrimitiveState(n,r,i),b=this._getDepthCompare(i),_=u.getCurrentDepthStencilFormat(e.context),w=this._getSampleCount(e.context),E={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},y,{buffers:p}),fragment:Object.assign({},A,{targets:v}),primitive:x,multisample:{count:w,alphaToCoverageEnabled:i.alphaToCoverage&&w>1},layout:c.createPipelineLayout({bindGroupLayouts:d})},S={},C=e.context.depth,M=e.context.stencil;if(!0!==C&&!0!==M||(!0===C&&(S.format=_,S.depthWriteEnabled=i.depthWrite,S.depthCompare=b),!0===M&&(S.stencilFront=m,S.stencilBack={},S.stencilReadMask=i.stencilFuncMask,S.stencilWriteMask=i.stencilWriteMask),!0===i.polygonOffset&&(S.depthBias=i.polygonOffsetUnits,S.depthBiasSlopeScale=i.polygonOffsetFactor,S.depthBiasClamp=0),E.depthStencil=S),null===t)h.pipeline=c.createRenderPipeline(E);else{const e=new Promise((e=>{c.createRenderPipelineAsync(E).then((t=>{h.pipeline=t,e()}))}));t.push(e)}}createBundleEncoder(e){const t=this.backend,{utils:n,device:i}=t,r=n.getCurrentDepthStencilFormat(e),o={label:"renderBundleEncoder",colorFormats:[n.getCurrentColorFormat(e)],depthStencilFormat:r,sampleCount:this._getSampleCount(e)};return i.createRenderBundleEncoder(o)}createComputePipeline(e,t){const n=this.backend,i=n.device,r=n.get(e.computeProgram).module,o=n.get(e),s=[];for(const a of t){const e=n.get(a);s.push(e.layout)}o.pipeline=i.createComputePipeline({compute:r,layout:i.createPipelineLayout({bindGroupLayouts:s})})}_getBlending(e){let t,n;const i=e.blending,r=e.blendSrc,o=e.blendDst,s=e.blendEquation;if(i===x0.bCz){const i=null!==e.blendSrcAlpha?e.blendSrcAlpha:r,a=null!==e.blendDstAlpha?e.blendDstAlpha:o,l=null!==e.blendEquationAlpha?e.blendEquationAlpha:s;t={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(s)},n={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(l)}}else{const r=(e,i,r,o)=>{t={srcFactor:e,dstFactor:i,operation:rfe},n={srcFactor:r,dstFactor:o,operation:rfe}};if(e.premultipliedAlpha)switch(i){case x0.NTi:r(Qpe,Ype,Qpe,Ype);break;case x0.EZo:r(Qpe,Qpe,Qpe,Qpe);break;case x0.Kwu:r(Wpe,Xpe,Wpe,Qpe);break;case x0.EdD:r(Wpe,qpe,Wpe,$pe)}else switch(i){case x0.NTi:r($pe,Ype,Qpe,Ype);break;case x0.EZo:r($pe,Qpe,$pe,Qpe);break;case x0.Kwu:r(Wpe,Xpe,Wpe,Qpe);break;case x0.EdD:r(Wpe,qpe,Wpe,qpe)}}if(void 0!==t&&void 0!==n)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case x0.ojh:t=Wpe;break;case x0.qad:t=Qpe;break;case x0.f4X:t=qpe;break;case x0.LiQ:t=Xpe;break;case x0.ie2:t=$pe;break;case x0.OuU:t=Ype;break;case x0.wn6:t=Kpe;break;case x0.aEY:t=Jpe;break;case x0.hdd:t=Zpe;break;case x0.Nt7:t=efe;break;case x0.hgQ:t=tfe;break;case 211:t=nfe;break;case 212:t=ife;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case x0.HPb:t=_pe;break;case x0.sKt:t=Rpe;break;case x0.kYr:t=wpe;break;case x0.CR7:t=Spe;break;case x0.jsO:t=Epe;break;case x0.TMh:t=Tpe;break;case x0.RcT:t=Cpe;break;case x0.klZ:t=Mpe;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case x0.VVr:t=hfe;break;case x0.kqe:t=dfe;break;case x0.kG0:t=pfe;break;case x0.oVO:t=ffe;break;case x0.HLH:t=mfe;break;case x0.ROr:t=gfe;break;case x0.Ru$:t=vfe;break;case x0.fJr:t=yfe;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case x0.gO9:t=rfe;break;case x0.FXf:t=ofe;break;case x0.nST:t=sfe;break;case x0.znC:t=afe;break;case x0.$ei:t=lfe;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const i={},r=this.backend.utils;switch(i.topology=r.getPrimitiveTopology(e,n),null!==t.index&&!0===e.isLine&&!0!==e.isLineSegments&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?Ope:Upe),n.side){case x0.hB5:i.frontFace=Lpe,i.cullMode=kpe;break;case x0.hsX:i.frontFace=Lpe,i.cullMode=Dpe;break;case x0.$EB:i.frontFace=Lpe,i.cullMode=Npe;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side)}return i}_getColorWriteMask(e){return!0===e.colorWrite?ufe:cfe}_getDepthCompare(e){let t;if(!1===e.depthTest)t=Rpe;else{const n=e.depthFunc;switch(n){case x0.eHc:t=_pe;break;case x0.lGu:t=Rpe;break;case x0.brA:t=wpe;break;case x0.xSv:t=Spe;break;case x0.U3G:t=Epe;break;case x0.Gwm:t=Tpe;break;case x0.K52:t=Cpe;break;case x0.bw0:t=Mpe;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class Ame extends fpe{constructor(e,t){super(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const n=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:n,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:n,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return(0,x0.mcG)(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=8*t;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const r=i.finish();if(this.device.queue.submit([r]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let s=0;for(const[,a]of e){const e=o[a],t=o[a+1];s+=Number(t-e)/1e6}return this.resultBuffer.unmap(),this.lastValue=s,s}catch(e){return console.error("Error resolving queries:",e),"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class xme extends Kde{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===e.alpha||e.alpha,this.parameters.requiredLimits=void 0===e.requiredLimits?{}:e.requiredLimits,this.trackTimestamp=!0===e.trackTimestamp,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new dme(this),this.attributeUtils=new gme(this),this.bindingUtils=new vme(this),this.pipelineUtils=new yme(this),this.textureUtils=new qfe(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(void 0===t.device){const e={powerPreference:t.powerPreference},i="undefined"!==typeof navigator?await navigator.gpu.requestAdapter(e):null;if(null===i)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const r=Object.values(Ufe),o=[];for(const t of r)i.features.has(t)&&o.push(t);const s={requiredFeatures:o,requiredLimits:t.requiredLimits};n=await i.requestDevice(s)}else n=t.device;n.lost.then((t=>{const n={api:"WebGPU",message:t.message||"Unknown reason",reason:t.reason||null,originalEvent:t};e.onDeviceLost(n)}));const i=void 0!==t.context?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=i;const r=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Ufe.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:r}),this.updateSize()}get coordinateSystem(){return x0.i7u}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(null===e){const t=this.renderer;e={colorAttachments:[{view:null}]},!0!==this.renderer.depth&&!0!==this.renderer.stencil||(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(t.depth,t.stencil).createView()});const n=e.colorAttachments[0];this.renderer.samples>0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.renderTarget,i=this.get(n);let r=i.descriptors;if(void 0===r||i.width!==n.width||i.height!==n.height||i.dimensions!==n.dimensions||i.activeMipmapLevel!==n.activeMipmapLevel||i.activeCubeFace!==e.activeCubeFace||i.samples!==n.samples||i.loadOp!==t.loadOp){r={},i.descriptors=r;const e=()=>{n.removeEventListener("dispose",e),this.delete(n)};n.addEventListener("dispose",e)}const o=e.getCacheKey();let s=r[o];if(void 0===s){const a=e.textures,l=[];let c;for(let i=0;i<a.length;i++){const r=this.get(a[i]),o={label:`colorAttachment_${i}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Pfe};n.isRenderTarget3D?(c=e.activeCubeFace,o.baseArrayLayer=0,o.dimension=Nfe,o.depthOrArrayLayers=a[i].image.depth):n.isRenderTargetArray&&(o.dimension=Bfe,o.depthOrArrayLayers=a[i].image.depth);const s=r.texture.createView(o);let u,h;void 0!==r.msaaTexture?(u=r.msaaTexture.createView(),h=s):(u=s,h=void 0);let d={r:0,g:0,b:0,a:1};0===i&&t.clearValue&&(d=t.clearValue),l.push({view:u,depthSlice:c,resolveTarget:h,loadOp:t.loadOP||Ppe,storeOp:t.storeOP||Ipe,clearValue:d})}if(s={colorAttachments:l},e.depth){const t={view:this.get(e.depthTexture).texture.createView()};s.depthStencilAttachment=t}r[o]=s,i.width=n.width,i.height=n.height,i.samples=n.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace,i.dimensions=n.dimensions,i.depthSlice=c,i.loadOp=l[0].loadOp}return s}beginRender(e){const t=this.get(e),n=this.device,i=e.occlusionQueryCount;let r,o;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,r=n.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=r,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null),o=null===e.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:Ppe}),this.initTimestampQuery(e,o),o.occlusionQuerySet=r;const s=o.depthStencilAttachment;if(null!==e.textures){const t=o.colorAttachments;for(let n=0;n<t.length;n++){const i=t[n];e.clearColor?(i.clearValue=0===n?e.clearColorValue:{r:0,g:0,b:0,a:1},i.loadOp=Bpe,i.storeOp=Ipe):(i.loadOp=Ppe,i.storeOp=Ipe)}}else{const t=o.colorAttachments[0];e.clearColor?(t.clearValue=e.clearColorValue,t.loadOp=Bpe,t.storeOp=Ipe):(t.loadOp=Ppe,t.storeOp=Ipe)}e.depth&&(e.clearDepth?(s.depthClearValue=e.clearDepthValue,s.depthLoadOp=Bpe,s.depthStoreOp=Ipe):(s.depthLoadOp=Ppe,s.depthStoreOp=Ipe)),e.stencil&&(e.clearStencil?(s.stencilClearValue=e.clearStencilValue,s.stencilLoadOp=Bpe,s.stencilStoreOp=Ipe):(s.stencilLoadOp=Ppe,s.stencilStoreOp=Ipe));const a=n.createCommandEncoder({label:"renderContext_"+e.id}),l=a.beginRenderPass(o);if(t.descriptor=o,t.encoder=a,t.currentPass=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:t,y:n,width:i,height:r}=e.scissorValue;l.setScissorRect(t,n,i,r)}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),n>0){const i=8*n;let r=this.occludedResolveCache.get(i);void 0===r&&(r=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,r));const o=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,r,0),t.encoder.copyBufferToBuffer(r,0,o,0,i),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),null!==e.textures){const t=e.textures;for(let e=0;e<t.length;e++){const n=t[e];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const e=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const r=n.getMappedRange(),o=new BigUint64Array(r);for(let t=0;t<i.length;t++)o[t]===BigInt(0)&&e.add(i[t]);n.destroy(),t.occluded=e}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:i,width:r,height:o,minDepth:s,maxDepth:a}=e.viewportValue;t.setViewport(n,i,r,o,s,a)}getClearColor(){const e=super.getClearColor();return!0===this.renderer.alpha&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=this.device,o=this.renderer;let s,a,l,c,u=[];if(e){const e=this.getClearColor();a={r:e.r,g:e.g,b:e.b,a:e.a}}if(null===i){l=o.depth,c=o.stencil;const t=this._getDefaultRenderPassDescriptor();if(e){u=t.colorAttachments;const e=u[0];e.clearValue=a,e.loadOp=Bpe,e.storeOp=Ipe}(l||c)&&(s=t.depthStencilAttachment)}else{if(l=i.depth,c=i.stencil,e){u=this._getRenderPassDescriptor(i,{loadOp:Bpe,clearValue:a}).colorAttachments}if(l||c){s={view:this.get(i.depthTexture).texture.createView()}}}l&&(t?(s.depthLoadOp=Bpe,s.depthClearValue=o.getClearDepth(),s.depthStoreOp=Ipe):(s.depthLoadOp=Ppe,s.depthStoreOp=Ipe)),c&&(n?(s.stencilLoadOp=Bpe,s.stencilClearValue=o.getClearStencil(),s.stencilStoreOp=Ipe):(s.stencilLoadOp=Ppe,s.stencilStoreOp=Ipe));const h=r.createCommandEncoder({label:"clear"});h.beginRenderPass({colorAttachments:u,depthStencilAttachment:s}).end(),r.queue.submit([h.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,i){const{passEncoderGPU:r}=this.get(e),o=this.get(i).pipeline;r.setPipeline(o);for(let c=0,u=n.length;c<u;c++){const e=n[c],t=this.get(e);r.setBindGroup(c,t.group)}const s=this.device.limits.maxComputeWorkgroupsPerDimension,a=this.get(t);void 0===a.dispatchSize&&(a.dispatchSize={x:0,y:1,z:1});const{dispatchSize:l}=a;t.dispatchCount>s?(l.x=Math.min(t.dispatchCount,s),l.y=Math.ceil(t.dispatchCount/s)):l.x=t.dispatchCount,r.dispatchWorkgroups(l.x,l.y,l.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:i,context:r,pipeline:o}=e,s=e.getBindings(),a=this.get(r),l=this.get(o).pipeline,c=a.currentSets,u=a.currentPass,h=e.getDrawParameters();if(null===h)return;c.pipeline!==l&&(u.setPipeline(l),c.pipeline=l);const d=c.bindingGroups;for(let v=0,y=s.length;v<y;v++){const e=s[v],t=this.get(e);d[e.index]!==e.id&&(u.setBindGroup(e.index,t.group),d[e.index]=e.id)}const p=e.getIndex(),f=null!==p;if(!0===f&&c.index!==p){const e=this.get(p).buffer,t=p.array instanceof Uint16Array?Ope:Upe;u.setIndexBuffer(e,t),c.index=p}const m=e.getVertexBuffers();for(let v=0,y=m.length;v<y;v++){const e=m[v];if(c.attributes[v]!==e){const t=this.get(e).buffer;u.setVertexBuffer(v,t),c.attributes[v]=e}}if(void 0!==a.occlusionQuerySet){const e=a.lastOcclusionObject;e!==n&&(null!==e&&!0===e.occlusionTest&&(u.endOcclusionQuery(),a.occlusionQueryIndex++),!0===n.occlusionTest&&(u.beginOcclusionQuery(a.occlusionQueryIndex),a.occlusionQueryObjects[a.occlusionQueryIndex]=n),a.lastOcclusionObject=n)}!0===r.stencil&&!0===i.stencilWrite&&a.currentStencilRef!==i.stencilRef&&(u.setStencilReference(i.stencilRef),a.currentStencilRef=i.stencilRef);const g=()=>{if(!0===n.isBatchedMesh){const e=n._multiDrawStarts,i=n._multiDrawCounts,r=n._multiDrawCount,o=n._multiDrawInstances;null!==o&&(0,x0.mcG)("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let s=0;s<r;s++){const r=o?o[s]:1,a=r>1?0:s;!0===f?u.drawIndexed(i[s],r,e[s]/p.array.BYTES_PER_ELEMENT,0,a):u.draw(i[s],r,e[s],a),t.update(n,i[s],r)}}else if(!0===f){const{vertexCount:i,instanceCount:r,firstVertex:o}=h,s=e.getIndirect();if(null!==s){const e=this.get(s).buffer;u.drawIndexedIndirect(e,0)}else u.drawIndexed(i,r,o,0,0);t.update(n,i,r)}else{const{vertexCount:i,instanceCount:r,firstVertex:o}=h,s=e.getIndirect();if(null!==s){const e=this.get(s).buffer;u.drawIndirect(e,0)}else u.draw(i,r,o,0);t.update(n,i,r)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const t=this.get(e.camera),i=e.camera.cameras,o=e.getBindingGroup("cameraIndex");if(void 0===t.indexesGPU||t.indexesGPU.length!==i.length){const e=this.get(o),n=[],r=new Uint32Array([0,0,0,0]);for(let t=0,o=i.length;t<o;t++){r[0]=t;const i=this.bindingUtils.createBindGroupIndex(r,e.layout);n.push(i)}t.indexesGPU=n}const s=this.renderer.getPixelRatio();for(let e=0,a=i.length;e<a;e++){const a=i[e];if(n.layers.test(a.layers)){const n=a.viewport;u.setViewport(Math.floor(n.x*s),Math.floor(n.y*s),Math.floor(n.width*s),Math.floor(n.height*s),r.viewportValue.minDepth,r.viewportValue.maxDepth),u.setBindGroup(o.index,t.indexesGPU[e]),g()}}}else g()}needsRenderUpdate(e){const t=this.get(e),{object:n,material:i}=e,r=this.utils,o=r.getSampleCountRenderContext(e.context),s=r.getCurrentColorSpace(e.context),a=r.getCurrentColorFormat(e.context),l=r.getCurrentDepthStencilFormat(e.context),c=r.getPrimitiveTopology(n,i);let u=!1;return t.material===i&&t.materialVersion===i.version&&t.transparent===i.transparent&&t.blending===i.blending&&t.premultipliedAlpha===i.premultipliedAlpha&&t.blendSrc===i.blendSrc&&t.blendDst===i.blendDst&&t.blendEquation===i.blendEquation&&t.blendSrcAlpha===i.blendSrcAlpha&&t.blendDstAlpha===i.blendDstAlpha&&t.blendEquationAlpha===i.blendEquationAlpha&&t.colorWrite===i.colorWrite&&t.depthWrite===i.depthWrite&&t.depthTest===i.depthTest&&t.depthFunc===i.depthFunc&&t.stencilWrite===i.stencilWrite&&t.stencilFunc===i.stencilFunc&&t.stencilFail===i.stencilFail&&t.stencilZFail===i.stencilZFail&&t.stencilZPass===i.stencilZPass&&t.stencilFuncMask===i.stencilFuncMask&&t.stencilWriteMask===i.stencilWriteMask&&t.side===i.side&&t.alphaToCoverage===i.alphaToCoverage&&t.sampleCount===o&&t.colorSpace===s&&t.colorFormat===a&&t.depthStencilFormat===l&&t.primitiveTopology===c&&t.clippingContextCacheKey===e.clippingContextCacheKey||(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=o,t.colorSpace=s,t.colorFormat=a,t.depthStencilFormat=l,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,u=!0),u}getRenderCacheKey(e){const{object:t,material:n}=e,i=this.utils,r=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,i.getSampleCountRenderContext(r),i.getCurrentColorSpace(r),i.getCurrentColorFormat(r),i.getCurrentDepthStencilFormat(r),i.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,i,r,o){return this.textureUtils.copyTextureToBuffer(e,t,n,i,r,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new Ame(this.device,n,2048));const i=this.timestampQueryPool[n],r=i.allocateQueriesForContext(e);t.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:r,endOfPassWriteIndex:r+1}}createNodeBuilder(e,t){return new hme(e,t)}createProgram(e){this.get(e).module={module:this.device.createShaderModule({code:e.code,label:e.stage+(""!==e.name?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),i=n.currentPass.finish();this.get(t).bundleGPU=i,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=0,s=0,a=0,l=0,c=0,u=0,h=e.image.width,d=e.image.height;null!==n&&(l=n.x,c=n.y,u=n.z||0,h=n.width,d=n.height),null!==i&&(o=i.x,s=i.y,a=i.z||0);const p=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),f=this.get(e).texture,m=this.get(t).texture;p.copyTextureToTexture({texture:f,mipLevel:r,origin:{x:l,y:c,z:u}},{texture:m,mipLevel:r,origin:{x:o,y:s,z:a}},[h,d,1]),this.device.queue.submit([p.finish()])}copyFramebufferToTexture(e,t,n){const i=this.get(t);let r=null;r=t.renderTarget?e.isDepthTexture?this.get(t.depthTexture).texture:this.get(t.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(t.depth,t.stencil):this.context.getCurrentTexture();const o=this.get(e).texture;if(r.format!==o.format)return void console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",r.format,o.format);let s;if(i.currentPass?(i.currentPass.end(),s=i.encoder):s=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),s.copyTextureToTexture({texture:r,origin:[n.x,n.y,0]},{texture:o},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),i.currentPass){const{descriptor:e}=i;for(let t=0;t<e.colorAttachments.length;t++)e.colorAttachments[t].loadOp=Ppe;if(t.depth&&(e.depthStencilAttachment.depthLoadOp=Ppe),t.stencil&&(e.depthStencilAttachment.stencilLoadOp=Ppe),i.currentPass=s.beginRenderPass(e),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:e,y:n,width:r,height:o}=t.scissorValue;i.currentPass.setScissorRect(e,n,r,o)}}else this.device.queue.submit([s.finish()])}}class bme extends x0.nCl{constructor(e,t,n,i,r,o){super(e,t,n,i,r,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class _me extends hde{constructor(){super(),this.addMaterial(Bse,"MeshPhongMaterial"),this.addMaterial(Ale,"MeshStandardMaterial"),this.addMaterial(ble,"MeshPhysicalMaterial"),this.addMaterial(Sle,"MeshToonMaterial"),this.addMaterial(wse,"MeshBasicMaterial"),this.addMaterial(Ise,"MeshLambertMaterial"),this.addMaterial(cse,"MeshNormalMaterial"),this.addMaterial(Rle,"MeshMatcapMaterial"),this.addMaterial(rse,"LineBasicMaterial"),this.addMaterial(sse,"LineDashedMaterial"),this.addMaterial(Dle,"PointsMaterial"),this.addMaterial(Lle,"SpriteMaterial"),this.addMaterial(Ule,"ShadowMaterial"),this.addLight(the,x0.HiM),this.addLight(Fhe,x0.ZyN),this.addLight(Ghe,x0.ure),this.addLight(Hhe,x0.nCl),this.addLight(Qhe,x0.$p8),this.addLight(qhe,x0.dth),this.addLight(Xhe,x0.FZo),this.addLight(Whe,bme),this.addToneMapping(Gce,x0.kyO),this.addToneMapping(Hce,x0.Mjd),this.addToneMapping(Wce,x0.nNL),this.addToneMapping(qce,x0.FV),this.addToneMapping(Kce,x0.LAk),this.addToneMapping(Jce,x0.aJ8)}}class wme extends Ide{constructor(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.forceWebGL?e=gpe:(e=xme,t.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new gpe(t)));super(new e(t),t),this.library=new _me,this.isWebGPURenderer=!0}}x0.YJl;x0.gPd;x0.aHM;x0.jut;x0.XTe;x0.YJl;const Eme={type:"change"},Sme={type:"start"},Cme={type:"end"},Mme=1e-6,Tme=-1,Rme=0,Ime=1,Pme=2,Bme=3,Lme=4,Nme=new x0.I9Y,Dme=new x0.I9Y,kme=new x0.Pq0,Ome=new x0.Pq0,Ume=new x0.Pq0,Fme=new x0.PTz,zme=new x0.Pq0,jme=new x0.Pq0,Vme=new x0.Pq0,Gme=new x0.Pq0;class Hme extends x0.H2z{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,t),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:x0.kBv.ROTATE,MIDDLE:x0.kBv.DOLLY,RIGHT:x0.kBv.PAN},this.state=Tme,this.keyState=Tme,this.target=new x0.Pq0,this._lastPosition=new x0.Pq0,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new x0.Pq0,this._movePrev=new x0.I9Y,this._moveCurr=new x0.I9Y,this._lastAxis=new x0.Pq0,this._zoomStart=new x0.I9Y,this._zoomEnd=new x0.I9Y,this._panStart=new x0.I9Y,this._panEnd=new x0.I9Y,this._pointers=[],this._pointerPositions={},this._onPointerMove=Qme.bind(this),this._onPointerDown=Wme.bind(this),this._onPointerUp=qme.bind(this),this._onPointerCancel=Xme.bind(this),this._onContextMenu=tge.bind(this),this._onMouseWheel=ege.bind(this),this._onKeyDown=Yme.bind(this),this._onKeyUp=$me.bind(this),this._onTouchStart=nge.bind(this),this._onTouchMove=ige.bind(this),this._onTouchEnd=rge.bind(this),this._onMouseDown=Kme.bind(this),this._onMouseMove=Jme.bind(this),this._onMouseUp=Zme.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==t&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>Mme&&(this.dispatchEvent(Eme),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>Mme||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Eme),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Tme,this.keyState=Tme,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Eme),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Dme.copy(this._panEnd).sub(this._panStart),Dme.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Dme.x*=e,Dme.y*=t}Dme.multiplyScalar(this._eye.length()*this.panSpeed),Ome.copy(this._eye).cross(this.object.up).setLength(Dme.x),Ome.add(kme.copy(this.object.up).setLength(Dme.y)),this.object.position.add(Ome),this.target.add(Ome),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Dme.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){Gme.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=Gme.length();e?(this._eye.copy(this.object.position).sub(this.target),zme.copy(this._eye).normalize(),jme.copy(this.object.up).normalize(),Vme.crossVectors(jme,zme).normalize(),jme.setLength(this._moveCurr.y-this._movePrev.y),Vme.setLength(this._moveCurr.x-this._movePrev.x),Gme.copy(jme.add(Vme)),Ume.crossVectors(Gme,this._eye).normalize(),e*=this.rotateSpeed,Fme.setFromAxisAngle(Ume,e),this._eye.applyQuaternion(Fme),this.object.up.applyQuaternion(Fme),this._lastAxis.copy(Ume),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Fme.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Fme),this.object.up.applyQuaternion(Fme)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Lme?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=x0.cj9.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,1!==e&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=x0.cj9.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return Nme.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),Nme}_getMouseOnCircle(e,t){return Nme.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),Nme}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId)return void this._pointers.splice(t,1)}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new x0.I9Y,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Wme(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e))}function Qme(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function qme(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchEnd(e):this._onMouseUp(),this._removePointer(e),0===this._pointers.length&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function Xme(e){this._removePointer(e)}function $me(){!1!==this.enabled&&(this.keyState=Tme,window.addEventListener("keydown",this._onKeyDown))}function Yme(e){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Tme&&(e.code!==this.keys[Rme]||this.noRotate?e.code!==this.keys[Ime]||this.noZoom?e.code!==this.keys[Pme]||this.noPan||(this.keyState=Pme):this.keyState=Ime:this.keyState=Rme))}function Kme(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case x0.kBv.DOLLY:this.state=Ime;break;case x0.kBv.ROTATE:this.state=Rme;break;case x0.kBv.PAN:this.state=Pme;break;default:this.state=Tme}const n=this.keyState!==Tme?this.keyState:this.state;n!==Rme||this.noRotate?n!==Ime||this.noZoom?n!==Pme||this.noPan||(this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(Sme)}function Jme(e){const t=this.keyState!==Tme?this.keyState:this.state;t!==Rme||this.noRotate?t!==Ime||this.noZoom?t!==Pme||this.noPan||this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)))}function Zme(){this.state=Tme,this.dispatchEvent(Cme)}function ege(e){if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.dispatchEvent(Sme),this.dispatchEvent(Cme)}}function tge(e){!1!==this.enabled&&e.preventDefault()}function nge(e){if(this._trackPointer(e),1===this._pointers.length)this.state=Bme,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=Lme;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,i)),this._panEnd.copy(this._panStart)}this.dispatchEvent(Sme)}function ige(e){if(this._trackPointer(e),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));else{const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y;this._touchZoomDistanceEnd=Math.sqrt(n*n+i*i);const r=(e.pageX+t.x)/2,o=(e.pageY+t.y)/2;this._panEnd.copy(this._getMouseOnScreen(r,o))}}function rge(e){switch(this._pointers.length){case 0:this.state=Tme;break;case 1:this.state=Bme,this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Lme;for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId!==e.pointerId){const e=this._pointerPositions[this._pointers[t].pointerId];this._moveCurr.copy(this._getMouseOnCircle(e.x,e.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(Cme)}const oge={type:"change"},sge={type:"start"},age={type:"end"},lge=new x0.RlV,cge=new x0.Zcv,uge=Math.cos(70*x0.cj9.DEG2RAD),hge=new x0.Pq0,dge=2*Math.PI,pge=-1,fge=0,mge=1,gge=2,vge=3,yge=4,Age=5,xge=6,bge=1e-6;class _ge extends x0.H2z{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null),this.state=pge,this.enabled=!0,this.target=new x0.Pq0,this.cursor=new x0.Pq0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:x0.kBv.ROTATE,MIDDLE:x0.kBv.DOLLY,RIGHT:x0.kBv.PAN},this.touches={ONE:x0.wtR.ROTATE,TWO:x0.wtR.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new x0.Pq0,this._lastQuaternion=new x0.PTz,this._lastTargetPosition=new x0.Pq0,this._quat=(new x0.PTz).setFromUnitVectors(e.up,new x0.Pq0(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new x0.YHV,this._sphericalDelta=new x0.YHV,this._scale=1,this._panOffset=new x0.Pq0,this._rotateStart=new x0.I9Y,this._rotateEnd=new x0.I9Y,this._rotateDelta=new x0.I9Y,this._panStart=new x0.I9Y,this._panEnd=new x0.I9Y,this._panDelta=new x0.I9Y,this._dollyStart=new x0.I9Y,this._dollyEnd=new x0.I9Y,this._dollyDelta=new x0.I9Y,this._dollyDirection=new x0.Pq0,this._mouse=new x0.I9Y,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Ege.bind(this),this._onPointerDown=wge.bind(this),this._onPointerUp=Sge.bind(this),this._onContextMenu=Bge.bind(this),this._onMouseWheel=Tge.bind(this),this._onKeyDown=Rge.bind(this),this._onTouchStart=Ige.bind(this),this._onTouchMove=Pge.bind(this),this._onMouseDown=Cge.bind(this),this._onMouseMove=Mge.bind(this),this._interceptControlDown=Lge.bind(this),this._interceptControlUp=Nge.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(oge),this.update(),this.state=pge}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=this.object.position;hge.copy(t).sub(this.target),hge.applyQuaternion(this._quat),this._spherical.setFromVector3(hge),this.autoRotate&&this.state===pge&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=dge:n>Math.PI&&(n-=dge),i<-Math.PI?i+=dge:i>Math.PI&&(i-=dge),this._spherical.theta=n<=i?Math.max(n,Math.min(i,this._spherical.theta)):this._spherical.theta>(n+i)/2?Math.max(n,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=e!=this._spherical.radius}if(hge.setFromSpherical(this._spherical),hge.applyQuaternion(this._quatInverse),t.copy(this.target).add(hge),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=hge.length();e=this._clampDistance(t*this._scale);const n=t-e;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),r=!!n}else if(this.object.isOrthographicCamera){const t=new x0.Pq0(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=n!==this.object.zoom;const i=new x0.Pq0(this._mouse.x,this._mouse.y,0);i.unproject(this.object),this.object.position.sub(i).add(t),this.object.updateMatrixWorld(),e=hge.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(lge.origin.copy(this.object.position),lge.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(lge.direction))<uge?this.object.lookAt(this.target):(cge.setFromNormalAndCoplanarPoint(this.object.up,this.target),lge.intersectPlane(cge,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,!!(r||this._lastPosition.distanceToSquared(this.object.position)>bge||8*(1-this._lastQuaternion.dot(this.object.quaternion))>bge||this._lastTargetPosition.distanceToSquared(this.target)>bge)&&(this.dispatchEvent(oge),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?dge/60*this.autoRotateSpeed*e:dge/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){hge.setFromMatrixColumn(t,0),hge.multiplyScalar(-e),this._panOffset.add(hge)}_panUp(e,t){!0===this.screenSpacePanning?hge.setFromMatrixColumn(t,1):(hge.setFromMatrixColumn(t,0),hge.crossVectors(this.object.up,hge)),hge.multiplyScalar(e),this._panOffset.add(hge)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;hge.copy(i).sub(this.target);let r=hge.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/n.clientHeight,this.object.matrix),this._panUp(2*t*r/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=e-n.left,r=t-n.top,o=n.width,s=n.height;this._mouse.x=i/o*2-1,this._mouse.y=-r/s*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(dge*this._rotateDelta.x/t.clientHeight),this._rotateUp(dge*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(dge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-dge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(dge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-dge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(n,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateEnd.set(n,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(dge*this._rotateDelta.x/t.clientHeight),this._rotateUp(dge*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._updateZoomParameters(o,s)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new x0.I9Y,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function wge(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(e)||(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function Ege(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function Sge(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(age),this.state=pge;break;case 1:const t=this._pointers[0],n=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:n.x,pageY:n.y})}}function Cge(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case x0.kBv.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=mge;break;case x0.kBv.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=gge}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=fge}break;case x0.kBv.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=fge}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=gge}break;default:this.state=pge}this.state!==pge&&this.dispatchEvent(sge)}function Mge(e){switch(this.state){case fge:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case mge:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case gge:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function Tge(e){!1!==this.enabled&&!1!==this.enableZoom&&this.state===pge&&(e.preventDefault(),this.dispatchEvent(sge),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(age))}function Rge(e){!1!==this.enabled&&this._handleKeyDown(e)}function Ige(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case x0.wtR.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=vge;break;case x0.wtR.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=yge;break;default:this.state=pge}break;case 2:switch(this.touches.TWO){case x0.wtR.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=Age;break;case x0.wtR.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=xge;break;default:this.state=pge}break;default:this.state=pge}this.state!==pge&&this.dispatchEvent(sge)}function Pge(e){switch(this._trackPointer(e),this.state){case vge:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case yge:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case Age:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case xge:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=pge}}function Bge(e){!1!==this.enabled&&e.preventDefault()}function Lge(e){if("Control"===e.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function Nge(e){if("Control"===e.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const Dge={type:"change"},kge=1e-6,Oge=new x0.PTz;class Uge extends x0.H2z{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new x0.Pq0(0,0,0),this._rotationVector=new x0.Pq0(0,0,0),this._lastQuaternion=new x0.PTz,this._lastPosition=new x0.Pq0,this._status=0,this._onKeyDown=Fge.bind(this),this._onKeyUp=zge.bind(this),this._onPointerMove=Vge.bind(this),this._onPointerDown=jge.bind(this),this._onPointerUp=Gge.bind(this),this._onPointerCancel=Hge.bind(this),this._onContextMenu=Wge.bind(this),null!==t&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(!1===this.enabled)return;const t=this.object,n=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),Oge.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(Oge),(this._lastPosition.distanceToSquared(t.position)>kge||8*(1-this._lastQuaternion.dot(t.quaternion))>kge)&&(this.dispatchEvent(Dge),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function Fge(e){if(!e.altKey&&!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function zge(e){if(!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function jge(e){if(!1!==this.enabled)if(this.dragToLook)this._status++;else{switch(e.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}function Vge(e){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){const t=this._getContainerDimensions(),n=t.size[0]/2,i=t.size[1]/2;this._moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this._moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this._updateRotationVector()}}function Gge(e){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(e.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function Hge(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function Wge(e){!1!==this.enabled&&e.preventDefault()}const Qge={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class qge{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Xge=new x0.qUd(-1,1,1,-1,0,1);class $ge extends x0.LoY{constructor(){super(),this.setAttribute("position",new x0.qtW([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new x0.qtW([0,2,0,0,2,0],2))}}const Yge=new $ge;class Kge{constructor(e){this._mesh=new x0.eaF(Yge,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Xge)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Jge extends qge{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof x0.BKk?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=x0.LlO.clone(e.uniforms),this.material=new x0.BKk({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Kge(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Zge extends qge{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),r=e.state;let o,s;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0),this.inverse?(o=0,s=1):(o=1,s=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),r.buffers.stencil.setClear(s),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.color.setMask(!0),r.buffers.depth.setMask(!0),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}class eve extends qge{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class tve{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const n=e.getSize(new x0.I9Y);this._width=n.width,this._height=n.height,(t=new x0.nWS(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:x0.ix0})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Jge(Qge),this.copyPass.material.blending=x0.XIg,this.clock=new x0.zD7}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,r=this.passes.length;i<r;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Zge&&(t instanceof Zge?n=!0:t instanceof eve&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new x0.I9Y);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class nve extends qge{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=r,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new x0.Q1f}render(e,t,n){const i=e.autoClear;let r,o;e.autoClear=!1,null!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(r),null!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=i}}var ive,rve,ove,sve,ave,lve,cve,uve,hve,dve,pve,fve,mve=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-mve.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*mve.Bounce.In(2*e):.5*mve.Bounce.Out(2*e-1)+.5}}),generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}}),gve=function(){return performance.now()},vve=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var i=0,r=t;i<r.length;i++){var o=r[i];null===(e=o._group)||void 0===e||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=e;n<i.length;n++){var r=i[n];r._group=void 0,delete this._tweens[r.getId()],delete this._tweensAddedDuringUpdate[r.getId()]}},e.prototype.allStopped=function(){return this.getAll().every((function(e){return!e.isPlaying()}))},e.prototype.update=function(e,t){void 0===e&&(e=gve()),void 0===t&&(t=!0);var n=Object.keys(this._tweens);if(0!==n.length)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]],o=!t;r&&!1===r.update(e,o)&&!t&&this.remove(r)}n=Object.keys(this._tweensAddedDuringUpdate)}},e}(),yve={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=yve.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[n],e[n-1],n-i):o(e[r],e[r+1>n?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,o=yve.Utils.Bernstein,s=0;s<=i;s++)n+=r(1-t,i-s)*r(t,s)*e[s]*o(i,s);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=yve.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),o(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):o(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=yve.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var i=t;i>1;i--)n*=i;return e[t]=n,n}}(),CatmullRom:function(e,t,n,i,r){var o=.5*(n-e),s=.5*(i-t),a=r*r;return(2*t-2*n+o+s)*(r*a)+(-3*t+3*n-2*o-s)*a+o*r+t}}},Ave=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),xve=new vve,bve=function(){function e(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=mve.Linear.None,this._interpolationFunction=yve.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Ave.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,"object"===typeof t?(this._group=t,t.add(this)):!0===t&&(this._group=xve,xve.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,t){if(void 0===t&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,t){if(void 0===e&&(e=gve()),void 0===t&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var n in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var r in this._valuesEnd)i[r]=this._valuesEnd[r];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,t,n,i,r){for(var o in n){var s=e[o],a=Array.isArray(s),l=a?"array":typeof s,c=!a&&Array.isArray(n[o]);if("undefined"!==l&&"function"!==l){if(c){if(0===(g=n[o]).length)continue;for(var u=[s],h=0,d=g.length;h<d;h+=1){var p=this._handleRelativeValue(s,g[h]);if(isNaN(p)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}u.push(p)}c&&(n[o]=u)}if("object"!==l&&!a||!s||c)("undefined"===typeof t[o]||r)&&(t[o]=s),a||(t[o]*=1),i[o]=c?n[o].slice().reverse():t[o]||0;else{t[o]=a?[]:{};var f=s;for(var m in f)t[o][m]=f[m];i[o]=a?[]:{};var g=n[o];if(!this._isDynamic){var v={};for(var m in g)v[m]=g[m];n[o]=g=v}this._setupProperties(f,t[o],g,i[o],r)}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(e){return void 0===e&&(e=gve()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e),this},e.prototype.resume=function(e){return void 0===e&&(e=gve()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var e;return null===(e=this._group)||void 0===e||e.remove(this),this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=mve.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=yve.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(t,n){var i,r,o=this;if(void 0===t&&(t=gve()),void 0===n&&(n=e.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!n)return!1;this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var s=t-this._startTime,a=this._duration+(null!==(i=this._repeatDelayTime)&&void 0!==i?i:this._delayTime),l=this._duration+this._repeat*a,c=function(){if(0===o._duration)return 1;if(s>l)return 1;var e=Math.trunc(s/a),t=s-e*a,n=Math.min(t/o._duration,1);return 0===n&&s===o._duration?1:n}(),u=this._easingFunction(c);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,u),this._onUpdateCallback&&this._onUpdateCallback(this._object,c),0===this._duration||s>=this._duration){if(this._repeat>0){var h=Math.min(Math.trunc((s-this._duration)/a)+1,this._repeat);for(r in isFinite(this._repeat)&&(this._repeat-=h),this._valuesStartRepeat)this._yoyo||"string"!==typeof this._valuesEnd[r]||(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*h,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var d=0,p=this._chainedTweens.length;d<p;d++)this._chainedTweens[d].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,i){for(var r in n)if(void 0!==t[r]){var o=t[r]||0,s=n[r],a=Array.isArray(e[r]),l=Array.isArray(s);!a&&l?e[r]=this._interpolationFunction(s,i):"object"===typeof s&&s?this._updateProperties(e[r],o,s,i):"number"===typeof(s=this._handleRelativeValue(o,s))&&(e[r]=o+(s-o)*i)}},e.prototype._handleRelativeValue=function(e,t){return"string"!==typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];this._valuesStartRepeat[e]="string"===typeof n?this._valuesStartRepeat[e]+parseFloat(n):this._valuesEnd[e],this._valuesEnd[e]=t},e.autoStartOnUpdate=!1,e}(),_ve=(Ave.nextId,xve),wve=(_ve.getAll.bind(_ve),_ve.removeAll.bind(_ve),_ve.add.bind(_ve),_ve.remove.bind(_ve),_ve.update.bind(_ve),{}),Eve=[],Sve=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Cve=Array.isArray;function Mve(e,t){for(var n in t)e[n]=t[n];return e}function Tve(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Rve(e,t,n,i,r){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==r?++ove:r,__i:-1,__u:0};return null==r&&null!=rve.vnode&&rve.vnode(o),o}function Ive(e){return e.children}function Pve(e,t){this.props=e,this.context=t}function Bve(e,t){if(null==t)return e.__?Bve(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Bve(e):null}function Lve(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return Lve(e)}}function Nve(e){(!e.__d&&(e.__d=!0)&&ave.push(e)&&!Dve.__r++||lve!==rve.debounceRendering)&&((lve=rve.debounceRendering)||cve)(Dve)}function Dve(){for(var e,t,n,i,r,o,s,a=1;ave.length;)ave.length>a&&ave.sort(uve),e=ave.shift(),a=ave.length,e.__d&&(n=void 0,r=(i=(t=e).__v).__e,o=[],s=[],t.__P&&((n=Mve({},i)).__v=i.__v+1,rve.vnode&&rve.vnode(n),Vve(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[r]:null,o,null==r?Bve(i):r,!!(32&i.__u),s),n.__v=i.__v,n.__.__k[n.__i]=n,Gve(o,n,s),n.__e!=r&&Lve(n)));Dve.__r=0}function kve(e,t,n,i,r,o,s,a,l,c,u){var h,d,p,f,m,g,v=i&&i.__k||Eve,y=t.length;for(l=function(e,t,n,i,r){var o,s,a,l,c,u=n.length,h=u,d=0;for(e.__k=new Array(r),o=0;o<r;o++)null!=(s=t[o])&&"boolean"!=typeof s&&"function"!=typeof s?(l=o+d,(s=e.__k[o]="string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?Rve(null,s,null,null,null):Cve(s)?Rve(Ive,{children:s},null,null,null):void 0===s.constructor&&s.__b>0?Rve(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=e,s.__b=e.__b+1,a=null,-1!==(c=s.__i=Uve(s,n,l,h))&&(h--,(a=n[c])&&(a.__u|=2)),null==a||null===a.__v?(-1==c&&(r>u?d--:r<u&&d++),"function"!=typeof s.type&&(s.__u|=4)):c!=l&&(c==l-1?d--:c==l+1?d++:(c>l?d--:d++,s.__u|=4))):e.__k[o]=null;if(h)for(o=0;o<u;o++)null!=(a=n[o])&&0==(2&a.__u)&&(a.__e==i&&(i=Bve(a)),Qve(a,a));return i}(n,t,v,l,y),h=0;h<y;h++)null!=(p=n.__k[h])&&(d=-1===p.__i?wve:v[p.__i]||wve,p.__i=h,g=Vve(e,p,d,r,o,s,a,l,c,u),f=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&Wve(d.ref,null,p),u.push(p.ref,p.__c||f,p)),null==m&&null!=f&&(m=f),4&p.__u||d.__k===p.__k?l=Ove(p,l,e):"function"==typeof p.type&&void 0!==g?l=g:f&&(l=f.nextSibling),p.__u&=-7);return n.__e=m,l}function Ove(e,t,n){var i,r;if("function"==typeof e.type){for(i=e.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=e,t=Ove(i[r],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=Bve(e)),n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function Uve(e,t,n,i){var r,o,s=e.key,a=e.type,l=t[n];if(null===l&&null==e.key||l&&s==l.key&&a===l.type&&0==(2&l.__u))return n;if(i>(null!=l&&0==(2&l.__u)?1:0))for(r=n-1,o=n+1;r>=0||o<t.length;){if(r>=0){if((l=t[r])&&0==(2&l.__u)&&s==l.key&&a===l.type)return r;r--}if(o<t.length){if((l=t[o])&&0==(2&l.__u)&&s==l.key&&a===l.type)return o;o++}}return-1}function Fve(e,t,n){"-"==t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||Sve.test(t)?n:n+"px"}function zve(e,t,n,i,r){var o;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||Fve(e.style,t,"");if(n)for(t in n)i&&n[t]===i[t]||Fve(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])o=t!=(t=t.replace(hve,"$1")),t=t.toLowerCase()in e||"onFocusOut"==t||"onFocusIn"==t?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.t=i.t:(n.t=dve,e.addEventListener(t,o?fve:pve,o)):e.removeEventListener(t,o?fve:pve,o);else{if("http://www.w3.org/2000/svg"==r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function jve(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.u)t.u=dve++;else if(t.u<n.t)return;return n(rve.event?rve.event(t):t)}}}function Vve(e,t,n,i,r,o,s,a,l,c){var u,h,d,p,f,m,g,v,y,A,x,b,_,w,E,S,C,M=t.type;if(void 0!==t.constructor)return null;128&n.__u&&(l=!!(32&n.__u),o=[a=t.__e=n.__e]),(u=rve.__b)&&u(t);e:if("function"==typeof M)try{if(v=t.props,y="prototype"in M&&M.prototype.render,A=(u=M.contextType)&&i[u.__c],x=u?A?A.props.value:u.__:i,n.__c?g=(h=t.__c=n.__c).__=h.__E:(y?t.__c=h=new M(v,x):(t.__c=h=new Pve(v,x),h.constructor=M,h.render=qve),A&&A.sub(h),h.props=v,h.state||(h.state={}),h.context=x,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),y&&null==h.__s&&(h.__s=h.state),y&&null!=M.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=Mve({},h.__s)),Mve(h.__s,M.getDerivedStateFromProps(v,h.__s))),p=h.props,f=h.state,h.__v=t,d)y&&null==M.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),y&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(y&&null==M.getDerivedStateFromProps&&v!==p&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(v,x),!h.__e&&(null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(v,h.__s,x)||t.__v==n.__v)){for(t.__v!=n.__v&&(h.props=v,h.state=h.__s,h.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some((function(e){e&&(e.__=t)})),b=0;b<h._sb.length;b++)h.__h.push(h._sb[b]);h._sb=[],h.__h.length&&s.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(v,h.__s,x),y&&null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(p,f,m)}))}if(h.context=x,h.props=v,h.__P=e,h.__e=!1,_=rve.__r,w=0,y){for(h.state=h.__s,h.__d=!1,_&&_(t),u=h.render(h.props,h.state,h.context),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[]}else do{h.__d=!1,_&&_(t),u=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++w<25);h.state=h.__s,null!=h.getChildContext&&(i=Mve(Mve({},i),h.getChildContext())),y&&!d&&null!=h.getSnapshotBeforeUpdate&&(m=h.getSnapshotBeforeUpdate(p,f)),S=u,null!=u&&u.type===Ive&&null==u.key&&(S=Hve(u.props.children)),a=kve(e,Cve(S)?S:[S],t,n,i,r,o,s,a,l,c),h.base=t.__e,t.__u&=-161,h.__h.length&&s.push(h),g&&(h.__E=h.__=null)}catch(e){if(t.__v=null,l||null!=o)if(e.then){for(t.__u|=l?160:128;a&&8==a.nodeType&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,t.__e=a}else for(C=o.length;C--;)Tve(o[C]);else t.__e=n.__e,t.__k=n.__k;rve.__e(e,t,n)}else null==o&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):a=t.__e=function(e,t,n,i,r,o,s,a,l){var c,u,h,d,p,f,m,g=n.props,v=t.props,y=t.type;if("svg"==y?r="http://www.w3.org/2000/svg":"math"==y?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),null!=o)for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!y&&(y?p.localName==y:3==p.nodeType)){e=p,o[c]=null;break}if(null==e){if(null==y)return document.createTextNode(v);e=document.createElementNS(r,y,v.is&&v),a&&(rve.__m&&rve.__m(t,o),a=!1),o=null}if(null===y)g===v||a&&e.data===v||(e.data=v);else{if(o=o&&ive.call(e.childNodes),g=n.props||wve,!a&&null!=o)for(g={},c=0;c<e.attributes.length;c++)g[(p=e.attributes[c]).name]=p.value;for(c in g)if(p=g[c],"children"==c);else if("dangerouslySetInnerHTML"==c)h=p;else if(!(c in v)){if("value"==c&&"defaultValue"in v||"checked"==c&&"defaultChecked"in v)continue;zve(e,c,null,p,r)}for(c in v)p=v[c],"children"==c?d=p:"dangerouslySetInnerHTML"==c?u=p:"value"==c?f=p:"checked"==c?m=p:a&&"function"!=typeof p||g[c]===p||zve(e,c,p,g[c],r);if(u)a||h&&(u.__html===h.__html||u.__html===e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(h&&(e.innerHTML=""),kve("template"===t.type?e.content:e,Cve(d)?d:[d],t,n,i,"foreignObject"==y?"http://www.w3.org/1999/xhtml":r,o,s,o?o[0]:n.__k&&Bve(n,0),a,l),null!=o)for(c=o.length;c--;)Tve(o[c]);a||(c="value","progress"==y&&null==f?e.removeAttribute("value"):void 0!==f&&(f!==e[c]||"progress"==y&&!f||"option"==y&&f!==g[c])&&zve(e,c,f,g[c],r),c="checked",void 0!==m&&m!==e[c]&&zve(e,c,m,g[c],r))}return e}(n.__e,t,n,i,r,o,s,l,c);return(u=rve.diffed)&&u(t),128&t.__u?void 0:a}function Gve(e,t,n){for(var i=0;i<n.length;i++)Wve(n[i],n[++i],n[++i]);rve.__c&&rve.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){rve.__e(e,t.__v)}}))}function Hve(e){return"object"!=typeof e||null==e?e:Cve(e)?e.map(Hve):Mve({},e)}function Wve(e,t,n){try{if("function"==typeof e){var i="function"==typeof e.__u;i&&e.__u(),i&&null==t||(e.__u=e(t))}else e.current=t}catch(e){rve.__e(e,n)}}function Qve(e,t,n){var i,r;if(rve.unmount&&rve.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||Wve(i,null,t)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){rve.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&Qve(i[r],t,n||"function"!=typeof e.type);n||Tve(e.__e),e.__c=e.__=e.__e=void 0}function qve(e,t,n){return this.constructor(e,n)}function Xve(e,t,n){var i,r,o,s;t==document&&(t=document.documentElement),rve.__&&rve.__(e,t),r=(i="function"==typeof n)?null:n&&n.__k||t.__k,o=[],s=[],Vve(t,e=(!i&&n||t).__k=function(e,t,n){var i,r,o,s={};for(o in t)"key"==o?i=t[o]:"ref"==o?r=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?ive.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===s[o]&&(s[o]=e.defaultProps[o]);return Rve(e,s,i,r,null)}(Ive,null,[e]),r||wve,wve,t.namespaceURI,!i&&n?[n]:r?null:t.firstChild?ive.call(t.childNodes):null,o,!i&&n?n:r?r.__e:t.firstChild,i,s),Gve(o,e,s)}function $ve(e,t,n){var i,r,o,s,a=Mve({},e.props);for(o in e.type&&e.type.defaultProps&&(s=e.type.defaultProps),t)"key"==o?i=t[o]:"ref"==o?r=t[o]:a[o]=void 0===t[o]&&void 0!==s?s[o]:t[o];return arguments.length>2&&(a.children=arguments.length>3?ive.call(arguments,2):n),Rve(e.type,a,i||e.key,r||e.ref,null)}function Yve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Kve(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Zve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Yve(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yve(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eye(e){return eye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eye(e)}ive=Eve.slice,rve={__e:function(e,t,n,i){for(var r,o,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,i||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},ove=0,sve=function(e){return null!=e&&null==e.constructor},Pve.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Mve({},this.state),"function"==typeof e&&(e=e(Mve({},n),this.props)),e&&Mve(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),Nve(this))},Pve.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Nve(this))},Pve.prototype.render=Ive,ave=[],cve="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,uve=function(e,t){return e.__v.__b-t.__v.__b},Dve.__r=0,hve=/(PointerCapture)$|Capture$/i,dve=0,pve=jve(!1),fve=jve(!0);var tye=function(e){if("object"!==eye(e))return e;var t,n=$ve(e);n.props&&(n.props=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jve(Object(n),!0).forEach((function(t){Kve(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.props),null!==n&&void 0!==n&&null!==(t=n.props)&&void 0!==t&&t.children&&(n.props.children=Array.isArray(n.props.children)?n.props.children.map(tye):tye(n.props.children)));return n};!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var nye=V1({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).style,i=void 0===n?{}:n,r=dw(!!e&&"object"===eye(e)&&!!e.node&&"function"===typeof e.node?e.node():e);"static"===r.style("position")&&r.style("position","relative"),t.tooltipEl=r.append("div").attr("class","float-tooltip-kap"),Object.entries(i).forEach((function(e){var n=Zve(e,2),i=n[0],r=n[1];return t.tooltipEl.style(i,r)})),t.tooltipEl.style("left","-10000px").style("display","none");var o="tooltip-".concat(Math.round(1e12*Math.random()));t.mouseInside=!1,r.on("mousemove.".concat(o),(function(e){t.mouseInside=!0;var n=Mw(e),i=r.node(),o=i.offsetWidth,s=i.offsetHeight,a=[null===t.offsetX||void 0===t.offsetX?"-".concat(n[0]/o*100,"%"):"number"===typeof t.offsetX?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,null===t.offsetY||void 0===t.offsetY?s>130&&s-n[1]<100?"calc(-100% - 6px)":"21px":"number"===typeof t.offsetY?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",n[0]+"px").style("top",n[1]+"px").style("transform","translate(".concat(a.join(","),")")),t.content&&t.tooltipEl.style("display","inline")})),r.on("mouseover.".concat(o),(function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")})),r.on("mouseout.".concat(o),(function(){t.mouseInside=!1,t.tooltipEl.style("display","none")}))},update:function(e){var t,n,i;e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append((function(){return e.content}))):"string"===typeof e.content?e.tooltipEl.html(e.content):(i=e.content,sve($ve(i))?(e.tooltipEl.text(""),t=e.content,delete(n=e.tooltipEl.node()).__k,Xve(tye(t),n)):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString()))):e.tooltipEl.text("")}});function iye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function rye(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||aye(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sye(e){return function(e){if(Array.isArray(e))return iye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||aye(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aye(e,t){if(e){if("string"==typeof e)return iye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?iye(e,t):void 0}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".scene-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var lye=window.THREE?window.THREE:{WebGLRenderer:class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=(0,x0.lPF)(),context:n=null,depth:i=!0,stencil:r=!1,alpha:o=!1,antialias:s=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:h=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!==typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=o;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=x0.er$,this.toneMapping=x0.y_p,this.toneMappingExposure=1;const A=this;let x=!1,b=0,_=0,w=null,E=-1,S=null;const C=new x0.IUQ,M=new x0.IUQ;let T=null;const R=new x0.Q1f(0);let I=0,P=t.width,B=t.height,L=1,N=null,D=null;const k=new x0.IUQ(0,0,P,B),O=new x0.IUQ(0,0,P,B);let U=!1;const F=new x0.PPD;let z=!1,j=!1;this.transmissionResolutionScale=1;const V=new x0.kn4,G=new x0.kn4,H=new x0.Pq0,W=new x0.IUQ,Q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function X(){return null===w?L:1}let $,Y,K,J,Z,ee,te,ne,ie,re,oe,se,ae,le,ce,ue,he,de,pe,fe,me,ge,ve,ye,Ae=n;function xe(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${x0.sPf}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Ee,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===Ae){const t="webgl2";if(Ae=xe(t,e),null===Ae)throw xe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Ge){throw console.error("THREE.WebGLRenderer: "+Ge.message),Ge}function be(){$=new U5(Ae),$.init(),ge=new N8(Ae,$),Y=new g5(Ae,$,e,ge),K=new B8(Ae,$),Y.reverseDepthBuffer&&h&&K.buffers.depth.setReversed(!0),J=new j5(Ae),Z=new A8,ee=new L8(Ae,$,K,Z,Y,ge,J),te=new y5(A),ne=new O5(A),ie=new s5(Ae),ve=new f5(Ae,ie),re=new F5(Ae,ie,J,ve),oe=new G5(Ae,re,ie,J),pe=new V5(Ae,Y,ee),ue=new v5(Z),se=new y8(A,te,ne,$,Y,ve,ue),ae=new F8(A,Z),le=new w8,ce=new R8($),de=new p5(A,te,ne,K,oe,d,a),he=new I8(A,oe,Y),ye=new z8(Ae,J,Y,K),fe=new m5(Ae,$,J),me=new z5(Ae,$,J),J.programs=se.programs,A.capabilities=Y,A.extensions=$,A.properties=Z,A.renderLists=le,A.shadowMap=he,A.state=K,A.info=J}be();const _e=new k8(A,Ae);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Ee(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=J.autoReset,t=he.enabled,n=he.autoUpdate,i=he.needsUpdate,r=he.type;be(),J.autoReset=e,he.enabled=t,he.autoUpdate=n,he.needsUpdate=i,he.type=r}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ce(e){const t=e.target;t.removeEventListener("dispose",Ce),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&(t.forEach((function(e){se.releaseProgram(e)})),e.isShaderMaterial&&se.releaseShaderCache(e))})(e),Z.remove(e)}(t)}function Me(e,t,n){!0===e.transparent&&e.side===x0.$EB&&!1===e.forceSinglePass?(e.side=x0.hsX,e.needsUpdate=!0,Oe(e,t,n),e.side=x0.hB5,e.needsUpdate=!0,Oe(e,t,n),e.side=x0.$EB):Oe(e,t,n)}this.xr=_e,this.getContext=function(){return Ae},this.getContextAttributes=function(){return Ae.getContextAttributes()},this.forceContextLoss=function(){const e=$.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=$.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(P,B,!1))},this.getSize=function(e){return e.set(P,B)},this.setSize=function(e,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];_e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=e,B=n,t.width=Math.floor(e*L),t.height=Math.floor(n*L),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(P*L,B*L).floor()},this.setDrawingBufferSize=function(e,n,i){P=e,B=n,L=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(C)},this.getViewport=function(e){return e.copy(k)},this.setViewport=function(e,t,n,i){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,n,i),K.viewport(C.copy(k).multiplyScalar(L).round())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),K.scissor(M.copy(O).multiplyScalar(L).round())},this.getScissorTest=function(){return U},this.setScissorTest=function(e){K.setScissorTest(U=e)},this.setOpaqueSort=function(e){N=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor(...arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha(...arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==w){const t=w.texture.format;e=t===x0.c90||t===x0.TkQ||t===x0.ZQM}if(e){const e=w.texture.type,t=e===x0.OUM||e===x0.bkx||e===x0.cHt||e===x0.V3x||e===x0.Wew||e===x0.gJ2,n=de.getClearColor(),i=de.getClearAlpha(),r=n.r,o=n.g,s=n.b;t?(p[0]=r,p[1]=o,p[2]=s,p[3]=i,Ae.clearBufferuiv(Ae.COLOR,0,p)):(f[0]=r,f[1]=o,f[2]=s,f[3]=i,Ae.clearBufferiv(Ae.COLOR,0,f))}else n|=Ae.COLOR_BUFFER_BIT}e&&(n|=Ae.DEPTH_BUFFER_BIT),t&&(n|=Ae.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ae.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Ee,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),de.dispose(),le.dispose(),ce.dispose(),Z.dispose(),te.dispose(),ne.dispose(),oe.dispose(),ve.dispose(),ye.dispose(),se.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Re),_e.removeEventListener("sessionend",Ie),Pe.stop()},this.renderBufferDirect=function(e,t,n,i,r,o){null===t&&(t=Q);const s=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,n,i,r){!0!==t.isScene&&(t=Q);ee.resetTextureUnits();const o=t.fog,s=i.isMeshStandardMaterial?t.environment:null,a=null===w?A.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:x0.Zr2,l=(i.isMeshStandardMaterial?ne:te).get(i.envMap||s),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=x0.y_p;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=A.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,y=Z.get(i),x=g.state.lights;if(!0===z&&(!0===j||e!==S)){const t=e===S&&i.id===E;ue.setState(i,e,t)}let b=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==x.state.version||y.outputColorSpace!==a||r.isBatchedMesh&&!1===y.batching?b=!0:r.isBatchedMesh||!0!==y.batching?r.isBatchedMesh&&!0===y.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===y.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===y.instancing?b=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?b=!0:r.isSkinnedMesh||!0!==y.skinning?r.isInstancedMesh&&!0===y.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===y.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===y.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===y.instancingMorph&&null!==r.morphTexture||y.envMap!==l||!0===i.fog&&y.fog!==o?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ue.numPlanes&&y.numIntersection===ue.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==u||y.morphTargets!==h||y.morphNormals!==d||y.morphColors!==p||y.toneMapping!==f||y.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,y.__version=i.version);let _=y.currentProgram;!0===b&&(_=Oe(i,t,r));let C=!1,M=!1,T=!1;const R=_.getUniforms(),I=y.uniforms;K.useProgram(_.program)&&(C=!0,M=!0,T=!0);i.id!==E&&(E=i.id,M=!0);if(C||S!==e){K.buffers.depth.getReversed()?(V.copy(e.projectionMatrix),(0,x0.xiE)(V),(0,x0.Mmk)(V),R.setValue(Ae,"projectionMatrix",V)):R.setValue(Ae,"projectionMatrix",e.projectionMatrix),R.setValue(Ae,"viewMatrix",e.matrixWorldInverse);const t=R.map.cameraPosition;void 0!==t&&t.setValue(Ae,H.setFromMatrixPosition(e.matrixWorld)),Y.logarithmicDepthBuffer&&R.setValue(Ae,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(Ae,"isOrthographic",!0===e.isOrthographicCamera),S!==e&&(S=e,M=!0,T=!0)}if(r.isSkinnedMesh){R.setOptional(Ae,r,"bindMatrix"),R.setOptional(Ae,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(Ae,"boneTexture",e.boneTexture,ee))}r.isBatchedMesh&&(R.setOptional(Ae,r,"batchingTexture"),R.setValue(Ae,"batchingTexture",r._matricesTexture,ee),R.setOptional(Ae,r,"batchingIdTexture"),R.setValue(Ae,"batchingIdTexture",r._indirectTexture,ee),R.setOptional(Ae,r,"batchingColorTexture"),null!==r._colorsTexture&&R.setValue(Ae,"batchingColorTexture",r._colorsTexture,ee));const P=n.morphAttributes;void 0===P.position&&void 0===P.normal&&void 0===P.color||pe.update(r,n,_);(M||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,R.setValue(Ae,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(I.envMapIntensity.value=t.environmentIntensity);M&&(R.setValue(Ae,"toneMappingExposure",A.toneMappingExposure),y.needsLights&&(D=T,(N=I).ambientLightColor.needsUpdate=D,N.lightProbe.needsUpdate=D,N.directionalLights.needsUpdate=D,N.directionalLightShadows.needsUpdate=D,N.pointLights.needsUpdate=D,N.pointLightShadows.needsUpdate=D,N.spotLights.needsUpdate=D,N.spotLightShadows.needsUpdate=D,N.rectAreaLights.needsUpdate=D,N.hemisphereLights.needsUpdate=D),o&&!0===i.fog&&ae.refreshFogUniforms(I,o),ae.refreshMaterialUniforms(I,i,L,B,g.state.transmissionRenderTarget[e.id]),X6.upload(Ae,Ue(y),I,ee));var N,D;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(X6.upload(Ae,Ue(y),I,ee),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&R.setValue(Ae,"center",r.center);if(R.setValue(Ae,"modelViewMatrix",r.modelViewMatrix),R.setValue(Ae,"normalMatrix",r.normalMatrix),R.setValue(Ae,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ye.update(n,_),ye.bind(n,_)}}return _}(e,t,n,i,r);K.setMaterial(i,s);let l=n.index,c=1;if(!0===i.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==o&&(d=Math.max(d,o.start*c),p=Math.min(p,(o.start+o.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):void 0!==h&&null!==h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;ve.setup(r,i,a,n,l);let v=fe;if(null!==l&&(m=ie.get(l),v=me,v.setIndex(m)),r.isMesh)!0===i.wireframe?(K.setLineWidth(i.wireframeLinewidth*X()),v.setMode(Ae.LINES)):v.setMode(Ae.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),K.setLineWidth(e*X()),r.isLineSegments?v.setMode(Ae.LINES):r.isLineLoop?v.setMode(Ae.LINE_LOOP):v.setMode(Ae.LINE_STRIP)}else r.isPoints?v.setMode(Ae.POINTS):r.isSprite&&v.setMode(Ae.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)(0,x0.mcG)("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if($.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,o=l?ie.get(l).bytesPerElement:1,s=Z.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)s.setValue(Ae,"_gl_DrawID",i),v.render(e[i]/o,t[i])}else if(r.isInstancedMesh)v.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,f,t)}else v.render(d,f)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),g=ce.get(n),g.init(t),y.push(g),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights();const i=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const o=t[r];Me(o,n,e),i.add(o)}else Me(t,n,e),i.add(t)})),g=y.pop(),i},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){Z.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==$.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Te=null;function Re(){Pe.stop()}function Ie(){Pe.start()}const Pe=new o5;function Be(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||F.intersectsSprite(e)){i&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(G);const t=oe.update(e),r=e.material;r.visible&&m.push(e,t,r,n,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||F.intersectsObject(e))){const t=oe.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)),W.applyMatrix4(e.matrixWorld).applyMatrix4(G)),Array.isArray(r)){const i=t.groups;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r[s.materialIndex];a&&a.visible&&m.push(e,t,a,n,W.z,s)}}else r.visible&&m.push(e,t,r,n,W.z,null)}const r=e.children;for(let o=0,s=r.length;o<s;o++)Be(r[o],t,n,i)}function Le(e,t,n,i){const r=e.opaque,o=e.transmissive,s=e.transparent;g.setupLightsView(n),!0===z&&ue.setGlobalState(A.clippingPlanes,n),i&&K.viewport(C.copy(i)),r.length>0&&De(r,t,n),o.length>0&&De(o,t,n),s.length>0&&De(s,t,n),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function Ne(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[i.id]&&(g.state.transmissionRenderTarget[i.id]=new x0.nWS(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")||$.has("EXT_color_buffer_float")?x0.ix0:x0.OUM,minFilter:x0.$_I,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:x0.ppV.workingColorSpace}));const o=g.state.transmissionRenderTarget[i.id],s=i.viewport||C;o.setSize(s.z*A.transmissionResolutionScale,s.w*A.transmissionResolutionScale);const a=A.getRenderTarget();A.setRenderTarget(o),A.getClearColor(R),I=A.getClearAlpha(),I<1&&A.setClearColor(16777215,.5),A.clear(),q&&de.render(n);const l=A.toneMapping;A.toneMapping=x0.y_p;const c=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),g.setupLightsView(i),!0===z&&ue.setGlobalState(A.clippingPlanes,i),De(e,n,i),ee.updateMultisampleRenderTarget(o),ee.updateRenderTargetMipmap(o),!1===$.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,o=t.length;r<o;r++){const o=t[r],s=o.object,a=o.geometry,l=o.material,c=o.group;if(l.side===x0.$EB&&s.layers.test(i.layers)){const t=l.side;l.side=x0.hsX,l.needsUpdate=!0,ke(s,n,i,a,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(ee.updateMultisampleRenderTarget(o),ee.updateRenderTargetMipmap(o))}A.setRenderTarget(a),A.setClearColor(R,I),void 0!==c&&(i.viewport=c),A.toneMapping=l}function De(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,o=e.length;r<o;r++){const o=e[r],s=o.object,a=o.geometry,l=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&ke(s,t,n,a,l,c)}}function ke(e,t,n,i,r,o){e.onBeforeRender(A,t,n,i,r,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(A,t,n,i,e,o),!0===r.transparent&&r.side===x0.$EB&&!1===r.forceSinglePass?(r.side=x0.hsX,r.needsUpdate=!0,A.renderBufferDirect(n,t,i,r,e,o),r.side=x0.hB5,r.needsUpdate=!0,A.renderBufferDirect(n,t,i,r,e,o),r.side=x0.$EB):A.renderBufferDirect(n,t,i,r,e,o),e.onAfterRender(A,t,n,i,r,o)}function Oe(e,t,n){!0!==t.isScene&&(t=Q);const i=Z.get(e),r=g.state.lights,o=g.state.shadowsArray,s=r.state.version,a=se.getParameters(e,r.state,o,t,n),l=se.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ne:te).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ce),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===s)return Fe(e,a),u}else a.uniforms=se.getUniforms(e),e.onBeforeCompile(a,A),u=se.acquireProgram(a,l),c.set(l,u),i.uniforms=a.uniforms;const h=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ue.uniform),Fe(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Ue(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=X6.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Fe(e,t){const n=Z.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Pe.setAnimationLoop((function(e){Te&&Te(e)})),"undefined"!==typeof self&&Pe.setContext(self),this.setAnimationLoop=function(e){Te=e,_e.setAnimationLoop(e),null===e?Pe.stop():Pe.start()},_e.addEventListener("sessionstart",Re),_e.addEventListener("sessionend",Ie),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(t),t=_e.getCamera()),!0===e.isScene&&e.onBeforeRender(A,e,t,w),g=ce.get(e,y.length),g.init(t),y.push(g),G.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),F.setFromProjectionMatrix(G),j=this.localClippingEnabled,z=ue.init(this.clippingPlanes,j),m=le.get(e,v.length),m.init(),v.push(m),!0===_e.enabled&&!0===_e.isPresenting){const e=A.xr.getDepthSensingMesh();null!==e&&Be(e,t,-1/0,A.sortObjects)}Be(e,t,0,A.sortObjects),m.finish(),!0===A.sortObjects&&m.sort(N,D),q=!1===_e.enabled||!1===_e.isPresenting||!1===_e.hasDepthSensing(),q&&de.addToRenderList(m,e),this.info.render.frame++,!0===z&&ue.beginShadows();const n=g.state.shadowsArray;he.render(n,e,t),!0===z&&ue.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=m.opaque,r=m.transmissive;if(g.setupLights(),t.isArrayCamera){const n=t.cameras;if(r.length>0)for(let t=0,o=n.length;t<o;t++){Ne(i,r,e,n[t])}q&&de.render(e);for(let t=0,i=n.length;t<i;t++){const i=n[t];Le(m,e,i,i.viewport)}}else r.length>0&&Ne(i,r,e,t),q&&de.render(e),Le(m,e,t);null!==w&&0===_&&(ee.updateMultisampleRenderTarget(w),ee.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(A,e,t),ve.resetDefaultState(),E=-1,S=null,y.pop(),y.length>0?(g=y[y.length-1],!0===z&&ue.setGlobalState(A.clippingPlanes,g.state.camera)):g=null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){Z.get(e.texture).__webglTexture=t,Z.get(e.depthTexture).__webglTexture=n;const i=Z.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===$.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=Z.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const ze=Ae.createFramebuffer();this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;w=e,b=t,_=n;let i=!0,r=null,o=!1,s=!1;if(e){const a=Z.get(e);if(void 0!==a.__useDefaultFramebuffer)K.bindFramebuffer(Ae.FRAMEBUFFER,null),i=!1;else if(void 0===a.__webglFramebuffer)ee.setupRenderTarget(e);else if(a.__hasExternalTextures)ee.rebindTextures(e,Z.get(e.texture).__webglTexture,Z.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(a.__boundDepthTexture!==t){if(null!==t&&Z.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ee.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],o=!0):r=e.samples>0&&!1===ee.useMultisampledRTT(e)?Z.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,C.copy(e.viewport),M.copy(e.scissor),T=e.scissorTest}else C.copy(k).multiplyScalar(L).floor(),M.copy(O).multiplyScalar(L).floor(),T=U;0!==n&&(r=ze);if(K.bindFramebuffer(Ae.FRAMEBUFFER,r)&&i&&K.drawBuffers(e,r),K.viewport(C),K.scissor(M),K.setScissorTest(T),o){const i=Z.get(e.texture);Ae.framebufferTexture2D(Ae.FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Ae.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(s){const i=Z.get(e.texture),r=t;Ae.framebufferTextureLayer(Ae.FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,i.__webglTexture,n,r)}else if(null!==e&&0!==n){const t=Z.get(e.texture);Ae.framebufferTexture2D(Ae.FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Ae.TEXTURE_2D,t.__webglTexture,n)}E=-1},this.readRenderTargetPixels=function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){K.bindFramebuffer(Ae.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,l=s.type;if(!Y.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&Ae.readPixels(t,n,i,r,ge.convert(a),ge.convert(l),o)}finally{const e=null!==w?Z.get(w).__webglFramebuffer:null;K.bindFramebuffer(Ae.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,o,s){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){const s=e.texture,l=s.format,c=s.type;if(!Y.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){K.bindFramebuffer(Ae.FRAMEBUFFER,a);const e=Ae.createBuffer();Ae.bindBuffer(Ae.PIXEL_PACK_BUFFER,e),Ae.bufferData(Ae.PIXEL_PACK_BUFFER,o.byteLength,Ae.STREAM_READ),Ae.readPixels(t,n,i,r,ge.convert(l),ge.convert(c),0);const s=null!==w?Z.get(w).__webglFramebuffer:null;K.bindFramebuffer(Ae.FRAMEBUFFER,s);const u=Ae.fenceSync(Ae.SYNC_GPU_COMMANDS_COMPLETE,0);return Ae.flush(),await(0,x0.jej)(Ae,u,4),Ae.bindBuffer(Ae.PIXEL_PACK_BUFFER,e),Ae.getBufferSubData(Ae.PIXEL_PACK_BUFFER,0,o),Ae.deleteBuffer(e),Ae.deleteSync(u),o}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!0!==e.isTexture&&((0,x0.mcG)("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),o=Math.floor(e.image.height*i),s=null!==t?t.x:0,a=null!==t?t.y:0;ee.setTexture2D(e,0),Ae.copyTexSubImage2D(Ae.TEXTURE_2D,n,0,0,s,a,r,o),K.unbindTexture()};const je=Ae.createFramebuffer(),Ve=Ae.createFramebuffer();this.copyTextureToTexture=function(e,t){let n,i,r,o,s,a,l,c,u,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;!0!==e.isTexture&&((0,x0.mcG)("WebGLRenderer: copyTextureToTexture function signature has changed."),d=arguments[0]||null,e=arguments[1],t=arguments[2],f=arguments[3]||0,h=null),null===f&&(0!==p?((0,x0.mcG)("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),f=p,p=0):f=0);const m=e.isCompressedTexture?e.mipmaps[f]:e.image;if(null!==h)n=h.max.x-h.min.x,i=h.max.y-h.min.y,r=h.isBox3?h.max.z-h.min.z:1,o=h.min.x,s=h.min.y,a=h.isBox3?h.min.z:0;else{const t=Math.pow(2,-p);n=Math.floor(m.width*t),i=Math.floor(m.height*t),r=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,o=0,s=0,a=0}null!==d?(l=d.x,c=d.y,u=d.z):(l=0,c=0,u=0);const g=ge.convert(t.format),v=ge.convert(t.type);let y;t.isData3DTexture?(ee.setTexture3D(t,0),y=Ae.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(ee.setTexture2DArray(t,0),y=Ae.TEXTURE_2D_ARRAY):(ee.setTexture2D(t,0),y=Ae.TEXTURE_2D),Ae.pixelStorei(Ae.UNPACK_FLIP_Y_WEBGL,t.flipY),Ae.pixelStorei(Ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Ae.pixelStorei(Ae.UNPACK_ALIGNMENT,t.unpackAlignment);const A=Ae.getParameter(Ae.UNPACK_ROW_LENGTH),x=Ae.getParameter(Ae.UNPACK_IMAGE_HEIGHT),b=Ae.getParameter(Ae.UNPACK_SKIP_PIXELS),_=Ae.getParameter(Ae.UNPACK_SKIP_ROWS),w=Ae.getParameter(Ae.UNPACK_SKIP_IMAGES);Ae.pixelStorei(Ae.UNPACK_ROW_LENGTH,m.width),Ae.pixelStorei(Ae.UNPACK_IMAGE_HEIGHT,m.height),Ae.pixelStorei(Ae.UNPACK_SKIP_PIXELS,o),Ae.pixelStorei(Ae.UNPACK_SKIP_ROWS,s),Ae.pixelStorei(Ae.UNPACK_SKIP_IMAGES,a);const E=e.isDataArrayTexture||e.isData3DTexture,S=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const h=Z.get(e),d=Z.get(t),m=Z.get(h.__renderTarget),g=Z.get(d.__renderTarget);K.bindFramebuffer(Ae.READ_FRAMEBUFFER,m.__webglFramebuffer),K.bindFramebuffer(Ae.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<r;v++)E&&(Ae.framebufferTextureLayer(Ae.READ_FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Z.get(e).__webglTexture,p,a+v),Ae.framebufferTextureLayer(Ae.DRAW_FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Z.get(t).__webglTexture,f,u+v)),Ae.blitFramebuffer(o,s,n,i,l,c,n,i,Ae.DEPTH_BUFFER_BIT,Ae.NEAREST);K.bindFramebuffer(Ae.READ_FRAMEBUFFER,null),K.bindFramebuffer(Ae.DRAW_FRAMEBUFFER,null)}else if(0!==p||e.isRenderTargetTexture||Z.has(e)){const h=Z.get(e),d=Z.get(t);K.bindFramebuffer(Ae.READ_FRAMEBUFFER,je),K.bindFramebuffer(Ae.DRAW_FRAMEBUFFER,Ve);for(let e=0;e<r;e++)E?Ae.framebufferTextureLayer(Ae.READ_FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,h.__webglTexture,p,a+e):Ae.framebufferTexture2D(Ae.READ_FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Ae.TEXTURE_2D,h.__webglTexture,p),S?Ae.framebufferTextureLayer(Ae.DRAW_FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,d.__webglTexture,f,u+e):Ae.framebufferTexture2D(Ae.DRAW_FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Ae.TEXTURE_2D,d.__webglTexture,f),0!==p?Ae.blitFramebuffer(o,s,n,i,l,c,n,i,Ae.COLOR_BUFFER_BIT,Ae.NEAREST):S?Ae.copyTexSubImage3D(y,f,l,c,u+e,o,s,n,i):Ae.copyTexSubImage2D(y,f,l,c,o,s,n,i);K.bindFramebuffer(Ae.READ_FRAMEBUFFER,null),K.bindFramebuffer(Ae.DRAW_FRAMEBUFFER,null)}else S?e.isDataTexture||e.isData3DTexture?Ae.texSubImage3D(y,f,l,c,u,n,i,r,g,v,m.data):t.isCompressedArrayTexture?Ae.compressedTexSubImage3D(y,f,l,c,u,n,i,r,g,m.data):Ae.texSubImage3D(y,f,l,c,u,n,i,r,g,v,m):e.isDataTexture?Ae.texSubImage2D(Ae.TEXTURE_2D,f,l,c,n,i,g,v,m.data):e.isCompressedTexture?Ae.compressedTexSubImage2D(Ae.TEXTURE_2D,f,l,c,m.width,m.height,g,m.data):Ae.texSubImage2D(Ae.TEXTURE_2D,f,l,c,n,i,g,v,m);Ae.pixelStorei(Ae.UNPACK_ROW_LENGTH,A),Ae.pixelStorei(Ae.UNPACK_IMAGE_HEIGHT,x),Ae.pixelStorei(Ae.UNPACK_SKIP_PIXELS,b),Ae.pixelStorei(Ae.UNPACK_SKIP_ROWS,_),Ae.pixelStorei(Ae.UNPACK_SKIP_IMAGES,w),0===f&&t.generateMipmaps&&Ae.generateMipmap(y),K.unbindTexture()},this.copyTextureToTexture3D=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!0!==e.isTexture&&((0,x0.mcG)("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0),(0,x0.mcG)('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,i,r)},this.initRenderTarget=function(e){void 0===Z.get(e).__webglFramebuffer&&ee.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?ee.setTextureCube(e,0):e.isData3DTexture?ee.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ee.setTexture2DArray(e,0):ee.setTexture2D(e,0),K.unbindTexture()},this.resetState=function(){b=0,_=0,w=null,K.reset(),ve.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return x0.TdN}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=x0.ppV._getDrawingBufferColorSpace(e),t.unpackColorSpace=x0.ppV._getUnpackColorSpace()}},Scene:x0.Z58,PerspectiveCamera:x0.ubm,Raycaster:x0.tBo,SRGBColorSpace:x0.er$,TextureLoader:x0.Tap,Vector2:x0.I9Y,Vector3:x0.Pq0,Box3:x0.NRn,Color:x0.Q1f,Mesh:x0.eaF,SphereGeometry:x0.Gu$,MeshBasicMaterial:x0.V9B,BackSide:x0.hsX,Clock:x0.zD7},cye=V1({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){if(e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach((function(t){return t.render(e.scene,e.camera)})),e.enablePointerInteraction){var t=null;if(e.hoverDuringDrag||!e.isPointerDragging){var n=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&n.sort((function(t,n){return e.hoverOrderComparator(t.object,n.object)}));var i=n.find((function(t){return e.hoverFilter(t.object)}))||null;t=i?i.object:null,e.intersection=i||null}t!==e.hoverObj&&(e.onHover(t,e.hoverObj,e.intersection),e.tooltip.content(t&&G1(e.tooltipContent)(t,e.intersection)||null),e.hoverObj=t)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos;return{x:t.x,y:t.y}},cameraPosition:function(e,t,n,i){var r=e.camera;if(t&&e.initialised){var o=t,s=n||{x:0,y:0,z:0};if(i){var a=Object.assign({},r.position),l=h();e.tweenGroup.add(new bve(a).to(o,i).easing(mve.Quadratic.Out).onUpdate(c).start()),e.tweenGroup.add(new bve(l).to(s,i/3).easing(mve.Quadratic.Out).onUpdate(u).start())}else c(o),u(s);return this}return Object.assign({},r.position,{lookAt:h()});function c(e){var t=e.x,n=e.y,i=e.z;void 0!==t&&(r.position.x=t),void 0!==n&&(r.position.y=n),void 0!==i&&(r.position.z=i)}function u(t){var n=new lye.Vector3(t.x,t.y,t.z);e.controls.target?e.controls.target=n:r.lookAt(n)}function h(){return Object.assign(new lye.Vector3(0,0,-1e3).applyQuaternion(r.quaternion).add(r.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length,r=new Array(i>3?i-3:0),o=3;o<i;o++)r[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,r),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,r=e.camera;if(t){var o=new lye.Vector3(0,0,0),s=2*Math.max.apply(Math,sye(Object.entries(t).map((function(e){var t=oye(e,2),n=t[0],i=t[1];return Math.max.apply(Math,sye(i.map((function(e){return Math.abs(o[n]-e)}))))})))),a=(1-2*i/e.height)*r.fov,l=s/Math.atan(a*Math.PI/180),c=l/r.aspect,u=Math.max(l,c);if(u>0){var h=o.clone().sub(r.position).normalize().multiplyScalar(-u);this.cameraPosition(h,o,n)}}return this},getBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=new lye.Box3(new lye.Vector3(0,0,0),new lye.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach((function(e){return n.expandByObject(e)})),Object.assign.apply(Object,sye(["x","y","z"].map((function(e){return rye({},e,[n.min[e],n.max[e]])}))))):null},getScreenCoords:function(e,t,n,i){var r=new lye.Vector3(t,n,i);return r.project(this.camera()),{x:(r.x+1)*e.width/2,y:-(r.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=new lye.Vector2(t/e.width*2-1,-n/e.height*2+1),o=new lye.Raycaster;return o.setFromCamera(r,e.camera),Object.assign({},o.ray.at(i,new lye.Vector3))},intersectingObjects:function(e,t,n){var i=new lye.Vector2(t/e.width*2-1,-n/e.height*2+1),r=new lye.Raycaster;return r.params.Line.threshold=e.lineHoverPrecision,r.params.Points.threshold=e.pointsHoverPrecision,r.setFromCamera(i,e.camera),r.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new lye.Scene,camera:new lye.PerspectiveCamera,clock:new lye.Clock,tweenGroup:new vve}},init:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.controlType,r=void 0===i?"trackball":i,o=n.useWebGPU,s=void 0!==o&&o,a=n.rendererConfig,l=void 0===a?{}:a,c=n.extraRenderers,u=void 0===c?[]:c,h=n.waitForLoadComplete,d=void 0===h||h;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[r]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new nye(t.container),t.pointerPos=new lye.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach((function(e){return t.container.addEventListener(e,(function(n){if("pointerdown"===e&&(t.isPointerPressed=!0),!t.isPointerDragging&&"pointermove"===n.type&&(n.pressure>0||t.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(e){return Math.abs(e)>1})))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var i=function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+i,left:t.left+n}}(t.container);t.pointerPos.x=n.pageX-i.left,t.pointerPos.y=n.pageY-i.top}}),{passive:!0})})),t.container.addEventListener("pointerup",(function(e){t.isPointerPressed=!1,t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag)||requestAnimationFrame((function(){0===e.button&&t.onClick(t.hoverObj||null,e,t.intersection),2===e.button&&t.onRightClick&&t.onRightClick(t.hoverObj||null,e,t.intersection)}))}),{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",(function(e){t.onRightClick&&e.preventDefault()})),t.renderer=new(s?wme:lye.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},l)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=u,t.extraRenderers.forEach((function(e){e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.pointerEvents="none",t.container.appendChild(e.domElement)})),t.postProcessingComposer=new tve(t.renderer),t.postProcessingComposer.addPass(new nve(t.scene,t.camera)),t.controls=new{trackball:Hme,orbit:_ge,fly:Uge}[r](t.camera,t.renderer.domElement),"fly"===r&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),"trackball"!==r&&"orbit"!==r||(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",(function(){t.controlsEngaged=!0})),t.controls.addEventListener("change",(function(){t.controlsEngaged&&(t.controlsDragging=!0)})),t.controls.addEventListener("end",(function(){t.controlsEngaged=!1,t.controlsDragging=!1}))),[t.renderer,t.postProcessingComposer].concat(sye(t.extraRenderers)).forEach((function(e){return e.setSize(t.width,t.height)})),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new lye.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!d,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,i=e.width,r=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(r,"px"),[e.renderer,e.postProcessingComposer].concat(sye(e.extraRenderers)).forEach((function(e){return e.setSize(i,r)})),e.camera.aspect=i/r;var o=e.viewOffset.slice(0,2);o.some((function(e){return e}))&&(n=e.camera).setViewOffset.apply(n,[i,r].concat(sye(o),[i,r])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var s,a=e.width,l=e.height,c=e.viewOffset.slice(0,2);c.some((function(e){return e}))?(s=e.camera).setViewOffset.apply(s,[a,l].concat(sye(c),[a,l])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=2.5*e.skyRadius,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new lye.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var u=n4(e.backgroundColor).alpha;void 0===u&&(u=1),e.renderer.setClearColor(new lye.Color(y4(1,e.backgroundColor)),u)}function h(){e.loadComplete=e.scene.visible=!0}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?(new lye.TextureLoader).load(e.backgroundImageUrl,(function(t){t.colorSpace=lye.SRGBColorSpace,e.skysphere.material=new lye.MeshBasicMaterial({map:t,side:lye.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&h()})):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&h())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach((function(t){return e.scene.remove(t)})),e.lights.forEach((function(t){return e.scene.add(t)}))),t.hasOwnProperty("objects")&&((t.objects||[]).forEach((function(t){return e.scene.remove(t)})),e.objects.forEach((function(t){return e.scene.add(t)})))}});function uye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function hye(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function pye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dye(Object(n),!0).forEach((function(t){hye(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fye(e){return function(e){if(Array.isArray(e))return uye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return uye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uye(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mye(e,t){var n=new t;return n._destructor&&n._destructor(),{linkProp:function(t){return{default:n[t](),onChange:function(n,i){i[e][t](n)},triggerUpdate:!1}},linkMethod:function(t){return function(n){for(var i=n[e],r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];var a=i[t].apply(i,o);return a===i?this:a}}}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".graph-info-msg {\n  top: 50%;\n  width: 100%;\n  text-align: center;\n  color: lavender;\n  opacity: 0.7;\n  font-size: 22px;\n  position: absolute;\n  font-family: Sans-serif;\n}\n\n.scene-container .clickable {\n  cursor: pointer;\n}\n\n.scene-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.scene-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}");var gye=window.THREE?window.THREE:{AmbientLight:x0.$p8,DirectionalLight:x0.ZyN,REVISION:x0.sPf},vye=mye("forceGraph",B3),yye=Object.assign.apply(Object,fye(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(e){return hye({},e,vye.linkProp(e))})))),Aye=Object.assign.apply(Object,fye(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map((function(e){return hye({},e,vye.linkMethod(e))})))),xye=mye("renderObjs",cye),bye=Object.assign.apply(Object,fye(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map((function(e){return hye({},e,xye.linkProp(e))})))),_ye=Object.assign.apply(Object,fye(["lights","cameraPosition","postProcessingComposer"].map((function(e){return hye({},e,xye.linkMethod(e))}))).concat([{graph2ScreenCoords:xye.linkMethod("getScreenCoords"),screen2GraphCoords:xye.linkMethod("getSceneCoords")}])),wye=V1({props:pye(pye({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var n=t.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},yye),bye),methods:pye(pye({zoomToFit:function(e,t,n){for(var i,r=arguments.length,o=new Array(r>3?r-3:0),s=3;s<r;s++)o[s-3]=arguments[s];return e.renderObjs.fitToBbox((i=e.forceGraph).getGraphBbox.apply(i,o),t,n),this},pauseAnimation:function(e){return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return null===e.animationFrameRequestId&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Aye),_ye),stateInit:function(e){var t=e.controlType,n=e.rendererConfig,i=e.extraRenderers,r=new B3;return{forceGraph:r,renderObjs:cye({controlType:t,rendererConfig:n,extraRenderers:i}).objects([r]).lights([new gye.AmbientLight(13421772,Math.PI),new gye.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n);var i,r=t.renderObjs.camera(),o=t.renderObjs.renderer(),s=t.renderObjs.controls();s.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=r.position.z,t.container.appendChild(i=document.createElement("div")),i.className="graph-info-msg",i.textContent="",t.forceGraph.onLoading((function(){i.textContent="Loading..."})).onFinishLoading((function(){i.textContent=""})).onUpdate((function(){t.graphData=t.forceGraph.graphData(),0===r.position.x&&0===r.position.y&&r.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(r.lookAt(t.forceGraph.position),t.lastSetCameraZ=r.position.z=170*Math.cbrt(t.graphData.nodes.length))})).onFinishUpdate((function(){if(t._dragControls){var e=t.graphData.nodes.find((function(e){return e.__initialFixedPos&&!e.__disposeControlsAfterDrag}));e?e.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&"d3"===t.forceEngine){var n=t._dragControls=new Z4(t.graphData.nodes.map((function(e){return e.__threeObj})).filter((function(e){return e})),r,o.domElement);n.addEventListener("dragstart",(function(e){var t=Eye(e.object);if(t){s.enabled=!1,e.object.__initialPos=e.object.position.clone(),e.object.__prevPos=e.object.position.clone();var n=t.__data;!n.__initialFixedPos&&(n.__initialFixedPos={fx:n.fx,fy:n.fy,fz:n.fz}),!n.__initialPos&&(n.__initialPos={x:n.x,y:n.y,z:n.z}),["x","y","z"].forEach((function(e){return n["f".concat(e)]=n[e]})),o.domElement.classList.add("grabbable")}})),n.addEventListener("drag",(function(e){var n=Eye(e.object);if(n){if(!e.object.hasOwnProperty("__graphObjType")){var i=e.object.__initialPos,r=e.object.__prevPos,o=e.object.position;n.position.add(o.clone().sub(r)),r.copy(o),o.copy(i)}var s=n.__data,a=n.position,l={x:a.x-s.x,y:a.y-s.y,z:a.z-s.z};["x","y","z"].forEach((function(e){return s["f".concat(e)]=s[e]=a[e]})),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),s.__dragged=!0,t.onNodeDrag(s,l)}})),n.addEventListener("dragend",(function(e){var i=Eye(e.object);if(i){delete e.object.__initialPos,delete e.object.__prevPos;var r=i.__data;r.__disposeControlsAfterDrag&&(n.dispose(),delete r.__disposeControlsAfterDrag);var a=r.__initialFixedPos,l=r.__initialPos,c={x:l.x-r.x,y:l.y-r.y,z:l.z-r.z};a&&(["x","y","z"].forEach((function(e){var t="f".concat(e);void 0===a[t]&&delete r[t]})),delete r.__initialFixedPos,delete r.__initialPos,r.__dragged&&(delete r.__dragged,t.onNodeDragEnd(r,c))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(s.enabled=!0,s.domElement&&s.domElement.ownerDocument&&s.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),o.domElement.classList.remove("grabbable")}}))}})),gye.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator((function(e,t){var n=Eye(e);if(!n)return 1;var i=Eye(t);if(!i)return-1;var r=function(e){return"node"===e.__graphObjType};return r(i)-r(n)})).tooltipContent((function(e){var n=Eye(e);return n&&G1(t["".concat(n.__graphObjType,"Label")])(n.__data)||""})).hoverDuringDrag(!1).onHover((function(e){var n=Eye(e);if(n!==t.hoverObj){var i=t.hoverObj?t.hoverObj.__graphObjType:null,r=t.hoverObj?t.hoverObj.__data:null,s=n?n.__graphObjType:null,a=n?n.__data:null;if(i&&i!==s){var l=t["on".concat("node"===i?"Node":"Link","Hover")];l&&l(null,r)}if(s){var c=t["on".concat("node"===s?"Node":"Link","Hover")];c&&c(a,i===s?r:null)}o.domElement.classList[n&&t["on".concat("node"===s?"Node":"Link","Click")]||!n&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=n}})).clickAfterDrag(!1).onClick((function(e,n){var i=Eye(e);if(i){var r=t["on".concat("node"===i.__graphObjType?"Node":"Link","Click")];r&&r(i.__data,n)}else t.onBackgroundClick&&t.onBackgroundClick(n)})).onRightClick((function(e,n){var i=Eye(e);if(i){var r=t["on".concat("node"===i.__graphObjType?"Node":"Link","RightClick")];r&&r(i.__data,n)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(n)})),this._animationCycle()}});function Eye(e){for(var t=e;t&&!t.hasOwnProperty("__graphObjType");)t=t.parent;return t}const Sye=e=>()=>e;function Cye(e,t){let{sourceEvent:n,subject:i,target:r,identifier:o,active:s,x:a,y:l,dx:c,dy:u,dispatch:h}=t;Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:h}})}function Mye(e){return!e.ctrlKey&&!e.button}function Tye(){return this.parentNode}function Rye(e,t){return null==t?{x:e.x,y:e.y}:t}function Iye(){return navigator.maxTouchPoints||"ontouchstart"in this}Cye.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};const Pye=function(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return c1(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),O1(e,t,{leading:i,maxWait:t,trailing:r})};function Bye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Lye(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function Nye(e,t){return e.get(Lye(e,t))}function Dye(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function kye(e,t,n){return e.set(Lye(e,t),n),n}function Oye(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Fye(i.key),i)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Uye(e){return function(e){if(Array.isArray(e))return Bye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Bye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bye(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fye(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var zye=function(e,t,n){return(e<<16)+(t<<8)+n},jye=function(e,t){return 123*e%Math.pow(2,t)},Vye=new WeakMap,Gye=new WeakMap,Hye=function(){return Oye((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Dye(this,Vye,void 0),Dye(this,Gye,void 0),kye(Gye,this,t),this.reset()}),[{key:"reset",value:function(){kye(Vye,this,["__reserved for background__"])}},{key:"register",value:function(e){if(Nye(Vye,this).length>=Math.pow(2,24-Nye(Gye,this)))return null;var t,n=Nye(Vye,this).length,i=jye(n,Nye(Gye,this)),r=(t=n+(i<<24-Nye(Gye,this)),"#".concat(Math.min(t,Math.pow(2,24)).toString(16).padStart(6,"0")));return Nye(Vye,this).push(e),r}},{key:"lookup",value:function(e){if(!e)return null;var t="string"===typeof e?function(e){var t=b2(e).toRgb(),n=t.r,i=t.g,r=t.b;return zye(n,i,r)}(e):zye.apply(void 0,Uye(e));if(!t)return null;var n=t&Math.pow(2,24-Nye(Gye,this))-1,i=t>>24-Nye(Gye,this)&Math.pow(2,Nye(Gye,this))-1;return jye(n,Nye(Gye,this))!==i||n>=Nye(Vye,this).length?null:Nye(Vye,this)[n]}}])}();const{abs:Wye,cos:Qye,sin:qye,acos:Xye,atan2:$ye,sqrt:Yye,pow:Kye}=Math;function Jye(e){return e<0?-Kye(-e,1/3):Kye(e,1/3)}const Zye=Math.PI,eAe=2*Zye,tAe=Zye/2,nAe=Number.MAX_SAFE_INTEGER||9007199254740991,iAe=Number.MIN_SAFE_INTEGER||-9007199254740991,rAe={x:0,y:0,z:0},oAe={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,t){const n=t(e);let i=n.x*n.x+n.y*n.y;return"undefined"!==typeof n.z&&(i+=n.z*n.z),Yye(i)},compute:function(e,t,n){if(0===e)return t[0].t=0,t[0];const i=t.length-1;if(1===e)return t[i].t=1,t[i];const r=1-e;let o=t;if(0===i)return t[0].t=e,t[0];if(1===i){const t={x:r*o[0].x+e*o[1].x,y:r*o[0].y+e*o[1].y,t:e};return n&&(t.z=r*o[0].z+e*o[1].z),t}if(i<4){let t,s,a,l=r*r,c=e*e,u=0;2===i?(o=[o[0],o[1],o[2],rAe],t=l,s=r*e*2,a=c):3===i&&(t=l*r,s=l*e*3,a=r*c*3,u=e*c);const h={x:t*o[0].x+s*o[1].x+a*o[2].x+u*o[3].x,y:t*o[0].y+s*o[1].y+a*o[2].y+u*o[3].y,t:e};return n&&(h.z=t*o[0].z+s*o[1].z+a*o[2].z+u*o[3].z),h}const s=JSON.parse(JSON.stringify(t));for(;s.length>1;){for(let t=0;t<s.length-1;t++)s[t]={x:s[t].x+(s[t+1].x-s[t].x)*e,y:s[t].y+(s[t+1].y-s[t].y)*e},"undefined"!==typeof s[t].z&&(s[t].z=s[t].z+(s[t+1].z-s[t].z)*e);s.splice(s.length-1,1)}return s[0].t=e,s[0]},computeWithRatios:function(e,t,n,i){const r=1-e,o=n,s=t;let a,l=o[0],c=o[1],u=o[2],h=o[3];return l*=r,c*=e,2===s.length?(a=l+c,{x:(l*s[0].x+c*s[1].x)/a,y:(l*s[0].y+c*s[1].y)/a,z:!!i&&(l*s[0].z+c*s[1].z)/a,t:e}):(l*=r,c*=2*r,u*=e*e,3===s.length?(a=l+c+u,{x:(l*s[0].x+c*s[1].x+u*s[2].x)/a,y:(l*s[0].y+c*s[1].y+u*s[2].y)/a,z:!!i&&(l*s[0].z+c*s[1].z+u*s[2].z)/a,t:e}):(l*=r,c*=1.5*r,u*=3*r,h*=e*e*e,4===s.length?(a=l+c+u+h,{x:(l*s[0].x+c*s[1].x+u*s[2].x+h*s[3].x)/a,y:(l*s[0].y+c*s[1].y+u*s[2].y+h*s[3].y)/a,z:!!i&&(l*s[0].z+c*s[1].z+u*s[2].z+h*s[3].z)/a,t:e}):void 0))},derive:function(e,t){const n=[];for(let i=e,r=i.length,o=r-1;r>1;r--,o--){const e=[];for(let n,r=0;r<o;r++)n={x:o*(i[r+1].x-i[r].x),y:o*(i[r+1].y-i[r].y)},t&&(n.z=o*(i[r+1].z-i[r].z)),e.push(n);n.push(e),i=e}return n},between:function(e,t,n){return t<=e&&e<=n||oAe.approximately(e,t)||oAe.approximately(e,n)},approximately:function(e,t,n){return Wye(e-t)<=(n||1e-6)},length:function(e){const t=oAe.Tvalues.length;let n=0;for(let i,r=0;r<t;r++)i=.5*oAe.Tvalues[r]+.5,n+=oAe.Cvalues[r]*oAe.arcfn(i,e);return.5*n},map:function(e,t,n,i,r){return i+(r-i)*((e-t)/(n-t))},lerp:function(e,t,n){const i={x:t.x+e*(n.x-t.x),y:t.y+e*(n.y-t.y)};return void 0!==t.z&&void 0!==n.z&&(i.z=t.z+e*(n.z-t.z)),i},pointToString:function(e){let t=e.x+"/"+e.y;return"undefined"!==typeof e.z&&(t+="/"+e.z),t},pointsToString:function(e){return"["+e.map(oAe.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,t,n){const i=t.x-e.x,r=t.y-e.y,o=n.x-e.x,s=n.y-e.y;return $ye(i*s-r*o,i*o+r*s)},round:function(e,t){const n=""+e,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+t))},dist:function(e,t){const n=e.x-t.x,i=e.y-t.y;return Yye(n*n+i*i)},closest:function(e,t){let n,i,r=Kye(2,63);return e.forEach((function(e,o){i=oAe.dist(t,e),i<r&&(r=i,n=o)})),{mdist:r,mpos:n}},abcratio:function(e,t){if(2!==t&&3!==t)return!1;if("undefined"===typeof e)e=.5;else if(0===e||1===e)return e;const n=Kye(e,t)+Kye(1-e,t);return Wye((n-1)/n)},projectionratio:function(e,t){if(2!==t&&3!==t)return!1;if("undefined"===typeof e)e=.5;else if(0===e||1===e)return e;const n=Kye(1-e,t);return n/(Kye(e,t)+n)},lli8:function(e,t,n,i,r,o,s,a){const l=(e-n)*(o-a)-(t-i)*(r-s);return 0!=l&&{x:((e*i-t*n)*(r-s)-(e-n)*(r*a-o*s))/l,y:((e*i-t*n)*(o-a)-(t-i)*(r*a-o*s))/l}},lli4:function(e,t,n,i){const r=e.x,o=e.y,s=t.x,a=t.y,l=n.x,c=n.y,u=i.x,h=i.y;return oAe.lli8(r,o,s,a,l,c,u,h)},lli:function(e,t){return oAe.lli4(e,e.c,t,t.c)},makeline:function(e,t){return new mAe(e.x,e.y,(e.x+t.x)/2,(e.y+t.y)/2,t.x,t.y)},findbbox:function(e){let t=nAe,n=nAe,i=iAe,r=iAe;return e.forEach((function(e){const o=e.bbox();t>o.x.min&&(t=o.x.min),n>o.y.min&&(n=o.y.min),i<o.x.max&&(i=o.x.max),r<o.y.max&&(r=o.y.max)})),{x:{min:t,mid:(t+i)/2,max:i,size:i-t},y:{min:n,mid:(n+r)/2,max:r,size:r-n}}},shapeintersections:function(e,t,n,i,r){if(!oAe.bboxoverlap(t,i))return[];const o=[],s=[e.startcap,e.forward,e.back,e.endcap],a=[n.startcap,n.forward,n.back,n.endcap];return s.forEach((function(t){t.virtual||a.forEach((function(i){if(i.virtual)return;const s=t.intersects(i,r);s.length>0&&(s.c1=t,s.c2=i,s.s1=e,s.s2=n,o.push(s))}))})),o},makeshape:function(e,t,n){const i=t.points.length,r=e.points.length,o=oAe.makeline(t.points[i-1],e.points[0]),s=oAe.makeline(e.points[r-1],t.points[0]),a={startcap:o,forward:e,back:t,endcap:s,bbox:oAe.findbbox([o,e,t,s]),intersections:function(e){return oAe.shapeintersections(a,a.bbox,e,e.bbox,n)}};return a},getminmax:function(e,t,n){if(!n)return{min:0,max:0};let i,r,o=nAe,s=iAe;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let a=0,l=n.length;a<l;a++)i=n[a],r=e.get(i),r[t]<o&&(o=r[t]),r[t]>s&&(s=r[t]);return{min:o,mid:(o+s)/2,max:s,size:s-o}},align:function(e,t){const n=t.p1.x,i=t.p1.y,r=-$ye(t.p2.y-i,t.p2.x-n);return e.map((function(e){return{x:(e.x-n)*Qye(r)-(e.y-i)*qye(r),y:(e.x-n)*qye(r)+(e.y-i)*Qye(r)}}))},roots:function(e,t){t=t||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=e.length-1,i=oAe.align(e,t),r=function(e){return 0<=e&&e<=1};if(2===n){const e=i[0].y,t=i[1].y,n=i[2].y,o=e-2*t+n;if(0!==o){const i=-Yye(t*t-e*n),s=-e+t;return[-(i+s)/o,-(-i+s)/o].filter(r)}return t!==n&&0===o?[(2*t-n)/(2*t-2*n)].filter(r):[]}const o=i[0].y,s=i[1].y,a=i[2].y;let l=3*s-o-3*a+i[3].y,c=3*o-6*s+3*a,u=-3*o+3*s,h=o;if(oAe.approximately(l,0)){if(oAe.approximately(c,0))return oAe.approximately(u,0)?[]:[-h/u].filter(r);const e=Yye(u*u-4*c*h),t=2*c;return[(e-u)/t,(-u-e)/t].filter(r)}c/=l,u/=l,h/=l;const d=(3*u-c*c)/3,p=d/3,f=(2*c*c*c-9*c*u+27*h)/27,m=f/2,g=m*m+p*p*p;let v,y,A,x,b;if(g<0){const e=-d/3,t=Yye(e*e*e),n=-f/(2*t),i=Xye(n<-1?-1:n>1?1:n),o=2*Jye(t);return A=o*Qye(i/3)-c/3,x=o*Qye((i+eAe)/3)-c/3,b=o*Qye((i+2*eAe)/3)-c/3,[A,x,b].filter(r)}if(0===g)return v=m<0?Jye(-m):-Jye(m),A=2*v-c/3,x=-v-c/3,[A,x].filter(r);{const e=Yye(g);return v=Jye(-m+e),y=Jye(m+e),[v-y-c/3].filter(r)}},droots:function(e){if(3===e.length){const t=e[0],n=e[1],i=e[2],r=t-2*n+i;if(0!==r){const e=-Yye(n*n-t*i),o=-t+n;return[-(e+o)/r,-(-e+o)/r]}return n!==i&&0===r?[(2*n-i)/(2*(n-i))]:[]}if(2===e.length){const t=e[0],n=e[1];return t!==n?[t/(t-n)]:[]}return[]},curvature:function(e,t,n,i,r){let o,s,a,l,c=0,u=0;const h=oAe.compute(e,t),d=oAe.compute(e,n),p=h.x*h.x+h.y*h.y;if(i?(o=Yye(Kye(h.y*d.z-d.y*h.z,2)+Kye(h.z*d.x-d.z*h.x,2)+Kye(h.x*d.y-d.x*h.y,2)),s=Kye(p+h.z*h.z,1.5)):(o=h.x*d.y-h.y*d.x,s=Kye(p,1.5)),0===o||0===s)return{k:0,r:0};if(c=o/s,u=s/o,!r){const r=oAe.curvature(e-.001,t,n,i,!0).k,o=oAe.curvature(e+.001,t,n,i,!0).k;l=(o-c+(c-r))/2,a=(Wye(o-c)+Wye(c-r))/2}return{k:c,r:u,dk:l,adk:a}},inflections:function(e){if(e.length<4)return[];const t=oAe.align(e,{p1:e[0],p2:e.slice(-1)[0]}),n=t[2].x*t[1].y,i=t[3].x*t[1].y,r=t[1].x*t[2].y,o=18*(-3*n+2*i+3*r-t[3].x*t[2].y),s=18*(3*n-i-3*r),a=18*(r-n);if(oAe.approximately(o,0)){if(!oAe.approximately(s,0)){let e=-a/s;if(0<=e&&e<=1)return[e]}return[]}const l=2*o;if(oAe.approximately(l,0))return[];const c=s*s-4*o*a;if(c<0)return[];const u=Math.sqrt(c);return[(u-s)/l,-(s+u)/l].filter((function(e){return 0<=e&&e<=1}))},bboxoverlap:function(e,t){const n=["x","y"],i=n.length;for(let r,o,s,a,l=0;l<i;l++)if(r=n[l],o=e[r].mid,s=t[r].mid,a=(e[r].size+t[r].size)/2,Wye(o-s)>=a)return!1;return!0},expandbox:function(e,t){t.x.min<e.x.min&&(e.x.min=t.x.min),t.y.min<e.y.min&&(e.y.min=t.y.min),t.z&&t.z.min<e.z.min&&(e.z.min=t.z.min),t.x.max>e.x.max&&(e.x.max=t.x.max),t.y.max>e.y.max&&(e.y.max=t.y.max),t.z&&t.z.max>e.z.max&&(e.z.max=t.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,t,n){const i=e.bbox(),r=t.bbox(),o=1e5,s=n||.5;if(i.x.size+i.y.size<s&&r.x.size+r.y.size<s)return[(o*(e._t1+e._t2)/2|0)/o+"/"+(o*(t._t1+t._t2)/2|0)/o];let a=e.split(.5),l=t.split(.5),c=[{left:a.left,right:l.left},{left:a.left,right:l.right},{left:a.right,right:l.right},{left:a.right,right:l.left}];c=c.filter((function(e){return oAe.bboxoverlap(e.left.bbox(),e.right.bbox())}));let u=[];return 0===c.length||(c.forEach((function(e){u=u.concat(oAe.pairiteration(e.left,e.right,s))})),u=u.filter((function(e,t){return u.indexOf(e)===t}))),u},getccenter:function(e,t,n){const i=t.x-e.x,r=t.y-e.y,o=n.x-t.x,s=n.y-t.y,a=i*Qye(tAe)-r*qye(tAe),l=i*qye(tAe)+r*Qye(tAe),c=o*Qye(tAe)-s*qye(tAe),u=o*qye(tAe)+s*Qye(tAe),h=(e.x+t.x)/2,d=(e.y+t.y)/2,p=(t.x+n.x)/2,f=(t.y+n.y)/2,m=h+a,g=d+l,v=p+c,y=f+u,A=oAe.lli8(h,d,m,g,p,f,v,y),x=oAe.dist(A,e);let b,_=$ye(e.y-A.y,e.x-A.x),w=$ye(t.y-A.y,t.x-A.x),E=$ye(n.y-A.y,n.x-A.x);return _<E?((_>w||w>E)&&(_+=eAe),_>E&&(b=E,E=_,_=b)):E<w&&w<_?(b=E,E=_,_=b):E+=eAe,A.s=_,A.e=E,A.r=x,A},numberSort:function(e,t){return e-t}};class sAe{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(e){return oAe.pointsToString(e.points)})).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map((function(e){return e.length()})).reduce((function(e,t){return e+t}))}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var t=e[0].bbox(),n=1;n<e.length;n++)oAe.expandbox(t,e[n].bbox());return t}offset(e){const t=[];return this.curves.forEach((function(n){t.push(...n.offset(e))})),new sAe(t)}}const{abs:aAe,min:lAe,max:cAe,cos:uAe,sin:hAe,acos:dAe,sqrt:pAe}=Math,fAe=Math.PI;class mAe{constructor(e){let t=e&&e.forEach?e:Array.from(arguments).slice(),n=!1;if("object"===typeof t[0]){n=t.length;const e=[];t.forEach((function(t){["x","y","z"].forEach((function(n){"undefined"!==typeof t[n]&&e.push(t[n])}))})),t=e}let i=!1;const r=t.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(6!==r&&8!==r&&9!==r&&12!==r&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const o=this._3d=!i&&(9===r||12===r)||e&&e[0]&&"undefined"!==typeof e[0].z,s=this.points=[];for(let d=0,p=o?3:2;d<r;d+=p){var a={x:t[d],y:t[d+1]};o&&(a.z=t[d+2]),s.push(a)}const l=this.order=s.length-1,c=this.dims=["x","y"];o&&c.push("z"),this.dimlen=c.length;const u=oAe.align(s,{p1:s[0],p2:s[l]}),h=oAe.dist(s[0],s[l]);this._linear=u.reduce(((e,t)=>e+aAe(t.y)),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,t,n,i){if("undefined"===typeof i&&(i=.5),0===i)return new mAe(t,t,n);if(1===i)return new mAe(e,t,t);const r=mAe.getABC(2,e,t,n,i);return new mAe(e,r.A,n)}static cubicFromPoints(e,t,n,i,r){"undefined"===typeof i&&(i=.5);const o=mAe.getABC(3,e,t,n,i);"undefined"===typeof r&&(r=oAe.dist(t,o.C));const s=r*(1-i)/i,a=oAe.dist(e,n),l=(n.x-e.x)/a,c=(n.y-e.y)/a,u=r*l,h=r*c,d=s*l,p=s*c,f=t.x-u,m=t.y-h,g=t.x+d,v=t.y+p,y=o.A,A=y.x+(f-y.x)/(1-i),x=y.y+(m-y.y)/(1-i),b=y.x+(g-y.x)/i,_=y.y+(v-y.y)/i,w={x:e.x+(A-e.x)/i,y:e.y+(x-e.y)/i},E={x:n.x+(b-n.x)/(1-i),y:n.y+(_-n.y)/(1-i)};return new mAe(e,w,E,n)}static getUtils(){return oAe}getUtils(){return mAe.getUtils()}static get PolyBezier(){return sAe}valueOf(){return this.toString()}toString(){return oAe.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,t=["M",e[0].x,e[0].y,2===this.order?"Q":"C"];for(let n=1,i=e.length;n<i;n++)t.push(e[n].x),t.push(e[n].y);return t.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map((function(e,t){return""+t+e.x+e.y+(e.z?e.z:0)})).join("")}update(){this._lut=[],this.dpoints=oAe.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,t=oAe.angle(e[0],e[this.order],e[1]);this.clockwise=t>0}length(){return oAe.length(this.derivative.bind(this))}static getABC(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const o=oAe.projectionratio(r,e),s=1-o,a={x:o*t.x+s*i.x,y:o*t.y+s*i.y},l=oAe.abcratio(r,e);return{A:{x:n.x+(n.x-a.x)/l,y:n.y+(n.y-a.y)/l},B:n,C:a,S:t,E:i}}getABC(e,t){t=t||this.get(e);let n=this.points[0],i=this.points[this.order];return mAe.getABC(this.order,n,t,i,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let t,n,i=0;i<e;i++)n=i/(e-1),t=this.compute(n),t.t=n,this._lut.push(t);return this._lut}on(e,n){n=n||5;const i=this.getLUT(),r=[];for(let t,o=0,s=0;o<i.length;o++)t=i[o],oAe.dist(t,e)<n&&(r.push(t),s+=o/i.length);return!!r.length&&(t/=r.length)}project(e){const t=this.getLUT(),n=t.length-1,i=oAe.closest(t,e),r=i.mpos,o=(r-1)/n,s=(r+1)/n,a=.1/n;let l,c=i.mdist,u=o,h=u;c+=1;for(let d;u<s+a;u+=a)l=this.compute(u),d=oAe.dist(e,l),d<c&&(c=d,h=u);return h=h<0?0:h>1?1:h,l=this.compute(h),l.t=h,l.d=c,l}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?oAe.computeWithRatios(e,this.points,this.ratios,this._3d):oAe.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,t=[e[0]],n=e.length;for(let i,r,o=1;o<n;o++)i=e[o],r=e[o-1],t[o]={x:(n-o)/n*i.x+o/n*r.x,y:(n-o)/n*i.y+o/n*r.y};return t[n]=e[n-1],new mAe(t)}derivative(e){return oAe.compute(e,this.dpoints[0],this._3d)}dderivative(e){return oAe.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new mAe(oAe.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return oAe.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return oAe.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const t=this.derivative(e),n=pAe(t.x*t.x+t.y*t.y);return{t:e,x:-t.y/n,y:t.x/n}}__normal3(e){const t=this.derivative(e),n=this.derivative(e+.01),i=pAe(t.x*t.x+t.y*t.y+t.z*t.z),r=pAe(n.x*n.x+n.y*n.y+n.z*n.z);t.x/=i,t.y/=i,t.z/=i,n.x/=r,n.y/=r,n.z/=r;const o={x:n.y*t.z-n.z*t.y,y:n.z*t.x-n.x*t.z,z:n.x*t.y-n.y*t.x},s=pAe(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=s,o.y/=s,o.z/=s;const a=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{t:e,x:a[0]*t.x+a[1]*t.y+a[2]*t.z,y:a[3]*t.x+a[4]*t.y+a[5]*t.z,z:a[6]*t.x+a[7]*t.y+a[8]*t.z}}hull(e){let t=this.points,n=[],i=[],r=0;for(i[r++]=t[0],i[r++]=t[1],i[r++]=t[2],3===this.order&&(i[r++]=t[3]);t.length>1;){n=[];for(let o,s=0,a=t.length-1;s<a;s++)o=oAe.lerp(e,t[s],t[s+1]),i[r++]=o,n.push(o);t=n}return i}split(e,t){if(0===e&&t)return this.split(t).left;if(1===t)return this.split(e).right;const n=this.hull(e),i={left:2===this.order?new mAe([n[0],n[3],n[5]]):new mAe([n[0],n[4],n[7],n[9]]),right:2===this.order?new mAe([n[5],n[4],n[2]]):new mAe([n[9],n[8],n[6],n[3]]),span:n};return i.left._t1=oAe.map(0,0,1,this._t1,this._t2),i.left._t2=oAe.map(e,0,1,this._t1,this._t2),i.right._t1=oAe.map(e,0,1,this._t1,this._t2),i.right._t2=oAe.map(1,0,1,this._t1,this._t2),t?(t=oAe.map(t,e,1,0,1),i.right.split(t).left):i}extrema(){const e={};let t=[];return this.dims.forEach(function(n){let i=function(e){return e[n]},r=this.dpoints[0].map(i);e[n]=oAe.droots(r),3===this.order&&(r=this.dpoints[1].map(i),e[n]=e[n].concat(oAe.droots(r))),e[n]=e[n].filter((function(e){return e>=0&&e<=1})),t=t.concat(e[n].sort(oAe.numberSort))}.bind(this)),e.values=t.sort(oAe.numberSort).filter((function(e,n){return t.indexOf(e)===n})),e}bbox(){const e=this.extrema(),t={};return this.dims.forEach(function(n){t[n]=oAe.getminmax(this,n,e[n])}.bind(this)),t}overlaps(e){const t=this.bbox(),n=e.bbox();return oAe.bboxoverlap(t,n)}offset(e,t){if("undefined"!==typeof t){const n=this.get(e),i=this.normal(e),r={c:n,n:i,x:n.x+i.x*t,y:n.y+i.y*t};return this._3d&&(r.z=n.z+i.z*t),r}if(this._linear){const t=this.normal(0),n=this.points.map((function(n){const i={x:n.x+e*t.x,y:n.y+e*t.y};return n.z&&t.z&&(i.z=n.z+e*t.z),i}));return[new mAe(n)]}return this.reduce().map((function(t){return t._linear?t.offset(e)[0]:t.scale(e)}))}simple(){if(3===this.order){const e=oAe.angle(this.points[0],this.points[3],this.points[1]),t=oAe.angle(this.points[0],this.points[3],this.points[2]);if(e>0&&t<0||e<0&&t>0)return!1}const e=this.normal(0),t=this.normal(1);let n=e.x*t.x+e.y*t.y;return this._3d&&(n+=e.z*t.z),aAe(dAe(n))<fAe/3}reduce(){let e,t,n=0,i=0,r=.01,o=[],s=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),n=a[0],e=1;e<a.length;e++)i=a[e],t=this.split(n,i),t._t1=n,t._t2=i,o.push(t),n=i;return o.forEach((function(e){for(n=0,i=0;i<=1;)for(i=n+r;i<=1.01;i+=r)if(t=e.split(n,i),!t.simple()){if(i-=r,aAe(n-i)<r)return[];t=e.split(n,i),t._t1=oAe.map(n,0,1,e._t1,e._t2),t._t2=oAe.map(i,0,1,e._t1,e._t2),s.push(t),n=i;break}n<1&&(t=e.split(n,1),t._t1=oAe.map(n,0,1,e._t1,e._t2),t._t2=e._t2,s.push(t))})),s}translate(e,t,n){n="number"===typeof n?n:t;const i=this.order;let r=this.points.map(((e,r)=>(1-r/i)*t+r/i*n));return new mAe(this.points.map(((t,n)=>({x:t.x+e.x*r[n],y:t.y+e.y*r[n]}))))}scale(e){const t=this.order;let n=!1;if("function"===typeof e&&(n=e),n&&2===t)return this.raise().scale(n);const i=this.clockwise,r=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);const o=n?n(0):e,s=n?n(1):e,a=[this.offset(0,10),this.offset(1,10)],l=[],c=oAe.lli4(a[0],a[0].c,a[1],a[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(e){const n=l[e*t]=oAe.copy(r[e*t]);n.x+=(e?s:o)*a[e].n.x,n.y+=(e?s:o)*a[e].n.y})),n?([0,1].forEach((function(o){if(2!==t||!o){var s=r[o+1],a={x:s.x-c.x,y:s.y-c.y},u=n?n((o+1)/t):e;n&&!i&&(u=-u);var h=pAe(a.x*a.x+a.y*a.y);a.x/=h,a.y/=h,l[o+1]={x:s.x+u*a.x,y:s.y+u*a.y}}})),new mAe(l)):([0,1].forEach((e=>{if(2===t&&e)return;const n=l[e*t],i=this.derivative(e),o={x:n.x+i.x,y:n.y+i.y};l[e+1]=oAe.lli4(n,o,c,r[e+1])})),new mAe(l))}outline(e,t,n,i){if(t=void 0===t?e:t,this._linear){const r=this.normal(0),o=this.points[0],s=this.points[this.points.length-1];let a,l,c;void 0===n&&(n=e,i=t),a={x:o.x+r.x*e,y:o.y+r.y*e},c={x:s.x+r.x*n,y:s.y+r.y*n},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const u=[a,l,c];a={x:o.x-r.x*t,y:o.y-r.y*t},c={x:s.x-r.x*i,y:s.y-r.y*i},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const h=[c,l,a],d=oAe.makeline(h[2],u[0]),p=oAe.makeline(u[2],h[0]),f=[d,new mAe(u),p,new mAe(h)];return new sAe(f)}const r=this.reduce(),o=r.length,s=[];let a,l=[],c=0,u=this.length();const h="undefined"!==typeof n&&"undefined"!==typeof i;function d(e,t,n,i,r){return function(o){const s=i/n,a=(i+r)/n,l=t-e;return oAe.map(o,0,1,e+s*l,e+a*l)}}r.forEach((function(r){const o=r.length();h?(s.push(r.scale(d(e,n,u,c,o))),l.push(r.scale(d(-t,-i,u,c,o)))):(s.push(r.scale(e)),l.push(r.scale(-t))),c+=o})),l=l.map((function(e){return a=e.points,a[3]?e.points=[a[3],a[2],a[1],a[0]]:e.points=[a[2],a[1],a[0]],e})).reverse();const p=s[0].points[0],f=s[o-1].points[s[o-1].points.length-1],m=l[o-1].points[l[o-1].points.length-1],g=l[0].points[0],v=oAe.makeline(m,p),y=oAe.makeline(f,g),A=[v].concat(s).concat([y]).concat(l);return new sAe(A)}outlineshapes(e,t,n){t=t||e;const i=this.outline(e,t).curves,r=[];for(let o=1,s=i.length;o<s/2;o++){const e=oAe.makeshape(i[o],i[s-o],n);e.startcap.virtual=o>1,e.endcap.virtual=o<s/2-1,r.push(e)}return r}intersects(e,t){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof mAe&&(e=e.reduce()),this.curveintersects(this.reduce(),e,t)):this.selfintersects(t)}lineIntersects(e){const t=lAe(e.p1.x,e.p2.x),n=lAe(e.p1.y,e.p2.y),i=cAe(e.p1.x,e.p2.x),r=cAe(e.p1.y,e.p2.y);return oAe.roots(this.points,e).filter((e=>{var o=this.get(e);return oAe.between(o.x,t,i)&&oAe.between(o.y,n,r)}))}selfintersects(e){const t=this.reduce(),n=t.length-2,i=[];for(let r,o,s,a=0;a<n;a++)o=t.slice(a,a+1),s=t.slice(a+2),r=this.curveintersects(o,s,e),i.push(...r);return i}curveintersects(e,t,n){const i=[];e.forEach((function(e){t.forEach((function(t){e.overlaps(t)&&i.push({left:e,right:t})}))}));let r=[];return i.forEach((function(e){const t=oAe.pairiteration(e.left,e.right,n);t.length>0&&(r=r.concat(t))})),r}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,t,n,i){const r=(i-n)/4,o=this.get(n+r),s=this.get(i-r),a=oAe.dist(e,t),l=oAe.dist(e,o),c=oAe.dist(e,s);return aAe(l-a)+aAe(c-a)}_iterate(e,t){let n,i=0,r=1;do{n=0,r=1;let o,s,a,l,c,u=this.get(i),h=!1,d=!1,p=r,f=1,m=0;do{if(d=h,l=a,p=(i+r)/2,m++,o=this.get(p),s=this.get(r),a=oAe.getccenter(u,o,s),a.interval={start:i,end:r},h=this._error(a,u,i,r)<=e,c=d&&!h,c||(f=r),h){if(r>=1){if(a.interval.end=f=1,l=a,r>1){let e={x:a.x+a.r*uAe(a.e),y:a.y+a.r*hAe(a.e)};a.e+=oAe.angle({x:a.x,y:a.y},e,this.get(1))}break}r+=(r-i)/2}else r=p}while(!c&&n++<100);if(n>=100)break;l=l||a,t.push(l),i=f}while(r<1);return t}}function gAe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function vAe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||xAe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yAe(e){return function(e){if(Array.isArray(e))return gAe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||xAe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AAe(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function xAe(e,t){if(e){if("string"==typeof e)return gAe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gAe(e,t):void 0}}var bAe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=(t instanceof Array?t.length?t:[void 0]:[t]).map((function(e){return{keyAccessor:e,isProp:!(e instanceof Function)}})),o=e.reduce((function(e,t){var i=e,o=t;return r.forEach((function(e,t){var s,a=e.keyAccessor;if(e.isProp){var l=o,c=l[a],u=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(l,[a].map(AAe));s=c,o=u}else s=a(o,t);t+1<r.length?(i.hasOwnProperty(s)||(i[s]={}),i=i[s]):n?(i.hasOwnProperty(s)||(i[s]=[]),i[s].push(o)):i[s]=o})),e}),{});n instanceof Function&&function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i===r.length?Object.keys(t).forEach((function(e){return t[e]=n(t[e])})):Object.values(t).forEach((function(t){return e(t,i+1)}))}(o);var s=o;return i&&(s=[],function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];n.length===r.length?s.push({keys:n,vals:t}):Object.entries(t).forEach((function(t){var i=vAe(t,2),r=i[0],o=i[1];return e(o,[].concat(yAe(n),[r]))}))}(o),t instanceof Array&&0===t.length&&1===s.length&&(s[0].keys=[])),s};function _Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function wAe(e,t,n){if(SAe())return Reflect.construct.apply(null,arguments);var i=[null];return i.push.apply(i,t),new(e.bind.apply(e,i))}function EAe(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SAe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(SAe=function(){return!!e})()}function CAe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function MAe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CAe(Object(n),!0).forEach((function(t){EAe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CAe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function TAe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||PAe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RAe(e){return function(e){if(Array.isArray(e))return _Ae(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||PAe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function IAe(e){return IAe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},IAe(e)}function PAe(e,t){if(e){if("string"==typeof e)return _Ae(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_Ae(e,t):void 0}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!==typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".force-graph-container canvas {\n  display: block;\n  user-select: none;\n  outline: none;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.force-graph-container .clickable {\n  cursor: pointer;\n}\n\n.force-graph-container .grabbable {\n  cursor: move;\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n}\n\n.force-graph-container .grabbable:active {\n  cursor: grabbing;\n  cursor: -moz-grabbing;\n  cursor: -webkit-grabbing;\n}\n");var BAe=g2(v2);function LAe(e,t,n){t&&"string"===typeof n&&e.filter((function(e){return!e[n]})).forEach((function(e){e[n]=BAe(t(e))}))}var NAe=function(e,t){return t.onNeedsRedraw&&t.onNeedsRedraw()},DAe=function(e,t){if(!t.isShadow){var n=G1(t.linkDirectionalParticles);t.graphData.links.forEach((function(e){var t=Math.round(Math.abs(n(e)));t?e.__photons=RAe(Array(t)).map((function(){return{}})):delete e.__photons}))}},kAe=V1({props:{graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1,DAe(0,t)}},dagMode:{onChange:function(e,t){!e&&(t.graphData.nodes||[]).forEach((function(e){return e.fx=e.fy=void 0}))}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4,triggerUpdate:!1,onChange:NAe},nodeId:{default:"id"},nodeVal:{default:"val",triggerUpdate:!1,onChange:NAe},nodeColor:{default:"color",triggerUpdate:!1,onChange:NAe},nodeAutoColorBy:{},nodeCanvasObject:{triggerUpdate:!1,onChange:NAe},nodeCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:NAe},nodeVisibility:{default:!0,triggerUpdate:!1,onChange:NAe},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0,triggerUpdate:!1,onChange:NAe},linkColor:{default:"color",triggerUpdate:!1,onChange:NAe},linkAutoColorBy:{},linkLineDash:{triggerUpdate:!1,onChange:NAe},linkWidth:{default:1,triggerUpdate:!1,onChange:NAe},linkCurvature:{default:0,triggerUpdate:!1,onChange:NAe},linkCanvasObject:{triggerUpdate:!1,onChange:NAe},linkCanvasObjectMode:{default:function(){return"replace"},triggerUpdate:!1,onChange:NAe},linkDirectionalArrowLength:{default:0,triggerUpdate:!1,onChange:NAe},linkDirectionalArrowColor:{triggerUpdate:!1,onChange:NAe},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1,onChange:NAe},linkDirectionalParticles:{default:0,triggerUpdate:!1,onChange:DAe},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:4,triggerUpdate:!1},linkDirectionalParticleColor:{triggerUpdate:!1},globalScale:{default:1,triggerUpdate:!1},d3AlphaMin:{default:0,triggerUpdate:!1},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.forceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.forceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.forceLayout.velocityDecay(e)}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1},onNeedsRedraw:{triggerUpdate:!1},isShadow:{default:!1,triggerUpdate:!1}},methods:{d3Force:function(e,t,n){return void 0===n?e.forceLayout.force(t):(e.forceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.forceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},isEngineRunning:function(e){return!!e.engineRunning},tickFrame:function(e){return!e.isShadow&&e.engineRunning&&(++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||e.d3AlphaMin>0&&e.forceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.forceLayout.tick(),e.onEngineTick())),function(){var t=G1(e.linkVisibility),n=G1(e.linkColor),i=G1(e.linkWidth),r=G1(e.linkLineDash),o=G1(e.linkCurvature),s=G1(e.linkCanvasObjectMode),a=e.ctx,l=2*e.isShadow,c=e.graphData.links.filter(t);c.forEach((function(e){var t=o(e);if(!t)return void(e.__controlPoints=null);var n=e.source,i=e.target;if(!n||!i||!n.hasOwnProperty("x")||!i.hasOwnProperty("x"))return;var r=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2));if(r>0){var s=Math.atan2(i.y-n.y,i.x-n.x),a=r*t,l={x:(n.x+i.x)/2+a*Math.cos(s-Math.PI/2),y:(n.y+i.y)/2+a*Math.sin(s-Math.PI/2)};e.__controlPoints=[l.x,l.y]}else{var c=70*t;e.__controlPoints=[i.x,i.y-c,i.x+c,i.y]}}));var u=[],h=[],d=c;if(e.linkCanvasObject){var p=[],f=[];c.forEach((function(e){return({before:u,after:h,replace:p}[s(e)]||f).push(e)})),d=[].concat(RAe(u),h,f),u=u.concat(p)}a.save(),u.forEach((function(t){return e.linkCanvasObject(t,a,e.globalScale)})),a.restore();var m=bAe(d,[n,i,r]);a.save(),Object.entries(m).forEach((function(t){var n=TAe(t,2),i=n[0],o=n[1],s=i&&"undefined"!==i?i:"rgba(0,0,0,0.15)";Object.entries(o).forEach((function(t){var n=TAe(t,2),i=n[0],o=n[1],c=(i||1)/e.globalScale+l;Object.entries(o).forEach((function(e){var t=TAe(e,2);t[0];var n=t[1],i=r(n[0]);a.beginPath(),n.forEach((function(e){var t=e.source,n=e.target;if(t&&n&&t.hasOwnProperty("x")&&n.hasOwnProperty("x")){a.moveTo(t.x,t.y);var i=e.__controlPoints;i?a[2===i.length?"quadraticCurveTo":"bezierCurveTo"].apply(a,RAe(i).concat([n.x,n.y])):a.lineTo(n.x,n.y)}})),a.strokeStyle=s,a.lineWidth=c,a.setLineDash(i||[]),a.stroke()}))}))})),a.restore(),a.save(),h.forEach((function(t){return e.linkCanvasObject(t,a,e.globalScale)})),a.restore()}(),!e.isShadow&&function(){var t=G1(e.linkDirectionalArrowLength),n=G1(e.linkDirectionalArrowRelPos),i=G1(e.linkVisibility),r=G1(e.linkDirectionalArrowColor||e.linkColor),o=G1(e.nodeVal),s=e.ctx;s.save(),e.graphData.links.filter(i).forEach((function(i){var a=t(i);if(a&&!(a<0)){var l=i.source,c=i.target;if(l&&c&&l.hasOwnProperty("x")&&c.hasOwnProperty("x")){var u=Math.sqrt(Math.max(0,o(l)||1))*e.nodeRelSize,h=Math.sqrt(Math.max(0,o(c)||1))*e.nodeRelSize,d=Math.min(1,Math.max(0,n(i))),p=r(i)||"rgba(0,0,0,0.28)",f=a/1.6/2,m=i.__controlPoints&&wAe(mAe,[l.x,l.y].concat(RAe(i.__controlPoints),[c.x,c.y])),g=m?function(e){return m.get(e)}:function(e){return{x:l.x+(c.x-l.x)*e||0,y:l.y+(c.y-l.y)*e||0}},v=m?m.length():Math.sqrt(Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2)),y=u+a+(v-u-h-a)*d,A=g(y/v),x=g((y-a)/v),b=g((y-.8*a)/v),_=Math.atan2(A.y-x.y,A.x-x.x)-Math.PI/2;s.beginPath(),s.moveTo(A.x,A.y),s.lineTo(x.x+f*Math.cos(_),x.y+f*Math.sin(_)),s.lineTo(b.x,b.y),s.lineTo(x.x-f*Math.cos(_),x.y-f*Math.sin(_)),s.fillStyle=p,s.fill()}}})),s.restore()}(),!e.isShadow&&function(){var t=G1(e.linkDirectionalParticles),n=G1(e.linkDirectionalParticleSpeed),i=G1(e.linkDirectionalParticleWidth),r=G1(e.linkVisibility),o=G1(e.linkDirectionalParticleColor||e.linkColor),s=e.ctx;s.save(),e.graphData.links.filter(r).forEach((function(r){var a=t(r);if(r.hasOwnProperty("__photons")&&r.__photons.length){var l=r.source,c=r.target;if(l&&c&&l.hasOwnProperty("x")&&c.hasOwnProperty("x")){var u=n(r),h=r.__photons||[],d=Math.max(0,i(r)/2)/Math.sqrt(e.globalScale),p=o(r)||"rgba(0,0,0,0.28)";s.fillStyle=p;var f=r.__controlPoints?wAe(mAe,[l.x,l.y].concat(RAe(r.__controlPoints),[c.x,c.y])):null,m=0,g=!1;h.forEach((function(e){var t=!!e.__singleHop;if(e.hasOwnProperty("__progressRatio")||(e.__progressRatio=t?0:m/a),!t&&m++,e.__progressRatio+=u,e.__progressRatio>=1){if(t)return void(g=!0);e.__progressRatio=e.__progressRatio%1}var n=e.__progressRatio,i=f?f.get(n):{x:l.x+(c.x-l.x)*n||0,y:l.y+(c.y-l.y)*n||0};s.beginPath(),s.arc(i.x,i.y,d,0,2*Math.PI,!1),s.fill()})),g&&(r.__photons=r.__photons.filter((function(e){return!e.__singleHop||e.__progressRatio<=1})))}}})),s.restore()}(),function(){var t=G1(e.nodeVisibility),n=G1(e.nodeVal),i=G1(e.nodeColor),r=G1(e.nodeCanvasObjectMode),o=e.ctx,s=e.isShadow/e.globalScale,a=e.graphData.nodes.filter(t);o.save(),a.forEach((function(t){var a=r(t);if(!e.nodeCanvasObject||"before"!==a&&"replace"!==a||(e.nodeCanvasObject(t,o,e.globalScale),"replace"!==a)){var l=Math.sqrt(Math.max(0,n(t)||1))*e.nodeRelSize+s;o.beginPath(),o.arc(t.x,t.y,l,0,2*Math.PI,!1),o.fillStyle=i(t)||"rgba(31, 120, 180, 0.92)",o.fill(),e.nodeCanvasObject&&"after"===a&&e.nodeCanvasObject(t,e.ctx,e.globalScale)}else o.restore()})),o.restore()}(),this},emitParticle:function(e,t){return t&&(!t.__photons&&(t.__photons=[]),t.__photons.push({__singleHop:!0})),this}},stateInit:function(){return{forceLayout:M0().force("link",B0()).force("charge",r1()).force("center",o1()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.ctx=e},update:function(e,t){e.engineRunning=!1,e.onUpdate(),null!==e.nodeAutoColorBy&&LAe(e.graphData.nodes,G1(e.nodeAutoColorBy),e.nodeColor),null!==e.linkAutoColorBy&&LAe(e.graphData.links,G1(e.linkAutoColorBy),e.linkColor),e.graphData.links.forEach((function(t){t.source=t[e.linkSource],t.target=t[e.linkTarget]})),e.forceLayout.stop().alpha(1).nodes(e.graphData.nodes);var n=e.forceLayout.force("link");n&&n.id((function(t){return t[e.nodeId]})).links(e.graphData.links);var i=e.dagMode&&function(e,t){var n=e.nodes,i=e.links,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.nodeFilter,s=void 0===o?function(){return!0}:o,a=r.onLoopError,l=void 0===a?function(e){throw"Invalid DAG structure! Found cycle in node path: ".concat(e.join(" -> "),".")}:a,c={};n.forEach((function(e){return c[t(e)]={data:e,out:[],depth:-1,skip:!s(e)}})),i.forEach((function(e){var n=e.source,i=e.target,r=l(n),o=l(i);if(!c.hasOwnProperty(r))throw"Missing source node with id: ".concat(r);if(!c.hasOwnProperty(o))throw"Missing target node with id: ".concat(o);var s=c[r],a=c[o];function l(e){return"object"===IAe(e)?t(e):e}s.out.push(a)}));var u=[];return function e(n){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=function(){var o=n[s];if(-1!==i.indexOf(o)){var a=[].concat(RAe(i.slice(i.indexOf(o))),[o]).map((function(e){return t(e.data)}));return u.some((function(e){return e.length===a.length&&e.every((function(e,t){return e===a[t]}))}))||(u.push(a),l(a)),1}r>o.depth&&(o.depth=r,e(o.out,[].concat(RAe(i),[o]),r+(o.skip?0:1)))},s=0,a=n.length;s<a;s++)o()}(Object.values(c)),Object.assign.apply(Object,[{}].concat(RAe(Object.entries(c).filter((function(e){return!TAe(e,2)[1].skip})).map((function(e){var t=TAe(e,2);return EAe({},t[0],t[1].depth)})))))}(e.graphData,(function(t){return t[e.nodeId]}),{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),r=Math.max.apply(Math,RAe(Object.values(i||[]))),o=e.dagLevelDistance||e.graphData.nodes.length/(r||1)*2*(-1!==["radialin","radialout"].indexOf(e.dagMode)?.7:1);if(["lr","rl","td","bu"].includes(t.dagMode)){var s=["lr","rl"].includes(t.dagMode)?"fx":"fy";e.graphData.nodes.filter(e.dagNodeFilter).forEach((function(e){return delete e[s]}))}if(["lr","rl","td","bu"].includes(e.dagMode)){var a=["rl","bu"].includes(e.dagMode),l=["lr","rl"].includes(e.dagMode)?"fx":"fy";e.graphData.nodes.filter(e.dagNodeFilter).forEach((function(t){return t[l]=function(t){return(i[t[e.nodeId]]-r/2)*o*(a?-1:1)}(t)}))}e.forceLayout.force("dagRadial",-1!==["radialin","radialout"].indexOf(e.dagMode)?s1((function(t){var n=i[t[e.nodeId]]||-1;return("radialin"===e.dagMode?r-n:n)*o})).strength((function(t){return e.dagNodeFilter(t)?1:0})):null);for(var c=0;c<e.warmupTicks&&!(e.d3AlphaMin>0&&e.forceLayout.alpha()<e.d3AlphaMin);c++)e.forceLayout.tick();this.resetCountdown(),e.onFinishUpdate()}});function OAe(e,t){var n=e instanceof Array?e:[e],i=new t;return i._destructor&&i._destructor(),{linkProp:function(e){return{default:i[e](),onChange:function(t,i){n.forEach((function(n){return i[n][e](t)}))},triggerUpdate:!1}},linkMethod:function(e){return function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];var s=[];return n.forEach((function(n){var i=t[n],o=i[e].apply(i,r);o!==i&&s.push(o)})),s.length?s[0]:this}}}}var UAe=OAe("forceGraph",kAe),FAe=OAe(["forceGraph","shadowGraph"],kAe),zAe=Object.assign.apply(Object,RAe(["nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","dagMode","dagLevelDistance","dagNodeFilter","onDagError","d3AlphaMin","d3AlphaDecay","d3VelocityDecay","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map((function(e){return EAe({},e,UAe.linkProp(e))}))).concat(RAe(["nodeRelSize","nodeId","nodeVal","nodeVisibility","linkSource","linkTarget","linkVisibility","linkCurvature"].map((function(e){return EAe({},e,FAe.linkProp(e))}))))),jAe=Object.assign.apply(Object,RAe(["d3Force","d3ReheatSimulation","emitParticle"].map((function(e){return EAe({},e,UAe.linkMethod(e))}))));function VAe(e){if(e.canvas){var t=e.canvas.width,n=e.canvas.height;300===t&&150===n&&(t=n=0);var i=window.devicePixelRatio;t/=i,n/=i,[e.canvas,e.shadowCanvas].forEach((function(r){r.style.width="".concat(e.width,"px"),r.style.height="".concat(e.height,"px"),r.width=e.width*i,r.height=e.height*i,t||n||r.getContext("2d").scale(i,i)}));var r=SS(e.canvas).k;e.zoom.translateBy(e.zoom.__baseElem,(e.width-t)/2/r,(e.height-n)/2/r),e.needsRedraw=!0}}function GAe(e){var t=window.devicePixelRatio;e.setTransform(t,0,0,t,0,0)}function HAe(e,t,n){e.save(),GAe(e),e.clearRect(0,0,t,n),e.restore()}var WAe=V1({props:MAe({width:{default:window.innerWidth,onChange:function(e,t){return VAe(t)},triggerUpdate:!1},height:{default:window.innerHeight,onChange:function(e,t){return VAe(t)},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){[e.nodes,e.links].every((function(e){return(e||[]).every((function(e){return!e.hasOwnProperty("__indexColor")}))}))&&t.colorTracker.reset(),[{type:"Node",objs:e.nodes},{type:"Link",objs:e.links}].forEach((function(e){var n=e.type;e.objs.filter((function(e){if(!e.hasOwnProperty("__indexColor"))return!0;var n=t.colorTracker.lookup(e.__indexColor);return!n||!n.hasOwnProperty("d")||n.d!==e})).forEach((function(e){e.__indexColor=t.colorTracker.register({type:n,d:e})}))})),t.forceGraph.graphData(e),t.shadowGraph.graphData(e)},triggerUpdate:!1},backgroundColor:{onChange:function(e,t){t.canvas&&e&&(t.canvas.style.background=e)},triggerUpdate:!1},nodeLabel:{default:"name",triggerUpdate:!1},nodePointerAreaPaint:{onChange:function(e,t){t.shadowGraph.nodeCanvasObject(e?function(t,n,i){return e(t,t.__indexColor,n,i)}:null),t.flushShadowCanvas&&t.flushShadowCanvas()},triggerUpdate:!1},linkPointerAreaPaint:{onChange:function(e,t){t.shadowGraph.linkCanvasObject(e?function(t,n,i){return e(t,t.__indexColor,n,i)}:null),t.flushShadowCanvas&&t.flushShadowCanvas()},triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:4,triggerUpdate:!1},minZoom:{default:.01,onChange:function(e,t){t.zoom.scaleExtent([e,t.zoom.scaleExtent()[1]])},triggerUpdate:!1},maxZoom:{default:1e3,onChange:function(e,t){t.zoom.scaleExtent([t.zoom.scaleExtent()[0],e])},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},enableZoomInteraction:{default:!0,triggerUpdate:!1},enablePanInteraction:{default:!0,triggerUpdate:!1},enableZoomPanInteraction:{default:!0,triggerUpdate:!1},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null},triggerUpdate:!1},autoPauseRedraw:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1},onZoom:{triggerUpdate:!1},onZoomEnd:{triggerUpdate:!1},onRenderFramePre:{triggerUpdate:!1},onRenderFramePost:{triggerUpdate:!1}},zAe),aliases:{stopAnimation:"pauseAnimation"},methods:MAe({graph2ScreenCoords:function(e,t,n){var i=SS(e.canvas);return{x:t*i.k+i.x,y:n*i.k+i.y}},screen2GraphCoords:function(e,t,n){var i=SS(e.canvas);return{x:(t-i.x)/i.k,y:(n-i.y)/i.k}},centerAt:function(e,t,n,i){if(!e.canvas)return null;if(void 0!==t||void 0!==n){var r=Object.assign({},void 0!==t?{x:t}:{},void 0!==n?{y:n}:{});return i?e.tweenGroup.add(new bve(o()).to(r,i).easing(mve.Quadratic.Out).onUpdate(s).start()):s(r),this}return o();function o(){var t=SS(e.canvas);return{x:(e.width/2-t.x)/t.k,y:(e.height/2-t.y)/t.k}}function s(t){var n=t.x,i=t.y;e.zoom.translateTo(e.zoom.__baseElem,void 0===n?o().x:n,void 0===i?o().y:i),e.needsRedraw=!0}},zoom:function(e,t,n){return e.canvas?void 0!==t?(n?e.tweenGroup.add(new bve({k:i()}).to({k:t},n).easing(mve.Quadratic.Out).onUpdate((function(e){return r(e.k)})).start()):r(t),this):i():null;function i(){return SS(e.canvas).k}function r(t){e.zoom.scaleTo(e.zoom.__baseElem,t),e.needsRedraw=!0}},zoomToFit:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length,r=new Array(i>3?i-3:0),o=3;o<i;o++)r[o-3]=arguments[o];var s=this.getGraphBbox.apply(this,r);if(s){var a={x:(s.x[0]+s.x[1])/2,y:(s.y[0]+s.y[1])/2},l=Math.max(1e-12,Math.min(1e12,(e.width-2*n)/(s.x[1]-s.x[0]),(e.height-2*n)/(s.y[1]-s.y[0])));this.centerAt(a.x,a.y,t),this.zoom(l,t)}return this},getGraphBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=G1(e.nodeVal),i=function(t){return Math.sqrt(Math.max(0,n(t)||1))*e.nodeRelSize},r=e.graphData.nodes.filter(t).map((function(e){return{x:e.x,y:e.y,r:i(e)}}));return r.length?{x:[H1(r,(function(e){return e.x-e.r})),W1(r,(function(e){return e.x+e.r}))],y:[H1(r,(function(e){return e.y-e.r})),W1(r,(function(e){return e.y+e.r}))]}:null},pauseAnimation:function(e){return e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId||this._animationCycle(),this},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},jAe),stateInit:function(){return{lastSetZoom:1,zoom:NS(),forceGraph:new kAe,shadowGraph:(new kAe).cooldownTicks(0).nodeColor("__indexColor").linkColor("__indexColor").isShadow(!0),colorTracker:new Hye,tweenGroup:new vve}},init:function(e,t){var n=this;e.innerHTML="";var i=document.createElement("div");i.classList.add("force-graph-container"),i.style.position="relative",e.appendChild(i),t.canvas=document.createElement("canvas"),t.backgroundColor&&(t.canvas.style.background=t.backgroundColor),i.appendChild(t.canvas),t.shadowCanvas=document.createElement("canvas");var r=t.canvas.getContext("2d"),o=t.shadowCanvas.getContext("2d",{willReadFrequently:!0}),s={x:-1e12,y:-1e12},a=function(){var e=null,n=window.devicePixelRatio,i=s.x>0&&s.y>0?o.getImageData(s.x*n,s.y*n,1,1):null;return i&&(e=t.colorTracker.lookup(i.data)),e};dw(t.canvas).call(function(){var e,t,n,i,r=Mye,o=Tye,s=Rye,a=Iye,l={},c=yw("start","drag","end"),u=0,h=0;function d(e){e.on("mousedown.drag",p).filter(a).on("touchstart.drag",g).on("touchmove.drag",v,Aw).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(s,a){if(!i&&r.call(this,s,a)){var l=A(this,o.call(this,s,a),s,a,"mouse");l&&(dw(s.view).on("mousemove.drag",f,xw).on("mouseup.drag",m,xw),ww(s.view),bw(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function f(i){if(_w(i),!n){var r=i.clientX-e,o=i.clientY-t;n=r*r+o*o>h}l.mouse("drag",i)}function m(e){dw(e.view).on("mousemove.drag mouseup.drag",null),Ew(e.view,n),_w(e),l.mouse("end",e)}function g(e,t){if(r.call(this,e,t)){var n,i,s=e.changedTouches,a=o.call(this,e,t),l=s.length;for(n=0;n<l;++n)(i=A(this,a,e,t,s[n].identifier,s[n]))&&(bw(e),i("start",e,s[n]))}}function v(e){var t,n,i=e.changedTouches,r=i.length;for(t=0;t<r;++t)(n=l[i[t].identifier])&&(_w(e),n("drag",e,i[t]))}function y(e){var t,n,r=e.changedTouches,o=r.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),t=0;t<o;++t)(n=l[r[t].identifier])&&(bw(e),n("end",e,r[t]))}function A(e,t,n,i,r,o){var a,h,p,f=c.copy(),m=Mw(o||n,t);if(null!=(p=s.call(e,new Cye("beforestart",{sourceEvent:n,target:d,identifier:r,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:f}),i)))return a=p.x-m[0]||0,h=p.y-m[1]||0,function n(o,s,c){var g,v=m;switch(o){case"start":l[r]=n,g=u++;break;case"end":delete l[r],--u;case"drag":m=Mw(c||s,t),g=u}f.call(o,e,new Cye(o,{sourceEvent:s,subject:p,target:d,identifier:r,active:g,x:m[0]+a,y:m[1]+h,dx:m[0]-v[0],dy:m[1]-v[1],dispatch:f}),i)}}return d.filter=function(e){return arguments.length?(r="function"===typeof e?e:Sye(!!e),d):r},d.container=function(e){return arguments.length?(o="function"===typeof e?e:Sye(e),d):o},d.subject=function(e){return arguments.length?(s="function"===typeof e?e:Sye(e),d):s},d.touchable=function(e){return arguments.length?(a="function"===typeof e?e:Sye(!!e),d):a},d.on=function(){var e=c.on.apply(c,arguments);return e===c?d:e},d.clickDistance=function(e){return arguments.length?(h=(e=+e)*e,d):Math.sqrt(h)},d}().subject((function(){if(!t.enableNodeDrag)return null;var e=a();return e&&"Node"===e.type?e.d:null})).on("start",(function(e){var n=e.subject;n.__initialDragPos={x:n.x,y:n.y,fx:n.fx,fy:n.fy},e.active||(n.fx=n.x,n.fy=n.y),t.canvas.classList.add("grabbable")})).on("drag",(function(e){var n=e.subject,i=n.__initialDragPos,r=e,o=SS(t.canvas).k,s={x:i.x+(r.x-i.x)/o-n.x,y:i.y+(r.y-i.y)/o-n.y};["x","y"].forEach((function(e){return n["f".concat(e)]=n[e]=i[e]+(r[e]-i[e])/o})),!n.__dragged&&5>=Math.sqrt(function(e,t){let n=0;if(void 0===t)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}(["x","y"].map((function(t){return Math.pow(e[t]-i[t],2)}))))||(t.forceGraph.d3AlphaTarget(.3).resetCountdown(),t.isPointerDragging=!0,n.__dragged=!0,t.onNodeDrag(n,s))})).on("end",(function(e){var n=e.subject,i=n.__initialDragPos,r={x:n.x-i.x,y:n.y-i.y};void 0===i.fx&&(n.fx=void 0),void 0===i.fy&&(n.fy=void 0),delete n.__initialDragPos,t.forceGraph.d3AlphaTarget()&&t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.canvas.classList.remove("grabbable"),t.isPointerDragging=!1,n.__dragged&&(delete n.__dragged,t.onNodeDragEnd(n,r))}))),t.zoom(t.zoom.__baseElem=dw(t.canvas)),t.zoom.__baseElem.on("dblclick.zoom",null),t.zoom.filter((function(e){return!e.button&&t.enableZoomPanInteraction&&("wheel"!==e.type||G1(t.enableZoomInteraction)(e))&&("wheel"===e.type||G1(t.enablePanInteraction)(e))})).on("zoom",(function(e){var i=e.transform;[r,o].forEach((function(e){GAe(e),e.translate(i.x,i.y),e.scale(i.k,i.k)})),t.isPointerDragging=!0,t.onZoom&&t.onZoom(MAe(MAe({},i),n.centerAt())),t.needsRedraw=!0})).on("end",(function(e){t.isPointerDragging=!1,t.onZoomEnd&&t.onZoomEnd(MAe(MAe({},e.transform),n.centerAt()))})),VAe(t),t.forceGraph.onNeedsRedraw((function(){return t.needsRedraw=!0})).onFinishUpdate((function(){SS(t.canvas).k===t.lastSetZoom&&t.graphData.nodes.length&&(t.zoom.scaleTo(t.zoom.__baseElem,t.lastSetZoom=4/Math.cbrt(t.graphData.nodes.length)),t.needsRedraw=!0)})),t.tooltip=new nye(i),["pointermove","pointerdown"].forEach((function(e){return i.addEventListener(e,(function(n){"pointerdown"===e&&(t.isPointerPressed=!0,t.pointerDownEvent=n),!t.isPointerDragging&&"pointermove"===n.type&&t.onBackgroundClick&&(n.pressure>0||t.isPointerPressed)&&("touch"!==n.pointerType||void 0===n.movementX||[n.movementX,n.movementY].some((function(e){return Math.abs(e)>1})))&&(t.isPointerDragging=!0);var r=function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+i,left:t.left+n}}(i);s.x=n.pageX-r.left,s.y=n.pageY-r.top}),{passive:!0})})),i.addEventListener("pointerup",(function(e){if(t.isPointerPressed=!1,t.isPointerDragging)t.isPointerDragging=!1;else{var n=[e,t.pointerDownEvent];requestAnimationFrame((function(){if(0===e.button)if(t.hoverObj){var i=t["on".concat(t.hoverObj.type,"Click")];i&&i.apply(void 0,[t.hoverObj.d].concat(n))}else t.onBackgroundClick&&t.onBackgroundClick.apply(t,n);if(2===e.button)if(t.hoverObj){var r=t["on".concat(t.hoverObj.type,"RightClick")];r&&r.apply(void 0,[t.hoverObj.d].concat(n))}else t.onBackgroundRightClick&&t.onBackgroundRightClick.apply(t,n)}))}}),{passive:!0}),i.addEventListener("contextmenu",(function(e){return!(t.onBackgroundRightClick||t.onNodeRightClick||t.onLinkRightClick)||(e.preventDefault(),!1)})),t.forceGraph(r),t.shadowGraph(o);var l=Pye((function(){HAe(o,t.width,t.height),t.shadowGraph.linkWidth((function(e){return G1(t.linkWidth)(e)+t.linkHoverPrecision}));var e=SS(t.canvas);t.shadowGraph.globalScale(e.k).tickFrame()}),800);t.flushShadowCanvas=l.flush,(this._animationCycle=function e(){var n=!t.autoPauseRedraw||!!t.needsRedraw||t.forceGraph.isEngineRunning()||t.graphData.links.some((function(e){return e.__photons&&e.__photons.length}));if(t.needsRedraw=!1,t.enablePointerInteraction){var i=t.isPointerDragging?null:a();if(i!==t.hoverObj){var o=t.hoverObj,s=o?o.type:null,c=i?i.type:null;if(s&&s!==c){var u=t["on".concat(s,"Hover")];u&&u(null,o.d)}if(c){var h=t["on".concat(c,"Hover")];h&&h(i.d,s===c?o.d:null)}t.tooltip.content(i&&G1(t["".concat(i.type.toLowerCase(),"Label")])(i.d)||null),t.canvas.classList[i&&t["on".concat(c,"Click")]||!i&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=i}n&&l()}if(n){HAe(r,t.width,t.height);var d=SS(t.canvas).k;t.onRenderFramePre&&t.onRenderFramePre(r,d),t.forceGraph.globalScale(d).tickFrame(),t.onRenderFramePost&&t.onRenderFramePost(r,d)}t.tweenGroup.update(),t.animationFrameRequestId=requestAnimationFrame(e)})()},update:function(e){}}),QAe={width:T4().number,height:T4().number,graphData:T4().shape({nodes:T4().arrayOf(T4().object).isRequired,links:T4().arrayOf(T4().object).isRequired}),backgroundColor:T4().string,nodeRelSize:T4().number,nodeId:T4().string,nodeLabel:T4().oneOfType([T4().string,T4().func]),nodeVal:T4().oneOfType([T4().number,T4().string,T4().func]),nodeVisibility:T4().oneOfType([T4().bool,T4().string,T4().func]),nodeColor:T4().oneOfType([T4().string,T4().func]),nodeAutoColorBy:T4().oneOfType([T4().string,T4().func]),onNodeHover:T4().func,onNodeClick:T4().func,linkSource:T4().string,linkTarget:T4().string,linkLabel:T4().oneOfType([T4().string,T4().func]),linkVisibility:T4().oneOfType([T4().bool,T4().string,T4().func]),linkColor:T4().oneOfType([T4().string,T4().func]),linkAutoColorBy:T4().oneOfType([T4().string,T4().func]),linkWidth:T4().oneOfType([T4().number,T4().string,T4().func]),linkCurvature:T4().oneOfType([T4().number,T4().string,T4().func]),linkDirectionalArrowLength:T4().oneOfType([T4().number,T4().string,T4().func]),linkDirectionalArrowColor:T4().oneOfType([T4().string,T4().func]),linkDirectionalArrowRelPos:T4().oneOfType([T4().number,T4().string,T4().func]),linkDirectionalParticles:T4().oneOfType([T4().number,T4().string,T4().func]),linkDirectionalParticleSpeed:T4().oneOfType([T4().number,T4().string,T4().func]),linkDirectionalParticleWidth:T4().oneOfType([T4().number,T4().string,T4().func]),linkDirectionalParticleColor:T4().oneOfType([T4().string,T4().func]),onLinkHover:T4().func,onLinkClick:T4().func,dagMode:T4().oneOf(["td","bu","lr","rl","zin","zout","radialin","radialout"]),dagLevelDistance:T4().number,dagNodeFilter:T4().func,onDagError:T4().func,d3AlphaMin:T4().number,d3AlphaDecay:T4().number,d3VelocityDecay:T4().number,warmupTicks:T4().number,cooldownTicks:T4().number,cooldownTime:T4().number,onEngineTick:T4().func,onEngineStop:T4().func,getGraphBbox:T4().func},qAe={zoomToFit:T4().func,onNodeRightClick:T4().func,onNodeDrag:T4().func,onNodeDragEnd:T4().func,onLinkRightClick:T4().func,linkHoverPrecision:T4().number,onBackgroundClick:T4().func,onBackgroundRightClick:T4().func,enablePointerInteraction:T4().bool,enableNodeDrag:T4().bool},XAe={showNavInfo:T4().bool,nodeOpacity:T4().number,nodeResolution:T4().number,nodeThreeObject:T4().oneOfType([T4().object,T4().string,T4().func]),nodeThreeObjectExtend:T4().oneOfType([T4().bool,T4().string,T4().func]),linkOpacity:T4().number,linkResolution:T4().number,linkCurveRotation:T4().oneOfType([T4().number,T4().string,T4().func]),linkMaterial:T4().oneOfType([T4().object,T4().string,T4().func]),linkThreeObject:T4().oneOfType([T4().object,T4().string,T4().func]),linkThreeObjectExtend:T4().oneOfType([T4().bool,T4().string,T4().func]),linkPositionUpdate:T4().func,linkDirectionalArrowResolution:T4().number,linkDirectionalParticleResolution:T4().number,forceEngine:T4().oneOf(["d3","ngraph"]),ngraphPhysics:T4().object,numDimensions:T4().oneOf([1,2,3])},$Ae=Object.assign({},QAe,qAe,{linkLineDash:T4().oneOfType([T4().arrayOf(T4().number),T4().string,T4().func]),nodeCanvasObjectMode:T4().oneOfType([T4().string,T4().func]),nodeCanvasObject:T4().func,nodePointerAreaPaint:T4().func,linkCanvasObjectMode:T4().oneOfType([T4().string,T4().func]),linkCanvasObject:T4().func,linkPointerAreaPaint:T4().func,autoPauseRedraw:T4().bool,minZoom:T4().number,maxZoom:T4().number,enableZoomInteraction:T4().bool,enablePanInteraction:T4().bool,onZoom:T4().func,onZoomEnd:T4().func,onRenderFramePre:T4().func,onRenderFramePost:T4().func}),YAe=Object.assign({},QAe,qAe,XAe,{enableNavigationControls:T4().bool,controlType:T4().oneOf(["trackball","orbit","fly"]),rendererConfig:T4().object,extraRenderers:T4().arrayOf(T4().shape({render:T4().func.isRequired}))}),KAe=Object.assign({},QAe,XAe,{nodeDesc:T4().oneOfType([T4().string,T4().func]),linkDesc:T4().oneOfType([T4().string,T4().func])}),JAe=Object.assign({},QAe,XAe,{markerAttrs:T4().object,yOffset:T4().number,glScale:T4().number});const ZAe=CC(C4,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"]});ZAe.displayName="ForceGraphVR",ZAe.propTypes=KAe;const exe=CC(k4,{methodNames:["getGraphBbox","emitParticle","d3Force","d3ReheatSimulation","refresh"],initPropNames:["markerAttrs"]});exe.displayName="ForceGraphAR",exe.propTypes=JAe;const txe=CC(wye,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","cameraPosition","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords","postProcessingComposer","scene","camera","renderer","controls","refresh"],initPropNames:["controlType","rendererConfig","extraRenderers"]});txe.displayName="ForceGraph3D",txe.propTypes=YAe;const nxe=CC(WAe,{methodNames:["emitParticle","d3Force","d3ReheatSimulation","stopAnimation","pauseAnimation","resumeAnimation","centerAt","zoom","zoomToFit","getGraphBbox","screen2GraphCoords","graph2ScreenCoords"]});nxe.displayName="ForceGraph2D",nxe.propTypes=$Ae;const ixe=["Web Development","Mobile Development","Data Science & Analytics","UI/UX & Graphic Design","Software Engineering","AI & Machine Learning","Digital Marketing","Content Creation","Project Management","Business Analysis","DevOps & Cloud","Cybersecurity","Game Development","Blockchain Development","AR/VR Development","IoT Development","Quality Assurance","Technical Writing","IT Support","Database Management"],rxe=e=>{let{skills:t,onUpdateSkills:n}=e;const[i,r]=(0,s.useState)({nodes:[],links:[]}),[o,a]=(0,s.useState)(!1),[l,c]=(0,s.useState)({name:"",category:"",level:"beginner"}),[u,h]=(0,s.useState)(null),[d,p]=(0,s.useState)(!1),[f,m]=(0,s.useState)(null);(0,s.useEffect)((()=>{const e=[],n=[];ixe.forEach((t=>{e.push({id:`category-${t}`,name:t,type:"category",val:3,color:"#2c3e50"})})),t.forEach((t=>{e.push({id:`skill-${t._id}`,name:t.name,type:"skill",level:t.level,category:t.category,val:1,color:g(t.level)}),n.push({source:`category-${t.category}`,target:`skill-${t._id}`,color:g(t.level)})})),r({nodes:e,links:n})}),[t]);const g=e=>{switch(e){case"beginner":return"#3498db";case"intermediate":return"#2ecc71";case"advanced":return"#f1c40f";case"expert":return"#e74c3c";default:return"#95a5a6"}},v=()=>{a(!1),h(null),p(!1),c({name:"",category:"",level:"beginner"})};return(0,We.jsxs)(ci,{sx:{height:"400px",width:"100%",position:"relative",bgcolor:"#f8f9fa",borderRadius:2,overflow:"hidden",border:"1px solid rgba(0, 0, 0, 0.1)"},children:[(0,We.jsx)(nxe,{graphData:i,nodeLabel:"name",nodeRelSize:6,linkWidth:1,linkDirectionalParticles:1,linkDirectionalParticleSpeed:.004,d3Force:-1e3,d3VelocityDecay:.3,onNodeClick:e=>{"skill"===e.type&&(h(e),c({name:e.name,category:e.category,level:e.level}),p(!0),a(!0))},onNodeHover:m,nodeCanvasObject:(e,t,n)=>{const i=e.name,r="category"===e.type?14:12;t.font=`${r}px Sans-Serif`,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,"category"===e.type?8:6,0,2*Math.PI),t.fill(),t.fillStyle="#000",t.textAlign="center",t.textBaseline="middle",t.fillText(i,e.x,e.y+15)}}),(0,We.jsx)(ci,{sx:{position:"absolute",top:16,right:16},children:(0,We.jsx)(Cn,{variant:"contained",startIcon:(0,We.jsx)(kb,{}),onClick:()=>{p(!1),h(null),c({name:"",category:"",level:"beginner"}),a(!0)},children:"Add Skill"})}),(0,We.jsxs)(Kx,{open:o,onClose:v,maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(nb,{children:d?"Edit Skill":"Add New Skill"}),(0,We.jsx)(sb,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,We.jsx)(Jy,{select:!0,label:"Category",value:l.category,onChange:e=>c({...l,category:e.target.value}),fullWidth:!0,required:!0,children:ixe.map((e=>(0,We.jsx)(Vo,{value:e,children:e},e)))}),(0,We.jsx)(Jy,{label:"Skill Name",value:l.name,onChange:e=>c({...l,name:e.target.value}),fullWidth:!0,required:!0}),(0,We.jsxs)(Jy,{select:!0,label:"Level",value:l.level,onChange:e=>c({...l,level:e.target.value}),fullWidth:!0,required:!0,children:[(0,We.jsx)(Vo,{value:"beginner",children:"Beginner"}),(0,We.jsx)(Vo,{value:"intermediate",children:"Intermediate"}),(0,We.jsx)(Vo,{value:"advanced",children:"Advanced"}),(0,We.jsx)(Vo,{value:"expert",children:"Expert"})]})]})}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:v,children:"Cancel"}),d?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Cn,{onClick:()=>{if(!u)return;const e=u.id.replace("skill-",""),i=t.filter((t=>t._id!==e));n(i),a(!1),h(null),p(!1)},color:"error",children:"Delete"}),(0,We.jsx)(Cn,{onClick:()=>{if(!l.name||!l.category||!l.level||!u)return;const e=u.id.replace("skill-",""),i=t.map((t=>t._id===e?{...t,...l}:t));n(i),a(!1),p(!1),h(null),c({name:"",category:"",level:"beginner"})},variant:"contained",children:"Update"})]}):(0,We.jsx)(Cn,{onClick:()=>{if(!l.name||!l.category||!l.level)return;const e=[...t,{_id:Date.now().toString(),...l}];n(e),a(!1),c({name:"",category:"",level:"beginner"})},variant:"contained",children:"Add"})]})]})]})},oxe=(0,ji.A)((0,We.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),sxe=(0,ji.A)((0,We.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),axe=(0,ji.A)((0,We.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function lxe(e){return(0,Et.Ay)("MuiCheckbox",e)}const cxe=(0,wt.A)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),uxe=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],hxe=(0,At.Ay)(Ax,{shouldForwardProp:e=>(0,Dt.A)(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${(0,xt.A)(n.size)}`],"default"!==n.color&&t[`color${(0,xt.A)(n.color)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({color:(t.vars||t).palette.text.secondary},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${"default"===n.color?t.vars.palette.action.activeChannel:t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,bt.X4)("default"===n.color?t.palette.action.active:t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{[`&.${cxe.checked}, &.${cxe.indeterminate}`]:{color:(t.vars||t).palette[n.color].main},[`&.${cxe.disabled}`]:{color:(t.vars||t).palette.action.disabled}})})),dxe=(0,We.jsx)(sxe,{}),pxe=(0,We.jsx)(oxe,{}),fxe=(0,We.jsx)(axe,{}),mxe=s.forwardRef((function(e,t){var n,i;const r=(0,st.b)({props:e,name:"MuiCheckbox"}),{checkedIcon:o=dxe,color:a="primary",icon:l=pxe,indeterminate:c=!1,indeterminateIcon:u=fxe,inputProps:h,size:d="medium",className:p}=r,f=(0,je.A)(r,uxe),m=c?u:l,g=c?u:o,v=(0,ze.A)({},r,{color:a,indeterminate:c,size:d}),y=(e=>{const{classes:t,indeterminate:n,color:i,size:r}=e,o={root:["root",n&&"indeterminate",`color${(0,xt.A)(i)}`,`size${(0,xt.A)(r)}`]},s=(0,yt.A)(o,lxe,t);return(0,ze.A)({},t,s)})(v);return(0,We.jsx)(hxe,(0,ze.A)({type:"checkbox",inputProps:(0,ze.A)({"data-indeterminate":c},h),icon:s.cloneElement(m,{fontSize:null!=(n=m.props.fontSize)?n:d}),checkedIcon:s.cloneElement(g,{fontSize:null!=(i=g.props.fontSize)?i:d}),ownerState:v,ref:t,className:(0,vt.A)(y.root,p)},f,{classes:y}))})),gxe=[{id:"web-development",name:"Web Development",children:[{id:"frontend",name:"Frontend",children:[{id:"markup-styling",name:"Markup & Styling",skills:[{id:"html5",name:"HTML5"},{id:"css3",name:"CSS3"},{id:"sass",name:"Sass/SCSS"},{id:"less",name:"LESS"},{id:"bootstrap",name:"Bootstrap"},{id:"tailwind",name:"Tailwind CSS"},{id:"material-ui",name:"Material-UI"}]},{id:"programming",name:"Programming",skills:[{id:"javascript",name:"JavaScript (ES6+)"},{id:"typescript",name:"TypeScript"},{id:"coffeescript",name:"CoffeeScript"}]},{id:"frameworks-libraries",name:"Frameworks/Libraries",skills:[{id:"react",name:"React"},{id:"redux",name:"Redux"},{id:"angular",name:"Angular (AngularJS, Angular 2+)"},{id:"vue",name:"Vue.js (Vuex, Nuxt.js)"},{id:"ember",name:"Ember.js"},{id:"jquery",name:"jQuery"}]},{id:"state-management-routing",name:"State Management & Routing",skills:[{id:"redux-toolkit",name:"Redux Toolkit"},{id:"mobx",name:"MobX"},{id:"react-router",name:"React Router"},{id:"vue-router",name:"Vue Router"},{id:"nextjs",name:"Next.js"},{id:"gatsby",name:"Gatsby"}]},{id:"frontend-concepts",name:"Concepts",skills:[{id:"responsive-design",name:"Responsive Design"},{id:"mobile-first",name:"Mobile-First Design"},{id:"pwa",name:"Progressive Web Apps (PWA)"},{id:"spa",name:"Single Page Applications (SPA)"},{id:"cross-browser",name:"Cross-Browser Compatibility"},{id:"accessibility",name:"Web Accessibility (WCAG)"},{id:"seo",name:"SEO Best Practices"}]}]},{id:"backend",name:"Backend",children:[{id:"languages-frameworks",name:"Languages/Frameworks",skills:[{id:"nodejs",name:"Node.js (Express.js, Koa, Hapi, NestJS)"},{id:"php",name:"PHP (Laravel, Symfony, CodeIgniter, Zend)"},{id:"python",name:"Python (Django, Flask, Pyramid, FastAPI)"},{id:"ruby",name:"Ruby (Rails, Sinatra)"},{id:"java",name:"Java (Spring Boot, Java EE, Jakarta EE)"},{id:"csharp",name:"C# (.NET, ASP.NET MVC/Core)"},{id:"go",name:"Go (Gin, Echo)"},{id:"scala",name:"Scala (Play Framework)"}]},{id:"apis",name:"APIs",skills:[{id:"rest",name:"RESTful API"},{id:"graphql",name:"GraphQL (Apollo Server, Relay)"},{id:"soap",name:"SOAP"},{id:"websockets",name:"WebSockets"},{id:"grpc",name:"gRPC"}]},{id:"database-integration",name:"Database Integration",skills:[{id:"sql",name:"SQL (MySQL, PostgreSQL, MSSQL, SQLite, Oracle)"},{id:"nosql",name:"NoSQL (MongoDB, Cassandra, CouchDB, Firebase)"},{id:"in-memory",name:"In-Memory (Redis, Memcached)"}]},{id:"auth-security",name:"Authentication & Security",skills:[{id:"jwt",name:"JWT"},{id:"oauth",name:"OAuth"},{id:"passport",name:"Passport.js"},{id:"bcrypt",name:"bcrypt"},{id:"cors",name:"CORS"},{id:"csrf",name:"CSRF Protection"}]}]},{id:"fullstack",name:"Full-Stack/Other",children:[{id:"stacks-architectures",name:"Stacks & Architectures",skills:[{id:"mern",name:"MERN"},{id:"mean",name:"MEAN"},{id:"pern",name:"PERN"},{id:"jamstack",name:"JAMstack"},{id:"lamp",name:"LAMP"}]},{id:"tools",name:"Tools",skills:[{id:"git",name:"Git/GitHub"},{id:"docker",name:"Docker"},{id:"kubernetes",name:"Kubernetes"},{id:"cicd",name:"CI/CD (Jenkins, GitLab CI)"},{id:"nginx",name:"Nginx"},{id:"apache",name:"Apache"},{id:"webpack",name:"Webpack"},{id:"babel",name:"Babel"},{id:"eslint",name:"ESLint"},{id:"prettier",name:"Prettier"}]},{id:"testing",name:"Testing",skills:[{id:"jest",name:"Jest"},{id:"mocha",name:"Mocha"},{id:"chai",name:"Chai"},{id:"cypress",name:"Cypress"},{id:"selenium",name:"Selenium"},{id:"puppeteer",name:"Puppeteer"}]}]}]},{id:"game-development",name:"Game Development",children:[]},{id:"app-development",name:"App Development",children:[]},{id:"data-science-analytics",name:"Data Science & Analytics",children:[]},{id:"ui-ux-graphic-design",name:"UI/UX & Graphic Design",children:[]},{id:"software-engineering",name:"Software Engineering",children:[]},{id:"cybersecurity",name:"Cybersecurity",children:[]},{id:"cloud-computing-devops",name:"Cloud Computing & DevOps",children:[]},{id:"digital-marketing",name:"Digital Marketing",children:[]},{id:"content-creation",name:"Content Creation",children:[]},{id:"product-management",name:"Product Management",children:[]},{id:"quality-assurance-testing",name:"Quality Assurance & Testing",children:[]},{id:"business-analysis",name:"Business Analysis",children:[]},{id:"customer-technical-support",name:"Customer & Technical Support",children:[]},{id:"ecommerce-retail-tech",name:"E-commerce & Retail Tech",children:[]},{id:"ai-machine-learning",name:"AI & Machine Learning",children:[]},{id:"iot-embedded-systems",name:"IoT & Embedded Systems",children:[]},{id:"blockchain-cryptocurrency",name:"Blockchain & Cryptocurrency",children:[]},{id:"ar-vr-development",name:"AR/VR Development",children:[]},{id:"networking-system-administration",name:"Networking & System Administration",children:[]}],vxe=(0,At.Ay)("div")({position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1300}),yxe=(0,At.Ay)(Tt)((e=>{let{theme:t}=e;return{background:t.palette.background.default,borderRadius:24,border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",width:"100%",maxWidth:600,maxHeight:"90vh",overflow:"auto",position:"relative",outline:"none",margin:t.spacing(2)}})),Axe=(0,At.Ay)(Tt)((e=>{let{theme:t}=e;return{background:"transparent",padding:t.spacing(2),marginTop:t.spacing(2)}})),xxe=e=>{var t,n,i,r;let{open:o,onClose:a,onSave:l}=e;const[c,u]=(0,s.useState)(""),[h,d]=(0,s.useState)(""),[p,f]=(0,s.useState)(""),[m,g]=(0,s.useState)([]),[v,y]=(0,s.useState)(!1),A=(0,s.useRef)(null);(0,s.useLayoutEffect)((()=>{if(!o){const e=setTimeout((()=>{y(!1)}),300);return()=>clearTimeout(e)}y(!0)}),[o]);const x=()=>{u(""),d(""),f(""),g([]),a()},b=[...gxe].sort(((e,t)=>e.name.localeCompare(t.name))),_=gxe.find((e=>e.id===c)),w=null===_||void 0===_||null===(t=_.children)||void 0===t?void 0:t.find((e=>e.id===h)),E=null===w||void 0===w||null===(n=w.children)||void 0===n?void 0:n.find((e=>e.id===p)),S=(null===E||void 0===E?void 0:E.skills)||[],C=Boolean(null===_||void 0===_||null===(i=_.children)||void 0===i?void 0:i.length),M=Boolean(null===w||void 0===w||null===(r=w.children)||void 0===r?void 0:r.length),T=Boolean(S.length);return o||v?(0,We.jsx)(vxe,{ref:A,children:(0,We.jsx)(uo,{open:o,onClose:x,container:A.current,disablePortal:!0,hideBackdrop:!0,children:(0,We.jsxs)(yxe,{children:[(0,We.jsx)(ci,{sx:{p:2,borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:(0,We.jsxs)(ci,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,We.jsx)(Ln,{variant:"h6",children:"Select Skills"}),(0,We.jsx)(wi,{onClick:x,size:"small",children:(0,We.jsx)(Zy,{})})]})}),(0,We.jsx)(ci,{sx:{p:2},children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,We.jsxs)(dy,{fullWidth:!0,variant:"outlined",size:"medium",children:[(0,We.jsx)(ly,{children:"Select a category"}),(0,We.jsx)(qy,{value:c,onChange:e=>{u(e.target.value),d(""),f(""),g([])},label:"Select a category",children:b.map((e=>(0,We.jsx)(Vo,{value:e.id,children:e.name},e.id)))})]}),C&&c&&(0,We.jsxs)(dy,{fullWidth:!0,variant:"outlined",size:"medium",children:[(0,We.jsx)(ly,{children:"Select a subcategory"}),(0,We.jsx)(qy,{value:h,onChange:e=>{d(e.target.value),f(""),g([])},label:"Select a subcategory",children:null===_||void 0===_?void 0:_.children.map((e=>(0,We.jsx)(Vo,{value:e.id,children:e.name},e.id)))})]}),M&&h&&(0,We.jsxs)(dy,{fullWidth:!0,variant:"outlined",size:"medium",children:[(0,We.jsx)(ly,{children:"Select a specialization"}),(0,We.jsx)(qy,{value:p,onChange:e=>{f(e.target.value),g([])},label:"Select a specialization",children:null===w||void 0===w?void 0:w.children.map((e=>(0,We.jsx)(Vo,{value:e.id,children:e.name},e.id)))})]}),T&&(p||!M&&h)&&(0,We.jsxs)(Axe,{elevation:0,children:[(0,We.jsxs)(Ln,{variant:"subtitle1",gutterBottom:!0,children:["Select Skills (",m.length," selected)"]}),(0,We.jsx)(rr,{sx:{maxHeight:400,overflow:"auto",pt:0,"& .MuiListItem-root":{py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}},children:S.map((e=>(0,We.jsxs)(bl,{dense:!0,button:!0,onClick:()=>{return t=e.id,void g((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]));var t},sx:{py:1,borderRadius:1,mb:.5},children:[(0,We.jsx)(mxe,{edge:"start",checked:m.includes(e.id),tabIndex:-1,disableRipple:!0,sx:{color:"rgba(255, 255, 255, 0.7)","&.Mui-checked":{color:"primary.main"}}}),(0,We.jsx)(Ml,{primary:e.name,sx:{"& .MuiListItemText-primary":{fontSize:"0.95rem"}}})]},e.id)))})]})]})}),(0,We.jsxs)(ci,{sx:{p:2,borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"flex-end",gap:1,backgroundColor:"rgba(0, 0, 0, 0.2)"},children:[(0,We.jsx)(Cn,{onClick:x,children:"CANCEL"}),(0,We.jsxs)(Cn,{variant:"contained",onClick:()=>{if(l){const e={category:_,subcategory:w,subSubcategory:E,skills:S.filter((e=>m.includes(e.id)))};l(e)}x()},disabled:!c||C&&!h||M&&!p||T&&0===m.length,children:["SAVE (",m.length," skills)"]})]})]})})}):null};const{abs:bxe,max:_xe,min:wxe}=Math;function Exe(e){return[+e[0],+e[1]]}function Sxe(e){return[Exe(e[0]),Exe(e[1])]}["w","e"].map(Cxe),["n","s"].map(Cxe),["n","w","e","s","nw","ne","sw","se"].map(Cxe);function Cxe(e){return{type:e}}(0,At.Ay)(Tt)((e=>{let{theme:t}=e;return{padding:t.spacing(2),background:"rgba(30, 41, 59, 0.7)",backdropFilter:"blur(20px)",border:"1px solid rgba(255, 255, 255, 0.05)",borderRadius:12}}));const Mxe=e=>{let{userId:t,userRole:n,currentUser:i}=e;const[r,o]=(0,s.useState)([]),[a,l]=(0,s.useState)(0),[c,u]=(0,s.useState)(!1),[h,d]=(0,s.useState)({rating:0,comment:""}),[p,f]=(0,s.useState)(null),[m,g]=(0,s.useState)(!1),[v,y]=(0,s.useState)(!1),A=oe();(0,s.useEffect)((()=>{x()}),[t]);const x=async()=>{try{g(!0);const e=localStorage.getItem("token"),n=await rl.get(`http://localhost:5000/api/ratings/${t}`,{headers:{Authorization:`Bearer ${e}`}});o(n.data);const i=n.data.reduce(((e,t)=>e+t.rating),0)/n.data.length;l(i||0)}catch(p){console.error("Error fetching ratings:",p),f("Failed to fetch ratings")}finally{g(!1)}},b=i&&i._id!==t;return(0,We.jsxs)(ci,{children:[(0,We.jsxs)(ci,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,We.jsx)(Rb,{value:a,precision:.1,readOnly:!0,size:"large",sx:{color:"primary.main"}}),(0,We.jsxs)(Ln,{variant:"body1",sx:{ml:1},children:["(",r.length," ",1===r.length?"review":"reviews",")"]}),b&&(0,We.jsx)(wi,{onClick:()=>u(!0),sx:{ml:"auto"},children:(0,We.jsx)(Nb,{})})]}),m?(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",p:2},children:(0,We.jsx)(jA,{size:24})}):p?(0,We.jsx)(MA,{severity:"error",children:p}):(0,We.jsx)(ci,{sx:{mt:2},children:r.map((e=>(0,We.jsxs)(ci,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,We.jsx)($A,{component:"button",variant:"body1",onClick:()=>{return t=e.rater._id,void A(`/profile/${t}`);var t},sx:{textDecoration:"none",fontWeight:"bold"},children:e.rater.name}),(0,We.jsx)(Rb,{value:e.rating,readOnly:!0,size:"small"})]}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",children:e.comment}),(0,We.jsx)(Ln,{variant:"caption",color:"text.secondary",children:new Date(e.createdAt).toLocaleDateString()})]},e._id)))}),(0,We.jsxs)(Kx,{open:c,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(nb,{children:"Write a Review"}),(0,We.jsx)(sb,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[p&&(0,We.jsx)(MA,{severity:"error",children:p}),(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,We.jsx)(Rb,{value:h.rating,onChange:(e,t)=>{d({...h,rating:t})},size:"large",sx:{color:"primary.main"}}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",children:0===h.rating?"Select your rating":1===h.rating?"Poor":2===h.rating?"Fair":3===h.rating?"Good":4===h.rating?"Very Good":"Excellent"})]}),(0,We.jsx)(Jy,{label:"Write your review",multiline:!0,rows:4,value:h.comment,onChange:e=>d({...h,comment:e.target.value}),fullWidth:!0,required:!0,placeholder:"Share your experience with this user..."})]})}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:()=>u(!1),children:"Cancel"}),(0,We.jsx)(Cn,{variant:"contained",onClick:async()=>{try{y(!0),f(null);const e=localStorage.getItem("token");if(!e)return void f("Please log in to submit a rating");await rl.post("http://localhost:5000/api/ratings",{ratedUser:t,rating:h.rating,comment:h.comment},{headers:{Authorization:`Bearer ${e}`}}),u(!1),d({rating:0,comment:""}),x()}catch(p){var e,n;console.error("Error submitting rating:",p),f((null===(e=p.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Failed to submit rating. Please try again.")}finally{y(!1)}},disabled:v||0===h.rating||!h.comment.trim(),children:v?(0,We.jsx)(jA,{size:24}):"Submit Review"})]})]})]})},Txe=((0,At.Ay)(Ji)((e=>{let{theme:t}=e;return{width:150,height:150,border:`4px solid ${t.palette.primary.main}`,boxShadow:t.shadows[3]}})),(0,At.Ay)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),(0,At.Ay)(Tt)((e=>{let{theme:t}=e;return{padding:t.spacing(3),marginBottom:t.spacing(3),background:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)"}})),()=>{const{id:e}=se(),t=oe(),{user:n,updateProfile:i,updateSkills:r,updateProfilePicture:o}=sl(),[a,l]=(0,s.useState)(null),[c,u]=(0,s.useState)({name:"",bio:"",college:"",major:"",graduationYear:"",company:"",position:"",companyWebsite:"",contactInfo:{phone:"",linkedin:"",github:"",website:""}}),[h,d]=(0,s.useState)([]),[p,f]=(0,s.useState)([]),[m,g]=(0,s.useState)([]),[v,y]=(0,s.useState)([]),[A,x]=(0,s.useState)(!0),[b,_]=(0,s.useState)(""),[w,E]=(0,s.useState)(!1),[S,C]=(0,s.useState)(!1),[M,T]=(0,s.useState)({name:"",category:"",level:"beginner"}),[R,I]=(0,s.useState)({title:"",description:"",imageUrl:"",projectUrl:"",technologies:[]}),[P,B]=(0,s.useState)(0),[L,N]=(0,s.useState)(!1),[D,k]=(0,s.useState)(!1),[O,U]=(0,s.useState)(!1),[F,z]=((0,s.useRef)(),(0,s.useState)(!1)),[j,V]=(0,s.useState)(!1),[G,H]=(0,s.useState)(!1),[W,Q]=(0,s.useState)({rating:0,comment:""}),[q,X]=(0,s.useState)(null),[$,Y]=(0,s.useState)(!1),[K,J]=(0,s.useState)([]),[Z,ee]=(0,s.useState)(!1),[te,ne]=(0,s.useState)({});h.reduce(((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e)),{});(0,s.useEffect)((()=>{ie()}),[e,null===n||void 0===n?void 0:n._id]),(0,s.useEffect)((()=>{"recruiter"===(null===a||void 0===a?void 0:a.role)&&re()}),[a]);const ie=async()=>{try{x(!0);const t=localStorage.getItem("token"),i=(await rl.get(`http://localhost:5000/api/users/${e||n._id}`,{headers:{Authorization:`Bearer ${t}`}})).data;l(i),u({name:i.name||"",bio:i.bio||"",college:i.college||"",major:i.major||"",graduationYear:i.graduationYear||"",company:i.company||"",position:i.position||"",companyWebsite:i.companyWebsite||"",contactInfo:i.contactInfo||{phone:"",linkedin:"",github:"",website:""}});const r=(i.skills||[]).map((e=>{var t;return{_id:e._id||Date.now().toString(),name:e.name,category:e.category,level:(null===(t=e.level)||void 0===t?void 0:t.toLowerCase())||"beginner"}}));d(r),f(i.portfolio||[]),g(i.previousGigs||[])}catch(b){var t,i;console.error("Error fetching user profile:",b),_((null===(t=b.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||"Failed to fetch user profile")}finally{x(!1)}},re=async()=>{try{const t=localStorage.getItem("token"),i=e||(null===n||void 0===n?void 0:n._id);if(!i)return void console.error("No user ID available");const r=await rl.get(`http://localhost:5000/api/jobs/recruiter/${i}`,{headers:{Authorization:`Bearer ${t}`}});y(r.data),x(!1)}catch(b){var t,i;console.error("Error fetching active gigs:",b),_((null===(t=b.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||"Failed to fetch active gigs"),x(!1)}},ae=!e||e===(null===n||void 0===n?void 0:n._id),le=async e=>{const t=e.target.files[0];if(t)try{U(!0);const e=new FormData;e.append("profilePicture",t);const i=localStorage.getItem("token"),r=`http://localhost:5000/${(await rl.post("http://localhost:5000/api/users/profile-picture",e,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"multipart/form-data"}})).data.profilePicture}`;l((e=>({...e,profilePicture:r}))),n._id===a._id&&await o(r)}catch(b){var i,r;console.error("Error uploading profile picture:",b),_((null===(i=b.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||"Failed to upload profile picture")}finally{U(!1)}},ce=async e=>{try{await r(e),d(e),V(!1)}catch(b){console.error("Error updating skills:",b)}},ue=async e=>{const t=e.target.files[0];if(t)try{U(!0);const e=new FormData;e.append("resume",t);const n=localStorage.getItem("token"),i=await rl.post("http://localhost:5000/api/users/resume",e,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"}}),r={};i.data.skills.forEach((e=>{r[e]={category:"",level:"beginner"}})),ne(r),J(i.data.skills||[]),ee(!0),ie()}catch(b){var n,i;console.error("Error uploading resume:",b),_((null===(n=b.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Failed to upload resume")}finally{U(!1)}},he=(e,t,n)=>{ne((i=>({...i,[e]:{...i[e],[t]:n}})))};if(A)return(0,We.jsx)(Zn,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh"},children:(0,We.jsx)(jA,{})});if(b)return(0,We.jsx)(Zn,{children:(0,We.jsx)(MA,{severity:"error",children:b})});if(!a)return(0,We.jsx)(Zn,{children:(0,We.jsx)(MA,{severity:"error",children:"User not found"})});return(0,We.jsxs)(Zn,{maxWidth:"lg",sx:{py:4},children:["student"===(null===a||void 0===a?void 0:a.role)?(()=>{var e,i,r,o,s,l,u;return(0,We.jsxs)(Xl,{container:!0,spacing:3,children:[(0,We.jsx)(Xl,{item:!0,xs:12,md:4,children:(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,textAlign:"center"},children:[(0,We.jsxs)(ci,{sx:{position:"relative",display:"inline-block"},children:[(0,We.jsx)(Ji,{src:null===a||void 0===a?void 0:a.profilePicture,sx:{width:120,height:120,margin:"0 auto 16px"}}),ae&&(0,We.jsxs)(wi,{component:"label",sx:{position:"absolute",bottom:8,right:8,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},disabled:O,children:[(0,We.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:le}),O?(0,We.jsx)(jA,{size:24}):(0,We.jsx)(Ib,{})]})]}),(0,We.jsx)(Ln,{variant:"h5",gutterBottom:!0,children:c.name}),(0,We.jsx)(Ln,{color:"textSecondary",gutterBottom:!0,children:c.college}),(0,We.jsxs)(Ln,{color:"textSecondary",gutterBottom:!0,children:[c.major," \u2022 Class of ",c.graduationYear]}),ae&&(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Nb,{}),onClick:()=>z(!0),sx:{mt:2},children:"Edit Profile"}),(0,We.jsx)(ci,{sx:{mt:3},children:(0,We.jsx)(Mxe,{userId:a._id,userRole:"student",currentUser:a})}),n&&n._id!==a._id&&(0,We.jsxs)(yi,{direction:"row",spacing:2,sx:{mt:2,justifyContent:"center"},children:[(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Bb,{}),onClick:()=>t(`/messages/${a._id}`),children:"Message"}),(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Lb,{}),onClick:()=>H(!0),children:"Write Review"})]})]})}),(0,We.jsxs)(Xl,{item:!0,xs:12,md:8,children:[(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,mb:3},children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:"About Me"}),(0,We.jsx)(Ln,{paragraph:!0,children:c.bio||"No bio available"})]}),(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,mb:3},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(Ln,{variant:"h6",children:"Skills"}),ae&&(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(kb,{}),onClick:()=>V(!0),children:"Manage Skills"})]}),(0,We.jsx)(rxe,{skills:h,onUpdateSkills:ce})]}),(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,mb:3},children:[(0,We.jsxs)(ci,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,We.jsx)(Ln,{variant:"h6",children:"Portfolio"}),ae&&(0,We.jsx)(wi,{onClick:()=>C(!0),children:(0,We.jsx)(kb,{})})]}),(0,We.jsx)(Xl,{container:!0,spacing:2,children:p.map(((e,t)=>(0,We.jsx)(Xl,{item:!0,xs:12,sm:6,children:(0,We.jsxs)(Tt,{elevation:2,sx:{p:2},children:[(0,We.jsx)(Ln,{variant:"subtitle1",gutterBottom:!0,children:e.title}),(0,We.jsx)(Ln,{variant:"body2",color:"textSecondary",paragraph:!0,children:e.description}),e.projectUrl&&(0,We.jsx)(Cn,{variant:"outlined",size:"small",href:e.projectUrl,target:"_blank",rel:"noopener noreferrer",children:"View Project"}),ae&&(0,We.jsx)(wi,{size:"small",onClick:()=>{},sx:{ml:1},children:(0,We.jsx)(Ob,{})})]})},t)))})]}),(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,mb:3},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(Ln,{variant:"h6",children:"Resume"}),ae&&(0,We.jsxs)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Ub,{}),component:"label",disabled:O,children:[O?"Uploading...":"Upload Resume",(0,We.jsx)("input",{type:"file",hidden:!0,accept:".pdf",onChange:ue})]})]}),null!==(e=a.resume)&&void 0!==e&&e.file?(0,We.jsxs)(ci,{children:[(0,We.jsxs)(Ln,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Last updated: ",new Date(a.resume.lastUpdated).toLocaleDateString()]}),(0,We.jsxs)(ci,{sx:{mt:2},children:[(0,We.jsx)(Ln,{variant:"subtitle2",gutterBottom:!0,children:"Extracted Skills:"}),(0,We.jsx)(ci,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:a.resume.parsedSkills.map(((e,t)=>(0,We.jsx)(Vx,{label:e,size:"small",color:"primary",variant:"outlined"},t)))})]}),(0,We.jsx)(ci,{sx:{mt:2},children:(0,We.jsx)(Cn,{variant:"text",size:"small",startIcon:(0,We.jsx)(Fb,{}),href:`http://localhost:5000/${a.resume.file}`,target:"_blank",children:"View Resume"})})]}):(0,We.jsx)(Ln,{color:"text.secondary",children:"No resume uploaded yet."})]}),(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,mb:3},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(Ln,{variant:"h6",children:"Contact Information"}),ae&&(0,We.jsx)(wi,{onClick:()=>z(!0),children:(0,We.jsx)(Nb,{})})]}),(0,We.jsxs)(yi,{spacing:2,children:[(0,We.jsxs)(Ln,{children:[(0,We.jsx)("strong",{children:"Email:"})," ",a.email]}),(null===(i=c.contactInfo)||void 0===i?void 0:i.phone)&&(0,We.jsxs)(Ln,{children:[(0,We.jsx)("strong",{children:"Phone:"})," ",c.contactInfo.phone]}),(null===(r=c.contactInfo)||void 0===r?void 0:r.linkedin)&&(0,We.jsxs)($A,{href:c.contactInfo.linkedin,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center"},children:[(0,We.jsx)(Db,{sx:{mr:1}}),"LinkedIn Profile"]}),(null===(o=c.contactInfo)||void 0===o?void 0:o.website)&&(0,We.jsxs)($A,{href:c.contactInfo.website,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center"},children:[(0,We.jsx)(Pb,{sx:{mr:1}}),"Personal Website"]}),!(null!==(s=c.contactInfo)&&void 0!==s&&s.phone)&&!(null!==(l=c.contactInfo)&&void 0!==l&&l.linkedin)&&!(null!==(u=c.contactInfo)&&void 0!==u&&u.website)&&(0,We.jsx)(Ln,{color:"text.secondary",children:"No additional contact information added yet."})]})]})]})]})})():(()=>{var e,i,r,o,s,l;return(0,We.jsxs)(Xl,{container:!0,spacing:3,children:[(0,We.jsx)(Xl,{item:!0,xs:12,md:4,children:(0,We.jsxs)(Tt,{sx:{p:3,textAlign:"center"},children:[(0,We.jsxs)(ci,{sx:{position:"relative",display:"inline-block"},children:[(0,We.jsx)(Ji,{src:null===a||void 0===a?void 0:a.profilePicture,sx:{width:120,height:120,mx:"auto",mb:2}}),ae&&(0,We.jsxs)(wi,{component:"label",sx:{position:"absolute",bottom:8,right:8,bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},disabled:O,children:[(0,We.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:le}),O?(0,We.jsx)(jA,{size:24}):(0,We.jsx)(Ib,{})]})]}),(0,We.jsx)(Ln,{variant:"h5",gutterBottom:!0,children:c.name}),(0,We.jsx)(Ln,{color:"text.secondary",gutterBottom:!0,children:c.position}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",children:c.company}),c.companyWebsite&&(0,We.jsxs)($A,{href:c.companyWebsite,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center",mt:1},children:[(0,We.jsx)(Pb,{sx:{mr:.5}}),"Company Website"]}),(0,We.jsx)(ci,{sx:{mt:3},children:(0,We.jsx)(Mxe,{userId:a._id,userRole:"recruiter",currentUser:a})}),n&&n._id!==a._id&&(0,We.jsxs)(yi,{direction:"row",spacing:2,sx:{mt:2,justifyContent:"center"},children:[(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Bb,{}),onClick:()=>t(`/messages/${a._id}`),children:"Message"}),(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Lb,{}),onClick:()=>H(!0),children:"Write Review"})]})]})}),(0,We.jsxs)(Xl,{item:!0,xs:12,md:8,children:[(0,We.jsxs)(Tt,{sx:{p:3,mb:3},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(Ln,{variant:"h6",children:"About"}),ae&&(0,We.jsx)(wi,{onClick:()=>z(!0),children:(0,We.jsx)(Nb,{})})]}),(0,We.jsx)(Ln,{variant:"body1",color:"text.secondary",children:c.bio||"No bio added yet."})]}),(0,We.jsxs)(Tt,{sx:{p:3,mb:3},children:[(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,We.jsx)(Ln,{variant:"h6",children:"Active Gigs"})}),A?(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,We.jsx)(jA,{})}):b?(0,We.jsx)(Ln,{color:"error",children:b}):v.length>0?(0,We.jsx)(yi,{spacing:2,children:v.map((e=>{var n;return(0,We.jsx)(Tt,{sx:{p:2},children:(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,We.jsxs)(ci,{children:[(0,We.jsx)(Ln,{variant:"subtitle1",gutterBottom:!0,children:e.title}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",paragraph:!0,children:e.description}),(0,We.jsxs)(yi,{direction:"row",spacing:1,children:[(0,We.jsx)(Vx,{label:e.status,color:"Open"===e.status?"success":"default",size:"small"}),(0,We.jsx)(Vx,{label:`${(null===(n=e.applicants)||void 0===n?void 0:n.length)||0} applications`,size:"small"})]})]}),(0,We.jsx)(Cn,{variant:"outlined",size:"small",onClick:()=>t(`/jobs/${e._id}`),children:"View Details"})]})},e._id)}))}):(0,We.jsx)(Ln,{color:"text.secondary",children:ae?"No active gigs. Create your first gig to start hiring!":"No active gigs at the moment."})]}),(0,We.jsxs)(Tt,{elevation:3,sx:{p:3,mb:3},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(Ln,{variant:"h6",children:"Contact Information"}),ae&&(0,We.jsx)(wi,{onClick:()=>z(!0),children:(0,We.jsx)(Nb,{})})]}),(0,We.jsxs)(yi,{spacing:2,children:[(0,We.jsxs)(Ln,{children:[(0,We.jsx)("strong",{children:"Email:"})," ",a.email]}),(null===(e=c.contactInfo)||void 0===e?void 0:e.phone)&&(0,We.jsxs)(Ln,{children:[(0,We.jsx)("strong",{children:"Phone:"})," ",c.contactInfo.phone]}),(null===(i=c.contactInfo)||void 0===i?void 0:i.linkedin)&&(0,We.jsxs)($A,{href:c.contactInfo.linkedin,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center"},children:[(0,We.jsx)(Db,{sx:{mr:1}}),"LinkedIn Profile"]}),(null===(r=c.contactInfo)||void 0===r?void 0:r.website)&&(0,We.jsxs)($A,{href:c.contactInfo.website,target:"_blank",rel:"noopener noreferrer",sx:{display:"inline-flex",alignItems:"center"},children:[(0,We.jsx)(Pb,{sx:{mr:1}}),"Personal Website"]}),!(null!==(o=c.contactInfo)&&void 0!==o&&o.phone)&&!(null!==(s=c.contactInfo)&&void 0!==s&&s.linkedin)&&!(null!==(l=c.contactInfo)&&void 0!==l&&l.website)&&(0,We.jsx)(Ln,{color:"text.secondary",children:"No additional contact information added yet."})]})]}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(yi,{direction:"row",spacing:2,justifyContent:"flex-end",children:n&&n._id!==a._id&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Bb,{}),onClick:()=>t(`/messages/${a._id}`),children:"Message"}),(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Lb,{}),onClick:()=>H(!0),children:"Write Review"})]})})})]})]})})(),(0,We.jsxs)(Kx,{open:F,onClose:()=>z(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(nb,{children:"Edit Profile"}),(0,We.jsx)(sb,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,We.jsx)(Jy,{label:"Name",value:c.name,onChange:e=>u({...c,name:e.target.value}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Bio",value:c.bio,onChange:e=>u({...c,bio:e.target.value}),multiline:!0,rows:4,fullWidth:!0}),"student"===(null===a||void 0===a?void 0:a.role)?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Jy,{label:"College",value:c.college,onChange:e=>u({...c,college:e.target.value}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Major",value:c.major,onChange:e=>u({...c,major:e.target.value}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Graduation Year",value:c.graduationYear,onChange:e=>u({...c,graduationYear:e.target.value}),fullWidth:!0})]}):(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Jy,{label:"Company",value:c.company,onChange:e=>u({...c,company:e.target.value}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Position",value:c.position,onChange:e=>u({...c,position:e.target.value}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Company Website",value:c.companyWebsite,onChange:e=>u({...c,companyWebsite:e.target.value}),fullWidth:!0})]}),(0,We.jsx)(Ln,{variant:"subtitle1",sx:{mt:2},children:"Contact Information"}),(0,We.jsx)(Jy,{label:"Phone Number",value:c.contactInfo.phone,onChange:e=>u({...c,contactInfo:{...c.contactInfo,phone:e.target.value}}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"LinkedIn Profile",value:c.contactInfo.linkedin,onChange:e=>u({...c,contactInfo:{...c.contactInfo,linkedin:e.target.value}}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Personal Website",value:c.contactInfo.website,onChange:e=>u({...c,contactInfo:{...c.contactInfo,website:e.target.value}}),fullWidth:!0})]})}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:()=>z(!1),children:"Cancel"}),(0,We.jsx)(Cn,{variant:"contained",onClick:async()=>{try{await i(c),z(!1),ie()}catch(b){console.error("Error updating profile:",b)}},children:"Save Changes"})]})]}),(0,We.jsx)(xxe,{open:j,onClose:()=>V(!1),onSave:ce,currentSkills:h}),(0,We.jsxs)(Kx,{open:S,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(nb,{children:"Add Portfolio Item"}),(0,We.jsx)(sb,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,We.jsx)(Jy,{label:"Project Title",value:R.title,onChange:e=>I({...R,title:e.target.value}),fullWidth:!0}),(0,We.jsx)(Jy,{label:"Description",value:R.description,onChange:e=>I({...R,description:e.target.value}),multiline:!0,rows:4,fullWidth:!0}),(0,We.jsx)(Jy,{label:"Project Link",value:R.projectUrl,onChange:e=>I({...R,projectUrl:e.target.value}),fullWidth:!0})]})}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:()=>C(!1),children:"Cancel"}),(0,We.jsx)(Cn,{variant:"contained",onClick:async()=>{try{const e=await rl.post("http://localhost:5000/api/users/portfolio",R,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});i(e.data),C(!1),I({title:"",description:"",imageUrl:"",projectUrl:"",technologies:[]})}catch(b){console.error("Error adding portfolio item:",b)}},children:"Add Project"})]})]}),(0,We.jsxs)(Kx,{open:w,onClose:()=>E(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsx)(nb,{children:"Add New Skill"}),(0,We.jsx)(sb,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,We.jsx)(Jy,{select:!0,label:"Category",value:M.category,onChange:e=>T({...M,category:e.target.value}),fullWidth:!0,required:!0,children:ixe.map((e=>(0,We.jsx)(Vo,{value:e,children:e},e)))}),(0,We.jsx)(Jy,{label:"Skill Name",value:M.name,onChange:e=>T({...M,name:e.target.value}),fullWidth:!0,required:!0}),(0,We.jsxs)(Jy,{select:!0,label:"Level",value:M.level,onChange:e=>T({...M,level:e.target.value}),fullWidth:!0,required:!0,children:[(0,We.jsx)(Vo,{value:"beginner",children:"Beginner"}),(0,We.jsx)(Vo,{value:"intermediate",children:"Intermediate"}),(0,We.jsx)(Vo,{value:"advanced",children:"Advanced"}),(0,We.jsx)(Vo,{value:"expert",children:"Expert"})]})]})}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:()=>E(!1),children:"Cancel"}),(0,We.jsx)(Cn,{onClick:async()=>{if(M.name&&M.category&&M.level)try{_(null);const e=localStorage.getItem("token"),t=await rl.post("http://localhost:5000/api/users/skills",M,{headers:{Authorization:`Bearer ${e}`}});d((e=>[...e,t.data])),E(!1),T({name:"",category:"",level:"beginner"})}catch(b){var e,t;console.error("Error adding skill:",b),_((null===(e=b.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to add skill. Please try again.")}else _("Please fill in all fields")},variant:"contained",children:"Add Skill"})]})]}),(0,We.jsxs)(Kx,{open:G,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,children:[(0,We.jsxs)(nb,{children:["Write a Review for ",null===a||void 0===a?void 0:a.name]}),(0,We.jsx)(sb,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[q&&(0,We.jsx)(MA,{severity:"error",children:q}),(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[(0,We.jsx)(Rb,{value:W.rating,onChange:(e,t)=>{Q({...W,rating:t})},size:"large",sx:{color:"primary.main"}}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",children:0===W.rating?"Select your rating":1===W.rating?"Poor":2===W.rating?"Fair":3===W.rating?"Good":4===W.rating?"Very Good":"Excellent"})]}),(0,We.jsx)(Jy,{label:"Write your review",multiline:!0,rows:4,value:W.comment,onChange:e=>Q({...W,comment:e.target.value}),fullWidth:!0,required:!0,placeholder:"Share your experience with this user..."})]})}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:()=>H(!1),children:"Cancel"}),(0,We.jsx)(Cn,{variant:"contained",onClick:async()=>{try{Y(!0),X(null);const e=localStorage.getItem("token");if(!e)return void X("Please log in to submit a review");await rl.post("http://localhost:5000/api/ratings",{ratedUser:a._id,rating:W.rating,comment:W.comment},{headers:{Authorization:`Bearer ${e}`}}),H(!1),Q({rating:0,comment:""}),window.location.reload()}catch(b){var e,t;console.error("Error submitting review:",b),X((null===(e=b.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to submit review. Please try again.")}finally{Y(!1)}},disabled:$||0===W.rating||!W.comment.trim(),children:$?(0,We.jsx)(jA,{size:24}):"Submit Review"})]})]}),(0,We.jsxs)(Kx,{open:Z,onClose:()=>ee(!1),maxWidth:"md",fullWidth:!0,children:[(0,We.jsx)(nb,{children:"Confirm Extracted Skills"}),(0,We.jsxs)(sb,{children:[(0,We.jsx)(Ln,{variant:"body1",gutterBottom:!0,children:"Please review and configure the skills extracted from your resume:"}),(0,We.jsx)(ci,{sx:{mt:2,maxHeight:500,overflow:"auto"},children:(0,We.jsx)(rr,{children:K.map(((e,t)=>{var n,i;return(0,We.jsxs)(bl,{sx:{flexDirection:"column",alignItems:"flex-start"},children:[(0,We.jsx)(Ml,{primary:e}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,mt:1,width:"100%"},children:[(0,We.jsx)(Jy,{select:!0,label:"Category",value:(null===(n=te[e])||void 0===n?void 0:n.category)||"",onChange:t=>he(e,"category",t.target.value),sx:{flex:1},required:!0,children:ixe.map((e=>(0,We.jsx)(Vo,{value:e,children:e},e)))}),(0,We.jsxs)(Jy,{select:!0,label:"Level",value:(null===(i=te[e])||void 0===i?void 0:i.level)||"beginner",onChange:t=>he(e,"level",t.target.value),sx:{flex:1},required:!0,children:[(0,We.jsx)(Vo,{value:"beginner",children:"Beginner"}),(0,We.jsx)(Vo,{value:"intermediate",children:"Intermediate"}),(0,We.jsx)(Vo,{value:"advanced",children:"Advanced"}),(0,We.jsx)(Vo,{value:"expert",children:"Expert"})]})]})]},t)}))})})]}),(0,We.jsxs)(ub,{children:[(0,We.jsx)(Cn,{onClick:()=>ee(!1),children:"Cancel"}),(0,We.jsx)(Cn,{onClick:async()=>{try{if(Object.entries(te).filter((e=>{let[t,n]=e;return!n.category||!n.level})).length>0)return void _("Please select category and level for all skills");const e=localStorage.getItem("token");await rl.post("http://localhost:5000/api/users/confirm-skills",{skills:Object.entries(te).map((e=>{let[t,n]=e;return{name:t,category:n.category,level:n.level}}))},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),ee(!1),J([]),ne({}),ie()}catch(b){var e,t;console.error("Error confirming skills:",b),_((null===(e=b.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to confirm skills")}},variant:"contained",disabled:Object.values(te).some((e=>!e.category||!e.level)),children:"Confirm and Add Skills"})]})]})]})});function Rxe(e){return(0,Et.Ay)("MuiCard",e)}(0,wt.A)("MuiCard",["root"]);const Ixe=["className","raised"],Pxe=(0,At.Ay)(Tt,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),Bxe=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiCard"}),{className:i,raised:r=!1}=n,o=(0,je.A)(n,Ixe),s=(0,ze.A)({},n,{raised:r}),a=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"]},Rxe,t)})(s);return(0,We.jsx)(Pxe,(0,ze.A)({className:(0,vt.A)(a.root,i),elevation:r?8:void 0,ref:t,ownerState:s},o))}));function Lxe(e){return(0,Et.Ay)("MuiCardContent",e)}(0,wt.A)("MuiCardContent",["root"]);const Nxe=["className","component"],Dxe=(0,At.Ay)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),kxe=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiCardContent"}),{className:i,component:r="div"}=n,o=(0,je.A)(n,Nxe),s=(0,ze.A)({},n,{component:r}),a=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"]},Lxe,t)})(s);return(0,We.jsx)(Dxe,(0,ze.A)({as:r,className:(0,vt.A)(a.root,i),ownerState:s,ref:t},o))}));function Oxe(e){return(0,Et.Ay)("MuiCardActions",e)}(0,wt.A)("MuiCardActions",["root","spacing"]);const Uxe=["disableSpacing","className"],Fxe=(0,At.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),zxe=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiCardActions"}),{disableSpacing:i=!1,className:r}=n,o=(0,je.A)(n,Uxe),s=(0,ze.A)({},n,{disableSpacing:i}),a=(e=>{const{classes:t,disableSpacing:n}=e,i={root:["root",!n&&"spacing"]};return(0,yt.A)(i,Oxe,t)})(s);return(0,We.jsx)(Fxe,(0,ze.A)({className:(0,vt.A)(a.root,r),ownerState:s,ref:t},o))}));function jxe(e){return(0,Et.Ay)("MuiInputAdornment",e)}const Vxe=(0,wt.A)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var Gxe;const Hxe=["children","className","component","disablePointerEvents","disableTypography","position","variant"],Wxe=(0,At.Ay)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`position${(0,xt.A)(n.position)}`],!0===n.disablePointerEvents&&t.disablePointerEvents,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ze.A)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active},"filled"===n.variant&&{[`&.${Vxe.positionStart}&:not(.${Vxe.hiddenLabel})`]:{marginTop:16}},"start"===n.position&&{marginRight:8},"end"===n.position&&{marginLeft:8},!0===n.disablePointerEvents&&{pointerEvents:"none"})})),Qxe=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiInputAdornment"}),{children:i,className:r,component:o="div",disablePointerEvents:a=!1,disableTypography:l=!1,position:c,variant:u}=n,h=(0,je.A)(n,Hxe),d=fv()||{};let p=u;u&&d.variant,d&&!p&&(p=d.variant);const f=(0,ze.A)({},n,{hiddenLabel:d.hiddenLabel,size:d.size,disablePointerEvents:a,position:c,variant:p}),m=(e=>{const{classes:t,disablePointerEvents:n,hiddenLabel:i,position:r,size:o,variant:s}=e,a={root:["root",n&&"disablePointerEvents",r&&`position${(0,xt.A)(r)}`,s,i&&"hiddenLabel",o&&`size${(0,xt.A)(o)}`]};return(0,yt.A)(a,jxe,t)})(f);return(0,We.jsx)(pv.Provider,{value:null,children:(0,We.jsx)(Wxe,(0,ze.A)({as:o,ownerState:f,className:(0,vt.A)(m.root,r),ref:t},h,{children:"string"!==typeof i||l?(0,We.jsxs)(s.Fragment,{children:["start"===c?Gxe||(Gxe=(0,We.jsx)("span",{className:"notranslate",children:"\u200b"})):null,i]}):(0,We.jsx)(Ln,{color:"text.secondary",children:i})}))})}));var qxe=i(6360),Xxe=i(2505),$xe=i(3471);const Yxe=e=>{let{style:t}=e;return(0,We.jsx)(Ln,{component:"span",sx:{fontFamily:"Arial, sans-serif",...t},children:"\u20b9"})},Kxe=gxe.map((e=>e.name)),Jxe=()=>{const e=oe(),{user:t}=sl(),[n,i]=(0,s.useState)([]),[r,o]=(0,s.useState)(!0),[a,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[h,d]=(0,s.useState)(""),[p,f]=(0,s.useState)(null);(0,s.useEffect)((()=>{t&&m()}),[t]);const m=async()=>{try{const e=localStorage.getItem("token");let n="http://localhost:5000/api/jobs";"recruiter"===(null===t||void 0===t?void 0:t.role)&&null!==t&&void 0!==t&&t._id&&(n=`http://localhost:5000/api/jobs/recruiter/${t._id}`);const r=await rl.get(n,{headers:{Authorization:`Bearer ${e}`}});console.log("Jobs:",r.data),i(r.data)}catch(a){var e,n;console.error("Error fetching jobs:",a),l((null===(e=a.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Failed to fetch jobs")}finally{o(!1)}},g=n.filter((e=>{const t=e.title.toLowerCase().includes(c.toLowerCase())||e.description.toLowerCase().includes(c.toLowerCase()),n=!h||e.category===h;return t&&n}));return(0,We.jsxs)(Zn,{maxWidth:"lg",children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,We.jsx)(Ln,{variant:"h4",children:"recruiter"===(null===t||void 0===t?void 0:t.role)?"My Gigs":"Available Gigs"}),"recruiter"===(null===t||void 0===t?void 0:t.role)&&(0,We.jsx)(Cn,{variant:"contained",startIcon:(0,We.jsx)(Xxe.A,{}),onClick:()=>e("/create-job"),children:"Create New Gig"})]}),(0,We.jsxs)(Xl,{container:!0,spacing:3,children:[(0,We.jsx)(Xl,{item:!0,xs:12,md:3,children:(0,We.jsxs)(Tt,{sx:{p:2},children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:"Filters"}),(0,We.jsxs)(dy,{fullWidth:!0,sx:{mb:2},children:[(0,We.jsx)(ly,{children:"Category"}),(0,We.jsxs)(qy,{value:h,onChange:e=>d(e.target.value),label:"Category",children:[(0,We.jsx)(Vo,{value:"",children:"All Categories"}),Kxe.map((e=>(0,We.jsx)(Vo,{value:e,children:e},e)))]})]})]})}),(0,We.jsxs)(Xl,{item:!0,xs:12,md:9,children:[(0,We.jsx)(Tt,{sx:{p:2,mb:3},children:(0,We.jsx)(Jy,{fullWidth:!0,placeholder:"Search gigs...",value:c,onChange:e=>u(e.target.value),InputProps:{startAdornment:(0,We.jsx)(Qxe,{position:"start",children:(0,We.jsx)(qxe.A,{})})}})}),a&&(0,We.jsx)(MA,{severity:"error",sx:{mb:3},children:a}),r?(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,We.jsx)(jA,{})}):g.length>0?(0,We.jsx)(Xl,{container:!0,spacing:2,children:(0,We.jsx)(Xl,{item:!0,xs:12,children:g.map((n=>{var r,o,s,c,u;return(0,We.jsxs)(Bxe,{sx:{mb:2},children:[(0,We.jsxs)(kxe,{children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,We.jsxs)(ci,{children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:n.title}),(0,We.jsxs)(Ln,{variant:"body2",color:"text.secondary",children:["Posted by"," ",(0,We.jsx)(Cn,{color:"primary",onClick:()=>e(`/profile/${n.recruiter._id}`),sx:{textTransform:"none",p:0,minWidth:"auto"},children:n.recruiter.name})]})]}),(0,We.jsx)(Vx,{label:n.category,color:"primary",size:"small",sx:{ml:1}})]}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",paragraph:!0,children:n.description}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:2},children:[(0,We.jsxs)(Ln,{variant:"body2",color:"text.secondary",sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,We.jsx)("strong",{children:"Pay:"}),(0,We.jsx)("span",{style:{fontFamily:"system-ui, -apple-system, Arial"},children:"\u20b9"}),n.pay?n.pay.amount.toLocaleString():"Not specified","hourly"===(null===(r=n.pay)||void 0===r?void 0:r.type)?"/hour":""]}),(0,We.jsxs)(Ln,{variant:"body2",children:[(0,We.jsx)("strong",{children:"Duration:"})," ",n.duration," weeks"]}),n.applicants&&(0,We.jsxs)(Ln,{variant:"body2",children:[(0,We.jsx)("strong",{children:"Applications:"})," ",n.applicants.length]})]}),"student"===(null===t||void 0===t?void 0:t.role)&&(null===(o=n.applicants)||void 0===o?void 0:o.some((e=>e.student===t._id)))&&(0,We.jsxs)(Ln,{variant:"body2",color:"primary",sx:{mt:1},children:["Status: ",n.applicants.find((e=>e.student===t._id)).status]})]}),(0,We.jsx)(iv,{}),(0,We.jsx)(zxe,{sx:{justifyContent:"flex-end",p:2},children:"recruiter"===(null===t||void 0===t?void 0:t.role)?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Cn,{size:"small",startIcon:(0,We.jsx)(Pl.A,{}),onClick:()=>e(`/jobs/${n._id}/edit`),children:"Edit"}),(0,We.jsx)(Cn,{size:"small",color:"error",startIcon:(0,We.jsx)($xe.A,{}),onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this gig?"))try{const t=localStorage.getItem("token");await rl.delete(`http://localhost:5000/api/jobs/${e}`,{headers:{Authorization:`Bearer ${t}`}}),i((t=>t.filter((t=>t._id!==e))))}catch(a){var t,n;console.error("Error deleting job:",a),l((null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to delete job")}})(n._id),children:"Delete"}),(0,We.jsxs)(Cn,{size:"small",variant:"contained",onClick:()=>e(`/jobs/${n._id}`),children:["View Applications (",(null===(s=n.applicants)||void 0===s?void 0:s.length)||0,")"]})]}):(0,We.jsx)(Cn,{size:"small",variant:"contained",onClick:()=>e(`/jobs/${n._id}`),disabled:null===(c=n.applicants)||void 0===c?void 0:c.some((e=>e.student===(null===t||void 0===t?void 0:t._id))),children:null!==(u=n.applicants)&&void 0!==u&&u.some((e=>e.student===(null===t||void 0===t?void 0:t._id)))?n.updatedAt>n.applicants.find((e=>e.student===(null===t||void 0===t?void 0:t._id))).appliedAt?"Apply Again":"Already Applied":"Apply Now"})})]},n._id)}))})}):(0,We.jsx)(Tt,{sx:{p:3,textAlign:"center"},children:(0,We.jsx)(Ln,{color:"text.secondary",children:c||h?"No gigs match your search criteria":"recruiter"===(null===t||void 0===t?void 0:t.role)?"You haven't created any gigs yet":"No gigs available at the moment"})})]})]})]})},Zxe=()=>{var e,t,n,i,r,o;const{id:a}=se(),l=oe(),{user:c}=sl(),[u,h]=(0,s.useState)(null),[d,p]=(0,s.useState)(!0),[f,m]=(0,s.useState)(""),[g,v]=(0,s.useState)(!1);(0,s.useEffect)((()=>{y()}),[a]);const y=async()=>{try{const e=localStorage.getItem("token"),t=await rl.get(`http://localhost:5000/api/jobs/${a}`,{headers:{Authorization:`Bearer ${e}`}});h(t.data)}catch(f){var e,t;console.error("Error fetching job details:",f),m((null===(e=f.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to fetch job details")}finally{p(!1)}},A=async(e,t)=>{try{const n=localStorage.getItem("token");await rl.patch(`http://localhost:5000/api/jobs/${a}/applications/${e}`,{status:t},{headers:{Authorization:`Bearer ${n}`}}),y()}catch(f){var n,i;console.error("Error updating application status:",f),m((null===(n=f.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Failed to update application status")}},x=null===u||void 0===u||null===(e=u.applicants)||void 0===e?void 0:e.some((e=>e.student===(null===c||void 0===c?void 0:c._id))),b=x?null===u||void 0===u||null===(t=u.applicants)||void 0===t||null===(n=t.find((e=>e.student===(null===c||void 0===c?void 0:c._id))))||void 0===n?void 0:n.status:null;if(d)return(0,We.jsx)(Zn,{maxWidth:"lg",sx:{py:4},children:(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,We.jsx)(jA,{})})});if(f)return(0,We.jsx)(Zn,{maxWidth:"lg",sx:{py:4},children:(0,We.jsx)(MA,{severity:"error",children:f})});if(!u)return(0,We.jsx)(Zn,{maxWidth:"lg",sx:{py:4},children:(0,We.jsx)(MA,{severity:"error",children:"Job not found"})});const _=c&&u.recruiter._id===c._id;return(0,We.jsx)(Zn,{maxWidth:"lg",sx:{py:4},children:(0,We.jsxs)(Tt,{sx:{p:3},children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[(0,We.jsxs)(ci,{children:[(0,We.jsx)(Ln,{variant:"h4",gutterBottom:!0,children:u.title}),(0,We.jsxs)(ci,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",mb:2},children:[(0,We.jsx)(Ln,{children:"Posted by"}),(0,We.jsx)(Cn,{color:"primary",onClick:()=>l(`/profile/${u.recruiter._id}`),sx:{textTransform:"none",p:0,minWidth:"fit-content",minHeight:"unset",lineHeight:"inherit",fontWeight:"inherit",letterSpacing:"inherit","&:hover":{backgroundColor:"transparent",textDecoration:"underline"}},children:null===(i=u.recruiter)||void 0===i?void 0:i.name})]})]}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,We.jsx)(Vx,{label:u.status,color:"Open"===u.status?"success":"default",size:"small"}),_&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Cn,{variant:"outlined",size:"small",onClick:()=>l(`/jobs/${a}/edit`),children:"Edit"}),(0,We.jsx)(Cn,{variant:"outlined",color:"error",size:"small",onClick:async()=>{if(window.confirm("Are you sure you want to delete this gig?"))try{const e=localStorage.getItem("token");await rl.delete(`http://localhost:5000/api/jobs/${a}`,{headers:{Authorization:`Bearer ${e}`}}),l("/jobs")}catch(f){var e,t;console.error("Error deleting job:",f),m((null===(e=f.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to delete the job")}},children:"Delete"})]})]})]}),(0,We.jsx)(Vx,{label:u.category,color:"primary",variant:"outlined",size:"small",sx:{mb:2}}),(0,We.jsx)(Ln,{variant:"body1",paragraph:!0,children:u.description}),(0,We.jsxs)(ci,{sx:{mb:3},children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:"Required Skills"}),(0,We.jsx)(ci,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:u.requiredSkills.map(((e,t)=>(0,We.jsx)(Vx,{label:`${e.name} (${e.level})`,variant:"outlined"},t)))})]}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,mb:3},children:[(0,We.jsxs)(Ln,{variant:"body1",sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,We.jsx)("strong",{children:"Pay:"}),(0,We.jsx)("span",{style:{fontFamily:"system-ui, -apple-system, Arial"},children:"\u20b9"}),u.pay?u.pay.amount.toLocaleString():"Not specified","hourly"===(null===(r=u.pay)||void 0===r?void 0:r.type)?"/hour":""]}),(0,We.jsxs)(Ln,{variant:"body1",children:[(0,We.jsx)("strong",{children:"Duration:"})," ",u.duration," weeks"]}),(0,We.jsxs)(Ln,{variant:"body1",children:[(0,We.jsx)("strong",{children:"Applications:"})," ",(null===(o=u.applicants)||void 0===o?void 0:o.length)||0]})]}),(0,We.jsxs)(ci,{sx:{mb:3},children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:"Applications"}),u.applicants&&0!==u.applicants.length?(0,We.jsx)(yi,{spacing:2,children:u.applicants.map((e=>(0,We.jsx)(Tt,{sx:{p:2},children:(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,We.jsxs)(ci,{children:[(0,We.jsx)(Ln,{variant:"subtitle1",children:e.student.name}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",children:e.student.college}),(0,We.jsx)(Vx,{label:e.status,color:"Pending"===e.status?"warning":"Accepted"===e.status?"success":"error",size:"small",sx:{mt:1}})]}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(Cn,{variant:"outlined",size:"small",onClick:()=>l(`/profile/${e.student._id}`),children:"View Profile"}),_&&"Pending"===e.status&&(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(Cn,{variant:"contained",color:"success",size:"small",onClick:()=>A(e._id,"Accepted"),children:"Accept"}),(0,We.jsx)(Cn,{variant:"contained",color:"error",size:"small",onClick:()=>A(e._id,"Rejected"),children:"Reject"})]})]})]})},e._id)))}):(0,We.jsx)(Ln,{color:"text.secondary",children:"No applications yet."})]}),"student"===(null===c||void 0===c?void 0:c.role)&&(0,We.jsx)(ci,{sx:{mt:3},children:x?(0,We.jsxs)(MA,{severity:"info",children:["You have already applied for this position. Status: ",b]}):(0,We.jsx)(Cn,{variant:"contained",onClick:async()=>{var e;if(!c)return void l("/login");if("student"!==c.role)return void m("Only students can apply for jobs");if(!u)return void m("Job details not loaded");if("Open"!==u.status)return void m("This job is no longer accepting applications");if(null===(e=u.applicants)||void 0===e?void 0:e.some((e=>e.student===c._id)))m("You have already applied for this job");else{m(""),v(!0);try{const e=localStorage.getItem("token");await rl.post(`http://localhost:5000/api/jobs/${a}/apply`,{},{headers:{Authorization:`Bearer ${e}`}}),await y()}catch(f){var t,n;console.error("Error applying for job:",f);const i=(null===(t=f.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to apply for the job";m(i)}finally{v(!1)}}},disabled:g||"Open"!==u.status,children:g?"Applying...":"Apply Now"})})]})})};function ebe(e){return(0,Et.Ay)("MuiListItemAvatar",e)}(0,wt.A)("MuiListItemAvatar",["root","alignItemsFlexStart"]);const tbe=["className"],nbe=(0,At.Ay)("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"flex-start"===n.alignItems&&t.alignItemsFlexStart]}})((e=>{let{ownerState:t}=e;return(0,ze.A)({minWidth:56,flexShrink:0},"flex-start"===t.alignItems&&{marginTop:8})})),ibe=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiListItemAvatar"}),{className:i}=n,r=(0,je.A)(n,tbe),o=s.useContext(er),a=(0,ze.A)({},n,{alignItems:o.alignItems}),l=(e=>{const{alignItems:t,classes:n}=e,i={root:["root","flex-start"===t&&"alignItemsFlexStart"]};return(0,yt.A)(i,ebe,n)})(a);return(0,We.jsx)(nbe,(0,ze.A)({className:(0,vt.A)(l.root,i),ownerState:a,ref:t},r))})),rbe=(0,ji.A)((0,We.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),obe=(Math.pow(10,8),43200),sbe=Symbol.for("constructDateFrom");function abe(e,t){return"function"===typeof e?e(t):e&&"object"===typeof e&&sbe in e?e[sbe](t):e instanceof Date?new e.constructor(t):new Date(t)}function lbe(e){return abe(e,Date.now())}const cbe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ube(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const hbe={date:ube({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ube({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ube({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},dbe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function pbe(e){return(t,n)=>{let i;if("formatting"===(n?.context?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,r=n?.width?String(n.width):t;i=e.formattingValues[r]||e.formattingValues[t]}else{const t=e.defaultWidth,r=n?.width?String(n.width):e.defaultWidth;i=e.values[r]||e.values[t]}return i[e.argumentCallback?e.argumentCallback(t):t]}}function fbe(e){return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=n.width,r=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],o=t.match(r);if(!o)return null;const s=o[0],a=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(a)?function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return}(a,(e=>e.test(s))):function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n;return}(a,(e=>e.test(s)));let c;c=e.valueCallback?e.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;return{value:c,rest:t.slice(s.length)}}}var mbe;const gbe={code:"en-US",formatDistance:(e,t,n)=>{let i;const r=cbe[e];return i="string"===typeof r?r:1===t?r.one:r.other.replace("{{count}}",t.toString()),n?.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i},formatLong:hbe,formatRelative:(e,t,n,i)=>dbe[e],localize:{ordinalNumber:(e,t)=>{const n=Number(e),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:pbe({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:pbe({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:pbe({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:pbe({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:pbe({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(mbe={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.match(mbe.matchPattern);if(!n)return null;const i=n[0],r=e.match(mbe.parsePattern);if(!r)return null;let o=mbe.valueCallback?mbe.valueCallback(r[0]):r[0];return o=t.valueCallback?t.valueCallback(o):o,{value:o,rest:e.slice(i.length)}}),era:fbe({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:fbe({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:fbe({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:fbe({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:fbe({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};let vbe={};function ybe(e,t){return abe(t||e,e)}function Abe(e){const t=ybe(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function xbe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=abe.bind(null,e||n.find((e=>"object"===typeof e)));return n.map(r)}function bbe(e,t){const n=+ybe(e)-+ybe(t);return n<0?-1:n>0?1:n}function _be(e,t,n){const[i,r]=xbe(n?.in,e,t);return 12*(i.getFullYear()-r.getFullYear())+(i.getMonth()-r.getMonth())}function wbe(e,t){const n=ybe(e,t?.in);return n.setHours(23,59,59,999),n}function Ebe(e,t){const n=ybe(e,t?.in),i=n.getMonth();return n.setFullYear(n.getFullYear(),i+1,0),n.setHours(23,59,59,999),n}function Sbe(e,t){const n=ybe(e,t?.in);return+wbe(n,t)===+Ebe(n,t)}function Cbe(e,t,n){const[i,r,o]=xbe(n?.in,e,e,t),s=bbe(r,o),a=Math.abs(_be(r,o));if(a<1)return 0;1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*a);let l=bbe(r,o)===-s;Sbe(i)&&1===a&&1===bbe(i,o)&&(l=!1);const c=s*(a-+l);return 0===c?0:c}function Mbe(e,t){return+ybe(e)-+ybe(t)}function Tbe(e,t,n){const i=Mbe(e,t)/1e3;return(r=n?.roundingMethod,e=>{const t=(r?Math[r]:Math.trunc)(e);return 0===t?0:t})(i);var r}function Rbe(e,t,n){const i=vbe,r=n?.locale??i.locale??gbe,o=bbe(e,t);if(isNaN(o))throw new RangeError("Invalid time value");const s=Object.assign({},n,{addSuffix:n?.addSuffix,comparison:o}),[a,l]=xbe(n?.in,...o>0?[t,e]:[e,t]),c=Tbe(l,a),u=(Abe(l)-Abe(a))/1e3,h=Math.round((c-u)/60);let d;if(h<2)return n?.includeSeconds?c<5?r.formatDistance("lessThanXSeconds",5,s):c<10?r.formatDistance("lessThanXSeconds",10,s):c<20?r.formatDistance("lessThanXSeconds",20,s):c<40?r.formatDistance("halfAMinute",0,s):c<60?r.formatDistance("lessThanXMinutes",1,s):r.formatDistance("xMinutes",1,s):0===h?r.formatDistance("lessThanXMinutes",1,s):r.formatDistance("xMinutes",h,s);if(h<45)return r.formatDistance("xMinutes",h,s);if(h<90)return r.formatDistance("aboutXHours",1,s);if(h<1440){const e=Math.round(h/60);return r.formatDistance("aboutXHours",e,s)}if(h<2520)return r.formatDistance("xDays",1,s);if(h<obe){const e=Math.round(h/1440);return r.formatDistance("xDays",e,s)}if(h<86400)return d=Math.round(h/obe),r.formatDistance("aboutXMonths",d,s);if(d=Cbe(l,a),d<12){const e=Math.round(h/obe);return r.formatDistance("xMonths",e,s)}{const e=d%12,t=Math.trunc(d/12);return e<3?r.formatDistance("aboutXYears",t,s):e<9?r.formatDistance("overXYears",t,s):r.formatDistance("almostXYears",t+1,s)}}function Ibe(e,t){return Rbe(e,lbe(e),t)}const Pbe=()=>{const{user:e}=sl(),t=ie(),n=oe(),[i]=Fe(),[r,o]=(0,s.useState)([]),[a,l]=(0,s.useState)(null),[c,u]=(0,s.useState)([]),[h,d]=(0,s.useState)(""),[p,f]=(0,s.useState)(!0),[m,g]=(0,s.useState)(null),v=(0,s.useRef)(null),{userId:y,jobId:A}=se();(0,s.useEffect)((()=>{var o;if(!e)return void n("/login");const s=i.get("conversation");if(s){const e=r.find((e=>e.user._id===s));e&&l(e)}if(null!==(o=t.state)&&void 0!==o&&o.startConversation){const{recipientId:e,recipientName:i,recipientPicture:r,jobId:o}=t.state;l({_id:e,user:{_id:e,name:i,profilePicture:r},lastMessage:{jobId:o}}),n(t.pathname,{replace:!0})}x()}),[t,e,n,i,r]),(0,s.useEffect)((()=>{a&&e&&(b(),_())}),[a,e]),(0,s.useEffect)((()=>{var e;null===(e=v.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[c]),(0,s.useEffect)((()=>{(()=>{const e=t.pathname;if(e.startsWith("/messages/")){const[,,t,n]=e.split("/");if(t&&n){let e=r.find((e=>e.user._id===t));e||(e={_id:t,user:{_id:t,name:"Loading...",profilePicture:null},lastMessage:{jobId:n}}),l(e),b(t,n)}}})()}),[t.pathname,r]),(0,s.useEffect)((()=>{(async()=>{if(e&&y)try{const e=localStorage.getItem("token");if(!e)return;let t;const n=r.find((e=>e.user._id===y));if(n)t=n.user;else{t=(await rl.get(`http://localhost:5000/api/users/${y}`,{headers:{Authorization:`Bearer ${e}`}})).data}const i={_id:y,user:{_id:y,name:t.name,profilePicture:t.profilePicture,role:t.role},lastMessage:{jobId:A||"general"}};l(i),b(y,A||"general")}catch(m){console.error("Error handling URL parameters:",m)}})()}),[y,A,e,r]);const x=async()=>{try{const e=localStorage.getItem("token");if(!e)return;const t=await rl.get("http://localhost:5000/api/messages/conversations",{headers:{Authorization:`Bearer ${e}`}});if(a){const e=t.data.find((e=>e.user._id===a._id));e&&l({...e,user:{...e.user,role:a.user.role}})}o(t.data)}catch(m){console.error("Error fetching conversations:",m)}finally{f(!1)}},b=async(e,t)=>{try{var n;const i=localStorage.getItem("token");if(!i)return;const r=e||(null===a||void 0===a?void 0:a.user._id),o=t||(null===a||void 0===a||null===(n=a.lastMessage)||void 0===n?void 0:n.jobId)||"general";if(!r)return;const s=await rl.get(`http://localhost:5000/api/messages/${r}/${o}`,{headers:{Authorization:`Bearer ${i}`}});u(s.data)}catch(m){console.error("Error fetching messages:",m)}},_=async()=>{try{const e=localStorage.getItem("token");if(!e)return;await rl.patch("http://localhost:5000/api/notifications/read-all",{},{headers:{Authorization:`Bearer ${e}`}})}catch(m){console.error("Error marking notifications as read:",m)}};return e?(0,We.jsx)(Zn,{maxWidth:"lg",sx:{mt:4,mb:4},children:(0,We.jsx)(Tt,{elevation:3,sx:{height:"calc(100vh - 200px)",display:"flex",flexDirection:"column"},children:a?(0,We.jsxs)(We.Fragment,{children:[(0,We.jsxs)(ci,{sx:{p:2,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center"},children:[(0,We.jsx)(wi,{onClick:()=>l(null),sx:{mr:2},children:(0,We.jsx)(rbe,{})}),(0,We.jsx)(Ji,{src:a.user.profilePicture,alt:a.user.name,sx:{mr:2}}),(0,We.jsxs)(ci,{children:[(0,We.jsx)(Ln,{variant:"h6",children:a.user.name}),a.user.role&&(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",children:a.user.role.charAt(0).toUpperCase()+a.user.role.slice(1)})]})]}),(0,We.jsxs)(ci,{sx:{flexGrow:1,overflow:"auto",p:2},children:[c.map(((t,n)=>(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:t.sender._id===e._id?"flex-end":"flex-start",mb:2},children:(0,We.jsxs)(ci,{sx:{maxWidth:"70%",backgroundColor:t.sender._id===e._id?"primary.main":"grey.200",color:t.sender._id===e._id?"white":"text.primary",borderRadius:2,p:2},children:[(0,We.jsx)(Ln,{variant:"body1",children:t.content}),(0,We.jsx)(Ln,{variant:"caption",sx:{display:"block",textAlign:"right",mt:.5,color:t.sender._id===e._id?"rgba(255,255,255,0.7)":"text.secondary"},children:Ibe(new Date(t.createdAt),{addSuffix:!0})})]})},t._id))),(0,We.jsx)("div",{ref:v})]}),(0,We.jsxs)(ci,{component:"form",onSubmit:async e=>{if(e.preventDefault(),h.trim()&&a)try{var t;const e=localStorage.getItem("token");if(!e)return;const n={recipientId:a.user._id,content:h.trim(),jobId:(null===(t=a.lastMessage)||void 0===t?void 0:t.jobId)||"general"};console.log("Message data being sent:",n);const i=await rl.post("http://localhost:5000/api/messages",n,{headers:{Authorization:`Bearer ${e}`}});u((e=>[...e,i.data])),d(""),x()}catch(m){var n,i;console.error("Error sending message:",m),console.error("Error response:",m.response),console.error("Error status:",null===(n=m.response)||void 0===n?void 0:n.status),console.error("Error headers:",null===(i=m.response)||void 0===i?void 0:i.headers)}},sx:{p:2,borderTop:1,borderColor:"divider",display:"flex",gap:1},children:[(0,We.jsx)(Jy,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:h,onChange:e=>d(e.target.value)}),(0,We.jsx)(wi,{type:"submit",color:"primary",disabled:!h.trim(),children:(0,We.jsx)(tA,{})})]})]}):(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)(ci,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:(0,We.jsx)(Ln,{variant:"h6",children:"Conversations"})}),(0,We.jsx)(ci,{sx:{flexGrow:1,overflow:"auto"},children:p?(0,We.jsx)(ci,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,We.jsx)(jA,{})}):0===r.length?(0,We.jsx)(ci,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:(0,We.jsx)(Ln,{color:"text.secondary",children:"No conversations yet"})}):(0,We.jsx)(rr,{children:r.map((e=>(0,We.jsxs)(bl,{button:!0,onClick:()=>(e=>{l({...e,user:{...e.user,role:e.user.role}})})(e),children:[(0,We.jsx)(ibe,{children:(0,We.jsx)(zi,{color:"primary",variant:"dot",invisible:!e.lastMessage||e.lastMessage.read,children:(0,We.jsx)(Ji,{src:e.user.profilePicture,alt:e.user.name})})}),(0,We.jsx)(Ml,{primary:e.user.name,secondary:e.lastMessage?`${e.lastMessage.content.substring(0,30)}${e.lastMessage.content.length>30?"...":""}`:"No messages yet"})]},e._id)))})})]})})}):null},Bbe=()=>{const{user:e}=sl(),[t,n]=(0,s.useState)([]),[i,r]=(0,s.useState)(!0),[o,a]=(0,s.useState)("");(0,s.useEffect)((()=>{"student"===(null===e||void 0===e?void 0:e.role)&&l()}),[e]);const l=async()=>{try{const e=localStorage.getItem("token"),t=await rl.get("http://localhost:5000/api/jobs/student/my-applications",{headers:{Authorization:`Bearer ${e}`}});n(t.data)}catch(o){var e,t;console.error("Error fetching applications:",o),a((null===(e=o.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to fetch applications")}finally{r(!1)}},c=e=>{switch(e){case"Accepted":return"success";case"Rejected":return"error";case"Pending":return"warning";default:return"default"}};return e&&"student"===e.role?(0,We.jsxs)(Zn,{maxWidth:"lg",sx:{py:4},children:[(0,We.jsx)(Ln,{variant:"h4",gutterBottom:!0,children:"My Applications"}),o&&(0,We.jsx)(MA,{severity:"error",sx:{mb:3},children:o}),i?(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,We.jsx)(jA,{})}):t.length>0?(0,We.jsx)(Xl,{container:!0,spacing:3,children:t.map((t=>{var n,i,r,o,s,a,l,u,h;return(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Bxe,{children:(0,We.jsxs)(kxe,{children:[(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[(0,We.jsxs)(ci,{children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:t.title}),(0,We.jsxs)(Ln,{variant:"body2",color:"text.secondary",children:["Posted by ",t.recruiter.name]})]}),(0,We.jsx)(Vx,{label:(null===(n=t.applicants)||void 0===n||null===(i=n.find((t=>t.student===e._id)))||void 0===i?void 0:i.status)||"Unknown",color:c(null===(r=t.applicants)||void 0===r||null===(o=r.find((t=>t.student===e._id)))||void 0===o?void 0:o.status),size:"small"})]}),(0,We.jsx)(Vx,{label:t.category,color:"primary",variant:"outlined",size:"small",sx:{mb:2}}),(0,We.jsx)(Ln,{variant:"body2",paragraph:!0,children:t.description}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,mb:2},children:[(0,We.jsxs)(Ln,{variant:"body2",children:[(0,We.jsx)("strong",{children:"Pay:"})," \u20b9",(null===(s=t.pay)||void 0===s||null===(a=s.amount)||void 0===a?void 0:a.toLocaleString())||"Not specified","hourly"===(null===(l=t.pay)||void 0===l?void 0:l.type)?"/hour":""]}),(0,We.jsxs)(Ln,{variant:"body2",children:[(0,We.jsx)("strong",{children:"Duration:"})," ",t.duration," weeks"]}),(0,We.jsxs)(Ln,{variant:"body2",children:[(0,We.jsx)("strong",{children:"Applied:"})," ",new Date((null===(u=t.applicants)||void 0===u||null===(h=u.find((t=>t.student===e._id)))||void 0===h?void 0:h.appliedAt)||Date.now()).toLocaleDateString()]})]}),(0,We.jsx)(ci,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:t.requiredSkills.map(((e,t)=>(0,We.jsx)(Vx,{label:`${e.name} (${e.level})`,size:"small",variant:"outlined"},t)))})]})})},t._id)}))}):(0,We.jsx)(Tt,{sx:{p:3,textAlign:"center"},children:(0,We.jsx)(Ln,{color:"text.secondary",children:"You haven't applied for any gigs yet."})})]}):(0,We.jsx)(Zn,{maxWidth:"lg",sx:{py:4},children:(0,We.jsx)(MA,{severity:"error",children:"This page is only accessible to students."})})},Lbe=gxe.map((e=>e.name)),Nbe=()=>{var e,t;const n=oe(),{user:i}=sl(),[r,o]=(0,s.useState)({title:"",description:"",requirements:"",category:"",company:"",pay:{amount:"",type:"fixed"},duration:"",requiredSkills:[],location:"",type:"remote",experience:"Beginner",deadline:new Date(Date.now()+6048e5).toISOString(),status:"Open"}),[a,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[h,d]=(0,s.useState)(""),[p,f]=(0,s.useState)(!1);s.useEffect((()=>{i&&"recruiter"!==i.role&&n("/")}),[i,n]);const m=e=>{const{name:t,value:n}=e.target;if(t.includes(".")){const[e,i]=t.split(".");o((t=>({...t,[e]:{...t[e],[i]:n}})))}else{if("type"===t&&!["remote","hybrid","onsite"].includes(n))return;if("experience"===t&&!["Beginner","Intermediate","Advanced","Expert"].includes(n))return;o((e=>({...e,[t]:n})))}},g=e=>{e.preventDefault(),e.stopPropagation(),a.trim()&&!r.requiredSkills.includes(a.trim())&&(o((e=>({...e,requiredSkills:[...e.requiredSkills,a.trim()]}))),l(""))};return i&&"recruiter"===i.role?(0,We.jsx)(Zn,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(Tt,{sx:{p:4},children:[(0,We.jsx)(Ln,{variant:"h4",gutterBottom:!0,children:"Create New Job"}),c&&(0,We.jsx)(MA,{severity:"error",sx:{mb:2},children:c}),h&&(0,We.jsx)(MA,{severity:"success",sx:{mb:2},children:h}),(0,We.jsx)("form",{onSubmit:async e=>{e.preventDefault(),u(""),d("");try{if(f(!0),!r.title||!r.description||!r.requirements||!r.pay.amount||!r.duration||!r.category||!r.deadline||!r.company||!r.location)return void u("Please fill in all required fields");if(!["remote","hybrid","onsite"].includes(r.type))return void u("Invalid work type selected");if(!["Beginner","Intermediate","Advanced","Expert"].includes(r.experience))return void u("Invalid experience level selected");const e={title:r.title,description:r.description,requirements:r.requirements.split("\n").filter((e=>e.trim())),category:r.category,company:r.company,pay:{amount:Number(r.pay.amount),type:r.pay.type},duration:Number(r.duration),location:r.location,type:r.type,experience:r.experience,deadline:new Date(r.deadline).toISOString(),requiredSkills:r.requiredSkills.map((e=>({name:e,level:r.experience}))),recruiter:i._id,postedBy:i._id,status:r.status,createdAt:(new Date).toISOString()};console.log("Submitting job data:",e);const t=localStorage.getItem("token"),o=await rl.post("http://localhost:5000/api/jobs",e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});console.log("Job creation response:",o.data),d("Job created successfully!"),setTimeout((()=>{n("/jobs")}),2e3)}catch(c){var t,o,s,a;console.error("Error creating job:",c);const n=(null===(t=c.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.message)||(null===(s=c.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.error)||c.message||"Failed to create job. Please try again.";u(`Error: ${n}`),c.response&&(console.error("Error response:",c.response.data),console.error("Error status:",c.response.status),console.error("Error headers:",c.response.headers))}finally{f(!1)}},children:(0,We.jsxs)(Xl,{container:!0,spacing:3,children:[(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,label:"Job Title",name:"title",value:r.title,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Category"}),(0,We.jsx)(qy,{name:"category",value:r.category,onChange:m,label:"Category",children:Lbe.map((e=>(0,We.jsx)(Vo,{value:e,children:e},e)))})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:r.description,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,multiline:!0,rows:4,label:"Requirements",name:"requirements",value:r.requirements,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,label:"Company",name:"company",value:r.company,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Pay Type"}),(0,We.jsxs)(qy,{name:"pay.type",value:r.pay.type,onChange:m,label:"Pay Type",children:[(0,We.jsx)(Vo,{value:"fixed",children:"Fixed Pay"}),(0,We.jsx)(Vo,{value:"hourly",children:"Hourly Rate"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,type:"number",name:"pay.amount",label:""+("hourly"===r.pay.type?"Hourly Rate":"Fixed Pay"),value:r.pay.amount,onChange:m,error:Boolean(null===(e=c.pay)||void 0===e?void 0:e.amount),helperText:null===(t=c.pay)||void 0===t?void 0:t.amount,InputProps:{startAdornment:(0,We.jsx)(Qxe,{position:"start",children:(0,We.jsx)("span",{style:{fontFamily:"system-ui, -apple-system, Arial"},children:"\u20b9"})}),inputProps:{min:0}}})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Duration (weeks)",type:"number",name:"duration",value:r.duration,onChange:m,required:!0,inputProps:{min:1}})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Experience Level"}),(0,We.jsxs)(qy,{name:"experience",value:r.experience,onChange:m,label:"Experience Level",children:[(0,We.jsx)(Vo,{value:"Beginner",children:"Beginner"}),(0,We.jsx)(Vo,{value:"Intermediate",children:"Intermediate"}),(0,We.jsx)(Vo,{value:"Advanced",children:"Advanced"}),(0,We.jsx)(Vo,{value:"Expert",children:"Expert"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Work Type"}),(0,We.jsxs)(qy,{name:"type",value:r.type,onChange:m,label:"Work Type",children:[(0,We.jsx)(Vo,{value:"remote",children:"Remote"}),(0,We.jsx)(Vo,{value:"hybrid",children:"Hybrid"}),(0,We.jsx)(Vo,{value:"onsite",children:"On-site"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,label:"Location",name:"location",value:r.location,onChange:m})}),(0,We.jsxs)(Xl,{item:!0,xs:12,children:[(0,We.jsxs)(ci,{sx:{mb:1},children:[(0,We.jsx)(Ln,{variant:"subtitle1",gutterBottom:!0,children:"Required Skills"}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(Jy,{fullWidth:!0,label:"Add Skill",value:a,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),g(e))}}),(0,We.jsx)(Cn,{onClick:g,variant:"contained",disabled:!a.trim(),children:"Add"})]})]}),(0,We.jsx)(yi,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,sx:{mt:1},children:r.requiredSkills.map((e=>(0,We.jsx)(Vx,{label:e,onDelete:()=>{return t=e,void o((e=>({...e,requiredSkills:e.requiredSkills.filter((e=>e!==t))})));var t}},e)))})]}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:3},children:[(0,We.jsx)(Cn,{variant:"outlined",onClick:()=>n("/profile"),children:"Cancel"}),(0,We.jsx)(Cn,{type:"submit",variant:"contained",disabled:!r.title||!r.description||!r.requirements||!r.pay.amount||!r.duration||!r.category||!r.deadline,children:"Create Job"})]})})]})})]})}):null},Dbe=gxe.map((e=>e.name)),kbe=()=>{const e=oe(),{id:t}=se(),{user:n}=sl(),[i,r]=(0,s.useState)({title:"",description:"",requirements:"",category:"",pay:{amount:"",type:"fixed"},duration:"",requiredSkills:[],location:"",type:"remote",experience:"Beginner",deadline:"",status:"Open",company:""}),[o,a]=(0,s.useState)(""),[l,c]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[d,p]=(0,s.useState)(!1);(0,s.useEffect)((()=>{t&&f()}),[t]);const f=async()=>{try{var n,i,o;p(!0);const e=localStorage.getItem("token"),s=(await rl.get(`http://localhost:5000/api/jobs/${t}`,{headers:{Authorization:`Bearer ${e}`}})).data;console.log("Fetched job data:",s),r({title:s.title||"",description:s.description||"",requirements:Array.isArray(s.requirements)?s.requirements.join("\n"):s.requirements||"",category:s.category||"",company:s.company||"",pay:{amount:(null===(n=s.pay)||void 0===n?void 0:n.amount)||"",type:(null===(i=s.pay)||void 0===i?void 0:i.type)||"fixed"},duration:s.duration||"",location:s.location||"",type:s.type||"remote",experience:s.experience||"Beginner",deadline:s.deadline?new Date(s.deadline).toISOString().split("T")[0]:"",status:s.status||"Open",requiredSkills:(null===(o=s.requiredSkills)||void 0===o?void 0:o.map((e=>e.name)))||[]})}catch(l){var s,a,u,h;console.error("Error fetching job details:",l),c((null===(s=l.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||"Failed to fetch job details"),404!==(null===(u=l.response)||void 0===u?void 0:u.status)&&403!==(null===(h=l.response)||void 0===h?void 0:h.status)||setTimeout((()=>{e("/jobs")}),2e3)}finally{p(!1)}},m=e=>{const{name:t,value:n}=e.target;if(t.includes(".")){const[e,i]=t.split(".");r((t=>({...t,[e]:{...t[e],[i]:n}})))}else{if("type"===t&&!["remote","hybrid","onsite"].includes(n))return;if("experience"===t&&!["Beginner","Intermediate","Advanced","Expert"].includes(n))return;r((e=>({...e,[t]:n})))}},g=e=>{e.preventDefault(),o.trim()&&!i.requiredSkills.includes(o.trim())&&(r((e=>({...e,requiredSkills:[...e.requiredSkills,o.trim()]}))),a(""))};return n&&"recruiter"===n.role?d?(0,We.jsx)(Zn,{maxWidth:"md",sx:{py:4},children:(0,We.jsx)(Tt,{sx:{p:4,textAlign:"center"},children:(0,We.jsx)(Ln,{children:"Loading job details..."})})}):(0,We.jsx)(Zn,{maxWidth:"md",sx:{py:4},children:(0,We.jsxs)(Tt,{sx:{p:4},children:[(0,We.jsx)(Ln,{variant:"h4",gutterBottom:!0,children:"Edit Job"}),l&&(0,We.jsx)(MA,{severity:"error",sx:{mb:2},children:l}),u&&(0,We.jsx)(MA,{severity:"success",sx:{mb:2},children:u}),(0,We.jsx)("form",{onSubmit:async n=>{n.preventDefault(),c(""),h("");try{if(p(!0),!i.title||!i.description||!i.requirements||!i.pay.amount||!i.duration||!i.category||!i.deadline||!i.company||!i.location)return void c("Please fill in all required fields");if(!["remote","hybrid","onsite"].includes(i.type))return void c("Invalid work type selected");if(!["Beginner","Intermediate","Advanced","Expert"].includes(i.experience))return void c("Invalid experience level selected");const n={title:i.title,description:i.description,requirements:i.requirements.split("\n").filter((e=>e.trim())),category:i.category,company:i.company,pay:{amount:Number(i.pay.amount),type:i.pay.type},duration:Number(i.duration),location:i.location,type:i.type,experience:i.experience,deadline:new Date(i.deadline).toISOString(),status:i.status,requiredSkills:i.requiredSkills.map((e=>({name:e,level:i.experience})))};console.log("Submitting job data:",n);const r=localStorage.getItem("token");await rl.patch(`http://localhost:5000/api/jobs/${t}`,n,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),h("Job updated successfully!"),setTimeout((()=>{e("/jobs")}),2e3)}catch(l){var r,o;console.error("Error updating job:",l),c((null===(r=l.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message)||"Failed to update job")}finally{p(!1)}},children:(0,We.jsxs)(Xl,{container:!0,spacing:3,children:[(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,label:"Job Title",name:"title",value:i.title,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Category"}),(0,We.jsx)(qy,{name:"category",value:i.category,onChange:m,label:"Category",children:Dbe.map((e=>(0,We.jsx)(Vo,{value:e,children:e},e)))})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:i.description,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,multiline:!0,rows:4,label:"Requirements (one per line)",name:"requirements",value:i.requirements,onChange:m,helperText:"Enter each requirement on a new line"})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Pay Type"}),(0,We.jsxs)(qy,{name:"pay.type",value:i.pay.type,onChange:m,label:"Pay Type",children:[(0,We.jsx)(Vo,{value:"fixed",children:"Fixed Pay"}),(0,We.jsx)(Vo,{value:"hourly",children:"Hourly Rate"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:("hourly"===i.pay.type?"Hourly Rate":"Fixed Pay")+" (\u20b9)",name:"pay.amount",type:"number",value:i.pay.amount,onChange:m,required:!0,InputProps:{startAdornment:(0,We.jsx)(Qxe,{position:"start",children:"\u20b9"})},inputProps:{min:0}})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(Jy,{fullWidth:!0,label:"Duration (weeks)",type:"number",name:"duration",value:i.duration,onChange:m,required:!0,inputProps:{min:1}})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Experience Level"}),(0,We.jsxs)(qy,{name:"experience",value:i.experience,onChange:m,label:"Experience Level",children:[(0,We.jsx)(Vo,{value:"Beginner",children:"Beginner"}),(0,We.jsx)(Vo,{value:"Intermediate",children:"Intermediate"}),(0,We.jsx)(Vo,{value:"Advanced",children:"Advanced"}),(0,We.jsx)(Vo,{value:"Expert",children:"Expert"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsxs)(dy,{fullWidth:!0,required:!0,children:[(0,We.jsx)(ly,{children:"Work Type"}),(0,We.jsxs)(qy,{name:"type",value:i.type,onChange:m,label:"Work Type",children:[(0,We.jsx)(Vo,{value:"remote",children:"Remote"}),(0,We.jsx)(Vo,{value:"hybrid",children:"Hybrid"}),(0,We.jsx)(Vo,{value:"onsite",children:"On-site"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,md:6,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,label:"Location",name:"location",value:i.location,onChange:m})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Jy,{required:!0,fullWidth:!0,label:"Company",name:"company",value:i.company,onChange:m})}),(0,We.jsxs)(Xl,{item:!0,xs:12,children:[(0,We.jsxs)(ci,{sx:{mb:1},children:[(0,We.jsx)(Ln,{variant:"subtitle1",gutterBottom:!0,children:"Required Skills"}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:1},children:[(0,We.jsx)(Jy,{fullWidth:!0,label:"Add Skill",value:o,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),g(e))}}),(0,We.jsx)(Cn,{onClick:g,variant:"contained",disabled:!o.trim(),children:"Add"})]})]}),(0,We.jsx)(yi,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,sx:{mt:1},children:i.requiredSkills.map((e=>(0,We.jsx)(Vx,{label:e,onDelete:()=>{return t=e,void r((e=>({...e,requiredSkills:e.requiredSkills.filter((e=>e!==t))})));var t}},e)))})]}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,justifyContent:"flex-end",mt:3},children:[(0,We.jsx)(Cn,{variant:"outlined",onClick:()=>e("/jobs"),children:"Cancel"}),(0,We.jsx)(Cn,{type:"submit",variant:"contained",disabled:d,children:"Update Job"})]})})]})})]})}):(e("/"),null)};function Obe(e){return(0,Et.Ay)("MuiCardActionArea",e)}const Ube=(0,wt.A)("MuiCardActionArea",["root","focusVisible","focusHighlight"]),Fbe=["children","className","focusVisibleClassName"],zbe=(0,At.Ay)(gn,{name:"MuiCardActionArea",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"block",textAlign:"inherit",borderRadius:"inherit",width:"100%",[`&:hover .${Ube.focusHighlight}`]:{opacity:(t.vars||t).palette.action.hoverOpacity,"@media (hover: none)":{opacity:0}},[`&.${Ube.focusVisible} .${Ube.focusHighlight}`]:{opacity:(t.vars||t).palette.action.focusOpacity}}})),jbe=(0,At.Ay)("span",{name:"MuiCardActionArea",slot:"FocusHighlight",overridesResolver:(e,t)=>t.focusHighlight})((e=>{let{theme:t}=e;return{overflow:"hidden",pointerEvents:"none",position:"absolute",top:0,right:0,bottom:0,left:0,borderRadius:"inherit",opacity:0,backgroundColor:"currentcolor",transition:t.transitions.create("opacity",{duration:t.transitions.duration.short})}})),Vbe=s.forwardRef((function(e,t){const n=(0,st.b)({props:e,name:"MuiCardActionArea"}),{children:i,className:r,focusVisibleClassName:o}=n,s=(0,je.A)(n,Fbe),a=n,l=(e=>{const{classes:t}=e;return(0,yt.A)({root:["root"],focusHighlight:["focusHighlight"]},Obe,t)})(a);return(0,We.jsxs)(zbe,(0,ze.A)({className:(0,vt.A)(l.root,r),focusVisibleClassName:(0,vt.A)(o,l.focusVisible),ref:t,ownerState:a},s,{children:[i,(0,We.jsx)(jbe,{className:l.focusHighlight,ownerState:a})]}))})),Gbe=()=>{const e=oe(),[t,n]=(0,s.useState)([]),[i,r]=(0,s.useState)(!0),[o,a]=(0,s.useState)("");(0,s.useEffect)((()=>{l()}),[]);const l=async()=>{try{const e=localStorage.getItem("token"),t=await rl.get("http://localhost:5000/api/users/recommended-jobs",{headers:{Authorization:`Bearer ${e}`}});n(t.data.slice(0,3))}catch(o){var e,t;console.error("Error fetching recommended jobs:",o),a((null===(e=o.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to fetch recommended jobs")}finally{r(!1)}};return i?(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,We.jsx)(jA,{})}):o?(0,We.jsx)(MA,{severity:"error",sx:{mb:2},children:o}):(0,We.jsxs)(ci,{sx:{mb:4},children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:"Recommended Jobs"}),(0,We.jsx)(Xl,{container:!0,spacing:3,children:t.map((t=>{var n,i,r;return(0,We.jsx)(Xl,{item:!0,xs:12,md:4,children:(0,We.jsx)(Bxe,{children:(0,We.jsx)(Vbe,{onClick:()=>e(`/jobs/${t._id}`),children:(0,We.jsxs)(kxe,{children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:t.title}),(0,We.jsx)(Ln,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:t.company}),(0,We.jsx)(Vx,{label:t.category,color:"primary",size:"small",sx:{mb:2}}),(0,We.jsxs)(Ln,{variant:"body2",paragraph:!0,children:[t.description.substring(0,150),"..."]}),(0,We.jsxs)(ci,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[(0,We.jsxs)(Ln,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,We.jsx)("strong",{children:"Pay:"}),(0,We.jsx)(Yxe,{style:{fontSize:"1rem",display:"inline-flex",alignItems:"center"}}),(null===(n=t.pay)||void 0===n||null===(i=n.amount)||void 0===i?void 0:i.toLocaleString())||"Not specified","hourly"===(null===(r=t.pay)||void 0===r?void 0:r.type)?"/hour":""]}),(0,We.jsxs)(Ln,{variant:"body2",children:[(0,We.jsx)("strong",{children:"Duration:"})," ",t.duration," weeks"]})]}),(0,We.jsx)(ci,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:t.requiredSkills.slice(0,3).map(((e,t)=>(0,We.jsx)(Vx,{label:`${e.name} (${e.level})`,size:"small",variant:"outlined"},t)))})]})})})},t._id)}))})]})},Hbe=(0,ji.A)((0,We.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School"),Wbe=()=>{const e=oe(),{user:t}=sl();return t&&"student"===t.role?(0,We.jsxs)(Zn,{maxWidth:"lg",sx:{py:4},children:[(0,We.jsxs)(Ln,{variant:"h4",gutterBottom:!0,children:["Welcome, ",t.name,"!"]}),(0,We.jsxs)(Xl,{container:!0,spacing:3,children:[(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsxs)(Tt,{sx:{p:3,mb:3},children:[(0,We.jsx)(Ln,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),(0,We.jsxs)(yi,{direction:"row",spacing:2,children:[(0,We.jsx)(Cn,{variant:"contained",startIcon:(0,We.jsx)(jg,{}),onClick:()=>e("/jobs"),children:"Browse Jobs"}),(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Hbe,{}),onClick:()=>e("/my-applications"),children:"My Applications"}),(0,We.jsx)(Cn,{variant:"outlined",startIcon:(0,We.jsx)(Hg,{}),onClick:()=>e("/profile"),children:"Edit Profile"})]})]})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Gbe,{})}),(0,We.jsx)(Xl,{item:!0,xs:12,children:(0,We.jsx)(Tt,{sx:{p:3},children:(0,We.jsxs)(ci,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,We.jsx)(Ln,{variant:"h6",children:"Recent Applications"}),(0,We.jsx)(Cn,{variant:"text",onClick:()=>e("/my-applications"),children:"View All"})]})})})]})]}):(e("/"),null)},Qbe=(0,si.A)({palette:{mode:"light",primary:{main:"#A35C7A",light:"#C890A7",dark:"#8B4E68",contrastText:"#FEF6EB"},secondary:{main:"#C890A7",light:"#D4A7BB",dark:"#A35C7A",contrastText:"#212121"},background:{default:"#FEF6EB",paper:"#FFFFFF"},text:{primary:"#212121",secondary:"#A35C7A"}},components:{MuiButton:{styleOverrides:{root:{borderRadius:8,textTransform:"none",fontFamily:"Futura"},contained:{backgroundColor:"#A35C7A",color:"#FEF6EB","&:hover":{backgroundColor:"#C890A7"}},outlined:{borderColor:"#A35C7A",color:"#A35C7A","&:hover":{borderColor:"#C890A7",backgroundColor:"rgba(163, 92, 122, 0.04)"}}}},MuiPaper:{styleOverrides:{root:{backgroundColor:"#FFFFFF",backgroundImage:"none"}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:"#212121",color:"#FEF6EB"}}},MuiCard:{styleOverrides:{root:{backgroundColor:"#FFFFFF",border:"1px solid rgba(163, 92, 122, 0.1)","&:hover":{borderColor:"#A35C7A"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(163, 92, 122, 0.2)"},"&:hover fieldset":{borderColor:"#A35C7A"},"&.Mui-focused fieldset":{borderColor:"#A35C7A"}}}}},MuiChip:{styleOverrides:{root:{backgroundColor:"rgba(163, 92, 122, 0.1)",color:"#A35C7A","&:hover":{backgroundColor:"rgba(163, 92, 122, 0.2)"}}}},MuiCssBaseline:{styleOverrides:"\n        @font-face {\n          font-family: 'Futura';\n          font-style: normal;\n          font-display: swap;\n          font-weight: 400;\n        }\n        @font-face {\n          font-family: 'Futura';\n          font-style: normal;\n          font-display: swap;\n          font-weight: 700;\n        }\n      "}},typography:{fontFamily:["Futura","Futura-Medium","Futura PT","sans-serif"].join(","),h1:{fontFamily:"Futura",color:"#212121"},h2:{fontFamily:"Futura",color:"#212121"},h3:{fontFamily:"Futura",color:"#212121"},h4:{fontFamily:"Futura",color:"#212121"},h5:{fontFamily:"Futura",color:"#212121"},h6:{fontFamily:"Futura",color:"#212121"},subtitle1:{fontFamily:"Futura"},subtitle2:{fontFamily:"Futura"},body1:{fontFamily:"Futura"},body2:{fontFamily:"Futura"},button:{fontFamily:"Futura",textTransform:"none"}},shape:{borderRadius:8}}),qbe=e=>{let{message:t,isUser:n}=e;return(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:n?"flex-end":"flex-start",mb:2},children:(0,We.jsx)(Tt,{elevation:1,sx:{p:2,maxWidth:"80%",backgroundColor:n?"primary.main":"background.paper",color:n?"primary.contrastText":"text.primary",borderRadius:2},children:(0,We.jsx)(Ln,{variant:"body1",children:t})})})},Xbe=()=>{const[e,t]=(0,s.useState)(!1),[n,i]=(0,s.useState)([]),[r,o]=(0,s.useState)(""),[a,l]=(0,s.useState)(!1),[c,u]=(0,s.useState)(""),[h,d]=(0,s.useState)(""),[p,f]=(0,s.useState)(!1);(0,s.useEffect)((()=>{const e=localStorage.getItem("selectedJob")||"";u(e)}),[]);const m=async()=>{if(!r.trim()||!p)return;const e=r.trim();o(""),i((t=>[...t,{text:e,isUser:!0}]));try{l(!0);const t=await rl.post("http://localhost:5000/api/chat/message",{message:e,job:c,skills:h});i((e=>[...e,{text:t.data.message,isUser:!1}]))}catch(t){console.error("Error sending message:",t),i((e=>[...e,{text:"Sorry, I encountered an error. Please try again.",isUser:!1}]))}finally{l(!1)}};return e?(0,We.jsxs)(Tt,{elevation:3,sx:{position:"fixed",bottom:24,right:24,width:400,height:600,display:"flex",flexDirection:"column",zIndex:1e3},children:[(0,We.jsxs)(ci,{sx:{p:2,backgroundColor:"primary.main",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,We.jsx)(Ln,{variant:"h6",children:"GigAI Assistant"}),(0,We.jsx)(wi,{onClick:()=>t(!1),sx:{color:"white"},children:(0,We.jsx)(Zy,{})})]}),(0,We.jsx)(ci,{sx:{flex:1,overflow:"auto",p:2,display:"flex",flexDirection:"column"},children:p?(0,We.jsxs)(We.Fragment,{children:[n.map(((e,t)=>(0,We.jsx)(qbe,{message:e.text,isUser:e.isUser},t))),a&&(0,We.jsx)(ci,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,We.jsx)(jA,{size:24})})]}):(0,We.jsxs)(yi,{spacing:2,children:[(0,We.jsx)(Ln,{variant:"body1",children:"Please enter your skills to start chatting with GigAI."}),(0,We.jsx)(Jy,{label:"Your Skills (comma-separated)",value:h,onChange:e=>d(e.target.value),fullWidth:!0}),(0,We.jsx)(Cn,{variant:"contained",onClick:async()=>{if(c&&h)try{l(!0);await rl.post("http://localhost:5000/api/chat/initialize",{job:c,skills:h});i([{text:`GigAI: Hello! I'm GigAI, your career assistant. You've selected **${c}**.\nYour current skills include **${h}**. Ask me anything!`,isUser:!1}]),f(!0)}catch(e){console.error("Error initializing chat:",e),i([{text:"Error initializing chat. Please try again.",isUser:!1}])}finally{l(!1)}},disabled:!h.trim(),children:"Start Chat"})]})}),(0,We.jsx)(iv,{}),(0,We.jsx)(ci,{sx:{p:2},children:(0,We.jsx)(Jy,{fullWidth:!0,multiline:!0,maxRows:4,value:r,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),m())},placeholder:"Type your message...",disabled:!p||a,InputProps:{endAdornment:(0,We.jsx)(wi,{onClick:m,disabled:!r.trim()||!p||a,children:(0,We.jsx)(tA,{})})}})})]}):(0,We.jsx)(wi,{onClick:()=>t(!0),sx:{position:"fixed",bottom:24,right:24,backgroundColor:"primary.main",color:"white","&:hover":{backgroundColor:"primary.dark"}},children:(0,We.jsx)(eA,{})})},$be=e=>{let{children:t}=e;const{user:n,loading:i}=sl();return i?null:n&&"student"===n.role?t:(0,We.jsx)(be,{to:"/jobs"})};function Ybe(){return(0,We.jsxs)(Ee,{children:[(0,We.jsx)(_e,{path:"/",element:(0,We.jsx)(pA,{})}),(0,We.jsx)(_e,{path:"/login",element:(0,We.jsx)(ZA,{})}),(0,We.jsx)(_e,{path:"/register",element:(0,We.jsx)(Nx,{})}),(0,We.jsx)(_e,{path:"/profile/:id?",element:(0,We.jsx)(Txe,{})}),(0,We.jsx)(_e,{path:"/jobs",element:(0,We.jsx)(Jxe,{})}),(0,We.jsx)(_e,{path:"/jobs/:id",element:(0,We.jsx)(Zxe,{})}),(0,We.jsx)(_e,{path:"/jobs/:id/edit",element:(0,We.jsx)(kbe,{})}),(0,We.jsx)(_e,{path:"/messages/:userId?/:jobId?",element:(0,We.jsx)(Pbe,{})}),(0,We.jsx)(_e,{path:"/my-applications",element:(0,We.jsx)($be,{children:(0,We.jsx)(Bbe,{})})}),(0,We.jsx)(_e,{path:"/create-job",element:(0,We.jsx)(Nbe,{})}),(0,We.jsx)(_e,{path:"/dashboard",element:(0,We.jsx)($be,{children:(0,We.jsx)(Wbe,{})})})]})}const Kbe=function(){return(0,We.jsxs)(ot,{theme:Qbe,children:[(0,We.jsx)(gt,{}),(0,We.jsx)(al,{children:(0,We.jsxs)(ci,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[(0,We.jsx)(Ul,{}),(0,We.jsx)(ci,{component:"main",sx:{flexGrow:1,pt:8,pb:4,minHeight:"100vh",background:Qbe.palette.background.default},children:(0,We.jsx)(Ybe,{})}),(0,We.jsx)(Xbe,{})]})})]})};l.createRoot(document.getElementById("root")).render((0,We.jsx)(s.StrictMode,{children:(0,We.jsx)(Pe,{children:(0,We.jsx)(Kbe,{})})}))})()})();
//# sourceMappingURL=main.3911d6f0.js.map